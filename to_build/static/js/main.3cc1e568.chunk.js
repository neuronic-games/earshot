(this["webpackJsonpbinaural-meet"]=this["webpackJsonpbinaural-meet"]||[]).push([[0],[,,,function(e,t,n){"use strict";n.d(t,"b",(function(){return i.a})),n.d(t,"s",(function(){return i.g})),n.d(t,"J",(function(){return i.k})),n.d(t,"f",(function(){return i.c})),n.d(t,"g",(function(){return i.d})),n.d(t,"r",(function(){return i.f})),n.d(t,"h",(function(){return i.e})),n.d(t,"w",(function(){return i.j})),n.d(t,"u",(function(){return i.h})),n.d(t,"v",(function(){return i.i})),n.d(t,"c",(function(){return i.b})),n.d(t,"j",(function(){return a})),n.d(t,"k",(function(){return o})),n.d(t,"i",(function(){return s})),n.d(t,"O",(function(){return c})),n.d(t,"N",(function(){return u})),n.d(t,"H",(function(){return l})),n.d(t,"a",(function(){return d.a})),n.d(t,"M",(function(){return d.p})),n.d(t,"y",(function(){return d.f})),n.d(t,"z",(function(){return d.g})),n.d(t,"A",(function(){return d.i})),n.d(t,"C",(function(){return d.k})),n.d(t,"q",(function(){return d.d})),n.d(t,"d",(function(){return d.b})),n.d(t,"I",(function(){return d.m})),n.d(t,"e",(function(){return d.c})),n.d(t,"P",(function(){return d.q})),n.d(t,"G",(function(){return d.l})),n.d(t,"B",(function(){return d.j})),n.d(t,"x",(function(){return d.e})),n.d(t,"L",(function(){return d.o})),n.d(t,"K",(function(){return d.n})),n.d(t,"D",(function(){return h})),n.d(t,"p",(function(){return p.d})),n.d(t,"m",(function(){return p.b})),n.d(t,"t",(function(){return p.e})),n.d(t,"l",(function(){return p.a})),n.d(t,"E",(function(){return p.f})),n.d(t,"o",(function(){return p.c})),n.d(t,"F",(function(){return p.g})),n.d(t,"n",(function(){return f}));var i=n(124),r=n(69);function a(e){return Math.abs(Math.sign(e.a)*Math.sqrt(Math.pow(e.a,2)+Math.pow(e.c,2)))}function o(e){return Math.abs(Math.sign(e.d)*Math.sqrt(Math.pow(e.b,2)+Math.pow(e.d,2)))}function s(e){return Math.atan2(-e.c,e.a)}function c(e,t,n){var i,a=(new DOMMatrix).translate(-e[0],-e[1]),o=(i=new DOMMatrix).translateSelf.apply(i,Object(r.a)(e));return[o,t,a,n].reduce((function(e,t){return e.multiplySelf(t)}),new DOMMatrix)}function u(e,t){return[e.a*t[0]+e.c*t[1]+e.e,e.b*t[0]+e.d*t[1]+e.f]}function l(e,t){return[e.a*t[0]+e.c*t[1],e.b*t[0]+e.d*t[1]]}var d=n(92);function h(e){return function(){return new Promise((function(t,n){try{e(),t()}catch(i){throw n(i),i}}))}}var p=n(128);function f(e){return new Promise((function(t,n){var i=new XMLHttpRequest;i.timeout=5e3,i.open("GET",e),i.onreadystatechange=function(){if(this.readyState===this.LOADING){var e=this.getResponseHeader("Content-Type");this.abort(),t(e)}},i.send()}))}},,,,,,function(e,t){e.exports={ADD_ICE_CANDIDATE_FAILED:"xmpp.add_ice_candidate_failed",AUDIO_MUTED_BY_FOCUS:"xmpp.audio_muted_by_focus",VIDEO_MUTED_BY_FOCUS:"xmpp.video_muted_by_focus",AUTHENTICATION_REQUIRED:"xmpp.authentication_required",BRIDGE_DOWN:"xmpp.bridge_down",CALL_ACCEPTED:"xmpp.callaccepted.jingle",CALL_INCOMING:"xmpp.callincoming.jingle",CALL_ENDED:"xmpp.callended.jingle",CHAT_ERROR_RECEIVED:"xmpp.chat_error_received",CONFERENCE_PROPERTIES_CHANGED:"xmpp.conference_properties_changed",CONNECTION_ESTABLISHED:"xmpp.connection.connected",CONNECTION_FAILED:"xmpp.connection.failed",CONNECTION_INTERRUPTED:"xmpp.connection.interrupted",CONNECTION_RESTORED:"xmpp.connection.restored",CONNECTION_ICE_FAILED:"xmpp.connection.ice.failed",CONNECTION_RESTARTED:"xmpp.connection.restart",CONNECTION_STATUS_CHANGED:"xmpp.connection.status.changed",DISPLAY_NAME_CHANGED:"xmpp.display_name_changed",EMUC_ROOM_ADDED:"xmpp.emuc_room_added",EMUC_ROOM_REMOVED:"xmpp.emuc_room_removed",ETHERPAD:"xmpp.etherpad",FOCUS_DISCONNECTED:"xmpp.focus_disconnected",FOCUS_LEFT:"xmpp.focus_left",GRACEFUL_SHUTDOWN:"xmpp.graceful_shutdown",ICE_RESTARTING:"rtc.ice_restarting",ICE_RESTART_SUCCESS:"rtc.ice_restart_success",KICKED:"xmpp.kicked",LOCAL_ROLE_CHANGED:"xmpp.localrole_changed",MEETING_ID_SET:"xmpp.meeting_id_set",MESSAGE_RECEIVED:"xmpp.message_received",INVITE_MESSAGE_RECEIVED:"xmpp.invite_message_received",PRIVATE_MESSAGE_RECEIVED:"xmpp.private_message_received",MUC_MEMBER_BOT_TYPE_CHANGED:"xmpp.muc_member_bot_type_changed",MUC_DESTROYED:"xmpp.muc_destroyed",MUC_JOINED:"xmpp.muc_joined",MUC_MEMBER_JOINED:"xmpp.muc_member_joined",MUC_MEMBER_LEFT:"xmpp.muc_member_left",MUC_LOBBY_MEMBER_JOINED:"xmpp.muc_lobby_member_joined",MUC_LOBBY_MEMBER_UPDATED:"xmpp.muc_lobby_member_updated",MUC_LOBBY_MEMBER_LEFT:"xmpp.muc_lobby_member_left",MUC_DENIED_ACCESS:"xmpp.muc_denied access",MUC_LEFT:"xmpp.muc_left",MUC_ROLE_CHANGED:"xmpp.muc_role_changed",MUC_LOCK_CHANGED:"xmpp.muc_lock_changed",MUC_MEMBERS_ONLY_CHANGED:"xmpp.muc_members_only_changed",PARTICIPANT_AUDIO_MUTED:"xmpp.audio_muted",PARTICIPANT_VIDEO_MUTED:"xmpp.video_muted",PARTICIPANT_VIDEO_TYPE_CHANGED:"xmpp.video_type",PARTICIPANT_FEATURES_CHANGED:"xmpp.participant_features_changed",PASSWORD_REQUIRED:"xmpp.password_required",PHONE_NUMBER_CHANGED:"conference.phoneNumberChanged",PRESENCE_RECEIVED:"xmpp.presence_received",PRESENCE_STATUS:"xmpp.presence_status",PROMPT_FOR_LOGIN:"xmpp.prompt_for_login",READY_TO_JOIN:"xmpp.ready_to_join",RECORDER_STATE_CHANGED:"xmpp.recorderStateChanged",REMOTE_STATS:"xmpp.remote_stats",RENEGOTIATION_FAILED:"xmpp.renegotiation_failed",RESERVATION_ERROR:"xmpp.room_reservation_error",ROOM_CONNECT_ERROR:"xmpp.room_connect_error",ROOM_CONNECT_NOT_ALLOWED_ERROR:"xmpp.room_connect_error.not_allowed",ROOM_JOIN_ERROR:"xmpp.room_join_error",ROOM_CONNECT_MEMBERS_ONLY_ERROR:"xmpp.room_connect_error.members_only",ROOM_MAX_USERS_ERROR:"xmpp.room_max_users_error",SENDING_CHAT_MESSAGE:"xmpp.sending_chat_message",SENDING_PRIVATE_CHAT_MESSAGE:"xmpp.sending_private_chat_message",SESSION_ACCEPT_TIMEOUT:"xmpp.session_accept_timeout",SPEAKER_STATS_RECEIVED:"xmpp.speaker_stats_received",CONFERENCE_TIMESTAMP_RECEIVED:"xmpp.conference_timestamp_received",AV_MODERATION_APPROVED:"xmpp.av_moderation.approved",AV_MODERATION_RECEIVED:"xmpp.av_moderation.received",AV_MODERATION_CHANGED:"xmpp.av_moderation.changed",AV_MODERATION_PARTICIPANT_APPROVED:"xmpp.av_moderation.participant.approved",START_MUTED_FROM_FOCUS:"xmpp.start_muted_from_focus",SUBJECT_CHANGED:"xmpp.subject_changed",SUSPEND_DETECTED:"xmpp.suspend_detected",TRANSCRIPTION_STATUS_CHANGED:"xmpp.transcription_status_changed",TRANSPORT_INFO:"xmpp.transportinfo.jingle",VIDEO_SIP_GW_AVAILABILITY_CHANGED:"xmpp.videoSIPGWAvailabilityChanged",VIDEO_SIP_GW_SESSION_STATE_CHANGED:"xmpp.videoSIPGWSessionStateChanged",ICE_CONNECTION_STATE_CHANGED:"xmpp.ice_connection_state_changed",JSON_MESSAGE_RECEIVED:"xmmp.json_message_received"}},function(e,t,n){"use strict";n.r(t),n.d(t,"AUDIO_INPUT_STATE_CHANGE",(function(){return i})),n.d(t,"AUTH_STATUS_CHANGED",(function(){return r})),n.d(t,"BEFORE_STATISTICS_DISPOSED",(function(){return a})),n.d(t,"CONFERENCE_ERROR",(function(){return o})),n.d(t,"CONFERENCE_FAILED",(function(){return s})),n.d(t,"CONFERENCE_JOINED",(function(){return c})),n.d(t,"CONFERENCE_LEFT",(function(){return u})),n.d(t,"CONFERENCE_UNIQUE_ID_SET",(function(){return l})),n.d(t,"CONNECTION_ESTABLISHED",(function(){return d})),n.d(t,"CONNECTION_INTERRUPTED",(function(){return h})),n.d(t,"CONNECTION_RESTORED",(function(){return p})),n.d(t,"DATA_CHANNEL_OPENED",(function(){return f})),n.d(t,"DISPLAY_NAME_CHANGED",(function(){return m})),n.d(t,"DOMINANT_SPEAKER_CHANGED",(function(){return v})),n.d(t,"CONFERENCE_CREATED_TIMESTAMP",(function(){return g})),n.d(t,"DTMF_SUPPORT_CHANGED",(function(){return b})),n.d(t,"ENDPOINT_MESSAGE_RECEIVED",(function(){return y})),n.d(t,"ENDPOINT_STATS_RECEIVED",(function(){return E})),n.d(t,"JVB121_STATUS",(function(){return S})),n.d(t,"KICKED",(function(){return O})),n.d(t,"PARTICIPANT_KICKED",(function(){return _})),n.d(t,"LAST_N_ENDPOINTS_CHANGED",(function(){return C})),n.d(t,"LOCK_STATE_CHANGED",(function(){return T})),n.d(t,"SERVER_REGION_CHANGED",(function(){return j})),n.d(t,"_MEDIA_SESSION_STARTED",(function(){return A})),n.d(t,"_MEDIA_SESSION_ACTIVE_CHANGED",(function(){return k})),n.d(t,"MEMBERS_ONLY_CHANGED",(function(){return R})),n.d(t,"MESSAGE_RECEIVED",(function(){return I})),n.d(t,"NO_AUDIO_INPUT",(function(){return P})),n.d(t,"NOISY_MIC",(function(){return w})),n.d(t,"PRIVATE_MESSAGE_RECEIVED",(function(){return N})),n.d(t,"PARTICIPANT_CONN_STATUS_CHANGED",(function(){return D})),n.d(t,"PARTCIPANT_FEATURES_CHANGED",(function(){return M})),n.d(t,"PARTICIPANT_PROPERTY_CHANGED",(function(){return L})),n.d(t,"P2P_STATUS",(function(){return x})),n.d(t,"PHONE_NUMBER_CHANGED",(function(){return F})),n.d(t,"PROPERTIES_CHANGED",(function(){return U})),n.d(t,"RECORDER_STATE_CHANGED",(function(){return V})),n.d(t,"VIDEO_SIP_GW_AVAILABILITY_CHANGED",(function(){return B})),n.d(t,"VIDEO_SIP_GW_SESSION_STATE_CHANGED",(function(){return J})),n.d(t,"START_MUTED_POLICY_CHANGED",(function(){return H})),n.d(t,"STARTED_MUTED",(function(){return z})),n.d(t,"SUBJECT_CHANGED",(function(){return G})),n.d(t,"SUSPEND_DETECTED",(function(){return K})),n.d(t,"TALK_WHILE_MUTED",(function(){return Q})),n.d(t,"TRACK_ADDED",(function(){return q})),n.d(t,"TRACK_AUDIO_LEVEL_CHANGED",(function(){return W})),n.d(t,"TRACK_MUTE_CHANGED",(function(){return Y})),n.d(t,"TRACK_REMOVED",(function(){return X})),n.d(t,"TRANSCRIPTION_STATUS_CHANGED",(function(){return Z})),n.d(t,"USER_JOINED",(function(){return $})),n.d(t,"USER_LEFT",(function(){return ee})),n.d(t,"USER_ROLE_CHANGED",(function(){return te})),n.d(t,"USER_STATUS_CHANGED",(function(){return ne})),n.d(t,"BOT_TYPE_CHANGED",(function(){return ie})),n.d(t,"LOBBY_USER_JOINED",(function(){return re})),n.d(t,"LOBBY_USER_UPDATED",(function(){return ae})),n.d(t,"LOBBY_USER_LEFT",(function(){return oe})),n.d(t,"AV_MODERATION_APPROVED",(function(){return se})),n.d(t,"AV_MODERATION_CHANGED",(function(){return ce})),n.d(t,"AV_MODERATION_PARTICIPANT_APPROVED",(function(){return ue}));var i="conference.audio_input_state_changed",r="conference.auth_status_changed",a="conference.beforeStatisticsDisposed",o="conference.error",s="conference.failed",c="conference.joined",u="conference.left",l="conference.unique_id_set",d="conference.connectionEstablished",h="conference.connectionInterrupted",p="conference.connectionRestored",f="conference.dataChannelOpened",m="conference.displayNameChanged",v="conference.dominantSpeaker",g="conference.createdTimestamp",b="conference.dtmfSupportChanged",y="conference.endpoint_message_received",E="conference.endpoint_stats_received",S="conference.jvb121Status",O="conference.kicked",_="conference.participant_kicked",C="conference.lastNEndpointsChanged",T="conference.lock_state_changed",j="conference.server_region_changed",A="conference.media_session.started",k="conference.media_session.active_changed",R="conference.membersOnlyChanged",I="conference.messageReceived",P="conference.no_audio_input",w="conference.noisy_mic",N="conference.privateMessageReceived",D="conference.participant_conn_status_changed",M="conference.partcipant_features_changed",L="conference.participant_property_changed",x="conference.p2pStatus",F="conference.phoneNumberChanged",U="conference.propertiesChanged",V="conference.recorderStateChanged",B="conference.videoSIPGWAvailabilityChanged",J="conference.videoSIPGWSessionStateChanged",H="conference.start_muted_policy_changed",z="conference.started_muted",G="conference.subjectChanged",K="conference.suspendDetected",Q="conference.talk_while_muted",q="conference.trackAdded",W="conference.audioLevelsChanged",Y="conference.trackMuteChanged",X="conference.trackRemoved",Z="conference.transcriptionStatusChanged",$="conference.userJoined",ee="conference.userLeft",te="conference.roleChanged",ne="conference.statusChanged",ie="conference.bot_type_changed",re="conference.lobby.userJoined",ae="conference.lobby.userUpdated",oe="conference.lobby.userLeft",se="conference.av_moderation.approved",ce="conference.av_moderation.changed",ue="conference.av_moderation.participant.approved"},function(e,t,n){"use strict";var i,r,a,o,s,c,u,l,h,p,f,m,v,g,b,y,E,S,O,_,C,T,j,A,k,R,I,P,w,N,D,M,L,x,F,U,V,B,J,H,z,G,K,Q,q,W,Y,X,Z,$,ee,te,ne,ie=n(24),re=n(6),ae=n(8),oe=n(12),se=(n(83),n(56)),ce=n(4),ue=n(73),le=n(31),de=n(36),he=n(35),pe=n(61),fe=n(3),me=n(338),ve=n.n(me),ge=(i=function e(){Object(re.a)(this,e),Object(ie.a)(this,"audioInputDevice",r,this),Object(ie.a)(this,"videoInputDevice",a,this),Object(ie.a)(this,"audioOutputDevice",o,this),Object(ce.g)(this)},r=Object(oe.a)(i.prototype,"audioInputDevice",[ce.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),a=Object(oe.a)(i.prototype,"videoInputDevice",[ce.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),o=Object(oe.a)(i.prototype,"audioOutputDevice",[ce.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),i),be=n(247),ye=(s=ce.h.ref,c=ce.h.ref,u=function(){function e(){Object(re.a)(this,e),Object(ie.a)(this,"audio",l,this),Object(ie.a)(this,"audioLevel",h,this),Object(ie.a)(this,"avatar",p,this),Object(ie.a)(this,"avatarOk",f,this),Object(ce.g)(this)}return Object(ae.a)(e,[{key:"audioStream",get:function(){var e;return null===(e=this.audio)||void 0===e?void 0:e.getOriginalStream()}},{key:"avatarStream",get:function(){var e;return this.avatarOk?null===(e=this.avatar)||void 0===e?void 0:e.getOriginalStream():void 0}},{key:"onMuteChanged",value:function(e,t){e===this.avatar&&(this.avatarOk=!t)}},{key:"setAudioLevel",value:function(e){this.audioLevel=e}}]),e}(),l=Object(oe.a)(u.prototype,"audio",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),h=Object(oe.a)(u.prototype,"audioLevel",[ce.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),p=Object(oe.a)(u.prototype,"avatar",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),f=Object(oe.a)(u.prototype,"avatarOk",[ce.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!this.avatar||!this.avatar.getTrack().muted}}),Object(oe.a)(u.prototype,"audioStream",[ce.d],Object.getOwnPropertyDescriptor(u.prototype,"audioStream"),u.prototype),Object(oe.a)(u.prototype,"avatarStream",[ce.d],Object.getOwnPropertyDescriptor(u.prototype,"avatarStream"),u.prototype),Object(oe.a)(u.prototype,"onMuteChanged",[ce.b],Object.getOwnPropertyDescriptor(u.prototype,"onMuteChanged"),u.prototype),Object(oe.a)(u.prototype,"setAudioLevel",[ce.b],Object.getOwnPropertyDescriptor(u.prototype,"setAudioLevel"),u.prototype),u),Ee=(m=ce.h.shallow,v=ce.h.shallow,g=ce.h.shallow,b=ce.h.shallow,y=ce.b.bound,E=function(e){Object(de.a)(n,e);var t=Object(he.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Object(re.a)(this,n),e=t.call(this),Object(ie.a)(e,"id",S,Object(le.a)(e)),Object(ie.a)(e,"tracks",O,Object(le.a)(e)),Object(ie.a)(e,"physics",_,Object(le.a)(e)),Object(ie.a)(e,"mouse",C,Object(le.a)(e)),Object(ie.a)(e,"awayFromKeyboard",T,Object(le.a)(e)),Object(ie.a)(e,"information",j,Object(le.a)(e)),Object(ie.a)(e,"muteAudio",A,Object(le.a)(e)),Object(ie.a)(e,"muteSpeaker",k,Object(le.a)(e)),Object(ie.a)(e,"muteVideo",R,Object(le.a)(e)),Object(ce.g)(Object(le.a)(e)),e.information=i?se.b:se.d,e}return Object(ae.a)(n,[{key:"showAudio",get:function(){return!this.muteAudio}},{key:"showVideo",get:function(){return!this.muteVideo}},{key:"getColor",value:function(){var e=this.information.color;e.length||(e=this.information.name.length?Object(fe.p)(this.information.name):[208,208,224]);var t=this.information.textColor;t.length||(t=Object(fe.m)(e));var n=Object(fe.l)(e);return[Object(fe.E)(e),Object(fe.E)(t),Object(fe.E)(n)]}},{key:"getColorRGB",value:function(){return this.information.color.length?this.information.color:Object(fe.p)(this.information.name)}},{key:"getTextColorRGB",value:function(){var e=this.information.textColor;if(!e.length){var t=this.information.color;t.length||(t=Object(fe.p)(this.information.name)),e=Object(fe.m)(t)}return e}},{key:"setPhysics",value:function(e){Object.assign(this.physics,e)}}]),n}(be.a),S=Object(oe.a)(E.prototype,"id",[ce.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),O=Object(oe.a)(E.prototype,"tracks",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ye}}),_=Object(oe.a)(E.prototype,"physics",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return se.c}}),C=Object(oe.a)(E.prototype,"mouse",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{position:[0,0],show:!1}}}),T=Object(oe.a)(E.prototype,"awayFromKeyboard",[ce.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),j=Object(oe.a)(E.prototype,"information",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A=Object(oe.a)(E.prototype,"muteAudio",[ce.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),k=Object(oe.a)(E.prototype,"muteSpeaker",[ce.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),R=Object(oe.a)(E.prototype,"muteVideo",[ce.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(oe.a)(E.prototype,"showAudio",[ce.d],Object.getOwnPropertyDescriptor(E.prototype,"showAudio"),E.prototype),Object(oe.a)(E.prototype,"showVideo",[ce.d],Object.getOwnPropertyDescriptor(E.prototype,"showVideo"),E.prototype),Object(oe.a)(E.prototype,"setPhysics",[y],Object.getOwnPropertyDescriptor(E.prototype,"setPhysics"),E.prototype),E),Se=(I=ce.h.ref,P=ce.b.bound,w=ce.b.bound,N=ce.b.bound,D=function(e){Object(de.a)(n,e);var t=Object(he.a)(n);function n(){var e;return Object(re.a)(this,n),(e=t.call(this,!0)).devicePreference=new ge,Object(ie.a)(e,"useStereoAudio",M,Object(le.a)(e)),Object(ie.a)(e,"thirdPersonView",L,Object(le.a)(e)),Object(ie.a)(e,"soundLocalizationBase",x,Object(le.a)(e)),Object(ie.a)(e,"remoteVideoLimit",F,Object(le.a)(e)),Object(ie.a)(e,"remoteAudioLimit",U,Object(le.a)(e)),Object(ie.a)(e,"audioInputDevice",V,Object(le.a)(e)),Object(ie.a)(e,"videoInputDevice",B,Object(le.a)(e)),Object(ie.a)(e,"audioOutputDevice",J,Object(le.a)(e)),e.information=e.information,Object(ie.a)(e,"informationToSend",H,Object(le.a)(e)),e.informationToSend=void 0,Object(ce.g)(Object(le.a)(e)),e.loadInformationFromStorage(),pe.a.name&&(e.information.name=pe.a.name),e.useStereoAudio=null!==pe.a.headphone,e.muteAudio=null!==pe.a.muteMic,e.muteVideo=null===pe.a.cameraOn,e.loadMediaSettingsFromStorage(),e.loadPhysicsFromStorage(),Object(ce.c)((function(){var t="https://www.gravatar.com/avatar/",n=e.information.avatarSrc;if((!n||n.includes(t,0))&&e.information.email){var i=ve()(e.information.email.trim().toLowerCase());n="".concat(t).concat(i,"?d=404")}n&&Object(fe.c)(n).then((function(t){e.information.avatarSrc=t})).catch((function(){e.information.avatarSrc=""}))})),e}return Object(ae.a)(n,[{key:"setThirdPersonView",value:function(e){this.thirdPersonView=e}},{key:"trackStates",get:function(){return{micMuted:this.muteAudio,speakerMuted:this.muteSpeaker,headphone:this.useStereoAudio}}},{key:"info",get:function(){return this.information}},{key:"sendInformation",value:function(){var e=this.information,t=(e.email,Object(ue.a)(e,["email"]));this.informationToSend=t}},{key:"saveInformationToStorage",value:function(e){var t=sessionStorage;e&&(t=localStorage),t.setItem("localParticipantInformation",JSON.stringify(this.information))}},{key:"loadInformationFromStorage",value:function(){var e=localStorage;sessionStorage.getItem("localParticipantInformation")&&(e=sessionStorage);var t=e.getItem("localParticipantInformation");t&&Object.assign(this.information,JSON.parse(t))}},{key:"saveMediaSettingsToStorage",value:function(){var e={stream:{muteVideo:this.muteVideo,muteAudio:this.muteAudio,muteSpeaker:this.muteSpeaker},device:this.devicePreference,headphone:this.useStereoAudio,soundLocalizationBase:this.soundLocalizationBase};localStorage.setItem("localParticipantStreamControl",JSON.stringify(e)),sessionStorage.setItem("localParticipantStreamControl",JSON.stringify(e))}},{key:"loadMediaSettingsFromStorage",value:function(e){var t=localStorage.getItem("localParticipantStreamControl"),n=sessionStorage.getItem("localParticipantStreamControl"),i=void 0,r=void 0;t&&(i=JSON.parse(t)),n&&(r=JSON.parse(n));var a=i;a&&(a.stream.muteVideo=!0,r&&(a.stream.muteVideo=r.stream.muteVideo),e?Object.assign(e,a):(Object.assign(this,a.stream),Object.assign(this.devicePreference,a.device),this.useStereoAudio=a.headphone,this.soundLocalizationBase=a.soundLocalizationBase))}},{key:"savePhysicsToStorage",value:function(e){var t=sessionStorage;e&&(t=localStorage);var n={pose:this.pose,physics:this.physics};t.setItem("localParticipantPhysics",JSON.stringify(n))}},{key:"loadPhysicsFromStorage",value:function(){var e=localStorage;sessionStorage.getItem("localParticipantPhysics")&&(e=sessionStorage);var t=e.getItem("localParticipantPhysics");if(t){var n=JSON.parse(t);Object.assign(this.physics,n.physics),Object.assign(this.pose,n.pose)}}}]),n}(Ee),M=Object(oe.a)(D.prototype,"useStereoAudio",[ce.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),L=Object(oe.a)(D.prototype,"thirdPersonView",[ce.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return config.thirdPersonView}}),x=Object(oe.a)(D.prototype,"soundLocalizationBase",[ce.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return config.soundLocalizationBase?config.soundLocalizationBase:"user"}}),F=Object(oe.a)(D.prototype,"remoteVideoLimit",[ce.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return config.remoteVideoLimit||-1}}),U=Object(oe.a)(D.prototype,"remoteAudioLimit",[ce.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return config.remoteAudioLimit||-1}}),V=Object(oe.a)(D.prototype,"audioInputDevice",[ce.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),B=Object(oe.a)(D.prototype,"videoInputDevice",[ce.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),J=Object(oe.a)(D.prototype,"audioOutputDevice",[ce.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),H=Object(oe.a)(D.prototype,"informationToSend",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Object(oe.a)(D.prototype,"setThirdPersonView",[ce.b],Object.getOwnPropertyDescriptor(D.prototype,"setThirdPersonView"),D.prototype),Object(oe.a)(D.prototype,"trackStates",[ce.d],Object.getOwnPropertyDescriptor(D.prototype,"trackStates"),D.prototype),Object(oe.a)(D.prototype,"sendInformation",[ce.b],Object.getOwnPropertyDescriptor(D.prototype,"sendInformation"),D.prototype),Object(oe.a)(D.prototype,"loadInformationFromStorage",[P],Object.getOwnPropertyDescriptor(D.prototype,"loadInformationFromStorage"),D.prototype),Object(oe.a)(D.prototype,"loadMediaSettingsFromStorage",[w],Object.getOwnPropertyDescriptor(D.prototype,"loadMediaSettingsFromStorage"),D.prototype),Object(oe.a)(D.prototype,"loadPhysicsFromStorage",[N],Object.getOwnPropertyDescriptor(D.prototype,"loadPhysicsFromStorage"),D.prototype),D),Oe=(z=function e(){Object(re.a)(this,e),Object(ie.a)(this,"micMuted",G,this),Object(ie.a)(this,"speakerMuted",K,this),Object(ie.a)(this,"headphone",Q,this),Object(ce.g)(this)},G=Object(oe.a)(z.prototype,"micMuted",[ce.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),K=Object(oe.a)(z.prototype,"speakerMuted",[ce.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Q=Object(oe.a)(z.prototype,"headphone",[ce.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),z),_e=(q=function(e){Object(de.a)(n,e);var t=Object(he.a)(n);function n(e){var i;return Object(re.a)(this,n),(i=t.call(this)).information=i.information,i.informationReceived=!1,Object(ie.a)(i,"trackStates",W,Object(le.a)(i)),Object(ie.a)(i,"called",Y,Object(le.a)(i)),i.lastDistance=0,Object(ce.g)(Object(le.a)(i)),i.id=e,i}return Object(ae.a)(n,[{key:"call",value:function(){this.called=!0}}]),n}(Ee),W=Object(oe.a)(q.prototype,"trackStates",[ce.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Oe}}),Y=Object(oe.a)(q.prototype,"called",[ce.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(oe.a)(q.prototype,"call",[ce.b],Object.getOwnPropertyDescriptor(q.prototype,"call"),q.prototype),q),Ce=new(X=ce.h.shallow,Z=ce.h.shallow,$=function(){function e(){Object(re.a)(this,e),Object(ie.a)(this,"remote",ee,this),this.local_=ce.h.box(new Se),Object(ie.a)(this,"yarnPhones",te,this),Object(ie.a)(this,"yarnPhoneUpdated",ne,this),Object(ce.g)(this)}return Object(ae.a)(e,[{key:"count",get:function(){return this.remote.size}},{key:"local",get:function(){return this.local_.get()}},{key:"localId",get:function(){return this.local.id}},{key:"setLocalId",value:function(e){this.local.id=e}},{key:"join",value:function(e){var t=new _e(e);t.physics.located=!1,this.remote.set(e,t)}},{key:"leave",value:function(e){this.remote.delete(e)}},{key:"leaveAll",value:function(){this.remote.clear(),this.setLocalId("")}},{key:"find",value:function(e){return e===this.localId?this.local:this.remote.get(e)}},{key:"addRemoteTrack",value:function(e){var t=this.remote.get(e.getParticipantId());return!!t&&(e.isAudioTrack()?t.tracks.audio=e:(t.tracks.avatar=e,e.getTrack().addEventListener("ended",(function(){t.tracks.avatar=void 0})),e.getTrack().addEventListener("mute",(function(){t.tracks.onMuteChanged(e,!0)})),e.getTrack().addEventListener("unmute",(function(){t.tracks.onMuteChanged(e,!1)}))),!0)}},{key:"removeRemoteTrack",value:function(e){var t=this.remote.get(e.getParticipantId());return!!t&&(e.isAudioTrack()?t.tracks.audio=void 0:t.tracks.avatar=void 0,!0)}},{key:"isLocal",value:function(e){return e===this.localId}},{key:"audibleArea",value:function(){return[this.local.pose.position[0],this.local.pose.position[1],7*se.a]}}]),e}(),ee=Object(oe.a)($.prototype,"remote",[X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Map}}),te=Object(oe.a)($.prototype,"yarnPhones",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Set}}),ne=Object(oe.a)($.prototype,"yarnPhoneUpdated",[ce.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(oe.a)($.prototype,"count",[ce.d],Object.getOwnPropertyDescriptor($.prototype,"count"),$.prototype),Object(oe.a)($.prototype,"local",[ce.d],Object.getOwnPropertyDescriptor($.prototype,"local"),$.prototype),Object(oe.a)($.prototype,"localId",[ce.d],Object.getOwnPropertyDescriptor($.prototype,"localId"),$.prototype),Object(oe.a)($.prototype,"setLocalId",[ce.b],Object.getOwnPropertyDescriptor($.prototype,"setLocalId"),$.prototype),Object(oe.a)($.prototype,"join",[ce.b],Object.getOwnPropertyDescriptor($.prototype,"join"),$.prototype),Object(oe.a)($.prototype,"leave",[ce.b],Object.getOwnPropertyDescriptor($.prototype,"leave"),$.prototype),Object(oe.a)($.prototype,"leaveAll",[ce.b],Object.getOwnPropertyDescriptor($.prototype,"leaveAll"),$.prototype),$);d.participants=Ce;t.a=Ce},,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return te}));var i,r,a,o,s,c,u,l,h,p,f,m,v,g,b,y,E,S,O,_,C,T,j,A,k,R=n(15),I=n(69),P=n(8),w=n(31),N=n(36),D=n(35),M=n(24),L=n(6),x=n(12),F=(n(83),n(30)),U=n(33),V=n(54),B=n(3),J=n(11),H=n(55),z=n(45),G=n.n(z),K=n(4),Q=n(41),q=n(90),W=n(62),Y=n.n(W),X=function(e){Object(N.a)(n,e);var t=Object(D.a)(n);function n(){var e;Object(L.a)(this,n);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).jitsiConnection=void 0,e.jitsiConference=void 0,e.localId="",e}return Object(P.a)(n,[{key:"init",value:function(){var e=this;return new Promise((function(t,n){e.initJitsiConnection().then((function(){e.jitsiConnection?(e.jitsiConference=e.jitsiConnection.initJitsiConference(F.b.conference.name,config),e.jitsiConference.on(Y.a.events.conference.CONFERENCE_JOINED,(function(){var n;e.localId=e.jitsiConference.myUserId(),null===(n=e.jitsiConference)||void 0===n||n.setPerceptibles([[],[]]),t("")})),e.jitsiConference.setDisplayName(q.b),e.jitsiConference.join(""),e.jitsiConference.setSenderVideoConstraint(1080)):n("No connection has been established.")}))}))}},{key:"addTrack",value:function(e){this.jitsiConference?this.jitsiConference.addTrack(e):console.error("Not joined to conference yet.")}},{key:"removeTrack",value:function(e){return this.jitsiConference?this.jitsiConference.removeTrack(e):(console.error("Not joined to conference yet."),Promise.reject())}},{key:"getParticipantId",value:function(){return Object(B.b)(this.jitsiConference),this.localId}},{key:"getLocalTracks",value:function(){var e,t=null===(e=this.jitsiConference)||void 0===e?void 0:e.getLocalTracks();return t||[]}},{key:"initJitsiConnection",value:function(){var e=this;return new Promise((function(t,n){e.jitsiConnection=new Y.a.JitsiConnection(null,void 0,config),e.jitsiConnection.addEventListener(Y.a.events.connection.CONNECTION_ESTABLISHED,(function(){t(Y.a.events.connection.CONNECTION_ESTABLISHED)})),e.jitsiConnection.addEventListener(Y.a.events.connection.CONNECTION_FAILED,(function(){n(Y.a.events.connection.CONNECTION_FAILED)})),e.jitsiConnection.connect()}))}},{key:"disconnect",value:function(){var e=this;return new Promise((function(t,n){var i;e.jitsiConnection?e.jitsiConference?e.jitsiConference.leave().then((function(){var n;null===(n=e.jitsiConnection)||void 0===n||n.disconnect().then((function(){t("")})).catch((function(t){console.log("ConnForCont: Fail to disconnect by ".concat(t,". I'm:").concat(e.localId))}))})).catch((function(t){console.log("ConnForCont: Fail to leave by ".concat(t,". I'm:").concat(e.localId))})):null===(i=e.jitsiConnection)||void 0===i||i.disconnect().then((function(){t("")})).catch((function(t){console.log("ConnForCont no conf: Fail to disconnect by ".concat(t,". I'm:").concat(e.localId))})):n("No connection has been established.")}))}}]),n}(H.EventEmitter),Z="mainScreen",$=console.log,ee=(i=K.h.shallow,r=K.h.shallow,a=function(){function e(t){Object(L.a)(this,e),this.sharedContents=void 0,Object(M.a)(this,"carrierMap",o,this),this.remoteTrackPool=new Map,this.localMainConnection=void 0,Object(M.a)(this,"localMains",s,this),this.contentCarriers=new Map,Object(M.a)(this,"localContents",c,this),Object(M.a)(this,"remoteMains",u,this),Object(M.a)(this,"remoteContents",l,this),Object(K.g)(this),this.sharedContents=t}return Object(P.a)(e,[{key:"clearConnection",value:function(){this.clearAllRemotes(),this.clearLocalContentCarriers()}},{key:"clearAllRemotes",value:function(){this.carrierMap.clear(),this.remoteTrackPool.clear(),this.remoteMains.clear(),this.remoteContents.clear()}},{key:"clearLocalContentCarriers",value:function(){var e;this.contentCarriers.forEach((function(e){return e.disconnect()})),this.contentCarriers.clear(),null===(e=this.localMainConnection)||void 0===e||e.disconnect(),this.localMainConnection=void 0}},{key:"restoreLocalCarriers",value:function(){var e=this;if(this.localContents.forEach((function(t,n){e.createConnectionForContent(n,Array.from(t))})),this.localMains.size){var t=this.localMains;this.localMains=new Set,this.addLocalMains(Array.from(t))}}},{key:"onUpdateContent",value:function(e){var t=this;if($("update SC: id:".concat(e.id," pid:").concat(e.url," cid in map:").concat(this.carrierMap.get(e.url))),e.url){Object(B.b)(!this.carrierMap.has(e.url)||this.carrierMap.get(e.url)===e.id),this.carrierMap.set(e.url,e.id);var n=this.remoteTrackPool.get(e.url);this.remoteTrackPool.delete(e.url),null===n||void 0===n||n.forEach((function(e){t.addRemoteContent(e)}))}}},{key:"addRemoteTrack",value:function(e){var t=e.getParticipantId(),n=this.carrierMap.get(t);if(n)n===Z?this.addRemoteMain(e):config.bmRelayServer?this.contentCarriers.has(n)?$("SC addRT:Local: cid:".concat(n," pid:").concat(e.getParticipantId()," track:").concat(e.toString())):($("SC addRT:cid:".concat(n," pid:").concat(e.getParticipantId()," track:").concat(e.toString())),this.addRemoteContent(e)):this.sharedContents.localParticipant.myContents.has(n)?$("SC addRT:Local: cid:".concat(n," pid:").concat(e.getParticipantId()," track:").concat(e.toString())):($("SC addRT:cid:".concat(n," pid:").concat(e.getParticipantId()," track:").concat(e.toString())),this.addRemoteContent(e));else{var i=this.remoteTrackPool.get(t);i||(i=new Set,this.remoteTrackPool.set(t,i)),i.add(e)}}},{key:"removeRemoteTrack",value:function(e){var t=e.getParticipantId(),n=this.carrierMap.get(t);if(n===Z)this.removeRemoteMain(e);else if(n)this.removeRemoteContent(e);else{var i=this.remoteTrackPool.get(e.getParticipantId());null===i||void 0===i||i.delete(e),0===(null===i||void 0===i?void 0:i.size)&&this.remoteTrackPool.delete(e.getParticipantId())}}},{key:"onMainScreenCarrier",value:function(e,t){var n=this;if(t){this.carrierMap.set(e,Z);var i=this.remoteTrackPool.get(e);null===i||void 0===i||i.forEach((function(e){return n.addRemoteMain(e)})),this.remoteTrackPool.delete(e)}else this.remoteMains.delete(e),this.carrierMap.delete(e)}},{key:"addLocalMains",value:function(e){var t=this;Object(B.b)(e.length),e.find((function(e){return t.localMains.has(e)}))?console.error("addLocalMain: one of track in ".concat(e," already in localMains.")):(e.forEach((function(e){return t.localMains.add(e)})),this.localMainConnection?e.forEach((function(e){return t.localMainConnection.addTrack(e)})):(this.localMainConnection=new X,this.localMainConnection.init().then((function(){F.b.conference.sync.sendMainScreenCarrier(!0),e.forEach((function(e){return t.localMainConnection.addTrack(e)}))}))),e.forEach((function(e){return e.getTrack().onended=function(){$("stop sharing screen of ",e),t.removeLocalMain(e)}})))}},{key:"removeLocalMain",value:function(e){var t=this;this.localMains.delete(e)?(F.b.conference.sync.sendMainScreenCarrier(!1),this.localMainConnection.removeTrack(e).then((function(){0===t.localMainConnection.getLocalTracks().length&&(t.localMainConnection.disconnect(),t.localMainConnection=void 0)}))):console.error("removeLocalMain: track ".concat(e," not found in localMains."))}},{key:"clearLocalMains",value:function(){var e,t=new Set(this.localMains),n=Object(R.a)(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;this.removeLocalMain(i)}}catch(r){n.e(r)}finally{n.f()}}},{key:"mainStream",get:function(){var e=[];if(this.localMains.size)e=Array.from(this.localMains.values()).filter((function(e){return"audio"!==e.getType()}));else{var t=Array.from(this.remoteMains.keys());if(t.length){t.sort();var n=this.remoteMains.get(t[t.length-1]);n&&(e=Array.from(n.values()))}}if(e.length){var i,r=new MediaStream,a=Object(R.a)(e);try{for(a.s();!(i=a.n()).done;){var o=i.value;r.addTrack(o.getTrack())}}catch(s){a.e(s)}finally{a.f()}return r}}},{key:"addRemoteMain",value:function(e){var t,n,i=e.getParticipantId(),r=null===(t=this.localMainConnection)||void 0===t?void 0:t.getParticipantId();i>(r||"")&&this.clearLocalMains(),this.remoteMains.has(e.getParticipantId())||this.remoteMains.set(e.getParticipantId(),new Set),null===(n=this.remoteMains.get(e.getParticipantId()))||void 0===n||n.add(e)}},{key:"removeRemoteMain",value:function(e){var t,n;null===(t=this.remoteMains.get(e.getParticipantId()))||void 0===t||t.delete(e),0===(null===(n=this.remoteMains.get(e.getParticipantId()))||void 0===n?void 0:n.size)&&(this.remoteMains.delete(e.getParticipantId()),this.carrierMap.delete(e.getParticipantId()))}},{key:"addLocalContent",value:function(e,t){Object(B.b)(t.length);var n=new Set(this.localContents.get(e));t.forEach((function(e){return n.add(e)})),Object(B.b)(!this.localContents.has(e)),this.localContents.set(e,n),this.createConnectionForContent(e,t)}},{key:"createConnectionForContent",value:function(e,t){var n=this,i=new X;this.contentCarriers.set(e,i),i.init().then((function(){n.carrierMap.set(i.getParticipantId(),e);var r=n.sharedContents.find(e);Object(B.b)(r),r.url=i.getParticipantId(),n.sharedContents.updateByLocal(Object.assign({},r)),t.forEach((function(e){return i.addTrack(e)})),t[0].getTrack().onended=function(t){n.sharedContents.removeByLocal(e)}}))}},{key:"clearLocalContent",value:function(e){var t=this.localContents.get(e);if(null===t||void 0===t||t.forEach((function(e){e.getTrack().onended=null,e.stopStream()})),t){var n=this.contentCarriers.get(e);Object(B.b)(n),this.carrierMap.delete(n.getParticipantId()),t.forEach((function(e){return n.removeTrack(e).then((function(){0===n.getLocalTracks().length&&n.disconnect()}))}))}this.localContents.delete(e),this.contentCarriers.delete(e)}},{key:"addRemoteContent",value:function(e){var t=this.carrierMap.get(e.getParticipantId());if(t){var n=this.remoteContents.get(t),i=new Set(n);i.add(e),this.remoteContents.set(t,i)}else console.warn("No cid found for carrier ".concat(e.getParticipantId()," of track ").concat(e.toString()))}},{key:"removeRemoteContent",value:function(e){var t=this.carrierMap.get(e.getParticipantId());if(t){var n=this.remoteContents.get(t);null===n||void 0===n||n.delete(e),0===(null===n||void 0===n?void 0:n.size)&&(this.remoteContents.delete(t),this.carrierMap.delete(t))}else console.warn("No cid found for carrier ".concat(e.getParticipantId()," of track ").concat(e.toString()))}},{key:"clearRemoteContent",value:function(e){var t=this.sharedContents.find(e);t&&t.url?(this.carrierMap.delete(t.url),this.remoteContents.delete(e)):console.warn("No pid found for content ".concat(e))}},{key:"remoteMainTrack",value:function(){if(0===this.localMains.size){var e=Array.from(this.remoteMains.keys());if(e.length){e.sort();var t=this.remoteMains.get(e[e.length-1]);if(t){var n=Array.from(t);return[n.find((function(e){return e.isVideoTrack()})),n.find((function(e){return e.isAudioTrack()}))]}}}}}]),e}(),o=Object(x.a)(a.prototype,"carrierMap",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Map}}),s=Object(x.a)(a.prototype,"localMains",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Set}}),c=Object(x.a)(a.prototype,"localContents",[K.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Map}}),u=Object(x.a)(a.prototype,"remoteMains",[K.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Map}}),l=Object(x.a)(a.prototype,"remoteContents",[K.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Map}}),Object(x.a)(a.prototype,"addLocalMains",[K.b],Object.getOwnPropertyDescriptor(a.prototype,"addLocalMains"),a.prototype),Object(x.a)(a.prototype,"removeLocalMain",[K.b],Object.getOwnPropertyDescriptor(a.prototype,"removeLocalMain"),a.prototype),Object(x.a)(a.prototype,"clearLocalMains",[K.b],Object.getOwnPropertyDescriptor(a.prototype,"clearLocalMains"),a.prototype),Object(x.a)(a.prototype,"mainStream",[K.d],Object.getOwnPropertyDescriptor(a.prototype,"mainStream"),a.prototype),Object(x.a)(a.prototype,"addRemoteMain",[K.b],Object.getOwnPropertyDescriptor(a.prototype,"addRemoteMain"),a.prototype),Object(x.a)(a.prototype,"removeRemoteMain",[K.b],Object.getOwnPropertyDescriptor(a.prototype,"removeRemoteMain"),a.prototype),Object(x.a)(a.prototype,"addLocalContent",[K.b],Object.getOwnPropertyDescriptor(a.prototype,"addLocalContent"),a.prototype),Object(x.a)(a.prototype,"clearLocalContent",[K.b],Object.getOwnPropertyDescriptor(a.prototype,"clearLocalContent"),a.prototype),Object(x.a)(a.prototype,"addRemoteContent",[K.b],Object.getOwnPropertyDescriptor(a.prototype,"addRemoteContent"),a.prototype),Object(x.a)(a.prototype,"removeRemoteContent",[K.b],Object.getOwnPropertyDescriptor(a.prototype,"removeRemoteContent"),a.prototype),Object(x.a)(a.prototype,"clearRemoteContent",[K.b],Object.getOwnPropertyDescriptor(a.prototype,"clearRemoteContent"),a.prototype),a),te=function(e){},ne=function(e){};function ie(e,t){return e.zorder-t.zorder}var re=(h=K.h.shallow,p=function e(t){Object(L.a)(this,e),this.participantId="",Object(M.a)(this,"myContents",f,this),Object(B.b)(!config.bmRelayServer),Object(K.g)(this),this.participantId=t},f=Object(x.a)(p.prototype,"myContents",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Map}}),p),ae=new(m=K.h.shallow,v=K.h.shallow,g=K.h.shallow,b=K.h.shallow,y=K.h.ref,E=function(e){Object(N.a)(n,e);var t=Object(D.a)(n);function n(){var e;Object(L.a)(this,n),(e=t.call(this)).contentIdCounter=0,e.localId="",e.beforeChangeEditing=void 0,e.tracks=new ee(Object(w.a)(e)),Object(M.a)(e,"pasteEnabled",S,Object(w.a)(e)),Object(M.a)(e,"editing",O,Object(w.a)(e)),Object(M.a)(e,"all",_,Object(w.a)(e)),Object(M.a)(e,"sorted",C,Object(w.a)(e)),e.participants=new Map,e.pendToRemoves=new Map,Object(M.a)(e,"roomContents",T,Object(w.a)(e)),Object(M.a)(e,"roomContentsInfo",j,Object(w.a)(e)),Object(M.a)(e,"pasted",A,Object(w.a)(e)),e.owner=new Map,e.wallpapers="",e.oldWallPapers=[],Object(M.a)(e,"screenFps",k,Object(w.a)(e)),Object(K.g)(Object(w.a)(e)),Object(K.c)((function(){var t=J.a.localId;Array.from(e.owner.keys()).forEach((function(n){e.owner.get(n)===e.localId&&e.owner.set(n,t)}));var n=e.participants.get(e.localId);n&&(e.participants.delete(e.localId),n.participantId=t,e.participants.set(t,n)),e.localId=t,te("Set new local id ".concat(e.localId))}));var i=localStorage.getItem("screenFps");return i&&(e.screenFps=JSON.parse(i)),Object(K.c)((function(){localStorage.setItem("screenFps",JSON.stringify(e.screenFps))})),e}return Object(P.a)(n,[{key:"setEditing",value:function(e){e!==this.editing&&this.beforeChangeEditing&&this.beforeChangeEditing(this.editing,e),this.editing=e}},{key:"setBeforeChangeEditing",value:function(e,t){t&&t!==this.editing||(this.beforeChangeEditing=e)}},{key:"getParticipant",value:function(e){Object(B.b)(!config.bmRelayServer);var t=this.participants.get(e);return t||(t=new re(e),this.participants.set(e,t)),t}},{key:"setPasted",value:function(e){console.log("setPasted:",e),this.pasted=e}},{key:"sharePasted",value:function(){this.shareContent(this.pasted),this.pasted=Object(Q.b)()}},{key:"shareContent",value:function(e){Object(Q.t)(e),this.addLocalContent(e)}},{key:"localParticipant",get:function(){return this.getParticipant(this.localId)}},{key:"find",value:function(e){if(config.bmRelayServer)return this.roomContents.get(e);var t,n=this.owner.get(e);return n?null===(t=this.participants.get(n))||void 0===t?void 0:t.myContents.get(e):void 0}},{key:"removeSameWallpaper",value:function(e){var t=this;Object(B.b)(!config.bmRelayServer);var n=!1;return this.localParticipant.myContents.forEach((function(i){if(Object(V.h)(i)){var r=e.find((function(e){return i.url===e.url&&G.a.isEqual(i.pose,e.pose)}));r&&r.id!==i.id&&r.zorder<=i.zorder&&(t.removeByLocal(i.id),n=!0,console.warn("My wallpapers id:".concat(i.id," url:").concat(i.url," removed.")))}})),n}},{key:"checkDuplicatedWallpaper",value:function(e,t){var n=this;if(Object(B.b)(!config.bmRelayServer),!config.bmRelayServer){var i=t.filter(V.h);this.localParticipant.myContents.forEach((function(e){if(Object(V.h)(e)){var t=i.find((function(t){return e.url===t.url&&G.a.isEqual(e.pose,t.pose)}));t&&t.zorder<=e.zorder&&(n.removeByLocal(e.id),console.warn("My wallpapers id:".concat(e.id," url:").concat(e.url," removed.")))}}))}}},{key:"removeDuplicated",value:function(){var e=this;Object(B.b)(!config.bmRelayServer);var t=!1;this.participants.forEach((function(n){if(n.participantId>e.localParticipant.participantId){var i=Object(B.r)(n.myContents,e.localParticipant.myContents);i.forEach((function(t,n){e.disposeContent(t),e.localParticipant.myContents.delete(n)})),t=t||0!==i.size}})),t&&F.b.conference.sync.sendMyContents()}},{key:"updateAll",value:function(){var e=[];config.bmRelayServer?Object.assign(e,Array.from(this.roomContents.values())):(this.removeDuplicated(),this.participants.forEach((function(t){e.push.apply(e,Object(I.a)(t.myContents.values()))})),this.pendToRemoves.forEach((function(t){e.push.apply(e,Object(I.a)(t.myContents.values()))})));var t=Array.from(e).sort(ie);t.forEach((function(e,t){e.zIndex=t+1})),this.all=e,this.sorted=t,config.bmRelayServer||this.saveWallpaper()}},{key:"getWallpaper",value:function(){var e=this.sorted.findIndex((function(e){return!Object(V.h)(e)}));return e<0&&(e=this.sorted.length),this.sorted.slice(0,e)}},{key:"saveWallpaper",value:function(){var e=this;if(this.localId){this.wallpapers||this.loadWallpaper();var t=this.getWallpaper();if(t.find((function(t,n){return t!==e.oldWallPapers[n]}))||t.length!==this.oldWallPapers.length){this.oldWallPapers=t,this.removeSameWallpaper(t)&&(t=this.getWallpaper());var n={room:F.b.conference.name,contents:Object(Q.k)(t)},i=[],r=localStorage.getItem("wallpapers");r&&(i=JSON.parse(r));var a=i.findIndex((function(e){return e.room===n.room}));-1===a?i.push(n):i[a]=n,localStorage.setItem("wallpapers",JSON.stringify(i))}}}},{key:"loadWallpaper",value:function(){var e=this;if(!this.wallpapers){var t=this.getWallpaper();if(t.length)this.wallpapers=JSON.stringify(t);else{var n=localStorage.getItem("wallpapers");if(n){var i=JSON.parse(n).find((function(e){return e.room===F.b.conference.name}));i&&(i.contents.forEach((function(t){var n=Object(Q.b)();Object.assign(n,t),e.addLocalContent(n)})),this.wallpapers=JSON.stringify(this.getWallpaper()))}else this.wallpapers=JSON.stringify([])}}}},{key:"addLocalContent",value:function(e){if(config.bmRelayServer)e.id||(e.id=this.getUniqueId()),this.updateByLocal(e);else{if(!J.a.localId)return void console.error("addLocalContant() failed. Invalid Participant ID.");e.id||(e.id=this.getUniqueId()),this.localParticipant.myContents.set(e.id,e),this.owner.set(e.id,J.a.localId),this.updateAll(),F.b.conference.sync.sendMyContents()}}},{key:"takeContentsFromDead",value:function(e,t){var n=this,i=!1;return e.myContents.forEach((function(r,a){t&&t!==a||("screen"===r.type||"camera"===r.type?(e.myContents.delete(a),n.owner.delete(a),n.disposeContent(r)):(n.localParticipant.myContents.set(a,r),e.myContents.delete(a),n.owner.set(a,n.localId),i=!0,te("set owner for cid=",a," pid=",n.localId)))})),0===e.myContents.size&&(this.participants.delete(e.participantId),this.pendToRemoves.delete(e.participantId)),i}},{key:"getOrTakeContent",value:function(e,t){var n=this.owner.get(e);if(n){var i=this.participants.get(n);if(i)return n===this.localId||J.a.remote.has(n)?{pid:n,pc:i,take:!1}:(this.takeContentsFromDead(i),F.b.conference.sendMessage(U.b.PARTICIPANT_LEFT,n),{pid:this.localId,pc:this.participants.get(this.localId),take:!0});var r=this.pendToRemoves.get(n);if(r&&this.takeContentsFromDead(r,e))return{pid:this.localId,pc:this.participants.get(this.localId),take:!0}}return console.error("".concat(t,": No owner for cid=").concat(e)),{pid:n,pc:void 0,take:!1}}},{key:"checkAndGetContent",value:function(e,t){var n=this.owner.get(e);if(n){var i=n?this.participants.get(n):void 0;return i||console.error("".concat(t,": Owner does not have cid=").concat(e)),{pid:n,pc:i}}return console.error("".concat(t,": No owner for cid=").concat(e)),{pid:n,pc:void 0}}},{key:"updateLocalOnly",value:function(e){if(config.bmRelayServer)this.roomContents.set(e.id,e);else{var t=this.checkAndGetContent(e.id,"updateByLocal").pc;t&&t.myContents.set(e.id,e)}this.updateAll()}},{key:"updateByLocal",value:function(e){if(config.bmRelayServer)this.roomContents.set(e.id,e),F.b.conference.sync.sendContentUpdateRequest("",[e]),this.updateAll(),this.roomContentsInfo.set(e.id,e);else{var t=this.getOrTakeContent(e.id,"updateByLocal"),n=t.pid,i=t.pc;i&&(n===this.localId?(i.myContents.set(e.id,e),this.updateAll(),F.b.conference.sync.sendMyContents()):n&&F.b.conference.sync.sendContentUpdateRequest(n,[e]))}}},{key:"removeByLocal",value:function(e){if(config.bmRelayServer){var t=this.roomContents.get(e);t&&(this.disposeContent(t),this.roomContents.delete(e)),F.b.conference.sync.sendContentRemoveRequest("",[e]),this.roomContentsInfo.delete(e),this.updateAll()}else{var n,i=this.getOrTakeContent(e,"removeByLocal"),r=i.pid,a=i.pc,o=i.take;a?(o&&(console.log("sendLeftContentRemoveRequest of ".concat(e,".")),F.b.conference.sync.sendLeftContentRemoveRequest([e])),r===this.localId?(this.removeMyContent(e),F.b.conference.sync.sendMyContents()):r&&J.a.remote.has(r)&&F.b.conference.sync.sendContentRemoveRequest(r,[e])):r&&(null===(n=F.b.conference.bmRelaySocket)||void 0===n?void 0:n.readyState)===WebSocket.OPEN&&(J.a.remote.has(r)||F.b.conference.pushOrUpdateMessageViaRelay(U.b.PARTICIPANT_LEFT,[r]))}}},{key:"requestContent",value:function(e){config.bmRelayServer&&F.b.conference.pushOrUpdateMessageViaRelay(U.b.CONTENT_UPDATE_REQUEST_BY_ID,e)}},{key:"updateByRemoteRequest",value:function(e){if(config.bmRelayServer){var t,n=Object(R.a)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;this.roomContents.set(i.id,i),"screen"!==i.type&&"camera"!==i.type||this.tracks.onUpdateContent(i)}}catch(u){n.e(u)}finally{n.f()}}else{var r,a=this.getParticipant(this.localId),o=Object(R.a)(e);try{for(o.s();!(r=o.n()).done;){var s=r.value,c=this.owner.get(s.id);c===this.localId?a.myContents.set(s.id,s):console.error("Update request of ".concat(s.id," is for ").concat(c," and not for me."))}}catch(u){o.e(u)}finally{o.f()}F.b.conference.sync.sendMyContents()}this.updateAll()}},{key:"removeByRemoteRequest",value:function(e){if(config.bmRelayServer){var t,n=Object(R.a)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,r=this.roomContents.get(i);r&&(this.disposeContent(r),this.roomContents.delete(i)),ae.roomContentsInfo.delete(i)}}catch(l){n.e(l)}finally{n.f()}this.updateAll()}else{var a,o=Object(R.a)(e);try{for(o.s();!(a=o.n()).done;){var s=a.value,c=this.checkAndGetContent(s,"removeByRemoteRequest"),u=c.pid;c.pc&&(u===this.localId?this.removeMyContent(s):console.error("remote try to remove my content"))}}catch(l){o.e(l)}finally{o.f()}F.b.conference.sync.sendMyContents()}}},{key:"removeLeftContentByRemoteRequest",value:function(e){Object(B.b)(!config.bmRelayServer);var t,n=Object(R.a)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,r=this.owner.get(i);if(r){var a=this.pendToRemoves.get(r);a||(a=this.participants.get(r)),a&&(a.myContents.delete(i),this.owner.delete(i),0===a.myContents.size&&(this.participants.delete(r),this.pendToRemoves.delete(r)))}}}catch(o){n.e(o)}finally{n.f()}}},{key:"removeMyContent",value:function(e,t){Object(B.b)(!config.bmRelayServer),t||(t=this.localId);var n=this.getParticipant(t),i=n.myContents.get(e);i?(this.disposeContent(i),n.myContents.delete(e),this.owner.delete(e),this.updateAll(),t===this.localId&&F.b.conference.sync.sendMyContents()):console.log("I don't have ".concat(e," to remove."))}},{key:"replaceRemoteContents",value:function(e,t){Object(B.b)(!config.bmRelayServer),t===ae.localId&&console.error("A remote tries to replace local contents."),this.updateRemoteContents(e,t);var n=this.getParticipant(t);if(n){var i=new Map(e.map((function(e){return[e.id,e]}))),r=Object(B.f)(n.myContents,i);this.removeRemoteContents(Array.from(r.keys()),t)}}},{key:"updateRemoteContents",value:function(e,t){var n=this;Object(B.b)(!config.bmRelayServer),t===ae.localId&&console.error("A remote tries to updates local contents."),e.forEach((function(e){n.pendToRemoves.forEach((function(t){return t.myContents.delete(e.id)}));var i=n.getParticipant(t);if(te("updateContents for participant:".concat(t)),ne(" update ".concat(e.id," by ").concat(e)),ne(" myContents=",JSON.stringify(null===i||void 0===i?void 0:i.myContents)),i.myContents.has(e.id)){var r=n.owner.get(e.id);r!==t&&console.error("Owner not match for cid=".concat(e.id," owner=").concat(r," pid=").concat(t,"."))}else n.owner.set(e.id,t);i.myContents.set(e.id,e),"screen"!==e.type&&"camera"!==e.type||n.tracks.onUpdateContent(e)})),this.pendToRemoves.forEach((function(e){0===e.myContents.size&&n.pendToRemoves.delete(e.participantId)})),this.updateAll()}},{key:"removeRemoteContents",value:function(e,t){var n=this;Object(B.b)(!config.bmRelayServer),t===ae.localId&&console.error("Remote removes local contents.");var i=this.getParticipant(t);e.forEach((function(e){var t=i.myContents.get(e);t?(n.disposeContent(t),i.myContents.delete(e),n.owner.delete(e)):console.error("removeByRemote: failed to find content cid=".concat(e))})),this.updateAll()}},{key:"onParticipantLeft",value:function(e){if(!config.bmRelayServer){te("onParticipantLeft called with pid = ",e);var t=this.participants.get(e);if(t){var n=Array.from(J.a.remote.keys());n.push(this.localId),n.sort();var i=n.findIndex((function(t){return t>e})),r=n[i>=0?i:0];te("next = ",r);var a=!1;r===this.localId?(te("Next is me"),a=this.takeContentsFromDead(t)||a,te("remove:",e," current:",JSON.stringify(n)),te("local contents sz:",this.localParticipant.myContents.size," json:",JSON.stringify(Array.from(this.localParticipant.myContents.keys())))):(te("Next is remote"),this.pendToRemoveParticipant(t)),this.updateAll(),a&&F.b.conference.sync.sendMyContents()}}}},{key:"pendToRemoveParticipant",value:function(e){var t=this;Object(B.b)(!config.bmRelayServer),Array.from(e.myContents.values()).filter((function(e){return"camera"===e.type||"screen"===e.type})).forEach((function(n){e.myContents.delete(n.id),t.owner.delete(n.id)})),this.pendToRemoves.set(e.participantId,e),this.participants.delete(e.participantId)}},{key:"clearAllRemotes",value:function(){var e=this;config.bmRelayServer?this.roomContents.clear():(Array.from(this.participants.keys()).filter((function(t){return t!==e.localId})).forEach((function(t){return e.participants.delete(t)})),this.tracks.clearConnection())}},{key:"removeAllContents",value:function(){var e=this;if(config.bmRelayServer){var t=Array.from(this.roomContents.keys());F.b.conference.sync.sendContentRemoveRequest("",t),this.roomContents.clear()}else this.participants.forEach((function(t,n){if(n!==e.localId){var i=Array.from(t.myContents.values());F.b.conference.sync.sendContentRemoveRequest(n,i.map((function(e){return e.id})))}})),this.pendToRemoves.forEach((function(e){var t=Array.from(e.myContents.values());F.b.conference.sync.sendLeftContentRemoveRequest(t.map((function(e){return e.id})))})),this.owner.clear(),this.participants.clear(),this.pendToRemoves.clear(),F.b.conference.sync.sendMyContents();this.updateAll()}},{key:"getUniqueId",value:function(){for(var e=J.a.localId;;){this.contentIdCounter+=1;var t="".concat(e,"_").concat(this.contentIdCounter);if(config.bmRelayServer){if(!this.roomContents.has(t))return t}else if(!this.owner.has(t))return t}return""}},{key:"disposeContent",value:function(e){e.id===this.editing&&this.setEditing(""),"screen"!==e.type&&"camera"!==e.type||(this.tracks.contentCarriers.has(e.id)?this.tracks.clearLocalContent(e.id):this.tracks.clearRemoteContent(e.id))}},{key:"setScreenFps",value:function(e){this.screenFps=e}}]),n}(H.EventEmitter),Object(x.a)(E.prototype,"setEditing",[K.b],Object.getOwnPropertyDescriptor(E.prototype,"setEditing"),E.prototype),S=Object(x.a)(E.prototype,"pasteEnabled",[K.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),O=Object(x.a)(E.prototype,"editing",[K.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),_=Object(x.a)(E.prototype,"all",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),C=Object(x.a)(E.prototype,"sorted",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),T=Object(x.a)(E.prototype,"roomContents",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Map}}),j=Object(x.a)(E.prototype,"roomContentsInfo",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Map}}),A=Object(x.a)(E.prototype,"pasted",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Object(Q.b)()}}),Object(x.a)(E.prototype,"setPasted",[K.b],Object.getOwnPropertyDescriptor(E.prototype,"setPasted"),E.prototype),Object(x.a)(E.prototype,"sharePasted",[K.b],Object.getOwnPropertyDescriptor(E.prototype,"sharePasted"),E.prototype),Object(x.a)(E.prototype,"shareContent",[K.b],Object.getOwnPropertyDescriptor(E.prototype,"shareContent"),E.prototype),Object(x.a)(E.prototype,"localParticipant",[K.d],Object.getOwnPropertyDescriptor(E.prototype,"localParticipant"),E.prototype),k=Object(x.a)(E.prototype,"screenFps",[K.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),Object(x.a)(E.prototype,"setScreenFps",[K.b],Object.getOwnPropertyDescriptor(E.prototype,"setScreenFps"),E.prototype),E);d.contents=ae;t.b=ae},,function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a}));var i="audio",r="presenter",a="video"},function(e,t,n){"use strict";var i=n(342);t.a=new i.a},,function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"d",(function(){return c})),n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return h}));var i=n(291),r=n(455),a=n(724),o=n(188);function s(e,t){return i.a.t(e,t)}function c(){return Object(a.a)()}var u={en:{translation:{enAbout:"A video chat with a 2D map, where you will hear others' voices based on the location. It holds multiple conversations in a venue parallelly, and you may walk around between them. Sharing screens, cameras, texts, images, YouTube, and documents on google drive are supported. You may drop or paste on the map.",enTopPageUrl:"",enMoreInfo:"",YourName:"Your name",Venue:"Lobby",EnterTheVenue:"Enter the lobby",Contents:"Contents","Create and Share":"Create and Share","Share Text":"Share Text","Share iframe":"Share web page (Can't display many sites)","Share image":"Share image","Share zone image":"Share zone image","Select video camera to share":"Select video camera to share",shareImport:"_Import shared items from file",shareDownload:"_Download shared items as a file",shareIframe:"I_frame",shareText:"_Text (can paste directly)",shareImage:"Ima_ge (can paste directly)",shareZoneImage:"Zone Ima_ge (can paste directly)",shareWhiteboard:"_Whiteboard",shareCamera:"_Camera",shareScreenBackground:"Screen as the _background",stopScreenBackground:"Stop _background screen",shareScreenContent:"_Screen",stopScreen:"C_lose all screen and camera windows",frameRateSetting:"Frame rate:",fps:"fps",shareMouse:"_Mouse cursor",stopMouse:"Stop sharing _Mouse cursor",ttCreateAndshare:"_Create and share",ttMicMute:"_Mic mute",headphoneL1Chrome:"Stereo headphone (Caution: no echo cancel)",headphoneL1:"Stereo headphone",headphoneL2:"Monaural speaker",etConnection:"No connection",emConnection:"Please check internet connection. EarShot Chat uses https. If internet is OK, the server may have problems.",etMicPermission:"No permission to use microphone",emMicPermission:"Your browser does not permit to use microphone. Please give me the permission and reload your browser.",etNoMic:"No microphone",emNoMic:"Please check if your PC has a microphone. EarShot Chat requires it.",emClose:"Close",emNeverShow:"Never show this in this session",etNoChannel:"No data channel",emNoChannel:"Please check firewall setting. EarShot Chat connect to https (port 443/TCP) and port 8801-8810/UDP or 80/TCP.",etRetry:"Please reload",emRetry:"The connection had been cut off once. Please click the reload button of the browser.",imageDropzoneText:"Drag and drop images here or click",lsTitle:"Avatar and notification setting",lsName:"Name",lsColor:"Color",lsColorAvatar:"Avatar",lsColorText:"Text",lsAutoColor:"Auto",lsImage:"Avatar image",lsEmail:"Input email to use Gravatar's image",lsImageFile:"Upload file to use image file",btSave:"Save and close",btCancel:"Cancel change",lsNotifyCall:"Called",lsNotifyTouch:"Touched",lsNotifyNear:"Approached",lsNotifyYarn:"Yarn phone",rsCall:"Call",lsNotification:"Notification",rsConnectYarnPhone:"Connect yarn phone",rsCutYarnPhone:"Disconnect yarn phone",rsChatTo:"Send chat only to {{name}}",ctPin:"Lock position and size",ctUnpin:"Unlock position and size",ctProximity:"Lock sound proximity",ctUnProximity:"Unlock sound proximity",ctEdit:"Start editing (No view sync)",ctEndEdit:"End editing (Sync view)",ctEditIframe:"Browse page (No sync)",ctEndEditIframe:"End browse (No sync)",ctEditText:"Edit (No scroll sync)",ctEndEditText:"End edit (Sync scroll)",ctEditWhiteboard:"Edit (No scroll sync)",ctEndEditWhiteboard:"End edit (No scroll sync)",ctEditGDrive:"Edit/Update (No scroll sync)",ctEndEditGDrive:"End edit (No auto-update)",ctEndEditYoutube:"Sync play pos",ctEditYoutube:"No sync",ctMoveTop:"Move to the top",ctMoveBottom:"Move to the bottom",ctWallpaper:"Make this wallpaper",ctUnWallpaper:"Remove this from wallpaper",ctCopyToClipboard:"Copy to clipboard",ctDelete:"Delete",ctClose:"Close",ctName:"Titile",ctFocus:"Show it in the center",ctFrameVisible:"Normal frame",ctFrameInvisible:"Invisible frame",ctOpaque:"Opaque",ctTransparent:"Transparent",upload:"Upload",Save:"Save",Clear:"Clear",Cancel:"Cancel",broadcastMyVoice:"Broadcast my voice",soundLocalizationBasedOn:"Sound localization based on",slAvatar:"Avatar (avatar's direction)",slUser:"User (top is front)",usage:"How to use",cmJoined:"{{name}} joined.",cmLeft:"{{name}} Left.",cmNameChanged:"{{old}} changed its name to {{new}}.",cmCallBy:"{{name}} called you.",cmCallTo:"You called {{name}}.",cmToAll:"To all",cmToName:"To {{name}}",cmSend:"Send (CTRL+Enter)",cmPrivateFrom:"Private from {{name}}",cmPrivateTo:"Private to {{name}}",noCalled:"{{name}} called you.",noTouched:"{{name}} touched you.",noNear:"{{name}} approached you.",noYarn:"{{name}} connected yarn.",afkTitle:"In away from keyboard mode (L / Esc)",afkMessage:"Hit any key or click mouse to return.",gdFailed:"The file in Google Drive could not be accessed.\r\nChange the file-sharing settings so that everyone on the Internet can see it.",videoLimit:"Limit on the number of video streams",audioLimit:"Limit on the number of audio streams"}},ja:{translation:{enAbout:"\u4f4d\u7f6e\u306b\u5fdc\u3058\u3066\u58f0\u304c\u5c4a\u304f2D\u30de\u30c3\u30d7\u4ed8\u304d\u30d3\u30c7\u30aa\u30c1\u30e3\u30c3\u30c8\u3067\u3059\u3002\u4f1a\u5834\u5185\u306b\u8907\u6570\u306e\u4f1a\u8a71\u304c\u4e26\u7acb\u3057\u3001\u4f1a\u8a71\u9593\u3092\u6b69\u304d\u56de\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u753b\u9762\u3001\u30ab\u30e1\u30e9\u3001\u30c6\u30ad\u30b9\u30c8\u3001\u753b\u50cf\u3001YouTube\u3001Google\u30c9\u30e9\u30a4\u30d6\u306e\u6587\u66f8\u3092\u5171\u6709\u3067\u304d\u307e\u3059\u3002\u30de\u30c3\u30d7\u306bURL\u7b49\u3092\u30c9\u30ed\u30c3\u30d7/\u30da\u30fc\u30b9\u30c8\u3067\u304d\u307e\u3059\u3002",enTopPageUrl:"",enMoreInfo:"",YourName:"\u304a\u540d\u524d",Venue:"\u4f1a\u5834\u540d",EnterTheVenue:"\u5165\u5834",Contents:"\u5171\u6709","Create and Share":"\u5171\u6709 (c)","Share Text":"\u30c6\u30ad\u30b9\u30c8\u306e\u5171\u6709","Share iframe":"Web\u30da\u30fc\u30b8\u306e\u5171\u6709(\u591a\u304f\u306e\u30b5\u30a4\u30c8\u3092\u8868\u793a\u3067\u304d\u307e\u305b\u3093)","Share image":"\u753b\u50cf\u306e\u5171\u6709","Share zone image":"\u753b\u50cf\u306e\u5171\u6709","Select video camera to share":"\u5171\u6709\u3059\u308b\u30ab\u30e1\u30e9\u306e\u9078\u629e",shareImport:"\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u30a4\u30f3\u30dd\u30fc\u30c8 (_i)",shareDownload:"\u30d5\u30a1\u30a4\u30eb\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9 (_d)",shareIframe:"Web\u30da\u30fc\u30b8 (_f)",shareText:"\u30c6\u30ad\u30b9\u30c8 (_t / \u76f4\u63a5\u30da\u30fc\u30b9\u30c8\u53ef)",shareImage:"\u753b\u50cf (_g / \u76f4\u63a5\u30da\u30fc\u30b9\u30c8\u53ef)",shareZoneImage:"\u753b\u50cf (_g / \u76f4\u63a5\u30da\u30fc\u30b9\u30c8\u53ef)",shareWhiteboard:"\u30db\u30ef\u30a4\u30c8\u30dc\u30fc\u30c9 (_w)",shareCamera:"\u30d3\u30c7\u30aa\u30ab\u30e1\u30e9 (_c)",shareScreenBackground:"\u80cc\u666f\u306b\u753b\u9762\u5171\u6709 (_b)",stopScreenBackground:"\u80cc\u666f\u306e\u753b\u9762\u5171\u6709\u3092\u505c\u6b62 (_b)",shareScreenContent:"\u753b\u9762\u5171\u6709 (_s)",stopScreen:"\u753b\u9762\u5171\u6709\u30fb\u30ab\u30e1\u30e9\u3092\u3059\u3079\u3066\u9589\u3058\u308b (_l)",shareMouse:"\u30de\u30a6\u30b9\u30ab\u30fc\u30bd\u30eb (_m)",fps:"fps",ttCreateAndshare:"\u4f5c\u6210\u3068\u5171\u6709 (_c)",stopMouse:"\u30de\u30a6\u30b9\u30ab\u30fc\u30bd\u30eb\u306e\u5171\u6709\u505c\u6b62 (_m)",frameRateSetting:"\u30d5\u30ec\u30fc\u30e0\u30ec\u30fc\u30c8",ttMicMute:"\u30de\u30a4\u30af\u306e\u30df\u30e5\u30fc\u30c8 (_m)",headphoneL1Chrome:"\u30d8\u30c3\u30c9\u30d5\u30a9\u30f3 (\u30b9\u30c6\u30ec\u30aa / \u6ce8\u610f:\u30a8\u30b3\u30ad\u30e3\u30f3\u306a\u3057)",headphoneL1:"\u30d8\u30c3\u30c9\u30d5\u30a9\u30f3 (\u30b9\u30c6\u30ec\u30aa)",headphoneL2:"\u30b9\u30d4\u30fc\u30ab\u30fc (\u30e2\u30ce\u30e9\u30eb)",etConnection:"\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a\u306a\u3057",emConnection:"\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002EarShot Chat\u306f https \u3092\u4f7f\u3044\u307e\u3059\u3002\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a\u306e\u554f\u984c\u3067\u306a\u3051\u308c\u3070\u3001\u30b5\u30fc\u30d0\u306e\u554f\u984c\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002",etMicPermission:"\u30de\u30a4\u30af\u5229\u7528\u4e0d\u53ef",emMicPermission:"\u30d6\u30e9\u30a6\u30b6\u304c\u30de\u30a4\u30af\u306e\u5229\u7528\u3092\u8a31\u53ef\u3057\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u30d6\u30e9\u30a6\u30b6\u306eURL\u306e\u5de6\u306e\u9375\u306e\u30a2\u30a4\u30b3\u30f3\u304b\u3089\u8a31\u53ef\u3057\u3001\u30d6\u30e9\u30a6\u30b6\u3092\u30ea\u30ed\u30fc\u30c9\u3057\u3066\u304f\u3060\u3055\u3044\u3002",etNoMic:"\u30de\u30a4\u30af\u304c\u3042\u308a\u307e\u305b\u3093",emNoMic:"EarShot Chat\u306b\u306f\u30de\u30a4\u30af\u304c\u5fc5\u8981\u3067\u3059\u3002\u30d1\u30bd\u30b3\u30f3\u306b\u30de\u30a4\u30af\u304c\u3064\u3044\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002",emClose:"\u9589\u3058\u308b",emNeverShow:"\u3053\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u3067\u306f\u8868\u793a\u3057\u306a\u3044",etNoChannel:"\u30c7\u30fc\u30bf\u901a\u4fe1\u304c\u3067\u304d\u307e\u305b\u3093",emNoChannel:"\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u306e\u8a2d\u5b9a\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002EarShot Chat \u306f https(443\u756a)\u3068\u30018801-8810\u756a\u304b80\u756a\u306e\u30dd\u30fc\u30c8\u306b\u63a5\u7d9a\u3057\u307e\u3059\u3002",etRetry:"\u30d6\u30e9\u30a6\u30b6\u306e\u66f4\u65b0\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044",emRetry:"\u4e00\u5ea6\u63a5\u7d9a\u304c\u5207\u308c\u307e\u3057\u305f\u3002\u30d6\u30e9\u30a6\u30b6\u306e\u66f4\u65b0(\u30ea\u30ed\u30fc\u30c9)\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044\u3002",imageDropzoneText:"\u753b\u50cf\u3092\u30c9\u30e9\u30c3\u30b0\uff06\u30c9\u30ed\u30c3\u30d7\u3059\u308b\u304b\u3001\u30af\u30ea\u30c3\u30af\u3057\u3066\u304f\u3060\u3055\u3044",lsTitle:"\u30a2\u30d0\u30bf\u30fc\u3068\u901a\u77e5\u306e\u8a2d\u5b9a",lsColor:"\u8272",lsColorAvatar:"\u30a2\u30d0\u30bf\u30fc\u8272",lsColorText:"\u6587\u5b57\u8272",lsAutoColor:"\u81ea\u52d5",lsName:"\u304a\u540d\u524d",lsImage:"\u30a2\u30d0\u30bf\u30fc\u306e\u753b\u50cf",lsEmail:"Gravatar\u306e\u753b\u50cf\u3092\u4f7f\u3046\u5834\u5408\u306fEmail\u3092\u5165\u529b",lsImageFile:"\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u306e\u5834\u5408\u306f\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9",btSave:"\u4fdd\u5b58\u3057\u3066\u9589\u3058\u308b",btCancel:" \u3082\u3068\u306b\u623b\u3059 ",lsNotification:"\u901a\u77e5\u306e\u8a2d\u5b9a",lsNotifyCall:"\u547c\u51fa",lsNotifyTouch:"\u63a5\u89e6",lsNotifyNear:"\u63a5\u8fd1",lsNotifyYarn:"\u7cf8\u96fb\u8a71",rsCall:"\u547c\u3073\u51fa\u3059",rsConnectYarnPhone:"\u7cf8\u96fb\u8a71\u3092\u3064\u306a\u3050",rsCutYarnPhone:"\u7cf8\u96fb\u8a71\u3092\u5207\u308b",rsChatTo:"{{name}}\u3060\u3051\u306b\u30c1\u30e3\u30c3\u30c8\u3092\u9001\u308b",ctPin:"\u4f4d\u7f6e/\u30b5\u30a4\u30ba\u3092\u56fa\u5b9a\u3059\u308b",ctUnpin:"\u4f4d\u7f6e/\u30b5\u30a4\u30ba\u3092\u53ef\u5909\u306b\u3059\u308b",ctProximity:"\u4f4d\u7f6e/\u30b5\u30a4\u30ba\u3092\u56fa\u5b9a\u3059\u308b",ctUnProximity:"\u4f4d\u7f6e/\u30b5\u30a4\u30ba\u3092\u53ef\u5909\u306b\u3059\u308b",ctEditIframe:"\u30da\u30fc\u30b8\u3092\u30d6\u30e9\u30a6\u30ba (\u975e\u540c\u671f)",ctEndEditIframe:"\u30d6\u30e9\u30a6\u30ba\u3092\u7d42\u4e86 (\u540c\u671f\u306a\u3057)",ctEditText:"\u7de8\u96c6\u958b\u59cb (\u8868\u793a\u4f4d\u7f6e\u306f\u975e\u540c\u671f)",ctEndEditText:"\u7de8\u96c6\u7d42\u4e86 (\u8868\u793a\u4f4d\u7f6e\u3092\u540c\u671f)",ctEditWhiteboard:"\u7de8\u96c6\u958b\u59cb (\u8868\u793a\u4f4d\u7f6e\u306f\u975e\u540c\u671f)",ctEndEditWhiteboard:"\u7de8\u96c6\u7d42\u4e86 (\u8868\u793a\u4f4d\u7f6e\u306f\u975e\u540c\u671f)",ctEditGDrive:"\u7de8\u96c6\u958b\u59cb\u30fb\u8868\u793a\u66f4\u65b0 (\u8868\u793a\u4f4d\u7f6e\u306f\u975e\u540c\u671f)",ctEndEditGDrive:"\u7de8\u96c6\u7d42\u4e86 (\u81ea\u52d5\u66f4\u65b0\u306a\u3057)",ctEndEditYoutube:"\u518d\u751f\u4f4d\u7f6e\u3092\u540c\u671f",ctEditYoutube:"\u540c\u671f\u3057\u306a\u3044",ctMoveTop:"\u4e00\u756a\u4e0a\u306b\u79fb\u52d5",ctMoveBottom:"\u4e00\u756a\u4e0b\u306b\u79fb\u52d5",ctWallpaper:"\u58c1\u7d19\u306b\u3059\u308b",ctUnWallpaper:"\u58c1\u7d19\u304b\u3089\u306f\u305a\u3059",ctCopyToClipboard:"\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u306b\u30b3\u30d4\u30fc",ctFocus:"\u4e2d\u592e\u306b\u8868\u793a",ctDelete:"\u524a\u9664\u3059\u308b",ctClose:"\u9589\u3058\u308b",ctName:"\u30bf\u30a4\u30c8\u30eb",ctFrameVisible:"\u30d5\u30ec\u30fc\u30e0\u3042\u308a",ctFrameInvisible:"\u30d5\u30ec\u30fc\u30e0\u306a\u3057",ctOpaque:"\u4e0d\u900f\u660e",ctTransparent:"\u900f\u660e",upload:"\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9",Save:"\u4fdd\u5b58",Clear:"\u30af\u30ea\u30a2",Cancel:"\u30ad\u30e3\u30f3\u30bb\u30eb",broadcastMyVoice:"\u58f0\u3092\u5168\u54e1\u306b\u5c4a\u3051\u308b",soundLocalizationBasedOn:"\u97f3\u50cf\u5b9a\u4f4d\u306e\u5411\u304d\u306e\u57fa\u6e96",slAvatar:"\u30a2\u30d0\u30bf\u30fc\u306e\u5411\u304d",slUser:"\u30e6\u30fc\u30b6\u30fc\u306e\u5411\u304d(\u4e0a\u304c\u524d)",usage:"\u4f7f\u3044\u65b9",cmJoined:"{{name}}\u304c\u53c2\u52a0\u3002",cmLeft:"{{name}}\u304c\u9000\u51fa\u3002",cmNameChanged:"{{old}} \u304c {{new}} \u306b\u540d\u524d\u3092\u5909\u66f4\u3002",cmCallBy:"{{name}}\u304c\u3042\u306a\u305f\u3092\u547c\u3073\u307e\u3057\u305f\u3002",cmCallTo:"\u3042\u306a\u305f\u304c{{name}}\u3092\u547c\u3073\u307e\u3057\u305f\u3002",cmToAll:"\u5168\u54e1\u3078",cmToName:"{{name}}\u3078",cmSend:"\u9001\u4fe1 (CTRL+Enter)",cmPrivateFrom:"{{name}}\u304b\u3089\u500b\u4eba\u5b9b",cmPrivateTo:"\u81ea\u5206\u304b\u3089{{name}}\u5b9b",noCalled:"{{name}}\u304c\u547c\u3073\u307e\u3057\u305f\u3002",noTouched:"{{name}}\u304c\u89e6\u308c\u307e\u3057\u305f\u3002",noNear:"{{name}}\u304c\u8fd1\u3065\u304d\u307e\u3057\u305f\u3002",noYarn:"{{name}}\u304c\u7cf8\u96fb\u8a71\u3092\u3064\u306a\u304e\u307e\u3057\u305f\u3002",afkTitle:"\u96e2\u5e2d\u4e2d\u30e2\u30fc\u30c9 (L / Esc)",afkMessage:"\u30ad\u30fc\u304b\u30de\u30a6\u30b9\u30af\u30ea\u30c3\u30af\u3067\u623b\u308a\u307e\u3059\u3002",gdFailed:"Google Drive\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\r\n\u30d5\u30a1\u30a4\u30eb\u3092\u5171\u6709\u8a2d\u5b9a\u3092\u5909\u3048\u3001\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u4e0a\u306e\u5168\u54e1\u304c\u95b2\u89a7\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002",videoLimit:"\u6620\u50cf\u30b9\u30c8\u30ea\u30fc\u30e0\u6570\u306e\u4e0a\u9650",audioLimit:"\u97f3\u58f0\u30b9\u30c8\u30ea\u30fc\u30e0\u6570\u306e\u4e0a\u9650"}}},l=Object.keys(u),d={resources:u,supportedLngs:l,fallbackLng:l[0],interpolation:{escapeValue:!1}};function h(){return i.a.use(o.e).use(r.a).init(d)}},,,,function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return _}));var i,r=n(15),a=n(55),o=n.n(a),s=n(10),c=n(70),u=n(32),l=n(81),d=n(20),h=n(163),p=n.n(h),f=n(344),m=n(113),v=n(213),g=n(345),b=n(346),y=n(135),E=n(18).getLogger(e),S=!1;function O(e){m.a.isBackendInitialized()||m.a.initBackend({callStatsID:e.callStatsID,callStatsSecret:e.callStatsSecret,userName:e.userName,aliasName:e.aliasName,applicationName:e.applicationName,getWiFiStatsMethod:e.getWiFiStatsMethod,confID:e.confID,siteID:e.siteID})||E.error("CallStats Backend initialization failed bad")}function _(e,t){this.rtpStatsMap=new Map,this.eventEmitter=new o.a,this.xmpp=e,this.options=t||{},this.callStatsIntegrationEnabled=this.options.callStatsID&&this.options.callStatsSecret&&this.options.enableCallStats&&!0!==_.disableThirdPartyRequests,this.callStatsIntegrationEnabled&&(this.callStatsApplicationLogsDisabled=this.options.callStatsApplicationLogsDisabled,d.a.isReactNative()?O(this.options):function(e){S||(p.a.loadScript(e.customScriptUrl||y.a,!0,!0,void 0,(function(){return O(e)})),S=!0)}(this.options),this.options.confID||E.warn('"confID" is not defined')),this.callsStatsInstances=new Map,_.instances.add(this)}_.init=function(e){_.audioLevelsEnabled=!e.disableAudioLevels,"number"===typeof e.pcStatsInterval&&(_.pcStatsInterval=e.pcStatsInterval),"number"===typeof e.audioLevelsInterval&&(_.audioLevelsInterval=e.audioLevelsInterval),"number"===typeof e.longTasksStatsInterval&&(_.longTasksStatsInterval=e.longTasksStatsInterval),_.disableThirdPartyRequests=e.disableThirdPartyRequests},_.audioLevelsEnabled=!1,_.audioLevelsInterval=200,_.pcStatsInterval=1e4,_.disableThirdPartyRequests=!1,_.analytics=f.a,Object.defineProperty(_,"instances",{get:function(){return i||(i=new Set),i}}),_.prototype.startRemoteStats=function(e){this.stopRemoteStats(e);try{var t=new b.a(e,_.audioLevelsInterval,_.pcStatsInterval,this.eventEmitter);t.start(_.audioLevelsEnabled),this.rtpStatsMap.set(e.id,t)}catch(n){E.error("Failed to start collecting remote statistics: ".concat(n))}},_.localStats=[],_.startLocalStats=function(e,t){if(_.audioLevelsEnabled){var n=new v.a(e,_.audioLevelsInterval,t);this.localStats.push(n),n.start()}},_.prototype.addAudioLevelListener=function(e){_.audioLevelsEnabled&&this.eventEmitter.on(l.a,e)},_.prototype.removeAudioLevelListener=function(e){_.audioLevelsEnabled&&this.eventEmitter.removeListener(l.a,e)},_.prototype.addBeforeDisposedListener=function(e){this.eventEmitter.on(l.b,e)},_.prototype.removeBeforeDisposedListener=function(e){this.eventEmitter.removeListener(l.b,e)},_.prototype.addConnectionStatsListener=function(e){this.eventEmitter.on(l.d,e)},_.prototype.removeConnectionStatsListener=function(e){this.eventEmitter.removeListener(l.d,e)},_.prototype.addByteSentStatsListener=function(e){this.eventEmitter.on(l.c,e)},_.prototype.removeByteSentStatsListener=function(e){this.eventEmitter.removeListener(l.c,e)},_.prototype.addLongTasksStatsListener=function(e){this.eventEmitter.on(l.e,e)},_.prototype.attachLongTasksStats=function(e){var t=this;d.a.supportsPerformanceObserver()?(this.performanceObserverStats=new g.a(this.eventEmitter,_.longTasksStatsInterval),e.on(s.CONFERENCE_JOINED,(function(){return t.performanceObserverStats.startObserver()})),e.on(s.CONFERENCE_LEFT,(function(){return t.performanceObserverStats.stopObserver()}))):E.warn("Performance observer for long tasks not supported by browser!")},_.prototype.getLongTasksStats=function(){return this.performanceObserverStats?this.performanceObserverStats.getLongTasksStats():null},_.prototype.removeLongTasksStatsListener=function(e){this.eventEmitter.removeListener(l.e,e)},_.prototype.setSpeakerList=function(e){for(var t=0,n=Array.from(this.rtpStatsMap.values());t<n.length;t++){var i=n[t];i.peerconnection.isP2P||i.setSpeakerList(e)}},_.prototype.dispose=function(){try{this.callsStatsInstances.size||this.eventEmitter.emit(l.b);var e,t=Object(r.a)(this.callsStatsInstances.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;this.stopCallStats(n.tpc)}}catch(s){t.e(s)}finally{t.f()}var i,a=Object(r.a)(this.rtpStatsMap.keys());try{for(a.s();!(i=a.n()).done;){var o=i.value;this._stopRemoteStats(o)}}catch(s){a.e(s)}finally{a.f()}this.eventEmitter&&this.eventEmitter.removeAllListeners()}finally{_.instances.delete(this)}},_.stopLocalStats=function(e){if(_.audioLevelsEnabled)for(var t=0;t<_.localStats.length;t++)if(_.localStats[t].stream===e){_.localStats.splice(t,1)[0].stop();break}},_.prototype._stopRemoteStats=function(e){var t=this.rtpStatsMap.get(e);t&&(t.stop(),this.rtpStatsMap.delete(e))},_.prototype.stopRemoteStats=function(e){this._stopRemoteStats(e.id)},_.prototype.startCallStats=function(e,t){if(this.callStatsIntegrationEnabled)if(this.callsStatsInstances.has(e.id))E.error("CallStats instance for ${tpc} exists already");else{E.info("Starting CallStats for ".concat(e,"..."));var n=new m.a(e,{confID:this.options.confID,remoteUserID:t});this.callsStatsInstances.set(e.id,n)}},_._getAllCallStatsInstances=function(){var e,t=new Set,n=Object(r.a)(_.instances);try{for(n.s();!(e=n.n()).done;){var i,a=e.value,o=Object(r.a)(a.callsStatsInstances.values());try{for(o.s();!(i=o.n()).done;){var s=i.value;t.add(s)}}catch(c){o.e(c)}finally{o.f()}}}catch(c){n.e(c)}finally{n.f()}return t},_.prototype.stopCallStats=function(e){var t=this.callsStatsInstances.get(e.id);t&&(1===this.callsStatsInstances.size&&this.eventEmitter.emit(l.b),this.callsStatsInstances.delete(e.id),t.sendTerminateEvent())},_.prototype.isCallstatsEnabled=function(){return this.callStatsIntegrationEnabled},_.prototype.sendConnectionResumeOrHoldEvent=function(e,t){var n=this.callsStatsInstances.get(e.id);n&&n.sendResumeOrHoldEvent(t)},_.prototype.sendIceConnectionFailedEvent=function(e){var t=this.callsStatsInstances.get(e.id);t&&t.sendIceConnectionFailedEvent()},_.prototype.sendMuteEvent=function(e,t,n){var i=e&&this.callsStatsInstances.get(e.id);m.a.sendMuteEvent(t,n,i)},_.prototype.sendScreenSharingEvent=function(e,t){var n,i=Object(r.a)(this.callsStatsInstances.values());try{for(i.s();!(n=i.n()).done;){n.value.sendScreenSharingEvent(e,t)}}catch(a){i.e(a)}finally{i.f()}},_.prototype.sendDominantSpeakerEvent=function(e){var t,n=Object(r.a)(this.callsStatsInstances.values());try{for(n.s();!(t=n.n()).done;){t.value.sendDominantSpeakerEvent()}}catch(i){n.e(i)}finally{n.f()}this.xmpp.sendDominantSpeakerEvent(e)},_.sendActiveDeviceListEvent=function(e){var t=_._getAllCallStatsInstances();if(t.size){var n,i=Object(r.a)(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;m.a.sendActiveDeviceListEvent(e,a)}}catch(o){i.e(o)}finally{i.f()}}else m.a.sendActiveDeviceListEvent(e,null)},_.prototype.associateStreamWithVideoTag=function(e,t,n,i,r,a){var o=this.callsStatsInstances.get(e.id);o&&o.associateStreamWithVideoTag(t,n,i,r,a)},_.sendGetUserMediaFailed=function(e){var t=e instanceof c.a?function(e){var t=new Error;return t.stack=e.stack,t.name=(e.name||"Unknown error")+(e.gum&&e.gum.error&&e.gum.error.name?" - ".concat(e.gum.error.name):""),t.constraintName=e.gum&&e.gum.constraints?JSON.stringify(e.gum.constraints):"",t.message=e.message,t}(e):e,n=_._getAllCallStatsInstances();if(n.size){var i,a=Object(r.a)(n);try{for(a.s();!(i=a.n()).done;){var o=i.value;m.a.sendGetUserMediaFailed(t,o)}}catch(s){a.e(s)}finally{a.f()}}else m.a.sendGetUserMediaFailed(t,null)},_.prototype.sendCreateOfferFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendCreateOfferFailed(e)},_.prototype.sendCreateAnswerFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendCreateAnswerFailed(e)},_.prototype.sendSetLocalDescFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendSetLocalDescFailed(e)},_.prototype.sendSetRemoteDescFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendSetRemoteDescFailed(e)},_.prototype.sendAddIceCandidateFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendAddIceCandidateFailed(e)},_.sendLog=function(e){var t,n=new Set,i=Object(r.a)(_.instances);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.callStatsApplicationLogsDisabled)return;a.callsStatsInstances.size&&n.add(a.callsStatsInstances.values().next().value)}}catch(u){i.e(u)}finally{i.f()}if(n.size){var o,s=Object(r.a)(n);try{for(s.s();!(o=s.n()).done;){var c=o.value;m.a.sendApplicationLog(e,c)}}catch(u){s.e(u)}finally{s.f()}}else m.a.sendApplicationLog(e,null)},_.prototype.sendFeedback=function(e,t){return _.analytics.sendEvent(u.n,{rating:e,comment:t}),m.a.sendFeedback(this.options.confID,e,t)},_.LOCAL_JID=n(490).LOCAL_JID,_.reportGlobalError=function(e){e instanceof c.a&&e.gum?_.sendGetUserMediaFailed(e):_.sendLog(e)},_.sendAnalyticsAndLog=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e?(t="object"===typeof e?e:{name:e,properties:n},E.log(JSON.stringify(t)),this.analytics.sendEvent(e,n)):E.warn("No event or event name given.")},_.sendAnalytics=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.analytics.sendEvent(e,t)}}).call(this,"/index.js")},,function(e,t,n){"use strict";var i,r,a,o,s,c,u,l,d=n(24),h=n(6),p=n(8),f=n(12),m=(n(83),n(4)),v=(i=function(){function e(){Object(h.a)(this,e),this.defaultBackgroundFill=[223,219,229],this.defaultBackgroundColor=[185,178,196],Object(d.a)(this,"roomProps",r,this),Object(d.a)(this,"password",a,this),Object(d.a)(this,"newPassword",o,this),Object(d.a)(this,"passMatched",s,this),Object(d.a)(this,"backgroundFill",c,this),Object(d.a)(this,"backgroundColor",u,this),Object(d.a)(this,"backgroundLeftFill",l,this),Object(m.g)(this)}return Object(p.a)(e,[{key:"onUpdateProp",value:function(e,t){switch(e){case"backgroundFill":this.backgroundFill=JSON.parse(t);break;case"backgroundColor":this.backgroundColor=JSON.parse(t);break;case"backgroundLeftFill":this.backgroundLeftFill=JSON.parse(t)}}}]),e}(),r=Object(f.a)(i.prototype,"roomProps",[m.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Map}}),a=Object(f.a)(i.prototype,"password",[m.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),o=Object(f.a)(i.prototype,"newPassword",[m.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),s=Object(f.a)(i.prototype,"passMatched",[m.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),c=Object(f.a)(i.prototype,"backgroundFill",[m.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[255,255,255]}}),u=Object(f.a)(i.prototype,"backgroundColor",[m.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[255,255,255]}}),l=Object(f.a)(i.prototype,"backgroundLeftFill",[m.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[255,204,255]}}),Object(f.a)(i.prototype,"onUpdateProp",[m.b],Object.getOwnPropertyDescriptor(i.prototype,"onUpdateProp"),i.prototype),i);t.a=new v},function(e,t){e.exports={CREATE_ANSWER_FAILED:"rtc.create_answer_failed",CREATE_OFFER_FAILED:"rtc.create_offer_failed",DATA_CHANNEL_OPEN:"rtc.data_channel_open",ENDPOINT_CONN_STATUS_CHANGED:"rtc.endpoint_conn_status_changed",DOMINANT_SPEAKER_CHANGED:"rtc.dominant_speaker_changed",LASTN_ENDPOINT_CHANGED:"rtc.lastn_endpoint_changed",PERCEPTIBLE_CHANGED:"rtc.perceptibles_changed",PERMISSIONS_CHANGED:"rtc.permissions_changed",SENDER_VIDEO_CONSTRAINTS_CHANGED:"rtc.sender_video_constraints_changed",LASTN_VALUE_CHANGED:"rtc.lastn_value_changed",LOCAL_TRACK_SSRC_UPDATED:"rtc.local_track_ssrc_updated",LOCAL_TRACK_MAX_ENABLED_RESOLUTION_CHANGED:"rtc.local_track_max_enabled_resolution_changed",TRACK_ATTACHED:"rtc.track_attached",REMOTE_TRACK_ADDED:"rtc.remote_track_added",REMOTE_TRACK_MUTE:"rtc.remote_track_mute",REMOTE_TRACK_REMOVED:"rtc.remote_track_removed",REMOTE_TRACK_UNMUTE:"rtc.remote_track_unmute",SET_LOCAL_DESCRIPTION_FAILED:"rtc.set_local_description_failed",SET_REMOTE_DESCRIPTION_FAILED:"rtc.set_remote_description_failed",AUDIO_OUTPUT_DEVICE_CHANGED:"rtc.audio_output_device_changed",DEVICE_LIST_CHANGED:"rtc.device_list_changed",DEVICE_LIST_WILL_CHANGE:"rtc.device_list_will_change",DEVICE_LIST_AVAILABLE:"rtc.device_list_available",ENDPOINT_MESSAGE_RECEIVED:"rtc.endpoint_message_received",ENDPOINT_STATS_RECEIVED:"rtc.endpoint_stats_received",LOCAL_UFRAG_CHANGED:"rtc.local_ufrag_changed",REMOTE_UFRAG_CHANGED:"rtc.remote_ufrag_changed"}},function(e,t,n){"use strict";var i=n(90);n.d(t,"a",(function(){return i.a}));n(157);var r=n(158);n.d(t,"b",(function(){return r.a}))},,function(e,t,n){"use strict";n.d(t,"t",(function(){return r})),n.d(t,"u",(function(){return a})),n.d(t,"v",(function(){return o})),n.d(t,"w",(function(){return s})),n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return l})),n.d(t,"d",(function(){return d})),n.d(t,"e",(function(){return h})),n.d(t,"f",(function(){return p})),n.d(t,"g",(function(){return f})),n.d(t,"h",(function(){return m})),n.d(t,"i",(function(){return v})),n.d(t,"j",(function(){return g})),n.d(t,"k",(function(){return b})),n.d(t,"l",(function(){return y})),n.d(t,"m",(function(){return E})),n.d(t,"n",(function(){return S})),n.d(t,"o",(function(){return O})),n.d(t,"p",(function(){return _})),n.d(t,"q",(function(){return C})),n.d(t,"r",(function(){return T})),n.d(t,"s",(function(){return j})),n.d(t,"z",(function(){return A})),n.d(t,"B",(function(){return k})),n.d(t,"A",(function(){return R})),n.d(t,"C",(function(){return I})),n.d(t,"D",(function(){return P})),n.d(t,"E",(function(){return w})),n.d(t,"F",(function(){return N})),n.d(t,"J",(function(){return D})),n.d(t,"G",(function(){return M})),n.d(t,"H",(function(){return L})),n.d(t,"I",(function(){return x})),n.d(t,"K",(function(){return F})),n.d(t,"L",(function(){return U})),n.d(t,"M",(function(){return V})),n.d(t,"x",(function(){return B})),n.d(t,"y",(function(){return J})),n.d(t,"N",(function(){return H}));var i=n(7),r="operational",a="page",o="track",s="ui",c="restart",u="session-accept.timeout",l="session-initiate.received",d="session-initiate.timeout",h="terminate",p="transport-replace.received",f="transport-replace.success",m="decline",v="established",g="failed",b="switch.to.jvb",y="available.device",E="connection.disconnected",S="feedback",O="ice.duration",_="ice.establishment.duration.diff",C="ice.state.changed",T="track.no-bytes-sent",j="track.unmuted",A=function(){var e="bridge.down";return{action:e,actionSubject:e,type:r}},k=function(e,t,n){return{type:r,action:"connection.failed",attributes:Object(i.a)({error_type:e,error_message:t},n)}};function R(e,t){return{action:e,attributes:t,source:"conference",type:r}}var I=function(e,t){var n="connection.stage.reached";return{action:n,actionSubject:e,attributes:t,source:n,type:r}},P=function(e,t,n){return{attributes:{participant_id:e,region:t,rtt:n},name:"e2e_rtt",type:r}},w=function(){var e="focus.left";return{action:e,actionSubject:e,type:r}},N=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{type:r,source:"get.user.media",action:e,attributes:t}},D=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="duration";return{type:r,source:"peer.conn.status",action:t,attributes:e}},M=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{type:r,action:e,source:"jingle",attributes:t}},L=function(e,t){return{attributes:{media_type:e,value:t},action:"track.no.data.from.source",type:r}},x=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{type:r,action:e,source:"p2p",attributes:t}},F=function(e){return{type:r,action:"remotely.muted",mediaType:e}},U=function(e){return{type:r,action:"rtp.stats",attributes:e}},V=function(e){return{type:r,action:"transport.stats",attributes:e}};function B(e,t,n){return{type:r,action:"audio.output.problem",attributes:{userID:e,localAudioLevels:t,remoteAudioLevels:n}}}var J=function(e,t){return{type:r,action:"bridge-channel.error",attributes:{code:e,reason:t}}},H=function(e){return I("ttfm",e)}},function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"d",(function(){return u})),n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return d}));var i=n(7),r=Object(i.a)(Object(i.a)({},{PARTICIPANT_AFK:"p_afk",PARTICIPANT_TRACKSTATES:"p_trackSt"}),{},{PARTICIPANT_INFO:"p_info",MAIN_SCREEN_CARRIER:"main_screen_carrier",MY_CONTENT:"my_content"}),a={PARTICIPANT_TRACKLIMITS:"m_track_limits",YARN_PHONE:"YARN_PHONE",CHAT_MESSAGE:"m_chat",CALL_REMOTE:"call_remote",MUTE_VIDEO:"m_mute_video",MUTE_AUDIO:"m_mute_audio",RELOAD_BROWSER:"m_reload",KICK:"m_kick"},o=(new Set(Object.values(a)),{CONTENT_UPDATE_REQUEST:"c_update",CONTENT_INFO_UPDATE:"c_info_update"}),s=new Set(Object.values(o)),c={LEFT_CONTENT_REMOVE_REQUEST:"left_c_remove",CONTENT_REMOVE_REQUEST:"c_remove",PARTICIPANT_OUT:"p_out",MOUSE_OUT:"m_out",CONTENT_OUT:"c_out"},u=new Set(Object.values(c)),l={CONTENT_UPDATE_REQUEST_BY_ID:"c_update_by_id",REQUEST_ALL:"req_all",REQUEST_RANGE:"req_range",REQUEST_PARTICIPANT_STATES:"req_p_state"},d=Object(i.a)(Object(i.a)(Object(i.a)(Object(i.a)(Object(i.a)(Object(i.a)(Object(i.a)({},o),c),a),r),{PARTICIPANT_POSE:"mp",PARTICIPANT_MOUSE:"mm",PARTICIPANT_ON_STAGE:"p_onStage"}),l),{},{PARTICIPANT_LEFT:"m_participant_left",ROOM_PROP:"room_prop",REQUEST_TO:"req_to",FRAGMENT_HEAD:"frag_head",FRAGMENT_CONTENT:"frag_cont"})},function(e,t,n){"use strict";(function(e){var i=n(69),r=n(15),a=n(18),o=n(71),s=n.n(o),c=n(39),u=n.n(c),l=n(20),d=n(120),h=n.n(d),p=Object(a.getLogger)(e),f={filterSpecialChars:function(e){return e?e.replace(/[\\\/\{,\}\+]/g,""):e},iceparams:function(e,t){var n,i,r=null;return(i=f.findLine(e,"a=ice-ufrag:",t))&&(n=f.findLine(e,"a=ice-pwd:",t))&&(r={ufrag:f.parseICEUfrag(i),pwd:f.parseICEPwd(n)}),r},parseICEUfrag:function(e){return e.substring(12)},buildICEUfrag:function(e){return"a=ice-ufrag:".concat(e)},parseICEPwd:function(e){return e.substring(10)},buildICEPwd:function(e){return"a=ice-pwd:".concat(e)},parseMID:function(e){return e.substring(6)},parseMLine:function(e){var t={},n=e.substring(2).split(" ");return t.media=n.shift(),t.port=n.shift(),t.proto=n.shift(),""===n[n.length-1]&&n.pop(),t.fmt=n,t},buildMLine:function(e){return"m=".concat(e.media," ").concat(e.port," ").concat(e.proto," ").concat(e.fmt.join(" "))},parseRTPMap:function(e){var t={},n=e.substring(9).split(" ");return t.id=n.shift(),n=n[0].split("/"),t.name=n.shift(),t.clockrate=n.shift(),t.channels=n.length?n.shift():"1",t},parseSCTPMap:function(e){var t=e.substring(10).split(" ");return[t[0],t[1],t.length>2?t[2]:null]},buildRTPMap:function(e){var t="a=rtpmap:".concat(e.getAttribute("id")," ").concat(e.getAttribute("name"),"/").concat(e.getAttribute("clockrate"));return e.getAttribute("channels")&&"1"!==e.getAttribute("channels")&&(t+="/".concat(e.getAttribute("channels"))),t},parseCrypto:function(e){var t={},n=e.substring(9).split(" ");return t.tag=n.shift(),t["crypto-suite"]=n.shift(),t["key-params"]=n.shift(),n.length&&(t["session-params"]=n.join(" ")),t},parseFingerprint:function(e){var t={},n=e.substring(14).split(" ");return t.hash=n.shift(),t.fingerprint=n.shift(),t},parseFmtp:function(e){var t=[],n=e.split(" ");n.shift(),n=n.join(" ").split(";");for(var i=0;i<n.length;i++){for(var r=n[i].split("=")[0];r.length&&" "===r[0];)r=r.substring(1);var a=n[i].split("=")[1];r&&a?t.push({name:r,value:a}):r&&t.push({name:"",value:r})}return t},parseICECandidate:function(e){var t={},n=e.split(" ");t.foundation=n[0].substring(12),t.component=n[1],t.protocol=n[2].toLowerCase(),t.priority=n[3],t.ip=n[4],t.port=n[5],t.type=n[7],t.generation=0;for(var i=8;i<n.length;i+=2)switch(n[i]){case"raddr":t["rel-addr"]=n[i+1];break;case"rport":t["rel-port"]=n[i+1];break;case"generation":t.generation=n[i+1];break;case"tcptype":t.tcptype=n[i+1];break;default:p.log('parseICECandidate not translating "'.concat(n[i],'" = "').concat(n[i+1],'"'))}return t.network="1",t.id=Math.random().toString(36).substr(2,10),t},buildICECandidate:function(e){var t=["a=candidate:".concat(e.foundation),e.component,e.protocol,e.priority,e.ip,e.port,"typ",e.type].join(" ");switch(t+=" ",e.type){case"srflx":case"prflx":case"relay":e.hasOwnAttribute("rel-addr")&&e.hasOwnAttribute("rel-port")&&(t+="raddr",t+=" ",t+=e["rel-addr"],t+=" ",t+="rport",t+=" ",t+=e["rel-port"],t+=" ")}return e.hasOwnAttribute("tcptype")&&(t+="tcptype",t+=" ",t+=e.tcptype,t+=" "),t+="generation",t+=" ",t+=e.hasOwnAttribute("generation")?e.generation:"0"},parseSSRC:function(e){for(var t=new Map,n=e.split("\r\n"),i=0;i<n.length;i++)if("a=ssrc:"===n[i].substring(0,7)){var r=n[i].split("a=ssrc:")[1].split(" ")[0];t.get(r)||t.set(r,[]),t.get(r).push(n[i])}return t},parseRTCPFB:function(e){var t=e.substr(10).split(" "),n={};return n.pt=t.shift(),n.type=t.shift(),n.params=t,n},parseExtmap:function(e){var t=e.substr(9).split(" "),n={};return n.value=t.shift(),-1===n.value.indexOf("/")?n.direction="both":(n.direction=n.value.substr(n.value.indexOf("/")+1),n.value=n.value.substr(0,n.value.indexOf("/"))),n.uri=t.shift(),n.params=t,n},findLine:function(e,t,n){for(var i=e.split("\r\n"),r=0;r<i.length;r++)if(i[r].substring(0,t.length)===t)return i[r];if(!n)return!1;i=n.split("\r\n");for(var a=0;a<i.length;a++)if(i[a].substring(0,t.length)===t)return i[a];return!1},findLines:function(e,t,n){for(var i=e.split("\r\n"),r=[],a=0;a<i.length;a++)i[a].substring(0,t.length)===t&&r.push(i[a]);if(r.length||!n)return r;i=n.split("\r\n");for(var o=0;o<i.length;o++)i[o].substring(0,t.length)===t&&r.push(i[o]);return r},candidateToJingle:function(e){if(0===e.indexOf("candidate:"))e="a=".concat(e);else if("a=candidate:"!==e.substring(0,12))return p.log("parseCandidate called with a line that is not a candidate line"),p.log(e),null;"\r\n"===e.substring(e.length-2)&&(e=e.substring(0,e.length-2));var t={},n=e.split(" ");if("typ"!==n[6])return p.log("did not find typ in the right place"),p.log(e),null;t.foundation=n[0].substring(12),t.component=n[1],t.protocol=n[2].toLowerCase(),t.priority=n[3],t.ip=n[4],t.port=n[5],t.type=n[7],t.generation="0";for(var i=8;i<n.length;i+=2)switch(n[i]){case"raddr":t["rel-addr"]=n[i+1];break;case"rport":t["rel-port"]=n[i+1];break;case"generation":t.generation=n[i+1];break;case"tcptype":t.tcptype=n[i+1];break;default:p.log('not translating "'.concat(n[i],'" = "').concat(n[i+1],'"'))}return t.network="1",t.id=Math.random().toString(36).substr(2,10),t},candidateFromJingle:function(e){var t="a=candidate:";t+=e.getAttribute("foundation"),t+=" ",t+=e.getAttribute("component"),t+=" ";var n=e.getAttribute("protocol");switch(l.a.isFirefox()&&"ssltcp"===n.toLowerCase()&&(n="tcp"),t+=n,t+=" ",t+=e.getAttribute("priority"),t+=" ",t+=e.getAttribute("ip"),t+=" ",t+=e.getAttribute("port"),t+=" ",t+="typ",t+=" ".concat(e.getAttribute("type")),t+=" ",e.getAttribute("type")){case"srflx":case"prflx":case"relay":e.getAttribute("rel-addr")&&e.getAttribute("rel-port")&&(t+="raddr",t+=" ",t+=e.getAttribute("rel-addr"),t+=" ",t+="rport",t+=" ",t+=e.getAttribute("rel-port"),t+=" ")}return"tcp"===n.toLowerCase()&&(t+="tcptype",t+=" ",t+=e.getAttribute("tcptype"),t+=" "),t+="generation",t+=" ",t+=e.getAttribute("generation")||"0","".concat(t,"\r\n")},parsePrimaryVideoSsrc:function(e){var t=e.ssrcs.map((function(e){return e.id})).filter((function(e,t,n){return n.indexOf(e)===t})).length,n=e.ssrcGroups&&e.ssrcGroups.length||0;if(!(t>1&&0===n)){var i=null;if(1===t)i=e.ssrcs[0].id;else if(2===t){var r=e.ssrcGroups.find((function(e){return"FID"===e.semantics}));r&&(i=r.ssrcs.split(" ")[0])}else if(t>=3){var a=e.ssrcGroups.find((function(e){return"SIM"===e.semantics}));a&&(i=a.ssrcs.split(" ")[0])}return i}},generateSsrc:function(){return h.a.randomInt(1,4294967295)},getSsrcAttribute:function(e,t,n){for(var i=0;i<e.ssrcs.length;++i){var r=e.ssrcs[i];if(r.id===t&&r.attribute===n)return r.value}},parseGroupSsrcs:function(e){return e.ssrcs.split(" ").map((function(e){return parseInt(e,10)}))},getMedia:function(e,t){return e.media.find((function(e){return e.type===t}))},getUfrag:function(e){var t=e.split("\n").filter((function(e){return e.startsWith("a=ice-ufrag:")}));if(t.length>0)return t[0].substr("a=ice-ufrag:".length)},preferCodec:function(e,t){if(e&&t){var n=e.rtp.filter((function(e){return e.codec&&e.codec.toLowerCase()===t.toLowerCase()})).map((function(e){return e.payload}));if(n){var i,a=e.payloads.toString().split(" ").map((function(e){return parseInt(e,10)})),o=Object(r.a)(n.reverse());try{for(o.s();!(i=o.n()).done;){var s=i.value,c=a.indexOf(s);a.splice(c,1),a.unshift(s)}}catch(u){o.e(u)}finally{o.f()}e.payloads=a.join(" ")}}},stripCodec:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e&&t){var a,o=[],c=[],l=t.toLowerCase()===s.a.H264&&n,d=Object(r.a)(e.rtp);try{for(d.s();!(a=d.n()).done;){var h=a.value;h.codec&&h.codec.toLowerCase()===t.toLowerCase()&&(l?o.push(h.payload):c.push(h.payload))}}catch(b){d.e(b)}finally{d.f()}if(l&&(c=e.fmtp.filter((function(e){return o.indexOf(e.payload)>-1&&e.config.includes("profile-level-id=64")})).map((function(e){return e.payload}))),c.length>0){var p,f=c.map((function(e){return"apt=".concat(e)})),m=e.fmtp.filter((function(e){return-1!==f.indexOf(e.config)}));(p=c).push.apply(p,Object(i.a)(m.map((function(e){return e.payload}))));var v=e.payloads.toString().split(" ").map(Number),g=v.filter((function(e){return-1===c.indexOf(e)}));0===g.length?(e.port=0,e.direction=u.a.INACTIVE,e.payloads="*"):e.payloads=g.join(" "),e.rtp=e.rtp.filter((function(e){return-1!==g.indexOf(e.payload)})),e.fmtp=e.fmtp.filter((function(e){return-1!==g.indexOf(e.payload)})),e.rtcpFb&&(e.rtcpFb=e.rtcpFb.filter((function(e){return-1!==g.indexOf(e.payload)})))}}}};t.a=f}).call(this,"/index.js")},,,,,function(e,t){e.exports={INACTIVE:"inactive",RECVONLY:"recvonly",SENDONLY:"sendonly",SENDRECV:"sendrecv"}},,function(e,t,n){"use strict";n.d(t,"r",(function(){return m})),n.d(t,"b",(function(){return b})),n.d(t,"c",(function(){return E})),n.d(t,"g",(function(){return S})),n.d(t,"d",(function(){return O})),n.d(t,"e",(function(){return _})),n.d(t,"f",(function(){return T})),n.d(t,"h",(function(){return j})),n.d(t,"i",(function(){return k})),n.d(t,"k",(function(){return R})),n.d(t,"j",(function(){return P})),n.d(t,"a",(function(){return N})),n.d(t,"p",(function(){return D})),n.d(t,"l",(function(){return M})),n.d(t,"n",(function(){return L})),n.d(t,"o",(function(){return x})),n.d(t,"m",(function(){return F})),n.d(t,"t",(function(){return U})),n.d(t,"s",(function(){return V})),n.d(t,"q",(function(){return B}));var i=n(15),r=n(6),a=n(212),o=n(181),s=n(54),c=n(3),u=n(247),l=n(45),d=n.n(l),h=n(11),p=n(17),f=Object.assign({},u.b,{name:"",ownerName:"",color:[],textColor:[],type:"",url:"",size:[0,0],originalSize:[0,0],id:"",zorder:0,pinned:!1,shareType:""});function m(e){return e}var v,g=function e(){Object(r.a)(this,e),this.name=void 0,this.ownerName=void 0,this.color=void 0,this.textColor=void 0,this.type=void 0,this.url=void 0,this.id=void 0,this.zorder=void 0,this.pinned=void 0,this.pose=void 0,this.size=void 0,this.originalSize=void 0,this.noFrame=void 0,this.opacity=void 0,this.proximity=void 0,this.shareType=void 0,Object.assign(this,d.a.cloneDeep(f))};function b(){var e=new g;return e.ownerName=h.a.local.information.name,e.color=h.a.local.information.color,e.textColor=h.a.local.information.textColor,e.zorder=Date.now(),e}function y(e,t,n){e.type="pdf",e.url=t,e.pose.position[0]=n.mouseOnMap[0],e.pose.position[1]=n.mouseOnMap[1],e.size[0]=500,e.size[1]=1.41421356*e.size[0]}function E(e,t){return new Promise((function(n,r){var o=b(),s=new URL(e);if("youtu.be"===s.hostname||"youtube.com"===s.hostname||"www.youtube.com"===s.hostname){var u=s.search.slice(1).split("&"),l=new Map(u.map((function(e){return e.split("=")})));"youtu.be"===s.hostname&&l.set("v",s.pathname.slice(1)),o.url="";var d,h=Object(i.a)(l);try{for(h.s();!(d=h.n()).done;){var f=d.value;""===o.url?o.url="".concat(f[0],"=").concat(f[1]):o.url="".concat(o.url,"&").concat(f[0],"=").concat(f[1])}}catch(g){h.e(g)}finally{h.f()}o.type="youtube",o.pose.position[0]=t.mouseOnMap[0],o.pose.position[1]=t.mouseOnMap[1],o.size[0]=640,o.size[1]=380}else if("drive.google.com"===s.hostname||"docs.google.com"===s.hostname){o.type="gdrive";var m=s.pathname.slice(s.pathname.indexOf("/d/")+3),v=m.slice(0,m.indexOf("/"));o.url="id=".concat(v),o.pose.position[0]=t.mouseOnMap[0],o.pose.position[1]=t.mouseOnMap[1],o.size[0]=600,o.size[1]=800}else"wbo.ophir.dev"===s.hostname?(o.type="whiteboard",o.url=e,o.pose.position[0]=t.mouseOnMap[0],o.pose.position[1]=t.mouseOnMap[1],o.size[0]=600,o.size[1]=700):".pdf"===s.pathname.substring(s.pathname.length-4)||".PDF"===s.pathname.substring(s.pathname.length-4)?y(o,e,t):Object(c.n)(Object(a.a)(e)).then((function(i){"application/pdf"===i&&(y(o,e,t),n(o))})).finally((function(){o.type||(o.type="iframe",o.url=e,o.pose.position[0]=t.mouseOnMap[0],o.pose.position[1]=t.mouseOnMap[1],o.size[0]=600,o.size[1]=800,n(o))}));o.type&&(n(o),Object(p.a)("".concat(o.type," created url = ").concat(o.url)))}))}function S(e,t){var n=b();n.type="text";var i={messages:[{message:e,pid:h.a.localId,name:h.a.local.information.name,color:h.a.local.information.color,textColor:h.a.local.information.textColor,time:Date.now()}],scroll:[0,0]};n.url=JSON.stringify(i),n.pose.position[0]=t.mouseOnMap[0],n.pose.position[1]=t.mouseOnMap[1];var r=Math.ceil(Math.sqrt(e.length));return n.size[0]=Math.max(20*r,200),n.size[1]=Math.max(25*r,r?25:75),n}function O(e,t,n,i){return new Promise((function(r,a){Object(o.b)(e).then((function(e){_(e,t,n,i).then(r)})).catch(a)}))}function _(e,t,n,i){return new Promise((function(r,a){Object(o.a)(e).then((function(a){var o=b();console.log(" TYPE ",i),o.type="img","image"===i?(o.shareType="img",o.noFrame=!1):"zoneimage"===i&&(o.shareType="zoneimg",o.noFrame=!0),o.url=e;a[0]>a[1]?a[0]:a[1];o.size=[a[0],a[1]],o.originalSize=[a[0],a[1]];for(var s=0;s<o.pose.position.length;s+=1)o.pose.position[s]=n?t.mouseOnMap[s]+n[s]:t.mouseOnMap[s]-.5*o.size[s];r(o)}))}))}function C(e){}function T(e,t,n){return console.error("createContentOfPdf called."),new Promise((function(e,t){if(gapi){gapi.client.init({apiKey:"AIzaSyCE4B2cKycH0fVmBznwfr1ynnNf2qNEU9M",clientId:"188672642721-3f8u1671ecugbl2ukhjmb18nv283upm0.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/drive.appdata",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]}).then((function(){console.log("Before getAuthInstance"),v=gapi.auth2.getAuthInstance(),console.log("Before listen updateSigninStatus"),v.isSignedIn.listen(C)}),(function(e){console.log("gapi.client.init failed:",e)}))}}))}function j(e,t,n){var i=b();i.type=n,i.url="",i.pose.position[0]=t.mouseOnMap[0],i.pose.position[1]=t.mouseOnMap[1];var r=e.find((function(e){return"video"===e.getType()})),a=null===r||void 0===r?void 0:r.getTrack().getSettings();return i.originalSize=a?[a.width||0,a.height||0]:[0,0],i.size=[(i.originalSize[0]||640)/2,(i.originalSize[1]||360)/2],i}var A=Object(c.h)({zorder:!0,name:!0,ownerName:!0,color:!0,textColor:!0,type:!0,url:!0,pose:!0,size:!0,originalSize:!0,pinned:!0,noFrame:!0,opacity:!0,proximity:!0,shareType:!0});function k(e){return A(e)}function R(e){return e.map(k)}var I=Object(c.h)({zorder:!0,name:!0,ownerName:!0,color:!0,textColor:!0,type:!0,url:!0,pose:!0,size:!0,originalSize:!0,pinned:!0,noFrame:!0,opacity:!0,id:!0,proximity:!0,shareType:!0});function P(e){return e.map(I)}function w(e){var t=document.createElement("textarea");t.value=e,t.selectionStart=0,t.selectionEnd=t.value.length;var n=t.style;n.position="fixed",n.left="-100%",document.body.appendChild(t),t.focus();var i=document.execCommand("copy");return t.blur(),document.body.removeChild(t),i}function N(e){if("text"===e.type){var t=JSON.parse(e.url);w(t.messages.length?t.messages.map((function(e){return e.message})).reduce((function(e,t){return e?e+"\n":""+t})):"")}else if("youtube"===e.type){var n=e.url.split("&").filter((function(e){var t=e.split("=")[0];return"v"===t||"list"===t})),i=n.length?n.reduce((function(e,t){return(e?e+"&":"")+t})):"";w("https://www.youtube.com/watch?".concat(i))}else if("gdrive"===e.type){w(M(!0,L(e.url)))}else w(e.url)}function D(e){return!e||!("application/vnd.google-apps.presentation"===e||"application/vnd.google-apps.spreadsheet"===e||"image"===e.slice(0,5)||"video"===e.slice(0,5)||"audio"===e.slice(0,5))}function M(e,t){var n=t.get("id"),i=t.get("mimeType");i=i||"";var r="application/vnd.google-apps.",a="https://drive.google.com/file/d/".concat(n,"/preview");if(e&&i.substr(0,r.length)===r){var o=i.substr(r.length);"failed"!==o&&("spreadsheet"===o&&(o="spreadsheets"),a="https://docs.google.com/".concat(o,"/d/").concat(n,"/edit"))}return a}function L(e){var t=e.indexOf("?"),n=t>=0?e.substr(t):e;return new Map(n.split("&").map((function(e){return e.split("=")})))}function x(e){var t="";return e.forEach((function(e,n){t="".concat(t).concat(t?"&":"").concat(n,"=").concat(e)})),t}function F(e){return new Promise((function(t,n){gapi?(gapi.client.setApiKey("AIzaSyCE4B2cKycH0fVmBznwfr1ynnNf2qNEU9M"),gapi.client.load("drive","v3",(function(){gapi.client.drive.files.get({fileId:e,fields:"mimeType,name"}).then((function(e){var n=JSON.parse(e.body);t({mimeType:n.mimeType,name:n.name})})).catch((function(e){console.debug("GAPI error",e),n(e)}))}))):n("gapi is not loaded")}))}function U(e){if(Object(s.h)(e)){var t=p.b.sorted.findIndex((function(e){return e.zorder>s.b}));if(t<0&&(t=p.b.sorted.length),(t-=1)>=0){var n=p.b.sorted[t].zorder+1;e.zorder=n<=s.b?n:s.b}}else e.zorder=Math.floor(Date.now()/s.c)}function V(e){if(Object(s.h)(e)){var t=p.b.sorted[0];t!==e&&(e.zorder=t.zorder-1)}else{var n=p.b.sorted.find((function(e){return e.zorder>s.b}));n?e.zorder=n.zorder-1:U(e)}}function B(e,t){if(t){var n=s.b-(Math.floor(Date.now()/s.c)-e.zorder);n<0&&(n=e.zorder%s.b),e.zorder=n}else e.zorder=e.zorder+s.b}},function(e,t,n){"use strict";(function(e){var i=n(73),r=n(6),a=n(8),o=n(36),s=n(35),c=n(55),u=n.n(c),l=n(18),d=n(136),h=n.n(d),p=n(70),f=n(52),m=n(151),v=n.n(m),g=n(29),b=n.n(g),y=n(217),E=n.n(y),S=n(50),O=n.n(S),_=n(32),C=n(20),T=n(34),j=n(26),A=n(43),k=n.n(A),R=n(72),I=n(150),P=Object(l.getLogger)(e);C.a.usesAdapter()&&n(648);var w,N=new u.a,D={video:{height:{ideal:720,max:720,min:180},width:{ideal:1280,max:1280,min:320}}},M="default",L=!1,x=!1,F=!1,U=!1,V=!1,B=null,J=document.createElement("audio"),H="undefined"!==typeof J.setSinkId,z=[];function G(){}function K(e,t){var n=Boolean(t)&&t.getAudioTracks().length>0,i=Boolean(t)&&t.getVideoTracks().length>0,r={};-1!==e.indexOf("video")&&(r.video=i),-1!==e.indexOf("audio")&&(r.audio=n),N.emit(b.a.PERMISSIONS_CHANGED,r)}function Q(e){var t=e.filter((function(e){return"audioinput"===e.kind})).length,n=e.filter((function(e){return"audiooutput"===e.kind})).length,i=e.filter((function(e){return"videoinput"===e.kind})).length,r=e.filter((function(e){return"videooutput"===e.kind})).length;e.forEach((function(e){var a={audio_input_device_count:t,audio_output_device_count:n,video_input_device_count:i,video_output_device_count:r,device_id:e.deviceId,device_group_id:e.groupId,device_kind:e.kind,device_label:e.label};j.a.sendAnalytics(_.l,a)}))}function q(e){(function(e){return e.length!==z.length||e.map(t).sort().join("")!==z.map(t).sort().join("");function t(e){return JSON.stringify({kind:e.kind,deviceId:e.deviceId,groupId:e.groupId,label:e.label,facing:e.facing})}})(e)&&(z=e.slice(0),P.info("list of media devices has changed:",z),Q(z),N.emit(b.a.DEVICE_LIST_WILL_CHANGE,z),N.emit(b.a.DEVICE_LIST_CHANGED,z))}var W=new(function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(){return Object(r.a)(this,n),t.call(this,N)}return Object(a.a)(n,[{key:"init",value:function(){var e,t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"boolean"===typeof n.disableAEC&&(F=n.disableAEC,P.info("Disable AEC: ".concat(F))),"boolean"===typeof n.disableNS&&(U=n.disableNS,P.info("Disable NS: ".concat(U))),"boolean"===typeof n.disableAP&&(x=n.disableAP,P.info("Disable AP: ".concat(x))),"boolean"===typeof n.disableAGC&&(V=n.disableAGC,P.info("Disable AGC: ".concat(V))),"boolean"===typeof(null===(e=n.audioQuality)||void 0===e?void 0:e.stereo)&&(B=n.audioQuality.stereo,P.info("Stereo: ".concat(B))),window.clearInterval(w),w=void 0,C.a.isReactNative()?(this.RTCPeerConnectionType=RTCPeerConnection,this.attachMediaStream=void 0,this.getStreamID=function(e){var t=e.id;return"number"===typeof t?t:T.a.filterSpecialChars(t)},this.getTrackID=function(e){return e.id}):(this.RTCPeerConnectionType=RTCPeerConnection,this.attachMediaStream=Y((function(e,t){e&&(e.srcObject=t)})),this.getStreamID=function(e){return e.id},this.getTrackID=function(e){return e.id}),this.pcConstraints=C.a.isChromiumBased()||C.a.isReactNative()?{optional:[{googScreencastMinBitrate:100},{googCpuOveruseDetection:!0}]}:{},I.b.init(n),this.isDeviceListAvailable()&&this.enumerateDevices((function(e){z=e.slice(0),P.debug("Available devices: ",z),Q(z),N.emit(b.a.DEVICE_LIST_AVAILABLE,z),C.a.supportsDeviceChangeEvent()?navigator.mediaDevices.addEventListener("devicechange",(function(){return t.enumerateDevices(G)})):w=window.setInterval((function(){return t.enumerateDevices(G)}),3e3)}))}},{key:"enumerateDevices",value:function(e){navigator.mediaDevices.enumerateDevices().then((function(t){q(t),e(t)})).catch((function(t){P.warn("Failed to  enumerate devices. ".concat(t)),q([]),e([])}))}},{key:"_getUserMedia",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return new Promise((function(i,r){var a,o=!1;"number"===typeof n&&!isNaN(n)&&n>0&&(a=setTimeout((function(){o=!0,a=void 0,r(new p.a(f.TIMEOUT))}),n)),navigator.mediaDevices.getUserMedia(t).then((function(t){P.log("onUserMediaSuccess"),K(e,t),o||("undefined"!==typeof a&&clearTimeout(a),i(t))})).catch((function(n){P.warn("Failed to get access to local media. ".concat(n," ").concat(JSON.stringify(t)));var i=new p.a(n,t,e);o||("undefined"!==typeof a&&clearTimeout(a),r(n)),i.name===f.PERMISSION_DENIED&&K(e,void 0)}))}))}},{key:"_getDesktopMedia",value:function(){return I.b.isSupported()?new Promise((function(e,t){I.b.obtainStream((function(t){e(t)}),(function(e){t(e)}))})):Promise.reject(new Error("Desktop sharing is not supported!"))}},{key:"_getMissingTracks",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=[],i=e.includes("audio"),r=t&&t.getAudioTracks().length>0;i&&!r&&n.push("audio");var a=e.includes("video"),o=t&&t.getVideoTracks().length>0;return a&&!o&&n.push("video"),n}},{key:"obtainAudioAndVideoPermissions",value:function(e){var t=this,n=e.timeout,r=Object(i.a)(e,["timeout"]),a=[],o=function(){if(!(-1!==(r.devices||[]).indexOf("desktop")))return Promise.resolve();var e=r.desktopSharingSourceDevice;if(e){var t=z&&z.find((function(t){return"videoinput"===t.kind&&(t.deviceId===e||t.label===e)}));if(!t)return Promise.reject(new p.a({name:"ConstraintNotSatisfiedError"},{},[e]));var i={video:{deviceId:t.deviceId}};return this._getUserMedia(["video"],i,n).then((function(e){return{sourceType:"device",stream:e}}))}return this._getDesktopMedia()}.bind(this),s=function(){var e=(r.devices||["audio","video"]).filter((function(e){return"audio"===e||"video"===e}));if(!e.length)return Promise.resolve();var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=h()(t.constraints||D);if(e.indexOf("video")>=0){if(E.a[t.resolution]){var i=E.a[t.resolution];n.video={height:{ideal:i.height},width:{ideal:i.width}}}if(n.video||(n.video={}),C.a.isWebKitBased()&&(n.video.height&&n.video.height.ideal?n.video.height={ideal:n.video.height.ideal}:P.warn("Ideal camera height missing, camera may not start properly"),n.video.width&&n.video.width.ideal?n.video.width={ideal:n.video.width.ideal}:P.warn("Ideal camera width missing, camera may not start properly")),t.cameraDeviceId)n.video.deviceId=t.cameraDeviceId;else{var r=t.facingMode||v.a.USER;n.video.facingMode=r}}else n.video=!1;return e.indexOf("audio")>=0?(n.audio&&"boolean"!==typeof n.audio||(n.audio={}),n.audio={autoGainControl:!V&&!x,deviceId:t.micDeviceId,echoCancellation:!F&&!x,noiseSuppression:!U&&!x},B&&Object.assign(n.audio,{channelCount:2})):n.audio=!1,n}(e,r);return P.info("Got media constraints: ",JSON.stringify(t)),this._getUserMedia(e,t,n)}.bind(this);return o().then((function(e){if(e){var t=e.stream,n=e.sourceId,i=e.sourceType,r=t.getAudioTracks();if(r.length){var o=new MediaStream(r);a.push({stream:o,sourceId:n,sourceType:i,track:o.getAudioTracks()[0]})}var s=t.getVideoTracks();if(s.length){var c=new MediaStream(s);a.push({stream:c,sourceId:n,sourceType:i,track:c.getVideoTracks()[0],videoType:O.a.DESKTOP})}}})).then(s).then((function(e){if(e){var t=e.getAudioTracks();if(t.length){var n=new MediaStream(t);a.push({stream:n,track:n.getAudioTracks()[0],effects:r.effects})}var i=e.getVideoTracks();if(i.length){var o=new MediaStream(i);a.push({stream:o,track:o.getVideoTracks()[0],videoType:O.a.CAMERA,effects:r.effects})}}})).then((function(){return a})).catch((function(e){return a.forEach((function(e){var n=e.stream;t.stopMediaStream(n)})),Promise.reject(e)}))}},{key:"isDeviceListAvailable",value:function(){return Boolean(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)}},{key:"isDeviceChangeAvailable",value:function(e){return"output"!==e&&"audiooutput"!==e||H}},{key:"stopMediaStream",value:function(e){e&&(e.getTracks().forEach((function(e){e.stop&&e.stop()})),e.stop&&e.stop(),e.release&&e.release())}},{key:"isDesktopSharingEnabled",value:function(){return I.b.isSupported()}},{key:"setAudioOutputDevice",value:function(e){return this.isDeviceChangeAvailable("output")?J.setSinkId(e).then((function(){M=e,L=!0,P.log("Audio output device set to ".concat(e)),N.emit(b.a.AUDIO_OUTPUT_DEVICE_CHANGED,e)})):Promise.reject(new Error("Audio output device change is not supported"))}},{key:"getAudioOutputDevice",value:function(){return M}},{key:"getCurrentlyAvailableMediaDevices",value:function(){return z}},{key:"arePermissionsGrantedForAvailableDevices",value:function(){return z.some((function(e){return Boolean(e.label)}))}},{key:"getEventDataForActiveDevice",value:function(e){var t=[],n={deviceId:e.deviceId,kind:e.kind,label:e.label,groupId:e.groupId};return t.push(n),{deviceList:t}}},{key:"setSuspendVideo",value:function(e,t){e.optional||(e.optional=[]),e.optional=e.optional.filter((function(e){return!e.hasOwnProperty("googSuspendBelowMinBitrate")})),t&&e.optional.push({googSuspendBelowMinBitrate:"true"})}}]),n}(R.a));function Y(e){return function(t,n){var i=e.apply(W,arguments);return n&&W.isDeviceChangeAvailable("output")&&n.getAudioTracks&&n.getAudioTracks().length&&L&&t.setSinkId(W.getAudioOutputDevice()).catch((function(e){var n=new p.a(e,null,["audiooutput"]);k.a.callUnhandledRejectionHandler({promise:this,reason:n}),P.warn("Failed to set audio output device for the element. Default audio output device will be used instead",t,n)})),i}}t.a=W}).call(this,"/index.js")},function(e,t){var n=[],i=window.onerror;var r=window.onunhandledrejection;window.onerror=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];n.forEach((function(e){return e.apply(void 0,t)})),i&&i.apply(void 0,t)},window.onunhandledrejection=function(e){n.forEach((function(t){return t(null,null,null,null,e.reason)})),r&&r(e)};var a={addHandler:function(e){n.push(e)},callErrorHandler:function(e){var t=window.onerror;t&&t(null,null,null,null,e)},callUnhandledRejectionHandler:function(e){var t=window.onunhandledrejection;t&&t(e)}};e.exports=a},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return I}));var i=n(15),r=n(6),a=n(8),o=n(31),s=n(36),c=n(35),u=n(18),l=n(10),d=n(19),h=n(29),p=n.n(h),f=n(50),m=n.n(f),v=n(20),g=n(26),b=n(43),y=n.n(b),E=n(72),S=n(100),O=n(372),_=n(168),C=n(42),T=n(373),j=Object(u.getLogger)(e),A=0,k=0;function R(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map((function(e){var t=e.sourceId,n=e.sourceType,i=e.stream,r=e.track,a=e.videoType,o=e.effects,s=r.getSettings(),c=s.deviceId,u=s.facingMode;return k=Object(S.d)(k),new _.a({deviceId:c,facingMode:u,mediaType:r.kind,rtcId:k,sourceId:t,sourceType:n,stream:i,track:r,videoType:a||null,effects:o})}))}var I=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(r.a)(this,n),(i=t.call(this)).conference=e,i.peerConnections=new Map,i.localTracks=[],i.options=a,i._channel=null,i._lastN=void 0,i._lastNEndpoints=null,i._maxFrameHeight=void 0,i._selectedEndpoints=null,i._lastNChangeListener=i._onLastNChanged.bind(Object(o.a)(i)),i._onDeviceListChanged=i._onDeviceListChanged.bind(Object(o.a)(i)),i._updateAudioOutputForAudioTracks=i._updateAudioOutputForAudioTracks.bind(Object(o.a)(i)),i._videoType=m.a.CAMERA,C.a.isDeviceChangeAvailable("output")&&(C.a.addListener(p.a.AUDIO_OUTPUT_DEVICE_CHANGED,i._updateAudioOutputForAudioTracks),C.a.addListener(p.a.DEVICE_LIST_CHANGED,i._onDeviceListChanged)),i}return Object(a.a)(n,[{key:"destroy",value:function(){C.a.removeListener(p.a.AUDIO_OUTPUT_DEVICE_CHANGED,this._updateAudioOutputForAudioTracks),C.a.removeListener(p.a.DEVICE_LIST_CHANGED,this._onDeviceListChanged),this._channelOpenListener&&this.removeListener(p.a.DATA_CHANNEL_OPEN,this._channelOpenListener)}},{key:"initializeBridgeChannel",value:function(e,t){var n=this;this._channel=new O.a(e,t,this.eventEmitter),this._channelOpenListener=function(){var e=function(e,t,n){y.a.callErrorHandler(e),j.error("Cannot send ".concat(t,"(").concat(JSON.stringify(n),") endpoint message"),e)};if(n._receiverVideoConstraints)try{n._channel.sendNewReceiverVideoConstraintsMessage(n._receiverVideoConstraints)}catch(t){e(t,"ReceiverVideoConstraints",n._receiverVideoConstraints)}if(n._selectedEndpoints)try{n._channel.sendSelectedEndpointsMessage(n._selectedEndpoints)}catch(t){e(t,"SelectedEndpointsChangedEvent",n._selectedEndpoint)}if("undefined"!==typeof n._maxFrameHeight)try{n._channel.sendReceiverVideoConstraintMessage(n._maxFrameHeight)}catch(t){e(t,"ReceiverVideoConstraint",n._maxFrameHeight)}if("undefined"!==typeof n._lastN&&-1!==n._lastN)try{n._channel.sendSetLastNMessage(n._lastN)}catch(t){e(t,"LastNChangedEvent",n._lastN)}try{n._channel.sendVideoTypeMessage(n._videoType)}catch(t){e(t,"VideoTypeMessage",n._videoType)}n.removeListener(p.a.DATA_CHANNEL_OPEN,n._channelOpenListener),n._channelOpenListener=null},this.addListener(p.a.DATA_CHANNEL_OPEN,this._channelOpenListener),this.addListener(p.a.LASTN_ENDPOINT_CHANGED,this._lastNChangeListener)}},{key:"_onDeviceListChanged",value:function(){this._updateAudioOutputForAudioTracks(C.a.getAudioOutputDevice())}},{key:"_onLastNChanged",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=this._lastNEndpoints||[],i=[],r=[];this._lastNEndpoints=t,i=n.filter((function(t){return!e.isInLastN(t)})),r=t.filter((function(e){return-1===n.indexOf(e)})),this.conference.eventEmitter.emit(l.LAST_N_ENDPOINTS_CHANGED,i,r)}},{key:"onCallEnded",value:function(){this._channel&&(this._channel&&"websocket"===this._channel.mode&&this._channel.close(),this._channel=null)}},{key:"setNewReceiverVideoConstraints",value:function(e){this._receiverVideoConstraints=e,this._channel&&this._channel.isOpen()&&this._channel.sendNewReceiverVideoConstraintsMessage(e)}},{key:"setReceiverVideoConstraint",value:function(e){this._maxFrameHeight=e,this._channel&&this._channel.isOpen()&&this._channel.sendReceiverVideoConstraintMessage(e)}},{key:"setVideoType",value:function(e){this._videoType!==e&&(this._videoType=e,this._channel&&this._channel.isOpen()&&this._channel.sendVideoTypeMessage(e))}},{key:"selectEndpoints",value:function(e){this._selectedEndpoints=e,this._channel&&this._channel.isOpen()&&this._channel.sendSelectedEndpointsMessage(e)}},{key:"createPeerConnection",value:function(e,t,n,i){var r=JSON.parse(JSON.stringify(C.a.pcConstraints));"undefined"!==typeof i.abtestSuspendVideo&&(C.a.setSuspendVideo(r,i.abtestSuspendVideo),g.a.analytics.addPermanentProperties({abtestSuspendVideo:i.abtestSuspendVideo})),i.enableInsertableStreams&&(j.debug("E2EE - setting insertable streams constraints"),t.encodedInsertableStreams=!0,t.forceEncodedAudioInsertableStreams=!0,t.forceEncodedVideoInsertableStreams=!0),(v.a.isReactNative()||v.a.isChromiumBased()&&!i.usesUnifiedPlan)&&(t.sdpSemantics="plan-b"),i.forceTurnRelay&&(t.iceTransportPolicy="relay"),t.bundlePolicy="max-bundle",A=Object(S.d)(A);var a=new T.a(this,A,e,t,r,n,i);return this.peerConnections.set(a.id,a),a}},{key:"_removePeerConnection",value:function(e){var t=e.id;return!!this.peerConnections.has(t)&&(this.peerConnections.delete(t),!0)}},{key:"addLocalTrack",value:function(e){if(!e)throw new Error("track must not be null nor undefined");this.localTracks.push(e),e.conference=this.conference}},{key:"getLocalVideoTrack",value:function(){var e=this.getLocalTracks(d.c);return e.length?e[0]:void 0}},{key:"getLocalAudioTrack",value:function(){var e=this.getLocalTracks(d.a);return e.length?e[0]:void 0}},{key:"getLocalEndpointId",value:function(){return this.conference.myUserId()}},{key:"getLocalTracks",value:function(e){var t=this.localTracks.slice();return void 0!==e&&(t=t.filter((function(t){return t.getType()===e}))),t}},{key:"getRemoteTracks",value:function(e){var t,n=[],r=Object(i.a)(this.peerConnections.values());try{for(r.s();!(t=r.n()).done;){var a=t.value.getRemoteTracks(void 0,e);a&&(n=n.concat(a))}}catch(o){r.e(o)}finally{r.f()}return n}},{key:"setAudioMute",value:function(e){var t=[];return this.getLocalTracks(d.a).forEach((function(n){t.push(e?n.mute():n.unmute())})),Promise.all(t)}},{key:"setVideoMute",value:function(e){var t=[];return this.getLocalTracks(d.c).concat(this.getLocalTracks(d.b)).forEach((function(n){t.push(e?n.mute():n.unmute())})),Promise.all(t)}},{key:"removeLocalTrack",value:function(e){var t=this.localTracks.indexOf(e);-1!==t&&this.localTracks.splice(t,1)}},{key:"closeBridgeChannel",value:function(){this._channel&&(this._channel.close(),this._channel=null,this.removeListener(p.a.LASTN_ENDPOINT_CHANGED,this._lastNChangeListener))}},{key:"setAudioLevel",value:function(e,t,n,i){var r=e.getTrackBySSRC(t);r&&(r.isAudioTrack()?(r.isLocal()!==i&&j.error("".concat(r," was expected to ").concat(i?"be":"not be"," local")),r.setAudioLevel(n,e)):j.warn("Received audio level for non-audio track: ".concat(t)))}},{key:"sendChannelMessage",value:function(e,t){if(!this._channel)throw new Error("Channel support is disabled!");this._channel.sendMessage(e,t)}},{key:"sendEndpointStatsMessage",value:function(e){this._channel&&this._channel.isOpen()&&this._channel.sendEndpointStatsMessage(e)}},{key:"setLastN",value:function(e){this._lastN!==e&&(this._lastN=e,this._channel&&this._channel.isOpen()&&this._channel.sendSetLastNMessage(e),this.eventEmitter.emit(p.a.LASTN_VALUE_CHANGED,e))}},{key:"setPerceptibles",value:function(e){this._channel&&this._channel.isOpen()&&this._channel.sendSetPercieveEventMessage(e),this.eventEmitter.emit(p.a.PERCEPTIBLES_CHANGED,e)}},{key:"isInLastN",value:function(e){return!this._lastNEndpoints||this._lastNEndpoints.indexOf(e)>-1}},{key:"_updateAudioOutputForAudioTracks",value:function(e){var t,n=this.getRemoteTracks(d.a),r=Object(i.a)(n);try{for(r.s();!(t=r.n()).done;){t.value.setAudioOutput(e)}}catch(a){r.e(a)}finally{r.f()}}}],[{key:"createLocalTracks",value:function(e){return R(e)}},{key:"obtainAudioAndVideoPermissions",value:function(e){return C.a.obtainAudioAndVideoPermissions(e).then((function(e){return R(e)}))}},{key:"addListener",value:function(e,t){C.a.addListener(e,t)}},{key:"removeListener",value:function(e,t){C.a.removeListener(e,t)}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.options=e,C.a.init(this.options)}},{key:"attachMediaStream",value:function(e,t){return C.a.attachMediaStream(e,t)}},{key:"getStreamID",value:function(e){return C.a.getStreamID(e)}},{key:"getTrackID",value:function(e){return C.a.getTrackID(e)}},{key:"isDeviceListAvailable",value:function(){return C.a.isDeviceListAvailable()}},{key:"isDeviceChangeAvailable",value:function(e){return C.a.isDeviceChangeAvailable(e)}},{key:"isWebRtcSupported",value:function(){return v.a.isSupported()}},{key:"getAudioOutputDevice",value:function(){return C.a.getAudioOutputDevice()}},{key:"getCurrentlyAvailableMediaDevices",value:function(){return C.a.getCurrentlyAvailableMediaDevices()}},{key:"arePermissionsGrantedForAvailableDevices",value:function(){return C.a.arePermissionsGrantedForAvailableDevices()}},{key:"getEventDataForActiveDevice",value:function(e){return C.a.getEventDataForActiveDevice(e)}},{key:"setAudioOutputDevice",value:function(e){return C.a.setAudioOutputDevice(e)}},{key:"isUserStream",value:function(e){return n.isUserStreamById(C.a.getStreamID(e))}},{key:"isUserStreamById",value:function(e){return e&&"mixedmslabel"!==e&&"default"!==e}},{key:"enumerateDevices",value:function(e){C.a.enumerateDevices(e)}},{key:"stopMediaStream",value:function(e){C.a.stopMediaStream(e)}},{key:"isDesktopSharingEnabled",value:function(){return C.a.isDesktopSharingEnabled()}}]),n}(E.a)}).call(this,"/index.js")},,,,,,function(e,t){e.exports={CAMERA:"camera",DESKTOP:"desktop",NONE:"none"}},,function(e,t,n){"use strict";n.r(t),n.d(t,"CONSTRAINT_FAILED",(function(){return i})),n.d(t,"ELECTRON_DESKTOP_PICKER_ERROR",(function(){return r})),n.d(t,"ELECTRON_DESKTOP_PICKER_NOT_FOUND",(function(){return a})),n.d(t,"GENERAL",(function(){return o})),n.d(t,"NOT_FOUND",(function(){return s})),n.d(t,"PERMISSION_DENIED",(function(){return c})),n.d(t,"SCREENSHARING_GENERIC_ERROR",(function(){return u})),n.d(t,"SCREENSHARING_USER_CANCELED",(function(){return l})),n.d(t,"TIMEOUT",(function(){return d})),n.d(t,"TRACK_IS_DISPOSED",(function(){return h})),n.d(t,"TRACK_NO_STREAM_FOUND",(function(){return p})),n.d(t,"UNSUPPORTED_RESOLUTION",(function(){return f}));var i="gum.constraint_failed",r="gum.electron_desktop_picker_error",a="gum.electron_desktop_picker_not_found",o="gum.general",s="gum.not_found",c="gum.permission_denied",u="gum.screensharing_generic_error",l="gum.screensharing_user_canceled",d="gum.timeout",h="track.track_is_disposed",p="track.no_stream_found",f="gum.unsupported_resolution"},,function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return r})),n.d(t,"f",(function(){return a})),n.d(t,"d",(function(){return o})),n.d(t,"g",(function(){return s})),n.d(t,"h",(function(){return c})),n.d(t,"a",(function(){return u})),n.d(t,"e",(function(){return l}));var i=100,r=31536e7/i;function a(e){return"text"===e.type||"pdf"===e.type}function o(e){return e&&"camera"!==e.type&&"screen"!==e.type}function s(e){return e&&("text"===e.type||"iframe"===e.type||"pdf"===e.type||"whiteboard"===e.type||"gdrive"===e.type||"youtube"===e.type)}function c(e){return e&&e.zorder<=r}var u=1048576;function l(e,t){return e.time-t.time}},,function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a})),n.d(t,"d",(function(){return o})),n.d(t,"c",(function(){return s})),n.d(t,"e",(function(){return c}));var i=n(128),r=60,a={name:"Anonymous",email:"",avatarSrc:"",color:[],textColor:[],notifyCall:!0,notifyTouch:!1,notifyNear:!1,notifyYarn:!1},o={name:"",avatarSrc:"",color:[],textColor:[]},s={located:!0,onStage:!1,awayFromKeyboard:!1};function c(e){var t=e.color;t.length||(t=e.name.length?Object(i.d)(e.name):[208,208,224]);var n=e.textColor;n.length||(n=Object(i.b)(t));var r=Object(i.a)(t);return[Object(i.f)(t),Object(i.f)(n),Object(i.f)(r)]}},,function(e,t,n){"use strict";var i=n(24),r=n(6),a=n(8),o=(n(83),n(12)),s=n(63),c=n(30),u=n(90),l=n(22),h=n(122),p=n(56),f=n(61),m=n(3),v=n(168);var g,b,y,E,S=n(117),O=n(11),_=n(4),C=new(g=function(){function e(){var t=this;Object(r.a)(this,e),Object(i.a)(this,"type",b,this),Object(i.a)(this,"types",y,this),Object(i.a)(this,"supressedTypes",E,this),this.reason="",this.name="",this.videoInputs=[],this.audioInputs=[],this.audioOutputs=[],this.canvas=void 0,this.oscillator=void 0,Object(_.g)(this),null!==f.a.testBot&&this.clear(),Object(_.c)((function(){t.show()?S.a.keyInputUsers.add("errorDialog"):S.a.keyInputUsers.delete("errorDialog")})),Object(_.c)((function(){O.a.local.awayFromKeyboard&&t.setType("afk")}))}return Object(a.a)(e,[{key:"fatal",get:function(){return!this.type}},{key:"setType",value:function(e,t,n){this.type=e,this.types.add(e),this.reason=n,this.name=t}},{key:"title",get:function(){switch(this.type){case"connection":return Object(l.c)("etConnection");case"retry":return Object(l.c)("etRetry");case"noMic":return Object(l.c)("etNoMic");case"micPermission":return Object(l.c)("etMicPermission");case"channel":return Object(l.c)("etNoChannel");case"entrance":return"";case"afk":return Object(l.c)("afkTitle");case"kicked":return"Kicked by ".concat(this.name,". ").concat(this.reason)}return this.type}},{key:"message",get:function(){switch(this.type){case"connection":return Object(l.c)("emConnection");case"retry":return Object(l.c)("emRetry");case"noMic":return Object(l.c)("emNoMic");case"micPermission":return Object(l.c)("emMicPermission");case"channel":return Object(l.c)("emNoChannel");case"entrance":return"";case"afk":return Object(l.c)("afkMessage");case"kicked":return""}return"no message defined for ".concat(this.type)}},{key:"show",value:function(){if(""===this.type){var e=Object(m.g)(this.types,this.supressedTypes);e.size&&(this.type=e.values().next().value)}return""!==this.type&&!this.supressedTypes.has(this.type)}},{key:"enumerateDevices",value:function(){var e=this;navigator.mediaDevices.enumerateDevices().then((function(t){e.videoInputs=[],e.audioInputs=[],e.audioOutputs=[],t.forEach((function(t){"videoinput"===t.kind&&e.videoInputs.push(t),"audioinput"===t.kind&&e.audioInputs.push(t),"audiooutput"===t.kind&&e.audioOutputs.push(t)}))})).catch((function(){console.error("Device enumeration error")}))}},{key:"connectionStart",value:function(){var e=this;null!==f.a.skipEntrance&&(this.clear(),O.a.local.sendInformation()),this.enumerateDevices(),null===f.a.testBot?Object(_.j)((function(){return""===e.type}),(function(){setTimeout(e.checkConnection.bind(e),4e3)})):setTimeout(this.startTestBot.bind(this),3e3)}},{key:"clear",value:function(e){"afk"===this.type&&(O.a.local.awayFromKeyboard=!1),e?(this.types.delete(e),this.type===e&&(this.type="")):(this.types.clear(),this.type="")}},{key:"checkConnection",value:function(){c.b.state!==u.a.CONNECTED?(this.setType("connection"),setTimeout(this.checkConnection.bind(this),5e3)):(this.clear("connection"),this.checkMic())}},{key:"checkMic",value:function(){!O.a.localId||O.a.local.muteAudio||c.b.conference.getLocalMicTrack()?(O.a.local.muteAudio&&setTimeout(this.checkMic.bind(this),5e3),this.clear("noMic"),this.clear("micPermission"),this.checkRemote()):(this.audioInputs.length?this.setType("micPermission"):(this.clear("micPermission"),this.setType("noMic")),setTimeout(this.checkMic.bind(this),5e3))}},{key:"checkRemote",value:function(){O.a.remote.size>0?setTimeout(this.checkChannel.bind(this),3e3):setTimeout(this.checkRemote.bind(this),1e3)}},{key:"checkChannel",value:function(){var e,t;O.a.remote.size>0?(null===(e=c.b.conference._jitsiConference)||void 0===e||null===(t=e.rtc._channel)||void 0===t?void 0:t.isOpen())?this.clear("channel"):(this.setType("channel"),setTimeout(this.checkChannel.bind(this),5e3)):this.checkRemote()}},{key:"startTestBot",value:function(){var e=this,t=0,n=new AudioContext;this.oscillator=n.createOscillator(),this.oscillator.type="triangle";var i=n.createMediaStreamDestination();this.oscillator.connect(i),this.oscillator.start(),this.canvas=document.createElement("canvas");var r=240,a=240;this.canvas.style.width="".concat(r,"px"),this.canvas.style.height="".concat(a,"px");var o=this.canvas.getContext("2d"),u=[Math.random()*s.b/2,(Math.random()-.5)*s.b];setInterval((function(){var i,r;if(o&&n){null===(i=e.oscillator)||void 0===i||i.frequency.setValueAtTime(440+t%440,n.currentTime);var a=["green","blue"],s=h.a.tracksToAccept[0].length?O.a.remote.get(h.a.tracksToAccept[0][0].endpointId):void 0;s&&!(null===s||void 0===s?void 0:s.tracks.avatarOk)&&(a[0]="yellow"),s&&(null===s||void 0===s||null===(r=s.tracks.audio)||void 0===r?void 0:r.getTrack().muted)&&(a[1]="red"),o.fillStyle=a[0],o.beginPath(),o.ellipse(151.2,79.2,24,96,t/20,0,2*Math.PI),o.fill(),o.fillStyle=a[1],o.beginPath(),o.ellipse(151.2,79.2,24,96,-t/20,0,2*Math.PI),o.fill(),t+=1}}),50);var l="01234567890ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijlkmnopqrstuvwxyz",d=function(){return l.substr(Math.floor(Math.random()*l.length),1)};O.a.local.information=p.b,O.a.local.information.name="testBot ".concat(d()).concat(d()).concat(d()),O.a.local.sendInformation(),O.a.local.pose.position=u;var f=function(){O.a.local.pose.position=Object(m.a)(u,Object(m.z)(100,[Math.cos(t/60),Math.sin(t/60)]))},g=window;if(g.requestIdleCallback){!function e(){setTimeout((function(){f(),g.requestIdleCallback(e)}),50)}()}else setInterval(f,1e3);var b=this.canvas.captureStream(20),y=i.stream,E=new MediaStream;E.addTrack(y.getAudioTracks()[0]),E.addTrack(b.getVideoTracks()[0]),function(e){var t=e.getVideoTracks()[0],n=e.getAudioTracks()[0],i=new MediaStream([t]),r=void 0;n&&(r={videoType:null,mediaType:"audio",rtcId:0,stream:new MediaStream([n]),track:n,effects:void 0,resolution:n.getSettings().height,deviceId:"videofile_chrome",facingMode:"environment"});var a={videoType:"camera",mediaType:"video",rtcId:1,stream:i,track:t,effects:void 0,resolution:t.getSettings().height,deviceId:"videofile_chrome",facingMode:"environment"};return r?Promise.resolve([new v.a(a),new v.a(r)]):Promise.resolve([new v.a(a)])}(E).then((function(e){c.b.conference.setLocalCameraTrack(e[0]),c.b.conference.setLocalMicTrack(e[1])}))}}]),e}(),Object(o.a)(g.prototype,"fatal",[_.d],Object.getOwnPropertyDescriptor(g.prototype,"fatal"),g.prototype),b=Object(o.a)(g.prototype,"type",[_.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"entrance"}}),y=Object(o.a)(g.prototype,"types",[_.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Set}}),E=Object(o.a)(g.prototype,"supressedTypes",[_.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Set}}),Object(o.a)(g.prototype,"setType",[_.b],Object.getOwnPropertyDescriptor(g.prototype,"setType"),g.prototype),Object(o.a)(g.prototype,"title",[_.d],Object.getOwnPropertyDescriptor(g.prototype,"title"),g.prototype),Object(o.a)(g.prototype,"message",[_.d],Object.getOwnPropertyDescriptor(g.prototype,"message"),g.prototype),Object(o.a)(g.prototype,"connectionStart",[_.b],Object.getOwnPropertyDescriptor(g.prototype,"connectionStart"),g.prototype),Object(o.a)(g.prototype,"clear",[_.b],Object.getOwnPropertyDescriptor(g.prototype,"clear"),g.prototype),Object(o.a)(g.prototype,"checkConnection",[_.b],Object.getOwnPropertyDescriptor(g.prototype,"checkConnection"),g.prototype),Object(o.a)(g.prototype,"checkMic",[_.b],Object.getOwnPropertyDescriptor(g.prototype,"checkMic"),g.prototype),Object(o.a)(g.prototype,"checkChannel",[_.b],Object.getOwnPropertyDescriptor(g.prototype,"checkChannel"),g.prototype),g);d.error=C;t.a=C},function(e,t,n){"use strict";n.r(t),n.d(t,"LOCAL_TRACK_STOPPED",(function(){return i})),n.d(t,"TRACK_AUDIO_LEVEL_CHANGED",(function(){return r})),n.d(t,"TRACK_AUDIO_OUTPUT_CHANGED",(function(){return a})),n.d(t,"TRACK_MUTE_CHANGED",(function(){return o})),n.d(t,"TRACK_VIDEOTYPE_CHANGED",(function(){return s})),n.d(t,"NO_DATA_FROM_SOURCE",(function(){return c})),n.d(t,"NO_AUDIO_INPUT",(function(){return u}));var i="track.stopped",r="track.audioLevelsChanged",a="track.audioOutputChanged",o="track.trackMuteChanged",s="track.videoTypeChanged",c="track.no_data_from_source",u="track.no_audio_input"},,function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i=function(e){var t=new URL(decodeURI(e)),n=["room","name","headphone","speaker","cameraOn","muteMic","testBot","skipEntrance"].reduce((function(e,n){return e[n]=t.searchParams.get(n),e}),{});return n.room=t.pathname.substr(1).toLowerCase().replace(/[./@]/,"_")+(n.room?n.room.toLowerCase():""),n}(window.location.href)},function(e,t,n){e.exports=n(486).default},function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return r}));var i=5e3,r=[0,0]},function(e,t,n){"use strict";n.r(t),n.d(t,"AUTHENTICATION_REQUIRED",(function(){return i})),n.d(t,"CHAT_ERROR",(function(){return r})),n.d(t,"CONFERENCE_DESTROYED",(function(){return a})),n.d(t,"CONFERENCE_MAX_USERS",(function(){return o})),n.d(t,"CONNECTION_ERROR",(function(){return s})),n.d(t,"CONFERENCE_RESTARTED",(function(){return c})),n.d(t,"NOT_ALLOWED_ERROR",(function(){return u})),n.d(t,"MEMBERS_ONLY_ERROR",(function(){return l})),n.d(t,"CONFERENCE_ACCESS_DENIED",(function(){return d})),n.d(t,"FOCUS_DISCONNECTED",(function(){return h})),n.d(t,"FOCUS_LEFT",(function(){return p})),n.d(t,"GRACEFUL_SHUTDOWN",(function(){return f})),n.d(t,"ICE_FAILED",(function(){return m})),n.d(t,"INCOMPATIBLE_SERVER_VERSIONS",(function(){return v})),n.d(t,"OFFER_ANSWER_FAILED",(function(){return g})),n.d(t,"PASSWORD_NOT_SUPPORTED",(function(){return b})),n.d(t,"PASSWORD_REQUIRED",(function(){return y})),n.d(t,"RESERVATION_ERROR",(function(){return E})),n.d(t,"VIDEOBRIDGE_NOT_AVAILABLE",(function(){return S}));var i="conference.authenticationRequired",r="conference.chatError",a="conference.destroyed",o="conference.max_users",s="conference.connectionError",c="conference.restarted",u="conference.connectionError.notAllowed",l="conference.connectionError.membersOnly",d="conference.connectionError.accessDenied",h="conference.focusDisconnected",p="conference.focusLeft",f="conference.gracefulShutdown",m="conference.iceFailed",v="conference.incompatible_server_versions",g="conference.offerAnswerFailed",b="conference.passwordNotSupported",y="conference.passwordRequired",E="conference.reservationError",S="conference.videobridgeNotAvailable"},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var i=n(27),r=n(15),a=n(39),o=n.n(a),s=n(20),c=n(34);function u(e){for(var t=e.split("\r\nm="),n=1,i=t.length;n<i;n++){var r="m=".concat(t[n]);n!==i-1&&(r+="\r\n"),t[n]=r}var a="".concat(t.shift(),"\r\n");this.media=t,this.raw=a+t.join(""),this.session=a}u.prototype.failICE=!1,u.prototype.removeTcpCandidates=!1,u.prototype.removeUdpCandidates=!1,u.prototype.getMediaSsrcMap=function(){for(var e=this,t={},n=function(n){var i={mediaindex:n,mid:c.a.parseMID(c.a.findLine(e.media[n],"a=mid:")),ssrcs:{},ssrcGroups:[]};t[n]=i,c.a.findLines(e.media[n],"a=ssrc:").forEach((function(e){var t=e.substring(7).split(" ")[0];i.ssrcs[t]||(i.ssrcs[t]={ssrc:t,lines:[]}),i.ssrcs[t].lines.push(e)})),c.a.findLines(e.media[n],"a=ssrc-group:").forEach((function(e){var t=e.indexOf(" "),n=e.substr(0,t).substr(13),r=e.substr(14+n.length).split(" ");r.length&&i.ssrcGroups.push({semantics:n,ssrcs:r})}))},i=0;i<this.media.length;i++)n(i);return t},u.prototype.containsSSRC=function(e){var t=this.getMediaSsrcMap(),n=!1;return Object.keys(t).forEach((function(i){n||t[i].ssrcs[e]&&(n=!0)})),n},u.prototype.toJingle=function(e,t){c.a.findLines(this.session,"a=group:").forEach((function(t){var n=t.split(" "),i=n.shift().substr(8);e.c("group",{xmlns:"urn:xmpp:jingle:apps:grouping:0",semantics:i});for(var r=0;r<n.length;r++)e.c("content",{name:n[r]}).up();e.up()}));for(var n=0;n<this.media.length;n++){var a=c.a.parseMLine(this.media[n].split("\r\n")[0]);if("audio"===a.media||"video"===a.media||"application"===a.media){var u=void 0,l=c.a.findLine(this.media[n],"a=ssrc:");u=!!l&&l.substring(7).split(" ")[0],e.c("content",{creator:t,name:a.media});var d=c.a.findLine(this.media[n],"a=mid:");if(d){var h=c.a.parseMID(d);e.attrs({name:h})}if("audio"===a.media||"video"===a.media){e.c("description",{xmlns:"urn:xmpp:jingle:apps:rtp:1",media:a.media}),u&&e.attrs({ssrc:u});for(var p=0;p<a.fmt.length;p++){var f=c.a.findLine(this.media[n],"a=rtpmap:".concat(a.fmt[p]));e.c("payload-type",c.a.parseRTPMap(f));var m=c.a.findLine(this.media[n],"a=fmtp:".concat(a.fmt[p]));if(m)for(var v=c.a.parseFmtp(m),g=0;g<v.length;g++)e.c("parameter",v[g]).up();this.rtcpFbToJingle(n,e,a.fmt[p]),e.up()}if(u){var b,y=c.a.parseSSRC(this.media[n]),E=Object(r.a)(y);try{for(E.s();!(b=E.n()).done;){var S=Object(i.a)(b.value,2),O=S[0],_=S[1];e.c("source",{ssrc:O,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),_.forEach((function(t){var n=t.indexOf(" "),i=t.substr(n+1);if(e.c("parameter"),-1===i.indexOf(":"))e.attrs({name:i});else{var r=i.split(":",2)[0];e.attrs({name:r});var a=i.split(":",2)[1];a=c.a.filterSpecialChars(a),e.attrs({value:a})}e.up()})),e.up()}}catch(I){E.e(I)}finally{E.f()}c.a.findLines(this.media[n],"a=ssrc-group:").forEach((function(t){var n=t.indexOf(" "),i=t.substr(0,n).substr(13),r=t.substr(14+i.length).split(" ");r.length&&(e.c("ssrc-group",{semantics:i,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),r.forEach((function(t){return e.c("source",{ssrc:t}).up()})),e.up())}))}var C=c.a.findLines(this.media[n],"a=rid:");if(C.length&&s.a.usesRidsForSimulcast()){var T=C.map((function(e){return e.split(":")[1]})).map((function(e){return e.split(" ")[0]}));T.forEach((function(t){e.c("source",{rid:t,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),e.up()})),c.a.findLine(this.media[n],"a=simulcast:")&&(e.c("rid-group",{semantics:"SIM",xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),T.forEach((function(t){e.c("source",{rid:t}).up()})),e.up())}c.a.findLine(this.media[n],"a=rtcp-mux")&&e.c("rtcp-mux").up(),this.rtcpFbToJingle(n,e,"*");for(var j=c.a.findLines(this.media[n],"a=extmap:"),A=0;A<j.length;A++){var k=c.a.parseExtmap(j[A]);if(e.c("rtp-hdrext",{xmlns:"urn:xmpp:jingle:apps:rtp:rtp-hdrext:0",uri:k.uri,id:k.value}),k.hasOwnProperty("direction"))switch(k.direction){case o.a.SENDONLY:e.attrs({senders:"responder"});break;case o.a.RECVONLY:e.attrs({senders:"initiator"});break;case o.a.SENDRECV:e.attrs({senders:"both"});break;case o.a.INACTIVE:e.attrs({senders:"none"})}e.up()}e.up()}this.transportToJingle(n,e);var R=this.media[n];c.a.findLine(R,"a=".concat(o.a.SENDRECV),this.session)?e.attrs({senders:"both"}):c.a.findLine(R,"a=".concat(o.a.SENDONLY),this.session)?e.attrs({senders:"initiator"}):c.a.findLine(R,"a=".concat(o.a.RECVONLY),this.session)?e.attrs({senders:"responder"}):c.a.findLine(R,"a=".concat(o.a.INACTIVE),this.session)&&e.attrs({senders:"none"}),"0"!==a.port||c.a.findLine(R,"a=bundle-only",this.session)||e.attrs({senders:"rejected"}),e.up()}}return e.up(),e},u.prototype.transportToJingle=function(e,t){var n=this;t.c("transport");var i=c.a.findLine(this.media[e],"a=sctpmap:",this.session);if(i){var r=c.a.parseSCTPMap(i);t.c("sctpmap",{xmlns:"urn:xmpp:jingle:transports:dtls-sctp:1",number:r[0],protocol:r[1]}),r.length>2&&t.attrs({streams:r[2]}),t.up()}c.a.findLines(this.media[e],"a=fingerprint:",this.session).forEach((function(i){var r=c.a.parseFingerprint(i);r.xmlns="urn:xmpp:jingle:apps:dtls:0",t.c("fingerprint").t(r.fingerprint),delete r.fingerprint;var a=c.a.findLine(n.media[e],"a=setup:",n.session);a&&(r.setup=a.substr(8)),t.attrs(r),t.up()}));var a=c.a.iceparams(this.media[e],this.session);a&&(a.xmlns="urn:xmpp:jingle:transports:ice-udp:1",t.attrs(a),c.a.findLines(this.media[e],"a=candidate:",this.session).forEach((function(e){var i=c.a.candidateToJingle(e);n.failICE&&(i.ip="1.1.1.1");var r=i&&"string"===typeof i.protocol?i.protocol.toLowerCase():"";n.removeTcpCandidates&&("tcp"===r||"ssltcp"===r)||n.removeUdpCandidates&&"udp"===r||t.c("candidate",i).up()})));t.up()},u.prototype.rtcpFbToJingle=function(e,t,n){c.a.findLines(this.media[e],"a=rtcp-fb:".concat(n)).forEach((function(e){var n=c.a.parseRTCPFB(e);"trr-int"===n.type?(t.c("rtcp-fb-trr-int",{xmlns:"urn:xmpp:jingle:apps:rtp:rtcp-fb:0",value:n.params[0]}),t.up()):(t.c("rtcp-fb",{xmlns:"urn:xmpp:jingle:apps:rtp:rtcp-fb:0",type:n.type}),n.params.length>0&&t.attrs({subtype:n.params[0]}),t.up())}))},u.prototype.rtcpFbFromJingle=function(e,t){var n="",i=e.find('>rtcp-fb-trr-int[xmlns="urn:xmpp:jingle:apps:rtp:rtcp-fb:0"]');return i.length&&(n+="a=rtcp-fb:* trr-int ",i.attr("value")?n+=i.attr("value"):n+="0",n+="\r\n"),e.find('>rtcp-fb[xmlns="urn:xmpp:jingle:apps:rtp:rtcp-fb:0"]').each((function(e,i){n+="a=rtcp-fb:".concat(t," ").concat(i.getAttribute("type")),i.hasAttribute("subtype")&&(n+=" ".concat(i.getAttribute("subtype"))),n+="\r\n"})),n},u.prototype.fromJingle=function(e){var t=this,n=Date.now();this.raw="v=0\r\n"+"o=- ".concat(n," 2 IN IP4 0.0.0.0\r\n")+"s=-\r\nt=0 0\r\n";var i=$(e).find('>group[xmlns="urn:xmpp:jingle:apps:grouping:0"]');i.length&&i.each((function(e,n){var i=$(n).find(">content").map((function(e,t){return t.getAttribute("name")})).get();i.length>0&&(t.raw+="a=group:".concat(n.getAttribute("semantics")||n.getAttribute("type")," ").concat(i.join(" "),"\r\n"))})),this.session=this.raw,e.find(">content").each((function(e,n){var i=t.jingle2media($(n));t.media.push(i)})),this.raw=this.session+this.media.join("")},u.prototype.jingle2media=function(e){var t=this,n=e.find(">description"),i=e.find('>transport[xmlns="urn:xmpp:jingle:transports:ice-udp:1"]'),r="",a=i.find('>sctpmap[xmlns="urn:xmpp:jingle:transports:dtls-sctp:1"]'),s={media:n.attr("media"),port:"1"};if("rejected"===e.attr("senders")&&(s.port="0"),i.find('>fingerprint[xmlns="urn:xmpp:jingle:apps:dtls:0"]').length?s.proto=a.length?"DTLS/SCTP":"RTP/SAVPF":s.proto="RTP/AVPF",a.length){r+="m=application ".concat(s.port," DTLS/SCTP ").concat(a.attr("number"),"\r\n"),r+="a=sctpmap:".concat(a.attr("number")," ").concat(a.attr("protocol"));var u=a.attr("streams");r+=u?" ".concat(u,"\r\n"):"\r\n"}else s.fmt=n.find(">payload-type").map((function(e,t){return t.getAttribute("id")})).get(),r+="".concat(c.a.buildMLine(s),"\r\n");switch(r+="c=IN IP4 0.0.0.0\r\n",a.length||(r+="a=rtcp:1 IN IP4 0.0.0.0\r\n"),i.length&&(i.attr("ufrag")&&(r+="".concat(c.a.buildICEUfrag(i.attr("ufrag")),"\r\n")),i.attr("pwd")&&(r+="".concat(c.a.buildICEPwd(i.attr("pwd")),"\r\n")),i.find('>fingerprint[xmlns="urn:xmpp:jingle:apps:dtls:0"]').each((function(e,t){r+="a=fingerprint:".concat(t.getAttribute("hash")),r+=" ".concat($(t).text()),r+="\r\n",t.hasAttribute("setup")&&(r+="a=setup:".concat(t.getAttribute("setup"),"\r\n"))}))),i.find(">candidate").each((function(e,n){var i=n.getAttribute("protocol");i="string"===typeof i?i.toLowerCase():"",t.removeTcpCandidates&&("tcp"===i||"ssltcp"===i)||t.removeUdpCandidates&&"udp"===i||(t.failICE&&n.setAttribute("ip","1.1.1.1"),r+=c.a.candidateFromJingle(n))})),e.attr("senders")){case"initiator":r+="a=".concat(o.a.SENDONLY,"\r\n");break;case"responder":r+="a=".concat(o.a.RECVONLY,"\r\n");break;case"none":r+="a=".concat(o.a.INACTIVE,"\r\n");break;case"both":r+="a=".concat(o.a.SENDRECV,"\r\n")}return r+="a=mid:".concat(e.attr("name"),"\r\n"),n.find(">rtcp-mux").length&&(r+="a=rtcp-mux\r\n"),n.find(">payload-type").each((function(e,n){r+="".concat(c.a.buildRTPMap(n),"\r\n"),$(n).find(">parameter").length&&(r+="a=fmtp:".concat(n.getAttribute("id")," "),r+=$(n).find(">parameter").map((function(e,t){var n=t.getAttribute("name");return(n?"".concat(n,"="):"")+t.getAttribute("value")})).get().join("; "),r+="\r\n"),r+=t.rtcpFbFromJingle($(n),n.getAttribute("id"))})),r+=this.rtcpFbFromJingle(n,"*"),n.find('>rtp-hdrext[xmlns="urn:xmpp:jingle:apps:rtp:rtp-hdrext:0"]').each((function(e,t){r+="a=extmap:".concat(t.getAttribute("id")," ").concat(t.getAttribute("uri"),"\r\n")})),n.find('>ssrc-group[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each((function(e,t){var n=t.getAttribute("semantics"),i=$(t).find(">source").map((function(e,t){return t.getAttribute("ssrc")})).get();i.length&&(r+="a=ssrc-group:".concat(n," ").concat(i.join(" "),"\r\n"))})),n.find('>source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each((function(e,t){var n=t.getAttribute("ssrc");$(t).find(">parameter").each((function(e,t){var i=t.getAttribute("name"),a=t.getAttribute("value");a=c.a.filterSpecialChars(a),r+="a=ssrc:".concat(n," ").concat(i),a&&a.length&&(r+=":".concat(a)),r+="\r\n"}))})),r}},,,,,function(e,t,n){"use strict";var i=n(52),r={};function a(e,t,n){if("object"===typeof e&&"undefined"!==typeof e.name)switch(this.gum={error:e,constraints:t,devices:n&&Array.isArray(n)?n.slice(0):void 0},e.name){case"NotAllowedError":case"PermissionDeniedError":case"SecurityError":this.name=i.PERMISSION_DENIED,this.message=r[this.name]+(this.gum.devices||[]).join(", ");break;case"DevicesNotFoundError":case"NotFoundError":this.name=i.NOT_FOUND,this.message=r[this.name]+(this.gum.devices||[]).join(", ");break;case"ConstraintNotSatisfiedError":case"OverconstrainedError":var a=e.constraintName||e.constraint;t&&t.video&&(!n||n.indexOf("video")>-1)&&("minWidth"===a||"maxWidth"===a||"minHeight"===a||"maxHeight"===a||"width"===a||"height"===a||"deviceId"===a)?(this.name=i.UNSUPPORTED_RESOLUTION,this.message=r[this.name]+function(e,t){if(t&&t.video&&t.video.mandatory)switch(e){case"width":return t.video.mandatory.minWidth;case"height":return t.video.mandatory.minHeight;default:return t.video.mandatory[e]||""}return""}(a,t)):(this.name=i.CONSTRAINT_FAILED,this.message=r[this.name]+e.constraintName);break;default:this.name=i.GENERAL,this.message=e.message||r[this.name]}else{if("string"!==typeof e)throw new Error("Invalid arguments");r[e]?(this.name=e,this.message=t||r[e]):this.message=e}this.stack=e.stack||(new Error).stack}r[i.UNSUPPORTED_RESOLUTION]="Video resolution is not supported: ",r[i.SCREENSHARING_USER_CANCELED]="User canceled screen sharing prompt",r[i.SCREENSHARING_GENERIC_ERROR]="Unknown error from screensharing",r[i.ELECTRON_DESKTOP_PICKER_ERROR]="Unkown error from desktop picker",r[i.ELECTRON_DESKTOP_PICKER_NOT_FOUND]="Failed to detect desktop picker",r[i.GENERAL]="Generic getUserMedia error",r[i.PERMISSION_DENIED]="User denied permission to use device(s): ",r[i.NOT_FOUND]="Requested device(s) was/were not found: ",r[i.CONSTRAINT_FAILED]="Constraint could not be satisfied: ",r[i.TIMEOUT]="Could not start media source. Timeout occured!",r[i.TRACK_IS_DISPOSED]="Track has been already disposed",r[i.TRACK_NO_STREAM_FOUND]="Track does not have an associated Media Stream",a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,t.a=a},function(e,t){e.exports={H264:"h264",OPUS:"opus",VP8:"vp8",VP9:"vp9"}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(6),r=n(8),a=n(55),o=n.n(a),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o.a;Object(i.a)(this,e),this.eventEmitter=t,this.addEventListener=this.on=this.addListener,this.removeEventListener=this.off=this.removeListener}return Object(r.a)(e,[{key:"addListener",value:function(e,t){var n=this;return this.eventEmitter.addListener(e,t),function(){return n.removeEventListener(e,t)}}},{key:"removeListener",value:function(e,t){this.eventEmitter.removeListener(e,t)}}]),e}()},,,,function(e,t,n){"use strict";n.r(t),n.d(t,"DETECTOR_STATE_CHANGE",(function(){return i})),n.d(t,"AUDIO_INPUT_STATE_CHANGE",(function(){return r})),n.d(t,"NO_AUDIO_INPUT",(function(){return a})),n.d(t,"VAD_NOISY_DEVICE",(function(){return o})),n.d(t,"VAD_REPORT_PUBLISHED",(function(){return s})),n.d(t,"VAD_SCORE_PUBLISHED",(function(){return c})),n.d(t,"VAD_TALK_WHILE_MUTED",(function(){return u}));var i="detector_state_change",r="audio_input_state_changed",a="no_audio_input_detected",o="detection.vad_noise_device",s="vad-report-published",c="detection.vad_score_published",u="detection.vad_talk_while_muted"},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return R})),n.d(t,"d",(function(){return I})),n.d(t,"c",(function(){return P})),n.d(t,"b",(function(){return w})),n.d(t,"e",(function(){return N}));var i=n(6),r=n(8),a=n(36),o=n(35),s=n(18),c=n(13),u=(n(491),n(125)),l=n(80),d=n(9),h=n.n(d),p=n(20),f=n(182),m=n(43),v=n.n(m),g=n(72),b=n(120),y=n.n(b),E=n(284),S=n(129),O=n(355),_=n(361),C=n(368),T=n(369),j=n(370),A=Object(s.getLogger)(e),k=/<failure.*><not-allowed\/><text>(.*)<\/text><\/failure>/gi;var R=[{urls:"stun:meet-jit-si-turnrelay.jitsi.net:443"}],I="type",P="http://jitsi.org/protocol/jigasi",w="https://jitsi.org/meet/e2ee",N=function(e){Object(a.a)(n,e);var t=Object(o.a)(n);function n(e,r){var a,o;Object(i.a)(this,n),(o=t.call(this)).connection=null,o.disconnectInProgress=!1,o.connectionTimes={},o.options=e,o.token=r,o.authenticatedUser=!1,Object(j.a)(),Object(C.a)();var s=e.xmppPing||{};return s.domain=e.hosts.domain,o.connection=function(e){var t=e.enableWebsocketResume,n=e.serviceUrl,i=void 0===n?"/http-bind":n,r=e.shard,a=e.token,o=e.websocketKeepAlive,s=e.websocketKeepAliveUrl,c=e.xmppPing;return a&&(i+="".concat(-1===i.indexOf("?")?"?":"&","token=").concat(a)),new S.a({enableWebsocketResume:t,serviceUrl:i,websocketKeepAlive:o,websocketKeepAliveUrl:s,xmppPing:c,shard:r})}({enableWebsocketResume:e.enableWebsocketResume,serviceUrl:e.serviceUrl||e.bosh,token:r,websocketKeepAlive:e.websocketKeepAlive,websocketKeepAliveUrl:e.websocketKeepAliveUrl,xmppPing:s,shard:null===(a=e.deploymentInfo)||void 0===a?void 0:a.shard}),o.connection.on(S.a.Events.CONN_SHARD_CHANGED,(function(){var e={shard_changed:!0,suspend_time:o.connection.ping.getPingSuspendTime(),time_since_last_success:o.connection.getTimeSinceLastSuccess()};o.eventEmitter.emit(l.CONNECTION_FAILED,u.OTHER_ERROR,void 0,void 0,e)})),o._initStrophePlugins(),o.caps=new E.a(o.connection,o.options.clientNode),o.initFeaturesList(),$(window).on("beforeunload unload",(function(e){o.disconnect(e).catch((function(){}))})),o}return Object(r.a)(n,[{key:"initFeaturesList",value:function(){this.caps.addFeature("urn:xmpp:jingle:1"),this.caps.addFeature("urn:xmpp:jingle:apps:rtp:1"),this.caps.addFeature("urn:xmpp:jingle:transports:ice-udp:1"),this.caps.addFeature("urn:xmpp:jingle:apps:dtls:0"),this.caps.addFeature("urn:xmpp:jingle:transports:dtls-sctp:1"),this.caps.addFeature("urn:xmpp:jingle:apps:rtp:audio"),this.caps.addFeature("urn:xmpp:jingle:apps:rtp:video"),this.options.disableRtx||p.a.isFirefox()&&p.a.isVersionLessThan(84)||this.caps.addFeature("urn:ietf:rfc:4588"),!0===this.options.enableOpusRed&&p.a.supportsAudioRed()&&this.caps.addFeature("http://jitsi.org/opus-red"),("undefined"===typeof this.options.enableRemb||this.options.enableRemb)&&this.caps.addFeature("http://jitsi.org/remb"),p.a.isFirefox()||"undefined"!==typeof this.options.enableTcc&&!this.options.enableTcc||this.caps.addFeature("http://jitsi.org/tcc"),this.caps.addFeature("urn:ietf:rfc:5761"),this.caps.addFeature("urn:ietf:rfc:5888"),p.a.isChromiumBased()&&!0===this.options.enableLipSync&&(A.info("Lip-sync enabled !"),this.caps.addFeature("http://jitsi.org/meet/lipsync")),this.connection.rayo&&this.caps.addFeature("urn:xmpp:rayo:client:1"),f.a.isSupported(this.options)&&this.caps.addFeature(w,!1,!0)}},{key:"getConnection",value:function(){return this.connection}},{key:"connectionHandler",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,r=window.performance.now(),a=c.Strophe.getStatusString(n).toLowerCase();if(this.connectionTimes[a]=r,A.log("(TIME) Strophe ".concat(a).concat(i?"[".concat(i,"]"):"",":\t"),r),this.eventEmitter.emit(h.a.CONNECTION_STATUS_CHANGED,t,n,i),n===c.Strophe.Status.CONNECTED||n===c.Strophe.Status.ATTACHED)this._sysMessageHandler&&(this.connection._stropheConn.deleteHandler(this._sysMessageHandler),this._sysMessageHandler=null),this.sendDiscoInfo&&this.connection.jingle.getStunAndTurnCredentials(),A.info("My Jabber ID: ".concat(this.connection.jid)),this._resetState(),this.sendDiscoInfo&&this.caps.getFeaturesAndIdentities(this.options.hosts.domain).then((function(t){var n=t.features,i=t.identities;n.has(c.Strophe.NS.PING)||A.error("Ping NOT supported by ".concat(e.options.hosts.domain," - please enable ping in your XMPP server config")),e._processDiscoInfoIdentities(i,void 0)})).catch((function(e){var t="Feature discovery error";v.a.callErrorHandler(new Error("".concat(t,": ").concat(e))),A.error(t,e)})),this.sendDiscoInfo=!1,t.password&&(this.authenticatedUser=!0),this.connection&&this.connection.connected&&c.Strophe.getResourceFromJid(this.connection.jid)&&this.eventEmitter.emit(l.CONNECTION_ESTABLISHED,c.Strophe.getResourceFromJid(this.connection.jid));else if(n===c.Strophe.Status.CONNFAIL)"x-strophe-bad-non-anon-jid"===i?this.anonymousConnectionFailed=!0:this.connectionFailed=!0,this.lastErrorMsg=i,"giving-up"===i&&this.eventEmitter.emit(l.CONNECTION_FAILED,u.OTHER_ERROR,i);else if(n===c.Strophe.Status.ERROR)this.lastErrorMsg=i;else if(n===c.Strophe.Status.DISCONNECTED){this.connection.ping.stopInterval();var o=Boolean(this.disconnectInProgress),s=i||this.lastErrorMsg;if(this.anonymousConnectionFailed)this.eventEmitter.emit(l.CONNECTION_FAILED,u.PASSWORD_REQUIRED);else if(this.connectionFailed)this.eventEmitter.emit(l.CONNECTION_FAILED,u.OTHER_ERROR,s,void 0,this._getConnectionFailedReasonDetails());else if(o)this.eventEmitter.emit(l.CONNECTION_DISCONNECTED,s);else{A.error("XMPP connection dropped!");var d=c.Strophe.getLastErrorStatus();d>=500&&d<600?this.eventEmitter.emit(l.CONNECTION_FAILED,u.SERVER_ERROR,s||"server-error",void 0,this._getConnectionFailedReasonDetails()):this.eventEmitter.emit(l.CONNECTION_FAILED,u.CONNECTION_DROPPED_ERROR,s||"connection-dropped-error",void 0,this._getConnectionFailedReasonDetails())}}else if(n===c.Strophe.Status.AUTHFAIL){var p=this.getConnection().getLastFailedMessage();this.eventEmitter.emit(l.CONNECTION_FAILED,u.PASSWORD_REQUIRED,i||this._parseConnectionFailedMessage(p),t)}}},{key:"_processDiscoInfoIdentities",value:function(e,t){var n=this;e.forEach((function(e){if("av_moderation"===e.type&&(n.avModerationComponentAddress=e.name),"speakerstats"===e.type&&(n.speakerStatsComponentAddress=e.name),"conference_duration"===e.type&&(n.conferenceDurationComponentAddress=e.name),"lobbyrooms"===e.type){n.lobbySupported=!0;var i=function(e){e.forEach((function(e){e.endsWith("#displayname_required")&&n.eventEmitter.emit(l.DISPLAY_NAME_REQUIRED)}))};t?i(t):e.name&&n.caps.getFeaturesAndIdentities(e.name,e.type).then((function(e){var t=e.features;return i(t)})).catch((function(e){return A.warn("Error getting features from lobby.",e&&e.message)}))}})),(this.avModerationComponentAddress||this.speakerStatsComponentAddress||this.conferenceDurationComponentAddress)&&this.connection.addHandler(this._onPrivateMessage.bind(this),null,"message",null,null)}},{key:"_parseConnectionFailedMessage",value:function(e){if(!e)return null;var t=k.exec(e);return t?t[1]:null}},{key:"_connect",value:function(e,t){this._resetState(),this.sendDiscoInfo=!0,this.connection._stropheConn&&this.connection._stropheConn._addSysHandler?this._sysMessageHandler=this.connection._stropheConn._addSysHandler(this._onSystemMessage.bind(this),null,"message"):A.warn("Cannot attach strophe system handler, jiconop cannot operate"),this.connection.connect(e,t,this.connectionHandler.bind(this,{jid:e,password:t}))}},{key:"_onSystemMessage",value:function(e){var t=this;if(0!==$(e).find(">services").length||0!==$(e).find(">query").length){this.sendDiscoInfo=!1;var n=this.connection.jingle.onReceiveStunAndTurnCredentials(e),i=Object(E.b)(e),r=i.features,a=i.identities;this._processDiscoInfoIdentities(a,r),a.forEach((function(e){"shard"===e.type&&(t.options.deploymentInfo.shard=e.name)})),(n||a.size>0||r.size>0)&&(this.connection._stropheConn.deleteHandler(this._sysMessageHandler),this._sysMessageHandler=null)}}},{key:"attach",value:function(e){this._resetState(),this.sendDiscoInfo=!0;var t=this.connectionTimes.attaching=window.performance.now();A.log("(TIME) Strophe Attaching:\t",t),this.connection.attach(e.jid,e.sid,parseInt(e.rid,10)+1,this.connectionHandler.bind(this,{jid:e.jid,password:e.password}))}},{key:"_resetState",value:function(){this.anonymousConnectionFailed=!1,this.connectionFailed=!1,this.lastErrorMsg=void 0,this.disconnectInProgress=void 0}},{key:"connect",value:function(e,t){if(!e){var n=this.options.hosts,i=n.anonymousdomain,r=n.domain,a=i||r,o=window.location;if(i){var s=o&&o.search;(s&&-1!==s.indexOf("login=true")||this.token)&&(a=r)}e=a||o&&o.hostname}return this._connect(e,t)}},{key:"createRoom",value:function(e,t,n){var i="".concat(e,"@").concat(t.customDomain?t.customDomain:this.options.hosts.muc.toLowerCase(),"/"),r=n?n(this.connection.jid,this.authenticatedUser):y.a.randomHexString(8).toLowerCase();return A.info("JID ".concat(this.connection.jid," using MUC nickname ").concat(r)),i+=r,this.connection.emuc.createRoom(i,null,t)}},{key:"getJid",value:function(){return this.connection.jid}},{key:"getJingleLog",value:function(){var e=this.connection.jingle;return e?e.getLog():{}}},{key:"getXmppLog",value:function(){return(this.connection.logger||{}).log||null}},{key:"dial",value:function(){var e;(e=this.connection.rayo).dial.apply(e,arguments)}},{key:"ping",value:function(e){var t=this;return new Promise((function(n,i){t.connection.ping.ping(t.connection.pingDomain,n,i,e)}))}},{key:"getSessions",value:function(){return this.connection.jingle.sessions}},{key:"disconnect",value:function(e){var t=this;return this.disconnectInProgress?this.disconnectInProgress:this.connection?(this.disconnectInProgress=new Promise((function(e){t.eventEmitter.on(h.a.CONNECTION_STATUS_CHANGED,(function n(i,r){r===c.Strophe.Status.DISCONNECTED&&(e(),t.eventEmitter.removeListener(h.a.CONNECTION_STATUS_CHANGED,n))}))})),this._cleanupXmppConnection(e),this.disconnectInProgress):Promise.resolve()}},{key:"_cleanupXmppConnection",value:function(e){if(!this.connection.isUsingWebSocket&&this.connection.flush(),!this.connection.isUsingWebSocket&&null!==e&&"undefined"!==typeof e){var t=e.type;if(("beforeunload"===t||"unload"===t)&&(this.connection.options.sync=!0,this.connection.sendUnavailableBeacon()))return}this.connection.disconnect(),!0!==this.connection.options.sync&&this.connection.flush()}},{key:"_initStrophePlugins",value:function(){var e={jvb:{iceServers:[]},p2p:{iceServers:[]}},t=this.options.p2p&&this.options.p2p.stunServers||R;Array.isArray(t)&&(A.info("P2P STUN servers: ",t),e.p2p.iceServers=t),this.options.p2p&&this.options.p2p.iceTransportPolicy&&(A.info("P2P ICE transport policy: ",this.options.p2p.iceTransportPolicy),e.p2p.iceTransportPolicy=this.options.p2p.iceTransportPolicy),this.connection.addConnectionPlugin("emuc",new O.a(this)),this.connection.addConnectionPlugin("jingle",new _.a(this,this.eventEmitter,e)),this.connection.addConnectionPlugin("rayo",new T.a)}},{key:"_getConnectionFailedReasonDetails",value:function(){var e={};if(this.options.deploymentInfo&&this.options.deploymentInfo.shard&&this.connection.lastResponseHeaders){var t=this.connection.lastResponseHeaders.trim().split(/[\r\n]+/),n={};t.forEach((function(e){var t=e.split(": "),i=t.shift(),r=t.join(": ");n[i]=r})),e.shard_changed=this.options.deploymentInfo.shard!==n["x-jitsi-shard"]}return e.suspend_time=this.connection.ping.getPingSuspendTime(),e.time_since_last_success=this.connection.getTimeSinceLastSuccess(),e}},{key:"sendDominantSpeakerEvent",value:function(e){if(this.speakerStatsComponentAddress&&e){var t=Object(c.$msg)({to:this.speakerStatsComponentAddress});t.c("speakerstats",{xmlns:"http://jitsi.org/jitmeet",room:e}).up(),this.connection.send(t)}}},{key:"tryParseJSONAndVerify",value:function(e){if(!e)return!1;try{var t=JSON.parse(e);if(t&&"object"===typeof t){var n=t[I];if("undefined"!==typeof n)return t;A.debug("parsing valid json but does not have correct structure","topic: ",n)}}catch(i){return A.error("Error parsing json ".concat(e),i),!1}return!1}},{key:"_onPrivateMessage",value:function(e){var t=e.getAttribute("from");if(t!==this.speakerStatsComponentAddress&&t!==this.conferenceDurationComponentAddress&&t!==this.avModerationComponentAddress)return!0;var n=$(e).find(">json-message").text(),i=this.tryParseJSONAndVerify(n);return!i||("speakerstats"===i[I]&&i.users?this.eventEmitter.emit(h.a.SPEAKER_STATS_RECEIVED,i.users):"conference_duration"===i[I]&&i.created_timestamp?this.eventEmitter.emit(h.a.CONFERENCE_TIMESTAMP_RECEIVED,i.created_timestamp):"av_moderation"===i[I]&&this.eventEmitter.emit(h.a.AV_MODERATION_RECEIVED,i),!0)}}]),n}(g.a)}).call(this,"/index.js")},function(e,t,n){"use strict";n.r(t),n.d(t,"STATUS_AVAILABLE",(function(){return i})),n.d(t,"STATUS_UNDEFINED",(function(){return r})),n.d(t,"STATUS_BUSY",(function(){return a})),n.d(t,"STATE_ON",(function(){return o})),n.d(t,"STATE_OFF",(function(){return s})),n.d(t,"STATE_PENDING",(function(){return c})),n.d(t,"STATE_RETRYING",(function(){return u})),n.d(t,"STATE_FAILED",(function(){return l})),n.d(t,"ERROR_NO_CONNECTION",(function(){return d})),n.d(t,"ERROR_SESSION_EXISTS",(function(){return h}));var i="available",r="undefined",a="busy",o="on",s="off",c="pending",u="retrying",l="failed",d="error_no_connection",h="error_session_already_exists"},,function(e,t,n){"use strict";n.r(t),n.d(t,"CONNECTION_DISCONNECTED",(function(){return i})),n.d(t,"CONNECTION_ESTABLISHED",(function(){return r})),n.d(t,"CONNECTION_FAILED",(function(){return a})),n.d(t,"WRONG_STATE",(function(){return o})),n.d(t,"DISPLAY_NAME_REQUIRED",(function(){return s}));var i="connection.connectionDisconnected",r="connection.connectionEstablished",a="connection.connectionFailed",o="connection.wrongState",s="connection.display_name_required"},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return o})),n.d(t,"e",(function(){return s}));var i="statistics.audioLevel",r="statistics.before_disposed",a="statistics.byte_sent_stats",o="statistics.connectionstats",s="statistics.long_tasks_stats"},,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var i,r,a,o=n(24),s=n(8),c=n(12),u=(n(83),n(6)),l=n(22),d=n(11),h=n(4),p=function e(t,n,i,r,a,o,s){Object(u.a)(this,e),this.type="text",this.text=void 0,this.pid=void 0,this.name=void 0,this.avatarUrl=void 0,this.timestamp=void 0,this.colors=void 0,this.text=t,this.pid=n,this.name=i,this.avatarUrl=r,this.colors=a,this.timestamp=o,this.type=s},f=new(i=function(){function e(){Object(u.a)(this,e),Object(o.a)(this,"messages",r,this),Object(o.a)(this,"sendTo",a,this),Object(h.g)(this)}return Object(s.a)(e,[{key:"limitMessages",value:function(){f.messages.length>1e3&&f.messages.splice(0,f.messages.length-1e3)}},{key:"addMessage",value:function(e){this.messages.push(e),this.limitMessages()}},{key:"participantNameChanged",value:function(e,t){var n=d.a.find(e);if(n){var i=new p("",n.id,n.information.name,n.information.avatarSrc,n.getColor(),Date.now(),"log");i.text=Object(l.c)("cmNameChanged",{old:t,new:i.name}),this.addMessage(i)}}},{key:"participantJoined",value:function(e){var t=d.a.find(e);if(t){var n=new p("",t.id,t.information.name,t.information.avatarSrc,t.getColor(),Date.now(),"log");n.text=Object(l.c)("cmJoined",{name:n.name}),this.addMessage(n)}}},{key:"participantLeft",value:function(e){var t=d.a.find(e);if(t){var n=new p("",t.id,t.information.name,t.information.avatarSrc,t.getColor(),Date.now(),"log");n.text=Object(l.c)("cmLeft",{name:n.name}),this.addMessage(n)}}},{key:"calledBy",value:function(e){var t=new p("",e.id,e.information.name,e.information.avatarSrc,e.getColor(),Date.now(),"called");t.text=Object(l.c)("cmCallBy",{name:t.name}),this.addMessage(t)}},{key:"callTo",value:function(e){var t=new p("",e.id,e.information.name,e.information.avatarSrc,e.getColor(),Date.now(),"callTo");t.text=Object(l.c)("cmCallTo",{name:t.name}),this.addMessage(t)}}]),e}(),r=Object(c.a)(i.prototype,"messages",[h.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),a=Object(c.a)(i.prototype,"sendTo",[h.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Object(c.a)(i.prototype,"limitMessages",[h.b],Object.getOwnPropertyDescriptor(i.prototype,"limitMessages"),i.prototype),Object(c.a)(i.prototype,"addMessage",[h.b],Object.getOwnPropertyDescriptor(i.prototype,"addMessage"),i.prototype),i);t.b=f},,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a}));var i={DISCONNECTED:"disconnected",CONNECTING:"connecting",CONNECTED:"connected"},r="_contentTrackCarrier",a="_roomInfoPeeper"},,function(e,t,n){"use strict";function i(e,t){return[e[0]+t[0],e[1]+t[1]]}function r(e,t){return[e[0]-t[0],e[1]-t[1]]}function a(e,t){return[t[0]*e,t[1]*e]}function o(e,t){return[e*t[0],e*t[1]]}function s(e,t){return[e*t[0],e*t[1],e*t[2]]}function c(e){var t=0;return e.forEach((function(e){return t+=e*e})),Math.sqrt(t)}function u(e){return e*Math.PI/180}function l(e){return 180*e/Math.PI}function d(e,t){var n=u(e.orientation),i=Math.sin(n),r=Math.cos(n),a=[t.position[0]-e.position[0],t.position[1]-e.position[1]],o=[a[1]*i+a[0]*r,a[1]*r-a[0]*i],s=t.orientation-e.orientation;return{position:o,orientation:s<0?s+360:s}}function h(e){var t=u(e.orientation);return{position:[e.position[0],0,-e.position[1]],orientation:[Math.sin(t),0,Math.cos(t)]}}function p(e,t){var n=e*(Math.PI/180),i=Math.cos(n),r=Math.sin(n);return[i*t[0]-r*t[1],r*t[0]+i*t[1]]}function f(e,t){return e[0]*t[0]+e[1]*t[1]}function m(e){return Math.sqrt(e.reduce((function(e,t){return e+t*t}),0))}function v(e){return[e[1],-e[0]]}function g(e){return Math.round(100*e)/100}function b(e){return"".concat(g(e.position[0]),",").concat(g(e.position[1]),",").concat(g(e.orientation))}function y(e){return"".concat(e.position[0],",").concat(e.position[1],",").concat(e.show?"t":"")}function E(e){var t=e.split(",");return{position:[Number(t[0]),Number(t[1])],orientation:Number(t[2])}}function S(e){var t=e.split(",");return{position:[Number(t[0]),Number(t[1])],show:!!t[2]}}n.d(t,"a",(function(){return i})),n.d(t,"p",(function(){return r})),n.d(t,"f",(function(){return a})),n.d(t,"g",(function(){return o})),n.d(t,"h",(function(){return s})),n.d(t,"i",(function(){return c})),n.d(t,"k",(function(){return l})),n.d(t,"d",(function(){return d})),n.d(t,"b",(function(){return h})),n.d(t,"m",(function(){return p})),n.d(t,"c",(function(){return f})),n.d(t,"q",(function(){return m})),n.d(t,"l",(function(){return v})),n.d(t,"j",(function(){return b})),n.d(t,"e",(function(){return y})),n.d(t,"o",(function(){return E})),n.d(t,"n",(function(){return S}))},,,,function(e,t,n){"use strict";(function(e){var i,r,a=n(186),o=n(18),s=n(360),c=n.n(s),u=Object(o.getLogger)(e);function l(){return"".concat(Math.random().toString(16),"000000000").substr(2,8)}t.a={_storage:a.b,init:function(e){this._storage=e||a.b},get callStatsUserName(){return i||(i=this._storage.getItem("callStatsUserName"))||(i=function(){var e=c.a.generateUsername();return u.log("generated callstats uid",e),e}(),this._storage.setItem("callStatsUserName",i)),i},get machineId(){if(!r){var e=this._storage.getItem("billingId");r=e||this._storage.getItem("jitsiMeetId"),e?this._storage.setItem("jitsiMeetId",e):r||(r=function(){var e=l()+l()+l()+l();return u.log("generated id",e),e}(),this._storage.setItem("jitsiMeetId",r))}return r},get sessionId(){return this._storage.getItem("sessionId")},set sessionId(e){e?this._storage.setItem("sessionId",e):this._storage.removeItem("sessionId")}}}).call(this,"/index.js")},function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return d}));var i=n(15),r=n(6),a=n(8),o=n(74);function s(e){return parseInt(e.ssrcs.split(" ")[0],10)}function c(e){return parseInt(e.ssrcs.split(" ")[1],10)}function u(e){return e.ssrcs?e.ssrcs.map((function(e){return e.id})).filter((function(e,t,n){return n.indexOf(e)===t})).length:0}var l=function(){function e(t){if(Object(r.a)(this,e),!t)throw new Error("mLine is undefined");this.mLine=t}return Object(a.a)(e,[{key:"ssrcs",get:function(){return this.mLine.ssrcs||(this.mLine.ssrcs=[]),this.mLine.ssrcs},set:function(e){this.mLine.ssrcs=e}},{key:"direction",get:function(){return this.mLine.direction},set:function(e){this.mLine.direction=e}},{key:"ssrcGroups",get:function(){return this.mLine.ssrcGroups||(this.mLine.ssrcGroups=[]),this.mLine.ssrcGroups},set:function(e){this.mLine.ssrcGroups=e}},{key:"getSSRCAttrValue",value:function(e,t){var n=this.ssrcs.find((function(n){return n.id===e&&n.attribute===t}));return n&&n.value}},{key:"removeSSRC",value:function(e){this.mLine.ssrcs&&this.mLine.ssrcs.length&&(this.mLine.ssrcs=this.mLine.ssrcs.filter((function(t){return t.id!==e})))}},{key:"addSSRCAttribute",value:function(e){this.ssrcs.push(e)}},{key:"findGroup",value:function(e,t){return this.ssrcGroups.find((function(n){return n.semantics===e&&(!t||t===n.ssrcs)}))}},{key:"findGroups",value:function(e){return this.ssrcGroups.filter((function(t){return t.semantics===e}))}},{key:"findGroupByPrimarySSRC",value:function(e,t){return this.ssrcGroups.find((function(n){return n.semantics===e&&s(n)===t}))}},{key:"findSSRCByMSID",value:function(e){return this.ssrcs.find((function(t){return"msid"===t.attribute&&(null===e||t.value===e)}))}},{key:"getSSRCCount",value:function(){return u(this.mLine)}},{key:"containsAnySSRCGroups",value:function(){return void 0!==this.mLine.ssrcGroups}},{key:"getPrimaryVideoSsrc",value:function(){var e=this.mLine.type;if("video"!==e)throw new Error("getPrimarySsrc doesn't work with '".concat(e,"'"));if(1===u(this.mLine))return this.mLine.ssrcs[0].id;if(this.mLine.ssrcGroups){var t=this.findGroup("SIM");if(t)return s(t);var n=this.findGroup("FID");if(n)return s(n);var i=this.findGroup("FEC-FR");if(i)return s(i)}}},{key:"getRtxSSRC",value:function(e){var t=this.findGroupByPrimarySSRC("FID",e);return t&&c(t)}},{key:"getSSRCs",value:function(){return this.ssrcs.map((function(e){return e.id})).filter((function(e,t,n){return n.indexOf(e)===t}))}},{key:"getPrimaryVideoSSRCs",value:function(){var e=this.mLine.type;if("video"!==e)throw new Error("getPrimaryVideoSSRCs doesn't work with ".concat(e));var t,n=this.getSSRCs(),r=Object(i.a)(this.ssrcGroups);try{for(r.s();!(t=r.n()).done;){var a=t.value;if("FID"===a.semantics||"FEC-FR"===a.semantics){var o=c(a);n.splice(n.indexOf(o),1)}}}catch(s){r.e(s)}finally{r.f()}return n}},{key:"dumpSSRCGroups",value:function(){return JSON.stringify(this.mLine.ssrcGroups)}},{key:"removeGroupsWithSSRC",value:function(e){this.mLine.ssrcGroups&&(this.mLine.ssrcGroups=this.mLine.ssrcGroups.filter((function(t){return-1===t.ssrcs.indexOf("".concat(e))})))}},{key:"removeGroupsBySemantics",value:function(e){this.mLine.ssrcGroups&&(this.mLine.ssrcGroups=this.mLine.ssrcGroups.filter((function(t){return t.semantics!==e})))}},{key:"replaceSSRC",value:function(e,t){this.mLine.ssrcs&&this.mLine.ssrcs.forEach((function(n){n.id===e&&(n.id=t)}))}},{key:"addSSRCGroup",value:function(e){this.ssrcGroups.push(e)}}]),e}(),d=function(){function e(t){Object(r.a)(this,e),this.parsedSDP=o.parse(t)}return Object(a.a)(e,[{key:"selectMedia",value:function(e){var t=this.parsedSDP.media.find((function(t){return t.type===e}));return t?new l(t):null}},{key:"toRawSDP",value:function(){return o.write(this.parsedSDP)}}]),e}()},,,function(e,t,n){"use strict";n.d(t,"d",(function(){return a})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return c}));var i=n(6),r=n(8);function a(e){var t=e;return e>=Number.MAX_SAFE_INTEGER&&(t=0),t+1}function o(e){return e.length>0?e.reduce((function(e,t){return e+t}))/e.length:0}function s(e){return e.filter((function(e){return e>=0}))}var c=function(){function e(){Object(i.a)(this,e),this.average=0,this.n=0}return Object(r.a)(e,[{key:"addNext",value:function(e){"number"===typeof e&&(this.n+=1,this.average=this.average+(e-this.average)/this.n)}},{key:"getAverage",value:function(){return this.average}}]),e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"LOCAL_STATS_UPDATED",(function(){return i})),n.d(t,"REMOTE_STATS_UPDATED",(function(){return r}));var i="cq.local_stats_updated",r="cq.remote_stats_updated"},,,,,function(e,t,n){"use strict";var i=n(11);n.d(t,"a",(function(){return i.a}))},function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a}));var i="pending",r="active",a="ended"},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i={ACCEPT:"session-accept",CONNECTION_ERROR:"connection-error-encountered",INITIATE:"session-initiate",TERMINATE:"session-terminate",TRANSPORT_INFO:"transport-info",UNAVAILABLE:"unavailable"}},,,,,function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return w}));var i,r=n(15),a=n(6),o=n(8),s=n(20),c=n(43),u=n.n(c),l=n(18).getLogger(e),d="createOffer",h="createAnswer",p="setLocalDescription",f="setRemoteDescription",m="addIceCandidate",v="getUserMedia",g="iceConnectionFailure",b="applicationLog",y="fabricHold",E="fabricResume",S="audioMute",O="audioUnmute",_="videoPause",C="videoResume",T="screenShareStart",j="screenShareStop",A="dominantSpeaker",k="activeDeviceList",R="error",I="event",P="mstWithUserID",w=function(){function e(t,n){Object(a.a)(this,e),this.confID=n.confID,this.tpc=t,this.peerconnection=t.peerconnection,this.remoteUserID=n.remoteUserID||"jitsi",this.hasFabric=!1,e.fabrics.add(this),e.backendInitialized&&(this._addNewFabric(),1===e.fabrics.size&&e._emptyReportQueue(this))}return Object(o.a)(e,[{key:"_addNewFabric",value:function(){l.info("addNewFabric",this.remoteUserID);try{var t={remoteEndpointType:this.tpc.isP2P?e.backend.endpointType.peer:e.backend.endpointType.server},n=e.backend.addNewFabric(this.peerconnection,this.remoteUserID,e.backend.fabricUsage.multiplex,this.confID,t,e._addNewFabricCallback);this.hasFabric=!0;var i="success"===n.status;return i||l.error("callstats fabric not initilized",n.message),i}catch(r){return u.a.callErrorHandler(r),!1}}},{key:"associateStreamWithVideoTag",value:function(t,n,i,r,a){if(e.backend){var o=n?e.userID:i;e.backendInitialized?e.backend.associateMstWithUserID(this.peerconnection,o,this.confID,t,r,a):e.reportsQueue.push({type:P,pc:this.peerconnection,data:{callStatsId:o,containerId:a,ssrc:t,usageLabel:r}})}}},{key:"sendDominantSpeakerEvent",value:function(){e._reportEvent(this,A)}},{key:"sendTerminateEvent",value:function(){e.backendInitialized&&e.backend.sendFabricEvent(this.peerconnection,e.backend.fabricEvent.fabricTerminated,this.confID),e.fabrics.delete(this)}},{key:"sendIceConnectionFailedEvent",value:function(){e._reportError(this,g,null,this.peerconnection)}},{key:"sendCreateOfferFailed",value:function(t){e._reportError(this,d,t,this.peerconnection)}},{key:"sendCreateAnswerFailed",value:function(t){e._reportError(this,h,t,this.peerconnection)}},{key:"sendResumeOrHoldEvent",value:function(t){e._reportEvent(this,t?E:y)}},{key:"sendScreenSharingEvent",value:function(t,n){var i;n&&(i={ssrc:n}),e._reportEvent(this,t?T:j,i)}},{key:"sendSetLocalDescFailed",value:function(t){e._reportError(this,p,t,this.peerconnection)}},{key:"sendSetRemoteDescFailed",value:function(t){e._reportError(this,f,t,this.peerconnection)}},{key:"sendAddIceCandidateFailed",value:function(t){e._reportError(this,m,t,this.peerconnection)}}],[{key:"_addNewFabricCallback",value:function(t,n){e.backend&&"success"!==t&&l.error("Monitoring status: ".concat(t," msg: ").concat(n))}},{key:"_initCallback",value:function(t,n){if(l.log("CallStats Status: err=".concat(t," msg=").concat(n)),"success"===t){e.backendInitialized=!0;var i,a=!1,o=null,s=Object(r.a)(e.fabrics.values());try{for(s.s();!(i=s.n()).done;){var c=i.value;c.hasFabric||(l.debug("addNewFabric - initCallback"),c._addNewFabric()&&(a=!0,o||(o=c)))}}catch(u){s.e(u)}finally{s.f()}a&&e._emptyReportQueue(o)}}},{key:"_emptyReportQueue",value:function(t){var n,i=t.confID,a=t.peerconnection,o=Object(r.a)(e.reportsQueue);try{for(o.s();!(n=o.n()).done;){var s=n.value;if(s.type===R){var c=s.data;e._reportError(t,c.type,c.error,c.pc||a)}else if(s.type===I){var u=s.data;e.backend.sendFabricEvent(s.pc||a,u.event,i,u.eventData)}else if(s.type===P){var l=s.data;e.backend.associateMstWithUserID(s.pc||a,l.callStatsId,i,l.ssrc,l.usageLabel,l.containerId)}}}catch(d){o.e(d)}finally{o.f()}e.reportsQueue.length=0}},{key:"_reportError",value:function(t,n,i,r){var a=i;a||(l.warn("No error is passed!"),a=new Error("Unknown error")),e.backendInitialized&&t?e.backend.reportError(r,t.confID,n,a):e.reportsQueue.push({type:R,data:{error:a,pc:r,type:n}})}},{key:"_reportEvent",value:function(t,n,i){var r=t&&t.peerconnection,a=t&&t.confID;e.backendInitialized&&t?e.backend.sendFabricEvent(r,n,a,i):e.reportsQueue.push({confID:a,pc:r,type:I,data:{event:n,eventData:i}})}},{key:"_traceAndCatchBackendCalls",value:function(e){for(var t=function(){var t=i[n],r=e[t];e[t]=function(){try{for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return r.apply(e,n)}catch(a){u.a.callErrorHandler(a)}}},n=0,i=["associateMstWithUserID","sendFabricEvent","sendUserFeedback"];n<i.length;n++)t();for(var r=function(){var t=o[a],n=e[t];e[t]=function(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];l.debug(t,r),n.apply(e,r)}},a=0,o=["associateMstWithUserID","sendFabricEvent","sendUserFeedback"];a<o.length;a++)r();var c=e.reportError;e.reportError=function(t,n,i){for(var r=arguments.length,a=new Array(r>3?r-3:0),o=3;o<r;o++)a[o-3]=arguments[o];i===b?s.a.isReactNative()||console&&console.debug("reportError",t,n,i):l.debug.apply(l,["reportError",t,n,i].concat(a));try{c.call.apply(c,[e,t,n,i].concat(a))}catch(d){i===b?console&&console.error("reportError",d):u.a.callErrorHandler(d)}}}},{key:"fabrics",get:function(){return i||(i=new Set),i}},{key:"initBackend",value:function(t){if(e.backend)throw new Error("CallStats backend has been initialized already!");try{var n,i=callstats;if(e.backend=new i,e._traceAndCatchBackendCalls(e.backend),e.userID={aliasName:t.aliasName,userName:t.userName},e.callStatsID=t.callStatsID,e.callStatsSecret=t.callStatsSecret,t.applicationName&&(n={applicationVersion:"".concat(t.applicationName," (").concat(s.a.getName(),")")}),t.confID){var r=t.confID.match(/.*\/(.*)\/.*/);n.siteID=t.siteID||r&&r[1]||"/"}e.backend.initialize(e.callStatsID,e.callStatsSecret,e.userID,e._initCallback,void 0,n);var a=t.getWiFiStatsMethod;return a&&(e.backend.attachWifiStatsHandler(a),a().then((function(e){e&&l.info("Reported wifi addresses:",JSON.parse(e).addresses)})).catch((function(){}))),!0}catch(o){return u.a.callErrorHandler(o),e.backend=null,l.error(o),!1}}},{key:"isBackendInitialized",value:function(){return Boolean(e.backend)}},{key:"sendActiveDeviceListEvent",value:function(t,n){e._reportEvent(n,k,t)}},{key:"sendApplicationLog",value:function(t,n){try{e._reportError(n,b,t,n&&n.peerconnection)}catch(i){console&&"function"===typeof console.error&&console.error("sendApplicationLog failed",i)}}},{key:"sendFeedback",value:function(t,n,i){return new Promise((function(r,a){if(e.backend)e.backend.sendUserFeedback(t,{userID:e.userID,overall:n,comment:i},(function(e,t){"success"===e?r(t):a(t)}));else{var o="Failed to submit feedback to CallStats - no backend";l.error(o),a(o)}}))}},{key:"sendGetUserMediaFailed",value:function(t,n){e._reportError(n,v,t,null)}},{key:"sendMuteEvent",value:function(t,n,i){var r;r="video"===n?t?_:C:t?S:O,e._reportEvent(i,r)}}]),e}();w.backend=null,w.reportsQueue=[],w.backendInitialized=!1,w.callStatsID=null,w.callStatsSecret=null,w.userID=null}).call(this,"/index.js")},,,,function(e,t,n){"use strict";var i,r,a,o,s,c,u,l=n(24),h=n(6),p=n(8),f=n(12),m=(n(83),n(56)),v=n(3),g=n(4),b=.5,y=new(i=function(){function e(){Object(h.a)(this,e),Object(l.a)(this,"matrix",r,this),Object(l.a)(this,"committedMatrix",a,this),Object(l.a)(this,"screenSize",o,this),Object(l.a)(this,"left",s,this),Object(l.a)(this,"mouse",c,this),Object(l.a)(this,"mouseOnMap",u,this),this.keyInputUsers=new Set,Object(g.g)(this),this.loadMatrixFromStorage()}return Object(p.a)(e,[{key:"offset",get:function(){return[-(this.left+this.screenSize[0]*b),-this.screenSize[1]*b]}},{key:"offsetFromElement",get:function(){return[-this.screenSize[0]*b,-this.screenSize[1]*b]}},{key:"rotation",get:function(){return Object(v.C)(Object(v.i)(this.committedMatrix))}},{key:"setMatrix",value:function(e){this.matrix=e}},{key:"setCommittedMatrix",value:function(e){var t=this.toWindow(this.mouseOnMap);this.committedMatrix=e,this.mouseOnMap=this.fromWindow(t),this.saveMatrixToStorage(!1)}},{key:"setScreenSize",value:function(e){this.screenSize[0]=e[0],this.screenSize[1]=e[1]}},{key:"setLeft",value:function(e){this.left=e}},{key:"setMouse",value:function(e){this.mouse=Object(v.a)(e,this.offset),this.mouseOnMap=Object(v.N)(this.matrix.inverse(),this.mouse)}},{key:"focusOn",value:function(e){var t=this.matrix.inverse(),n=Object(v.M)(e.pose.position,[t.e,t.f]),i=(new DOMMatrix).translate(-n[0],-n[1]).preMultiplySelf(this.matrix);this.setMatrix(i),this.setCommittedMatrix(i)}},{key:"toWindow",value:function(e){return Object(v.M)(Object(v.N)(this.matrix,e),this.offset)}},{key:"fromWindow",value:function(e){return Object(v.N)(this.matrix.inverse(),Object(v.a)(e,this.offset))}},{key:"toElement",value:function(e){return Object(v.M)(Object(v.N)(this.matrix,e),this.offsetFromElement)}},{key:"rotateFromWindow",value:function(e){return Object(v.H)(this.matrix.inverse(),e)}},{key:"rotateToWindow",value:function(e){return Object(v.H)(this.matrix,e)}},{key:"visibleArea",value:function(){var e=this.fromWindow([0,0]),t=this.fromWindow(this.screenSize),n=m.a;return[e[1]-n,t[0]+n,t[1]+n,e[0]-n]}},{key:"saveMatrixToStorage",value:function(e){var t=sessionStorage;e&&(t=localStorage);var n=[this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f];t.setItem("mapMatrix",JSON.stringify(n))}},{key:"loadMatrixFromStorage",value:function(){var e=localStorage;sessionStorage.getItem("mapMatrix")&&(e=sessionStorage);var t=e.getItem("mapMatrix");if(t){var n=JSON.parse(t),i=new DOMMatrix;i.a=n[0],i.b=n[1],i.c=n[2],i.d=n[3],i.e=n[4],i.f=n[5],this.setMatrix(i),this.setCommittedMatrix(i)}}}]),e}(),r=Object(f.a)(i.prototype,"matrix",[g.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new DOMMatrixReadOnly}}),a=Object(f.a)(i.prototype,"committedMatrix",[g.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new DOMMatrixReadOnly}}),o=Object(f.a)(i.prototype,"screenSize",[g.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[0,0]}}),Object(f.a)(i.prototype,"offset",[g.d],Object.getOwnPropertyDescriptor(i.prototype,"offset"),i.prototype),Object(f.a)(i.prototype,"offsetFromElement",[g.d],Object.getOwnPropertyDescriptor(i.prototype,"offsetFromElement"),i.prototype),Object(f.a)(i.prototype,"rotation",[g.d],Object.getOwnPropertyDescriptor(i.prototype,"rotation"),i.prototype),s=Object(f.a)(i.prototype,"left",[g.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),c=Object(f.a)(i.prototype,"mouse",[g.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[0,0]}}),u=Object(f.a)(i.prototype,"mouseOnMap",[g.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[0,0]}}),Object(f.a)(i.prototype,"setMatrix",[g.b],Object.getOwnPropertyDescriptor(i.prototype,"setMatrix"),i.prototype),Object(f.a)(i.prototype,"setCommittedMatrix",[g.b],Object.getOwnPropertyDescriptor(i.prototype,"setCommittedMatrix"),i.prototype),Object(f.a)(i.prototype,"setScreenSize",[g.b],Object.getOwnPropertyDescriptor(i.prototype,"setScreenSize"),i.prototype),Object(f.a)(i.prototype,"setLeft",[g.b],Object.getOwnPropertyDescriptor(i.prototype,"setLeft"),i.prototype),Object(f.a)(i.prototype,"setMouse",[g.b],Object.getOwnPropertyDescriptor(i.prototype,"setMouse"),i.prototype),Object(f.a)(i.prototype,"focusOn",[g.b],Object.getOwnPropertyDescriptor(i.prototype,"focusOn"),i.prototype),Object(f.a)(i.prototype,"loadMatrixFromStorage",[g.b],Object.getOwnPropertyDescriptor(i.prototype,"loadMatrixFromStorage"),i.prototype),i);d.map=y,t.a=y},,,function(e,t){function n(e,t){return Math.floor(Math.random()*(t-e+1))+e}function i(e){return e[n(0,e.length-1)]}var r={randomHexDigit:function(){return i("0123456789abcdef")},randomHexString:function(e){for(var t="";e--;)t+=this.randomHexDigit();return t},randomElement:i,randomAlphanumStr:function(e){for(var t="",n=0;n<e;n+=1)t+=i("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ");return t},randomInt:n};e.exports=r},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var i=n(8),r=n(36),a=n(35),o=n(6),s=n(72);function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return function e(){Object(o.a)(this,e)}}();return function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(){var e;Object(o.a)(this,n);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).connection=null,e}return Object(i.a)(n,[{key:"init",value:function(e){this.connection=e}}]),n}(e)}t.b=c();var u=c(s.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return _}));var i,r,a=n(30),o=n(24),s=n(6),c=n(8),u=n(12),l=(n(83),n(7)),h=n(56),p=n(3),f=n(106),m=n(17),v=n(4),g=function(e){};function b(e){return{pose:Object(l.a)({},e.pose),onStage:!1}}var y=(i=function(){function e(){Object(s.a)(this,e),this.local=void 0,this.updateAll=!0,this.updateSet=new Set,this.limits=[-1,-1],this.limitUpdated=!1,this.priorityMaps=[new Map,new Map],this.lastPriority=[[],[]],Object(o.a)(this,"tracksToAccept",r,this),this.disposers=[],this._enabled=!1,this.local=b(f.a.local),Object(v.g)(this)}return Object(c.a)(e,[{key:"clear",value:function(){this.disable(),this.updateAll=!0,this.updateSet.clear(),this.priorityMaps.forEach((function(e){return e.clear()})),this.lastPriority=[[],[]],this.tracksToAccept=[[],[]]}},{key:"setLimits",value:function(e){this.limits[0]=e[0],this.limits[1]=e[1],this.limitUpdated=!0}},{key:"onRemoteTrackAdded",value:function(e){this.updateSet.add(e.getParticipantId())}},{key:"enabled",get:function(){return this._enabled}},{key:"enable",value:function(){var e=this;this.updateAll=!0;var t=Object(v.c)((function(){var t=f.a.local;e.local=b(t),e.updateAll=!0})),n=new Map,i=Object(v.c)((function(){var e=new Map(f.a.remote),t=Object(p.f)(e,n);Object(p.f)(n,e).forEach(s),t.forEach(u),n=e})),r=new Map,a=Object(v.c)((function(){var e=new Map(m.b.tracks.remoteContents),t=Object(p.f)(e,r);Object(p.f)(r,e).forEach(c),t.forEach(l),r=e})),o=new Map,s=function(t){var n=o.get(t.id);if(void 0===n)throw new Error("Cannot find disposer for remote participant with id: ".concat(t.id));n(),e.priorityMaps.forEach((function(e){return e.delete(t.id)})),o.delete(t.id),e.updateSet.add(t.id),g("onRemoveParticipant:",t,e.priorityMaps[0])},c=function(t,n){var i=o.get(n);if(void 0===i)throw new Error("Cannot find disposer for remote participant with id: ".concat(n));i(),e.priorityMaps.forEach((function(e){return e.delete(n)})),o.delete(n),e.updateSet.add(n),g("onRemoveContent:",n,e.priorityMaps[0])},u=function(t){o.set(t.id,Object(v.c)((function(){if(t.tracks.audio||t.tracks.avatar){t.physics.onStage||f.a.yarnPhones.has(t.id),t.pose.position;e.updateSet.add(t.id)}}))),g("onAddParticipant:",t,e.priorityMaps[0])},l=function(t,n){o.set(n,Object(v.c)((function(){if(t.size){m.b.find(n);e.updateSet.add(t.values().next().value.getParticipantId())}}))),g("onAddContent:",n,e.priorityMaps[0])};this.disposers=[t,i,a],this._enabled=!0}},{key:"disable",value:function(){this.disposers.forEach((function(e){return e()})),this._enabled=!1}},{key:"update",value:function(){if(!this.haveUpdates)return this.lastPriority;var e=this.calcPriority();return this.updateAll=!1,this.updateSet.clear(),this.limitUpdated=!1,e}},{key:"calcPriority",value:function(){var e=this;Array.from(f.a.remote.keys()).filter((function(t){return!!e.updateAll||e.updateSet.has(t)})).forEach((function(t){var n=f.a.remote.get(t);n&&[n.tracks.avatar,n.tracks.audio].forEach((function(t,i){if(t){var r=function(e,t){return{endpointId:e.id,onStage:t.isAudioTrack()&&(e.physics.onStage||f.a.yarnPhones.has(e.id)),pose:Object(l.a)({},e.pose),size:[0,0],offset:0,priority:0,muted:t.isAudioTrack()?e.muteAudio:e.muteVideo}}(n,t);r.priority=e.calcPriorityValue(e.local,r),e.priorityMaps[i].set(n.id,r)}}))})),Array.from(m.b.tracks.remoteContents.values()).map((function(e){var t=e.values().next();return t.done?void 0:t.value.getParticipantId()})).filter((function(t){return t&&(!!e.updateAll||e.updateSet.has(t))})).forEach((function(t){var n=m.b.tracks.carrierMap.get(t),i=n?m.b.find(n):void 0;if(i){var r=Array.from(m.b.tracks.remoteContents.get(i.id));[r.find((function(e){return e.isVideoTrack()})),r.find((function(e){return e.isAudioTrack()}))].forEach((function(t,n){if(t){var r=function(e,t){return{endpointId:t.getParticipantId(),onStage:!1,pose:Object(l.a)({},e.pose),size:e.size,offset:10*-h.a,priority:0,muted:!1}}(i,t);r.priority=e.calcPriorityValue(e.local,r),e.priorityMaps[n].set(i.id,r)}}))}}));var t=this.priorityMaps.map((function(e){return Array.from(e.values()).sort((function(e,t){return e.priority-t.priority}))})),n=m.b.tracks.remoteMainTrack();n&&t.forEach((function(e,t){var i=n[t];if(i){var r=function(e){return{endpointId:e.getParticipantId(),onStage:!0,pose:{position:[0,0],orientation:0},size:[0,0],offset:100*-h.a,priority:0,muted:!1}}(i);e.unshift(r)}}));var i=[[],[]];i[0]=t[0].filter((function(e){return!e.muted})),i[0].splice(this.limits[0]),i[1]=t[1];var r=t[1].filter((function(e){return e.muted})).length;i[1].splice(Math.min(this.limits[0]+r,i[1].length)),this.tracksToAccept=i;var a=this.tracksToAccept.map((function(e){return e.map((function(e){return e.endpointId}))}));return this.lastPriority=a,this.lastPriority}},{key:"calcPriorityValue",value:function(e,t){if(t.onStage)return 0;var n=t.size.map((function(n,i){var r=t.pose.position[i]-e.pose.position[i];return r<0&&(r+=n)>0&&(r=0),r}));return Math.sqrt(n[0]*n[0]+n[1]*n[1])+t.offset}},{key:"haveUpdates",get:function(){return this.updateAll||0!==this.updateSet.size||this.limitUpdated}}]),e}(),r=Object(u.a)(i.prototype,"tracksToAccept",[v.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[[],[]]}}),i),E=n(280),S=n(45),O=n.n(S),_=new y;d.priorityCalculator=_;var C=void 0;Object(v.c)((function(){var e=E.a.state;"connected"===e?(_.enable(),C=window.setInterval(T,1e3)):"disconnected"===e&&(_.disable(),void 0!==C&&clearInterval(C))})),Object(v.c)((function(){var e=f.a.local;_.setLimits([e.remoteVideoLimit,e.remoteAudioLimit])}));var T=function(){var e=void 0;return function(){var t=_.update();if(!O.a.isEqual(t,e)){var n={onStageEndpoints:t[0]};a.b.conference.setReceiverConstraints(n),a.b.conference.setPerceptibles(t),g("setPerceptibles:",t),e=O.a.cloneDeep(t)}}}()},,function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"g",(function(){return o})),n.d(t,"k",(function(){return s})),n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return u})),n.d(t,"f",(function(){return l})),n.d(t,"e",(function(){return d})),n.d(t,"j",(function(){return h})),n.d(t,"h",(function(){return p})),n.d(t,"i",(function(){return f})),n.d(t,"b",(function(){return m}));var i=n(27),r=n(15);function a(e){if(!e)throw new Error("Not a truthy value")}var o=/Chrome/.test(navigator.userAgent);/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);function s(e,t){var n;if(e.size!==t.size)return!1;var a,o=Object(r.a)(e);try{for(o.s();!(a=o.n()).done;){var s=Object(i.a)(a.value,2),c=s[0],u=s[1];if((n=t.get(c))!==u||void 0===n&&!t.has(c))return!1}}catch(l){o.e(l)}finally{o.f()}return!0}function c(e,t){var n,i=new Map(e),a=Object(r.a)(t);try{for(a.s();!(n=a.n()).done;){var o=n.value;i.delete(o[0])}}catch(s){a.e(s)}finally{a.f()}return i}function u(e,t){var n,i=new Set(e),a=Object(r.a)(t);try{for(a.s();!(n=a.n()).done;){var o=n.value;i.delete(o)}}catch(s){a.e(s)}finally{a.f()}return i}function l(e,t){var n=new Map;return e.forEach((function(e,i){t.has(i)&&n.set(i,e)})),n}function d(e){return function(t){var n,i={},a=Object(r.a)(Object.keys(e));try{for(a.s();!(n=a.n()).done;){var o=n.value;i[o]=t[o]}}catch(s){a.e(s)}finally{a.f()}return i}}function h(){return!!navigator.userAgent.match(/iPhone|Android.+Mobile/)}function p(){return window.parent.screen.width<window.parent.screen.height}function f(e){return e.host===window.location.host&&e.pathname===window.location.pathname}function m(e){var t=new Image;return t.src=e,new Promise((function(n,i){t.onload=function(){n(e)},t.onerror=function(){i("")}}))}},function(e,t,n){"use strict";n.r(t),n.d(t,"CONNECTION_DROPPED_ERROR",(function(){return i})),n.d(t,"OTHER_ERROR",(function(){return r})),n.d(t,"PASSWORD_REQUIRED",(function(){return a})),n.d(t,"SERVER_ERROR",(function(){return o}));var i="connection.droppedError",r="connection.otherError",a="connection.passwordRequired",o="connection.serverError"},,,function(e,t,n){"use strict";function i(e){for(var t=0,n=0;n!==e.length;n+=1)t=e.charCodeAt(n)+13*t;var i=t%4096;return[17*(Math.floor(i/256)%16),17*(Math.floor(i/16)%16),17*(Math.floor(i)%16)]}function r(e){return a(e)?[255,255,136]:[0,0,136]}function a(e){return e[0]+e[1]+.2*e[2]<340}function o(e){return[255-e[0],255-e[1],255-e[2]]}function s(e){var t=[Math.floor(e[0]),Math.floor(e[1]),Math.floor(e[2])],n=t[1],i=t[2];return"#".concat("0".concat(t[0].toString(16)).slice(-2)).concat("0".concat(n.toString(16)).slice(-2)).concat("0".concat(i.toString(16)).slice(-2))}function c(e){return function(e){var t=e[0]/17,n=e[1]/17,i=e[2]/17,r=a(e)?"#FF8":"#008";return["#".concat(t.toString(16)).concat(n.toString(16)).concat(i.toString(16)),r,"#".concat((15-t).toString(16)).concat((15-n).toString(16)).concat((15-i).toString(16))]}(i(e))}function u(e,t){return"rgba(".concat(e[0],",").concat(e[1],",").concat(e[2],",").concat(t,")")}n.d(t,"d",(function(){return i})),n.d(t,"b",(function(){return r})),n.d(t,"e",(function(){return a})),n.d(t,"a",(function(){return o})),n.d(t,"f",(function(){return s})),n.d(t,"c",(function(){return c})),n.d(t,"g",(function(){return u}))},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return v}));var i=n(15),r=n(6),a=n(8),o=n(31),s=n(36),c=n(35),u=n(18),l=n(13),d=(n(492),n(72)),h=n(351),p=n(353),f=n(354),m=Object(u.getLogger)(e),v=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e){var i,a=e.enableWebsocketResume,s=e.websocketKeepAlive,c=e.websocketKeepAliveUrl,u=e.serviceUrl,d=e.shard,m=e.xmppPing;return Object(r.a)(this,n),(i=t.call(this))._options={enableWebsocketResume:"undefined"===typeof a||a,pingOptions:m,shard:d,websocketKeepAlive:"undefined"===typeof s?6e4:Number(s),websocketKeepAliveUrl:c},i._stropheConn=new l.Strophe.Connection(u),i._usesWebsocket=u.startsWith("ws:")||u.startsWith("wss:"),i._stropheConn.maxRetries=3,i._rawInputTracker=new p.a,i._rawInputTracker.startTracking(Object(o.a)(i),i._stropheConn),i._resumeTask=new h.a(i._stropheConn),i._deferredIQs=[],i.addConnectionPlugin("ping",new f.a({getTimeSinceLastServerResponse:function(){return i.getTimeSinceLastSuccess()},onPingThresholdExceeded:function(){return i._onPingErrorThresholdExceeded()},pingOptions:m})),i._oneSuccessfulConnect=!1,i}return Object(a.a)(n,[{key:"connected",get:function(){var e=this._stropheConn&&this._stropheConn._proto&&this._stropheConn._proto.socket;return(this._status===l.Strophe.Status.CONNECTED||this._status===l.Strophe.Status.ATTACHED)&&(!this.isUsingWebSocket||e&&e.readyState===WebSocket.OPEN)}},{key:"disco",get:function(){return this._stropheConn.disco}},{key:"disconnecting",get:function(){return!0===this._stropheConn.disconnecting}},{key:"domain",get:function(){return this._stropheConn.domain}},{key:"isUsingWebSocket",get:function(){return this._usesWebsocket}},{key:"jid",get:function(){return this._stropheConn.jid}},{key:"lastResponseHeaders",get:function(){return this._stropheConn._proto&&this._stropheConn._proto.lastResponseHeaders}},{key:"logger",get:function(){return this._stropheConn.logger}},{key:"options",get:function(){return this._stropheConn.options}},{key:"pingDomain",get:function(){var e;return(null===(e=this._options.pingOptions)||void 0===e?void 0:e.domain)||this.domain}},{key:"service",get:function(){return this._stropheConn.service}},{key:"status",get:function(){return this._status}},{key:"addConnectionPlugin",value:function(e,t){this[e]=t,t.init(this)}},{key:"addHandler",value:function(){var e;(e=this._stropheConn).addHandler.apply(e,arguments)}},{key:"attach",value:function(e,t,n,i){for(var r,a=arguments.length,o=new Array(a>4?a-4:0),s=4;s<a;s++)o[s-4]=arguments[s];(r=this._stropheConn).attach.apply(r,[e,t,n,this._stropheConnectionCb.bind(this,i)].concat(o))}},{key:"connect",value:function(e,t,n){for(var i,r=arguments.length,a=new Array(r>3?r-3:0),o=3;o<r;o++)a[o-3]=arguments[o];(i=this._stropheConn).connect.apply(i,[e,t,this._stropheConnectionCb.bind(this,n)].concat(a))}},{key:"_stropheConnectionCb",value:function(e,t){this._status=t;var i,r=!1;t===l.Strophe.Status.CONNECTED||t===l.Strophe.Status.ATTACHED?(this._maybeEnableStreamResume(),this._usesWebsocket&&this._oneSuccessfulConnect&&this._keepAliveAndCheckShard(),this._oneSuccessfulConnect=!0,this._maybeStartWSKeepAlive(),this._processDeferredIQs(),this._resumeTask.cancel(),this.ping.startInterval((null===(i=this._options.pingOptions)||void 0===i?void 0:i.domain)||this.domain)):t===l.Strophe.Status.DISCONNECTED&&(this.ping.stopInterval(),(r=this._tryResumingConnection())||clearTimeout(this._wsKeepAlive));if(!r){for(var a=arguments.length,o=new Array(a>2?a-2:0),s=2;s<a;s++)o[s-2]=arguments[s];e.apply(void 0,[t].concat(o)),this.eventEmitter.emit(n.Events.CONN_STATUS_CHANGED,t)}}},{key:"_clearDeferredIQs",value:function(){var e,t=Object(i.a)(this._deferredIQs);try{for(t.s();!(e=t.n()).done;){e.value.reject(new Error("disconnect"))}}catch(n){t.e(n)}finally{t.f()}this._deferredIQs=[]}},{key:"closeWebsocket",value:function(){this._stropheConn&&this._stropheConn._proto&&(this._stropheConn._proto._closeSocket(),this._stropheConn._proto._onClose(null))}},{key:"disconnect",value:function(){var e;this._resumeTask.cancel(),clearTimeout(this._wsKeepAlive),this._clearDeferredIQs(),(e=this._stropheConn).disconnect.apply(e,arguments)}},{key:"flush",value:function(){var e;(e=this._stropheConn).flush.apply(e,arguments)}},{key:"getTimeSinceLastSuccess",value:function(){return this._rawInputTracker.getTimeSinceLastSuccess()}},{key:"getLastFailedMessage",value:function(){return this._rawInputTracker.getLastFailedMessage()}},{key:"_maybeEnableStreamResume",value:function(){if(this._options.enableWebsocketResume){var e=this._stropheConn.streamManagement;this.isUsingWebSocket?e?e.isSupported()?e.getResumeToken()||(m.info("Enabling XEP-0198 stream management"),e.enable(!0)):m.warn("Stream resume enabled, but XEP-0198 is not supported by the server"):m.warn("Stream resume enabled, but Strophe streamManagement plugin is not installed"):m.warn("Stream resume enabled, but WebSockets are not enabled")}}},{key:"_maybeStartWSKeepAlive",value:function(){var e=this,t=this._options.websocketKeepAlive;if(this._usesWebsocket&&t>0){this._wsKeepAlive||m.info("WebSocket keep alive interval: ".concat(t,"ms")),clearTimeout(this._wsKeepAlive);var n=t+60*Math.random()*1e3;m.debug("Scheduling next WebSocket keep-alive in ".concat(n,"ms")),this._wsKeepAlive=setTimeout((function(){return e._keepAliveAndCheckShard().then((function(){return e._maybeStartWSKeepAlive()}))}),n)}}},{key:"_keepAliveAndCheckShard",value:function(){var e=this,t=this._options,i=t.shard,r=t.websocketKeepAliveUrl,a=r||this.service.replace("wss://","https://").replace("ws://","http://");return fetch(a).then((function(t){if(i){var r=t.headers.get("x-jitsi-shard");r!==i&&(m.error("Detected that shard changed from ".concat(i," to ").concat(r)),e.eventEmitter.emit(n.Events.CONN_SHARD_CHANGED))}})).catch((function(e){m.error("Websocket Keep alive failed for url: ".concat(a),{error:e})}))}},{key:"_processDeferredIQs",value:function(){var e,t=this,n=Object(i.a)(this._deferredIQs);try{var r=function(){var n=e.value;if(n.iq){clearTimeout(n.timeout);var i=Date.now()-n.start;t.sendIQ(n.iq,(function(e){return n.resolve(e)}),(function(e){return n.reject(e)}),i)}};for(n.s();!(e=n.n()).done;)r()}catch(a){n.e(a)}finally{n.f()}this._deferredIQs=[]}},{key:"send",value:function(e){if(!this.connected)throw new Error("Not connected");this._stropheConn.send(e)}},{key:"sendIQ",value:function(e,t,n,i){if(this.connected)return this._stropheConn.sendIQ(e,t,n,i);n("Not connected")}},{key:"sendIQ2",value:function(e,t){var n=this,i=t.timeout;return new Promise((function(t,r){if(n.connected)n.sendIQ(e,(function(e){return t(e)}),(function(e){return r(e)}),i);else{var a={iq:e,resolve:t,reject:r,start:Date.now(),timeout:setTimeout((function(){a.iq=void 0,r(void 0)}),i)};n._deferredIQs.push(a)}}))}},{key:"_onPingErrorThresholdExceeded",value:function(){this.isUsingWebSocket&&(m.warn("Ping error threshold exceeded - killing the WebSocket"),this.closeWebsocket())}},{key:"sendPresence",value:function(e,t,n,i){this.connected?this._stropheConn.sendPresence(e,t,n,i):n("Not connected")}},{key:"sendUnavailableBeacon",value:function(){if(!navigator.sendBeacon||this._stropheConn.disconnecting||!this._stropheConn.connected)return!1;this._stropheConn._changeConnectStatus(l.Strophe.Status.DISCONNECTING),this._stropheConn.disconnecting=!0;var e=this._stropheConn._proto._buildBody().attrs({type:"terminate"}),t=Object(l.$pres)({xmlns:l.Strophe.NS.CLIENT,type:"unavailable"});e.cnode(t.tree());var n=navigator.sendBeacon(-1===this.service.indexOf("https://")?"https:".concat(this.service):this.service,l.Strophe.serialize(e.tree()));return m.info("Successfully send unavailable beacon ".concat(n)),this._stropheConn._proto._abortAllRequests(),this._stropheConn._doDisconnect(),!0}},{key:"_tryResumingConnection",value:function(){var e=this._stropheConn.streamManagement;return!(!e||!e.getResumeToken())&&(this._resumeTask.schedule(),!0)}}],[{key:"Events",get:function(){return{CONN_STATUS_CHANGED:"CONN_STATUS_CHANGED",CONN_SHARD_CHANGED:"CONN_SHARD_CHANGED"}}},{key:"Status",get:function(){return l.Strophe.Status}}]),n}(d.a)}).call(this,"/index.js")},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}));var i="signaling.peerMuted",r="signaling.peerVideoType"},,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}));var i="https://api.callstats.io/static/callstats-ws.min.js",r=5},,function(e,t,n){"use strict";function i(){"granted"!==Notification.permission&&"denied"!==Notification.permission&&Notification.requestPermission()}function r(e,t){"granted"===Notification.permission&&new Notification(e,t)}n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}))},,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(6),r=n(8),a=function(){function e(){var t=this;Object(i.a)(this,e),this.promise=new Promise((function(e,n){t.resolve=function(){t.clearRejectTimeout(),e.apply(void 0,arguments)},t.reject=function(){t.clearRejectTimeout(),n.apply(void 0,arguments)}})),this.then=this.promise.then.bind(this.promise),this.catch=this.promise.catch.bind(this.promise)}return Object(r.a)(e,[{key:"clearRejectTimeout",value:function(){clearTimeout(this._timeout)}},{key:"setRejectTimeout",value:function(e){var t=this;this._timeout=setTimeout((function(){t.reject(new Error("timeout"))}),e)}}]),e}()},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return s}));var i=n(70),r=n(52),a=n(20),o=n(18).getLogger(e),s=5,c={obtainStream:null,init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=e,this.obtainStream=this._createObtainStreamMethod(),this.obtainStream||o.info("Desktop sharing disabled")},_createObtainStreamMethod:function(){return a.a.isNWJS()?function(e,t){window.JitsiMeetNW.obtainDesktopStream(e,(function(e,n){var a;a=e&&"InvalidStateError"===e.name?new i.a(r.SCREENSHARING_USER_CANCELED):new i.a(e,n,["desktop"]),"function"===typeof t&&t(a)}))}:a.a.isElectron()?this.obtainScreenOnElectron:a.a.isReactNative()&&a.a.supportsGetDisplayMedia()?this.obtainScreenFromGetDisplayMediaRN:a.a.supportsGetDisplayMedia()?this.obtainScreenFromGetDisplayMedia:(o.log("Screen sharing not supported on ",a.a.getName()),null)},_getAudioConstraints:function(){var e=this.options.audioQuality;return null===e||void 0===e||!e.stereo||{autoGainControl:!1,channelCount:2,echoCancellation:!1,noiseSuppression:!1}},isSupported:function(){return null!==this.obtainStream},obtainScreenOnElectron:function(e,t){var n=this;if(window.JitsiMeetScreenObtainer&&window.JitsiMeetScreenObtainer.openDesktopPicker){var a=this.options,o=a.desktopSharingFrameRate,c=a.desktopSharingSources;window.JitsiMeetScreenObtainer.openDesktopPicker({desktopSharingSources:c||["screen","window"]},(function(a,c){var u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(a){var l,d,h=!1;if(u){h={};var p=n._getAudioConstraints();"boolean"!==typeof p&&(h={optional:p}),"screen"===c&&(h.mandatory={chromeMediaSource:"desktop"})}var f={audio:h,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,minFrameRate:null!==(l=null===o||void 0===o?void 0:o.min)&&void 0!==l?l:s,maxFrameRate:null!==(d=null===o||void 0===o?void 0:o.max)&&void 0!==d?d:s,maxWidth:window.screen.width,maxHeight:window.screen.height}}};navigator.mediaDevices.getUserMedia(f).then((function(t){return e({stream:t,sourceId:a,sourceType:c})}),t)}else t(new i.a(r.SCREENSHARING_USER_CANCELED))}),(function(e){return t(new i.a(r.ELECTRON_DESKTOP_PICKER_ERROR,e))}))}else t(new i.a(r.ELECTRON_DESKTOP_PICKER_NOT_FOUND))},obtainScreenFromGetDisplayMedia:function(e,t){var n;n=navigator.getDisplayMedia?navigator.getDisplayMedia.bind(navigator):navigator.mediaDevices.getDisplayMedia.bind(navigator.mediaDevices);var a=this.options.desktopSharingFrameRate,s="object"!==typeof a||{frameRate:a},c=this._getAudioConstraints();s.frameRate&&delete s.frameRate.min;var u={video:s,audio:c,cursor:"always"};o.info("Using getDisplayMedia for screen sharing",u),n(u).then((function(t){e({stream:t,sourceId:t.id})})).catch((function(e){var n={errorName:e&&e.name,errorMsg:e&&e.message,errorStack:e&&e.stack};o.error("getDisplayMedia error",u,n),n.errorMsg&&-1!==n.errorMsg.indexOf("denied by system")?t(new i.a(r.PERMISSION_DENIED)):t(new i.a(r.SCREENSHARING_USER_CANCELED))}))},obtainScreenFromGetDisplayMediaRN:function(e,t){o.info("Using getDisplayMedia for screen sharing"),navigator.mediaDevices.getDisplayMedia({video:!0}).then((function(t){e({stream:t,sourceId:t.id})})).catch((function(){t(new i.a(r.SCREENSHARING_USER_CANCELED))}))}};t.b=c}).call(this,"/index.js")},function(e,t){e.exports={ENVIRONMENT:"environment",USER:"user"}},,function(e,t,n){"use strict";n.r(t),n.d(t,"DEVICE_LIST_CHANGED",(function(){return i})),n.d(t,"PERMISSIONS_CHANGED",(function(){return r})),n.d(t,"PERMISSION_PROMPT_IS_SHOWN",(function(){return a})),n.d(t,"SLOW_GET_USER_MEDIA",(function(){return o}));var i="mediaDevices.devicechange",r="rtc.permissions_changed",a="mediaDevices.permissionPromptIsShown",o="mediaDevices.slowGetUserMedia"},,,,function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return E})),n.d(t,"a",(function(){return S}));var i=n(6),r=n(8),a=n(36),o=n(35),s=n(122),c=n(61),u=n(58),l=n(11),d=n(17),h=n(55),p=n(287),f=n.n(p),m=n(62),v=n.n(m),g=n(457),b=n(90),y=function(e){};e.$=f.a,e.jQuery=f.a;var E={useIPv6:!1,disableSimulcast:!0,enableWindowOnErrorHandler:!0,enableAnalyticsLogging:!1,disableThiredPartyRequests:!1,disableAudioLevels:!1,desktopSharingChromeExtId:"mbocklcggfhnbahlnepmldehdhpjfcjp",desktopSharingChromeDisabled:!1,desktopSharingChromeSources:["screen","window"],desktopSharingChromeMinExtVersion:"0.1",desktopSharingFirefoxDisabled:!1,desktopSharingFrameRate:{min:.3,max:30}},S=function(e){Object(a.a)(n,e);var t=Object(o.a)(n);function n(){var e;Object(i.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a)))._jitsiConnection=void 0,e._store=void 0,e.conference=new g.a,e.version="0.0.1",e.state=b.a.DISCONNECTED,e}return Object(r.a)(n,[{key:"Store",set:function(e){this._store=e}},{key:"init",value:function(){var e=this;return Object.assign(E,config.rtc.screenOptions),new Promise((function(t,n){v.a.init(E),v.a.setLogLevel("warn"),e._jitsiConnection=new v.a.JitsiConnection(null,void 0,config),e._jitsiConnection.addEventListener(v.a.events.connection.CONNECTION_ESTABLISHED,(function(){e.onStateChanged(b.a.CONNECTED),t(v.a.events.connection.CONNECTION_ESTABLISHED)})),e._jitsiConnection.addEventListener(v.a.events.connection.CONNECTION_FAILED,(function(){e.onStateChanged(b.a.DISCONNECTED),n(v.a.events.connection.CONNECTION_FAILED)})),e._jitsiConnection.addEventListener(v.a.events.connection.CONNECTION_DISCONNECTED,(function(){e.onStateChanged(b.a.DISCONNECTED)})),e._jitsiConnection.connect(),e.onStateChanged(b.a.CONNECTING)}))}},{key:"joinConference",value:function(e){var t=this;if(!this._jitsiConnection)throw new Error("No connection has been established.");this.conference.init(e,(function(){var n;return null===(n=t._jitsiConnection)||void 0===n?void 0:n.initJitsiConference(e.toLowerCase(),config)}))}},{key:"leaveConference",value:function(){return this.conference.uninit()}},{key:"disconnect",value:function(){var e;return this._jitsiConnection?(y("Disconnection order has been sent."),null===(e=this._jitsiConnection)||void 0===e?void 0:e.disconnect()):Promise.reject("No connection has been established.")}},{key:"reconnect",value:function(){var e=this;u.a.setType("retry"),l.a.leaveAll(),d.b.clearAllRemotes(),s.a.clear(),this.leaveConference().then((function(){console.log("Disconnected but succeed in leaving... strange ... try to join again.")})).catch((function(){var t;console.log("Disconnected and failed to leave... try to join again"),null===(t=e.conference.bmRelaySocket)||void 0===t||t.close()})).finally((function(){null!==c.a.testBot&&window.location.reload()}))}},{key:"onStateChanged",value:function(e){var t=this;this.state!==e&&e===b.a.DISCONNECTED&&setTimeout((function(){t._jitsiConnection.disconnect().finally((function(){setTimeout(t.reconnect.bind(t),1e3)}))}),1e3),this.state=e,this._store&&this._store.changeState(this.state)}}]),n}(h.EventEmitter)}).call(this,n(94))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(209),r=new(n(157).a);r.Store=i.a,d.connection=r},,,,,function(e,t,n){var i=n(489),r={loadScript:function(e,t,n,r,a,o){var s=document,c="script",u=s.createElement(c),l=s.getElementsByTagName(c)[0];if(u.async=t,r){var d=i();if(d){var h=d.src,p=h.substring(0,h.lastIndexOf("/")+1);h&&p&&(e=p+e)}}a&&(u.onload=a),o&&(u.onerror=o),u.src=e,n?l.parentNode.insertBefore(u,l):l.parentNode.appendChild(u)}};e.exports=r},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return g})),n.d(t,"b",(function(){return b}));var i=n(7),r=n(15),a=n(6),o=n(8),s=n(18),c=n(10),u=n(59),l=n(19),d=n(29),h=n.n(d),p=n(32),f=n(20),m=n(26),v=Object(s.getLogger)(e),g={ACTIVE:"active",INACTIVE:"inactive",INTERRUPTED:"interrupted",RESTORING:"restoring"},b=function(){function e(t,n,i){Object(a.a)(this,e),this.rtc=t,this.conference=n,this.trackTimers={},this.connStatusFromJvb={},this.outOfLastNTimeout="number"===typeof i.outOfLastNTimeout?i.outOfLastNTimeout:500,this.rtcMuteTimeout="number"===typeof i.rtcMuteTimeout?i.rtcMuteTimeout:1e4,this.rtcMutedTimestamp={},v.info("RtcMuteTimeout set to: ".concat(this.rtcMuteTimeout)),this.enteredLastNTimestamp=new Map,this.restoringTimers=new Map,this.connectionStatusMap=new Map}return Object(o.a)(e,[{key:"_getVideoFrozenTimeout",value:function(e){return this.rtc.isInLastN(e)?this.rtcMuteTimeout:this.outOfLastNTimeout}},{key:"init",value:function(){this._onEndpointConnStatusChanged=this.onEndpointConnStatusChanged.bind(this),this.rtc.addListener(h.a.ENDPOINT_CONN_STATUS_CHANGED,this._onEndpointConnStatusChanged),this._onP2PStatus=this.refreshConnectionStatusForAll.bind(this),this.conference.on(c.P2P_STATUS,this._onP2PStatus),this._onUserLeft=this.onUserLeft.bind(this),this.conference.on(c.USER_LEFT,this._onUserLeft),f.a.supportsVideoMuteOnConnInterrupted()&&(this._onTrackRtcMuted=this.onTrackRtcMuted.bind(this),this.rtc.addListener(h.a.REMOTE_TRACK_MUTE,this._onTrackRtcMuted),this._onTrackRtcUnmuted=this.onTrackRtcUnmuted.bind(this),this.rtc.addListener(h.a.REMOTE_TRACK_UNMUTE,this._onTrackRtcUnmuted),this._onRemoteTrackAdded=this.onRemoteTrackAdded.bind(this),this.conference.on(c.TRACK_ADDED,this._onRemoteTrackAdded),this._onRemoteTrackRemoved=this.onRemoteTrackRemoved.bind(this),this.conference.on(c.TRACK_REMOVED,this._onRemoteTrackRemoved),this._onSignallingMuteChanged=this.onSignallingMuteChanged.bind(this),this._onTrackVideoTypeChanged=this.onTrackVideoTypeChanged.bind(this)),this._onLastNChanged=this._onLastNChanged.bind(this),this.conference.on(c.LAST_N_ENDPOINTS_CHANGED,this._onLastNChanged),this._onLastNValueChanged=this.refreshConnectionStatusForAll.bind(this),this.rtc.on(h.a.LASTN_VALUE_CHANGED,this._onLastNValueChanged)}},{key:"dispose",value:function(){this.rtc.removeListener(h.a.ENDPOINT_CONN_STATUS_CHANGED,this._onEndpointConnStatusChanged),f.a.supportsVideoMuteOnConnInterrupted()&&(this.rtc.removeListener(h.a.REMOTE_TRACK_MUTE,this._onTrackRtcMuted),this.rtc.removeListener(h.a.REMOTE_TRACK_UNMUTE,this._onTrackRtcUnmuted),this.conference.off(c.TRACK_ADDED,this._onRemoteTrackAdded),this.conference.off(c.TRACK_REMOVED,this._onRemoteTrackRemoved)),this.conference.off(c.LAST_N_ENDPOINTS_CHANGED,this._onLastNChanged),this.rtc.removeListener(h.a.LASTN_VALUE_CHANGED,this._onLastNValueChanged),this.conference.off(c.P2P_STATUS,this._onP2PStatus),this.conference.off(c.USER_LEFT,this._onUserLeft);for(var e=0,t=Object.keys(this.trackTimers);e<t.length;e++){var n=t[e];this.clearTimeout(n),this.clearRtcMutedTimestamp(n)}for(var i in this.connectionStatusMap)this.connectionStatusMap.hasOwnProperty(i)&&this.onUserLeft(i);this.connStatusFromJvb={}}},{key:"onEndpointConnStatusChanged",value:function(e,t){v.debug("Detector RTCEvents.ENDPOINT_CONN_STATUS_CHANGED(".concat(Date.now(),"): ").concat(e,": ").concat(t)),e!==this.conference.myUserId()&&(this.connStatusFromJvb[e]=t,this.figureOutConnectionStatus(e))}},{key:"_changeConnectionStatus",value:function(e,t){if(e.getConnectionStatus()!==t){var n=e.getId();e._setConnectionStatus(t),v.debug("Emit endpoint conn status(".concat(Date.now(),") ").concat(n,": ").concat(t)),m.a.sendLog(JSON.stringify({id:"peer.conn.status",participant:n,status:t})),this.conference.eventEmitter.emit(c.PARTICIPANT_CONN_STATUS_CHANGED,n,t)}}},{key:"clearTimeout",value:function(e){this.trackTimers[e]&&(window.clearTimeout(this.trackTimers[e]),this.trackTimers[e]=null)}},{key:"clearRtcMutedTimestamp",value:function(e){this.rtcMutedTimestamp[e]=null}},{key:"onRemoteTrackAdded",value:function(e){var t=this;e.isLocal()||e.getType()!==l.c||(v.debug("Detector on remote track added for: ".concat(e.getParticipantId())),e.on(u.TRACK_MUTE_CHANGED,this._onSignallingMuteChanged),e.on(u.TRACK_VIDEOTYPE_CHANGED,(function(n){return t._onTrackVideoTypeChanged(e,n)})))}},{key:"onRemoteTrackRemoved",value:function(e){if(!e.isLocal()&&e.getType()===l.c){var t=e.getParticipantId();v.debug("Detector on remote track removed: ".concat(t)),e.off(u.TRACK_MUTE_CHANGED,this._onSignallingMuteChanged),this.clearTimeout(t),this.clearRtcMutedTimestamp(t),this.figureOutConnectionStatus(t)}}},{key:"isVideoTrackFrozen",value:function(e){if(!f.a.supportsVideoMuteOnConnInterrupted())return!1;var t=e.getId(),n=e.hasAnyVideoTrackWebRTCMuted(),i=this.rtcMutedTimestamp[t],r=this._getVideoFrozenTimeout(t);return n&&"number"===typeof i&&Date.now()-i>=r}},{key:"refreshConnectionStatusForAll",value:function(){var e,t=this.conference.getParticipants(),n=Object(r.a)(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;this.figureOutConnectionStatus(i.getId())}}catch(a){n.e(a)}finally{n.f()}}},{key:"figureOutConnectionStatus",value:function(t){var n=this.conference.getParticipantById(t);if(n){var r=this.conference.isP2PActive(),a=this._isRestoringTimedout(t),o=0===this.conference.getLastN(),s=n.isVideoMuted()||o,c=this.isVideoTrackFrozen(n),u=this.rtc.isInLastN(t),d=this.connStatusFromJvb[t];"boolean"!==typeof d&&(d=!0);var h=r?e._getNewStateForP2PMode(s,c):e._getNewStateForJvbMode(d,u,a,s,c);h!==g.RESTORING&&this._clearRestoringTimer(t),v.debug("Figure out conn status for ".concat(t,", is video muted: ").concat(s," is active(jvb): ").concat(d," video track frozen: ").concat(c," p2p mode: ").concat(r," is in last N: ").concat(u," currentStatus => newStatus: ").concat(n.getConnectionStatus()," => ").concat(h));var p=this.connectionStatusMap[t]||{};if(!("p2p"in p)||!("connectionStatus"in p)||p.p2p!==r||p.connectionStatus!==h){var f=Date.now();if(this.maybeSendParticipantConnectionStatusEvent(t,f),this.connectionStatusMap[t]=Object(i.a)(Object(i.a)({},p),{},{connectionStatus:h,p2p:r,startedMs:f}),!("videoType"in this.connectionStatusMap[t])){var m=n.getTracksByMediaType(l.c);Array.isArray(m)&&0!==m.length&&(this.connectionStatusMap[t].videoType=m[0].videoType)}}this._changeConnectionStatus(n,h)}else v.debug("figure out conn status - no participant for: ".concat(t))}},{key:"maybeSendParticipantConnectionStatusEvent",value:function(e,t){var n=this.connectionStatusMap[e];n&&"startedMs"in n&&"videoType"in n&&"connectionStatus"in n&&"p2p"in n&&(n.value=t-n.startedMs,m.a.sendAnalytics(Object(p.J)(n)))}},{key:"_onLastNChanged",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=Date.now();v.debug("leaving/entering lastN",e,t,n);var i,a=Object(r.a)(e);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.enteredLastNTimestamp.delete(o),this._clearRestoringTimer(o),this.figureOutConnectionStatus(o)}}catch(l){a.e(l)}finally{a.f()}var s,c=Object(r.a)(t);try{for(c.s();!(s=c.n()).done;){var u=s.value;this.enteredLastNTimestamp.set(u,n),this.figureOutConnectionStatus(u)}}catch(l){c.e(l)}finally{c.f()}}},{key:"_clearRestoringTimer",value:function(e){var t=this.restoringTimers.get(e);t&&(clearTimeout(t),this.restoringTimers.delete(e))}},{key:"_isRestoringTimedout",value:function(e){var t=this,n=this.enteredLastNTimestamp.get(e);return!!(n&&Date.now()-n>=1e4)||(this.restoringTimers.get(e)||this.restoringTimers.set(e,setTimeout((function(){return t.figureOutConnectionStatus(e)}),1e4)),!1)}},{key:"onUserLeft",value:function(e){this.maybeSendParticipantConnectionStatusEvent(e,Date.now()),delete this.connectionStatusMap[e]}},{key:"onTrackRtcMuted",value:function(e){var t=this,n=e.getParticipantId(),i=this.conference.getParticipantById(n);if(v.debug("Detector track RTC muted: ".concat(n),Date.now()),i){if(this.rtcMutedTimestamp[n]=Date.now(),!i.isVideoMuted()){this.clearTimeout(n);var r=this._getVideoFrozenTimeout(n);this.trackTimers[n]=window.setTimeout((function(){v.debug("Set RTC mute timeout for: ".concat(n,"                     of ").concat(r," ms")),t.clearTimeout(n),t.figureOutConnectionStatus(n)}),r)}}else v.error("No participant for id: ".concat(n))}},{key:"onTrackRtcUnmuted",value:function(e){var t=e.getParticipantId();v.debug("Detector track RTC unmuted: ".concat(t),Date.now()),this.clearTimeout(t),this.clearRtcMutedTimestamp(t),this.figureOutConnectionStatus(t)}},{key:"onSignallingMuteChanged",value:function(e){var t=e.getParticipantId();v.debug("Detector on track signalling mute changed: ".concat(t),e.isMuted()),this.figureOutConnectionStatus(t)}},{key:"onTrackVideoTypeChanged",value:function(e,t){var n=e.getParticipantId(),r=Date.now();this.maybeSendParticipantConnectionStatusEvent(n,r),this.connectionStatusMap[n]=Object(i.a)(Object(i.a)({},this.connectionStatusMap[n]||{}),{},{videoType:t,startedMs:r})}}],[{key:"_getNewStateForJvbMode",value:function(e,t,n,i,r){return e?i?g.ACTIVE:f.a.supportsVideoMuteOnConnInterrupted()?r?t?n?g.INTERRUPTED:g.RESTORING:g.INACTIVE:g.ACTIVE:t?g.ACTIVE:g.INACTIVE:g.INTERRUPTED}},{key:"_getNewStateForP2PMode",value:function(e,t){return f.a.supportsVideoMuteOnConnInterrupted()?e||!t?g.ACTIVE:g.INTERRUPTED:g.ACTIVE}}]),e}()}).call(this,"/index.js")},,,function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u}));var i=n(6),r=n(8),a=n(36),o=n(35),s=n(18),c=n(72),u="NETWORK_INFO_CHANGED",l=Object(s.getLogger)(e),d=new(function(e){Object(a.a)(n,e);var t=Object(o.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.call(this))._current={isOnline:!0},e}return Object(r.a)(n,[{key:"updateNetworkInfo",value:function(e){var t=e.isOnline;l.debug("updateNetworkInfo",{isOnline:t}),this._current={isOnline:!0===t},this.eventEmitter.emit(u,this._current)}},{key:"isOnline",value:function(){return!0===this._current.isOnline}}]),n}(c.a));t.b=d}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return A}));var i=n(6),r=n(8),a=n(31),o=n(103),s=n(85),c=n(36),u=n(35),l=n(18),d=n(70),h=n(52),p=n(59),f=n(151),m=n.n(f),v=n(19),g=n(29),b=n.n(g),y=n(50),E=n.n(y),S=n(32),O=n(20),_=n(26),C=n(216),T=n(42),j=Object(l.getLogger)(e),A=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var r,o=e.deviceId,s=e.facingMode,c=e.mediaType,u=e.resolution,l=e.rtcId,d=e.sourceId,h=e.sourceType,f=e.stream,m=e.track,v=e.videoType,g=e.effects,y=void 0===g?[]:g;Object(i.a)(this,n),(r=t.call(this,null,f,m,(function(){return r.emit(p.LOCAL_TRACK_STOPPED)}),c,v))._setEffectInProgress=!1;var S=y.find((function(e){return e.isEnabled(Object(a.a)(r))}));return S&&r._startStreamEffect(S),r.rtcId=l,r.sourceId=d,r.sourceType=h,r.resolution=m.getSettings().height,r.maxEnabledResolution=u,r._constraints=m.getConstraints(),Object.keys(r._constraints).length||v!==E.a.CAMERA||(r._constraints={height:m.getSettings().height,width:m.getSettings().width}),r.deviceId=o,r._prevSetMuted=Promise.resolve(),r._facingMode=s,r._trackEnded=!1,r._hasSentData=!1,r._testDataSent=!0,r._realDeviceId=""===r.deviceId?void 0:r.deviceId,r._trackMutedTS=0,r._onDeviceListWillChange=function(e){var t=r._realDeviceId;r._setRealDeviceIdFromDeviceList(e),("undefined"===typeof r.getTrack().readyState&&"undefined"!==typeof r._realDeviceId&&!e.find((function(e){return e.deviceId===r._realDeviceId}))||"undefined"!==typeof t&&"undefined"===typeof r._realDeviceId)&&(r._trackEnded=!0)},r.isAudioTrack()&&T.a.isDeviceChangeAvailable("output")&&(r._onAudioOutputDeviceChanged=r.setAudioOutput.bind(Object(a.a)(r)),T.a.addListener(b.a.AUDIO_OUTPUT_DEVICE_CHANGED,r._onAudioOutputDeviceChanged)),T.a.addListener(b.a.DEVICE_LIST_WILL_CHANGE,r._onDeviceListWillChange),r._initNoDataFromSourceHandlers(),r}return Object(r.a)(n,[{key:"isEnded",value:function(){return this.isVideoTrack()&&this.isMuted()?this._trackEnded:"ended"===this.getTrack().readyState||this._trackEnded}},{key:"_initNoDataFromSourceHandlers",value:function(){var e=this;this._isNoDataFromSourceEventsEnabled()&&(this._setHandler("track_mute",(function(){e._trackMutedTS=window.performance.now(),e._fireNoDataFromSourceEvent()})),this._setHandler("track_unmute",(function(){e._fireNoDataFromSourceEvent(),_.a.sendAnalyticsAndLog(S.s,{media_type:e.getType(),track_type:"local",value:window.performance.now()-e._trackMutedTS})})),this.isVideoTrack()&&this.videoType===E.a.CAMERA&&this._setHandler("track_ended",(function(){e.isReceivingData()||e._fireNoDataFromSourceEvent()})))}},{key:"_isNoDataFromSourceEventsEnabled",value:function(){return!this.isVideoTrack()||this.videoType!==E.a.DESKTOP}},{key:"_fireNoDataFromSourceEvent",value:function(){var e=!this.isReceivingData();this.emit(p.NO_DATA_FROM_SOURCE,e),_.a.sendAnalytics(Object(S.H)(this.getType(),e)),_.a.sendLog(JSON.stringify({name:p.NO_DATA_FROM_SOURCE,log:e}))}},{key:"_setRealDeviceIdFromDeviceList",value:function(e){var t=this.getTrack(),n="".concat(t.kind,"input"),i=e.find((function(e){return e.kind===n&&e.label===t.label}));if(!i&&"default"===this._realDeviceId){var r=(t.label||"").replace("Default - ","");i=e.find((function(e){return e.kind===n&&e.label===r}))}this._realDeviceId=i?i.deviceId:void 0}},{key:"_setStream",value:function(e){Object(o.a)(Object(s.a)(n.prototype),"_setStream",this).call(this,e),e?(this.storedMSID=this.getMSID(),j.debug("Setting new MSID: ".concat(this.storedMSID," on ").concat(this))):j.debug("Setting 'null' stream on ".concat(this))}},{key:"_startStreamEffect",value:function(e){this._streamEffect=e,this._originalStream=this.stream,this._setStream(this._streamEffect.startEffect(this._originalStream)),this.track=this.stream.getTracks()[0]}},{key:"_stopStreamEffect",value:function(){this._streamEffect&&(this._streamEffect.stopEffect(),this._setStream(this._originalStream),this._originalStream=null,this.track=this.stream?this.stream.getTracks()[0]:null)}},{key:"_switchStreamEffect",value:function(e){this._streamEffect&&(this._stopStreamEffect(),this._streamEffect=void 0),e&&this._startStreamEffect(e)}},{key:"setEffect",value:function(e){var t=this;if("undefined"===typeof this._streamEffect&&"undefined"===typeof e)return Promise.resolve();if("undefined"!==typeof e&&!e.isEnabled(this))return Promise.reject(new Error("Incompatible effect instance!"));if(!0===this._setEffectInProgress)return Promise.reject(new Error("setEffect already in progress!"));if(this.isMuted()&&!this.isAudioTrack())return this._streamEffect=e,Promise.resolve();var n=this.conference;return n?(this._setEffectInProgress=!0,n.removeTrack(this).then((function(){return t._switchStreamEffect(e),t.isVideoTrack()&&t.containers.forEach((function(e){return T.a.attachMediaStream(e,t.stream)})),n.addTrack(t)})).then((function(){t._setEffectInProgress=!1})).catch((function(e){throw t._setEffectInProgress=!1,t._switchStreamEffect(),j.error("Failed to switch to the new stream!",e),e}))):(this._switchStreamEffect(e),this.isVideoTrack()&&this.containers.forEach((function(e){return T.a.attachMediaStream(e,t.stream)})),Promise.resolve())}},{key:"mute",value:function(){return this._queueSetMuted(!0)}},{key:"unmute",value:function(){return this._queueSetMuted(!1)}},{key:"_queueSetMuted",value:function(e){var t=this._setMuted.bind(this,e);return this._prevSetMuted=this._prevSetMuted.then(t,t),this._prevSetMuted}},{key:"_setMuted",value:function(e){var t=this;if(this.isMuted()===e)return Promise.resolve();if(this.disposed)return Promise.reject(new d.a(h.TRACK_IS_DISPOSED));var n=Promise.resolve(),i=function(){return j.info("Mute ".concat(t,": ").concat(e))};if(this.isAudioTrack()||this.videoType===E.a.DESKTOP||!O.a.doesVideoMuteByStreamRemove())i(),this._streamEffect&&this._streamEffect.setMuted?this._streamEffect.setMuted(e):this.track&&(this.track.enabled=!e);else if(e)n=new Promise((function(e,n){i(),t._removeStreamFromConferenceAsMute((function(){t._streamEffect&&t._stopStreamEffect(),t._unregisterHandlers(),t.stopStream(),t._setStream(null),e()}),n)}));else{i();var r={cameraDeviceId:this.getDeviceId(),devices:[v.c],effects:this._streamEffect?[this._streamEffect]:[],facingMode:this.getCameraFacingMode()};n=(n=T.a.obtainAudioAndVideoPermissions(Object.assign({},r,{constraints:{video:this._constraints}}))).then((function(e){var n=t.getType()===v.b?v.c:t.getType(),i=e.find((function(e){return e.track.kind===n}));if(!i)throw new d.a(h.TRACK_NO_STREAM_FOUND);return t._setStream(i.stream),t.track=i.track,t.videoType!==i.videoType&&(j.warn("".concat(t,": video type has changed after unmute!"),t.videoType,i.videoType),t.videoType=i.videoType),t._streamEffect&&t._startStreamEffect(t._streamEffect),t.containers.map((function(e){return T.a.attachMediaStream(e,t.stream)})),t._addStreamToConferenceAsUnmute()}))}return n.then((function(){return t._sendMuteStatus(e)})).then((function(){return t.emit(p.TRACK_MUTE_CHANGED,t)}))}},{key:"_addStreamToConferenceAsUnmute",value:function(){var e=this;return this.conference?new Promise((function(t,n){e.conference._addLocalTrackAsUnmute(e).then(t,(function(e){return n(new Error(e))}))})):Promise.resolve()}},{key:"_removeStreamFromConferenceAsMute",value:function(e,t){this.conference?this.conference._removeLocalTrackAsMute(this).then(e,(function(e){return t(new Error(e))})):e()}},{key:"_sendMuteStatus",value:function(e){var t=this;return this.conference&&this.conference.room?new Promise((function(n){t.conference.room[t.isAudioTrack()?"setAudioMute":"setVideoMute"](e,n)})):Promise.resolve()}},{key:"dispose",value:function(){var e=this,t=Promise.resolve();return this._streamEffect&&(t=this.setEffect()),this.conference&&(t=t.then((function(){return e.conference.removeTrack(e)}))),this.stream&&(this.stopStream(),this.detach()),T.a.removeListener(b.a.DEVICE_LIST_WILL_CHANGE,this._onDeviceListWillChange),this._onAudioOutputDeviceChanged&&T.a.removeListener(b.a.AUDIO_OUTPUT_DEVICE_CHANGED,this._onAudioOutputDeviceChanged),t.then((function(){return Object(o.a)(Object(s.a)(n.prototype),"dispose",e).call(e)}))}},{key:"isMuted",value:function(){return!this.stream||(!(!this.isVideoTrack()||this.isActive())||(this._streamEffect&&this._streamEffect.isMuted?this._streamEffect.isMuted():!this.track||!this.track.enabled))}},{key:"_setConference",value:function(e){this.conference=e;for(var t=0;t<this.containers.length;t++)this._maybeFireTrackAttached(this.containers[t])}},{key:"isLocal",value:function(){return!0}},{key:"getDeviceId",value:function(){return this._realDeviceId||this.deviceId}},{key:"getParticipantId",value:function(){return this.conference&&this.conference.myUserId()}},{key:"_onByteSentStatsReceived",value:function(e,t){var n=this;t>0&&(this._hasSentData=!0);var i=e.getConnectionState();this._testDataSent&&"connected"===i&&(setTimeout((function(){n._hasSentData||(j.warn("".concat(n," 'bytes sent' <= 0:                         ").concat(t)),_.a.analytics.sendEvent(S.r,{media_type:n.getType()}))}),3e3),this._testDataSent=!1)}},{key:"getCameraFacingMode",value:function(){if(this.isVideoTrack()&&this.videoType===E.a.CAMERA){var e,t,n=null===(e=(t=this.track).getSettings)||void 0===e?void 0:e.call(t);return n&&"facingMode"in n?n.facingMode:"undefined"!==typeof this._facingMode?this._facingMode:m.a.USER}}},{key:"stopStream",value:function(){this._stopStreamInProgress=!0;try{T.a.stopMediaStream(this.stream)}finally{this._stopStreamInProgress=!1}}},{key:"_switchCamera",value:function(){this.isVideoTrack()&&this.videoType===E.a.CAMERA&&"function"===typeof this.track._switchCamera&&(this.track._switchCamera(),this._facingMode=this._facingMode===m.a.ENVIRONMENT?m.a.USER:m.a.ENVIRONMENT)}},{key:"isReceivingData",value:function(){return!(!this.isVideoTrack()||!this.isMuted()&&!this._stopStreamInProgress&&this.videoType!==E.a.DESKTOP)||!!this.stream&&(this._effectEnabled?this._originalStream:this.stream).getTracks().some((function(e){return(!("readyState"in e)||"live"===e.readyState)&&(!("muted"in e)||!0!==e.muted)}))}},{key:"toString",value:function(){return"LocalTrack[".concat(this.rtcId,",").concat(this.getType(),"]")}}]),n}(C.a)}).call(this,"/index.js")},function(e,t,n){"use strict";t.a={getFocusRecordingUpdate:function(e){var t=e&&e.getElementsByTagName("jibri-recording-status")[0];if(t)return{error:t.getAttribute("failure_reason"),initiator:t.getAttribute("initiator"),recordingMode:t.getAttribute("recording_mode"),sessionID:t.getAttribute("session_id"),status:t.getAttribute("status")}},getHiddenDomainUpdate:function(e){var t=e.getElementsByTagName("live-stream-view-url")[0],n=t&&t.textContent,i=e.getElementsByTagName("mode")[0],r=i&&i.textContent&&i.textContent.toLowerCase(),a=e.getElementsByTagName("session_id")[0];return{liveStreamViewURL:n,mode:r,sessionID:a&&a.textContent}},getSessionIdFromIq:function(e){var t=e&&e.getElementsByTagName("jibri")[0];return t&&t.getAttribute("session_id")},getSessionId:function(e){var t=e.getElementsByTagName("session_id")[0];return t&&t.textContent},isFromFocus:function(e){return e.getAttribute("from").includes("focus")}}},,,function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return w}));var i=n(53),r=n(60),a=n.n(r),o=n(15),s=n(87),c=n(6),u=n(8),l=n(31),d=n(36),h=n(35),p=n(189),f=n.n(p),m=n(18),v=n(105),g=n.n(v),b=n(292),y=n(10),E=n(149),S=n(72),O=n(77),_=Object(m.getLogger)(e),C="olm",T="error",j="key-info",A="key-info-ack",k="session-ack",R="session-init",I=Symbol("OlmData"),P={OLM_ID_KEY_READY:"olm.id_key_ready",PARTICIPANT_E2EE_CHANNEL_READY:"olm.participant_e2ee_channel_ready",PARTICIPANT_KEY_UPDATED:"olm.partitipant_key_updated"},w=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var i;return Object(c.a)(this,n),(i=t.call(this))._conf=e,i._init=new E.a,i._key=void 0,i._keyIndex=-1,i._reqs=new Map,i._sessionInitialization=void 0,n.isSupported()?(i._bootstrapOlm(),i._conf.on(y.ENDPOINT_MESSAGE_RECEIVED,i._onEndpointMessageReceived.bind(Object(l.a)(i))),i._conf.on(y.CONFERENCE_LEFT,i._onConferenceLeft.bind(Object(l.a)(i))),i._conf.on(y.USER_LEFT,i._onParticipantLeft.bind(Object(l.a)(i))),i._conf.on(y.PARTICIPANT_PROPERTY_CHANGED,i._onParticipantPropertyChanged.bind(Object(l.a)(i)))):i._init.reject(new Error("Olm not supported")),i}return Object(u.a)(n,[{key:"initSessions",value:function(){var e=Object(s.a)(a.a.mark((function e(){var t,n,i,r,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._sessionInitialization){e.next=4;break}throw new Error("OlmAdapter initSessions called multiple times");case 4:return this._sessionInitialization=new E.a,e.next=7,this._init;case 7:t=[],n=this._conf.myUserId(),i=Object(o.a)(this._conf.getParticipants()),e.prev=10,i.s();case 12:if((r=i.n()).done){e.next=20;break}return s=r.value,e.next=16,s.getFeatures();case 16:e.sent.has(O.b)&&n<s.getId()&&t.push(this._sendSessionInit(s));case 18:e.next=12;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(10),i.e(e.t0);case 25:return e.prev=25,i.f(),e.finish(25);case 28:return e.next=30,Promise.allSettled(t);case 30:this._sessionInitialization.resolve(),this._sessionInitialization=void 0;case 32:case"end":return e.stop()}}),e,this,[[10,22,25,28]])})));return function(){return e.apply(this,arguments)}}()},{key:"updateKey",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var n,r,s,c,u=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._key=t,this._keyIndex++,n=[],r=Object(o.a)(this._conf.getParticipants()),e.prev=4,c=function(){var e,t=s.value,r=t.getId(),a=u._getParticipantOlmData(t);if(!a.session)return _.warn("Tried to send key to participant ".concat(r," but we have no session")),"continue";var o=Object(b.a)(),c=(e={},Object(i.a)(e,O.d,C),Object(i.a)(e,"olm",{type:j,data:{ciphertext:u._encryptKeyInfo(a.session),uuid:o}}),e),l=new E.a;l.setRejectTimeout(5e3),l.catch((function(){u._reqs.delete(o)})),u._reqs.set(o,l),n.push(l),u._sendMessage(c,r)},r.s();case 7:if((s=r.n()).done){e.next=13;break}if("continue"!==c()){e.next=11;break}return e.abrupt("continue",11);case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return e.next=23,Promise.allSettled(n);case 23:return e.abrupt("return",this._keyIndex);case 24:case"end":return e.stop()}}),e,this,[[4,15,18,21]])})));return function(t){return e.apply(this,arguments)}}()},{key:"updateCurrentKey",value:function(e){return this._key=e,this._keyIndex}},{key:"clearParticipantSession",value:function(e){var t=this._getParticipantOlmData(e);t.session&&(t.session.free(),t.session=void 0)}},{key:"clearAllParticipantsSessions",value:function(){var e,t=Object(o.a)(this._conf.getParticipants());try{for(t.s();!(e=t.n()).done;){var n=e.value;this.clearParticipantSession(n)}}catch(i){t.e(i)}finally{t.f()}}},{key:"_bootstrapOlm",value:function(){var e=Object(s.a)(a.a.mark((function e(){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _.debug("Initializing Olm..."),e.prev=1,e.next=4,Olm.init();case 4:this._olmAccount=new Olm.Account,this._olmAccount.create(),t=JSON.parse(this._olmAccount.identity_keys()),this._idKey=t.curve25519,_.debug("Olm ".concat(Olm.get_library_version().join(".")," initialized")),this._init.resolve(),this.eventEmitter.emit(P.OLM_ID_KEY_READY,this._idKey),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),_.error("Failed to initialize Olm",e.t0),this._init.reject(e.t0);case 17:case"end":return e.stop()}}),e,this,[[1,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"_encryptKeyInfo",value:function(e){var t={};return void 0!==this._key&&(t.key=!!this._key&&f.a.fromByteArray(this._key),t.keyIndex=this._keyIndex),e.encrypt(JSON.stringify(t))}},{key:"_getParticipantOlmData",value:function(e){return e[I]=e[I]||{},e[I]}},{key:"_onConferenceLeft",value:function(){var e=Object(s.a)(a.a.mark((function e(){var t,n,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _.debug("Conference left"),e.next=3,this._init;case 3:t=Object(o.a)(this._conf.getParticipants());try{for(t.s();!(n=t.n()).done;)i=n.value,this._onParticipantLeft(i.getId(),i)}catch(r){t.e(r)}finally{t.f()}this._olmAccount&&(this._olmAccount.free(),this._olmAccount=void 0);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_onEndpointMessageReceived",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n){var r,o,s,c,u,l,d,h,p,m,v,b,y,E,S,I,w,D,M,L,x,F,U,V,B,J;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n[O.d]===C){e.next=2;break}return e.abrupt("return");case 2:if(n.olm){e.next=5;break}return _.warn("Incorrectly formatted message"),e.abrupt("return");case 5:return e.next=7,this._init;case 7:r=n.olm,o=t.getId(),s=this._getParticipantOlmData(t),e.t0=r.type,e.next=e.t0===R?13:e.t0===k?15:e.t0===T?17:e.t0===j?19:e.t0===A?21:23;break;case 13:return s.session?(_.warn("Participant ".concat(o," already has a session")),this._sendError(t,"Session already established")):((u=new Olm.Session).create_outbound(this._olmAccount,r.data.idKey,r.data.otKey),s.session=u,c={},Object(i.a)(c,O.d,C),Object(i.a)(c,"olm",{type:k,data:{ciphertext:this._encryptKeyInfo(u),uuid:r.data.uuid}}),l=c,this._sendMessage(l,o),this.eventEmitter.emit(P.PARTICIPANT_E2EE_CHANNEL_READY,o)),e.abrupt("break",23);case 15:return s.session?(_.warn("Participant ".concat(o," already has a session")),this._sendError(t,"No session found")):r.data.uuid===s.pendingSessionUuid?(d=r.data.ciphertext,h=this._reqs.get(r.data.uuid),(p=new Olm.Session).create_inbound(this._olmAccount,d.body),this._olmAccount.remove_one_time_keys(p),m=p.decrypt(d.type,d.body),s.session=p,s.pendingSessionUuid=void 0,this.eventEmitter.emit(P.PARTICIPANT_E2EE_CHANNEL_READY,o),this._reqs.delete(r.data.uuid),h.resolve(),(v=N(m)).key&&(b=f.a.toByteArray(v.key),y=v.keyIndex,s.lastKey=b,this.eventEmitter.emit(P.PARTICIPANT_KEY_UPDATED,o,b,y))):(_.warn("Received ACK with the wrong UUID"),this._sendError(t,"Invalid UUID")),e.abrupt("break",23);case 17:return _.error(r.data.error),e.abrupt("break",23);case 19:return s.session?(E=r.data.ciphertext,S=s.session.decrypt(E.type,E.body),void 0!==(I=N(S)).key&&void 0!==I.keyIndex&&(D=!!I.key&&f.a.toByteArray(I.key),M=I.keyIndex,g()(s.lastKey,D)||(s.lastKey=D,this.eventEmitter.emit(P.PARTICIPANT_KEY_UPDATED,o,D,M)),w={},Object(i.a)(w,O.d,C),Object(i.a)(w,"olm",{type:A,data:{ciphertext:this._encryptKeyInfo(s.session),uuid:r.data.uuid}}),L=w,this._sendMessage(L,o))):(_.debug("Received key info message from ".concat(o," but we have no session for them!")),this._sendError(t,"No session found while processing key-info")),e.abrupt("break",23);case 21:return s.session?(x=r.data.ciphertext,F=s.session.decrypt(x.type,x.body),void 0!==(U=N(F)).key&&void 0!==U.keyIndex&&(V=!!U.key&&f.a.toByteArray(U.key),B=U.keyIndex,g()(s.lastKey,V)||(s.lastKey=V,this.eventEmitter.emit(P.PARTICIPANT_KEY_UPDATED,o,V,B))),J=this._reqs.get(r.data.uuid),this._reqs.delete(r.data.uuid),J.resolve()):(_.debug("Received key info ack message from ".concat(o," but we have no session for them!")),this._sendError(t,"No session found while processing key-info-ack")),e.abrupt("break",23);case 23:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_onParticipantLeft",value:function(e,t){_.debug("Participant ".concat(e," left")),this.clearParticipantSession(t)}},{key:"_onParticipantPropertyChanged",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n,r,o){var s,c,u,l,d,h;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=n,e.next="e2ee.enabled"===e.t0?3:20;break;case 3:if(!o||!this._conf.isE2EEEnabled()){e.next=19;break}return s=this._conf.myUserId(),c=t.getId(),e.next=8,t.getFeatures();case 8:if(!(e.sent.has(O.b)&&s<c)){e.next=19;break}if(!this._sessionInitialization){e.next=13;break}return e.next=13,this._sessionInitialization;case 13:return e.next=15,this._sendSessionInit(t);case 15:l=this._getParticipantOlmData(t),d=Object(b.a)(),u={},Object(i.a)(u,O.d,C),Object(i.a)(u,"olm",{type:j,data:{ciphertext:this._encryptKeyInfo(l.session),uuid:d}}),h=u,this._sendMessage(h,c);case 19:return e.abrupt("break",20);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n,i,r){return e.apply(this,arguments)}}()},{key:"_sendError",value:function(e,t){var n,r=e.getId(),a=(n={},Object(i.a)(n,O.d,C),Object(i.a)(n,"olm",{type:T,data:{error:t}}),n);this._sendMessage(a,r)}},{key:"_sendMessage",value:function(e,t){this._conf.sendMessage(e,t)}},{key:"_sendSessionInit",value:function(e){var t,n=this,r=e.getId(),a=this._getParticipantOlmData(e);if(a.session)return _.warn("Tried to send session-init to ".concat(r," but we already have a session")),Promise.reject();if(void 0!==a.pendingSessionUuid)return _.warn("Tried to send session-init to ".concat(r," but we already have a pending session")),Promise.reject();this._olmAccount.generate_one_time_keys(1);var o=JSON.parse(this._olmAccount.one_time_keys()),s=Object.values(o.curve25519)[0];if(!s)return Promise.reject(new Error("No one-time-keys generated"));this._olmAccount.mark_keys_as_published();var c=Object(b.a)(),u=(t={},Object(i.a)(t,O.d,C),Object(i.a)(t,"olm",{type:R,data:{idKey:this._idKey,otKey:s,uuid:c}}),t),l=new E.a;return l.setRejectTimeout(5e3),l.catch((function(){n._reqs.delete(c),a.pendingSessionUuid=void 0})),this._reqs.set(c,l),this._sendMessage(u,r),a.pendingSessionUuid=c,l}}],[{key:"isSupported",value:function(){return"undefined"!==typeof window.Olm}}]),n}(S.a);function N(e){try{return JSON.parse(e)}catch(t){return{}}}w.events=P}).call(this,"/index.js")},,,,,,,,,function(e,t,n){"use strict";function i(e){return new Promise((function(t,n){var i=new FormData;i.append("access_token","e9889a51fca19f2712ec046016b7ec0808953103e32cd327b91f11bfddaa8533"),i.append("imagedata",e),fetch("https://upload.gyazo.com/api/upload",{method:"POST",body:i}).then((function(e){return e.json()})).then((function(e){t(e.url)})).catch((function(e){console.error(e),n("")}))}))}function r(e){return new Promise((function(t,n){var i=new Image;i.src=e,i.onload=function(){var e=[i.width,i.height];t(e)},i.onerror=function(){n([0,0])}}))}n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return S}));var i=n(60),r=n.n(i),a=n(15),o=n(87),s=n(6),c=n(8),u=n(18),l=n(282),d=n.n(l),h=n(10),p=n(29),f=n.n(p),m=n(20),v=n(149),g=n(350),b=n(172),y=n(283),E=Object(u.getLogger)(e),S=function(){function e(t){var n=this;Object(s.a)(this,e),this.conference=t,this._conferenceJoined=!1,this._enabled=!1,this._key=void 0,this._enabling=void 0,this._e2eeCtx=new g.a,this._olmAdapter=new b.a(t),this._ratchetKey=d()(this._ratchetKeyImpl,5e3),this._rotateKey=d()(this._rotateKeyImpl,5e3),this.conference.on(h.CONFERENCE_JOINED,(function(){n._conferenceJoined=!0})),this.conference.on(h.PARTICIPANT_PROPERTY_CHANGED,this._onParticipantPropertyChanged.bind(this)),this.conference.on(h.USER_JOINED,this._onParticipantJoined.bind(this)),this.conference.on(h.USER_LEFT,this._onParticipantLeft.bind(this)),this.conference.on(h._MEDIA_SESSION_STARTED,this._onMediaSessionStarted.bind(this)),this.conference.on(h.TRACK_ADDED,(function(e){return e.isLocal()&&n._onLocalTrackAdded(e)})),this.conference.rtc.on(f.a.REMOTE_TRACK_ADDED,(function(e,t){return n._setupReceiverE2EEForTrack(t,e)})),this.conference.on(h.TRACK_MUTE_CHANGED,this._trackMuteChanged.bind(this)),this._olmAdapter.on(b.a.events.OLM_ID_KEY_READY,this._onOlmIdKeyReady.bind(this)),this._olmAdapter.on(b.a.events.PARTICIPANT_E2EE_CHANNEL_READY,this._onParticipantE2EEChannelReady.bind(this)),this._olmAdapter.on(b.a.events.PARTICIPANT_KEY_UPDATED,this._onParticipantKeyUpdated.bind(this))}return Object(c.a)(e,[{key:"isEnabled",value:function(){return this._enabled}},{key:"setEnabled",value:function(){var e=Object(o.a)(r.a.mark((function e(t){var n,i,o,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==this._enabled){e.next=2;break}return e.abrupt("return");case 2:if(e.t0=this._enabling,!e.t0){e.next=6;break}return e.next=6,this._enabling;case 6:if(this._enabling=new v.a,this._enabled=t,!t){e.next=13;break}return e.next=11,this._olmAdapter.initSessions();case 11:e.next=16;break;case 13:n=Object(a.a)(this.conference.getParticipants());try{for(n.s();!(i=n.n()).done;)o=i.value,this._e2eeCtx.cleanup(o.getId())}catch(r){n.e(r)}finally{n.f()}this._olmAdapter.clearAllParticipantsSessions();case 16:return this.conference.setLocalParticipantProperty("e2ee.enabled",t),this.conference._restartMediaSessions(),this._key=!!t&&this._generateKey(),e.next=21,this._olmAdapter.updateKey(this._key);case 21:s=e.sent,this._e2eeCtx.setKey(this.conference.myUserId(),this._key,s),this._enabling.resolve();case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_generateKey",value:function(){return window.crypto.getRandomValues(new Uint8Array(32))}},{key:"_onLocalTrackAdded",value:function(e){var t,n=Object(a.a)(this.conference._getMediaSessions());try{for(n.s();!(t=n.n()).done;){var i=t.value;this._setupSenderE2EEForTrack(i,e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"_onMediaSessionStarted",value:function(e){var t,n=this.conference.getLocalTracks(),i=Object(a.a)(n);try{for(i.s();!(t=i.n()).done;){var r=t.value;this._setupSenderE2EEForTrack(e,r)}}catch(o){i.e(o)}finally{i.f()}}},{key:"_onOlmIdKeyReady",value:function(e){E.debug("Olm id key ready: ".concat(e)),this.conference.setLocalParticipantProperty("e2ee.idKey",e)}},{key:"_onParticipantJoined",value:function(){this._conferenceJoined&&this._enabled&&this._ratchetKey()}},{key:"_onParticipantLeft",value:function(e){this._e2eeCtx.cleanup(e),this._enabled&&this._rotateKey()}},{key:"_onParticipantE2EEChannelReady",value:function(e){E.debug("E2EE channel with participant ".concat(e," is ready"))}},{key:"_onParticipantKeyUpdated",value:function(e,t,n){E.debug("Participant ".concat(e," updated their key")),this._e2eeCtx.setKey(e,t,n)}},{key:"_onParticipantPropertyChanged",value:function(){var e=Object(o.a)(r.a.mark((function e(t,n,i,a){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=n,e.next="e2ee.idKey"===e.t0?3:"e2ee.enabled"===e.t0?5:7;break;case 3:return E.debug("Participant ".concat(t.getId()," updated their id key: ").concat(a)),e.abrupt("break",7);case 5:return!a&&this._enabled&&(this._olmAdapter.clearParticipantSession(t),this._rotateKey()),e.abrupt("break",7);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,i,r){return e.apply(this,arguments)}}()},{key:"_ratchetKeyImpl",value:function(){var e=Object(o.a)(r.a.mark((function e(){var t,n,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E.debug("Ratchetting key"),e.next=3,Object(y.a)(this._key);case 3:return t=e.sent,e.next=6,Object(y.b)(t);case 6:n=e.sent,this._key=new Uint8Array(n),i=this._olmAdapter.updateCurrentKey(this._key),this._e2eeCtx.setKey(this.conference.myUserId(),this._key,i);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_rotateKeyImpl",value:function(){var e=Object(o.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E.debug("Rotating key"),this._key=this._generateKey(),e.next=4,this._olmAdapter.updateKey(this._key);case 4:t=e.sent,this._e2eeCtx.setKey(this.conference.myUserId(),this._key,t);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_setupReceiverE2EEForTrack",value:function(e,t){if(this._enabled){var n=e.findReceiverForTrack(t.track);n?this._e2eeCtx.handleReceiver(n,t.getType(),t.getParticipantId()):E.warn("Could not handle E2EE for ".concat(t,": receiver not found in: ").concat(e))}}},{key:"_setupSenderE2EEForTrack",value:function(e,t){if(this._enabled){var n=e.peerconnection,i=n&&n.findSenderForTrack(t.track);i?this._e2eeCtx.handleSender(i,t.getType(),t.getParticipantId()):E.warn("Could not handle E2EE for ".concat(t,": sender not found in ").concat(n))}}},{key:"_trackMuteChanged",value:function(e){if(m.a.doesVideoMuteByStreamRemove()&&e.isLocal()&&e.isVideoTrack()&&!e.isMuted()){var t,n=Object(a.a)(this.conference._getMediaSessions());try{for(n.s();!(t=n.n()).done;){var i=t.value;this._setupSenderE2EEForTrack(i,e)}}catch(r){n.e(r)}finally{n.f()}}}}],[{key:"isSupported",value:function(e){return m.a.supportsInsertableStreams()&&b.a.isSupported()&&!(e.testing&&e.testing.disableE2EE)}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return D}));var i=n(15),r=n(6),a=n(8),o=n(31),s=n(36),c=n(35),u=n(18),l=n(13),d=n(71),h=n(39),p=n.n(h),f=n(32),m=n(9),v=n.n(m),g=n(150),b=n(65),y=n(190),E=n(34),S=n(26),O=n(362),_=n(43),C=n.n(_),T=n(364),j=n(20),A=n(365),k=n(107),R=n(215),I=n(366),P=n(129),w=Object(u.getLogger)(e),N=1e4,D=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e,i,a,s,c,u,l,d){var h;return Object(r.a)(this,n),(h=t.call(this,e,i,a,s,c,u,d))._bridgeSessionId=null,h._cachedOldLocalSdp=void 0,h._cachedNewLocalSdp=void 0,h._iceCheckingStartedTimestamp=null,h._gatheringStartedTimestamp=null,h.localRecvMaxFrameHeight=void 0,h._localVideoActive=!0,h._remoteVideoActive=!0,h._gatheringReported=!1,h.lasticecandidate=!1,h.closed=!1,h.isP2P=l,h.remoteRecvMaxFrameHeight=void 0,h.signalingLayer=new I.a,h.modificationQueue=new O.a,h.wasConnected=!1,h.establishmentDuration=void 0,h._xmppListeners=[],h._xmppListeners.push(s.addEventListener(P.a.Events.CONN_STATUS_CHANGED,h.onXmppStatusChanged.bind(Object(o.a)(h)))),h._removeSenderVideoConstraintsChangeListener=void 0,h}return Object(a.a)(n,[{key:"_assertNotEnded",value:function(){return this.state!==k.b}},{key:"doInitialize",value:function(e){var t=this;this.failICE=Boolean(e.failICE),this.lasticecandidate=!1,this.options=e,this.isReconnect=!1,this.wasstable=!1,this.webrtcIceUdpDisable=Boolean(e.webrtcIceUdpDisable),this.webrtcIceTcpDisable=Boolean(e.webrtcIceTcpDisable);var n={disableRtx:e.disableRtx};if(e.gatherStats&&(n.maxstats=300),n.capScreenshareBitrate=!1,n.enableInsertableStreams=e.enableInsertableStreams,n.videoQuality=e.videoQuality,n.forceTurnRelay=e.forceTurnRelay,n.audioQuality=e.audioQuality,n.usesUnifiedPlan=this.usesUnifiedPlan=j.a.supportsUnifiedPlan()&&(j.a.isFirefox()||j.a.isWebKitBased()||!this.isP2P&&j.a.isChromiumBased()&&e.enableUnifiedOnChrome),this.isP2P){n.disableSimulcast=!0;var i=this._abtestSuspendVideoEnabled(e);"undefined"!==typeof i&&(n.abtestSuspendVideo=i)}else{var r,a;n.disableSimulcast=e.disableSimulcast||e.preferH264&&!e.disableH264||e.videoQuality&&e.videoQuality.preferredCodec===d.H264,n.capScreenshareBitrate=n.disableSimulcast||!("number"===typeof(null===(r=e.desktopSharingFrameRate)||void 0===r?void 0:r.max)&&(null===(a=e.desktopSharingFrameRate)||void 0===a?void 0:a.max)>g.a),S.a.analytics.addPermanentProperties({capScreenshareBitrate:n.capScreenshareBitrate})}e.startSilent&&(n.startSilent=!0),this.peerconnection=this.rtc.createPeerConnection(this.signalingLayer,this.iceConfig,this.isP2P,n),this.peerconnection.onicecandidate=function(e){if(e){var n=e.candidate,i=window.performance.now();if(n){null===t._gatheringStartedTimestamp&&(t._gatheringStartedTimestamp=i);var r=n.protocol;if("string"===typeof r)if("tcp"===(r=r.toLowerCase())||"ssltcp"===r){if(t.webrtcIceTcpDisable)return}else if("udp"===r&&t.webrtcIceUdpDisable)return}else t._gatheringReported||(S.a.sendAnalytics(f.o,{phase:"gathering",value:i-t._gatheringStartedTimestamp,p2p:t.isP2P,initiator:t.isInitiator}),t._gatheringReported=!0);t.sendIceCandidate(n)}},this.peerconnection.onsignalingstatechange=function(){"stable"===t.peerconnection.signalingState?t.wasstable=!0:"closed"!==t.peerconnection.signalingState&&"closed"!==t.peerconnection.connectionState||t.room.eventEmitter.emit(v.a.SUSPEND_DETECTED,t)},this.peerconnection.oniceconnectionstatechange=function(){var e=window.performance.now(),n=!1;switch(t.isP2P||(t.room.connectionTimes["ice.state.".concat(t.peerconnection.iceConnectionState)]=e),w.log("(TIME) ICE ".concat(t.peerconnection.iceConnectionState," ").concat(t.isP2P?"P2P":"JVB",":\t"),e),S.a.sendAnalytics(f.q,{p2p:t.isP2P,state:t.peerconnection.iceConnectionState,signaling_state:t.peerconnection.signalingState,reconnect:t.isReconnect,value:e}),t.room.eventEmitter.emit(v.a.ICE_CONNECTION_STATE_CHANGED,t,t.peerconnection.iceConnectionState),t.peerconnection.iceConnectionState){case"checking":t._iceCheckingStartedTimestamp=e;break;case"connected":if("stable"===t.peerconnection.signalingState){n=!0;var i=!t.options.enableIceRestart&&t.room.supportsRestartByTerminate();(t.isReconnect||i)&&t.room.eventEmitter.emit(v.a.CONNECTION_RESTORED,t)}if(!t.wasConnected&&(t.wasstable||n||t.usesUnifiedPlan&&t.isInitiator&&j.a.isChromiumBased())){S.a.sendAnalytics(f.o,{phase:"checking",value:e-t._iceCheckingStartedTimestamp,p2p:t.isP2P,initiator:t.isInitiator});var r=Math.min(t._iceCheckingStartedTimestamp,t._gatheringStartedTimestamp);t.establishmentDuration=e-r,S.a.sendAnalytics(f.o,{phase:"establishment",value:t.establishmentDuration,p2p:t.isP2P,initiator:t.isInitiator}),t.wasConnected=!0,t.room.eventEmitter.emit(v.a.CONNECTION_ESTABLISHED,t)}t.isReconnect=!1;break;case"disconnected":t.isReconnect=!0,t.wasstable&&t.room.eventEmitter.emit(v.a.CONNECTION_INTERRUPTED,t);break;case"failed":t.room.eventEmitter.emit(v.a.CONNECTION_ICE_FAILED,t)}},this.peerconnection.onnegotiationneeded=function(){var e=t.peerconnection.signalingState,n=t.peerconnection.remoteDescription;if(t.usesUnifiedPlan&&"stable"===e&&n&&"string"===typeof n.sdp){w.debug("".concat(t," onnegotiationneeded fired on ").concat(t.peerconnection," in state: ").concat(e));t.modificationQueue.push((function(e){var n=new b.a(t.peerconnection.localDescription.sdp);t._renegotiate().then((function(){var i=new b.a(t.peerconnection.localDescription.sdp);t.notifyMySSRCUpdate(n,i),e()}),e)}),(function(e){e?w.error("".concat(t," onnegotiationneeded error"),e):w.debug("".concat(t," onnegotiationneeded executed - OK"))}))}},this.signalingLayer.setChatRoom(this.room)}},{key:"getRemoteRecvMaxFrameHeight",value:function(){if(this.isP2P)return this.remoteRecvMaxFrameHeight}},{key:"sendIceCandidate",value:function(e){var t=this,n=new b.a(this.peerconnection.localDescription.sdp);if(e&&e.candidate.length&&!this.lasticecandidate){var i=E.a.iceparams(n.media[e.sdpMLineIndex],n.session),r=E.a.candidateToJingle(e.candidate);if(!i||!r){var a="failed to get ice && jcand";return C.a.callErrorHandler(new Error(a)),void w.error(a)}i.xmlns="urn:xmpp:jingle:transports:ice-udp:1",this.usedrip?(0===this.dripContainer.length&&setTimeout((function(){0!==t.dripContainer.length&&(t.sendIceCandidates(t.dripContainer),t.dripContainer=[])}),150),this.dripContainer.push(e)):this.sendIceCandidates([e])}else w.log("".concat(this," sendIceCandidate: last candidate")),this.lasticecandidate=!0}},{key:"sendIceCandidates",value:function(e){var t=this;if(this._assertNotEnded("sendIceCandidates")){w.log("".concat(this," sendIceCandidates ").concat(JSON.stringify(e)));for(var n=Object(l.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"transport-info",initiator:this.initiatorJid,sid:this.sid}),i=new b.a(this.peerconnection.localDescription.sdp),r=function(r){var a=e.filter((function(e){return e.sdpMLineIndex===r})),o=E.a.parseMLine(i.media[r].split("\r\n")[0]);if(a.length>0){var s=E.a.iceparams(i.media[r],i.session);s.xmlns="urn:xmpp:jingle:transports:ice-udp:1",n.c("content",{creator:t.initiatorJid===t.localJid?"initiator":"responder",name:a[0].sdpMid?a[0].sdpMid:o.media}).c("transport",s);for(var c=0;c<a.length;c++){var u=E.a.candidateToJingle(a[c].candidate);t.failICE&&(u.ip="1.1.1.1"),n.c("candidate",u).up()}var l=E.a.findLine(i.media[r],"a=fingerprint:",i.session);if(l){var d=E.a.parseFingerprint(l);d.required=!0,n.c("fingerprint",{xmlns:"urn:xmpp:jingle:apps:dtls:0"}).t(d.fingerprint),delete d.fingerprint,n.attrs(d),n.up()}n.up(),n.up()}},a=0;a<i.media.length;a++)r(a);this.connection.sendIQ(n,null,this.newJingleErrorHandler(n),N)}}},{key:"sendIceFailedNotification",value:function(){var e=Object(l.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-info",initiator:this.initiatorJid,sid:this.sid}).c("ice-state",{xmlns:"http://jitsi.org/protocol/focus"}).t("failed").up();this._bridgeSessionId&&e.c("bridge-session",{xmlns:"http://jitsi.org/protocol/focus",id:this._bridgeSessionId}),this.connection.sendIQ2(e,{timeout:65}).catch(this.newJingleErrorHandler(e))}},{key:"addIceCandidates",value:function(e){var t=this;if("closed"!==this.peerconnection.signalingState){var n=[];if(e.find(">content>transport>candidate").each((function(e,t){var i=E.a.candidateFromJingle(t);i=i.replace("\r\n","").replace("a=","");var r=new RTCIceCandidate({sdpMLineIndex:0,sdpMid:"",candidate:i});n.push(r)})),n.length){w.debug("".concat(this," Queued add (").concat(n.length,") ICE candidates task")),this.modificationQueue.push((function(e){var r,a=Object(i.a)(n);try{for(a.s();!(r=a.n()).done;){var o=r.value;t.peerconnection.addIceCandidate(o).then((function(){return w.debug("".concat(t," addIceCandidate ok!"))}),(function(e){return w.error("".concat(t," addIceCandidate failed!"),e)}))}}catch(s){a.e(s)}finally{a.f()}e(),w.debug("".concat(t," ICE candidates task finished"))}))}else w.error("".concat(this," No ICE candidates to add ?"),e[0]&&e[0].outerHTML)}else w.warn("".concat(this," Ignored add ICE candidate when in closed state"))}},{key:"readSsrcInfo",value:function(e){var t=this;$(e).find('>description>source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each((function(e,n){var i=Number(n.getAttribute("ssrc"));t.isP2P?t.signalingLayer.setSSRCOwner(i,l.Strophe.getResourceFromJid(t.remoteJid)):$(n).find('>ssrc-info[xmlns="http://jitsi.org/jitmeet"]').each((function(e,n){var r=n.getAttribute("owner");r&&r.length&&(isNaN(i)||i<0?w.warn("".concat(t," Invalid SSRC ").concat(i," value received for ").concat(r)):t.signalingLayer.setSSRCOwner(i,l.Strophe.getResourceFromJid(r)))}))}))}},{key:"generateRecvonlySsrc",value:function(){this.peerconnection?this.peerconnection.generateRecvonlySsrc():w.error("".concat(this," Unable to generate recvonly SSRC - no peerconnection"))}},{key:"getConfiguredVideoCodec",value:function(){return this.peerconnection.getConfiguredVideoCodec()}},{key:"acceptOffer",value:function(e,t,n,i){var r=this;this.setOfferAnswerCycle(e,(function(){r.sendSessionAccept(t,n)}),n,i)}},{key:"invite",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!this.isInitiator)throw new Error("Trying to invite from the responder session");var n=function(n){var r,a=[],o=Object(i.a)(t);try{for(o.s();!(r=o.n()).done;){var s=r.value;a.push(e.peerconnection.addTrack(s,e.isInitiator))}}catch(c){o.e(c)}finally{o.f()}Promise.all(a).then((function(){return e.peerconnection.createOffer(e.mediaConstraints)})).then((function(t){return e.peerconnection.setLocalDescription(t)})).then((function(){e.sendSessionInitiate(e.peerconnection.localDescription.sdp)})).then((function(){return n()}),(function(e){return n(e)}))};w.debug("".concat(this," Queued invite task")),this.modificationQueue.push(n,(function(t){t?w.error("".concat(e," invite error"),t):w.debug("".concat(e," invite executed - OK"))}))}},{key:"sendSessionInitiate",value:function(e){var t=this,n=Object(l.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-initiate",initiator:this.initiatorJid,sid:this.sid});new b.a(e).toJingle(n,this.isInitiator?"initiator":"responder"),n=n.tree(),w.info("".concat(this," Session-initiate: "),n),this.connection.sendIQ(n,(function(){w.info("".concat(t,' Got RESULT for "session-initiate"'))}),(function(e){w.error("".concat(t,' "session-initiate" error'),e)}),N)}},{key:"setAnswer",value:function(e){var t=this;if(!this.isInitiator)throw new Error("Trying to set an answer on the responder session");this.setOfferAnswerCycle(e,(function(){w.info("".concat(t," setAnswer - succeeded"))}),(function(e){w.error("".concat(t," setAnswer failed: "),e)}))}},{key:"setOfferAnswerCycle",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=function(t){var n,o=[],s=Object(i.a)(a);try{for(s.s();!(n=s.n()).done;){var c=n.value;o.push(r.peerconnection.addTrack(c,r.isInitiator))}}catch(h){s.e(h)}finally{s.f()}var u=r._processNewJingleOfferIq(e),l=r.peerconnection.localDescription.sdp,d=$(e).find('>bridge-session[xmlns="http://jitsi.org/protocol/focus"]').attr("id");d!==r._bridgeSessionId&&(r._bridgeSessionId=d),Promise.all(o).then((function(){return r._renegotiate(u.raw)})).then((function(){if(r.state===k.c&&(r.state=k.a,!r.isP2P||r._localVideoActive&&!r.localRecvMaxFrameHeight||r.sendContentModify()),l){var e=new b.a(r.peerconnection.localDescription.sdp);r.notifyMySSRCUpdate(new b.a(l),e)}})).then((function(){return t()}),(function(e){return t(e)}))};w.debug("".concat(this," Queued setOfferAnswerCycle task")),this.modificationQueue.push(o,(function(e){e?(w.error("".concat(r," setOfferAnswerCycle task failed: ").concat(e)),n(e)):(w.debug("".concat(r," setOfferAnswerCycle task done")),t())}))}},{key:"setVideoCodecs",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this.peerconnection.getConfiguredVideoCodec();if(this._assertNotEnded()&&t!==i){w.info("".concat(this," Switching video codec from ").concat(i," to ").concat(t)),this.peerconnection.setVideoCodecs(t,n);var r=function(t){e._renegotiate().then((function(){return w.debug("".concat(e," setVideoCodecs task is done")),t()}),(function(n){return w.error("".concat(e," setVideoCodecs task failed: ").concat(n)),t(n)}))};w.debug("".concat(this," Queued setVideoCodecs task")),this.modificationQueue.push(r)}}},{key:"replaceTransport",value:function(e,t,n){var i=this;if(this.options.enableForcedReload){var r=new b.a(this.peerconnection.localDescription.sdp);return this.sendTransportAccept(r,t,n),void this.room.eventEmitter.emit(v.a.CONNECTION_RESTARTED,this)}this.room.eventEmitter.emit(v.a.ICE_RESTARTING,this);var a=e.clone();e.find(">content[name='data']").attr("senders","rejected"),e.find(">content>description>source").remove(),e.find(">content>description>ssrc-group").remove();var o=e.find(">content>transport>fingerprint");o.attr("hash","sha-1"),o.text("00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00"),this.setOfferAnswerCycle(e,(function(){i.setOfferAnswerCycle(a,(function(){var e=new b.a(i.peerconnection.localDescription.sdp);i.sendTransportAccept(e,t,n),i.room.eventEmitter.emit(v.a.ICE_RESTART_SUCCESS,i,a)}),n)}),n)}},{key:"sendSessionAccept",value:function(e,t){var n=this,i=new b.a(this.peerconnection.localDescription.sdp),r=Object(l.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-accept",initiator:this.initiatorJid,responder:this.responderJid,sid:this.sid});this.webrtcIceTcpDisable&&(i.removeTcpCandidates=!0),this.webrtcIceUdpDisable&&(i.removeUdpCandidates=!0),this.failICE&&(i.failICE=!0),i.toJingle(r,this.initiatorJid===this.localJid?"initiator":"responder"),r=r.tree(),w.info("".concat(this," Sending session-accept"),r),this.connection.sendIQ(r,e,this.newJingleErrorHandler(r,(function(e){t(e),n.room.eventEmitter.emit(v.a.SESSION_ACCEPT_TIMEOUT,n)})),N)}},{key:"sendContentModify",value:function(){var e=this.localRecvMaxFrameHeight,t=this._localVideoActive?"both":"none",n=Object(l.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"content-modify",initiator:this.initiatorJid,sid:this.sid}).c("content",{name:"video",senders:t});"undefined"!==typeof e&&(n=n.c("max-frame-height",{xmlns:"http://jitsi.org/jitmeet/video"}).t(e)),w.info("".concat(this," sending content-modify, video senders: ").concat(t,", max frame height: ").concat(e)),this.connection.sendIQ(n,null,this.newJingleErrorHandler(n),N)}},{key:"setReceiverVideoConstraint",value:function(e){w.info("".concat(this," setReceiverVideoConstraint - max frame height: ").concat(e)),this.localRecvMaxFrameHeight=e,this.isP2P?this.state===k.a&&this.sendContentModify():this.rtc.setReceiverVideoConstraint(e)}},{key:"sendTransportAccept",value:function(e,t,n){var i=this,r=Object(l.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"transport-accept",initiator:this.initiatorJid,sid:this.sid});e.media.forEach((function(t,n){var a=E.a.parseMLine(t.split("\r\n")[0]);r.c("content",{creator:i.initiatorJid===i.localJid?"initiator":"responder",name:a.media}),e.transportToJingle(n,r),r.up()})),r=r.tree(),w.info("".concat(this," Sending transport-accept: "),r),this.connection.sendIQ(r,t,this.newJingleErrorHandler(r,n),N)}},{key:"sendTransportReject",value:function(e,t){var n=Object(l.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"transport-reject",initiator:this.initiatorJid,sid:this.sid});n=n.tree(),w.info("".concat(this," Sending 'transport-reject'"),n),this.connection.sendIQ(n,e,this.newJingleErrorHandler(n,t),N)}},{key:"setSenderMaxBitrates",value:function(){return this._assertNotEnded()?this.peerconnection.setMaxBitRate():Promise.resolve()}},{key:"setSenderVideoConstraint",value:function(e){if(this._assertNotEnded()){if(w.info("".concat(this," setSenderVideoConstraint: ").concat(e)),!this.isP2P&&j.a.isReactNative()&&"undefined"!==typeof e){var t=e>0;return this.setMediaTransferActive(!0,t)}return this.peerconnection.setSenderVideoConstraint(e)}return Promise.resolve()}},{key:"setSenderVideoDegradationPreference",value:function(){return this._assertNotEnded()?this.peerconnection.setSenderVideoDegradationPreference():Promise.resolve()}},{key:"terminate",value:function(e,t,n){if(this.state!==k.b){if(!n||Boolean(n.sendSessionTerminate)){var i=Object(l.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-terminate",initiator:this.initiatorJid,sid:this.sid}).c("reason").c(n&&n.reason||"success").up();n&&n.reasonDescription?i.c("text").t(n.reasonDescription).up().up():i.up(),this._bridgeSessionId&&i.c("bridge-session",{xmlns:"http://jitsi.org/protocol/focus",id:this._bridgeSessionId,restart:n&&!0===n.requestRestart}).up(),i=i.tree(),w.info("".concat(this," Sending session-terminate"),i),this.connection.sendIQ(i,e,this.newJingleErrorHandler(i,t),N)}else w.info("".concat(this," Skipped sending session-terminate"));this.connection.jingle.terminate(this.sid)}}},{key:"onTerminated",value:function(e,t){w.info("".concat(this," Session terminated"),e,t),this._xmppListeners.forEach((function(e){return e()})),this._xmppListeners=[],this._removeSenderVideoConstraintsChangeListener&&this._removeSenderVideoConstraintsChangeListener(),this.close()}},{key:"onXmppStatusChanged",value:function(e){e===P.a.Status.CONNECTED&&this._cachedOldLocalSdp&&(w.info("".concat(this," Sending SSRC update on reconnect")),this.notifyMySSRCUpdate(this._cachedOldLocalSdp,this._cachedNewLocalSdp))}},{key:"_parseSsrcInfoFromSourceAdd",value:function(e,t){var n=[];return $(e).each((function(e,i){var r=$(i).attr("name"),a="";$(i).find('ssrc-group[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each((function(){var e=this.getAttribute("semantics"),t=$(this).find(">source").map((function(){return this.getAttribute("ssrc")})).get();t.length&&(a+="a=ssrc-group:".concat(e," ").concat(t.join(" "),"\r\n"))})),$(i).find('source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each((function(){var e=$(this).attr("ssrc");t.containsSSRC(e)?w.warn("".concat(this," Source-add request for existing SSRC: ").concat(e)):$(this).find(">parameter").each((function(){a+="a=ssrc:".concat(e," ").concat($(this).attr("name")),$(this).attr("value")&&$(this).attr("value").length&&(a+=":".concat($(this).attr("value"))),a+="\r\n"}))})),t.media.forEach((function(e,t){E.a.findLine(e,"a=mid:".concat(r))&&(n[t]||(n[t]=""),n[t]+=a)}))})),n}},{key:"addRemoteStream",value:function(e){this._addOrRemoveRemoteStream(!0,e)}},{key:"removeRemoteStream",value:function(e){this._addOrRemoveRemoteStream(!1,e)}},{key:"removeRemoteStreamsOnLeave",value:function(e){var t=this,n=[],i=function(i){var r=t.peerconnection.getRemoteSourceInfoByParticipant(e);if(r.length){var a=new b.a(t.peerconnection.localDescription.sdp),o=t._processRemoteRemoveSource(r);n=t.peerconnection.removeRemoteTracks(e),t._renegotiate(o.raw).then((function(){var e=new b.a(t.peerconnection.localDescription.sdp);t.notifyMySSRCUpdate(a,e),i()})).catch((function(e){return i(e)}))}else i()};return new Promise((function(r,a){w.debug("".concat(t," Queued removeRemoteStreamsOnLeave task for participant ").concat(e)),t.modificationQueue.push(i,(function(e){e?(w.error("".concat(t," removeRemoteStreamsOnLeave error:"),e),a(e)):(w.info("".concat(t," removeRemoteStreamsOnLeave done!")),r(n))}))}))}},{key:"_addOrRemoveRemoteStream",value:function(e,t){var n=this,i=e?"addRemoteStream":"removeRemoteStream";e&&this.readSsrcInfo(t);w.debug("".concat(this," Queued ").concat(i," task")),this.modificationQueue.push((function(r){if(!n.peerconnection.localDescription||!n.peerconnection.localDescription.sdp){var a="".concat(i," - localDescription not ready yet");return w.error(a),void r(a)}w.log("".concat(n," Processing ").concat(i));var o=new b.a(n.peerconnection.localDescription.sdp),s=new b.a(n.peerconnection.remoteDescription.sdp),c=e?n._parseSsrcInfoFromSourceAdd(t,s):n._parseSsrcInfoFromSourceRemove(t,s),u=e?n._processRemoteAddSource(c):n._processRemoteRemoveSource(c);n._renegotiate(u.raw).then((function(){var e=new b.a(n.peerconnection.localDescription.sdp);w.log("".concat(n," ").concat(i," - OK")),n.notifyMySSRCUpdate(o,e),r()}),(function(e){w.error("".concat(n," ").concat(i," failed:"),e),r(e)}))}))}},{key:"_processNewJingleOfferIq",value:function(e){var t=new b.a("");return this.webrtcIceTcpDisable&&(t.removeTcpCandidates=!0),this.webrtcIceUdpDisable&&(t.removeUdpCandidates=!0),this.failICE&&(t.failICE=!0),t.fromJingle(e),this.readSsrcInfo($(e).find(">content")),t}},{key:"_processRemoteRemoveSource",value:function(e){var t=this,n=this.usesUnifiedPlan?new b.a(this.peerconnection.peerconnection.remoteDescription.sdp):new b.a(this.peerconnection.remoteDescription.sdp);return e.forEach((function(e,i){(e=e.split("\r\n")).pop(),t.usesUnifiedPlan?e.forEach((function(e){var i=n.media.findIndex((function(t){return t.includes(e)}));if(i>-1)if(n.media[i]=n.media[i].replace("".concat(e,"\r\n"),""),t.isP2P){var r,a=null===(r=E.a.parseMLine(n.media[i].split("\r\n")[0]))||void 0===r?void 0:r.media,o=t.peerconnection.getDesiredMediaDirection(a,!1);[p.a.SENDRECV,p.a.SENDONLY].forEach((function(e){n.media[i]=n.media[i].replace("a=".concat(e),"a=".concat(o))}))}else n.media[i]=n.media[i].replace("a=".concat(p.a.SENDONLY),"a=".concat(p.a.INACTIVE))})):e.forEach((function(e){n.media[i]=n.media[i].replace("".concat(e,"\r\n"),"")}))})),n.raw=n.session+n.media.join(""),n}},{key:"_processRemoteAddSource",value:function(e){var t=this,n=new b.a(this.peerconnection.remoteDescription.sdp);return e.forEach((function(e,i){if(n.media[i]+=e,t.isP2P&&t.usesUnifiedPlan){var r,a=null===(r=E.a.parseMLine(n.media[i].split("\r\n")[0]))||void 0===r?void 0:r.media,o=t.peerconnection.getDesiredMediaDirection(a,!0);[p.a.RECVONLY,p.a.INACTIVE].forEach((function(e){n.media[i]=n.media[i].replace("a=".concat(e),"a=".concat(o))}))}})),n.raw=n.session+n.media.join(""),n}},{key:"_renegotiate",value:function(e){if("closed"===this.peerconnection.signalingState){var t=new Error("Attempted to renegotiate in state closed");return this.room.eventEmitter.emit(v.a.RENEGOTIATION_FAILED,t,this),Promise.reject(t)}var n=e||this.peerconnection.remoteDescription.sdp;if(!n){var i=new Error("Can not renegotiate without remote description, current state: ".concat(this.state));return this.room.eventEmitter.emit(v.a.RENEGOTIATION_FAILED,i,this),Promise.reject(i)}var r=new RTCSessionDescription({type:this.isInitiator?"answer":"offer",sdp:n});return this.isInitiator?this._initiatorRenegotiate(r):this._responderRenegotiate(r)}},{key:"_responderRenegotiate",value:function(e){var t=this;return w.debug("".concat(this," Renegotiate: setting remote description")),this.peerconnection.setRemoteDescription(e).then((function(){return w.debug("".concat(t," Renegotiate: creating answer")),t.peerconnection.createAnswer(t.mediaConstraints).then((function(e){return w.debug("".concat(t," Renegotiate: setting local description")),t.peerconnection.setLocalDescription(e)}))}))}},{key:"_initiatorRenegotiate",value:function(e){var t=this;return w.debug("".concat(this," Renegotiate: creating offer")),this.peerconnection.createOffer(this.mediaConstraints).then((function(n){return w.debug("".concat(t," Renegotiate: setting local description")),t.peerconnection.setLocalDescription(n).then((function(){return w.debug("".concat(t," Renegotiate: setting remote description")),t.peerconnection.setRemoteDescription(e)}))}))}},{key:"replaceTrack",value:function(e,t){var n=this,i=function(i){w.debug("".concat(n," replaceTrack worker started. oldTrack = ").concat(e,", newTrack = ").concat(t));var r=n.peerconnection.localDescription.sdp;n.usesUnifiedPlan||(n.peerconnection.options.capScreenshareBitrate&&e&&t&&t.isVideoTrack()&&n.peerconnection.clearRecvonlySsrc(),!e&&t&&t.isVideoTrack()?n.peerconnection.clearRecvonlySsrc():e&&e.isVideoTrack()&&!t&&(n.peerconnection.clearRecvonlySsrc(),n.peerconnection.generateRecvonlySsrc())),n.peerconnection.replaceTrack(e,t).then((function(i){var a=Promise.resolve();return w.debug("".concat(n," TPC.replaceTrack finished. shouldRenegotiate = ").concat(i,", JingleSessionState = ").concat(n.state)),i&&(e||t)&&n.state===k.a&&(a=n._renegotiate().then((function(){var e=new b.a(n.peerconnection.localDescription.sdp);n.notifyMySSRCUpdate(new b.a(r),e)}))),a.then((function(){if(t&&t.isVideoTrack())return w.debug("".concat(n," replaceTrack worker: configuring video stream")),n.peerconnection.setSenderVideoDegradationPreference().then((function(){return n.peerconnection.setSenderVideoConstraint()})).then((function(){return n.peerconnection.setMaxBitRate()}))}))})).then((function(){return i()}),(function(e){return i(e)}))};return new Promise((function(r,a){w.debug("".concat(n," Queued replaceTrack task. Old track = ").concat(e,", new track = ").concat(t)),n.modificationQueue.push(i,(function(e){e?(w.error("".concat(n," Replace track error:"),e),a(e)):(w.info("".concat(n,"  Replace track done!")),r())}))}))}},{key:"_parseSsrcInfoFromSourceRemove",value:function(e,t){var n=[];return $(e).each((function(e,i){var r=$(i).attr("name"),a="";$(i).find('ssrc-group[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each((function(){var e=this.getAttribute("semantics"),t=$(this).find(">source").map((function(){return this.getAttribute("ssrc")})).get();t.length&&(a+="a=ssrc-group:".concat(e," ").concat(t.join(" "),"\r\n"))}));var o=[];$(i).find('source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each((function(){var e=$(this).attr("ssrc");o.push(e)})),t.media.forEach((function(e,t){E.a.findLine(e,"a=mid:".concat(r))&&(n[t]||(n[t]=""),o.forEach((function(i){var r=E.a.findLines(e,"a=ssrc:".concat(i));r.length&&(n[t]+="".concat(r.join("\r\n"),"\r\n"))})),n[t]+=a)}))})),n}},{key:"_verifyNoSSRCChanged",value:function(e,t){var n=new b.a(this.peerconnection.localDescription.sdp),i=new y.a(t,n),r=i.getNewMedia();if(Object.keys(r).length)return w.error("".concat(this," - some SSRC were added on ").concat(e),r),!1;var a=(i=new y.a(n,t)).getNewMedia();return!Object.keys(a).length||(w.error("".concat(this," - some SSRCs were removed on ").concat(e),a),!1)}},{key:"addTrackAsUnmute",value:function(e){var t=this;return this._addRemoveTrackAsMuteUnmute(!1,e).then((function(){if(e.isVideoTrack()&&j.a.doesVideoMuteByStreamRemove())return t.setSenderMaxBitrates().then((function(){return t.setSenderVideoDegradationPreference()})).then((function(){return t.setSenderVideoConstraint()}))}))}},{key:"removeTrackAsMute",value:function(e){return this._addRemoveTrackAsMuteUnmute(!0,e)}},{key:"_addRemoveTrackAsMuteUnmute",value:function(e,t){var n=this;if(!t)return Promise.reject('invalid "track" argument value');var i=e?"removeTrackMute":"addTrackUnmute",r=function(r){var a=n.peerconnection;if(a){var o=a.localDescription.sdp;(e?a.removeTrackMute(t):a.addTrackUnmute(t)).then((function(e){e&&o&&a.remoteDescription.sdp?n._renegotiate().then((function(){n._verifyNoSSRCChanged(i,new b.a(o)),r()})):r()}),r)}else r("Error:  tried ".concat(i," track with no active peer")+"connection")};return w.debug("".concat(this," Queued ").concat(i," task")),new Promise((function(e,t){n.modificationQueue.push(r,(function(r){r?(w.error("".concat(n," ").concat(i," failed")),t(r)):(w.debug("".concat(n," ").concat(i," done")),e())}))}))}},{key:"setMediaTransferActive",value:function(e,t){var n=this;if(!this.peerconnection)return Promise.reject('Can not modify transfer active state, before "initialize" is called');var i=e?"audio active":"audio inactive",r=t?"video active":"video inactive";w.info("".concat(this," Queued make ").concat(r,", ").concat(i," task"));var a=function(i){var r=n.state===k.a,a=n.peerconnection.setAudioTransferActive(e);n._localVideoActive!==t&&(n._localVideoActive=t,n.isP2P&&r&&n.sendContentModify());var o=n.peerconnection.setVideoTransferActive(n._localVideoActive&&n._remoteVideoActive);r&&(a||o)?n._renegotiate().then(i,i):i()};return new Promise((function(e,t){n.modificationQueue.push(a,(function(a){a?(w.error("".concat(n," Make ").concat(r,", ").concat(i," task failed!")),t(a)):(w.debug("".concat(n," Make ").concat(r,", ").concat(i," task done!")),e())}))}))}},{key:"modifyContents",value:function(e){var t=this,i=n.parseVideoSenders(e),r=n.parseMaxFrameHeight(e);if(r&&(w.info("".concat(this," received remote max frame height: ").concat(r)),this.remoteRecvMaxFrameHeight=r,this.eventEmitter.emit(R.a.REMOTE_VIDEO_CONSTRAINTS_CHANGED,this)),null!==i){w.debug("".concat(this,' queued "content-modify" task(video senders="').concat(i,'")')),this.modificationQueue.push((function(e){t._assertNotEnded("content-modify")&&t._modifyRemoteVideoActive(i)?t._renegotiate().then(e,e):e()}),(function(e){e?w.error("".concat(t,' "content-modify" failed'),e):w.debug("".concat(t,' "content-modify" task(video senders="').concat(i,'") done'))}))}else w.error("".concat(this,' - failed to parse video "senders" attribute in')+'"content-modify" action')}},{key:"_modifyRemoteVideoActive",value:function(e){var t="both"===e||"initiator"===e&&this.isInitiator||"responder"===e&&!this.isInitiator;return t!==this._remoteVideoActive&&(w.debug("".concat(this," new remote video active: ").concat(t)),this._remoteVideoActive=t),this.peerconnection.setVideoTransferActive(this._localVideoActive&&this._remoteVideoActive)}},{key:"notifyMySSRCUpdate",value:function(e,t){if(this.state===k.a){if(!this.connection.connected)return this._cachedOldLocalSdp||(this._cachedOldLocalSdp=e),this._cachedNewLocalSdp=t,void w.warn("".concat(this," Not sending SSRC update while the signaling is disconnected"));this._cachedOldLocalSdp=void 0,this._cachedNewLocalSdp=void 0;var n=new y.a(t,e),i=Object(l.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"source-remove",initiator:this.initiatorJid,sid:this.sid});n.toJingle(i)&&(w.info("".concat(this," Sending source-remove"),i.tree()),this.connection.sendIQ(i,null,this.newJingleErrorHandler(i),N)),n=new y.a(e,t);var r=Object(l.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"source-add",initiator:this.initiatorJid,sid:this.sid});n.toJingle(r)&&(w.info("".concat(this," Sending source-add"),r.tree()),this.connection.sendIQ(r,null,this.newJingleErrorHandler(r),N))}else w.warn("".concat(this," Skipping SSRC update in '").concat(this.state," ' state."))}},{key:"newJingleErrorHandler",value:function(e,t){var n=this;return function(e){var i={},r=$(e).find("error");if(r.length){i.code=r.attr("code");var a=$(e).find("error :first");a.length&&(i.reason=a[0].tagName);var o=r.find(">text");o.length&&(i.msg=o.text())}e||(i.reason="timeout"),i.session=n.toString(),t?t(i):n.state===k.b&&"item-not-found"===i.reason?w.debug("".concat(n," Jingle error: ").concat(JSON.stringify(i))):C.a.callErrorHandler(new Error("Jingle error: ".concat(JSON.stringify(i))))}}},{key:"getIceConnectionState",value:function(){return this.peerconnection.getConnectionState()}},{key:"close",value:function(){var e=this;this.state=k.b,this.establishmentDuration=void 0,this.peerconnection&&(this.peerconnection.onicecandidate=null,this.peerconnection.oniceconnectionstatechange=null,this.peerconnection.onnegotiationneeded=null,this.peerconnection.onsignalingstatechange=null),w.debug("".concat(this," Clearing modificationQueue")),this.modificationQueue.clear(),w.debug("".concat(this," Queued PC close task")),this.modificationQueue.push((function(t){e.signalingLayer.setChatRoom(null),e.peerconnection&&e.peerconnection.close(),t(),w.debug("".concat(e," PC close task done!"))})),w.debug("".concat(this," Shutdown modificationQueue!")),this.modificationQueue.shutdown()}},{key:"toString",value:function(){return"JingleSessionPC[session=".concat(this.isP2P?"P2P":"JVB",",initiator=").concat(this.isInitiator,",sid=").concat(this.sid,"]")}},{key:"_abtestSuspendVideoEnabled",value:function(e){var t=e.abTesting;if(t&&t.enableSuspendVideoTest){var n=this._getInitiatorJid();return Object(T.integerHash)(n)%2===0}}}],[{key:"parseVideoSenders",value:function(e){var t=e.find('>content[name="video"]');if(t.length){var n=t[0].getAttribute("senders");if("both"===n||"initiator"===n||"responder"===n||"none"===n)return n}return null}},{key:"parseMaxFrameHeight",value:function(e){var t=e.find('>content[name="video"]>max-frame-height');return t.length?Number(t.text()):null}}]),n}(A.a)}).call(this,"/index.js")},,,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(34);function r(e,t){if(!t)return!1;if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(e[n]instanceof Array&&t[n]instanceof Array){if(!e[n].equals(t[n]))return!1}else if(e[n]!==t[n])return!1;return!0}function a(e,t){if(this.mySDP=e,this.otherSDP=t,!e)throw new Error('"mySDP" is undefined!');if(!t)throw new Error('"otherSDP" is undefined!')}a.prototype.getNewMedia=function(){var e=this.mySDP.getMediaSsrcMap(),t=this.otherSDP.getMediaSsrcMap(),n={};return Object.keys(t).forEach((function(i){var a=e[i],o=t[i];a||!o?(Object.keys(o.ssrcs).forEach((function(e){if(-1===Object.keys(a.ssrcs).indexOf(e))n[i]||(n[i]={mediaindex:o.mediaindex,mid:o.mid,ssrcs:{},ssrcGroups:[]}),n[i].ssrcs[e]=o.ssrcs[e];else if(o.ssrcs[e].lines&&a.ssrcs[e].lines){void 0!==a.ssrcs[e].lines.find((function(e){return-1!==e.indexOf("msid")}))!==(void 0!==o.ssrcs[e].lines.find((function(e){return-1!==e.indexOf("msid")})))&&(n[i]||(n[i]={mediaindex:o.mediaindex,mid:o.mid,ssrcs:{},ssrcGroups:[]}),n[i].ssrcs[e]=o.ssrcs[e])}})),o.ssrcGroups.forEach((function(e){for(var t=!1,s=0;s<a.ssrcGroups.length;s++){var c=a.ssrcGroups[s];if(e.semantics===c.semantics&&r(e.ssrcs,c.ssrcs)){t=!0;break}}t||(n[i]||(n[i]={mediaindex:o.mediaindex,mid:o.mid,ssrcs:{},ssrcGroups:[]}),n[i].ssrcGroups.push(e))}))):n[i]=o})),n},a.prototype.toJingle=function(e){var t=this.getNewMedia(),n=!1;return Object.keys(t).forEach((function(r){n=!0;var a=t[r];e.c("content",{name:a.mid}),e.c("description",{xmlns:"urn:xmpp:jingle:apps:rtp:1",media:a.mid}),Object.keys(a.ssrcs).forEach((function(t){var n=a.ssrcs[t];e.c("source",{xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),e.attrs({ssrc:n.ssrc}),n.lines.forEach((function(t){var n=t.indexOf(" "),r=t.substr(n+1);if(e.c("parameter"),-1===r.indexOf(":"))e.attrs({name:r});else{var a=r.split(":",2),o=a[0],s=i.a.filterSpecialChars(a[1]);e.attrs({name:o}),e.attrs({value:s})}e.up()})),e.up()})),a.ssrcGroups.forEach((function(t){t.ssrcs.length&&(e.c("ssrc-group",{semantics:t.semantics,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),t.ssrcs.forEach((function(t){e.c("source",{ssrc:t}).up()})),e.up())})),e.up(),e.up()})),n}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return m}));var i=n(15),r=n(6),a=n(8),o=n(18),s=n(74),c=n.n(s),u=n(39),l=n.n(u),d=n(19),h=n(20),p=Object(o.getLogger)(e),f=["1"],m=function(){function e(t,n){Object(r.a)(this,e),this.pc=t,this.videoBitrates=n.VP8||n,this.localStreamEncodingsConfig=[{active:!0,maxBitrate:h.a.isFirefox()?this.videoBitrates.high:this.videoBitrates.low,rid:"1",scaleResolutionDownBy:h.a.isFirefox()?1:4}]}return Object(a.a)(e,[{key:"_findTransceiver",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=null,i=!t||t&&h.a.doesVideoMuteByStreamRemove()&&t.isVideoTrack()&&t.isMuted();return i?n=this.pc.peerconnection.getTransceivers().find((function(t){var n,i;return(null===(n=t.receiver)||void 0===n||null===(i=n.track)||void 0===i?void 0:i.kind)===e})):t&&(n=this.pc.peerconnection.getTransceivers().find((function(e){var n,i;return(null===(n=e.sender)||void 0===n||null===(i=n.track)||void 0===i?void 0:i.id)===t.getTrackId()}))),n}},{key:"_getStreamEncodings",value:function(e){return this.pc.isSimulcastOn()&&e.isVideoTrack()?this.localStreamEncodingsConfig:e.isVideoTrack()?[{active:!0,maxBitrate:this.videoBitrates.high}]:[{active:!0}]}},{key:"ensureCorrectOrderOfSsrcs",value:function(e){var t=c.a.parse(e.sdp);return t.media.forEach((function(e){if(e.type!==d.a&&e.ssrcGroups&&e.ssrcGroups.length){var t=[];e.ssrcGroups[0].ssrcs.split(" ").forEach((function(n){var i=e.ssrcs.filter((function(e){return e.id.toString()===n}));t=t.concat(i)})),e.ssrcs=t}})),new RTCSessionDescription({type:e.type,sdp:c.a.write(t)})}},{key:"insertUnifiedPlanSimulcastReceive",value:function(e){if(h.a.usesSdpMungingForSimulcast())return e;var t=c.a.parse(e.sdp),n=t.media.findIndex((function(e){return e.type===d.c}));if(t.media[n].rids&&(t.media[n].simulcast_03||t.media[n].simulcast))return t.media.forEach((function(e,i){e.type===d.c&&i!==n&&(t.media[i].rids=void 0,t.media[i].simulcast=void 0,t.media[i].simulcast_03=void 0)})),new RTCSessionDescription({type:e.type,sdp:c.a.write(t)});t.media[n].rids=[{id:"1",direction:"recv"},{id:SIM_LAYER_2_RID,direction:"recv"},{id:SIM_LAYER_3_RID,direction:"recv"}];var i=h.a.isFirefox()&&h.a.isVersionGreaterThan(71)?"recv ".concat(f.join(";")):"recv rid=".concat(f.join(";"));return t.media[n].simulcast_03={value:i},new RTCSessionDescription({type:e.type,sdp:c.a.write(t)})}},{key:"addTrack",value:function(e,t){var n=e.getTrack();if(t){var i={direction:l.a.SENDRECV,streams:[e.getOriginalStream()],sendEncodings:[]};h.a.isFirefox()||(i.sendEncodings=this._getStreamEncodings(e)),this.pc.peerconnection.addTransceiver(n,i)}else this.pc.peerconnection.addTrack(n)}},{key:"addTrackUnmute",value:function(e){var t=e.getType(),n=e.getTrack(),i=this._findTransceiver(t);return i?(p.debug("".concat(this.pc," Adding ").concat(e)),i.sender.replaceTrack(n)):Promise.reject(new Error("RTCRtpTransceiver for ".concat(t," not found")))}},{key:"getLocalStreamHeightConstraints",value:function(e){if(h.a.isReactNative())return null;var t,n=[],r=e.getSettings().height,a=void 0===r?720:r,o=Object(i.a)(this.localStreamEncodingsConfig);try{for(o.s();!(t=o.n()).done;){var s=t.value;n.push(a/s.scaleResolutionDownBy)}}catch(c){o.e(c)}finally{o.f()}return n}},{key:"removeTrackMute",value:function(e){var t=e.getType(),n=this._findTransceiver(t,e);return n?(p.debug("".concat(this.pc," Removing ").concat(e)),n.sender.replaceTrack(null)):Promise.reject(new Error("RTCRtpTransceiver for ".concat(t," not found")))}},{key:"replaceTrack",value:function(e,t){var n=this;if(e&&t){var i=t.getType(),r=t.getOriginalStream();if(!r)return this.pc.localTracks.delete(e.rtcId),this.pc.localTracks.set(t.rtcId,t),Promise.resolve();var a=this._findTransceiver(i,e),o=t.getTrack();return a?(p.debug("".concat(this.pc," Replacing ").concat(e," with ").concat(t)),a.sender.replaceTrack(o).then((function(){var i=n.pc.localSSRCs.get(e.rtcId);n.pc.localTracks.delete(e.rtcId),n.pc.localSSRCs.delete(e.rtcId),n.pc._addedStreams=n.pc._addedStreams.filter((function(e){return e!==r})),n.pc.localTracks.set(t.rtcId,t),n.pc._addedStreams.push(r),n.pc.localSSRCs.set(t.rtcId,i)}))):Promise.reject(new Error("replace track failed"))}return e&&!t?this.removeTrackMute(e).then((function(){var t=e.getType(),i=n._findTransceiver(t);i&&(i.direction=l.a.RECVONLY),n.pc.localTracks.delete(e.rtcId),n.pc.localSSRCs.delete(e.rtcId)})):t&&!e?this.addTrackUnmute(t).then((function(){var e=t.getType(),i=n._findTransceiver(e,t);return i&&(i.direction=l.a.SENDRECV),(h.a.usesSdpMungingForSimulcast()?Promise.resolve():n.setEncodings(t)).then((function(){n.pc.localTracks.set(t.rtcId,t)}))})):(p.info("".concat(this.pc," TPCUtils.replaceTrack called with no new track and no old track")),Promise.resolve())}},{key:"setAudioTransferActive",value:function(e){this.setMediaTransferActive(d.a,e)}},{key:"setEncodings",value:function(e){var t,n,i=e.getType(),r=this._findTransceiver(i,e),a=null===r||void 0===r||null===(t=r.sender)||void 0===t?void 0:t.getParameters();return null!==a&&void 0!==a&&null!==(n=a.encodings)&&void 0!==n&&n.length?(a.encodings=this._getStreamEncodings(e),r.sender.setParameters(a)):Promise.resolve()}},{key:"setMediaTransferActive",value:function(e,t){var n=this.pc.peerconnection.getTransceivers().filter((function(t){return t.receiver&&t.receiver.track&&t.receiver.track.kind===e})),i=this.pc.getLocalTracks(e);p.info("".concat(this.pc," ").concat(t?"Enabling":"Suspending"," ").concat(e," media transfer.")),n.forEach((function(e,n){t?0===n&&i.length?e.direction=l.a.SENDRECV:e.direction=l.a.RECVONLY:e.direction=l.a.INACTIVE}))}},{key:"setVideoTransferActive",value:function(e){this.setMediaTransferActive(d.c,e)}},{key:"updateEncodingsResolution",value:function(e){var t=this;if(h.a.isWebKitBased()&&e.encodings&&Array.isArray(e.encodings)){var n;(n=e.encodings).every((function(e){return"undefined"!==typeof e.scaleResolutionDownBy&&e.scaleResolutionDownBy===n[0].scaleResolutionDownBy}))&&e.encodings.forEach((function(e,n){e.scaleResolutionDownBy=t.localStreamEncodingsConfig[n].scaleResolutionDownBy}))}}}]),e}()}).call(this,"/index.js")},,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var i,r,a=n(24),o=n(6),s=n(8),c=n(12),u=(n(83),n(30)),l=n(4),d=(i=function(){function e(){Object(o.a)(this,e),this.apiVersion=void 0,Object(a.a)(this,"state",r,this),Object(l.g)(this),this.apiVersion="INVALID",this.state=u.a.DISCONNECTED}return Object(s.a)(e,[{key:"changeState",value:function(e){this.state=e}}]),e}(),r=Object(c.a)(i.prototype,"state",[l.h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Object(c.a)(i.prototype,"changeState",[l.b],Object.getOwnPropertyDescriptor(i.prototype,"changeState"),i.prototype),i);t.a=new d},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=config.corsProxyUrl||"https://binaural.me/cors_proxy/";function r(e){var t=e;return["http://","https://"].forEach((function(n){e.substring(0,n.length)===n&&(t=e.substring(n.length))})),t="".concat(i).concat(t)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));window.AudioContext=window.AudioContext||window.webkitAudioContext;var i=null;function r(e,t,n){this.stream=e,this.intervalId=null,this.intervalMilis=t,this.audioLevel=0,this.callback=n}window.AudioContext&&(i=new AudioContext).suspend&&i.suspend(),r.prototype.start=function(){var e=this;if(r.isLocalStatsSupported()){i.resume();var t=i.createAnalyser();t.smoothingTimeConstant=.8,t.fftSize=2048,i.createMediaStreamSource(this.stream).connect(t),this.intervalId=setInterval((function(){var n=new Uint8Array(t.frequencyBinCount);t.getByteTimeDomainData(n);var i=function(e){for(var t=0,n=e.length,i=0;i<n;i++)t<e[i]&&(t=e[i]);return parseFloat(((t-127)/128).toFixed(3))}(n);e.audioLevel=function(e,t){var n=t-e;return parseFloat((n>.2?t-.2:n<-.4?t+.4:e).toFixed(3))}(i,e.audioLevel),e.callback(e.audioLevel)}),this.intervalMilis)}},r.prototype.stop=function(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)},r.isLocalStatsSupported=function(){return Boolean(i)}},function(e,t,n){"use strict";n.r(t),n.d(t,"ON",(function(){return i})),n.d(t,"OFF",(function(){return r}));var i="on",r="off"},function(e,t,n){"use strict";t.a={REMOTE_VIDEO_CONSTRAINTS_CHANGED:"media_session.REMOTE_VIDEO_CONSTRAINTS_CHANGED"}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return g}));var i=n(15),r=n(6),a=n(8),o=n(36),s=n(35),c=n(55),u=n.n(c),l=n(18),d=n(59),h=n(19),p=n(20),f=n(42),m=Object(l.getLogger)(e),v={track_mute:"onmute",track_unmute:"onunmute",track_ended:"onended"},g=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e,i,a,o,s,c){var u;return Object(r.a)(this,n),(u=t.call(this)).addEventListener=u.addListener,u.removeEventListener=u.off=u.removeListener,u.containers=[],u.conference=e,u.audioLevel=-1,u.type=s,u.track=a,u.videoType=c,u.handlers=new Map,u.disposed=!1,u._streamInactiveHandler=o,u._setStream(i),u}return Object(a.a)(n,[{key:"_addMediaStreamInactiveHandler",value:function(e){p.a.isFirefox()?this.track.onended=e:this.stream.oninactive=e}},{key:"_setHandler",value:function(e,t){if(v.hasOwnProperty(e)){if(t?this.handlers.set(e,t):this.handlers.delete(e),this.stream){var n,r=Object(i.a)(this.stream.getTracks());try{for(r.s();!(n=r.n()).done;){n.value[v[e]]=t}}catch(a){r.e(a)}finally{r.f()}}}else m.error("Invalid handler type ".concat(e))}},{key:"_unregisterHandlers",value:function(){if(this.stream){var e,t=Object(i.a)(this.handlers.keys());try{for(t.s();!(e=t.n()).done;){var n,r=e.value,a=Object(i.a)(this.stream.getVideoTracks());try{for(a.s();!(n=a.n()).done;){n.value[v[r]]=void 0}}catch(o){a.e(o)}finally{a.f()}}}catch(o){t.e(o)}finally{t.f()}this._streamInactiveHandler&&this._addMediaStreamInactiveHandler(void 0)}else m.warn("".concat(this,": unable to unregister handlers - no stream object"))}},{key:"_setStream",value:function(e){if(this.stream!==e&&(this.stream=e,this.stream)){var t,n=Object(i.a)(this.handlers.keys());try{for(n.s();!(t=n.n()).done;){var r=t.value;this._setHandler(r,this.handlers.get(r))}}catch(a){n.e(a)}finally{n.f()}this._streamInactiveHandler&&this._addMediaStreamInactiveHandler(this._streamInactiveHandler)}}},{key:"getType",value:function(){return this.type}},{key:"isAudioTrack",value:function(){return this.getType()===h.a}},{key:"isWebRTCTrackMuted",value:function(){return this.track&&this.track.muted}},{key:"isVideoTrack",value:function(){return this.getType()===h.c}},{key:"isLocal",value:function(){throw new Error("Not implemented by subclass")}},{key:"isLocalAudioTrack",value:function(){return this.isAudioTrack()&&this.isLocal()}},{key:"getOriginalStream",value:function(){return this.stream}},{key:"getStreamId",value:function(){return this.stream?this.stream.id:null}},{key:"getTrack",value:function(){return this.track}},{key:"getTrackLabel",value:function(){return this.track.label}},{key:"getTrackId",value:function(){return this.track?this.track.id:null}},{key:"getUsageLabel",value:function(){return this.isAudioTrack()?"mic":this.videoType?this.videoType:"default"}},{key:"_maybeFireTrackAttached",value:function(e){this.conference&&e&&this.conference._onTrackAttach(this,e)}},{key:"attach",value:function(e){this.stream&&(this._onTrackAttach(e),f.a.attachMediaStream(e,this.stream)),this.containers.push(e),this._maybeFireTrackAttached(e),this._attachTTFMTracker(e)}},{key:"detach",value:function(e){for(var t=this.containers,n=t.length-1;n>=0;--n){var i=t[n];e||(this._onTrackDetach(i),f.a.attachMediaStream(i,null)),e&&i!==e||t.splice(n,1)}e&&(this._onTrackDetach(e),f.a.attachMediaStream(e,null))}},{key:"_onTrackAttach",value:function(e){}},{key:"_onTrackDetach",value:function(e){}},{key:"_attachTTFMTracker",value:function(e){}},{key:"dispose",value:function(){return this.removeAllListeners(),this.disposed=!0,Promise.resolve()}},{key:"isScreenSharing",value:function(){}},{key:"getId",value:function(){return this.stream?f.a.getStreamID(this.stream):null}},{key:"isActive",value:function(){return"undefined"===typeof this.stream.active||this.stream.active}},{key:"setAudioLevel",value:function(e,t){var n=e;p.a.supportsReceiverStats()&&"undefined"!==typeof t&&this.isMuted()&&(n=0),this.audioLevel!==n?(this.audioLevel=n,this.emit(d.TRACK_AUDIO_LEVEL_CHANGED,n,t)):0===this.audioLevel&&0===n&&this.isLocal()&&!this.isWebRTCTrackMuted()&&this.emit(d.NO_AUDIO_INPUT,n)}},{key:"getMSID",value:function(){var e=this.getStreamId(),t=this.getTrackId();return e&&t?"".concat(e," ").concat(t):null}},{key:"setAudioOutput",value:function(e){var t=this;return f.a.isDeviceChangeAvailable("output")?this.isVideoTrack()?Promise.resolve():Promise.all(this.containers.map((function(t){return t.setSinkId(e).catch((function(e){throw m.warn("Failed to change audio output device on element. Default or previously set audio output device will be used.",t,e),e}))}))).then((function(){t.emit(d.TRACK_AUDIO_OUTPUT_CHANGED,e)})):Promise.reject(new Error("Audio output device change is not supported"))}}]),n}(u.a)}).call(this,"/index.js")},function(e,t){e.exports={2160:{width:3840,height:2160},"4k":{width:3840,height:2160},1080:{width:1920,height:1080},fullhd:{width:1920,height:1080},720:{width:1280,height:720},hd:{width:1280,height:720},540:{width:960,height:540},qhd:{width:960,height:540},480:{width:640,height:480},vga:{width:640,height:480},360:{width:640,height:360},240:{width:320,height:240},180:{width:320,height:180}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var i=n(69),r=n(6),a=n(8),o=n(31),s=n(36),c=n(35),u=n(55),l=n.n(u),d=n(44),h=n(219),p=n(76),f=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e,i,a){var s;return Object(r.a)(this,n),(s=t.call(this))._procNodeSampleRate=e,s._vadProcessor=i,s._localTrack=a,s._bufferResidue=new Float32Array([]),s._audioContext=Object(h.a)({sampleRate:i.getRequiredPCMFrequency()}),s._vadSampleSize=i.getSampleLength(),s._onAudioProcess=s._onAudioProcess.bind(Object(o.a)(s)),s._initializeAudioContext(),s}return Object(a.a)(n,[{key:"_initializeAudioContext",value:function(){this._audioSource=this._audioContext.createMediaStreamSource(this._localTrack.stream),this._audioProcessingNode=this._audioContext.createScriptProcessor(this._procNodeSampleRate,1,1)}},{key:"_onAudioProcess",value:function(e){for(var t=e.inputBuffer.getChannelData(0),n=[].concat(Object(i.a)(this._bufferResidue),Object(i.a)(t)),r=Date.now(),a=0;a+this._vadSampleSize<n.length;a+=this._vadSampleSize){var o=n.slice(a,a+this._vadSampleSize),s=this._vadProcessor.calculateAudioFrameVAD(o.slice());this.emit(p.VAD_SCORE_PUBLISHED,{timestamp:r,score:s,pcmData:o,deviceId:this._localTrack.getDeviceId()})}this._bufferResidue=n.slice(a,n.length)}},{key:"_connectAudioGraph",value:function(){this._audioProcessingNode.onaudioprocess=this._onAudioProcess,this._audioSource.connect(this._audioProcessingNode),this._audioProcessingNode.connect(this._audioContext.destination)}},{key:"_disconnectAudioGraph",value:function(){this._audioProcessingNode.onaudioprocess=function(){},this._audioProcessingNode.disconnect(),this._audioSource.disconnect()}},{key:"_cleanupResources",value:function(){this._disconnectAudioGraph(),this._localTrack.stopStream()}},{key:"getDeviceId",value:function(){return this._localTrack.getDeviceId()}},{key:"getTrackLabel",value:function(){return this._localTrack.getDeviceLabel()}},{key:"start",value:function(){this._connectAudioGraph()}},{key:"stop",value:function(){this._disconnectAudioGraph(),this._bufferResidue=[]}},{key:"destroy",value:function(){this._destroyed||(this._cleanupResources(),this._destroyed=!0)}}],[{key:"create",value:function(e,t,i){return d.a.obtainAudioAndVideoPermissions({devices:["audio"],micDeviceId:e}).then((function(r){if(!r[0])throw new Error("Failed to create jitsi local track for device id: ".concat(e));return new n(t,i,r[0])}))}}]),n}(l.a)},function(e,t,n){"use strict";function i(e){var t=window.AudioContext||window.webkitAudioContext;if(t)return new t(e)}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";n.r(t),n.d(t,"E2E_RTT_CHANGED",(function(){return i}));var i="e2eping.e2e_rtt_changed"},,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"b",(function(){return p})),n.d(t,"a",(function(){return f}));var i,r,a=n(24),o=n(6),s=n(8),c=n(12),u=(n(83),n(63)),l=n(45),d=n.n(l),h=n(4);var p={pose:{position:[u.a[0],u.a[1]],orientation:0}},f=(i=function(){function e(){Object(o.a)(this,e),Object(a.a)(this,"pose",r,this),this.pose=d.a.cloneDeep(p.pose),Object(h.g)(this)}return Object(s.a)(e,null,[{key:"fromPlain",value:function(t){(new e).pose=function(e){return Object(h.h)(e,void 0,{deep:!1})}(d.a.cloneDeep(t.pose))}}]),e}(),r=Object(c.a)(i.prototype,"pose",[h.h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i)},,function(e,t,n){var i=n(307),r=n(308),a=function(){"use strict";function e(t,n,r){i(this,e),this._userId=t,this.setDisplayName(n),this._isLocalStats=r||!1,this.setDominantSpeaker(!1),this.totalDominantSpeakerTime=0,this._dominantSpeakerStart=0,this._hasLeft=!1}return r(e,[{key:"getUserId",value:function(){return this._userId}},{key:"getDisplayName",value:function(){return this.displayName}},{key:"setDisplayName",value:function(e){this.displayName=e}},{key:"isLocalStats",value:function(){return this._isLocalStats}},{key:"isDominantSpeaker",value:function(){return this._dominantSpeakerStart>0}},{key:"setDominantSpeaker",value:function(e){if(!this.isDominantSpeaker()&&e)this._dominantSpeakerStart=Date.now();else if(this.isDominantSpeaker()&&!e){var t=Date.now()-this._dominantSpeakerStart;this.totalDominantSpeakerTime+=t,this._dominantSpeakerStart=0}}},{key:"getTotalDominantSpeakerTime",value:function(){var e=this.totalDominantSpeakerTime;return this.isDominantSpeaker()&&(e+=Date.now()-this._dominantSpeakerStart),e}},{key:"hasLeft",value:function(){return this._hasLeft}},{key:"markAsHasLeft",value:function(){this._hasLeft=!0,this.setDominantSpeaker(!1)}}]),e}();e.exports=a},function(e,t,n){"use strict";var i=n(7),r=n(53),a=n(6),o=n(8),s=n(55),c=n.n(s),u=n(153),l=n(44),d=n(20),h=n(26),p=n(19),f=n(29),m=n.n(f),v="microphone",g="granted",b="camera",y=function(){function e(){var t=this;Object(a.a)(this,e),this._eventEmitter=new c.a,this._permissions={},l.a.addListener(m.a.DEVICE_LIST_CHANGED,(function(e){return t._eventEmitter.emit(u.DEVICE_LIST_CHANGED,e)})),l.a.addListener(m.a.DEVICE_LIST_AVAILABLE,(function(e){return t._logOutputDevice(t.getAudioOutputDevice(),e)})),l.a.addListener(m.a.PERMISSIONS_CHANGED,(function(e){return t._handlePermissionsChange(e)})),this._permissionsApiSupported=new Promise((function(e){if(navigator.permissions){var n=t,i=[];i.push(navigator.permissions.query({name:b}).then((function(e){return t._handlePermissionsChange(Object(r.a)({},p.c,t._parsePermissionState(e))),e.onchange=function(){try{n._handlePermissionsChange(Object(r.a)({},p.c,n._parsePermissionState(this)))}catch(e){}},!0})).catch((function(){return!1}))),i.push(navigator.permissions.query({name:v}).then((function(e){return t._handlePermissionsChange(Object(r.a)({},p.a,t._parsePermissionState(e))),e.onchange=function(){try{n._handlePermissionsChange(Object(r.a)({},p.a,n._parsePermissionState(this)))}catch(e){}},!0})).catch((function(){return!1}))),Promise.all(i).then((function(t){return e(t.every((function(e){return e})))}))}else e(!1)}))}return Object(o.a)(e,[{key:"_parsePermissionState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.state||e.status;if("string"!==typeof t)throw new TypeError;return t===g}},{key:"_handlePermissionsChange",value:function(e){var t=this;[p.a,p.c].some((function(n){return n in e&&e[n]!==t._permissions[n]}))&&(this._permissions=Object(i.a)(Object(i.a)({},this._permissions),e),this._eventEmitter.emit(u.PERMISSIONS_CHANGED,this._permissions),(this._permissions[p.a]||this._permissions[p.c])&&this.enumerateDevices((function(){})))}},{key:"_logOutputDevice",value:function(e,t){var n=t.find((function(t){return"audiooutput"===t.kind&&t.deviceId===e}));n&&h.a.sendActiveDeviceListEvent(l.a.getEventDataForActiveDevice(n))}},{key:"enumerateDevices",value:function(e){l.a.enumerateDevices(e)}},{key:"isDeviceListAvailable",value:function(){return l.a.isDeviceListAvailable()}},{key:"isDeviceChangeAvailable",value:function(e){return l.a.isDeviceChangeAvailable(e)}},{key:"isDevicePermissionGranted",value:function(e){var t=this;return new Promise((function(n){e in t._permissions?n(t._permissions[e]):t._permissionsApiSupported.then((function(i){if(i){var r=[];switch(e){case p.c:r.push(navigator.permissions.query({name:b}));break;case p.a:r.push(navigator.permissions.query({name:v}));break;default:r.push(navigator.permissions.query({name:b})),r.push(navigator.permissions.query({name:v}))}Promise.all(r).then((function(e){return n(e.every((function(e){try{return t._parsePermissionState(e)}catch(n){return!1}})))}),(function(){return n(!1)}))}else n(!1)}))}))}},{key:"isMultipleAudioInputSupported",value:function(){return!d.a.isFirefox()}},{key:"getAudioOutputDevice",value:function(){return l.a.getAudioOutputDevice()}},{key:"setAudioOutputDevice",value:function(e){return l.a.getCurrentlyAvailableMediaDevices().length>0&&this._logOutputDevice(e,l.a.getCurrentlyAvailableMediaDevices()),l.a.setAudioOutputDevice(e)}},{key:"addEventListener",value:function(e,t){this._eventEmitter.addListener(e,t)}},{key:"removeEventListener",value:function(e,t){this._eventEmitter.removeListener(e,t)}},{key:"emitEvent",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];(t=this._eventEmitter).emit.apply(t,[e].concat(i))}}]),e}();t.a=new y},,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){e.exports={IDENTITY_UPDATED:"authentication.identity_updated"}},function(e,t,n){"use strict";var i=n(209);n.d(t,"a",(function(){return i.a}));n(11)},,,function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return c}));var i=n(60),r=n.n(i),a=n(87);function o(e){return s.apply(this,arguments)}function s(){return(s=Object(a.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new TextEncoder,e.abrupt("return",crypto.subtle.deriveBits({name:"HKDF",salt:n.encode("JFrameRatchetKey"),hash:"SHA-256",info:new ArrayBuffer},t,256));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function c(e){return u.apply(this,arguments)}function u(){return(u=Object(a.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",crypto.subtle.importKey("raw",t,"HKDF",!1,["deriveBits","deriveKey"]));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},function(e,t,n){"use strict";n.d(t,"b",(function(){return f})),n.d(t,"a",(function(){return m}));var i=n(6),r=n(8),a=n(36),o=n(35),s=n(13),c=n(9),u=n.n(c),l=n(72),d=["category","type","lang","name"],h=["category","type","lang"];function p(e,t){var n=0;return h.some((function(i){return 0!==(n=e[i]>t[i]?1:e[i]<t[i]&&-1)})),n}function f(e){var t=new Set,n=new Set;return $(e).find(">query>feature").each((function(e,n){return t.add(n.getAttribute("var"))})),$(e).find(">query>identity").each((function(e,t){return n.add({type:t.getAttribute("type"),name:t.getAttribute("name"),category:t.getAttribute("category")})})),{features:t,identities:n}}var m=function(e){Object(a.a)(n,e);var t=Object(o.a)(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"http://jitsi.org/jitsimeet";if(Object(i.a)(this,n),(e=t.call(this)).node=a,e.disco=r.disco,!e.disco)throw new Error("Missing strophe-plugins (disco plugin is required)!");e.version="",e.rooms=new Set,e.externalFeatures=new Set;var o=r.emuc;return o.addListener(u.a.EMUC_ROOM_ADDED,(function(t){return e._addChatRoom(t)})),o.addListener(u.a.EMUC_ROOM_REMOVED,(function(t){return e._removeChatRoom(t)})),Object.keys(o.rooms).forEach((function(t){e._addChatRoom(o.rooms[t])})),s.Strophe.addNamespace("CAPS","http://jabber.org/protocol/caps"),e.disco.addFeature(s.Strophe.NS.CAPS),e}return Object(r.a)(n,[{key:"addFeature",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.disco.addFeature(e),this._generateVersion(),i&&!this.externalFeatures.has(e)&&(this.externalFeatures.add(e),this.rooms.forEach((function(e){return t._updateRoomWithExternalFeatures(e)}))),n&&this.submit()}},{key:"removeFeature",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.disco.removeFeature(e),this._generateVersion(),i&&this.externalFeatures.has(e)&&(this.externalFeatures.delete(e),this.rooms.forEach((function(e){return t._updateRoomWithExternalFeatures(e)}))),n&&this.submit()}},{key:"submit",value:function(){this.rooms.forEach((function(e){return e.sendPresence()}))}},{key:"_updateRoomWithExternalFeatures",value:function(e){if(0===this.externalFeatures.size)e.removeFromPresence("features");else{var t=[];this.externalFeatures.forEach((function(e){t.push({tagName:"feature",attributes:{var:e}})})),e.addOrReplaceInPresence("features",{children:t})}}},{key:"getFeaturesAndIdentities",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3;return this._getDiscoInfo(e,t,n)}},{key:"_getDiscoInfo",value:function(e,t,n){var i=this;return new Promise((function(r,a){return i.disco.info(e,t,(function(e){r(f(e))}),a,n)}))}},{key:"_addChatRoom",value:function(e){this.rooms.add(e),this._fixChatRoomPresenceMap(e),this._updateRoomWithExternalFeatures(e)}},{key:"_removeChatRoom",value:function(e){this.rooms.delete(e)}},{key:"_fixChatRoomPresenceMap",value:function(e){e.addOrReplaceInPresence("c",{attributes:{xmlns:s.Strophe.NS.CAPS,hash:"sha-1",node:this.node,ver:this.version}})}},{key:"_notifyVersionChanged",value:function(){var e=this;this.rooms.forEach((function(t){return e._fixChatRoomPresenceMap(t)}))}},{key:"_generateVersion",value:function(){this.version=function(e,t){var n=e.sort(p).reduce((function(e,t){return"".concat(d.reduce((function(e,n,i){return e+(0===i?"":"/")+(t[n]?t[n]:"")}),""),"<")}),""),i=t.sort().reduce((function(e,t){return"".concat(e+t,"<")}),"");return Object(s.b64_sha1)(n+i)}(this.disco._identities,this.disco._features),this._notifyVersionChanged()}}]),n}(l.a)},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return m}));var i=n(15),r=n(6),a=n(8),o=n(31),s=n(36),c=n(35),u=n(55),l=n(18),d=n(10),h=n(76),p=n(218),f=Object(l.getLogger)(e),m=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e,i){var a;return Object(r.a)(this,n),(a=t.call(this))._createVADProcessor=i,a._vadEmitter=null,a._isVADEmitterRunning=!1,a._detectionServices=[],a._vadInitTracker=Promise.resolve(),a._processVADScore=a._processVADScore.bind(Object(o.a)(a)),e.on(d.TRACK_ADDED,a._trackAdded.bind(Object(o.a)(a))),e.on(d.TRACK_REMOVED,a._trackRemoved.bind(Object(o.a)(a))),e.on(d.TRACK_MUTE_CHANGED,a._trackMuteChanged.bind(Object(o.a)(a))),a}return Object(a.a)(n,[{key:"addVADDetectionService",value:function(e){var t=this;this._detectionServices.push(e),e.on(h.DETECTOR_STATE_CHANGE,(function(){!t._detectionServices.filter((function(e){return!0===e.isActive()})).length&&t._isVADEmitterRunning?t._stopVADEmitter():t._isVADEmitterRunning||t._startVADEmitter()}))}},{key:"_startVADEmitter",value:function(){this._vadEmitter.on(h.VAD_SCORE_PUBLISHED,this._processVADScore),this._vadEmitter.start(),this._isVADEmitterRunning=!0}},{key:"_stopVADEmitter",value:function(){this._vadEmitter.removeListener(h.VAD_SCORE_PUBLISHED,this._processVADScore),this._vadEmitter.stop(),this._isVADEmitterRunning=!1}},{key:"_processVADScore",value:function(e){var t,n=Object(i.a)(this._detectionServices);try{for(n.s();!(t=n.n()).done;){t.value.processVADScore(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"_changeDetectorsMuteState",value:function(e){var t,n=Object(i.a)(this._detectionServices);try{for(n.s();!(t=n.n()).done;){t.value.changeMuteState(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"_trackAdded",value:function(e){var t=this;e.isLocalAudioTrack()&&(this._vadInitTracker=this._vadInitTracker.then((function(){return t._createVADProcessor()})).then((function(t){return p.a.create(e.getDeviceId(),4096,t)})).then((function(n){f.debug("Created VAD emitter for track: ",e.getTrackLabel()),t._vadEmitter=n,t._changeDetectorsMuteState(e.isMuted())})).catch((function(e){f.warn("Failed to start VADAudioAnalyser",e)})))}},{key:"_trackMuteChanged",value:function(e){var t=this;e.isLocalAudioTrack()&&(this._vadInitTracker=this._vadInitTracker.then((function(){t._changeDetectorsMuteState(e.isMuted())})))}},{key:"_trackRemoved",value:function(e){var t=this;e.isLocalAudioTrack()&&(this._vadInitTracker=this._vadInitTracker.then((function(){f.debug("Removing track from VAD detection - ",e.getTrackLabel()),t._vadEmitter&&(t._stopVADEmitter(),t._vadEmitter.destroy(),t._vadEmitter=null);var n,r=Object(i.a)(t._detectionServices);try{for(r.s();!(n=r.n()).done;){n.value.reset()}}catch(a){r.e(a)}finally{r.f()}})))}}]),n}(u.EventEmitter)}).call(this,"/index.js")},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(6),r=n(8),a=n(13),o=n(169),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,e),this._connection=t.connection,this._mode=t.mode,this._setSessionID(t.sessionID),this.setStatus(t.status)}return Object(r.a)(e,[{key:"getError",value:function(){return this._error}},{key:"getID",value:function(){return this._sessionID}},{key:"getInitiator",value:function(){return this._initiator}},{key:"getLiveStreamViewURL",value:function(){return this._liveStreamViewURL}},{key:"getStatus",value:function(){return this._status}},{key:"getTerminator",value:function(){return this._terminator}},{key:"getMode",value:function(){return this._mode}},{key:"setError",value:function(e){this._error=e}},{key:"setLiveStreamViewURL",value:function(e){this._liveStreamViewURL=e}},{key:"setStatus",value:function(e){this._status=e}},{key:"setInitiator",value:function(e){this._initiator=e}},{key:"setTerminator",value:function(e){this._terminator=e}},{key:"start",value:function(e){var t=this,n=e.appData,i=e.broadcastId,r=e.focusMucJid,a=e.streamId;return new Promise((function(e,s){t._connection.sendIQ(t._createIQ({action:"start",appData:n,focusMucJid:r,broadcastId:i,streamId:a}),(function(n){t.setStatus("pending"),t._setSessionID(o.a.getSessionIdFromIq(n)),e()}),(function(e){t._setErrorFromIq(e),s(e)}))}))}},{key:"stop",value:function(e){var t=this,n=e.focusMucJid;return new Promise((function(e,i){t._connection.sendIQ(t._createIQ({action:"stop",focusMucJid:n}),e,i)}))}},{key:"_createIQ",value:function(e){var t=e.action,n=e.appData,i=e.broadcastId,r=e.focusMucJid,o=e.streamId;return Object(a.$iq)({to:r,type:"set"}).c("jibri",{xmlns:"http://jitsi.org/protocol/jibri",action:t,app_data:n,recording_mode:this._mode,streamid:o,you_tube_broadcast_id:i}).up()}},{key:"_setErrorFromIq",value:function(e){var t=e.getElementsByTagName("error")[0];this.setError(t.children[0].tagName)}},{key:"_setSessionID",value:function(e){this._sessionID=e}}]),e}()},,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){var i=n(501),r="audio/webm",a="audio/ogg",o=function(e){this.track=e,this.recorder=null,this.data=null,this.name=null,this.startTime=null};function s(e){if(void 0===e.recorder)throw new Error("Passed an object to startRecorder which is not a TrackRecorder object");e.recorder.start(),e.startTime=new Date}function c(e){if(void 0===e.recorder)throw new Error("Passed an object to stopRecorder which is not a TrackRecorder object");e.recorder.stop()}function u(){if(MediaRecorder.isTypeSupported(r))return r;if(MediaRecorder.isTypeSupported(a))return a;throw new Error("unable to create a MediaRecorder with the right mimetype!")}function l(e){this.recorders=[],this.fileType=u(),this.isRecording=!1,this.jitsiConference=e}l.determineCorrectFileType=u,l.prototype.addTrack=function(e){if(e.isAudioTrack()){var t=this.instantiateTrackRecorder(e);this.recorders.push(t),this.updateNames(),this.isRecording&&s(t)}},l.prototype.instantiateTrackRecorder=function(e){var t=new o(e),n=t.track.getOriginalStream(),i=new MediaStream;return n.getAudioTracks().forEach((function(e){return i.addTrack(e)})),t.recorder=new MediaRecorder(i,{mimeType:this.fileType}),t.data=[],t.recorder.ondataavailable=function(e){e.data.size>0&&t.data.push(e.data)},t},l.prototype.removeTrack=function(e){if(!e.isVideoTrack()){var t,n=this.recorders;for(t=0;t<n.length;t++)if(n[t].track.getParticipantId()===e.getParticipantId()){var i=n[t];this.isRecording?c(i):n.splice(t,1)}this.updateNames()}},l.prototype.updateNames=function(){var e=this.jitsiConference;this.recorders.forEach((function(t){if(t.track.isLocal())t.name="the transcriber";else{var n=t.track.getParticipantId(),i=e.getParticipantById(n).getDisplayName();"undefined"!==i&&(t.name=i)}}))},l.prototype.start=function(){if(this.isRecording)throw new Error("audiorecorder is already recording");this.isRecording=!0,this.recorders.forEach((function(e){return s(e)})),console.log("Started the recording of the audio. There are currently ".concat(this.recorders.length," recorders active."))},l.prototype.stop=function(){this.isRecording=!1,this.recorders.forEach((function(e){return c(e)})),console.log("stopped recording")},l.prototype.download=function(){var e=this;this.recorders.forEach((function(t){var n=new Blob(t.data,{type:e.fileType}),i=URL.createObjectURL(n),r=document.createElement("a");document.body.appendChild(r),r.style="display: none",r.href=i,r.download="test.".concat(e.fileType.split("/")[1]),r.click(),window.URL.revokeObjectURL(i)}))},l.prototype.getRecordingResults=function(){var e=this;if(this.isRecording)throw new Error("cannot get blobs because the AudioRecorder is still recording!");this.updateNames();var t=[];return this.recorders.forEach((function(n){return t.push(new i(new Blob(n.data,{type:e.fileType}),n.name,n.startTime))})),t},l.prototype.getFileType=function(){return this.fileType},e.exports=l},,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(340),r=n(80),a=n(26),o=n(77),s=n(32);function c(e,t,n){this.appID=e,this.token=t,this.options=n,this.xmpp=new o.e(n,t),this.addEventListener(r.CONNECTION_FAILED,(function(e,t,n,i){a.a.sendAnalyticsAndLog(Object(s.B)(e,t,i))})),this.addEventListener(r.CONNECTION_DISCONNECTED,(function(e){e&&a.a.sendAnalytics(s.m,{message:e}),a.a.sendLog(JSON.stringify({id:s.m,msg:e}))}))}c.prototype.connect=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.xmpp.connect(e.id,e.password)},c.prototype.attach=function(e){this.xmpp.attach(e)},c.prototype.disconnect=function(){var e;return(e=this.xmpp).disconnect.apply(e,arguments)},c.prototype.getJid=function(){return this.xmpp.getJid()},c.prototype.setToken=function(e){this.token=e},c.prototype.initJitsiConference=function(e,t){return new i.a({name:e,config:t,connection:this})},c.prototype.addEventListener=function(e,t){this.xmpp.addListener(e,t)},c.prototype.removeEventListener=function(e,t){this.xmpp.removeListener(e,t)},c.prototype.getConnectionTimes=function(){return this.xmpp.connectionTimes},c.prototype.addFeature=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.xmpp.caps.addFeature(e,t,!0)},c.prototype.removeFeature=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.xmpp.caps.removeFeature(e,t,!0)},c.prototype.getLogs=function(){var e=this.xmpp.getJingleLog(),t={};t.time=new Date,t.url=window.location.href,t.ua=navigator.userAgent;var n=this.xmpp.getXmppLog();return n&&(t.xmpp=n),e.metadata=t,e}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return ce}));var i=n(53),r=n(15),a=n(7),o=n(55),s=n.n(o),c=n(18),u=n(105),l=n.n(u),d=n(13),h=n(64),p=n(341),f=n(10),m=n(348),v=n(70),g=n(52),b=n(59),y=n(349),E=n(371),S=n(44),O=n(20),_=n(378),C=n(379),T=n(164),j=n(76),A=n(380),k=n(381),R=n(285),I=n(382),P=n(383),w=n(182),N=n(384),D=n(385),M=n(386),L=n(387),x=n(388),F=n(96),U=n(389),V=n(390),B=n(391),J=n(26),H=n(392),z=n.n(H),G=n(43),K=n.n(G),Q=n(120),q=n.n(Q),W=n(393),Y=n(394),X=n(78),Z=n(77),ee=n(71),te=n.n(ee),ne=n(19),ie=n(50),re=n.n(ie),ae=n(32),oe=n(9),se=Object(c.getLogger)(e);function ce(e){if(!e.name||e.name.toLowerCase()!==e.name){var t="Invalid conference name (no conference name passed or it contains invalid characters like capital letters)!";throw se.error(t),new Error(t)}this.eventEmitter=new s.a,this.options=e,this.eventManager=new p.a(this),this.participants={},this._init(e),this.componentsVersions=new W.a(this),this.jvbJingleSession=null,this.lastDominantSpeaker=null,this.dtmfManager=null,this.somebodySupportsDTMF=!1,this.authEnabled=!1,this.startAudioMuted=!1,this.startVideoMuted=!1,this.startMutedPolicy={audio:!1,video:!1},this.isMutedByFocus=!1,this.mutedByFocusActor=null,this.isVideoMutedByFocus=!1,this.mutedVideoByFocusActor=null,this.wasStopped=!1,this.properties={},this.connectionQuality=new _.a(this,this.eventEmitter,e),this.avgRtpStatsReporter=new V.a(this,e.config.avgRtpStatsN||15),this._audioOutputProblemDetector=new U.a(this),this.isJvbConnectionInterrupted=!1,this.speakerStatsCollector=new B.a(this),this.deferredStartP2PTask=null;var n=parseInt(e.config.p2p&&e.config.p2p.backToP2PDelay,10);this.backToP2PDelay=isNaN(n)?5:n,se.info("backToP2PDelay: ".concat(this.backToP2PDelay)),this.isP2PConnectionInterrupted=!1,this.p2p=!1,this.p2pJingleSession=null,this.videoSIPGWHandler=new Y.a(this.room),this.recordingManager=new x.a(this.room),this._conferenceJoinAnalyticsEventSent=void 0,this.isE2EESupported()&&(se.info("End-to-End Encryprtion is supported"),this._e2eEncryption=new w.a(this))}ce.prototype.constructor=ce,ce.resourceCreator=function(e,t){var n;if(t)n=q.a.randomHexString(8).toLowerCase();else{n=d.Strophe.getNodeFromJid(e).substr(0,8).toLowerCase();/[0-9a-f]{8}/g.test(n)||(n=q.a.randomHexString(8).toLowerCase())}return n},ce.prototype._init=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.connection&&(this.connection=t.connection,this.xmpp=this.connection.xmpp,this.eventManager.setupXMPPListeners());var n=this.options.config,i={disabledCodec:n.videoQuality?n.videoQuality.disabledCodec:n.p2p&&n.p2p.disableH264&&te.a.H264,enforcePreferredCodec:n.videoQuality&&n.videoQuality.enforcePreferredCodec,jvbCodec:n.videoQuality&&n.videoQuality.preferredCodec||n.preferH264&&te.a.H264,p2pCodec:n.p2p?n.p2p.preferredCodec||n.p2p.preferH264&&te.a.H264:te.a.VP8};this.codecSelection=new E.a(this,i),this._statsCurrentId=n.statisticsId?n.statisticsId:F.a.callStatsUserName,this.room=this.xmpp.createRoom(this.options.name,Object(a.a)(Object(a.a)({},n),{},{statsId:this._statsCurrentId}),ce.resourceCreator),this._onIceConnectionInterrupted=this._onIceConnectionInterrupted.bind(this),this.room.addListener(oe.CONNECTION_INTERRUPTED,this._onIceConnectionInterrupted),this._onIceConnectionRestored=this._onIceConnectionRestored.bind(this),this.room.addListener(oe.CONNECTION_RESTORED,this._onIceConnectionRestored),this._onIceConnectionEstablished=this._onIceConnectionEstablished.bind(this),this.room.addListener(oe.CONNECTION_ESTABLISHED,this._onIceConnectionEstablished),this._updateProperties=this._updateProperties.bind(this),this.room.addListener(oe.CONFERENCE_PROPERTIES_CHANGED,this._updateProperties),this._sendConferenceJoinAnalyticsEvent=this._sendConferenceJoinAnalyticsEvent.bind(this),this.room.addListener(oe.MEETING_ID_SET,this._sendConferenceJoinAnalyticsEvent),this.e2eping=new N.a(this,n,(function(t,n){try{e.sendMessage(t,n,!0)}catch(i){se.warn("Failed to send E2E ping request or response to ".concat(n,"."),i&&i.msg)}})),this.rtc||(this.rtc=new S.a(this,t),this.eventManager.setupRTCListeners()),this.receiveVideoController=new M.a(this,this.rtc),this.sendVideoController=new L.a(this,this.rtc),this.participantConnectionStatus=new T.b(this.rtc,this,{rtcMuteTimeout:n._peerConnStatusRtcMuteTimeout,outOfLastNTimeout:n._peerConnStatusOutOfLastNTimeout}),this.participantConnectionStatus.init();var r=!0;if(n.testing&&n.testing.callStatsThreshold&&(r=100*Math.random()<=n.testing.callStatsThreshold),this.statistics||(this.statistics=new J.a(this.xmpp,{aliasName:this._statsCurrentId,userName:n.statisticsDisplayName?n.statisticsDisplayName:this.myUserId(),confID:n.confID||"".concat(this.connection.options.hosts.domain,"/").concat(this.options.name),siteID:n.siteID,customScriptUrl:n.callStatsCustomScriptUrl,callStatsID:n.callStatsID,callStatsSecret:n.callStatsSecret,callStatsApplicationLogsDisabled:n.callStatsApplicationLogsDisabled,enableCallStats:r,roomName:this.options.name,applicationName:n.applicationName,getWiFiStatsMethod:n.getWiFiStatsMethod}),J.a.analytics.addPermanentProperties({callstats_name:this._statsCurrentId}),n.longTasksStatsInterval&&this.statistics.attachLongTasksStats(this)),this.eventManager.setupChatRoomListeners(),this.eventManager.setupStatisticsListeners(),n.enableTalkWhileMuted&&O.a.supportsVADDetection())if(n.createVADProcessor){se.info("Using VAD detection for generating talk while muted events"),this._audioAnalyser||(this._audioAnalyser=new R.a(this,n.createVADProcessor));var o=new P.a;o.on(j.VAD_TALK_WHILE_MUTED,(function(){return e.eventEmitter.emit(f.TALK_WHILE_MUTED)})),this._audioAnalyser.addVADDetectionService(o)}else se.warn("No VAD Processor was provided. Talk while muted detection service was not initialized!");if(n.enableNoisyMicDetection&&O.a.supportsVADDetection())if(n.createVADProcessor){this._audioAnalyser||(this._audioAnalyser=new R.a(this,n.createVADProcessor));var s=new I.a;s.on(j.VAD_NOISY_DEVICE,(function(){return e.eventEmitter.emit(f.NOISY_MIC)})),this._audioAnalyser.addVADDetectionService(s)}else se.warn("No VAD Processor was provided. Noisy microphone detection service was not initialized!");n.enableNoAudioDetection&&(this._noAudioSignalDetection=new A.a(this),this._noAudioSignalDetection.on(j.NO_AUDIO_INPUT,(function(){e.eventEmitter.emit(f.NO_AUDIO_INPUT)})),this._noAudioSignalDetection.on(j.AUDIO_INPUT_STATE_CHANGE,(function(t){e.eventEmitter.emit(f.AUDIO_INPUT_STATE_CHANGE,t)}))),"channelLastN"in n&&this.setLastN(n.channelLastN),this.jvb121Status=new D.a(this),this.p2pDominantSpeakerDetection=new k.a(this),n&&n.deploymentInfo&&n.deploymentInfo.userRegion&&this.setLocalParticipantProperty("region",n.deploymentInfo.userRegion),this.setLocalParticipantProperty("codecType",this.codecSelection.getPreferredCodec())},ce.prototype.join=function(e){var t=this;this.room&&this.room.join(e).then((function(){return t._maybeSetSITimeout()}))},ce.prototype.authenticateAndUpgradeRole=function(e){return y.a.call(this,Object(a.a)(Object(a.a)({},e),{},{onCreateResource:ce.resourceCreator}))},ce.prototype.isJoined=function(){return this.room&&this.room.joined},ce.prototype.isP2PEnabled=function(){return Boolean(this.options.config.p2p&&this.options.config.p2p.enabled)||"undefined"===typeof this.options.config.p2p},ce.prototype.isP2PTestModeEnabled=function(){return Boolean(this.options.config.testing&&this.options.config.testing.p2pTestMode)},ce.prototype.leave=function(){var e=this;if(this.participantConnectionStatus&&(this.participantConnectionStatus.dispose(),this.participantConnectionStatus=null),this.avgRtpStatsReporter&&(this.avgRtpStatsReporter.dispose(),this.avgRtpStatsReporter=null),this._audioOutputProblemDetector&&(this._audioOutputProblemDetector.dispose(),this._audioOutputProblemDetector=null),this.e2eping&&(this.e2eping.stop(),this.e2eping=null),this.getLocalTracks().forEach((function(t){return e.onLocalTrackRemoved(t)})),this.rtc.closeBridgeChannel(),this._sendConferenceLeftAnalyticsEvent(),this.statistics&&this.statistics.dispose(),this._delayedIceFailed&&this._delayedIceFailed.cancel(),this.jvbJingleSession&&(this.jvbJingleSession.close(),this.jvbJingleSession=null),this.p2pJingleSession&&(this.p2pJingleSession.close(),this.p2pJingleSession=null),this.room){var t=this.room;return t.removeListener(oe.CONNECTION_INTERRUPTED,this._onIceConnectionInterrupted),t.removeListener(oe.CONNECTION_RESTORED,this._onIceConnectionRestored),t.removeListener(oe.CONNECTION_ESTABLISHED,this._onIceConnectionEstablished),t.removeListener(oe.CONFERENCE_PROPERTIES_CHANGED,this._updateProperties),t.removeListener(oe.MEETING_ID_SET,this._sendConferenceJoinAnalyticsEvent),this.eventManager.removeXMPPListeners(),this.room=null,t.leave().then((function(){e.rtc&&e.rtc.destroy()})).catch((function(t){throw e.getParticipants().forEach((function(t){return e.onMemberLeft(t.getJid())})),t}))}return Promise.reject(new Error("The conference is has been already left"))},ce.prototype._getActiveMediaSession=function(){return this.isP2PActive()?this.p2pJingleSession:this.jvbJingleSession},ce.prototype._getMediaSessions=function(){var e=[];return this.jvbJingleSession&&e.push(this.jvbJingleSession),this.p2pJingleSession&&e.push(this.p2pJingleSession),e},ce.prototype.getName=function(){return this.options.name},ce.prototype.getConnection=function(){return this.connection},ce.prototype.isAuthEnabled=function(){return this.authEnabled},ce.prototype.isLoggedIn=function(){return Boolean(this.authIdentity)},ce.prototype.getAuthLogin=function(){return this.authIdentity},ce.prototype.isExternalAuthEnabled=function(){return this.room&&this.room.moderator.isExternalAuthEnabled()},ce.prototype.getExternalAuthUrl=function(e){var t=this;return new Promise((function(n,i){t.isExternalAuthEnabled()?e?t.room.moderator.getPopupLoginUrl(n,i):t.room.moderator.getLoginUrl(n,i):i()}))},ce.prototype.getLocalTracks=function(e){var t=[];return this.rtc&&(t=this.rtc.getLocalTracks(e)),t},ce.prototype.getLocalAudioTrack=function(){return this.rtc?this.rtc.getLocalAudioTrack():null},ce.prototype.getLocalVideoTrack=function(){return this.rtc?this.rtc.getLocalVideoTrack():null},ce.prototype.getPerformanceStats=function(){return{longTasksStats:this.statistics.getLongTasksStats()}},ce.prototype.on=function(e,t){this.eventEmitter&&this.eventEmitter.on(e,t)},ce.prototype.off=function(e,t){this.eventEmitter&&this.eventEmitter.removeListener(e,t)},ce.prototype.addEventListener=ce.prototype.on,ce.prototype.removeEventListener=ce.prototype.off,ce.prototype.addCommandListener=function(e,t){this.room&&this.room.addPresenceListener(e,t)},ce.prototype.removeCommandListener=function(e,t){this.room&&this.room.removePresenceListener(e,t)},ce.prototype.sendTextMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"body";this.room&&this.room.sendMessage(e,t)},ce.prototype.sendPrivateTextMessage=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"body";this.room&&this.room.sendPrivateMessage(e,t,n)},ce.prototype.sendCommand=function(e,t){this.room?this.room.addOrReplaceInPresence(e,t)&&this.room.sendPresence():se.warn("Not sending a command, room not initialized.")},ce.prototype.sendCommandOnce=function(e,t){this.sendCommand(e,t),this.removeCommand(e)},ce.prototype.removeCommand=function(e){this.room&&this.room.removeFromPresence(e)},ce.prototype.setDisplayName=function(e){this.room&&this.room.addOrReplaceInPresence("nick",{attributes:{xmlns:"http://jabber.org/protocol/nick"},value:e})&&this.room.sendPresence()},ce.prototype.setSubject=function(e){this.room&&this.isModerator()?this.room.setSubject(e):se.warn("Failed to set subject, ".concat(this.room?"":"not in a room, ").concat(this.isModerator()?"":"participant is not a moderator"))},ce.prototype.getTranscriber=function(){if(void 0===this.transcriber){this.transcriber=new z.a;var e,t=this.getLocalTracks(ne.a),n=Object(r.a)(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;this.transcriber.addTrack(i)}}catch(u){n.e(u)}finally{n.f()}var a,o=this.rtc.getRemoteTracks(ne.a),s=Object(r.a)(o);try{for(s.s();!(a=s.n()).done;){var c=a.value;this.transcriber.addTrack(c)}}catch(u){s.e(u)}finally{s.f()}}return this.transcriber},ce.prototype.getTranscriptionStatus=function(){return this.room.transcriptionStatus},ce.prototype.addTrack=function(e){var t=e.getType(),n=this.rtc.getLocalTracks(t);return n.length>0?e===n[0]?Promise.resolve(e):Promise.reject(new Error("Cannot add second ".concat(t," track to the conference"))):this.replaceTrack(null,e)},ce.prototype._fireAudioLevelChangeEvent=function(e,t){var n=this.getActivePeerConnection();t&&n!==t||this.eventEmitter.emit(f.TRACK_AUDIO_LEVEL_CHANGED,this.myUserId(),e)},ce.prototype._fireMuteChangeEvent=function(e){var t;if(this.isMutedByFocus&&e.isAudioTrack()&&!e.isMuted()?(this.isMutedByFocus=!1,this.room.muteParticipant(this.room.myroomjid,!1,ne.a)):this.isVideoMutedByFocus&&e.isVideoTrack()&&!e.isMuted()&&(this.isVideoMutedByFocus=!1,this.room.muteParticipant(this.room.myroomjid,!1,ne.c)),this.mutedByFocusActor&&e.isAudioTrack()){var n=d.Strophe.getResourceFromJid(this.mutedByFocusActor);t=this.participants[n]}else if(this.mutedVideoByFocusActor&&e.isVideoTrack()){var i=d.Strophe.getResourceFromJid(this.mutedVideoByFocusActor);t=this.participants[i]}this.eventEmitter.emit(f.TRACK_MUTE_CHANGED,e,t)},ce.prototype._getInitialLocalTracks=function(){var e=this;return this.getLocalTracks().filter((function(t){return t.getType()===ne.a&&!e.isStartAudioMuted()||t.getType()===ne.c&&!e.isStartVideoMuted()}))},ce.prototype.onLocalTrackRemoved=function(e){e._setConference(null),this.rtc.removeLocalTrack(e),e.removeEventListener(b.TRACK_MUTE_CHANGED,e.muteHandler),e.removeEventListener(b.TRACK_AUDIO_LEVEL_CHANGED,e.audioLevelHandler),e.isVideoTrack()&&e.videoType===re.a.DESKTOP&&this.statistics.sendScreenSharingEvent(!1),this.eventEmitter.emit(f.TRACK_REMOVED,e)},ce.prototype.removeTrack=function(e){return this.replaceTrack(e,null)},ce.prototype.replaceTrack=function(e,t){var n=this;return e&&e.disposed||t&&t.disposed?Promise.reject(new v.a(g.TRACK_IS_DISPOSED)):this._doReplaceTrack(e,t).then((function(){return e&&n.onLocalTrackRemoved(e),t?(n._setupNewTrack(t),t.isVideoTrack()&&n.rtc.setVideoType(t.videoType)):e&&e.isVideoTrack()&&n.rtc.setVideoType(re.a.NONE),(n.isMutedByFocus||n.isVideoMutedByFocus)&&n._fireMuteChangeEvent(t),Promise.resolve()})).catch((function(e){return Promise.reject(new Error(e))}))},ce.prototype._doReplaceTrack=function(e,t){var n=[];return this.jvbJingleSession?n.push(this.jvbJingleSession.replaceTrack(e,t)):se.info("_doReplaceTrack - no JVB JingleSession"),this.p2pJingleSession?n.push(this.p2pJingleSession.replaceTrack(e,t)):se.info("_doReplaceTrack - no P2P JingleSession"),Promise.all(n)},ce.prototype._setupNewTrack=function(e){if(e.isAudioTrack()||e.isVideoTrack()&&e.videoType!==re.a.DESKTOP){var t=S.a.getCurrentlyAvailableMediaDevices().find((function(t){return t.kind==="".concat(e.getTrack().kind,"input")&&t.label===e.getTrack().label}));t&&J.a.sendActiveDeviceListEvent(S.a.getEventDataForActiveDevice(t))}if(e.isVideoTrack()){var n="videoType";(e.videoType!==re.a.CAMERA||this.room.getFromPresence(n))&&this.sendCommand(n,{value:e.videoType})}this.rtc.addLocalTrack(e),e.isAudioTrack()?this.room.setAudioMute(e.isMuted()):this.room.setVideoMute(e.isMuted()),e.muteHandler=this._fireMuteChangeEvent.bind(this,e),e.audioLevelHandler=this._fireAudioLevelChangeEvent.bind(this),e.addEventListener(b.TRACK_MUTE_CHANGED,e.muteHandler),e.addEventListener(b.TRACK_AUDIO_LEVEL_CHANGED,e.audioLevelHandler),e._setConference(this),this.eventEmitter.emit(f.TRACK_ADDED,e)},ce.prototype._addLocalTrackAsUnmute=function(e){var t=this,n=[];return this.jvbJingleSession?n.push(this.jvbJingleSession.addTrackAsUnmute(e)):se.debug("Add local MediaStream as unmute - no JVB Jingle session started yet"),this.p2pJingleSession?n.push(this.p2pJingleSession.addTrackAsUnmute(e)):se.debug("Add local MediaStream as unmute - no P2P Jingle session started yet"),Promise.allSettled(n).then((function(){e.isVideoTrack()&&t.rtc.setVideoType(e.videoType)}))},ce.prototype._removeLocalTrackAsMute=function(e){var t=this,n=[];return this.jvbJingleSession?n.push(this.jvbJingleSession.removeTrackAsMute(e)):se.debug("Remove local MediaStream - no JVB JingleSession started yet"),this.p2pJingleSession?n.push(this.p2pJingleSession.removeTrackAsMute(e)):se.debug("Remove local MediaStream - no P2P JingleSession started yet"),Promise.allSettled(n).then((function(){e.isVideoTrack()&&t.rtc.setVideoType(re.a.NONE)}))},ce.prototype.getRole=function(){return this.room.role},ce.prototype.isHidden=function(){return this.connection?d.Strophe.getDomainFromJid(this.connection.getJid())===this.options.config.hiddenDomain:null},ce.prototype.isModerator=function(){return this.room?this.room.isModerator():null},ce.prototype.lock=function(e){var t=this;return this.isModerator()?new Promise((function(n,i){t.room.lockRoom(e||"",(function(){return n()}),(function(e){return i(e)}),(function(){return i(h.PASSWORD_NOT_SUPPORTED)}))})):Promise.reject(new Error("You are not moderator."))},ce.prototype.unlock=function(){return this.lock()},ce.prototype.selectParticipant=function(e){this.selectParticipants([e])},ce.prototype.selectParticipants=function(e){if(!Array.isArray(e))throw new Error("Invalid argument; participantIds must be an array.");this.receiveVideoController.selectEndpoints(e)},ce.prototype.getLastN=function(){return this.receiveVideoController.getLastN()},ce.prototype.setLastN=function(e){if(!Number.isInteger(e)&&!Number.parseInt(e,10))throw new Error("Invalid value for lastN: ".concat(e));var t=Number(e);if(t<-1)throw new RangeError("lastN cannot be smaller than -1");if(this.receiveVideoController.setLastN(t),this.p2pJingleSession){var n=0!==t;this.p2pJingleSession.setMediaTransferActive(!0,n).catch((function(e){se.error("Failed to adjust video transfer status (".concat(n,")"),e)}))}},ce.prototype.setPerceptibles=function(e){this.rtc.setPerceptibles(e)},ce.prototype.isInLastN=function(e){return this.rtc.isInLastN(e)},ce.prototype.getParticipants=function(){return Object.values(this.participants)},ce.prototype.getParticipantCount=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getParticipants();return e||(t=t.filter((function(e){return!e.isHidden()}))),t.length+1},ce.prototype.getParticipantById=function(e){return this.participants[e]},ce.prototype.grantOwner=function(e){var t=this.getParticipantById(e);t&&this.room.setAffiliation(t.getJid(),"owner")},ce.prototype.revokeOwner=function(e){var t=this.getParticipantById(e),n=this.myUserId()===e,i=this.isMembersOnly()?"member":"none";n?this.room.setAffiliation(this.room.myroomjid,i):t&&this.room.setAffiliation(t.getJid(),i)},ce.prototype.kickParticipant=function(e,t){var n=this.getParticipantById(e);n&&this.room.kick(n.getJid(),t)},ce.prototype._maybeClearSITimeout=function(){this._sessionInitiateTimeout&&(this.jvbJingleSession||this.getParticipantCount()<2)&&(window.clearTimeout(this._sessionInitiateTimeout),this._sessionInitiateTimeout=null)},ce.prototype._maybeSetSITimeout=function(){var e=this;!this.jvbJingleSession&&this.getParticipantCount()>=2&&!this._sessionInitiateTimeout&&(this._sessionInitiateTimeout=window.setTimeout((function(){e._sessionInitiateTimeout=null,J.a.sendAnalytics(Object(ae.G)(ae.d,{p2p:!1,value:5e3}))}),5e3))},ce.prototype.muteParticipant=function(e,t){var n=t||ne.a;if(n===ne.a||n===ne.c){var i=this.getParticipantById(e);i&&this.room.muteParticipant(i.getJid(),!0,n)}else se.error("Unsupported media type: ".concat(n))},ce.prototype.onMemberJoined=function(e,t,n,i,r,a,o,s,c,u){var l=d.Strophe.getResourceFromJid(e);if("focus"!==l&&this.myUserId()!==l){var h=new m.a(e,this,t,i,r,a,o);h.setRole(n),h.setBotType(s),h.setFeatures(u),this.participants[l]=h,this.eventEmitter.emit(f.USER_JOINED,l,h),this._updateFeatures(h),this.isJoined()&&this._maybeStartOrStopP2P(),this._maybeSetSITimeout()}},ce.prototype._onMucJoined=function(){this._maybeStartOrStopP2P()},ce.prototype._updateFeatures=function(e){var t=this;e.getFeatures().then((function(n){e._supportsDTMF=n.has("urn:xmpp:jingle:dtmf:0"),t.updateDTMFSupport(),n.has(Z.c)&&e.setProperty("features_jigasi",!0),n.has(Z.b)&&e.setProperty("features_e2ee",!0)})).catch((function(){return!1}))},ce.prototype._onMemberBotTypeChanged=function(e,t){var n=this.getParticipants().find((function(t){return t.getJid()===e}));if(n){n.setBotType(t);var i=d.Strophe.getResourceFromJid(e);this.eventEmitter.emit(f.BOT_TYPE_CHANGED,i,t)}n.getBotType()||this._maybeStartOrStopP2P()},ce.prototype.onMemberLeft=function(e){var t=this,n=d.Strophe.getResourceFromJid(e);if("focus"!==n&&this.myUserId()!==n){var i=this.participants[n];delete this.participants[n];var a,o=this._getMediaSessions(),s=[],c=Object(r.a)(o);try{for(c.s();!(a=c.n()).done;){var u=a.value;s.push(u.removeRemoteStreamsOnLeave(n))}}catch(l){c.e(l)}finally{c.f()}Promise.allSettled(s).then((function(e){var r=[];e.map((function(e){return e.value})).forEach((function(e){e&&(r=r.concat(e))})),r.forEach((function(e){t.eventEmitter.emit(f.TRACK_REMOVED,e)})),i&&t.eventEmitter.emit(f.USER_LEFT,n,i),t._maybeStartOrStopP2P(!0),t._maybeClearSITimeout()}))}},ce.prototype.onMemberKicked=function(e,t,n,i){if(t!==this.myUserId()){var r=this.participants[t];if(e)return this.eventEmitter.emit(f.KICKED,r,i),void this.leave();var a=this.participants[n];this.eventEmitter.emit(f.PARTICIPANT_KICKED,r,a,i)}},ce.prototype.onLocalRoleChanged=function(e){this.eventEmitter.emit(f.USER_ROLE_CHANGED,this.myUserId(),e)},ce.prototype.onUserRoleChanged=function(e,t){var n=d.Strophe.getResourceFromJid(e),i=this.getParticipantById(n);i&&(i.setRole(t),this.eventEmitter.emit(f.USER_ROLE_CHANGED,n,t))},ce.prototype.onDisplayNameChanged=function(e,t){var n=d.Strophe.getResourceFromJid(e),i=this.getParticipantById(n);i&&i._displayName!==t&&(i._displayName=t,this.eventEmitter.emit(f.DISPLAY_NAME_CHANGED,n,t))},ce.prototype.onRemoteTrackAdded=function(e){var t=this;if(!e.isP2P||this.isP2PActive())if(e.isP2P||!this.isP2PActive()){var n=e.getParticipantId(),i=this.getParticipantById(n);if(i){i._tracks.push(e),this.transcriber&&this.transcriber.addTrack(e);var r=this.eventEmitter;e.addEventListener(b.TRACK_MUTE_CHANGED,(function(){return r.emit(f.TRACK_MUTE_CHANGED,e)})),e.addEventListener(b.TRACK_AUDIO_LEVEL_CHANGED,(function(e,i){t.getActivePeerConnection()===i&&r.emit(f.TRACK_AUDIO_LEVEL_CHANGED,n,e)})),r.emit(f.TRACK_ADDED,e)}else se.error("No participant found for id: ".concat(n))}else se.info("Trying to add remote JVB track, when in P2P - IGNORED");else se.info("Trying to add remote P2P track, when not in P2P - IGNORED")},ce.prototype.onCallAccepted=function(e,t){this.p2pJingleSession===e&&(se.info("P2P setAnswer"),this.p2pJingleSession.setAnswer(t),this.eventEmitter.emit(f._MEDIA_SESSION_STARTED,this.p2pJingleSession))},ce.prototype.onTransportInfo=function(e,t){this.p2pJingleSession===e&&(se.info("P2P addIceCandidates"),this.p2pJingleSession.addIceCandidates(t))},ce.prototype.onRemoteTrackRemoved=function(e){var t=this;this.getParticipants().forEach((function(n){for(var i=n.getTracks(),r=0;r<i.length;r++)if(i[r]===e){n._tracks.splice(r,1),t.eventEmitter.emit(f.TRACK_REMOVED,e),t.transcriber&&t.transcriber.removeTrack(e);break}}),this)},ce.prototype._onIncomingCallP2P=function(e,t){var n;!this.isP2PEnabled()&&!this.isP2PTestModeEnabled()||O.a.isFirefox()||O.a.isWebKitBased()?n={reason:"decline",reasonDescription:"P2P disabled",errorMsg:"P2P mode disabled in the configuration"}:this.p2pJingleSession?n={reason:"busy",reasonDescription:"P2P already in progress",errorMsg:'Duplicated P2P "session-initiate"'}:this._shouldBeInP2PMode()||(n={reason:"decline",reasonDescription:"P2P requirements not met",errorMsg:'Received P2P "session-initiate" when should not be in P2P mode'},J.a.sendAnalytics(Object(ae.G)(ae.h))),n?this._rejectIncomingCall(e,n):this._acceptP2PIncomingCall(e,t)},ce.prototype.onIncomingCall=function(e,t,n){if(e.isP2P)this._onIncomingCallP2P(e,t);else{if(!this.room.isFocus(e.remoteJid)){var i="Rejecting session-initiate from non-focus.";return void this._rejectIncomingCall(e,{reason:"security-error",reasonDescription:i,errorMsg:i})}this._acceptJvbIncomingCall(e,t,n)}},ce.prototype._acceptJvbIncomingCall=function(e,t,n){var i=this;this.jvbJingleSession=e,this.room.connectionTimes["session.initiate"]=n,this._sendConferenceJoinAnalyticsEvent(),this.wasStopped&&J.a.sendAnalyticsAndLog(Object(ae.G)(ae.a,{p2p:!1}));var r=$(t).find('>bridge-session[xmlns="http://jitsi.org/protocol/focus"]').attr("region");this.eventEmitter.emit(f.SERVER_REGION_CHANGED,r),this._maybeClearSITimeout(),J.a.sendAnalytics(Object(ae.G)(ae.c,{p2p:!1,value:n}));try{e.initialize(this.room,this.rtc,Object(a.a)(Object(a.a)({},this.options.config),{},{enableInsertableStreams:this.isE2EEEnabled()}))}catch(s){return K.a.callErrorHandler(s),void se.error(s)}this._setBridgeChannel(t,e.peerconnection);var o=this._getInitialLocalTracks();try{e.acceptOffer(t,(function(){i.isP2PActive()&&i.jvbJingleSession&&i._suspendMediaTransferForJvbConnection(),i.eventEmitter.emit(f._MEDIA_SESSION_STARTED,e),i.isP2PActive()||i.eventEmitter.emit(f._MEDIA_SESSION_ACTIVE_CHANGED,e)}),(function(e){K.a.callErrorHandler(e),se.error("Failed to accept incoming Jingle session",e)}),o),se.info("Starting CallStats for JVB connection..."),this.statistics.startCallStats(this.jvbJingleSession.peerconnection,"jitsi"),this.statistics.startRemoteStats(this.jvbJingleSession.peerconnection)}catch(c){K.a.callErrorHandler(c),se.error(c)}},ce.prototype._setBridgeChannel=function(e,t){var n=null,i=$(e).find(">content>transport>web-socket").first();1===i.length&&(n=i[0].getAttribute("url")),n?this.rtc.initializeBridgeChannel(null,n):this.rtc.initializeBridgeChannel(t,null)},ce.prototype._rejectIncomingCall=function(e,t){t&&t.errorMsg&&K.a.callErrorHandler(new Error(t.errorMsg)),e.terminate(null,(function(e){se.warn("An error occurred while trying to terminate invalid Jingle session",e)}),{reason:t&&t.reason,reasonDescription:t&&t.reasonDescription,sendSessionTerminate:!0})},ce.prototype.onCallEnded=function(e,t,n){se.info("Call ended: ".concat(t," - ").concat(n," P2P ?").concat(e.isP2P)),e===this.jvbJingleSession?(this.wasStopped=!0,J.a.sendAnalytics(Object(ae.G)(ae.e,{p2p:!1})),this.statistics&&(this.statistics.stopRemoteStats(this.jvbJingleSession.peerconnection),se.info("Stopping JVB CallStats"),this.statistics.stopCallStats(this.jvbJingleSession.peerconnection)),this.jvbJingleSession=null,this.rtc.onCallEnded()):e===this.p2pJingleSession?("decline"===t&&"force JVB121"===n?(se.info("In forced JVB 121 mode..."),J.a.analytics.addPermanentProperties({forceJvb121:!0})):"connectivity-error"===t&&"ICE FAILED"===n&&J.a.analytics.addPermanentProperties({p2pFailed:!0}),this._stopP2PSession()):se.error("Received onCallEnded for invalid session",e.sid,e.remoteJid,t,n)},ce.prototype.onSuspendDetected=function(e){e.isP2P||(this.leave(),this.eventEmitter.emit(f.SUSPEND_DETECTED))},ce.prototype.updateDTMFSupport=function(){for(var e=!1,t=this.getParticipants(),n=0;n<t.length;n+=1)if(t[n].supportsDTMF()){e=!0;break}e!==this.somebodySupportsDTMF&&(this.somebodySupportsDTMF=e,this.eventEmitter.emit(f.DTMF_SUPPORT_CHANGED,e))},ce.prototype.isDTMFSupported=function(){return this.somebodySupportsDTMF},ce.prototype.myUserId=function(){return this.room&&this.room.myroomjid?d.Strophe.getResourceFromJid(this.room.myroomjid):null},ce.prototype.sendTones=function(e,t,n){var i=this.getActivePeerConnection();i?i.sendTones(e,t,n):se.warn("cannot sendTones: no peer connection")},ce.prototype.startRecording=function(e){return this.room?this.recordingManager.startRecording(e):Promise.reject(new Error("The conference is not created yet!"))},ce.prototype.stopRecording=function(e){return this.room?this.recordingManager.stopRecording(e):Promise.reject(new Error("The conference is not created yet!"))},ce.prototype.isSIPCallingSupported=function(){return!!this.room&&this.room.isSIPCallingSupported()},ce.prototype.dial=function(e){return this.room?this.room.dial(e):new Promise((function(e,t){t(new Error("The conference is not created yet!"))}))},ce.prototype.hangup=function(){return this.room?this.room.hangup():new Promise((function(e,t){t(new Error("The conference is not created yet!"))}))},ce.prototype.startTranscriber=function(){return this.dial("jitsi_meet_transcribe")},ce.prototype.stopTranscriber=ce.prototype.hangup,ce.prototype.getPhoneNumber=function(){return this.room?this.room.getPhoneNumber():null},ce.prototype.getPhonePin=function(){return this.room?this.room.getPhonePin():null},ce.prototype.getMeetingUniqueId=function(){if(this.room)return this.room.getMeetingId()},ce.prototype.getActivePeerConnection=function(){var e=this.isP2PActive()?this.p2pJingleSession:this.jvbJingleSession;return e?e.peerconnection:null},ce.prototype.getConnectionState=function(){var e=this.getActivePeerConnection();return e?e.getConnectionState():null},ce.prototype.setStartMutedPolicy=function(e){this.isModerator()?(this.startMutedPolicy=e,this.room.addOrReplaceInPresence("startmuted",{attributes:{audio:e.audio,video:e.video,xmlns:"http://jitsi.org/jitmeet/start-muted"}})&&this.room.sendPresence()):se.warn("Failed to set start muted policy, ".concat(this.room?"":"not in a room, ").concat(this.isModerator()?"":"participant is not a moderator"))},ce.prototype.getStartMutedPolicy=function(){return this.startMutedPolicy},ce.prototype.isStartAudioMuted=function(){return this.startAudioMuted},ce.prototype.isStartVideoMuted=function(){return this.startVideoMuted},ce.prototype.getConnectionTimes=function(){return this.room.connectionTimes},ce.prototype.setLocalParticipantProperty=function(e,t){this.sendCommand("jitsi_participant_".concat(e),{value:t})},ce.prototype.removeLocalParticipantProperty=function(e){this.removeCommand("jitsi_participant_".concat(e)),this.room.sendPresence()},ce.prototype.getLocalParticipantProperty=function(e){var t=this.room.presMap.nodes.find((function(t){return t.tagName==="jitsi_participant_".concat(e)}));return t?t.value:void 0},ce.prototype.sendFeedback=function(e,t){return this.statistics.sendFeedback(e,t)},ce.prototype.isCallstatsEnabled=function(){return this.statistics.isCallstatsEnabled()},ce.prototype.getSsrcByTrack=function(e){var t;return e.isLocal()?null===(t=this.getActivePeerConnection())||void 0===t?void 0:t.getLocalSSRC(e):e.getSSRC()},ce.prototype._onTrackAttach=function(e,t){var n=e.isLocal(),i=null,r=e.isP2P,a=r?e.getParticipantId():"jitsi",o=r?this.p2pJingleSession&&this.p2pJingleSession.peerconnection:this.jvbJingleSession&&this.jvbJingleSession.peerconnection;n?o&&(i=o.getLocalSSRC(e)):i=e.getSSRC(),t.id&&i&&o&&this.statistics.associateStreamWithVideoTag(o,i,n,a,e.getUsageLabel(),t.id)},ce.prototype.sendApplicationLog=function(e){J.a.sendLog(e)},ce.prototype._isFocus=function(e){return this.room?this.room.isFocus(e):null},ce.prototype._fireIncompatibleVersionsEvent=function(){this.eventEmitter.emit(f.CONFERENCE_FAILED,h.INCOMPATIBLE_SERVER_VERSIONS)},ce.prototype.sendEndpointMessage=function(e,t){this.rtc.sendChannelMessage(e,t)},ce.prototype.sendEndpointStatsMessage=function(e){this.rtc.sendEndpointStatsMessage(e)},ce.prototype.broadcastEndpointMessage=function(e){this.sendEndpointMessage("",e)},ce.prototype.sendMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=typeof e;if("object"===i||!n&&"string"===i)if(n)this.sendEndpointMessage(t,e);else{var r=e,a="body";if("object"===i){a="json-message",r.hasOwnProperty(Z.d)||(r[Z.d]="");try{r=JSON.stringify(r)}catch(o){return void se.error("Can not send a message, stringify failed: ",o)}}t?this.sendPrivateTextMessage(t,r,a):this.sendTextMessage(r,a)}else se.error("Can not send a message of type ".concat(i))},ce.prototype.isConnectionInterrupted=function(){return this.isP2PActive()?this.isP2PConnectionInterrupted:this.isJvbConnectionInterrupted},ce.prototype._onConferenceRestarted=function(e){!e.isP2P&&this.options.config.enableForcedReload&&(this.restartInProgress=!0,this.eventEmitter.emit(f.CONFERENCE_FAILED,h.CONFERENCE_RESTARTED))},ce.prototype._onIceConnectionInterrupted=function(e){e.isP2P?this.isP2PConnectionInterrupted=!0:this.isJvbConnectionInterrupted=!0,e.isP2P===this.isP2PActive()&&this.eventEmitter.emit(f.CONNECTION_INTERRUPTED)},ce.prototype._onIceConnectionFailed=function(e){e.isP2P?(J.a.analytics.addPermanentProperties({p2pFailed:!0}),this.p2pJingleSession&&J.a.sendAnalyticsAndLog(Object(ae.I)(ae.j,{initiator:this.p2pJingleSession.isInitiator})),this._stopP2PSession("connectivity-error","ICE FAILED")):e&&this.jvbJingleSession===e&&(this._delayedIceFailed=new C.a(this),this._delayedIceFailed.start(e))},ce.prototype._onIceConnectionRestored=function(e){e.isP2P?this.isP2PConnectionInterrupted=!1:(this.isJvbConnectionInterrupted=!1,this._delayedIceFailed&&this._delayedIceFailed.cancel()),e.isP2P===this.isP2PActive()&&this.eventEmitter.emit(f.CONNECTION_RESTORED)},ce.prototype._acceptP2PIncomingCall=function(e,t){var n=this;this.isP2PConnectionInterrupted=!1,this.p2pJingleSession=e,this._sendConferenceJoinAnalyticsEvent(),this.p2pJingleSession.initialize(this.room,this.rtc,Object(a.a)(Object(a.a)({},this.options.config),{},{enableInsertableStreams:this.isE2EEEnabled()})),se.info("Starting CallStats for P2P connection...");var i=d.Strophe.getResourceFromJid(this.p2pJingleSession.remoteJid),r=this.participants[i];r&&(i=r.getStatsID()||i),this.statistics.startCallStats(this.p2pJingleSession.peerconnection,i);var o=this.getLocalTracks();this.p2pJingleSession.acceptOffer(t,(function(){se.debug('Got RESULT for P2P "session-accept"'),n.eventEmitter.emit(f._MEDIA_SESSION_STARTED,n.p2pJingleSession)}),(function(e){se.error("Failed to accept incoming P2P Jingle session",e)}),o)},ce.prototype._addRemoteJVBTracks=function(){this._addRemoteTracks("JVB",this.jvbJingleSession.peerconnection.getRemoteTracks())},ce.prototype._addRemoteP2PTracks=function(){this._addRemoteTracks("P2P",this.p2pJingleSession.peerconnection.getRemoteTracks())},ce.prototype._addRemoteTracks=function(e,t){var n,i=Object(r.a)(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;se.info("Adding remote ".concat(e," track: ").concat(a)),this.onRemoteTrackAdded(a)}}catch(o){i.e(o)}finally{i.f()}},ce.prototype._onIceConnectionEstablished=function(e){null!==this.p2pJingleSession&&(this.p2pEstablishmentDuration=this.p2pJingleSession.establishmentDuration),null!==this.jvbJingleSession&&(this.jvbEstablishmentDuration=this.jvbJingleSession.establishmentDuration);var t=!1,n=this.options.config.forceJVB121Ratio;if(e.isP2P?this.p2pJingleSession!==e?(se.error("CONNECTION_ESTABLISHED - wrong P2P session instance ?!"),t=!0):!e.isInitiator&&"number"===typeof n&&Math.random()<n&&(se.info("Forcing JVB 121 mode (ratio=".concat(n,")...")),J.a.analytics.addPermanentProperties({forceJvb121:!0}),this._stopP2PSession("decline","force JVB121"),t=!0):t=!0,!isNaN(this.p2pEstablishmentDuration)&&!isNaN(this.jvbEstablishmentDuration)){var i=this.p2pEstablishmentDuration-this.jvbEstablishmentDuration;J.a.sendAnalytics(ae.p,{value:i})}e.isP2P===this.isP2PActive()&&this.eventEmitter.emit(f.CONNECTION_ESTABLISHED),t||(this._setP2PStatus(!0),this.jvbJingleSession?this._removeRemoteJVBTracks():se.info("Not removing remote JVB tracks - no session yet"),this._addRemoteP2PTracks(),this.jvbJingleSession&&this._suspendMediaTransferForJvbConnection(),se.info("Starting remote stats with p2p connection"),this.statistics.startRemoteStats(this.p2pJingleSession.peerconnection),J.a.sendAnalyticsAndLog(Object(ae.I)(ae.i,{initiator:this.p2pJingleSession.isInitiator})))},ce.prototype._updateProperties=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!l()(e,this.properties);if(this.properties=e,t){this.eventEmitter.emit(f.PROPERTIES_CHANGED,this.properties);var n=["bridge-count","created-ms"];n.forEach((function(t){void 0!==e[t]&&J.a.analytics.addPermanentProperties(Object(i.a)({},t.replace("-","_"),e[t]))}))}},ce.prototype.getProperty=function(e){return this.properties[e]},ce.prototype._maybeClearDeferredStartP2P=function(){this.deferredStartP2PTask&&(se.info("Cleared deferred start P2P task"),clearTimeout(this.deferredStartP2PTask),this.deferredStartP2PTask=null)},ce.prototype._removeRemoteJVBTracks=function(){this._removeRemoteTracks("JVB",this.jvbJingleSession.peerconnection.getRemoteTracks())},ce.prototype._removeRemoteP2PTracks=function(){this._removeRemoteTracks("P2P",this.p2pJingleSession.peerconnection.getRemoteTracks())},ce.prototype._removeRemoteTracks=function(e,t){var n,i=Object(r.a)(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;se.info("Removing remote ".concat(e," track: ").concat(a)),this.onRemoteTrackRemoved(a)}}catch(o){i.e(o)}finally{i.f()}},ce.prototype._resumeMediaTransferForJvbConnection=function(){se.info("Resuming media transfer over the JVB connection..."),this.jvbJingleSession.setMediaTransferActive(!0,!0).then((function(){se.info("Resumed media transfer over the JVB connection!")}),(function(e){se.error("Failed to resume media transfer over the JVB connection:",e)}))},ce.prototype._setP2PStatus=function(e){if(this.p2p!==e){if(this.p2p=e,e){se.info("Peer to peer connection established!"),J.a.analytics.addPermanentProperties({p2pFailed:!1,forceJvb121:!1});var t=0!==this.getLastN();this.p2pJingleSession.setMediaTransferActive(!0,t).catch((function(e){se.error("Failed to sync up P2P video transfer status"+"(".concat(t,")"),e)}))}else se.info("Peer to peer connection closed!");this.jvbJingleSession&&this.statistics.sendConnectionResumeOrHoldEvent(this.jvbJingleSession.peerconnection,!e),this.dtmfManager=null,this.eventEmitter.emit(f.P2P_STATUS,this,this.p2p),this.eventEmitter.emit(f._MEDIA_SESSION_ACTIVE_CHANGED,this._getActiveMediaSession()),this.eventEmitter.emit(this.isConnectionInterrupted()?f.CONNECTION_INTERRUPTED:f.CONNECTION_RESTORED)}else se.debug("Called _setP2PStatus with the same status: ".concat(e))},ce.prototype._startP2PSession=function(e){if(this._maybeClearDeferredStartP2P(),this.p2pJingleSession)se.error("P2P session already started!");else{this.isP2PConnectionInterrupted=!1,this.p2pJingleSession=this.xmpp.connection.jingle.newP2PJingleSession(this.room.myroomjid,e),se.info("Created new P2P JingleSession",this.room.myroomjid,e),this._sendConferenceJoinAnalyticsEvent(),this.p2pJingleSession.initialize(this.room,this.rtc,Object(a.a)(Object(a.a)({},this.options.config),{},{enableInsertableStreams:this.isE2EEEnabled()})),se.info("Starting CallStats for P2P connection...");var t=d.Strophe.getResourceFromJid(this.p2pJingleSession.remoteJid),n=this.participants[t];n&&(t=n.getStatsID()||t),this.statistics.startCallStats(this.p2pJingleSession.peerconnection,t);var i=this.getLocalTracks();this.p2pJingleSession.invite(i)}},ce.prototype._suspendMediaTransferForJvbConnection=function(){se.info("Suspending media transfer over the JVB connection..."),this.jvbJingleSession.setMediaTransferActive(!1,!1).then((function(){se.info("Suspended media transfer over the JVB connection !")}),(function(e){se.error("Failed to suspend media transfer over the JVB connection:",e)}))},ce.prototype._maybeStartOrStopP2P=function(e){if(!this.isP2PEnabled()||this.isP2PTestModeEnabled()||O.a.isFirefox()||O.a.isWebKitBased())se.info("Auto P2P disabled");else{var t=this.getParticipants(),n=t.length,i=this._shouldBeInP2PMode();if(!i&&this.deferredStartP2PTask&&this._maybeClearDeferredStartP2P(),!this.p2pJingleSession&&i){var r=n&&t[0],a=this.myUserId(),o=r.getId();if(a>o)return void se.debug("I'm the bigger peersId - the other peer should start P2P",a,o);if(a===o)return void se.error("The same IDs ? ",a,o);var s=r.getJid();if(e){if(this.deferredStartP2PTask)return void se.error("Deferred start P2P task's been set already!");se.info("Will start P2P with: ".concat(s," after ").concat(this.backToP2PDelay," seconds...")),this.deferredStartP2PTask=setTimeout(this._startP2PSession.bind(this,s),1e3*this.backToP2PDelay)}else se.info("Will start P2P with: ".concat(s)),this._startP2PSession(s)}else this.p2pJingleSession&&!i&&(se.info("Will stop P2P with: ".concat(this.p2pJingleSession.remoteJid)),this.p2pJingleSession.isInitiator&&n>1&&J.a.sendAnalyticsAndLog(Object(ae.I)(ae.k)),this._stopP2PSession())}},ce.prototype._shouldBeInP2PMode=function(){var e=this.getParticipants(),t=e.length,n=void 0!==e.find((function(e){return"poltergeist"===e.getBotType()||e.hasFeature(Z.c)})),i=1===t&&!n;return se.debug("P2P? peerCount: ".concat(t,", hasBotPeer: ").concat(n," => ").concat(i)),i},ce.prototype._stopP2PSession=function(e,t){if(this.p2pJingleSession){var n=this.isP2PActive();n&&(this.jvbJingleSession&&this._resumeMediaTransferForJvbConnection(),this._removeRemoteP2PTracks()),se.info("Stopping remote stats for P2P connection"),this.statistics.stopRemoteStats(this.p2pJingleSession.peerconnection),se.info("Stopping CallStats for P2P connection"),this.statistics.stopCallStats(this.p2pJingleSession.peerconnection),this.p2pJingleSession.terminate((function(){se.info("P2P session terminate RESULT")}),(function(t){e&&se.error("An error occurred while trying to terminate P2P Jingle session",t)}),{reason:e||"success",reasonDescription:t||"Turing off P2P session",sendSessionTerminate:this.room&&this.getParticipantById(d.Strophe.getResourceFromJid(this.p2pJingleSession.remoteJid))}),this.p2pJingleSession=null,this._setP2PStatus(!1),n&&(this.jvbJingleSession?this._addRemoteJVBTracks():se.info("Not adding remote JVB tracks - no session yet"))}else se.error("No P2P session to be stopped!")},ce.prototype.isP2PActive=function(){return this.p2p},ce.prototype.getP2PConnectionState=function(){return this.isP2PActive()?this.p2pJingleSession.peerconnection.getConnectionState():null},ce.prototype.startP2PSession=function(){var e=this.getParticipants();if(1!==e.length)throw new Error("There must be exactly 1 participant to start the P2P session !");var t=e[0].getJid();this._startP2PSession(t)},ce.prototype.stopP2PSession=function(){this._stopP2PSession()},ce.prototype.getSpeakerStats=function(){return this.speakerStatsCollector.getStats()},ce.prototype.setReceiverConstraints=function(e){this.receiveVideoController.setReceiverConstraints(e)},ce.prototype.setReceiverVideoConstraint=function(e){this.receiveVideoController.setPreferredReceiveMaxFrameHeight(e)},ce.prototype.setSenderVideoConstraint=function(e){return this.sendVideoController.setPreferredSendMaxFrameHeight(e)},ce.prototype.createVideoSIPGWSession=function(e,t){return this.room?this.videoSIPGWHandler.createVideoSIPGWSession(e,t):new Error(X.ERROR_NO_CONNECTION)},ce.prototype._sendConferenceJoinAnalyticsEvent=function(){var e=this.getMeetingUniqueId();!this._conferenceJoinAnalyticsEventSent&&e&&null!==this.getActivePeerConnection()&&(J.a.sendAnalytics(Object(ae.A)("joined",{meetingId:e,participantId:"".concat(e,".").concat(this._statsCurrentId)})),this._conferenceJoinAnalyticsEventSent=Date.now())},ce.prototype._sendConferenceLeftAnalyticsEvent=function(){var e=this.getMeetingUniqueId();e&&this._conferenceJoinAnalyticsEventSent&&J.a.sendAnalytics(Object(ae.A)("left",{meetingId:e,participantId:"".concat(e,".").concat(this._statsCurrentId),stats:{duration:Math.floor((Date.now()-this._conferenceJoinAnalyticsEventSent)/1e3),perf:this.getPerformanceStats()}}))},ce.prototype._restartMediaSessions=function(){this.p2pJingleSession&&this.stopP2PSession(),this.jvbJingleSession&&this.jvbJingleSession.terminate(null,(function(e){se.warn("An error occurred while trying to terminate the JVB session",e)}),{reason:"success",reasonDescription:"restart required",requestRestart:!0,sendSessionTerminate:!0}),this._maybeStartOrStopP2P(!1)},ce.prototype.isE2EEEnabled=function(){return this._e2eEncryption&&this._e2eEncryption.isEnabled()},ce.prototype.isE2EESupported=function(){return w.a.isSupported(this.options.config)},ce.prototype.toggleE2EE=function(e){this.isE2EESupported()?this._e2eEncryption.setEnabled(e):se.warn("Cannot enable / disable E2EE: platform is not supported.")},ce.prototype.isLobbySupported=function(){return Boolean(this.room&&this.room.getLobby().isSupported())},ce.prototype.isMembersOnly=function(){return Boolean(this.room&&this.room.membersOnlyEnabled)},ce.prototype.enableLobby=function(){return this.room&&this.isModerator()?this.room.getLobby().enable():Promise.reject(new Error("The conference not started or user is not moderator"))},ce.prototype.disableLobby=function(){this.room&&this.isModerator()?this.room.getLobby().disable():se.warn("Failed to disable lobby, ".concat(this.room?"":"not in a room, ").concat(this.isModerator()?"":"participant is not a moderator"))},ce.prototype.joinLobby=function(e,t){return this.room?this.room.getLobby().join(e,t):Promise.reject(new Error("The conference not started"))},ce.prototype.lobbyDenyAccess=function(e){this.room&&this.room.getLobby().denyAccess(e)},ce.prototype.lobbyApproveAccess=function(e){this.room&&this.room.getLobby().approveAccess(e)},ce.prototype.isAVModerationSupported=function(){return Boolean(this.room&&this.room.getAVModeration().isSupported())},ce.prototype.enableAVModeration=function(e){this.room&&this.isModerator()&&(e===ne.a||e===ne.c)?this.room.getAVModeration().enable(!0,e):se.warn("Failed to enable AV moderation, ".concat(this.room?"":"not in a room, ").concat(this.isModerator()?"":"participant is not a moderator, ").concat(this.room&&this.isModerator()?"wrong media type passed":""))},ce.prototype.disableAVModeration=function(e){this.room&&this.isModerator()&&(e===ne.a||e===ne.c)?this.room.getAVModeration().enable(!1,e):se.warn("Failed to disable AV moderation, ".concat(this.room?"":"not in a room, ").concat(this.isModerator()?"":"participant is not a moderator, ").concat(this.room&&this.isModerator()?"wrong media type passed":""))},ce.prototype.avModerationApprove=function(e,t){if(this.room&&this.isModerator()&&(e===ne.a||e===ne.c)){var n=this.getParticipantById(t);if(!n)return;this.room.getAVModeration().approve(e,n.getJid())}else se.warn("AV moderation skipped , ".concat(this.room?"":"not in a room, ").concat(this.isModerator()?"":"participant is not a moderator, ").concat(this.room&&this.isModerator()?"wrong media type passed":""))}}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return O}));var i=n(18),r=n(13),a=n(64),o=n(10),s=n(135),c=n(26),u=n(347),l=n.n(u),d=n(19),h=n(29),p=n.n(h),f=n(50),m=n.n(f),v=n(279),g=n.n(v),b=n(32),y=n(9),E=n.n(y),S=Object(i.getLogger)(e);function O(e){this.conference=e,this.xmppListeners={},e.on(o.TRACK_MUTE_CHANGED,(function(t){if(t.isLocal()&&e.statistics){var n=t.isP2P?e.p2pJingleSession:e.jvbJingleSession,i=n&&n.peerconnection||null;e.statistics.sendMuteEvent(i,t.isMuted(),t.getType())}}))}O.prototype.setupChatRoomListeners=function(){var e=this,t=this.conference,n=t.room;this.chatRoomForwarder=new l.a(n,this.conference.eventEmitter),n.addListener(E.a.ICE_RESTARTING,(function(e){e.isP2P||t.rtc.closeBridgeChannel()})),n.addListener(E.a.PARTICIPANT_FEATURES_CHANGED,(function(e,n){var i=t.getParticipantById(r.Strophe.getResourceFromJid(e));i&&(i.setFeatures(n),t.eventEmitter.emit(o.PARTCIPANT_FEATURES_CHANGED,i))})),n.addListener(E.a.ICE_RESTART_SUCCESS,(function(e,n){!e.isP2P&&t._setBridgeChannel(n,e.peerconnection)})),n.addListener(E.a.AUDIO_MUTED_BY_FOCUS,(function(e){c.a.sendAnalytics(Object(b.K)(d.a)),t.mutedByFocusActor=e,t.rtc.setAudioMute(!0).then((function(){t.isMutedByFocus=!0,t.mutedByFocusActor=null})).catch((function(e){t.mutedByFocusActor=null,S.warn("Error while audio muting due to focus request",e)}))})),n.addListener(E.a.VIDEO_MUTED_BY_FOCUS,(function(e){c.a.sendAnalytics(Object(b.K)(d.c)),t.mutedVideoByFocusActor=e,t.rtc.setVideoMute(!0).then((function(){t.isVideoMutedByFocus=!0,t.mutedVideoByFocusActor=null})).catch((function(e){t.mutedVideoByFocusActor=null,S.warn("Error while video muting due to focus request",e)}))})),this.chatRoomForwarder.forward(E.a.SUBJECT_CHANGED,o.SUBJECT_CHANGED),this.chatRoomForwarder.forward(E.a.MUC_JOINED,o.CONFERENCE_JOINED),this.chatRoomForwarder.forward(E.a.MEETING_ID_SET,o.CONFERENCE_UNIQUE_ID_SET),n.addListener(E.a.MUC_JOINED,(function(){e.conference._onMucJoined(),e.conference.isJvbConnectionInterrupted=!1,Object.keys(n.connectionTimes).forEach((function(e){var t=Object(b.C)("conference_".concat(e),{value:n.connectionTimes[e]});c.a.sendAnalytics(t)})),Object.keys(n.xmpp.connectionTimes).forEach((function(e){var t=Object(b.C)("xmpp_".concat(e),{value:n.xmpp.connectionTimes[e]});c.a.sendAnalytics(t)}))})),n.addListener(E.a.RENEGOTIATION_FAILED,(function(e,n){n.isP2P||t.eventEmitter.emit(o.CONFERENCE_FAILED,a.OFFER_ANSWER_FAILED,e)})),this.chatRoomForwarder.forward(E.a.ROOM_JOIN_ERROR,o.CONFERENCE_FAILED,a.CONNECTION_ERROR),this.chatRoomForwarder.forward(E.a.ROOM_CONNECT_ERROR,o.CONFERENCE_FAILED,a.CONNECTION_ERROR),this.chatRoomForwarder.forward(E.a.ROOM_CONNECT_NOT_ALLOWED_ERROR,o.CONFERENCE_FAILED,a.NOT_ALLOWED_ERROR),this.chatRoomForwarder.forward(E.a.ROOM_CONNECT_MEMBERS_ONLY_ERROR,o.CONFERENCE_FAILED,a.MEMBERS_ONLY_ERROR),this.chatRoomForwarder.forward(E.a.ROOM_MAX_USERS_ERROR,o.CONFERENCE_FAILED,a.CONFERENCE_MAX_USERS),this.chatRoomForwarder.forward(E.a.PASSWORD_REQUIRED,o.CONFERENCE_FAILED,a.PASSWORD_REQUIRED),this.chatRoomForwarder.forward(E.a.AUTHENTICATION_REQUIRED,o.CONFERENCE_FAILED,a.AUTHENTICATION_REQUIRED),this.chatRoomForwarder.forward(E.a.BRIDGE_DOWN,o.CONFERENCE_FAILED,a.VIDEOBRIDGE_NOT_AVAILABLE),n.addListener(E.a.BRIDGE_DOWN,(function(){return c.a.sendAnalytics(Object(b.z)())})),n.addListener(E.a.CONNECTION_RESTARTED,(function(e){t._onConferenceRestarted(e)})),this.chatRoomForwarder.forward(E.a.RESERVATION_ERROR,o.CONFERENCE_FAILED,a.RESERVATION_ERROR),this.chatRoomForwarder.forward(E.a.GRACEFUL_SHUTDOWN,o.CONFERENCE_FAILED,a.GRACEFUL_SHUTDOWN),n.addListener(E.a.CONNECTION_ICE_FAILED,(function(e){t._onIceConnectionFailed(e)})),this.chatRoomForwarder.forward(E.a.MUC_DESTROYED,o.CONFERENCE_FAILED,a.CONFERENCE_DESTROYED),this.chatRoomForwarder.forward(E.a.CHAT_ERROR_RECEIVED,o.CONFERENCE_ERROR,a.CHAT_ERROR),this.chatRoomForwarder.forward(E.a.FOCUS_DISCONNECTED,o.CONFERENCE_FAILED,a.FOCUS_DISCONNECTED),n.addListener(E.a.FOCUS_LEFT,(function(){c.a.sendAnalytics(Object(b.E)()),t.eventEmitter.emit(o.CONFERENCE_FAILED,a.FOCUS_LEFT)})),n.addListener(E.a.SESSION_ACCEPT_TIMEOUT,(function(e){c.a.sendAnalyticsAndLog(Object(b.G)(b.b,{p2p:e.isP2P}))})),n.addListener(E.a.RECORDER_STATE_CHANGED,(function(e,n){if(n){var i=t.getParticipantById(r.Strophe.getResourceFromJid(n));"off"===e.getStatus()?e.setTerminator(i):"on"===e.getStatus()&&e.setInitiator(i)}t.eventEmitter.emit(o.RECORDER_STATE_CHANGED,e)})),this.chatRoomForwarder.forward(E.a.TRANSCRIPTION_STATUS_CHANGED,o.TRANSCRIPTION_STATUS_CHANGED),this.chatRoomForwarder.forward(E.a.VIDEO_SIP_GW_AVAILABILITY_CHANGED,o.VIDEO_SIP_GW_AVAILABILITY_CHANGED),this.chatRoomForwarder.forward(E.a.VIDEO_SIP_GW_SESSION_STATE_CHANGED,o.VIDEO_SIP_GW_SESSION_STATE_CHANGED),this.chatRoomForwarder.forward(E.a.PHONE_NUMBER_CHANGED,o.PHONE_NUMBER_CHANGED),n.setParticipantPropertyListener((function(e,n){var i=t.getParticipantById(n);i&&i.setProperty(e.tagName.substring("jitsi_participant_".length),e.value)})),n.addListener(E.a.KICKED,t.onMemberKicked.bind(t)),n.addListener(E.a.SUSPEND_DETECTED,t.onSuspendDetected.bind(t)),this.chatRoomForwarder.forward(E.a.MUC_LOCK_CHANGED,o.LOCK_STATE_CHANGED),this.chatRoomForwarder.forward(E.a.MUC_MEMBERS_ONLY_CHANGED,o.MEMBERS_ONLY_CHANGED),n.addListener(E.a.MUC_MEMBER_JOINED,t.onMemberJoined.bind(t)),this.chatRoomForwarder.forward(E.a.MUC_LOBBY_MEMBER_JOINED,o.LOBBY_USER_JOINED),this.chatRoomForwarder.forward(E.a.MUC_LOBBY_MEMBER_UPDATED,o.LOBBY_USER_UPDATED),this.chatRoomForwarder.forward(E.a.MUC_LOBBY_MEMBER_LEFT,o.LOBBY_USER_LEFT),n.addListener(E.a.MUC_MEMBER_BOT_TYPE_CHANGED,t._onMemberBotTypeChanged.bind(t)),n.addListener(E.a.MUC_MEMBER_LEFT,t.onMemberLeft.bind(t)),this.chatRoomForwarder.forward(E.a.MUC_LEFT,o.CONFERENCE_LEFT),this.chatRoomForwarder.forward(E.a.MUC_DENIED_ACCESS,o.CONFERENCE_FAILED,a.CONFERENCE_ACCESS_DENIED),n.addListener(E.a.DISPLAY_NAME_CHANGED,t.onDisplayNameChanged.bind(t)),n.addListener(E.a.LOCAL_ROLE_CHANGED,(function(e){t.onLocalRoleChanged(e),t.statistics&&t.isModerator()&&t.on(o.RECORDER_STATE_CHANGED,(function(e){var t={error:e.getError(),id:"recorder_status",status:e.getStatus()};c.a.sendLog(JSON.stringify(t))}))})),n.addListener(E.a.MUC_ROLE_CHANGED,t.onUserRoleChanged.bind(t)),n.addListener(g.a.IDENTITY_UPDATED,(function(e,n){t.authEnabled=e,t.authIdentity=n,t.eventEmitter.emit(o.AUTH_STATUS_CHANGED,e,n)})),n.addListener(E.a.MESSAGE_RECEIVED,(function(e,n,i,a){var s=r.Strophe.getResourceFromJid(e);t.eventEmitter.emit(o.MESSAGE_RECEIVED,s,n,a)})),n.addListener(E.a.PRIVATE_MESSAGE_RECEIVED,(function(e,n,i,a){var s=r.Strophe.getResourceFromJid(e);t.eventEmitter.emit(o.PRIVATE_MESSAGE_RECEIVED,s,n,a)})),n.addListener(E.a.PRESENCE_STATUS,(function(e,n){var i=r.Strophe.getResourceFromJid(e),a=t.getParticipantById(i);a&&a._status!==n&&(a._status=n,t.eventEmitter.emit(o.USER_STATUS_CHANGED,i,n))})),n.addListener(E.a.JSON_MESSAGE_RECEIVED,(function(e,n){var i=r.Strophe.getResourceFromJid(e),a=t.getParticipantById(i);a&&t.eventEmitter.emit(o.ENDPOINT_MESSAGE_RECEIVED,a,n)})),n.addPresenceListener("startmuted",(function(e,n){var i=!1;if(t.myUserId()===n&&t.isModerator())i=!0;else{var r=t.getParticipantById(n);r&&r.isModerator()&&(i=!0)}if(i){var a="true"===e.attributes.audio,s="true"===e.attributes.video,c=!1;a!==t.startMutedPolicy.audio&&(t.startMutedPolicy.audio=a,c=!0),s!==t.startMutedPolicy.video&&(t.startMutedPolicy.video=s,c=!0),c&&t.eventEmitter.emit(o.START_MUTED_POLICY_CHANGED,t.startMutedPolicy)}})),t.statistics&&(n.addListener(E.a.CONNECTION_ICE_FAILED,(function(e){t.statistics.sendIceConnectionFailedEvent(e.peerconnection)})),n.addListener(E.a.ADD_ICE_CANDIDATE_FAILED,(function(e,n){t.statistics.sendAddIceCandidateFailed(e,n)})))},O.prototype.setupRTCListeners=function(){var e=this.conference,t=e.rtc;t.addListener(p.a.REMOTE_TRACK_ADDED,e.onRemoteTrackAdded.bind(e)),t.addListener(p.a.REMOTE_TRACK_REMOVED,e.onRemoteTrackRemoved.bind(e)),t.addListener(p.a.DOMINANT_SPEAKER_CHANGED,(function(t,n){if(e.lastDominantSpeaker!==t&&e.room){if(e.lastDominantSpeaker=t,e.eventEmitter.emit(o.DOMINANT_SPEAKER_CHANGED,t,n),n&&n.length){var i=n.slice(0);e.myUserId!==t&&i.splice(0,0,t),i.length>s.b&&i.splice(s.b,i.length-s.b),e.statistics&&e.statistics.setSpeakerList(i)}e.statistics&&e.myUserId()===t&&e.statistics.sendDominantSpeakerEvent(e.room.roomjid)}})),t.addListener(p.a.DATA_CHANNEL_OPEN,(function(){var t=window.performance.now(),n="data.channel.opened";S.log("(TIME) ".concat(n,":\t"),t),e.room.connectionTimes[n]=t,c.a.sendAnalytics(Object(b.C)(n,{value:t})),e.eventEmitter.emit(o.DATA_CHANNEL_OPENED)})),t.addListener(p.a.ENDPOINT_MESSAGE_RECEIVED,(function(t,n){var i=e.getParticipantById(t);i&&e.eventEmitter.emit(o.ENDPOINT_MESSAGE_RECEIVED,i,n)})),t.addListener(p.a.ENDPOINT_STATS_RECEIVED,(function(t,n){var i=e.getParticipantById(t);i?e.eventEmitter.emit(o.ENDPOINT_STATS_RECEIVED,i,n):S.warn("Ignoring ENDPOINT_STATS_RECEIVED for a non-existant participant: ".concat(t))})),t.addListener(p.a.LOCAL_UFRAG_CHANGED,(function(e,t){e.isP2P||c.a.sendLog(JSON.stringify({id:"local_ufrag",value:t}))})),t.addListener(p.a.REMOTE_UFRAG_CHANGED,(function(e,t){e.isP2P||c.a.sendLog(JSON.stringify({id:"remote_ufrag",value:t}))})),t.addListener(p.a.CREATE_ANSWER_FAILED,(function(t,n){e.statistics.sendCreateAnswerFailed(t,n),n.isP2P||e.eventEmitter.emit(o.CONFERENCE_FAILED,a.OFFER_ANSWER_FAILED,t)})),t.addListener(p.a.CREATE_OFFER_FAILED,(function(t,n){e.statistics.sendCreateOfferFailed(t,n),n.isP2P||e.eventEmitter.emit(o.CONFERENCE_FAILED,a.OFFER_ANSWER_FAILED,t)})),t.addListener(p.a.SET_LOCAL_DESCRIPTION_FAILED,(function(t,n){e.statistics.sendSetLocalDescFailed(t,n),n.isP2P||e.eventEmitter.emit(o.CONFERENCE_FAILED,a.OFFER_ANSWER_FAILED,t)})),t.addListener(p.a.SET_REMOTE_DESCRIPTION_FAILED,(function(t,n){e.statistics.sendSetRemoteDescFailed(t,n),n.isP2P||e.eventEmitter.emit(o.CONFERENCE_FAILED,a.OFFER_ANSWER_FAILED,t)})),t.addListener(p.a.LOCAL_TRACK_SSRC_UPDATED,(function(t,n){t.isVideoTrack()&&t.videoType===m.a.DESKTOP&&e.statistics.sendScreenSharingEvent(!0,n)}))},O.prototype.removeXMPPListeners=function(){var e=this,t=this.conference;Object.keys(this.xmppListeners).forEach((function(n){t.xmpp.removeListener(n,e.xmppListeners[n])})),this.xmppListeners={}},O.prototype.setupXMPPListeners=function(){var e=this.conference;this._addConferenceXMPPListener(E.a.CALL_INCOMING,e.onIncomingCall.bind(e)),this._addConferenceXMPPListener(E.a.CALL_ACCEPTED,e.onCallAccepted.bind(e)),this._addConferenceXMPPListener(E.a.TRANSPORT_INFO,e.onTransportInfo.bind(e)),this._addConferenceXMPPListener(E.a.CALL_ENDED,e.onCallEnded.bind(e)),this._addConferenceXMPPListener(E.a.START_MUTED_FROM_FOCUS,(function(t,n){e.options.config.ignoreStartMuted||(e.startAudioMuted=t,e.startVideoMuted=n,e.getLocalTracks().forEach((function(t){switch(t.getType()){case d.a:e.startAudioMuted&&t.mute();break;case d.c:e.startVideoMuted&&t.mute()}})),e.eventEmitter.emit(o.STARTED_MUTED))})),this._addConferenceXMPPListener(E.a.CONFERENCE_TIMESTAMP_RECEIVED,(function(t){e.eventEmitter.emit(o.CONFERENCE_CREATED_TIMESTAMP,t)})),this._addConferenceXMPPListener(E.a.AV_MODERATION_CHANGED,(function(t,n,i){var r=e.getParticipants().find((function(e){return e.getJid()===i}));e.eventEmitter.emit(o.AV_MODERATION_CHANGED,{enabled:t,mediaType:n,actor:r})})),this._addConferenceXMPPListener(E.a.AV_MODERATION_PARTICIPANT_APPROVED,(function(t,n){var i=e.getParticipantById(r.Strophe.getResourceFromJid(n));i&&e.eventEmitter.emit(o.AV_MODERATION_PARTICIPANT_APPROVED,{participant:i,mediaType:t})})),this._addConferenceXMPPListener(E.a.AV_MODERATION_APPROVED,(function(t){return e.eventEmitter.emit(o.AV_MODERATION_APPROVED,{mediaType:t})}))},O.prototype._addConferenceXMPPListener=function(e,t){this.xmppListeners[e]=t,this.conference.xmpp.addListener(e,t)},O.prototype.setupStatisticsListeners=function(){var e=this.conference;e.statistics&&(e.statistics.addAudioLevelListener((function(t,n,i,r){e.rtc.setAudioLevel(t,n,i,r)})),e.statistics.addBeforeDisposedListener((function(){e.eventEmitter.emit(o.BEFORE_STATISTICS_DISPOSED)})),e.options.config.startSilent||e.statistics.addByteSentStatsListener((function(t,n){e.getLocalTracks(d.a).forEach((function(e){var i=t.getLocalSSRC(e);i&&n.hasOwnProperty(i)&&e._onByteSentStatsReceived(t,n[i])}))})))}}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e,i){n.d(t,"a",(function(){return d}));var r=n(6),a=n(8),o=n(36),s=n(35),c=n(186),u=n(18),l=Object(u.getLogger)(e),d=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(){var e;return Object(r.a)(this,n),e=t.call(this),l.info("This appears to be ".concat(e.getName(),", ver: ").concat(e.getVersion())),e}return Object(a.a)(n,[{key:"doesVideoMuteByStreamRemove",value:function(){return this.isChromiumBased()||this.isWebKitBased()}},{key:"isChromiumBased",value:function(){return this.isChrome()||this.isElectron()||this.isNWJS()||this.isOpera()}},{key:"isWebKitBased",value:function(){return this._bowser.isEngine("webkit")&&"undefined"!==typeof navigator.mediaDevices&&"undefined"!==typeof navigator.mediaDevices.getUserMedia&&"undefined"!==typeof window.RTCRtpTransceiver&&Object.keys(RTCRtpTransceiver.prototype).indexOf("currentDirection")>-1}},{key:"isTwa",value:function(){return"matchMedia"in window&&window.matchMedia("(display-mode:standalone)").matches}},{key:"isSupported",value:function(){return this.isChromiumBased()&&this._getChromiumBasedVersion()>=72||this.isFirefox()||this.isReactNative()||this.isWebKitBased()}},{key:"isUserInteractionRequiredForUnmute",value:function(){return this.isFirefox()&&this.isVersionLessThan("68")}},{key:"supportsVideoMuteOnConnInterrupted",value:function(){return this.isChromiumBased()||this.isReactNative()||this.isWebKitBased()}},{key:"supportsBandwidthStatistics",value:function(){return!this.isFirefox()&&!this.isWebKitBased()}},{key:"supportsCodecPreferences",value:function(){return Boolean(window.RTCRtpTransceiver&&"undefined"!==typeof window.RTCRtpTransceiver.setCodecPreferences&&window.RTCRtpReceiver&&"undefined"!==typeof window.RTCRtpReceiver.getCapabilities)&&!this.isWebKitBased()}},{key:"supportsDeviceChangeEvent",value:function(){return navigator.mediaDevices&&"undefined"!==typeof navigator.mediaDevices.ondevicechange&&"undefined"!==typeof navigator.mediaDevices.addEventListener}},{key:"supportsLocalCandidateRttStatistics",value:function(){return this.isChromiumBased()||this.isReactNative()||this.isWebKitBased()}},{key:"supportsPerformanceObserver",value:function(){return"undefined"!==typeof window.PerformanceObserver&&PerformanceObserver.supportedEntryTypes.indexOf("longtask")>-1}},{key:"supportsReceiverStats",value:function(){return"undefined"!==typeof window.RTCRtpReceiver&&Object.keys(RTCRtpReceiver.prototype).indexOf("getSynchronizationSources")>-1&&!this.isWebKitBased()}},{key:"supportsRTTStatistics",value:function(){return!this.isFirefox()}},{key:"usesSdpMungingForSimulcast",value:function(){return this.isChromiumBased()||this.isReactNative()||this.isWebKitBased()}},{key:"usesAdapter",value:function(){return!this.isReactNative()}},{key:"usesRidsForSimulcast",value:function(){return!1}},{key:"supportsGetDisplayMedia",value:function(){return"undefined"!==typeof navigator.getDisplayMedia||"undefined"!==typeof navigator.mediaDevices&&"undefined"!==typeof navigator.mediaDevices.getDisplayMedia}},{key:"supportsInsertableStreams",value:function(){if("undefined"===typeof window.RTCRtpSender||!window.RTCRtpSender.prototype.createEncodedStreams&&!window.RTCRtpSender.prototype.createEncodedVideoStreams)return!1;var e=new ReadableStream;try{return window.postMessage(e,"*",[e]),!0}catch(t){return!1}}},{key:"supportsAudioRed",value:function(){return Boolean(window.RTCRtpSender&&window.RTCRtpSender.getCapabilities&&window.RTCRtpSender.getCapabilities("audio").codecs.some((function(e){return"audio/red"===e.mimeType}))&&window.RTCRtpReceiver&&window.RTCRtpReceiver.getCapabilities&&window.RTCRtpReceiver.getCapabilities("audio").codecs.some((function(e){return"audio/red"===e.mimeType})))}},{key:"supportsUnifiedPlan",value:function(){return!this.isReactNative()}},{key:"supportsVADDetection",value:function(){return this.isChromiumBased()}},{key:"_getChromiumBasedVersion",value:function(){if(this.isChromiumBased()){if(this.isNWJS())return Number.parseInt(i.versions.chromium,10);var e=navigator.userAgent;if(e.match(/Chrome/))return Number.parseInt(e.match(/Chrome\/([\d.]+)/)[1],10)}return-1}}]),n}(c.a)}).call(this,"/index.js",n(176))},,function(e,t,n){"use strict";(function(e){var i=n(7),r=n(6),a=n(8),o=n(18),s=n(32),c=n(20),u=Object(o.getLogger)(e),l=function(){function e(){Object(r.a)(this,e),this.reset()}return Object(a.a)(e,[{key:"reset",value:function(){this.disposed=!1,this.analyticsHandlers=new Set,this.cache=[],this.permanentProperties={},this.conferenceName="",this.addPermanentProperties({user_agent:navigator.userAgent,browser_name:c.a.getName()})}},{key:"dispose",value:function(){u.warn("Disposing of analytics adapter."),this.analyticsHandlers&&this.analyticsHandlers.size>0&&this.analyticsHandlers.forEach((function(e){"function"===typeof e.dispose&&e.dispose()})),this.setAnalyticsHandlers([]),this.disposed=!0}},{key:"setAnalyticsHandlers",value:function(e){var t=this;if(!this.disposed){this.analyticsHandlers=new Set(e),this._setUserProperties();var n=this.cache;this.cache=null,n&&n.forEach((function(e){return t._sendEvent(e)}))}}},{key:"_setUserProperties",value:function(){var e=this;this.analyticsHandlers.forEach((function(t){try{t.setUserProperties(e.permanentProperties)}catch(n){u.warn("Error in setUserProperties method of one of the "+"analytics handlers: ".concat(n))}}))}},{key:"addPermanentProperties",value:function(e){this.permanentProperties=Object(i.a)(Object(i.a)({},this.permanentProperties),e),this._setUserProperties()}},{key:"setConferenceName",value:function(e){this.conferenceName=e,this.addPermanentProperties({conference_name:e})}},{key:"sendEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.disposed){var n=null;"string"===typeof e?n={type:s.t,action:e,actionSubject:e,source:e,attributes:t}:"object"===typeof e&&(n=e),this._verifyRequiredFields(n)?this._sendEvent(n):u.error("Dropping a mis-formatted event: ".concat(JSON.stringify(n)))}}},{key:"_verifyRequiredFields",value:function(e){if(!e)return!1;e.type||(e.type=s.t);var t=e.type;return t!==s.t&&t!==s.u&&t!==s.w&&t!==s.v?(u.error("Unknown event type: ".concat(t)),!1):t===s.u?Boolean(e.name):(e.action=e.action||e.name||e.actionSubject,e.actionSubject=e.actionSubject||e.name||e.action,e.source=e.source||e.name||e.action||e.actionSubject,e.action&&e.actionSubject&&e.source?!!(t!==s.v||(e.objectType=e.objectType||"generic-object-type",e.containerType=e.containerType||"conference","conference"!==e.containerType||e.containerId||(e.containerId=this.conferenceName),e.objectType&&e.objectId&&e.containerType&&e.containerId))||(u.error("Required field missing (containerId, containerType, objectId or objectType)"),!1):(u.error("Required field missing (action, actionSubject or source)"),!1))}},{key:"_maybeCacheEvent",value:function(e){return!!this.cache&&(this.cache.push(e),this.cache.length>100&&this.cache.splice(0,1),!0)}},{key:"_sendEvent",value:function(e){this._maybeCacheEvent(e)||this.analyticsHandlers.forEach((function(t){try{t.sendEvent(e)}catch(n){u.warn("Error sending analytics event: ".concat(n))}}))}}]),e}();t.a=new l}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return l}));var i=n(15),r=n(6),a=n(8),o=n(18),s=n(81),c=n(100),u=Object(o.getLogger)(e),l=function(){function e(t,n){Object(r.a)(this,e),this.eventEmitter=t,this.longTasks=0,this.maxDuration=0,this.performanceStatsInterval=n,this.stats=new c.a}return Object(a.a)(e,[{key:"getLongTasksStats",value:function(){return{avgRatePerMinute:(60*this.stats.getAverage()).toFixed(2),maxDurationMs:this.maxDuration}}},{key:"startObserver",value:function(){var e=this;this.longTaskEventHandler=function(t){var n,r=t.getEntries(),a=Object(i.a)(r);try{for(a.s();!(n=a.n()).done;){var o=n.value;e.longTasks++,e.maxDuration=Math.max(e.maxDuration,o.duration).toFixed(3)}}catch(s){a.e(s)}finally{a.f()}},u.info("Creating a Performance Observer for monitoring Long Tasks"),this.observer=new PerformanceObserver(this.longTaskEventHandler),this.observer.observe({type:"longtask",buffered:!0});var t=Date.now();this.longTasksIntervalId=setInterval((function(){var n=Date.now(),i=e._lastTimeStamp?(n-e._lastTimeStamp)/1e3:(n-t)/1e3,r=e.longTasks/i;e.stats.addNext(r),e.eventEmitter.emit(s.e,e.getLongTasksStats()),e.longTasks=0,e._lastTimeStamp=Date.now()}),this.performanceStatsInterval)}},{key:"stopObserver",value:function(){this.observer&&this.observer.disconnect(),this.longTaskEventHandler=null,this.longTasksIntervalId&&(clearInterval(this.longTasksIntervalId),this.longTasksIntervalId=null)}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return f}));var i=n(27),r=n(15),a=n(18),o=n(19),s=n(81),c=n(20),u=n(43),l=Object(a.getLogger)(e);function d(e,t){return!t||t<=0||!e||e<=0?0:Math.round(e/t*100)}function h(){this.loss={},this.bitrate={download:0,upload:0},this.resolution={},this.framerate=0,this.codec=""}function p(){this.bandwidth={},this.bitrate={},this.packetLoss=null,this.transport=[]}function f(e,t,n,i){this.peerconnection=e,this.baselineAudioLevelsReport=null,this.currentAudioLevelsReport=null,this.currentStatsReport=null,this.previousStatsReport=null,this.audioLevelReportHistory={},this.audioLevelsIntervalId=null,this.eventEmitter=i,this.conferenceStats=new p,this.audioLevelsIntervalMilis=t,this.speakerList=[],this.statsIntervalId=null,this.statsIntervalMilis=n,this.ssrc2stats=new Map}h.prototype.setLoss=function(e){this.loss=e||{}},h.prototype.setResolution=function(e){this.resolution=e||{}},h.prototype.addBitrate=function(e){this.bitrate.download+=e.download,this.bitrate.upload+=e.upload},h.prototype.resetBitrate=function(){this.bitrate.download=0,this.bitrate.upload=0},h.prototype.setFramerate=function(e){this.framerate=e||0},h.prototype.setCodec=function(e){this.codec=e||""},f.prototype.setSpeakerList=function(e){this.speakerList=e},f.prototype.stop=function(){this.audioLevelsIntervalId&&(clearInterval(this.audioLevelsIntervalId),this.audioLevelsIntervalId=null),this.statsIntervalId&&(clearInterval(this.statsIntervalId),this.statsIntervalId=null)},f.prototype.errorCallback=function(e){u.callErrorHandler(e),l.error("Get stats error",e),this.stop()},f.prototype.start=function(e){var t=this;e&&(c.a.supportsReceiverStats()&&l.info("Using RTCRtpSynchronizationSource for remote audio levels"),this.audioLevelsIntervalId=setInterval((function(){if(c.a.supportsReceiverStats()){var e=t.peerconnection.getAudioLevels(t.speakerList);for(var n in e)if(e.hasOwnProperty(n)){var i=2.5*e[n];t.eventEmitter.emit(s.a,t.peerconnection,Number.parseInt(n,10),i,!1)}}else t.peerconnection.getStats().then((function(e){t.currentAudioLevelsReport="function"===typeof(null===e||void 0===e?void 0:e.result)?e.result():e,t.processAudioLevelReport(),t.baselineAudioLevelsReport=t.currentAudioLevelsReport})).catch((function(e){return t.errorCallback(e)}))}),this.audioLevelsIntervalMilis));var n=function(){t.peerconnection.getStats().then((function(e){t.currentStatsReport="function"===typeof(null===e||void 0===e?void 0:e.result)?e.result():e;try{t.processStatsReport()}catch(n){u.callErrorHandler(n),l.error("Processing of RTP stats failed:",n)}t.previousStatsReport=t.currentStatsReport})).catch((function(e){return t.errorCallback(e)}))};n(),this.statsIntervalId=setInterval(n,this.statsIntervalMilis)},f.prototype._processAndEmitReport=function(){var e,t,n,a=this,o={download:0,upload:0},c={download:0,upload:0},u=0,h=0,p={},f={},m={},v=0,g=0,b=0,y=0,E=Object(r.a)(this.ssrc2stats);try{for(E.s();!(n=E.n()).done;){var S=Object(i.a)(n.value,2),O=S[0],_=S[1],C=_.loss,T=C.isDownloadStream?"download":"upload";o[T]+=C.packetsTotal,c[T]+=C.packetsLost,u+=_.bitrate.download,h+=_.bitrate.upload;var j=this.peerconnection.getTrackBySSRC(O);if(j){j.isAudioTrack()?(v+=_.bitrate.download,g+=_.bitrate.upload,e=_.codec):(b+=_.bitrate.download,y+=_.bitrate.upload,t=_.codec);var A=j.getParticipantId();if(A){var k=_.resolution;if(k.width&&k.height&&-1!==k.width&&-1!==k.height){var R=p[A]||{};R[O]=k,p[A]=R}if(0!==_.framerate){var I=f[A]||{};I[O]=_.framerate,f[A]=I}if(e&&t){var P={audio:e,video:t},w=m[A]||{};w[O]=P,m[A]=w}}else l.error("No participant ID returned by ".concat(j))}_.resetBitrate()}}catch(M){E.e(M)}finally{E.f()}this.conferenceStats.bitrate={upload:h,download:u},this.conferenceStats.bitrate.audio={upload:g,download:v},this.conferenceStats.bitrate.video={upload:y,download:b},this.conferenceStats.packetLoss={total:d(c.download+c.upload,o.download+o.upload),download:d(c.download,o.download),upload:d(c.upload,o.upload)};var N,D={};Object.keys(this.audioLevelReportHistory).forEach((function(e){var t=a.audioLevelReportHistory[e],n=t.data,i=t.isLocal,r=n.reduce((function(e,t){return e+t}))/n.length;if(i)N=r;else{var o=a.peerconnection.getTrackBySSRC(Number(e));if(o){var s=o.getParticipantId();s&&(D[s]=r)}}})),this.audioLevelReportHistory={},this.eventEmitter.emit(s.d,this.peerconnection,{bandwidth:this.conferenceStats.bandwidth,bitrate:this.conferenceStats.bitrate,packetLoss:this.conferenceStats.packetLoss,resolution:p,framerate:f,codec:m,transport:this.conferenceStats.transport,localAvgAudioLevels:N,avgAudioLevels:D}),this.conferenceStats.transport=[]},f.prototype.getNonNegativeValue=function(e){var t=e;return"number"!==typeof t&&(t=Number(t)),isNaN(t)?0:Math.max(0,t)},f.prototype._calculateBitrate=function(e,t,n){var i=this.getNonNegativeValue(e[n]),r=this.getNonNegativeValue(t[n]),a=Math.max(0,i-r),o=e.timestamp-t.timestamp,s=0;return o>0&&(s=Math.round(8*a/o)),s},f.prototype.processStatsReport=function(){var e=this;if(this.previousStatsReport){var t={};this.currentStatsReport.forEach((function(n){if("candidate-pair"===n.type&&n.nominated&&"succeeded"===n.state){var i=n.availableIncomingBitrate,r=n.availableOutgoingBitrate;(i||r)&&(e.conferenceStats.bandwidth={download:Math.round(i/1e3),upload:Math.round(r/1e3)});var a=e.currentStatsReport.get(n.remoteCandidateId),s=e.currentStatsReport.get(n.localCandidateId);if(a&&s){var u=c.a.isChromiumBased()?a.ip:a.address,l=a.port,d="".concat(u,":").concat(l),p=c.a.isChromiumBased()?s.ip:s.address,f=s.port,m="".concat(p,":").concat(f),v=a.protocol,g=e.conferenceStats.transport;g.some((function(e){return e.ip===d&&e.type===v&&e.localip===m}))||g.push({ip:d,type:v,localip:m,p2p:e.peerconnection.isP2P,localCandidateType:s.candidateType,remoteCandidateType:a.candidateType,networkType:s.networkType,rtt:1e3*n.currentRoundTripTime})}}else if("inbound-rtp"===n.type||"outbound-rtp"===n.type){var b=e.previousStatsReport.get(n.id),y=e.getNonNegativeValue(n.ssrc);if(!b||!y)return;var E=e.ssrc2stats.get(y);E||(E=new h,e.ssrc2stats.set(y,E));var S=!0,O="packetsReceived";"outbound-rtp"===n.type&&(S=!1,O="packetsSent");var _=n[O];(!_||_<0)&&(_=0);var C=e.getNonNegativeValue(b[O]),T=Math.max(0,_-C),j=e.getNonNegativeValue(n.packetsLost),A=e.getNonNegativeValue(b.packetsLost),k=Math.max(0,j-A);if(E.setLoss({packetsTotal:T+k,packetsLost:k,isDownloadStream:S}),"inbound-rtp"===n.type){var R={height:n.frameHeight,width:n.frameWidth},I=n.framesPerSecond;R.height&&R.width&&E.setResolution(R),E.setFramerate(Math.round(I||0)),E.addBitrate({download:e._calculateBitrate(n,b,"bytesReceived"),upload:0})}else t[y]=e.getNonNegativeValue(n.bytesSent),E.addBitrate({download:0,upload:e._calculateBitrate(n,b,"bytesSent")});var P=e.currentStatsReport.get(n.codecId);if(P){var w=P.mimeType.split("/")[1];w&&E.setCodec(w)}}else if("track"===n.type&&n.kind===o.c&&!n.remoteSource){var N={height:n.frameHeight,width:n.frameWidth},D=e.peerconnection.getLocalTracks(o.c);if(null===D||void 0===D||!D.length)return;var M=e.peerconnection.getLocalSSRC(D[0]);if(!M)return;var L=e.ssrc2stats.get(M);L||(L=new h,e.ssrc2stats.set(M,L)),N.height&&N.width&&L.setResolution(N);var x=n.framesPerSecond;if(!x){var F=e.previousStatsReport.get(n.id);if(F){var U=n.timestamp-F.timestamp;if(U>0&&n.framesSent)x=(n.framesSent-F.framesSent)/U*1e3}if(!x)return}var V=e.peerconnection.getActiveSimulcastStreams();x=V?Math.round(x/V):0,L.setFramerate(x)}})),this.eventEmitter.emit(s.c,this.peerconnection,t),this._processAndEmitReport()}},f.prototype.processAudioLevelReport=function(){var e=this;this.baselineAudioLevelsReport&&this.currentAudioLevelsReport.forEach((function(t){if("track"===t.type){var n=t.audioLevel;if(n){var i=t.trackIdentifier,r=e.peerconnection.getSsrcByTrackId(i);if(r){var a=r===e.peerconnection.getLocalSSRC(e.peerconnection.getLocalTracks(o.a));e.eventEmitter.emit(s.a,e.peerconnection,r,n,a)}}}}))}}).call(this,"/index.js")},function(e,t){function n(e,t){if(!e||!t||"function"!==typeof e.addListener||"function"!==typeof t.emit)throw new Error("Invalid arguments passed to EventEmitterForwarder");this.src=e,this.dest=t}n.prototype.forward=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0];t[0]=this.dest,this.src.addListener(i,Function.prototype.bind.apply(this.dest.emit,t))},e.exports=n},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var i=n(6),r=n(8),a=n(13),o=n(10),s=n(164),c=n(19),u=function(){function e(t,n,r,o,c,u,l){Object(i.a)(this,e),this._jid=t,this._id=a.Strophe.getResourceFromJid(t),this._conference=n,this._displayName=r,this._supportsDTMF=!1,this._tracks=[],this._role="none",this._status=u,this._hidden=o,this._statsID=c,this._connectionStatus=s.a.ACTIVE,this._properties={},this._identity=l,this._features=new Set}return Object(r.a)(e,[{key:"getConference",value:function(){return this._conference}},{key:"getProperty",value:function(e){return this._properties[e]}},{key:"hasAnyVideoTrackWebRTCMuted",value:function(){return this.getTracks().some((function(e){return e.getType()===c.c&&e.isWebRTCTrackMuted()}))}},{key:"_setConnectionStatus",value:function(e){this._connectionStatus=e}},{key:"getConnectionStatus",value:function(){return this._connectionStatus}},{key:"setProperty",value:function(e,t){var n=this._properties[e];t!==n&&(this._properties[e]=t,this._conference.eventEmitter.emit(o.PARTICIPANT_PROPERTY_CHANGED,this,e,n,t))}},{key:"getTracks",value:function(){return this._tracks.slice()}},{key:"getTracksByMediaType",value:function(e){return this.getTracks().filter((function(t){return t.getType()===e}))}},{key:"getId",value:function(){return this._id}},{key:"getJid",value:function(){return this._jid}},{key:"getDisplayName",value:function(){return this._displayName}},{key:"getStatsID",value:function(){return this._statsID}},{key:"getStatus",value:function(){return this._status}},{key:"isModerator",value:function(){return"moderator"===this._role}},{key:"isHidden",value:function(){return this._hidden}},{key:"isAudioMuted",value:function(){return this._isMediaTypeMuted(c.a)}},{key:"_isMediaTypeMuted",value:function(e){return this.getTracks().reduce((function(t,n){return t&&(n.getType()!==e||n.isMuted())}),!0)}},{key:"isVideoMuted",value:function(){return this._isMediaTypeMuted(c.c)}},{key:"getRole",value:function(){return this._role}},{key:"setRole",value:function(e){this._role=e}},{key:"supportsDTMF",value:function(){return this._supportsDTMF}},{key:"getFeatures",value:function(){return Promise.resolve(this._features)}},{key:"hasFeature",value:function(e){return this._features.has(e)}},{key:"setFeatures",value:function(e){this._features=e||new Set}},{key:"getBotType",value:function(){return this._botType}},{key:"setBotType",value:function(e){this._botType=e}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(80),r=n(77);function a(e){var t,n=this,a=e.id,o=e.password,s=e.onCreateResource,c=e.onLoginSuccessful,u=e.roomPassword,l=!1,d=new r.e(this.connection.options),h=new Promise((function(e,r){t=r,d.addListener(i.CONNECTION_DISCONNECTED,(function(){d=void 0})),d.addListener(i.CONNECTION_ESTABLISHED,(function(){l||(c&&c(),d.createRoom(n.options.name,n.options.config,s).moderator.authenticate().then((function(){d&&d.disconnect(),l||(n.join(u),e())})).catch((function(e){var t=e.error,n=e.message;d.disconnect(),r({authenticationError:t,message:n})})))})),d.addListener(i.CONNECTION_FAILED,(function(e,t,n){r({connectionError:e,credentials:n,message:t}),d=void 0})),l||d.connect(a,o)}));return h.cancel=function(){l=!0,t({}),d&&d.disconnect()},h}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return c}));var i=n(6),r=n(8),a=n(18),o=Object(a.getLogger)(e),s=Symbol("kJitsiE2EE"),c=function(){function e(){Object(i.a)(this,e);var t="",n=document.querySelector('script[src*="lib-jitsi-meet"]');if(n){var r=n.src.lastIndexOf("/");t="".concat(n.src.substring(0,r),"/")}var a="".concat(t,"lib-jitsi-meet.e2ee-worker.js"),s=new Blob(['importScripts("'.concat(a,'");')],{type:"application/javascript"}),c=window.URL.createObjectURL(s);this._worker=new Worker(c,{name:"E2EE Worker"}),this._worker.onerror=function(e){return o.onerror(e)}}return Object(r.a)(e,[{key:"cleanup",value:function(e){this._worker.postMessage({operation:"cleanup",participantId:e})}},{key:"handleReceiver",value:function(e,t,n){var i;e[s]||(e[s]=!0,i=e.createEncodedStreams?e.createEncodedStreams():"video"===t?e.createEncodedVideoStreams():e.createEncodedAudioStreams(),this._worker.postMessage({operation:"decode",readableStream:i.readable||i.readableStream,writableStream:i.writable||i.writableStream,participantId:n},[i.readable||i.readableStream,i.writable||i.writableStream]))}},{key:"handleSender",value:function(e,t,n){var i;e[s]||(e[s]=!0,i=e.createEncodedStreams?e.createEncodedStreams():"video"===t?e.createEncodedVideoStreams():e.createEncodedAudioStreams(),this._worker.postMessage({operation:"encode",readableStream:i.readable||i.readableStream,writableStream:i.writable||i.writableStream,participantId:n},[i.readable||i.readableStream,i.writable||i.writableStream]))}},{key:"setKey",value:function(e,t,n){this._worker.postMessage({operation:"setKey",participantId:e,key:t,keyIndex:n})}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u}));var i=n(6),r=n(8),a=n(18),o=n(167),s=n(352),c=Object(a.getLogger)(e),u=function(){function e(t){Object(i.a)(this,e),this._stropheConn=t,this._resumeRetryN=0,this._retryDelay=void 0}return Object(r.a)(e,[{key:"retryDelay",get:function(){return this._retryDelay}},{key:"schedule",value:function(){var e=this;this._cancelResume(),this._resumeRetryN+=1,this._networkOnlineListener=o.b.addEventListener(o.a,(function(t){t.isOnline?e._scheduleResume():e._cancelResume()})),o.b.isOnline()&&this._scheduleResume()}},{key:"_scheduleResume",value:function(){var e=this;this._resumeTimeout||(this._resumeRetryN=Math.min(3,this._resumeRetryN),this._retryDelay=Object(s.a)(this._resumeRetryN,1500*this._resumeRetryN,3),c.info("Will try to resume the XMPP connection in ".concat(this.retryDelay,"ms")),this._resumeTimeout=setTimeout((function(){return e._resumeConnection()}),this.retryDelay))}},{key:"_cancelResume",value:function(){this._resumeTimeout&&(c.info("Canceling connection resume task"),clearTimeout(this._resumeTimeout),this._resumeTimeout=void 0,this._retryDelay=void 0)}},{key:"_resumeConnection",value:function(){var e=this._stropheConn.streamManagement,t=e.getResumeToken();if(t){c.info("Trying to resume the XMPP connection");var n=new URL(this._stropheConn.service),i=n.search,r=/(previd=)([\w-]+)/,a=i.match(r);a&&-1===a.indexOf(t)?i=i.replace(r,"$1".concat(t)):a||(i+=-1===i.indexOf("?")?"?previd=".concat(t):"&previd=".concat(t)),n.search=i,this._stropheConn.service=n.toString(),e.resume()}}},{key:"cancel",value:function(){this._cancelResume(),this._resumeRetryN=0,this._networkOnlineListener&&(this._networkOnlineListener(),this._networkOnlineListener=null)}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return Math.floor(Math.random()*(1e3*Math.pow(n,e)-t)+t)}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var i=n(6),r=n(8),a=function(){function e(){Object(i.a)(this,e),this._lastSuccess=null,this._lastFailedMessage=null}return Object(r.a)(e,[{key:"startTracking",value:function(e,t){var n=this,i=t.rawInput;t.rawInput=function(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];var s=a[0];s.includes("failure")&&(n._lastFailedMessage=s),e.connected&&(n._lastSuccess=Date.now()),i.apply(t,a)}}},{key:"getLastFailedMessage",value:function(){return this._lastFailedMessage}},{key:"getTimeSinceLastSuccess",value:function(){return this._lastSuccess?Date.now()-this._lastSuccess:null}}]),e}()},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return m}));var i=n(6),r=n(8),a=n(103),o=n(85),s=n(36),c=n(35),u=n(18),l=n(13),d=n(43),h=n.n(d),p=n(121),f=Object(u.getLogger)(e),m=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e){var r,a=e.getTimeSinceLastServerResponse,o=e.onPingThresholdExceeded,s=e.pingOptions,c=void 0===s?{}:s;return Object(i.a)(this,n),(r=t.call(this)).failedPings=0,r._onPingThresholdExceeded=o,r._getTimeSinceLastServerResponse=a,r.pingInterval="number"===typeof c.interval?c.interval:1e4,r.pingTimeout="number"===typeof c.timeout?c.timeout:5e3,r.pingThreshold="number"===typeof c.threshold?c.threshold:2,r.pingTimestampsToKeep=Math.round(12e4/r.pingInterval),r.pingExecIntervals=new Array(r.pingTimestampsToKeep),r}return Object(r.a)(n,[{key:"init",value:function(e){Object(a.a)(Object(o.a)(n.prototype),"init",this).call(this,e),l.Strophe.addNamespace("PING","urn:xmpp:ping")}},{key:"ping",value:function(e,t,n,i){this._addPingExecutionTimestamp();var r=Object(l.$iq)({type:"get",to:e});r.c("ping",{xmlns:l.Strophe.NS.PING}),this.connection.sendIQ2(r,{timeout:i}).then(t,n)}},{key:"startInterval",value:function(e){var t=this;clearInterval(this.intervalId),this.intervalId=window.setInterval((function(){var n=Date.now();if(t._getTimeSinceLastServerResponse()<n-t._lastServerCheck)return t._addPingExecutionTimestamp(),t._lastServerCheck=n,void(t.failedPings=0);t.ping(e,(function(){t._lastServerCheck=t._getTimeSinceLastServerResponse()+Date.now(),t.failedPings=0}),(function(e){t.failedPings+=1;var n="Ping ".concat(e?"error":"timeout");t.failedPings>=t.pingThreshold?(h.a.callErrorHandler(new Error(n)),f.error(n,e),t._onPingThresholdExceeded&&t._onPingThresholdExceeded()):f.warn(n,e)}),t.pingTimeout)}),this.pingInterval),f.info("XMPP pings will be sent every ".concat(this.pingInterval," ms"))}},{key:"stopInterval",value:function(){this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null,this.failedPings=0,f.info("Ping interval cleared"))}},{key:"_addPingExecutionTimestamp",value:function(){this.pingExecIntervals.push((new Date).getTime()),this.pingExecIntervals.length>this.pingTimestampsToKeep&&this.pingExecIntervals.shift()}},{key:"getPingSuspendTime",value:function(){var e=this.pingExecIntervals.slice();e.push((new Date).getTime());var t=0,n=e[0];return e.forEach((function(e){var i=e-n;i>t&&(t=i),n=e})),t-=this.pingInterval,Math.max(t,0)}}]),n}(p.b)}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return v}));var i=n(6),r=n(8),a=n(103),o=n(85),s=n(36),c=n(35),u=n(18),l=n(13),d=n(9),h=n.n(d),p=n(356),f=n(121),m=Object(u.getLogger)(e),v=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this)).xmpp=e,r.rooms={},r}return Object(r.a)(n,[{key:"init",value:function(e){Object(a.a)(Object(o.a)(n.prototype),"init",this).call(this,e),this.connection.addHandler(this.onPresence.bind(this),null,"presence",null,null,null,null),this.connection.addHandler(this.onPresenceUnavailable.bind(this),null,"presence","unavailable",null),this.connection.addHandler(this.onPresenceError.bind(this),null,"presence","error",null),this.connection.addHandler(this.onMessage.bind(this),null,"message",null,null),this.connection.addHandler(this.onMute.bind(this),"http://jitsi.org/jitmeet/audio","iq","set",null,null),this.connection.addHandler(this.onMuteVideo.bind(this),"http://jitsi.org/jitmeet/video","iq","set",null,null)}},{key:"createRoom",value:function(e,t,n){var i=l.Strophe.getBareJidFromJid(e);if(this.rooms[i]){var r="You are already in the room!";throw m.error(r),new Error(r)}return this.rooms[i]=new p.a(this.connection,e,t,this.xmpp,n),this.eventEmitter.emit(h.a.EMUC_ROOM_ADDED,this.rooms[i]),this.rooms[i]}},{key:"doLeave",value:function(e){this.eventEmitter.emit(h.a.EMUC_ROOM_REMOVED,this.rooms[e]),delete this.rooms[e]}},{key:"onPresence",value:function(e){var t=e.getAttribute("from");if(e.getAttribute("type"))return!0;var n=this.rooms[l.Strophe.getBareJidFromJid(t)];return!n||($(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>status[code="201"]').length&&n.createNonAnonymousRoom(),n.onPresence(e),!0)}},{key:"onPresenceUnavailable",value:function(e){var t=e.getAttribute("from"),n=this.rooms[l.Strophe.getBareJidFromJid(t)];return!n||(n.onPresenceUnavailable(e,t),!0)}},{key:"onPresenceError",value:function(e){var t=e.getAttribute("from"),n=this.rooms[l.Strophe.getBareJidFromJid(t)];return!n||(n.onPresenceError(e,t),!0)}},{key:"onMessage",value:function(e){var t=e.getAttribute("from"),n=this.rooms[l.Strophe.getBareJidFromJid(t)];return!n||(n.onMessage(e,t),!0)}},{key:"onMute",value:function(e){var t=e.getAttribute("from"),n=this.rooms[l.Strophe.getBareJidFromJid(t)];return!n||(n.onMute(e),!0)}},{key:"onMuteVideo",value:function(e){var t=e.getAttribute("from"),n=this.rooms[l.Strophe.getBareJidFromJid(t)];return!n||(n.onMuteVideo(e),!0)}}]),n}(f.a)}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return A}));var i=n(6),r=n(8),a=n(31),o=n(36),s=n(35),c=n(18),u=n(105),l=n.n(u),d=n(13),h=n(214),p=n(19),f=n(9),m=n.n(f),v=n(43),g=n.n(v),b=n(72),y=n(357),E=n(358),S=n(129),O=n(359),_=Object(c.getLogger)(e),C={packet2JSON:function(e,t){for(var n=0,i=Array.from(e.children);n<i.length;n++){for(var r=i[n],a={attributes:{},children:[],tagName:r.tagName},o=0,s=Array.from(r.attributes);o<s.length;o++){var c=s[o];a.attributes[c.name]=c.value}var u=d.Strophe.getText(r);u&&(a.value=d.Strophe.xmlunescape(u)),t.push(a),this.packet2JSON(r,a.children)}},json2packet:function(e,t){for(var n=0;n<e.length;n++){var i=e[n];i&&(t.c(i.tagName,i.attributes),i.value&&t.t(i.value),i.children&&this.json2packet(i.children,t),t.up())}}};function T(e,t){for(var n=[],i=0;i<e.length;i++)e[i].tagName===t&&n.push(e[i]);return n}var j=["owner","admin","member"],A=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e,r,o,s,c){var u;return Object(i.a)(this,n),(u=t.call(this)).xmpp=s,u.connection=e,u.roomjid=d.Strophe.getBareJidFromJid(r),u.myroomjid=r,u.password=o,_.info("Joined MUC as ".concat(u.myroomjid)),u.members={},u.presMap={},u.presHandlers={},u._removeConnListeners=[],u.joined=!1,u.role=null,u.focusMucJid=null,u.noBridgeAvailable=!1,u.options=c||{},u.moderator=new O.a(u.roomjid,u.xmpp,u.eventEmitter,{connection:u.xmpp.options,conference:u.options}),("undefined"===typeof u.options.enableLobby||u.options.enableLobby)&&(u.lobby=new E.a(Object(a.a)(u))),u.avModeration=new y.a(Object(a.a)(u)),u.initPresenceMap(c),u.lastPresences={},u.phoneNumber=null,u.phonePin=null,u.connectionTimes={},u.participantPropertyListener=null,u.locked=!1,u.transcriptionStatus=h.OFF,u}return Object(r.a)(n,[{key:"initPresenceMap",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.presMap.to=this.myroomjid,this.presMap.xns="http://jabber.org/protocol/muc",this.presMap.nodes=[],e.statsId&&this.presMap.nodes.push({tagName:"stats-id",value:e.statsId}),e.deploymentInfo&&e.deploymentInfo.userRegion&&this.presMap.nodes.push({tagName:"region",attributes:{id:e.deploymentInfo.userRegion,xmlns:"http://jitsi.org/jitsi-meet"}}),this.presenceUpdateTime=Date.now()}},{key:"join",value:function(e){var t=this;return this.password=e,new Promise((function(e){t.options.disableFocus&&_.info("Conference focus disabled for ".concat(t.roomjid)),(t.options.disableFocus?Promise.resolve():t.moderator.allocateConferenceFocus()).then((function(){t.sendPresence(!0),t._removeConnListeners.push(t.connection.addEventListener(S.a.Events.CONN_STATUS_CHANGED,t.onConnStatusChanged.bind(t))),e()}))}))}},{key:"sendPresence",value:function(e){var t=this.presMap.to;if(this.connection&&this.connection.connected&&t&&(this.joined||e)){var n=Object(d.$pres)({to:t});e&&(n.c("x",{xmlns:this.presMap.xns}),this.password&&n.c("password").t(this.password).up(),this.options.billingId&&n.c("billingid").t(this.options.billingId).up(),n.up()),C.json2packet(this.presMap.nodes,n),this.presenceSyncTime=Date.now(),this.connection.send(n),e&&this.connection.flush()}}},{key:"doLeave",value:function(){_.log("do leave",this.myroomjid);var e=Object(d.$pres)({to:this.myroomjid,type:"unavailable"});this.presMap.length=0,!this.connection.isUsingWebSocket&&this.connection.flush(),this.connection.send(e),this.connection.flush()}},{key:"discoRoomInfo",value:function(){var e=this,t=Object(d.$iq)({type:"get",to:this.roomjid}).c("query",{xmlns:d.Strophe.NS.DISCO_INFO});this.connection.sendIQ(t,(function(t){var n=1===$(t).find('>query>feature[var="muc_passwordprotected"]').length;n!==e.locked&&(e.eventEmitter.emit(m.a.MUC_LOCK_CHANGED,n),e.locked=n);var i=$(t).find('>query>x[type="result"]>field[var="muc#roominfo_meetingId"]>value');i.length?e.setMeetingId(i.text()):_.warn("No meeting ID from backend");var r=1===$(t).find('>query>feature[var="muc_membersonly"]').length,a=$(t).find('>query>x[type="result"]>field[var="muc#roominfo_lobbyroom"]>value');e.lobby&&e.lobby.setLobbyRoomJid(a&&a.length?a.text():void 0),r!==e.membersOnlyEnabled&&(e.membersOnlyEnabled=r,e.eventEmitter.emit(m.a.MUC_MEMBERS_ONLY_CHANGED,r))}),(function(e){g.a.callErrorHandler(e),_.error("Error getting room info: ",e)}))}},{key:"setMeetingId",value:function(e){this.meetingId!==e&&(this.meetingId&&_.warn("Meeting Id changed from:".concat(this.meetingId," to:").concat(e)),this.meetingId=e,this.eventEmitter.emit(m.a.MEETING_ID_SET,e))}},{key:"createNonAnonymousRoom",value:function(){var e=this;if(!this.options.disableDiscoInfo){var t=Object(d.$iq)({type:"get",to:this.roomjid}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}).c("x",{xmlns:"jabber:x:data",type:"submit"});this.connection.sendIQ(t,(function(t){if(!$(t).find('>query>x[xmlns="jabber:x:data"]>field[var="muc#roomconfig_whois"]').length){var n="non-anonymous rooms not supported";return g.a.callErrorHandler(new Error(n)),void _.error(n)}var i=Object(d.$iq)({to:e.roomjid,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"});i.c("x",{xmlns:"jabber:x:data",type:"submit"}),i.c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up(),i.c("field",{var:"muc#roomconfig_whois"}).c("value").t("anyone").up().up(),e.connection.sendIQ(i)}),(function(e){g.a.callErrorHandler(e),_.error("Error getting room configuration form: ",e)}))}}},{key:"onConnStatusChanged",value:function(e){e===S.a.Status.CONNECTED&&this.sendPresence()}},{key:"onPresence",value:function(e){var t=e.getAttribute("from"),n={},i=e.getElementsByTagName("status")[0];i&&(n.status=i.textContent||"");var r=!1,a=!1,o=e.getElementsByTagNameNS("http://jabber.org/protocol/muc#user","x")[0],s=o&&o.getElementsByTagName("item")[0];n.affiliation=s&&s.getAttribute("affiliation"),n.role=s&&s.getAttribute("role");var c=s&&s.getAttribute("jid");n.jid=c,n.isFocus=c&&0===c.indexOf("".concat(this.moderator.getFocusUserJid(),"/")),n.isHiddenDomain=c&&c.indexOf("@")>0&&this.options.hiddenDomain===c.substring(c.indexOf("@")+1,c.indexOf("/")),this.eventEmitter.emit(m.a.PRESENCE_RECEIVED,{fromHiddenDomain:n.isHiddenDomain,presence:e});var u=e.querySelector("x");u&&u.remove();var h=[];C.packet2JSON(e,h),this.lastPresences[t]=h;for(var p=function(e){var t={},n=e.children.find((function(e){return"user"===e.tagName}));if(n){t.user={};for(var i=function(){var e=a[r],i=n.children.find((function(t){return t.tagName===e}));i&&(t.user[e]=i.value)},r=0,a=["id","name","avatar"];r<a.length;r++)i()}var o=e.children.find((function(e){return"group"===e.tagName}));return o&&(t.group=o.value),t},f=0;f<h.length;f++){var v=h[f];switch(v.tagName){case"bot":var g=v.attributes;if(!g)break;var b=g.type;n.botType=b;break;case"nick":n.nick=v.value;break;case"userId":n.id=v.value;break;case"stats-id":n.statsID=v.value;break;case"identity":n.identity=p(v);break;case"features":n.features=this._extractFeatures(v);break;case"stat":var y=v.attributes;if(!y)break;"version"===y.name&&(n.version=y.value)}}if(t===this.myroomjid){var E="owner"===n.affiliation?n.role:"none";if(this.role!==E&&(this.role=E,this.eventEmitter.emit(m.a.LOCAL_ROLE_CHANGED,this.role)),!this.joined){this.joined=!0;var S=this.connectionTimes["muc.joined"]=window.performance.now();_.log("(TIME) MUC joined:\t",S),this.password&&(this.locked=!0),this.presenceUpdateTime>=this.presenceSyncTime&&this.sendPresence(),this.eventEmitter.emit(m.a.MUC_JOINED),!this.options.disableDiscoInfo&&this.discoRoomInfo()}}else if(void 0===c)_.info("Ignoring member with undefined JID");else if(void 0===this.members[t])this.members[t]=n,_.log("entered",t,n),r=void 0!==n.status,a=void 0!==n.version,n.isFocus?this._initFocus(t,n.features):(this.eventEmitter.emit(m.a.MUC_MEMBER_JOINED,t,n.nick,n.role,n.isHiddenDomain,n.statsID,n.status,n.identity,n.botType,n.jid,n.features),r=!1);else{var O=this.members[t];O.role!==n.role&&(O.role=n.role,this.eventEmitter.emit(m.a.MUC_ROLE_CHANGED,t,n.role)),O.affiliation!==n.affiliation&&(O.affiliation=n.affiliation),O.botType!==n.botType&&(O.botType=n.botType,this.eventEmitter.emit(m.a.MUC_MEMBER_BOT_TYPE_CHANGED,t,n.botType)),n.isFocus&&(O.isFocus=!0,this._initFocus(t,n.features)),n.displayName&&(O.displayName=n.displayName),O.status!==n.status&&(r=!0,O.status=n.status),O.version!==n.version&&(a=!0,O.version=n.version),l()(O.features,n.features)||(O.features=n.features,this.eventEmitter.emit(m.a.PARTICIPANT_FEATURES_CHANGED,t,n.features))}for(var T=0;T<h.length;T++){var j=h[T];switch(j.tagName){case"nick":if(!n.isFocus){var A=this.xmpp.options.displayJids?d.Strophe.getResourceFromJid(t):n.nick;this.eventEmitter.emit(m.a.DISPLAY_NAME_CHANGED,t,A)}break;case"bridgeNotAvailable":n.isFocus&&!this.noBridgeAvailable&&(this.noBridgeAvailable=!0,this.eventEmitter.emit(m.a.BRIDGE_DOWN));break;case"conference-properties":if(n.isFocus){for(var k={},R=0;R<j.children.length;R++){var I=j.children[R].attributes;I&&I.key&&(k[I.key]=I.value)}this.eventEmitter.emit(m.a.CONFERENCE_PROPERTIES_CHANGED,k),this.restartByTerminateSupported="true"===k["support-terminate-restart"],_.info("Jicofo supports restart by terminate: ".concat(this.supportsRestartByTerminate()))}break;case"transcription-status":var P=j.attributes;if(!P)break;var w=P.status;w&&w!==this.transcriptionStatus&&(this.transcriptionStatus=w,this.eventEmitter.emit(m.a.TRANSCRIPTION_STATUS_CHANGED,w));break;case"call-control":var N=j.attributes;if(!N)break;this.phoneNumber=N.phone||null,this.phonePin=N.pin||null,this.eventEmitter.emit(m.a.PHONE_NUMBER_CHANGED);break;default:this.processNode(j,t)}}r&&this.eventEmitter.emit(m.a.PRESENCE_STATUS,t,n.status),a&&_.info("Received version for ".concat(c,": ").concat(n.version))}},{key:"_extractFeatures",value:function(e){for(var t=new Set,n=0;n<e.children.length;n++){var i=e.children[n].attributes;i&&i.var&&t.add(i.var)}return t}},{key:"_initFocus",value:function(e,t){this.focusMucJid=e,this.focusFeatures=t}},{key:"setParticipantPropertyListener",value:function(e){this.participantPropertyListener=e}},{key:"supportsRestartByTerminate",value:function(){return this.restartByTerminateSupported}},{key:"processNode",value:function(e,t){try{var n=this.presHandlers[e.tagName];e.tagName.startsWith("jitsi_participant_")&&(n=[this.participantPropertyListener]),n&&n.forEach((function(n){n(e,d.Strophe.getResourceFromJid(t),t)}))}catch(i){g.a.callErrorHandler(i),_.error("Error processing:".concat(e.tagName," node."),i)}}},{key:"sendMessage",value:function(e,t){var n=Object(d.$msg)({to:this.roomjid,type:"groupchat"});"body"===t?n.c(t,{},e):n.c(t,{xmlns:"http://jitsi.org/jitmeet"},e),this.connection.send(n),this.eventEmitter.emit(m.a.SENDING_CHAT_MESSAGE,e)}},{key:"sendPrivateMessage",value:function(e,t,n){var i=Object(d.$msg)({to:"".concat(this.roomjid,"/").concat(e),type:"chat"});"body"===n?i.c(n,t).up():i.c(n,{xmlns:"http://jitsi.org/jitmeet"},t).up(),this.connection.send(i),this.eventEmitter.emit(m.a.SENDING_PRIVATE_CHAT_MESSAGE,t)}},{key:"setSubject",value:function(e){var t=Object(d.$msg)({to:this.roomjid,type:"groupchat"});t.c("subject",e),this.connection.send(t)}},{key:"onParticipantLeft",value:function(e,t){delete this.lastPresences[e],t||(this.eventEmitter.emit(m.a.MUC_MEMBER_LEFT,e),this.moderator.onMucMemberLeft(e))}},{key:"onPresenceUnavailable",value:function(e,t){var n=this;if($(e).find('>ignore[xmlns="http://jitsi.org/jitmeet/"]').length)return!0;var i=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>destroy');if(i.length){var r,a=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>destroy>reason');return a.length&&(r=a.text()),this.eventEmitter.emit(m.a.MUC_DESTROYED,r,i.attr("jid")),this.connection.emuc.doLeave(this.roomjid),!0}var o=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>status[code="110"]').length,s=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>status[code="307"]').length,c=Object.keys(this.members);if(s){var u,l,h=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>item>actor');h.length&&(u=h.attr("nick"));var p=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>item>reason');p.length&&(l=p.text()),this.eventEmitter.emit(m.a.KICKED,o,u,d.Strophe.getResourceFromJid(t),l)}o?(c.forEach((function(e){var t=n.members[e];delete n.members[e],n.onParticipantLeft(e,t.isFocus)})),this.connection.emuc.doLeave(this.roomjid),s||this.eventEmitter.emit(m.a.MUC_LEFT)):(delete this.members[t],this.onParticipantLeft(t,!1))}},{key:"onMessage",value:function(e,t){var n=e.getAttribute("type");if("error"===n){var i=$(e).find(">error>text").text();return this.eventEmitter.emit(m.a.CHAT_ERROR_RECEIVED,i),!0}var r=$(e).find(">body").text(),a=$(e).find(">subject");if(a.length){var o=a.text();(o||""===o)&&(this.eventEmitter.emit(m.a.SUBJECT_CHANGED,o),_.log("Subject is changed to ".concat(o)))}var s,c=$(e).find(">delay").attr("stamp");if(!c&&(c=$(e).find('>[xmlns="jabber:x:delay"]').attr("stamp"))){var u=c.match(/(\d{4})(\d{2})(\d{2}T\d{2}:\d{2}:\d{2})/);c="".concat(u[1],"-").concat(u[2],"-").concat(u[3],"Z")}if(t===this.roomjid)if($(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>status[code="104"]').length)this.discoRoomInfo();else if((s=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>invite'))&&s.length){var l,d=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>password');d&&d.length&&(l=d.text()),this.eventEmitter.emit(m.a.INVITE_MESSAGE_RECEIVED,t,s.attr("from"),r,l)}var h=$(e).find(">json-message").text();if(h){var p=this.xmpp.tryParseJSONAndVerify(h);if(p&&void 0===c)return void this.eventEmitter.emit(m.a.JSON_MESSAGE_RECEIVED,t,p)}r&&("chat"===n?this.eventEmitter.emit(m.a.PRIVATE_MESSAGE_RECEIVED,t,r,this.myroomjid,c):"groupchat"===n&&this.eventEmitter.emit(m.a.MESSAGE_RECEIVED,t,r,this.myroomjid,c))}},{key:"onPresenceError",value:function(e,t){if($(e).find('>error[type="auth"]>not-authorized[xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"]').length)_.log("on password required",t),this.eventEmitter.emit(m.a.PASSWORD_REQUIRED);else if($(e).find('>error[type="cancel"]>not-allowed[xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"]').length){d.Strophe.getDomainFromJid(e.getAttribute("to"))===this.xmpp.options.hosts.anonymousdomain?this.eventEmitter.emit(m.a.ROOM_JOIN_ERROR):(_.warn("onPresError ",e),this.eventEmitter.emit(m.a.ROOM_CONNECT_NOT_ALLOWED_ERROR))}else if($(e).find(">error>service-unavailable").length)_.warn("Maximum users limit for the room has been reached",e),this.eventEmitter.emit(m.a.ROOM_MAX_USERS_ERROR);else if($(e).find('>error[type="auth"]>registration-required[xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"]').length){var n,i=$(e).find(">lobbyroom");i.length&&(n=i.text()),this.eventEmitter.emit(m.a.ROOM_CONNECT_MEMBERS_ONLY_ERROR,n)}else _.warn("onPresError ",e),this.eventEmitter.emit(m.a.ROOM_CONNECT_ERROR)}},{key:"setAffiliation",value:function(e,t){var n=Object(d.$iq)({to:this.roomjid,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{affiliation:t,nick:d.Strophe.getResourceFromJid(e)}).c("reason").t("Your affiliation has been changed to '".concat(t,"'.")).up().up().up();this.connection.sendIQ(n,(function(n){return _.log("Set affiliation of participant with jid: ",e,"to",t,n)}),(function(e){return _.log("Set affiliation of participant error: ",e)}))}},{key:"kick",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"You have been kicked.",n=Object(d.$iq)({to:this.roomjid,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{nick:d.Strophe.getResourceFromJid(e),role:"none"}).c("reason").t(t).up().up().up();this.connection.sendIQ(n,(function(t){return _.log("Kick participant with jid: ",e,t)}),(function(e){return _.log("Kick participant error: ",e)}))}},{key:"lockRoom",value:function(e,t,n,i){var r=this;this.connection.sendIQ(Object(d.$iq)({to:this.roomjid,type:"get"}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}),(function(a){if($(a).find('>query>x[xmlns="jabber:x:data"]>field[var="muc#roomconfig_roomsecret"]').length){var o=Object(d.$iq)({to:r.roomjid,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"});o.c("x",{xmlns:"jabber:x:data",type:"submit"}),o.c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up(),o.c("field",{var:"muc#roomconfig_roomsecret"}).c("value").t(e).up().up(),o.c("field",{var:"muc#roomconfig_passwordprotectedroom"}).c("value").t(null===e||0===e.length?"0":"1").up().up(),r.membersOnlyEnabled&&o.c("field",{var:"muc#roomconfig_membersonly"}).c("value").t("true").up().up(),o.c("field",{var:"muc#roomconfig_whois"}).c("value").t("anyone").up().up(),r.connection.sendIQ(o,(function(){r.password=e,t()}),n)}else i()}),n)}},{key:"setMembersOnly",value:function(e,t,n){var i=this;e&&Object.values(this.members).filter((function(e){return!e.isFocus})).length&&Object.values(this.members).forEach((function(e){e.jid&&!j.includes(e.affiliation)&&i.xmpp.connection.sendIQ(Object(d.$iq)({to:i.roomjid,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{affiliation:"member",jid:e.jid}).up().up())}));var r=n||function(){};this.xmpp.connection.sendIQ(Object(d.$iq)({to:this.roomjid,type:"get"}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}),(function(n){if($(n).find('>query>x[xmlns="jabber:x:data"]>field[var="muc#roomconfig_membersonly"]').length){var a=Object(d.$iq)({to:i.roomjid,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"});a.c("x",{xmlns:"jabber:x:data",type:"submit"}),a.c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up(),a.c("field",{var:"muc#roomconfig_membersonly"}).c("value").t(e?"true":"false").up().up(),i.locked&&a.c("field",{var:"muc#roomconfig_passwordprotectedroom"}).c("value").t("1").up().up(),i.xmpp.connection.sendIQ(a,t,r)}else r(new Error("Setting members only room not supported!"))}),r)}},{key:"addToPresence",value:function(e,t){return this.addOrReplaceInPresence(e,t)}},{key:"addOrReplaceInPresence",value:function(e,t){t.tagName=e;var n=this.presMap.nodes.filter((function(t){return e===t.tagName}));return(1!==n.length||!l()(n[0],t))&&(this.removeFromPresence(e),this.presMap.nodes.push(t),this.presenceUpdateTime=Date.now(),!0)}},{key:"getFromPresence",value:function(e){return this.presMap.nodes.find((function(t){return e===t.tagName}))}},{key:"removeFromPresence",value:function(e){var t=this.presMap.nodes.filter((function(t){return e!==t.tagName}));this.presMap.nodes=t,this.presenceUpdateTime=Date.now()}},{key:"addPresenceListener",value:function(e,t){if("function"!==typeof t)throw new Error('"handler" is not a function');var n=this.presHandlers[e];n||(this.presHandlers[e]=n=[]),-1===n.indexOf(t)?n.push(t):_.warn("Trying to add the same handler more than once for: ".concat(e))}},{key:"removePresenceListener",value:function(e,t){var n=this.presHandlers[e],i=n?n.indexOf(t):-1;-1!==i?n.splice(i,1):_.warn("Handler for: ".concat(e," was not registered"))}},{key:"isFocus",value:function(e){var t=this.members[e];return t?t.isFocus:null}},{key:"isModerator",value:function(){return"moderator"===this.role}},{key:"getMemberRole",value:function(e){return this.members[e]?this.members[e].role:null}},{key:"setVideoMute",value:function(e,t){this.sendVideoInfoPresence(e),t&&t(e)}},{key:"setAudioMute",value:function(e,t){return this.sendAudioInfoPresence(e,t)}},{key:"addAudioInfoToPresence",value:function(e){var t="audiomuted";return!(e&&!this.getFromPresence(t))&&this.addOrReplaceInPresence(t,{value:e.toString()})}},{key:"sendAudioInfoPresence",value:function(e,t){this.addAudioInfoToPresence(e)&&this.sendPresence(),t&&t()}},{key:"addVideoInfoToPresence",value:function(e){var t="videomuted";return!(e&&!this.getFromPresence(t))&&this.addOrReplaceInPresence(t,{value:e.toString()})}},{key:"sendVideoInfoPresence",value:function(e){this.addVideoInfoToPresence(e)&&this.sendPresence()}},{key:"getMediaPresenceInfo",value:function(e,t){var n=this.lastPresences["".concat(this.roomjid,"/").concat(e)];if(!n)return null;var i={muted:!0,videoType:void 0},r=null;if(t===p.a)r=T(n,"audiomuted");else{if(t!==p.c)return _.error("Unsupported media type: ".concat(t)),null;r=T(n,"videomuted");var a=T(n,"jitsi_participant_codecType"),o=T(n,"videoType");o.length>0&&(i.videoType=o[0].value),a.length>0&&(i.codecType=a[0].value)}return r.length>0&&(i.muted="true"===r[0].value),i}},{key:"isSIPCallingSupported",value:function(){return!!this.moderator&&this.moderator.isSipGatewayEnabled()}},{key:"dial",value:function(e){return this.connection.rayo.dial(e,"fromnumber",d.Strophe.getBareJidFromJid(this.myroomjid),this.password,this.focusMucJid)}},{key:"hangup",value:function(){return this.connection.rayo.hangup()}},{key:"getLobby",value:function(){return this.lobby}},{key:"getAVModeration",value:function(){return this.avModeration}},{key:"getPhoneNumber",value:function(){return this.phoneNumber}},{key:"getPhonePin",value:function(){return this.phonePin}},{key:"getMeetingId",value:function(){return this.meetingId}},{key:"muteParticipant",value:function(e,t,n){_.info("set mute",t);var i=Object(d.$iq)({to:this.focusMucJid,type:"set"}).c("mute",{xmlns:"http://jitsi.org/jitmeet/".concat(n),jid:e}).t(t.toString()).up();this.connection.sendIQ(i,(function(e){return _.log("set mute",e)}),(function(e){return _.log("set mute error",e)}))}},{key:"onMute",value:function(e){if(e.getAttribute("from")===this.focusMucJid){var t=$(e).find("mute");t.length&&"true"===t.text()?this.eventEmitter.emit(m.a.AUDIO_MUTED_BY_FOCUS,t.attr("actor")):_.warn("Ignoring a mute request which does not explicitly specify a positive mute command.")}else _.warn("Ignored mute from non focus peer")}},{key:"onMuteVideo",value:function(e){if(e.getAttribute("from")===this.focusMucJid){var t=$(e).find("mute");t.length&&"true"===t.text()?this.eventEmitter.emit(m.a.VIDEO_MUTED_BY_FOCUS,t.attr("actor")):_.warn("Ignoring a mute request which does not explicitly specify a positive mute command.")}else _.warn("Ignored mute from non focus peer")}},{key:"clean",value:function(){this._removeConnListeners.forEach((function(e){return e()})),this._removeConnListeners=[],this.joined=!1}},{key:"leave",value:function(){var e=this;return new Promise((function(t,n){var i=setTimeout((function(){return a(!0)}),5e3),r=e.eventEmitter;function a(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];r.removeListener(m.a.MUC_LEFT,a),clearTimeout(i),e?n(new Error("The timeout for the confirmation about leaving the room expired.")):t()}e.clean(),r.on(m.a.MUC_LEFT,a),e.doLeave()}))}}]),n}(b.a)}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return h}));var i=n(53),r=n(6),a=n(8),o=n(18),s=n(13),c=n(19),u=n(9),l=n.n(u),d=Object(o.getLogger)(e),h=function(){function e(t){var n;Object(r.a)(this,e),this._xmpp=t.xmpp,this._mainRoom=t,this._momderationEnabledByType=(n={},Object(i.a)(n,c.a,!1),Object(i.a)(n,c.c,!1),n),this._whitelistAudio=[],this._whitelistVideo=[],this._xmpp.addListener(l.a.AV_MODERATION_RECEIVED,this._onMessage.bind(this))}return Object(a.a)(e,[{key:"isSupported",value:function(){return Boolean(this._xmpp.avModerationComponentAddress)}},{key:"enable",value:function(e,t){if(this.isSupported()&&this._mainRoom.isModerator())if(e!==this._momderationEnabledByType[t]){var n=Object(s.$msg)({to:this._xmpp.avModerationComponentAddress});n.c("av_moderation",{enable:e,mediaType:t}).up(),this._xmpp.connection.send(n)}else d.warn("Moderation already in state:".concat(e," for mediaType:").concat(t));else d.error("Cannot enable:".concat(e," AV moderation supported:").concat(this.isSupported(),", \n                moderator:").concat(this._mainRoom.isModerator()))}},{key:"approve",value:function(e,t){if(this.isSupported()&&this._mainRoom.isModerator()){var n=Object(s.$msg)({to:this._xmpp.avModerationComponentAddress});n.c("av_moderation",{mediaType:e,jidToWhitelist:t}).up(),this._xmpp.connection.send(n)}else d.error("Cannot approve in AV moderation supported:".concat(this.isSupported(),", \n                moderator:").concat(this._mainRoom.isModerator()))}},{key:"_onMessage",value:function(e){var t=this,n=e.whitelists;if(n){var i=function(e,n,i){i.filter((function(e){return!n.includes(e)})).forEach((function(n){return t._xmpp.eventEmitter.emit(l.a.AV_MODERATION_PARTICIPANT_APPROVED,e,n)}))};n[c.a]&&i(c.a,this._whitelistAudio,n[c.a]),n[c.c]&&i(c.c,this._whitelistVideo,n[c.c])}else void 0!==e.enabled&&this._momderationEnabledByType[e.mediaType]!==e.enabled?(this._momderationEnabledByType[e.mediaType]=e.enabled,this._xmpp.eventEmitter.emit(l.a.AV_MODERATION_CHANGED,e.enabled,e.mediaType,e.actor)):e.approved&&this._xmpp.eventEmitter.emit(l.a.AV_MODERATION_APPROVED,e.mediaType)}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return d}));var i=n(6),r=n(8),a=n(18),o=n(13),s=n(9),c=n.n(s),u=Object(a.getLogger)(e),l="email",d=function(){function e(t){var n=this;Object(i.a)(this,e),this.xmpp=t.xmpp,this.mainRoom=t;var r=this._maybeJoinLobbyRoom.bind(this);this.mainRoom.addEventListener(c.a.LOCAL_ROLE_CHANGED,r),this.mainRoom.addEventListener(c.a.MUC_MEMBERS_ONLY_CHANGED,r),this.mainRoom.addEventListener(c.a.ROOM_CONNECT_MEMBERS_ONLY_ERROR,(function(e){n.lobbyRoomJid=e}))}return Object(r.a)(e,[{key:"isSupported",value:function(){return this.xmpp.lobbySupported}},{key:"enable",value:function(){var e=this;return this.isSupported()?new Promise((function(t,n){e.mainRoom.setMembersOnly(!0,t,n)})):Promise.reject(new Error("Lobby not supported!"))}},{key:"disable",value:function(){this.isSupported()&&this.mainRoom.isModerator()&&this.lobbyRoom&&this.mainRoom.membersOnlyEnabled&&this.mainRoom.setMembersOnly(!1)}},{key:"_leaveLobbyRoom",value:function(){var e=this;this.lobbyRoom&&this.lobbyRoom.leave().then((function(){e.lobbyRoom=void 0,u.info("Lobby room left!")})).catch((function(){}))}},{key:"setLobbyRoomJid",value:function(e){this.lobbyRoomJid=e}},{key:"_maybeJoinLobbyRoom",value:function(){this.isSupported()&&(this.mainRoom.joined&&this.mainRoom.isModerator()&&this.mainRoom.membersOnlyEnabled&&!this.lobbyRoom&&this.join().then((function(){return u.info("Joined lobby room")})).catch((function(e){return u.error("Failed joining lobby",e)})))}},{key:"join",value:function(e,t){var n=this,i=this.mainRoom.joined&&this.mainRoom.isModerator();if(!this.lobbyRoomJid)return Promise.reject(new Error("Missing lobbyRoomJid, cannot join lobby room."));var r=o.Strophe.getNodeFromJid(this.lobbyRoomJid),a=o.Strophe.getDomainFromJid(this.lobbyRoomJid);return this.lobbyRoom=this.xmpp.createRoom(r,{customDomain:a,disableDiscoInfo:!0,disableFocus:!0,enableLobby:!1}),e&&this.lobbyRoom.addOrReplaceInPresence("nick",{attributes:{xmlns:"http://jabber.org/protocol/nick"},value:e}),i?(this.lobbyRoom.addPresenceListener(l,(function(e,t){n.mainRoom.eventEmitter.emit(c.a.MUC_LOBBY_MEMBER_UPDATED,t,{email:e.value})})),this.lobbyRoom.addEventListener(c.a.MUC_MEMBER_JOINED,(function(e,t,i,r,a,s,u,l,d){Object.values(n.mainRoom.members).find((function(e){return e.jid===d}))||n.mainRoom.eventEmitter.emit(c.a.MUC_LOBBY_MEMBER_JOINED,o.Strophe.getResourceFromJid(e),t,u?u.avatar:void 0)})),this.lobbyRoom.addEventListener(c.a.MUC_MEMBER_LEFT,(function(e){n.mainRoom.eventEmitter.emit(c.a.MUC_LOBBY_MEMBER_LEFT,o.Strophe.getResourceFromJid(e))})),this.lobbyRoom.addEventListener(c.a.MUC_DESTROYED,(function(){Object.keys(n.lobbyRoom.members).forEach((function(e){return n.mainRoom.eventEmitter.emit(c.a.MUC_LOBBY_MEMBER_LEFT,o.Strophe.getResourceFromJid(e))})),n.lobbyRoom.clean(),n.lobbyRoom=void 0,u.info("Lobby room left(destroyed)!")}))):(this.lobbyRoom.addEventListener(c.a.KICKED,(function(e){if(e)return n.mainRoom.eventEmitter.emit(c.a.MUC_DENIED_ACCESS),void n.lobbyRoom.clean()})),this.mainRoom.addEventListener(c.a.INVITE_MESSAGE_RECEIVED,(function(e,t,i,r){u.debug("Received approval to join ".concat(e," ").concat(t," ").concat(i)),e===n.mainRoom.roomjid&&(n.mainRoom.join(r),n._leaveLobbyRoom())})),this.lobbyRoom.addEventListener(c.a.MUC_DESTROYED,(function(e,t){t?n.mainRoom.join():(n.lobbyRoom.clean(),n.mainRoom.eventEmitter.emit(c.a.MUC_DESTROYED,e))})),this.mainRoom.addEventListener(c.a.MUC_JOINED,(function(){n._leaveLobbyRoom()}))),new Promise((function(e,r){n.lobbyRoom.addEventListener(c.a.MUC_JOINED,(function(){e(),t&&!i&&n.lobbyRoom.addOrReplaceInPresence(l,{value:t})&&n.lobbyRoom.sendPresence()})),n.lobbyRoom.addEventListener(c.a.ROOM_JOIN_ERROR,r),n.lobbyRoom.addEventListener(c.a.ROOM_CONNECT_NOT_ALLOWED_ERROR,r),n.lobbyRoom.addEventListener(c.a.ROOM_CONNECT_ERROR,r),n.lobbyRoom.join()}))}},{key:"denyAccess",value:function(e){if(this.isSupported()&&this.mainRoom.isModerator()){var t=Object.keys(this.lobbyRoom.members).find((function(t){return o.Strophe.getResourceFromJid(t)===e}));t?this.lobbyRoom.kick(t):u.error("Not found member for ".concat(e," in lobby room."))}}},{key:"approveAccess",value:function(e){if(this.isSupported()&&this.mainRoom.isModerator()){var t=Object.keys(this.lobbyRoom.members).find((function(t){return o.Strophe.getResourceFromJid(t)===e}));if(t){var n=this.lobbyRoom.members[t].jid,i=Object(o.$msg)({to:this.mainRoom.roomjid}).c("x",{xmlns:"http://jabber.org/protocol/muc#user"}).c("invite",{to:n});this.xmpp.connection.sendIQ(i,(function(){}),(function(e){u.error("Error sending invite for ".concat(n),e)}))}else u.error("Not found member for ".concat(t," in lobby room."))}}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return d}));var i=n(18),r=n(13),a=n(96),o=n(279),s=n(9),c=n(43),u=Object(i.getLogger)(e);function l(e){var t=1;return function(n){if(!n){var i=Math.pow(2,t-1);return t+=1,i*e}t=1}}function d(e,t,n,i){function r(e){if(e.data&&e.data.sessionId){if(e.origin!==window.location.origin)return void u.warn("Ignoring sessionId from different origin: ".concat(e.origin));a.a.sessionId=e.data.sessionId}}this.roomName=e,this.xmppService=t,this.getNextTimeout=l(1e3),this.getNextErrorTimeout=l(1e3),this.externalAuthEnabled=!1,this.options=i,this.sipGatewayEnabled=!1,this.eventEmitter=n,this.connection=this.xmppService.connection,window.addEventListener?window.addEventListener("message",r,!1):window.attachEvent("onmessage",r)}d.prototype.isExternalAuthEnabled=function(){return this.externalAuthEnabled},d.prototype.isSipGatewayEnabled=function(){return this.sipGatewayEnabled},d.prototype.onMucMemberLeft=function(e){u.info("Someone left is it focus ? ".concat(e)),"focus"===r.Strophe.getResourceFromJid(e)&&(u.info("Focus has left the room - leaving conference"),this.eventEmitter.emit(s.FOCUS_LEFT))},d.prototype.setFocusUserJid=function(e){this.focusUserJid||(this.focusUserJid=e,u.info("Focus jid set to:  ".concat(this.focusUserJid)))},d.prototype.getFocusUserJid=function(){return this.focusUserJid},d.prototype.getFocusComponent=function(){var e=this.options.connection.hosts.focus;return e||(e="focus.".concat(this.options.connection.hosts.domain)),e},d.prototype.createConferenceIq=function(){var e,t=Object(r.$iq)({to:this.getFocusComponent(),type:"set"}),n=a.a.sessionId,i=a.a.machineId,o=this.options.conference;switch(u.info("Session ID: ".concat(n," machine UID: ").concat(i)),t.c("conference",{xmlns:"http://jitsi.org/protocol/focus",room:this.roomName,"machine-uid":i}),n&&t.attrs({"session-id":n}),t.c("property",{name:"disableRtx",value:Boolean(o.disableRtx)}).up(),void 0!==o.audioPacketDelay&&t.c("property",{name:"audioPacketDelay",value:o.audioPacketDelay}).up(),o.startBitrate&&t.c("property",{name:"startBitrate",value:o.startBitrate}).up(),o.minBitrate&&t.c("property",{name:"minBitrate",value:o.minBitrate}).up(),o.testing&&o.testing.octo&&"number"===typeof o.testing.octo.probability&&Math.random()<o.testing.octo.probability&&t.c("property",{name:"octo",value:!0}).up(),this.options.conference.openBridgeChannel){case"datachannel":case!0:case void 0:e=!0;break;case"websocket":e=!1}return t.c("property",{name:"openSctp",value:e}).up(),void 0!==this.options.conference.startAudioMuted&&t.c("property",{name:"startAudioMuted",value:this.options.conference.startAudioMuted}).up(),void 0!==this.options.conference.startVideoMuted&&t.c("property",{name:"startVideoMuted",value:this.options.conference.startVideoMuted}).up(),t.up(),t},d.prototype.parseSessionId=function(e){var t=$(e).find("conference").attr("session-id");t&&(u.info("Received sessionId:  ".concat(t)),a.a.sessionId=t)},d.prototype.parseConfigOptions=function(e){this.setFocusUserJid($(e).find("conference").attr("focusjid"));var t=$(e).find(">conference>property[name='authentication'][value='true']").length>0;u.info("Authentication enabled: ".concat(t)),this.externalAuthEnabled=$(e).find(">conference>property[name='externalAuth'][value='true']").length>0,u.info("External authentication enabled: ".concat(this.externalAuthEnabled)),this.externalAuthEnabled||this.parseSessionId(e);var n=$(e).find(">conference").attr("identity");this.eventEmitter.emit(o.IDENTITY_UPDATED,t,n),$(e).find(">conference>property[name='sipGatewayEnabled'][value='true']").length&&(this.sipGatewayEnabled=!0),u.info("Sip gateway enabled:  ".concat(this.sipGatewayEnabled))},d.prototype.allocateConferenceFocus=function(){var e=this;return new Promise((function(t){e.setFocusUserJid(e.options.connection.focusUserJid),e.connection.sendIQ(e.createConferenceIq(),(function(n){return e._allocateConferenceFocusSuccess(n,t)}),(function(n){return e._allocateConferenceFocusError(n,t)})),e.connection.flush()}))},d.prototype._allocateConferenceFocusError=function(e,t){var n=this,i=$(e).find(">error>session-invalid").length||$(e).find(">error>not-acceptable").length;if(i&&(u.info("Session expired! - removing"),a.a.sessionId=void 0),$(e).find(">error>graceful-shutdown").length)this.eventEmitter.emit(s.GRACEFUL_SHUTDOWN);else{var o=$(e).find(">error>reservation-error");if(o.length){var l,d=o.attr("error-code"),h=$(e).find(">error>text");return h&&(l=h.text()),void this.eventEmitter.emit(s.RESERVATION_ERROR,d,l)}if($(e).find(">error>not-authorized").length)return u.warn("Unauthorized to start the conference",e),r.Strophe.getDomainFromJid(e.getAttribute("to"))!==this.options.connection.hosts.anonymousdomain&&(this.externalAuthEnabled=!0),void this.eventEmitter.emit(s.AUTHENTICATION_REQUIRED);var p=this.getNextErrorTimeout(),f="Focus error, retry after ".concat(p);c.callErrorHandler(new Error(f)),u.error(f,e);var m=this.getFocusComponent(),v=p/1e3;i||this.eventEmitter.emit(s.FOCUS_DISCONNECTED,m,v),this.getNextTimeout(!0),window.setTimeout((function(){return n.allocateConferenceFocus().then(t)}),p)}},d.prototype._allocateConferenceFocusSuccess=function(e,t){var n=this;if(this.parseConfigOptions(e),this.getNextErrorTimeout(!0),"true"===$(e).find("conference").attr("ready"))this.getNextTimeout(!0),t();else{var i=this.getNextTimeout();u.info("Waiting for the focus... ".concat(i)),window.setTimeout((function(){return n.allocateConferenceFocus().then(t)}),i)}},d.prototype.authenticate=function(){var e=this;return new Promise((function(t,n){e.connection.sendIQ(e.createConferenceIq(),(function(n){e.parseSessionId(n),t()}),(function(e){return n({error:$(e).find("iq>error :first").prop("tagName"),message:$(e).find("iq>error>text").text()})}))}))},d.prototype.getLoginUrl=function(e,t){this._getLoginUrl(!1,e,t)},d.prototype._getLoginUrl=function(e,t,n){var i=Object(r.$iq)({to:this.getFocusComponent(),type:"get"}),o={xmlns:"http://jitsi.org/protocol/focus",room:this.roomName,"machine-uid":a.a.machineId},s="auth url";function l(e,t){c.callErrorHandler(new Error(e)),u.error(e,t),n(t)}e&&(o.popup=!0,s="POPUP ".concat(s)),i.c("login-url",o),this.connection.sendIQ(i,(function(e){var n=$(e).find("login-url").attr("url");(n=decodeURIComponent(n))?(u.info("Got ".concat(s,": ").concat(n)),t(n)):l("Failed to get ".concat(s," from the focus"),e)}),l.bind(void 0,"Get ".concat(s," error")))},d.prototype.getPopupLoginUrl=function(e,t){this._getLoginUrl(!0,e,t)},d.prototype.logout=function(e){var t=Object(r.$iq)({to:this.getFocusComponent(),type:"set"}),n=a.a.sessionId;n?(t.c("logout",{xmlns:"http://jitsi.org/protocol/focus","session-id":n}),this.connection.sendIQ(t,(function(t){var n=$(t).find("logout").attr("logout-url");n&&(n=decodeURIComponent(n)),u.info("Log out OK, url: ".concat(n),t),a.a.sessionId=void 0,e(n)}),(function(e){var t="Logout error";c.callErrorHandler(new Error(t)),u.error(t,e)}))):e()}}).call(this,"/index.js")},function(e,t,n){var i=n(120),r=["Aaliyah","Aaron","Abagail","Abbey","Abbie","Abbigail","Abby","Abdiel","Abdul","Abdullah","Abe","Abel","Abelardo","Abigail","Abigale","Abigayle","Abner","Abraham","Ada","Adah","Adalberto","Adaline","Adam","Adan","Addie","Addison","Adela","Adelbert","Adele","Adelia","Adeline","Adell","Adella","Adelle","Aditya","Adolf","Adolfo","Adolph","Adolphus","Adonis","Adrain","Adrian","Adriana","Adrianna","Adriel","Adrien","Adrienne","Afton","Aglae","Agnes","Agustin","Agustina","Ahmad","Ahmed","Aida","Aidan","Aiden","Aileen","Aisha","Aiyana","Akeem","Al","Alaina","Alan","Alana","Alanis","Alanna","Alayna","Alba","Albert","Alberta","Albertha","Alberto","Albin","Albina","Alda","Alden","Alec","Aleen","Alejandra","Alejandrin","Alek","Alena","Alene","Alessandra","Alessandro","Alessia","Aletha","Alex","Alexa","Alexander","Alexandra","Alexandre","Alexandrea","Alexandria","Alexandrine","Alexandro","Alexane","Alexanne","Alexie","Alexis","Alexys","Alexzander","Alf","Alfonso","Alfonzo","Alford","Alfred","Alfreda","Alfredo","Ali","Alia","Alice","Alicia","Alisa","Alisha","Alison","Alivia","Aliya","Aliyah","Aliza","Alize","Allan","Allen","Allene","Allie","Allison","Ally","Alphonso","Alta","Althea","Alva","Alvah","Alvena","Alvera","Alverta","Alvina","Alvis","Alyce","Alycia","Alysa","Alysha","Alyson","Alysson","Amalia","Amanda","Amani","Amara","Amari","Amaya","Amber","Ambrose","Amelia","Amelie","Amely","America","Americo","Amie","Amina","Amir","Amira","Amiya","Amos","Amparo","Amy","Amya","Ana","Anabel","Anabelle","Anahi","Anais","Anastacio","Anastasia","Anderson","Andre","Andreane","Andreanne","Andres","Andrew","Andy","Angel","Angela","Angelica","Angelina","Angeline","Angelita","Angelo","Angie","Angus","Anibal","Anika","Anissa","Anita","Aniya","Aniyah","Anjali","Anna","Annabel","Annabell","Annabelle","Annalise","Annamae","Annamarie","Anne","Annetta","Annette","Annie","Ansel","Ansley","Anthony","Antoinette","Antone","Antonetta","Antonette","Antonia","Antonietta","Antonina","Antonio","Antwan","Antwon","Anya","April","Ara","Araceli","Aracely","Arch","Archibald","Ardella","Arden","Ardith","Arely","Ari","Ariane","Arianna","Aric","Ariel","Arielle","Arjun","Arlene","Arlie","Arlo","Armand","Armando","Armani","Arnaldo","Arne","Arno","Arnold","Arnoldo","Arnulfo","Aron","Art","Arthur","Arturo","Arvel","Arvid","Arvilla","Aryanna","Asa","Asha","Ashlee","Ashleigh","Ashley","Ashly","Ashlynn","Ashton","Ashtyn","Asia","Assunta","Astrid","Athena","Aubree","Aubrey","Audie","Audra","Audreanne","Audrey","August","Augusta","Augustine","Augustus","Aurelia","Aurelie","Aurelio","Aurore","Austen","Austin","Austyn","Autumn","Ava","Avery","Avis","Axel","Ayana","Ayden","Ayla","Aylin","Baby","Bailee","Bailey","Barbara","Barney","Baron","Barrett","Barry","Bart","Bartholome","Barton","Baylee","Beatrice","Beau","Beaulah","Bell","Bella","Belle","Ben","Benedict","Benjamin","Bennett","Bennie","Benny","Benton","Berenice","Bernadette","Bernadine","Bernard","Bernardo","Berneice","Bernhard","Bernice","Bernie","Berniece","Bernita","Berry","Bert","Berta","Bertha","Bertram","Bertrand","Beryl","Bessie","Beth","Bethany","Bethel","Betsy","Bette","Bettie","Betty","Bettye","Beulah","Beverly","Bianka","Bill","Billie","Billy","Birdie","Blair","Blaise","Blake","Blanca","Blanche","Blaze","Bo","Bobbie","Bobby","Bonita","Bonnie","Boris","Boyd","Brad","Braden","Bradford","Bradley","Bradly","Brady","Braeden","Brain","Brandi","Brando","Brandon","Brandt","Brandy","Brandyn","Brannon","Branson","Brant","Braulio","Braxton","Brayan","Breana","Breanna","Breanne","Brenda","Brendan","Brenden","Brendon","Brenna","Brennan","Brennon","Brent","Bret","Brett","Bria","Brian","Briana","Brianne","Brice","Bridget","Bridgette","Bridie","Brielle","Brigitte","Brionna","Brisa","Britney","Brittany","Brock","Broderick","Brody","Brook","Brooke","Brooklyn","Brooks","Brown","Bruce","Bryana","Bryce","Brycen","Bryon","Buck","Bud","Buddy","Buford","Bulah","Burdette","Burley","Burnice","Buster","Cade","Caden","Caesar","Caitlyn","Cale","Caleb","Caleigh","Cali","Calista","Callie","Camden","Cameron","Camila","Camilla","Camille","Camren","Camron","Camryn","Camylle","Candace","Candelario","Candice","Candida","Candido","Cara","Carey","Carissa","Carlee","Carleton","Carley","Carli","Carlie","Carlo","Carlos","Carlotta","Carmel","Carmela","Carmella","Carmelo","Carmen","Carmine","Carol","Carolanne","Carole","Carolina","Caroline","Carolyn","Carolyne","Carrie","Carroll","Carson","Carter","Cary","Casandra","Casey","Casimer","Casimir","Casper","Cassandra","Cassandre","Cassidy","Cassie","Catalina","Caterina","Catharine","Catherine","Cathrine","Cathryn","Cathy","Cayla","Ceasar","Cecelia","Cecil","Cecile","Cecilia","Cedrick","Celestine","Celestino","Celia","Celine","Cesar","Chad","Chadd","Chadrick","Chaim","Chance","Chandler","Chanel","Chanelle","Charity","Charlene","Charles","Charley","Charlie","Charlotte","Chase","Chasity","Chauncey","Chaya","Chaz","Chelsea","Chelsey","Chelsie","Chesley","Chester","Chet","Cheyanne","Cheyenne","Chloe","Chris","Christ","Christa","Christelle","Christian","Christiana","Christina","Christine","Christop","Christophe","Christopher","Christy","Chyna","Ciara","Cicero","Cielo","Cierra","Cindy","Citlalli","Clair","Claire","Clara","Clarabelle","Clare","Clarissa","Clark","Claud","Claude","Claudia","Claudie","Claudine","Clay","Clemens","Clement","Clementina","Clementine","Clemmie","Cleo","Cleora","Cleta","Cletus","Cleve","Cleveland","Clifford","Clifton","Clint","Clinton","Clotilde","Clovis","Cloyd","Clyde","Coby","Cody","Colby","Cole","Coleman","Colin","Colleen","Collin","Colt","Colten","Colton","Columbus","Concepcion","Conner","Connie","Connor","Conor","Conrad","Constance","Constantin","Consuelo","Cooper","Cora","Coralie","Corbin","Cordelia","Cordell","Cordia","Cordie","Corene","Corine","Cornelius","Cornell","Corrine","Cortez","Cortney","Cory","Coty","Courtney","Coy","Craig","Crawford","Creola","Cristal","Cristian","Cristina","Cristobal","Cristopher","Cruz","Crystal","Crystel","Cullen","Curt","Curtis","Cydney","Cynthia","Cyril","Cyrus","Dagmar","Dahlia","Daija","Daisha","Daisy","Dakota","Dale","Dallas","Dallin","Dalton","Damaris","Dameon","Damian","Damien","Damion","Damon","Dan","Dana","Dandre","Dane","D'angelo","Dangelo","Danial","Daniela","Daniella","Danielle","Danika","Dannie","Danny","Dante","Danyka","Daphne","Daphnee","Daphney","Darby","Daren","Darian","Dariana","Darien","Dario","Darion","Darius","Darlene","Daron","Darrel","Darrell","Darren","Darrick","Darrin","Darrion","Darron","Darryl","Darwin","Daryl","Dashawn","Dasia","Dave","David","Davin","Davion","Davon","Davonte","Dawn","Dawson","Dax","Dayana","Dayna","Dayne","Dayton","Dean","Deangelo","Deanna","Deborah","Declan","Dedric","Dedrick","Dee","Deion","Deja","Dejah","Dejon","Dejuan","Delaney","Delbert","Delfina","Delia","Delilah","Dell","Della","Delmer","Delores","Delpha","Delphia","Delphine","Delta","Demarco","Demarcus","Demario","Demetris","Demetrius","Demond","Dena","Denis","Dennis","Deon","Deondre","Deontae","Deonte","Dereck","Derek","Derick","Deron","Derrick","Deshaun","Deshawn","Desiree","Desmond","Dessie","Destany","Destin","Destinee","Destiney","Destini","Destiny","Devan","Devante","Deven","Devin","Devon","Devonte","Devyn","Dewayne","Dewitt","Dexter","Diamond","Diana","Dianna","Diego","Dillan","Dillon","Dimitri","Dina","Dino","Dion","Dixie","Dock","Dolly","Dolores","Domenic","Domenica","Domenick","Domenico","Domingo","Dominic","Dominique","Don","Donald","Donato","Donavon","Donna","Donnell","Donnie","Donny","Dora","Dorcas","Dorian","Doris","Dorothea","Dorothy","Dorris","Dortha","Dorthy","Doug","Douglas","Dovie","Doyle","Drake","Drew","Duane","Dudley","Dulce","Duncan","Durward","Dustin","Dusty","Dwight","Dylan","Earl","Earlene","Earline","Earnest","Earnestine","Easter","Easton","Ebba","Ebony","Ed","Eda","Edd","Eddie","Eden","Edgar","Edgardo","Edison","Edmond","Edmund","Edna","Eduardo","Edward","Edwardo","Edwin","Edwina","Edyth","Edythe","Effie","Efrain","Efren","Eileen","Einar","Eino","Eladio","Elaina","Elbert","Elda","Eldon","Eldora","Eldred","Eldridge","Eleanora","Eleanore","Eleazar","Electa","Elena","Elenor","Elenora","Eleonore","Elfrieda","Eli","Elian","Eliane","Elias","Eliezer","Elijah","Elinor","Elinore","Elisa","Elisabeth","Elise","Eliseo","Elisha","Elissa","Eliza","Elizabeth","Ella","Ellen","Ellie","Elliot","Elliott","Ellis","Ellsworth","Elmer","Elmira","Elmo","Elmore","Elna","Elnora","Elody","Eloisa","Eloise","Elouise","Eloy","Elroy","Elsa","Else","Elsie","Elta","Elton","Elva","Elvera","Elvie","Elvis","Elwin","Elwyn","Elyse","Elyssa","Elza","Emanuel","Emelia","Emelie","Emely","Emerald","Emerson","Emery","Emie","Emil","Emile","Emilia","Emiliano","Emilie","Emilio","Emily","Emma","Emmalee","Emmanuel","Emmanuelle","Emmet","Emmett","Emmie","Emmitt","Emmy","Emory","Ena","Enid","Enoch","Enola","Enos","Enrico","Enrique","Ephraim","Era","Eriberto","Eric","Erica","Erich","Erick","Ericka","Erik","Erika","Erin","Erling","Erna","Ernest","Ernestina","Ernestine","Ernesto","Ernie","Ervin","Erwin","Eryn","Esmeralda","Esperanza","Esta","Esteban","Estefania","Estel","Estell","Estella","Estelle","Estevan","Esther","Estrella","Etha","Ethan","Ethel","Ethelyn","Ethyl","Ettie","Eudora","Eugene","Eugenia","Eula","Eulah","Eulalia","Euna","Eunice","Eusebio","Eva","Evalyn","Evan","Evangeline","Evans","Eve","Eveline","Evelyn","Everardo","Everett","Everette","Evert","Evie","Ewald","Ewell","Ezekiel","Ezequiel","Ezra","Fabian","Fabiola","Fae","Fannie","Fanny","Fatima","Faustino","Fausto","Favian","Fay","Faye","Federico","Felicia","Felicita","Felicity","Felipa","Felipe","Felix","Felton","Fermin","Fern","Fernando","Ferne","Fidel","Filiberto","Filomena","Finn","Fiona","Flavie","Flavio","Fleta","Fletcher","Flo","Florence","Florencio","Florian","Florida","Florine","Flossie","Floy","Floyd","Ford","Forest","Forrest","Foster","Frances","Francesca","Francesco","Francis","Francisca","Francisco","Franco","Frank","Frankie","Franz","Fred","Freda","Freddie","Freddy","Frederic","Frederick","Frederik","Frederique","Fredrick","Fredy","Freeda","Freeman","Freida","Frida","Frieda","Friedrich","Fritz","Furman","Gabe","Gabriel","Gabriella","Gabrielle","Gaetano","Gage","Gail","Gardner","Garett","Garfield","Garland","Garnet","Garnett","Garret","Garrett","Garrick","Garrison","Garry","Garth","Gaston","Gavin","Gay","Gayle","Gaylord","Gene","General","Genesis","Genevieve","Gennaro","Genoveva","Geo","Geoffrey","George","Georgette","Georgiana","Georgianna","Geovanni","Geovanny","Geovany","Gerald","Geraldine","Gerard","Gerardo","Gerda","Gerhard","Germaine","German","Gerry","Gerson","Gertrude","Gia","Gianni","Gideon","Gilbert","Gilberto","Gilda","Giles","Gillian","Gina","Gino","Giovani","Giovanna","Giovanni","Giovanny","Gisselle","Giuseppe","Gladyce","Gladys","Glen","Glenda","Glenna","Glennie","Gloria","Godfrey","Golda","Golden","Gonzalo","Gordon","Grace","Gracie","Graciela","Grady","Graham","Grant","Granville","Grayce","Grayson","Green","Greg","Gregg","Gregoria","Gregorio","Gregory","Greta","Gretchen","Greyson","Griffin","Grover","Guadalupe","Gudrun","Guido","Guillermo","Guiseppe","Gunnar","Gunner","Gus","Gussie","Gust","Gustave","Guy","Gwen","Gwendolyn","Hadley","Hailee","Hailey","Hailie","Hal","Haleigh","Haley","Halie","Halle","Hallie","Hank","Hanna","Hannah","Hans","Hardy","Harley","Harmon","Harmony","Harold","Harrison","Harry","Harvey","Haskell","Hassan","Hassie","Hattie","Haven","Hayden","Haylee","Hayley","Haylie","Hazel","Hazle","Heath","Heather","Heaven","Heber","Hector","Heidi","Helen","Helena","Helene","Helga","Hellen","Helmer","Heloise","Henderson","Henri","Henriette","Henry","Herbert","Herman","Hermann","Hermina","Herminia","Herminio","Hershel","Herta","Hertha","Hester","Hettie","Hilario","Hilbert","Hilda","Hildegard","Hillard","Hillary","Hilma","Hilton","Hipolito","Hiram","Hobart","Holden","Hollie","Hollis","Holly","Hope","Horace","Horacio","Hortense","Hosea","Houston","Howard","Howell","Hoyt","Hubert","Hudson","Hugh","Hulda","Humberto","Hunter","Hyman","Ian","Ibrahim","Icie","Ida","Idell","Idella","Ignacio","Ignatius","Ike","Ila","Ilene","Iliana","Ima","Imani","Imelda","Immanuel","Imogene","Ines","Irma","Irving","Irwin","Isaac","Isabel","Isabell","Isabella","Isabelle","Isac","Isadore","Isai","Isaiah","Isaias","Isidro","Ismael","Isobel","Isom","Israel","Issac","Itzel","Iva","Ivah","Ivory","Ivy","Izabella","Izaiah","Jabari","Jace","Jacey","Jacinthe","Jacinto","Jack","Jackeline","Jackie","Jacklyn","Jackson","Jacky","Jaclyn","Jacquelyn","Jacques","Jacynthe","Jada","Jade","Jaden","Jadon","Jadyn","Jaeden","Jaida","Jaiden","Jailyn","Jaime","Jairo","Jakayla","Jake","Jakob","Jaleel","Jalen","Jalon","Jalyn","Jamaal","Jamal","Jamar","Jamarcus","Jamel","Jameson","Jamey","Jamie","Jamil","Jamir","Jamison","Jammie","Jan","Jana","Janae","Jane","Janelle","Janessa","Janet","Janice","Janick","Janie","Janis","Janiya","Jannie","Jany","Jaquan","Jaquelin","Jaqueline","Jared","Jaren","Jarod","Jaron","Jarred","Jarrell","Jarret","Jarrett","Jarrod","Jarvis","Jasen","Jasmin","Jason","Jasper","Jaunita","Javier","Javon","Javonte","Jay","Jayce","Jaycee","Jayda","Jayde","Jayden","Jaydon","Jaylan","Jaylen","Jaylin","Jaylon","Jayme","Jayne","Jayson","Jazlyn","Jazmin","Jazmyn","Jazmyne","Jean","Jeanette","Jeanie","Jeanne","Jed","Jedediah","Jedidiah","Jeff","Jefferey","Jeffery","Jeffrey","Jeffry","Jena","Jenifer","Jennie","Jennifer","Jennings","Jennyfer","Jensen","Jerad","Jerald","Jeramie","Jeramy","Jerel","Jeremie","Jeremy","Jermain","Jermaine","Jermey","Jerod","Jerome","Jeromy","Jerrell","Jerrod","Jerrold","Jerry","Jess","Jesse","Jessica","Jessie","Jessika","Jessy","Jessyca","Jesus","Jett","Jettie","Jevon","Jewel","Jewell","Jillian","Jimmie","Jimmy","Jo","Joan","Joana","Joanie","Joanne","Joannie","Joanny","Joany","Joaquin","Jocelyn","Jodie","Jody","Joe","Joel","Joelle","Joesph","Joey","Johan","Johann","Johanna","Johathan","John","Johnathan","Johnathon","Johnnie","Johnny","Johnpaul","Johnson","Jolie","Jon","Jonas","Jonatan","Jonathan","Jonathon","Jordan","Jordane","Jordi","Jordon","Jordy","Jordyn","Jorge","Jose","Josefa","Josefina","Joseph","Josephine","Josh","Joshua","Joshuah","Josiah","Josiane","Josianne","Josie","Josue","Jovan","Jovani","Jovanny","Jovany","Joy","Joyce","Juana","Juanita","Judah","Judd","Jude","Judge","Judson","Judy","Jules","Julia","Julian","Juliana","Julianne","Julie","Julien","Juliet","Julio","Julius","June","Junior","Junius","Justen","Justice","Justina","Justine","Juston","Justus","Justyn","Juvenal","Juwan","Kacey","Kaci","Kacie","Kade","Kaden","Kadin","Kaela","Kaelyn","Kaia","Kailee","Kailey","Kailyn","Kaitlin","Kaitlyn","Kale","Kaleb","Kaleigh","Kaley","Kali","Kallie","Kameron","Kamille","Kamren","Kamron","Kamryn","Kane","Kara","Kareem","Karelle","Karen","Kari","Kariane","Karianne","Karina","Karine","Karl","Karlee","Karley","Karli","Karlie","Karolann","Karson","Kasandra","Kasey","Kassandra","Katarina","Katelin","Katelyn","Katelynn","Katharina","Katherine","Katheryn","Kathleen","Kathlyn","Kathryn","Kathryne","Katlyn","Katlynn","Katrina","Katrine","Kattie","Kavon","Kay","Kaya","Kaycee","Kayden","Kayla","Kaylah","Kaylee","Kayleigh","Kayley","Kayli","Kaylie","Kaylin","Keagan","Keanu","Keara","Keaton","Keegan","Keeley","Keely","Keenan","Keira","Keith","Kellen","Kelley","Kelli","Kellie","Kelly","Kelsi","Kelsie","Kelton","Kelvin","Ken","Kendall","Kendra","Kendrick","Kenna","Kennedi","Kennedy","Kenneth","Kennith","Kenny","Kenton","Kenya","Kenyatta","Kenyon","Keon","Keshaun","Keshawn","Keven","Kevin","Kevon","Keyon","Keyshawn","Khalid","Khalil","Kian","Kiana","Kianna","Kiara","Kiarra","Kiel","Kiera","Kieran","Kiley","Kim","Kimberly","King","Kip","Kira","Kirk","Kirsten","Kirstin","Kitty","Kobe","Koby","Kody","Kolby","Kole","Korbin","Korey","Kory","Kraig","Kris","Krista","Kristian","Kristin","Kristina","Kristofer","Kristoffer","Kristopher","Kristy","Krystal","Krystel","Krystina","Kurt","Kurtis","Kyla","Kyle","Kylee","Kyleigh","Kyler","Kylie","Kyra","Lacey","Lacy","Ladarius","Lafayette","Laila","Laisha","Lamar","Lambert","Lamont","Lance","Landen","Lane","Laney","Larissa","Laron","Larry","Larue","Laura","Laurel","Lauren","Laurence","Lauretta","Lauriane","Laurianne","Laurie","Laurine","Laury","Lauryn","Lavada","Lavern","Laverna","Laverne","Lavina","Lavinia","Lavon","Lavonne","Lawrence","Lawson","Layla","Layne","Lazaro","Lea","Leann","Leanna","Leanne","Leatha","Leda","Lee","Leif","Leila","Leilani","Lela","Lelah","Leland","Lelia","Lempi","Lemuel","Lenna","Lennie","Lenny","Lenora","Lenore","Leo","Leola","Leon","Leonard","Leonardo","Leone","Leonel","Leonie","Leonor","Leonora","Leopold","Leopoldo","Leora","Lera","Lesley","Leslie","Lesly","Lessie","Lester","Leta","Letha","Letitia","Levi","Lew","Lewis","Lexi","Lexie","Lexus","Lia","Liam","Liana","Libbie","Libby","Lila","Lilian","Liliana","Liliane","Lilla","Lillian","Lilliana","Lillie","Lilly","Lily","Lilyan","Lina","Lincoln","Linda","Lindsay","Lindsey","Linnea","Linnie","Linwood","Lionel","Lisa","Lisandro","Lisette","Litzy","Liza","Lizeth","Lizzie","Llewellyn","Lloyd","Logan","Lois","Lola","Lolita","Loma","Lon","London","Lonie","Lonnie","Lonny","Lonzo","Lora","Loraine","Loren","Lorena","Lorenz","Lorenza","Lorenzo","Lori","Lorine","Lorna","Lottie","Lou","Louie","Louisa","Lourdes","Louvenia","Lowell","Loy","Loyal","Loyce","Lucas","Luciano","Lucie","Lucienne","Lucile","Lucinda","Lucio","Lucious","Lucius","Lucy","Ludie","Ludwig","Lue","Luella","Luigi","Luis","Luisa","Lukas","Lula","Lulu","Luna","Lupe","Lura","Lurline","Luther","Luz","Lyda","Lydia","Lyla","Lynn","Lyric","Lysanne","Mabel","Mabelle","Mable","Mac","Macey","Maci","Macie","Mack","Mackenzie","Macy","Madaline","Madalyn","Maddison","Madeline","Madelyn","Madelynn","Madge","Madie","Madilyn","Madisen","Madison","Madisyn","Madonna","Madyson","Mae","Maegan","Maeve","Mafalda","Magali","Magdalen","Magdalena","Maggie","Magnolia","Magnus","Maia","Maida","Maiya","Major","Makayla","Makenna","Makenzie","Malachi","Malcolm","Malika","Malinda","Mallie","Mallory","Malvina","Mandy","Manley","Manuel","Manuela","Mara","Marc","Marcel","Marcelina","Marcelino","Marcella","Marcelle","Marcellus","Marcelo","Marcia","Marco","Marcos","Marcus","Margaret","Margarete","Margarett","Margaretta","Margarette","Margarita","Marge","Margie","Margot","Margret","Marguerite","Maria","Mariah","Mariam","Marian","Mariana","Mariane","Marianna","Marianne","Mariano","Maribel","Marie","Mariela","Marielle","Marietta","Marilie","Marilou","Marilyne","Marina","Mario","Marion","Marisa","Marisol","Maritza","Marjolaine","Marjorie","Marjory","Mark","Markus","Marlee","Marlen","Marlene","Marley","Marlin","Marlon","Marques","Marquis","Marquise","Marshall","Marta","Martin","Martina","Martine","Marty","Marvin","Mary","Maryam","Maryjane","Maryse","Mason","Mateo","Mathew","Mathias","Mathilde","Matilda","Matilde","Matt","Matteo","Mattie","Maud","Maude","Maudie","Maureen","Maurice","Mauricio","Maurine","Maverick","Mavis","Max","Maxie","Maxime","Maximilian","Maximillia","Maximillian","Maximo","Maximus","Maxine","Maxwell","May","Maya","Maybell","Maybelle","Maye","Maymie","Maynard","Mayra","Mazie","Mckayla","Mckenna","Mckenzie","Meagan","Meaghan","Meda","Megane","Meggie","Meghan","Mekhi","Melany","Melba","Melisa","Melissa","Mellie","Melody","Melvin","Melvina","Melyna","Melyssa","Mercedes","Meredith","Merl","Merle","Merlin","Merritt","Mertie","Mervin","Meta","Mia","Micaela","Micah","Michael","Michaela","Michale","Micheal","Michel","Michele","Michelle","Miguel","Mikayla","Mike","Mikel","Milan","Miles","Milford","Miller","Millie","Milo","Milton","Mina","Minerva","Minnie","Miracle","Mireille","Mireya","Misael","Missouri","Misty","Mitchel","Mitchell","Mittie","Modesta","Modesto","Mohamed","Mohammad","Mohammed","Moises","Mollie","Molly","Mona","Monica","Monique","Monroe","Monserrat","Monserrate","Montana","Monte","Monty","Morgan","Moriah","Morris","Mortimer","Morton","Mose","Moses","Moshe","Mossie","Mozell","Mozelle","Muhammad","Muriel","Murl","Murphy","Murray","Mustafa","Mya","Myah","Mylene","Myles","Myra","Myriam","Myrl","Myrna","Myron","Myrtice","Myrtie","Myrtis","Myrtle","Nadia","Nakia","Name","Nannie","Naomi","Naomie","Napoleon","Narciso","Nash","Nasir","Nat","Natalia","Natalie","Natasha","Nathan","Nathanael","Nathanial","Nathaniel","Nathen","Nayeli","Neal","Ned","Nedra","Neha","Neil","Nelda","Nella","Nelle","Nellie","Nels","Nelson","Neoma","Nestor","Nettie","Neva","Newell","Newton","Nia","Nicholas","Nicholaus","Nichole","Nick","Nicklaus","Nickolas","Nico","Nicola","Nicolas","Nicole","Nicolette","Nigel","Nikita","Nikki","Nikko","Niko","Nikolas","Nils","Nina","Noah","Noble","Noe","Noel","Noelia","Noemi","Noemie","Noemy","Nola","Nolan","Nona","Nora","Norbert","Norberto","Norene","Norma","Norris","Norval","Norwood","Nova","Novella","Nya","Nyah","Nyasia","Obie","Oceane","Ocie","Octavia","Oda","Odell","Odessa","Odie","Ofelia","Okey","Ola","Olaf","Ole","Olen","Oleta","Olga","Olin","Oliver","Ollie","Oma","Omari","Omer","Ona","Onie","Opal","Ophelia","Ora","Oral","Oran","Oren","Orie","Orin","Orion","Orland","Orlando","Orlo","Orpha","Orrin","Orval","Orville","Osbaldo","Osborne","Oscar","Osvaldo","Oswald","Oswaldo","Otha","Otho","Otilia","Otis","Ottilie","Ottis","Otto","Ova","Owen","Ozella","Pablo","Paige","Palma","Pamela","Pansy","Paolo","Paris","Parker","Pascale","Pasquale","Pat","Patience","Patricia","Patrick","Patsy","Pattie","Paul","Paula","Pauline","Paxton","Payton","Pearl","Pearlie","Pearline","Pedro","Peggie","Penelope","Percival","Percy","Perry","Pete","Peter","Petra","Peyton","Philip","Phoebe","Phyllis","Pierce","Pierre","Pietro","Pink","Pinkie","Piper","Polly","Porter","Precious","Presley","Preston","Price","Prince","Princess","Priscilla","Providenci","Prudence","Queen","Queenie","Quentin","Quincy","Quinn","Quinten","Quinton","Rachael","Rachel","Rachelle","Rae","Raegan","Rafael","Rafaela","Raheem","Rahsaan","Rahul","Raina","Raleigh","Ralph","Ramiro","Ramon","Ramona","Randal","Randall","Randi","Randy","Ransom","Raoul","Raphael","Raphaelle","Raquel","Rashad","Rashawn","Rasheed","Raul","Raven","Ray","Raymond","Raymundo","Reagan","Reanna","Reba","Rebeca","Rebecca","Rebeka","Rebekah","Reece","Reed","Reese","Regan","Reggie","Reginald","Reid","Reilly","Reina","Reinhold","Remington","Rene","Renee","Ressie","Reta","Retha","Retta","Reuben","Reva","Rex","Rey","Reyes","Reymundo","Reyna","Reynold","Rhea","Rhett","Rhianna","Rhiannon","Rhoda","Ricardo","Richard","Richie","Richmond","Rick","Rickey","Rickie","Ricky","Rico","Rigoberto","Riley","Rita","River","Robb","Robbie","Robert","Roberta","Roberto","Robin","Robyn","Rocio","Rocky","Rod","Roderick","Rodger","Rodolfo","Rodrick","Rodrigo","Roel","Rogelio","Roger","Rogers","Rolando","Rollin","Roma","Romaine","Roman","Ron","Ronaldo","Ronny","Roosevelt","Rory","Rosa","Rosalee","Rosalia","Rosalind","Rosalinda","Rosalyn","Rosamond","Rosanna","Rosario","Roscoe","Rose","Rosella","Roselyn","Rosemarie","Rosemary","Rosendo","Rosetta","Rosie","Rosina","Roslyn","Ross","Rossie","Rowan","Rowena","Rowland","Roxane","Roxanne","Roy","Royal","Royce","Rozella","Ruben","Rubie","Ruby","Rubye","Rudolph","Rudy","Rupert","Russ","Russel","Russell","Rusty","Ruth","Ruthe","Ruthie","Ryan","Ryann","Ryder","Rylan","Rylee","Ryleigh","Ryley","Sabina","Sabrina","Sabryna","Sadie","Sadye","Sage","Saige","Sallie","Sally","Salma","Salvador","Salvatore","Sam","Samanta","Samantha","Samara","Samir","Sammie","Sammy","Samson","Sandra","Sandrine","Sandy","Sanford","Santa","Santiago","Santina","Santino","Santos","Sarah","Sarai","Sarina","Sasha","Saul","Savanah","Savanna","Savannah","Savion","Scarlett","Schuyler","Scot","Scottie","Scotty","Seamus","Sean","Sebastian","Sedrick","Selena","Selina","Selmer","Serena","Serenity","Seth","Shad","Shaina","Shakira","Shana","Shane","Shanel","Shanelle","Shania","Shanie","Shaniya","Shanna","Shannon","Shanny","Shanon","Shany","Sharon","Shaun","Shawn","Shawna","Shaylee","Shayna","Shayne","Shea","Sheila","Sheldon","Shemar","Sheridan","Sherman","Sherwood","Shirley","Shyann","Shyanne","Sibyl","Sid","Sidney","Sienna","Sierra","Sigmund","Sigrid","Sigurd","Silas","Sim","Simeon","Simone","Sincere","Sister","Skye","Skyla","Skylar","Sofia","Soledad","Solon","Sonia","Sonny","Sonya","Sophia","Sophie","Spencer","Stacey","Stacy","Stan","Stanford","Stanley","Stanton","Stefan","Stefanie","Stella","Stephan","Stephania","Stephanie","Stephany","Stephen","Stephon","Sterling","Steve","Stevie","Stewart","Stone","Stuart","Summer","Sunny","Susan","Susana","Susanna","Susie","Suzanne","Sven","Syble","Sydnee","Sydney","Sydni","Sydnie","Sylvan","Sylvester","Sylvia","Tabitha","Tad","Talia","Talon","Tamara","Tamia","Tania","Tanner","Tanya","Tara","Taryn","Tate","Tatum","Tatyana","Taurean","Tavares","Taya","Taylor","Teagan","Ted","Telly","Terence","Teresa","Terrance","Terrell","Terrence","Terrill","Terry","Tess","Tessie","Tevin","Thad","Thaddeus","Thalia","Thea","Thelma","Theo","Theodora","Theodore","Theresa","Therese","Theresia","Theron","Thomas","Thora","Thurman","Tia","Tiana","Tianna","Tiara","Tierra","Tiffany","Tillman","Timmothy","Timmy","Timothy","Tina","Tito","Titus","Tobin","Toby","Tod","Tom","Tomas","Tomasa","Tommie","Toney","Toni","Tony","Torey","Torrance","Torrey","Toy","Trace","Tracey","Tracy","Travis","Travon","Tre","Tremaine","Tremayne","Trent","Trenton","Tressa","Tressie","Treva","Trever","Trevion","Trevor","Trey","Trinity","Trisha","Tristian","Tristin","Triston","Troy","Trudie","Trycia","Trystan","Turner","Twila","Tyler","Tyra","Tyree","Tyreek","Tyrel","Tyrell","Tyrese","Tyrique","Tyshawn","Tyson","Ubaldo","Ulices","Ulises","Una","Unique","Urban","Uriah","Uriel","Ursula","Vada","Valentin","Valentina","Valentine","Valerie","Vallie","Van","Vance","Vanessa","Vaughn","Veda","Velda","Vella","Velma","Velva","Vena","Verda","Verdie","Vergie","Verla","Verlie","Vern","Verna","Verner","Vernice","Vernie","Vernon","Verona","Veronica","Vesta","Vicenta","Vicente","Vickie","Vicky","Victor","Victoria","Vida","Vidal","Vilma","Vince","Vincent","Vincenza","Vincenzo","Vinnie","Viola","Violet","Violette","Virgie","Virgil","Virginia","Virginie","Vita","Vito","Viva","Vivian","Viviane","Vivianne","Vivien","Vivienne","Vladimir","Wade","Waino","Waldo","Walker","Wallace","Walter","Walton","Wanda","Ward","Warren","Watson","Wava","Waylon","Wayne","Webster","Weldon","Wellington","Wendell","Wendy","Werner","Westley","Weston","Whitney","Wilber","Wilbert","Wilburn","Wiley","Wilford","Wilfred","Wilfredo","Wilfrid","Wilhelm","Wilhelmine","Will","Willa","Willard","William","Willie","Willis","Willow","Willy","Wilma","Wilmer","Wilson","Wilton","Winfield","Winifred","Winnifred","Winona","Winston","Woodrow","Wyatt","Wyman","Xander","Xavier","Xzavier","Yadira","Yasmeen","Yasmin","Yasmine","Yazmin","Yesenia","Yessenia","Yolanda","Yoshiko","Yvette","Yvonne","Zachariah","Zachary","Zachery","Zack","Zackary","Zackery","Zakary","Zander","Zane","Zaria","Zechariah","Zelda","Zella","Zelma","Zena","Zetta","Zion","Zita","Zoe","Zoey","Zoie","Zoila","Zola","Zora","Zula"];e.exports={generateUsername:function(){var e=i.randomElement(r),t=i.randomAlphanumStr(3);return"".concat(e,"-").concat(t)}}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return O}));var i=n(6),r=n(8),a=n(103),o=n(85),s=n(36),c=n(35),u=n(18),l=n(13),d=n(32),h=n(9),p=n.n(h),f=n(26),m=n(43),v=n.n(m),g=n(120),b=n.n(g),y=n(121),E=n(183),S=Object(u.getLogger)(e),O=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e,r,a){var o;return Object(i.a)(this,n),(o=t.call(this)).xmpp=e,o.eventEmitter=r,o.sessions={},o.jvbIceConfig=a.jvb,o.p2pIceConfig=a.p2p,o.mediaConstraints={offerToReceiveAudio:!0,offerToReceiveVideo:!0},o}return Object(r.a)(n,[{key:"init",value:function(e){Object(a.a)(Object(o.a)(n.prototype),"init",this).call(this,e),this.connection.addHandler(this.onJingle.bind(this),"urn:xmpp:jingle:1","iq","set",null,null)}},{key:"onJingle",value:function(e){var t=$(e).find("jingle").attr("sid"),n=$(e).find("jingle").attr("action"),i=e.getAttribute("from"),r=Object(l.$iq)({type:"result",to:i,id:e.getAttribute("id")});S.log("on jingle ".concat(n," from ").concat(i),e);var a=this.sessions[t];if("session-initiate"!==n){if(!a)return r.attrs({type:"error"}),r.c("error",{type:"cancel"}).c("item-not-found",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("unknown-session",{xmlns:"urn:xmpp:jingle:errors:1"}),S.warn("invalid session id",e),this.connection.send(r),!0;if(i!==a.remoteJid)return S.warn("jid mismatch for session id",t,a.remoteJid,e),r.attrs({type:"error"}),r.c("error",{type:"cancel"}).c("item-not-found",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("unknown-session",{xmlns:"urn:xmpp:jingle:errors:1"}),this.connection.send(r),!0}else if(void 0!==a)return r.attrs({type:"error"}),r.c("error",{type:"cancel"}).c("service-unavailable",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up(),S.warn("duplicate session id",t,e),this.connection.send(r),!0;var o=window.performance.now(),s="focus"!==l.Strophe.getResourceFromJid(i);switch(n){case"session-initiate":S.log("(TIME) received session-initiate:\t",o);var c=$(e).find("jingle>startmuted");if(c&&c.length>0){var u=c.attr("audio"),h=c.attr("video");this.eventEmitter.emit(p.a.START_MUTED_FROM_FOCUS,"true"===u,"true"===h)}S.info("Marking session from ".concat(i," as ").concat(s?"":"*not*"," P2P"));var m=s?this.p2pIceConfig:this.jvbIceConfig;a=new E.a($(e).find("jingle").attr("sid"),$(e).attr("to"),i,this.connection,this.mediaConstraints,JSON.parse(JSON.stringify(m)),s,!1),this.sessions[a.sid]=a,this.eventEmitter.emit(p.a.CALL_INCOMING,a,$(e).find(">jingle"),o);break;case"session-accept":this.eventEmitter.emit(p.a.CALL_ACCEPTED,a,$(e).find(">jingle"));break;case"content-modify":a.modifyContents($(e).find(">jingle"));break;case"transport-info":this.eventEmitter.emit(p.a.TRANSPORT_INFO,a,$(e).find(">jingle"));break;case"session-terminate":S.log("terminating...",a.sid);var g=null,b=null;$(e).find(">jingle>reason").length&&(g=$(e).find(">jingle>reason>:first")[0].tagName,b=$(e).find(">jingle>reason>text").text()),this.terminate(a.sid,g,b),this.eventEmitter.emit(p.a.CALL_ENDED,a,g,b);break;case"transport-replace":S.info("(TIME) Start transport replace:\t",o),f.a.sendAnalytics(Object(d.G)(d.f,{p2p:s,value:o})),a.replaceTransport($(e).find(">jingle"),(function(){var e=window.performance.now();S.info("(TIME) Transport replace success:\t",e),f.a.sendAnalytics(Object(d.G)(d.g,{p2p:s,value:e}))}),(function(e){v.a.callErrorHandler(e),S.error("Transport replace failed",e),a.sendTransportReject()}));break;case"addsource":case"source-add":a.addRemoteStream($(e).find(">jingle>content"));break;case"removesource":case"source-remove":a.removeRemoteStream($(e).find(">jingle>content"));break;default:S.warn("jingle action not implemented",n),r.attrs({type:"error"}),r.c("error",{type:"cancel"}).c("bad-request",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up()}return this.connection.send(r),!0}},{key:"newP2PJingleSession",value:function(e,t){var n=new E.a(b.a.randomHexString(12),e,t,this.connection,this.mediaConstraints,this.p2pIceConfig,!0,!0);return this.sessions[n.sid]=n,n}},{key:"terminate",value:function(e,t,n){this.sessions.hasOwnProperty(e)&&("ended"!==this.sessions[e].state&&this.sessions[e].onTerminated(t,n),delete this.sessions[e])}},{key:"getStunAndTurnCredentials",value:function(){var e=this;this.connection.sendIQ(Object(l.$iq)({type:"get",to:this.xmpp.options.hosts.domain}).c("services",{xmlns:"urn:xmpp:extdisco:2"}),(function(t){return e.onReceiveStunAndTurnCredentials(t)}),(function(t){S.warn("getting turn credentials with extdisco:2 failed, trying extdisco:1",t),e.connection.sendIQ(Object(l.$iq)({type:"get",to:e.xmpp.options.hosts.domain}).c("services",{xmlns:"urn:xmpp:extdisco:1"}),(function(t){return e.onReceiveStunAndTurnCredentials(t)}),(function(e){S.warn("getting turn credentials failed",e),S.warn("is mod_turncredentials or similar installed and configured?")}))}))}},{key:"onReceiveStunAndTurnCredentials",value:function(e){var t=[];$(e).find(">services>service").each((function(e,n){var i={},r=(n=$(n)).attr("type");switch(r){case"stun":i.urls="stun:".concat(n.attr("host")),n.attr("port")&&(i.urls+=":".concat(n.attr("port"))),t.push(i);break;case"turn":case"turns":i.urls="".concat(r,":"),i.username=n.attr("username"),i.urls+=n.attr("host"),n.attr("port")&&(i.urls+=":".concat(n.attr("port")));var a=n.attr("transport");a&&"udp"!==a&&(i.urls+="?transport=".concat(a)),i.credential=n.attr("password")||i.credential,t.push(i)}}));for(var n,i=this.xmpp.options,r=t.length-1;r>0;r--){var a=Math.floor(Math.random()*(r+1)),o=t[r];t[r]=t[a],t[a]=o}return n=i.useTurnUdp?function(e){return e.urls.startsWith("turn")}:function(e){return e.urls.startsWith("turn")&&e.urls.indexOf("transport=tcp")>=0},this.jvbIceConfig.iceServers=t.filter(n),this.p2pIceConfig.iceServers=t,t.length>0}},{key:"getLog",value:function(){var e=this,t={};return Object.keys(this.sessions).forEach((function(n){var i=e.sessions[n].peerconnection;i&&i.updateLog&&(t["jingle_".concat(n)]={updateLog:i.updateLog,stats:i.stats,url:window.location.href})})),t}}]),n}(y.b)}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u}));var i=n(6),r=n(8),a=n(363),o=n.n(a),s=n(18),c=Object(s.getLogger)(e),u=function(){function e(){Object(i.a)(this,e),this._queue=o.a.queue(this._processQueueTasks.bind(this),1),this._stopped=!1}return Object(r.a)(e,[{key:"clear",value:function(){this._queue.kill()}},{key:"_processQueueTasks",value:function(e,t){try{e(t)}catch(n){c.error("Task failed: ".concat(n)),t(n)}}},{key:"push",value:function(e,t){this._stopped?t&&t(new Error("The queue has been stopped")):this._queue.push(e,t)}},{key:"shutdown",value:function(){this._stopped=!0}}]),e}()}).call(this,"/index.js")},,function(e,t){e.exports={integerHash:function(e){if(!e)return 0;var t,n=0;for(t=0;t<e.length;t++)n+=e.charCodeAt(t)*Math.pow(31,e.length-1-t),n=Math.abs(0|n);return n}}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return d}));var i=n(6),r=n(8),a=n(36),o=n(35),s=n(18),c=n(72),u=n(107),l=Object(s.getLogger)(e),d=function(e){Object(a.a)(n,e);var t=Object(o.a)(n);function n(e,r,a,o,s,c,u){var l;return Object(i.a)(this,n),(l=t.call(this)).sid=e,l.localJid=r,l.remoteJid=a,l.connection=o,l.mediaConstraints=s,l.iceConfig=c,l.isInitiator=u,l.usedrip=!0,l.dripContainer=[],l.room=null,l.state=null,l.rtc=null,l}return Object(r.a)(n,[{key:"initiatorJid",get:function(){return this.isInitiator?this.localJid:this.remoteJid}},{key:"responderJid",get:function(){return this.isInitiator?this.remoteJid:this.localJid}},{key:"initialize",value:function(e,t,n){if(null!==this.state){var i="attempt to initiate on session ".concat(this.sid,"\n                   in state ").concat(this.state);throw l.error(i),new Error(i)}this.room=e,this.rtc=t,this.state=u.c,this.doInitialize(n)}},{key:"doInitialize",value:function(e){}},{key:"addIceCandidates",value:function(e){}},{key:"getState",value:function(){return this.state}},{key:"addSources",value:function(e){}},{key:"removeSources",value:function(e){}},{key:"terminate",value:function(e,t,n){}},{key:"acceptOffer",value:function(e,t,n){}},{key:"_getInitiatorJid",value:function(){return this.isInitiator?this.localJid:this.remoteJid}}]),n}(c.a)}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return h}));var i=n(6),r=n(8),a=n(36),o=n(35),s=n(18),c=n(19),u=n(130),l=n(367),d=Object(s.getLogger)(e),h=function(e){Object(a.a)(n,e);var t=Object(o.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.call(this)).ssrcOwners=new Map,e.chatRoom=null,e}return Object(r.a)(n,[{key:"setChatRoom",value:function(e){var t=this,n=this.chatRoom;this.chatRoom=e,n&&(n.removePresenceListener("audiomuted",this._audioMuteHandler),n.removePresenceListener("videomuted",this._videoMuteHandler),n.removePresenceListener("videoType",this._videoTypeHandler)),e&&(this._audioMuteHandler=function(e,n){t.eventEmitter.emit(u.a,n,c.a,"true"===e.value)},e.addPresenceListener("audiomuted",this._audioMuteHandler),this._videoMuteHandler=function(e,n){t.eventEmitter.emit(u.a,n,c.c,"true"===e.value)},e.addPresenceListener("videomuted",this._videoMuteHandler),this._videoTypeHandler=function(e,n){t.eventEmitter.emit(u.b,n,e.value)},e.addPresenceListener("videoType",this._videoTypeHandler))}},{key:"getPeerMediaInfo",value:function(e,t){if(this.chatRoom)return this.chatRoom.getMediaPresenceInfo(e,t);d.error("Requested peer media info, before room was set")}},{key:"getSSRCOwner",value:function(e){return this.ssrcOwners.get(e)}},{key:"setSSRCOwner",value:function(e,t){if("number"!==typeof e)throw new TypeError("SSRC(".concat(e,") must be a number"));this.ssrcOwners.set(e,t)}}]),n}(l.a)}).call(this,"/index.js")},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(6),r=n(8),a=n(36),o=n(35),s=function(e){Object(a.a)(n,e);var t=Object(o.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(r.a)(n,[{key:"getSSRCOwner",value:function(e){throw new Error("not implemented")}},{key:"getPeerMediaInfo",value:function(e,t){throw new Error("not implemented")}}]),n}(n(72).a)},function(e,t,n){"use strict";var i=n(6),r=n(8),a=n(103),o=n(85),s=n(36),c=n(35),u=n(13),l=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.call(this)).log=[],e}return Object(r.a)(n,[{key:"init",value:function(e){Object(a.a)(Object(o.a)(n.prototype),"init",this).call(this,e),this.connection.rawInput=this.logIncoming.bind(this),this.connection.rawOutput=this.logOutgoing.bind(this)}},{key:"logIncoming",value:function(e){this.log.push([(new Date).getTime(),"incoming",e])}},{key:"logOutgoing",value:function(e){this.log.push([(new Date).getTime(),"outgoing",e])}}]),n}(n(121).b);t.a=function(){u.Strophe.addConnectionPlugin("logger",new l)}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return f}));var i=n(6),r=n(8),a=n(103),o=n(85),s=n(36),c=n(35),u=n(18),l=n(13),d=n(121),h=Object(u.getLogger)(e),p="urn:xmpp:rayo:1",f=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(r.a)(n,[{key:"init",value:function(e){Object(a.a)(Object(o.a)(n.prototype),"init",this).call(this,e),this.connection.addHandler(this.onRayo.bind(this),p,"iq","set",null,null)}},{key:"onRayo",value:function(e){h.info("Rayo IQ",e)}},{key:"dial",value:function(e,t,n,i,r){var a=this;return new Promise((function(o,s){if(r){var c=Object(l.$iq)({type:"set",to:r});c.c("dial",{xmlns:p,to:e,from:t}),c.c("header",{name:"JvbRoomName",value:n}).up(),i&&i.length&&c.c("header",{name:"JvbRoomPassword",value:i}).up(),a.connection.sendIQ(c,(function(e){h.info("Dial result ",e);var t=$(e).find("ref").attr("uri");a.callResource=t.substr("xmpp:".length),h.info("Received call resource: ".concat(a.callResource)),o()}),(function(e){h.info("Dial error ",e),s(e)}))}else s(new Error("Internal error!"))}))}},{key:"hangup",value:function(){var e=this;return new Promise((function(t,n){if(!e.callResource)return n(new Error("No call in progress")),void h.warn("No call in progress");var i=Object(l.$iq)({type:"set",to:e.callResource});i.c("hangup",{xmlns:p}),e.connection.sendIQ(i,(function(n){h.info("Hangup result ",n),e.callResource=null,t()}),(function(t){h.info("Hangup error ",t),e.callResource=null,n(new Error("Hangup error "))}))}))}}]),n}(d.b)}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){var i=n(18),r=n(13),a=n(43),o=n.n(a),s=Object(i.getLogger)(e),c=-1,u=/request id \d+.\d+ got 200/,l=/request errored, status: (\d+), number of errors: \d+/;t.a=function(){r.Strophe.log=function(e,t){switch(s.trace("Strophe",e,t),"string"===typeof t&&-1!==t.indexOf("Request ")&&-1!==t.indexOf("timed out (secondary), restarting")&&(e=r.Strophe.LogLevel.WARN),e){case r.Strophe.LogLevel.DEBUG:-1!==c&&u.test(t)&&(s.debug("Reset lastErrorStatus"),c=-1);break;case r.Strophe.LogLevel.WARN:s.warn("Strophe: ".concat(t));var n=l.exec(t);n&&2===n.length&&(c=parseInt(n[1],10),s.debug("lastErrorStatus set to: ".concat(c)));break;case r.Strophe.LogLevel.ERROR:case r.Strophe.LogLevel.FATAL:t="Strophe: ".concat(t),o.a.callErrorHandler(new Error(t)),s.error(t)}},r.Strophe.getLastErrorStatus=function(){return c},r.Strophe.getStatusString=function(e){switch(e){case r.Strophe.Status.BINDREQUIRED:return"BINDREQUIRED";case r.Strophe.Status.ERROR:return"ERROR";case r.Strophe.Status.CONNECTING:return"CONNECTING";case r.Strophe.Status.CONNFAIL:return"CONNFAIL";case r.Strophe.Status.AUTHENTICATING:return"AUTHENTICATING";case r.Strophe.Status.AUTHFAIL:return"AUTHFAIL";case r.Strophe.Status.CONNECTED:return"CONNECTED";case r.Strophe.Status.DISCONNECTED:return"DISCONNECTED";case r.Strophe.Status.DISCONNECTING:return"DISCONNECTING";case r.Strophe.Status.ATTACHED:return"ATTACHED";default:return"unknown"}}}}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return p}));var i=n(15),r=n(6),a=n(8),o=n(18),s=n(10),c=n(71),u=n.n(c),l=n(19),d=n(20),h=Object(o.getLogger)(e),p=function(){function e(t,n){var i=this;Object(r.a)(this,e),this.conference=t,this.options=n,this.disabledCodec=n.disabledCodec===u.a.VP8?void 0:this._getCodecMimeType(n.disabledCodec);var a=this._getCodecMimeType(n.jvbCodec),o=this._getCodecMimeType(n.p2pCodec);this.jvbPreferredCodec=a&&this._isCodecSupported(a)?a:u.a.VP8,this.p2pPreferredCodec=o&&this._isCodecSupported(o)?o:u.a.VP8,h.debug("Codec preferences for the conference are JVB: ".concat(this.jvbPreferredCodec,",\n            P2P: ").concat(this.p2pPreferredCodec)),d.a.isFirefox()&&this.jvbPreferredCodec===u.a.VP9&&(this.jvbPreferredCodec=u.a.VP8),this.conference.on(s.USER_JOINED,(function(){return i._selectPreferredCodec()})),this.conference.on(s.USER_LEFT,(function(){return i._selectPreferredCodec()})),this.conference.on(s._MEDIA_SESSION_STARTED,(function(e){return i._onMediaSessionStared(e)}))}return Object(a.a)(e,[{key:"_getCodecMimeType",value:function(e){return"string"===typeof e?Object.values(u.a).find((function(t){return t===e.toLowerCase()})):null}},{key:"_isCodecSupported",value:function(e){return!(!d.a.isFirefox()&&!d.a.isReactNative())||window.RTCRtpReceiver&&window.RTCRtpReceiver.getCapabilities&&window.RTCRtpReceiver.getCapabilities("video").codecs.some((function(t){return t.mimeType.toLowerCase()==="video/".concat(e)}))}},{key:"_onMediaSessionStared",value:function(e){var t=e.isP2P?this.p2pPreferredCodec:this.jvbPreferredCodec,n=this.disabledCodec&&this._isCodecSupported(this.disabledCodec)?this.disabledCodec:null;this._selectPreferredCodec(e,t,n)}},{key:"_selectPreferredCodec",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=e||this.conference.jvbJingleSession,a=t||this.jvbPreferredCodec,o=a;if(r&&!r.isP2P&&!this.options.enforcePreferredCodec){var s,c=this.conference.getParticipants().map((function(e){return e.getId()})),u=Object(i.a)(c);try{for(u.s();!(s=u.n()).done;){var d=s.value,h=r.signalingLayer.getPeerMediaInfo(d,l.c);h&&h.codecType&&h.codecType!==a&&(o=h.codecType)}}catch(p){u.e(p)}finally{u.f()}}r&&r.setVideoCodecs(o,n)}},{key:"getPreferredCodec",value:function(){return this.jvbPreferredCodec}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return f}));var i=n(7),r=n(6),a=n(8),o=n(18),s=n(29),c=n.n(s),u=n(32),l=n(26),d=n(43),h=n.n(d),p=Object(o.getLogger)(e),f=function(){function e(t,n,i){if(Object(r.a)(this,e),!t&&!n)throw new TypeError("At least peerconnection or wsUrl must be given");if(t&&n)throw new TypeError("Just one of peerconnection or wsUrl must be given");if(t?p.debug("constructor() with peerconnection"):p.debug('constructor() with wsUrl:"'.concat(n,'"')),this._channel=null,this._eventEmitter=i,this._mode=null,this._areRetriesEnabled=!1,this._closedFromClient=!1,t){var a=t.createDataChannel("JVB data channel",{protocol:"http://jitsi.org/protocols/colibri"});this._handleChannel(a),this._mode="datachannel"}else n&&(this._areRetriesEnabled=!0,this._wsUrl=n,this._initWebSocket())}return Object(a.a)(e,[{key:"_initWebSocket",value:function(){var e=new WebSocket(this._wsUrl);this._handleChannel(e),this._mode="websocket"}},{key:"_startConnectionRetries",value:function(){var e=this,t=1;this._retryTimeout=setTimeout((function n(){e.isOpen()||(e._initWebSocket(e._wsUrl),t=Math.min(2*t,60),e._retryTimeout=setTimeout(n,1e3*t))}),1e3*t)}},{key:"_stopConnectionRetries",value:function(){this._retryTimeout&&(clearTimeout(this._retryTimeout),this._retryTimeout=void 0)}},{key:"_retryWebSocketConnection",value:function(e){var t=this;if(this._areRetriesEnabled){var n=e.code,i=e.reason;l.a.sendAnalytics(Object(u.y)(n,i)),this._areRetriesEnabled=!1,this._eventEmitter.once(c.a.DATA_CHANNEL_OPEN,(function(){t._stopConnectionRetries(),t._areRetriesEnabled=!0})),this._startConnectionRetries()}}},{key:"mode",get:function(){return this._mode}},{key:"close",value:function(){if(this._closedFromClient=!0,this._stopConnectionRetries(),this._areRetriesEnabled=!1,this._channel){try{this._channel.close()}catch(e){}this._channel=null}}},{key:"isOpen",value:function(){return this._channel&&("open"===this._channel.readyState||this._channel.readyState===WebSocket.OPEN)}},{key:"sendEndpointStatsMessage",value:function(e){this._send(Object(i.a)({colibriClass:"EndpointStats"},e))}},{key:"sendMessage",value:function(e,t){this._send({colibriClass:"EndpointMessage",msgPayload:t,to:e})}},{key:"sendSetLastNMessage",value:function(e){p.log("Sending lastN=".concat(e,".")),this._send({colibriClass:"LastNChangedEvent",lastN:e})}},{key:"sendSetPercieveEventMessage",value:function(e){var t={colibriClass:"PercieveEvent",perceptibles:e};this._send(t),p.log("Channel PerceptEvent peceptible endpoints set to:",e)}},{key:"sendSelectedEndpointsMessage",value:function(e){p.log("Sending selected endpoints: ".concat(e,".")),this._send({colibriClass:"SelectedEndpointsChangedEvent",selectedEndpoints:e})}},{key:"sendReceiverVideoConstraintMessage",value:function(e){p.log("Sending ReceiverVideoConstraint with maxFrameHeight=".concat(e,"px")),this._send({colibriClass:"ReceiverVideoConstraint",maxFrameHeight:e})}},{key:"sendNewReceiverVideoConstraintsMessage",value:function(e){p.log("Sending ReceiverVideoConstraints with ".concat(JSON.stringify(e))),this._send(Object(i.a)({colibriClass:"ReceiverVideoConstraints"},e))}},{key:"sendVideoTypeMessage",value:function(e){p.debug("Sending VideoTypeMessage with video type as ".concat(e)),this._send({colibriClass:"VideoTypeMessage",videoType:e})}},{key:"_handleChannel",value:function(e){var t=this,n=this._eventEmitter;e.onopen=function(){p.info("".concat(t._mode," channel opened")),n.emit(c.a.DATA_CHANNEL_OPEN)},e.onerror=function(e){"websocket"!==t._mode&&p.error("Channel error: ".concat(e.message))},e.onmessage=function(e){var t,i=e.data;try{t=JSON.parse(i)}catch(v){return h.a.callErrorHandler(v),void p.error("Failed to parse channel message as JSON: ",i,v)}var r=t.colibriClass;switch(r){case"DominantSpeakerEndpointChangeEvent":var a=t,o=a.dominantSpeakerEndpoint,s=a.previousSpeakers,u=void 0===s?[]:s;p.debug("Dominant speaker: ".concat(o,", previous speakers: ").concat(u)),n.emit(c.a.DOMINANT_SPEAKER_CHANGED,o,u);break;case"EndpointConnectivityStatusChangeEvent":var l=t.endpoint,d="true"===t.active;p.info("Endpoint connection status changed: ".concat(l," active=").concat(d)),n.emit(c.a.ENDPOINT_CONN_STATUS_CHANGED,l,d);break;case"EndpointMessage":n.emit(c.a.ENDPOINT_MESSAGE_RECEIVED,t.from,t.msgPayload);break;case"EndpointStats":n.emit(c.a.ENDPOINT_STATS_RECEIVED,t.from,t);break;case"LastNEndpointsChangeEvent":var f=t.lastNEndpoints;p.info("New forwarded endpoints: ".concat(f)),n.emit(c.a.LASTN_ENDPOINT_CHANGED,f);break;case"SenderVideoConstraints":var m=t.videoConstraints;m&&(p.info("SenderVideoConstraints: ".concat(JSON.stringify(m))),n.emit(c.a.SENDER_VIDEO_CONSTRAINTS_CHANGED,m));break;case"ServerHello":p.info("Received ServerHello, version=".concat(t.version,"."));break;default:p.debug("Channel JSON-formatted message: ",t),n.emit("rtc.datachannel.".concat(r),t)}},e.onclose=function(e){p.info("Channel closed by ".concat(t._closedFromClient?"client":"server")),"websocket"===t._mode&&(t._closedFromClient||(p.error("Channel closed: ".concat(e.code," ").concat(e.reason)),t._retryWebSocketConnection(e))),t._channel=null},this._channel=e}},{key:"_send",value:function(e){var t=this._channel;if(!this.isOpen())throw p.error("Bridge Channel send: no opened channel."),new Error("No opened channel");t.send(JSON.stringify(e))}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return w}));var i=n(69),r=n(15),a=n(456),o=n(18),s=n(74),c=n.n(s),u=n(71),l=n(39),d=n.n(l),h=n(19),p=n(29),f=n.n(p),m=n(130),v=n(50),g=n(20),b=n(374),y=n(375),E=n(65),S=n(34),O=n(376),_=n(97),C=n(43),T=n(377),j=n(44),A=n(42),k=n(191),R=Object(o.getLogger)(e),I="maintain-framerate",P=25e5;function w(e,t,i,r,o,s,c){var u=this;this.audioTransferActive=!(!0===c.startSilent),this._dtmfSender=void 0,this._dtmfTonesQueue=[],this.videoTransferActive=!0,this.rtc=e,this.id=t,this.isP2P=s,this.remoteTracks=new Map,this.localTracks=new Map,this._addedStreams=[],this.localSSRCs=new Map,this.localUfrag=null,this.remoteUfrag=null,this.signalingLayer=i,this._peerVideoTypeChanged=this._peerVideoTypeChanged.bind(this),this.signalingLayer.on(m.b,this._peerVideoTypeChanged),this._peerMutedChanged=this._peerMutedChanged.bind(this),this.signalingLayer.on(m.a,this._peerMutedChanged),this.options=c;var l=o||{};l.optional=l.optional||[],Array.isArray(l.optional)?l.optional.push({rtcStatsSFUP2P:this.isP2P}):R.warn("Optional param is not an array, rtcstats p2p data is omitted."),this.peerconnection=new A.a.RTCPeerConnectionType(r,l);var d={low:2e5,standard:7e5,high:P};this.videoBitrates=this.options.videoQuality&&this.options.videoQuality.maxBitratesVideo?this.options.videoQuality.maxBitratesVideo:d,this.tpcUtils=new k.b(this,this.videoBitrates),this.updateLog=[],this.stats={},this.statsinterval=null,this._usesUnifiedPlan=c.usesUnifiedPlan,this._usesTransceiverCodecPreferences=g.a.supportsCodecPreferences()&&this._usesUnifiedPlan,this._usesTransceiverCodecPreferences&&R.info("Using RTCRtpTransceiver#setCodecPreferences for codec selection"),this.maxstats=c.maxstats,this.interop=new a.a;var h=n(499);this.simulcast=new h({numOfLayers:k.a.length,explodeRemoteSimulcast:!1,usesUnifiedPlan:this._usesUnifiedPlan}),this.sdpConsistency=new O.a(this.toString()),this.localSdpMunger=new b.a(this,this.rtc.getLocalEndpointId()),this.eventEmitter=e.eventEmitter,this.rtxModifier=new y.a,this.senderVideoMaxHeight=null,this.trace=function(e,t){R.debug(e,t),u.updateLog.push({time:new Date,type:e,value:t||""})},this.onicecandidate=null,this.peerconnection.onicecandidate=function(e){u.trace("onicecandidate",JSON.stringify(e.candidate,null," ")),null!==u.onicecandidate&&u.onicecandidate(e)},this._usesUnifiedPlan?(this.onTrack=function(e){var t=e.streams[0];u._remoteTrackAdded(t,e.track,e.transceiver),t.addEventListener("removetrack",(function(e){u._remoteTrackRemoved(t,e.track)}))},this.peerconnection.addEventListener("track",this.onTrack)):(this.peerconnection.onaddstream=function(e){return u._remoteStreamAdded(e.stream)},this.peerconnection.onremovestream=function(e){return u._remoteStreamRemoved(e.stream)}),this.onsignalingstatechange=null,this.peerconnection.onsignalingstatechange=function(e){u.trace("onsignalingstatechange",u.signalingState),null!==u.onsignalingstatechange&&u.onsignalingstatechange(e)},this.oniceconnectionstatechange=null,this.peerconnection.oniceconnectionstatechange=function(e){u.trace("oniceconnectionstatechange",u.iceConnectionState),null!==u.oniceconnectionstatechange&&u.oniceconnectionstatechange(e)},this.onnegotiationneeded=null,this.peerconnection.onnegotiationneeded=function(e){u.trace("onnegotiationneeded"),null!==u.onnegotiationneeded&&u.onnegotiationneeded(e)},this.ondatachannel=null,this.peerconnection.ondatachannel=function(e){u.trace("ondatachannel"),null!==u.ondatachannel&&u.ondatachannel(e)},this.maxstats&&(this.statsinterval=window.setInterval((function(){u.getStats().then((function(e){if("function"===typeof(null===e||void 0===e?void 0:e.result))for(var t=e.result(),n=function(e){var n=t[e];n.names().forEach((function(e){u._processStat(n,e,n.stat(e))}))},i=0;i<t.length;++i)n(i);else e.forEach((function(e){return u._processStat(e,"",e)}))}))}),1e3)),R.info("Create new ".concat(this))}w.prototype._processStat=function(e,t,n){var i="".concat(e.id,"-").concat(t),r=this.stats[i],a=new Date;r||(this.stats[i]=r={startTime:a,endTime:a,values:[],times:[]}),r.values.push(n),r.times.push(a.getTime()),r.values.length>this.maxstats&&(r.values.shift(),r.times.shift()),r.endTime=a};var N=function(e){return"undefined"===typeof e||null===e?"":"type: ".concat(e.type,"\r\n").concat(e.sdp)};w.prototype.getConnectionState=function(){var e=this.peerconnection.iceConnectionState;return"completed"===e?"connected":e},w.prototype.getDesiredMediaDirection=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.hasAnyTracksOfType(e);if(this._usesUnifiedPlan)return t?n?d.a.SENDRECV:d.a.SENDONLY:n?d.a.RECVONLY:d.a.INACTIVE;var i=e===h.a?this.audioTransferActive:this.videoTransferActive;return i?n?d.a.SENDRECV:d.a.RECVONLY:d.a.INACTIVE},w.prototype._getReceiversByEndpointIds=function(e,t){var n,i=[],a=Object(r.a)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value;i=i.concat(this.getRemoteTracks(o,t))}}catch(c){a.e(c)}finally{a.f()}var s=i.map((function(e){var t;return null===(t=e.track)||void 0===t?void 0:t.id}));return this.peerconnection.getReceivers().filter((function(e){return e.track&&e.track.kind===t&&s.find((function(t){return t===e.track.id}))}))},w.prototype.isSimulcastOn=function(){return!this.options.disableSimulcast},w.prototype._peerVideoTypeChanged=function(e,t){if(e){var n=this.getRemoteTracks(e,h.c);n.length&&n[0]._setVideoType(t)}else R.error("".concat(this," No endpointID on peerVideoTypeChanged"))},w.prototype._peerMutedChanged=function(e,t,n){if(e){var i=this.getRemoteTracks(e,t);i.length&&i[0].setMute(n)}else R.error("".concat(this," On peerMuteChanged - no endpoint ID"))},w.prototype.getAudioLevels=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={},n=e.length?this._getReceiversByEndpointIds(e,h.a):this.peerconnection.getReceivers().filter((function(e){return e.track&&e.track.kind===h.a&&e.track.enabled}));return n.forEach((function(e){var n=e.getSynchronizationSources();n&&n.length&&(t[n[0].source]=n[0].audioLevel)})),t},w.prototype.getLocalTracks=function(e){var t=Array.from(this.localTracks.values());return void 0!==e&&(t=t.filter((function(t){return t.getType()===e}))),t},w.prototype.getLocalVideoTrack=function(){return this.getLocalTracks(h.c)[0]},w.prototype.hasAnyTracksOfType=function(e){if(!e)throw new Error('"mediaType" is required');return this.getLocalTracks(e).length>0},w.prototype.getRemoteTracks=function(e,t){var n,i=[],a=e?[e]:this.remoteTracks.keys(),o=Object(r.a)(a);try{for(o.s();!(n=o.n()).done;){var s=n.value,c=this.remoteTracks.get(s);if(c){var u,l=Object(r.a)(c.keys());try{for(l.s();!(u=l.n()).done;){var d=u.value;if(!t||t===d){var h=c.get(d);h&&i.push(h)}}}catch(p){l.e(p)}finally{l.f()}}}}catch(p){o.e(p)}finally{o.f()}return i},w.prototype.getRemoteSourceInfoByParticipant=function(e){var t=[],n=this.getRemoteTracks(e);if(null===n||void 0===n||!n.length)return t;var i=n.map((function(e){return e.getSSRC()})),a=new E.a(this.remoteDescription.sdp);return i.forEach((function(e,n){var i,o=Object(r.a)(a.media);try{for(o.s();!(i=o.n()).done;){var s=i.value,c="",u=S.a.findLines(s,"a=ssrc:".concat(e));if(u.length){t[n]||(t[n]="");var l=S.a.findLines(s,"a=ssrc-group:FID ".concat(e));if(l.length){var d=l[0].split(" ")[2];c+="".concat(l[0],"\r\n"),u=u.concat(S.a.findLines(s,"a=ssrc:".concat(d)))}t[n]+="".concat(u.join("\r\n"),"\r\n"),t[n]+=c}}}catch(h){o.e(h)}finally{o.f()}})),t},w.prototype.getTargetVideoBitrates=function(){var e=this.getConfiguredVideoCodec();return this.videoBitrates[e.toUpperCase()]||this.videoBitrates},w.prototype.getTrackBySSRC=function(e){if("number"!==typeof e)throw new Error("SSRC ".concat(e," is not a number"));var t,n=Object(r.a)(this.localTracks.values());try{for(n.s();!(t=n.n()).done;){var i=t.value;if(this.getLocalSSRC(i)===e)return i}}catch(c){n.e(c)}finally{n.f()}var a,o=Object(r.a)(this.getRemoteTracks());try{for(o.s();!(a=o.n()).done;){var s=a.value;if(s.getSSRC()===e)return s}}catch(c){o.e(c)}finally{o.f()}return null},w.prototype.getSsrcByTrackId=function(e){var t=function(t){return t.getTrack().id===e},n=this.getLocalTracks().find(t);if(n)return this.getLocalSSRC(n);var i=this.getRemoteTracks().find(t);return i?i.getSSRC():null},w.prototype._remoteStreamAdded=function(e){var t=this,n=j.a.getStreamID(e);if(j.a.isUserStreamById(n)){g.a.isChromiumBased()&&(e.onaddtrack=function(n){t._remoteTrackAdded(e,n.track)},e.onremovetrack=function(n){t._remoteTrackRemoved(e,n.track)});var i,a=e.getAudioTracks(),o=Object(r.a)(a);try{for(o.s();!(i=o.n()).done;){var s=i.value;this._remoteTrackAdded(e,s)}}catch(h){o.e(h)}finally{o.f()}var c,u=e.getVideoTracks(),l=Object(r.a)(u);try{for(l.s();!(c=l.n()).done;){var d=c.value;this._remoteTrackAdded(e,d)}}catch(h){l.e(h)}finally{l.f()}}else R.info("".concat(this," ignored remote 'stream added' event for non-user stream[id=").concat(n,"]"))},w.prototype._remoteTrackAdded=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=j.a.getStreamID(e),r=t.kind;if(this.isP2P||j.a.isUserStreamById(i))if(R.info("".concat(this," adding remote track for stream[id=").concat(i,",type=").concat(r,"]")),r){var a,o=this._usesUnifiedPlan?new E.a(this.peerconnection.remoteDescription.sdp):new E.a(this.remoteDescription.sdp);if(this._usesUnifiedPlan)if(n&&n.mid){var s=n.mid;a=o.media.filter((function(e){return S.a.findLine(e,"a=mid:".concat(s))}))}else a=o.media.filter((function(e){var t=S.a.findLine(e,"a=msid:");return"undefined"!==typeof t&&i===t.substring(7).split(" ")[0]}));else a=o.media.filter((function(e){return e.startsWith("m=".concat(r))}));if(a.length){var c=S.a.findLines(a[0],"a=ssrc:");if((c=c.filter((function(e){return-1!==e.indexOf("msid:".concat(i))}))).length){var u=c.map((function(e){return Number(e.substring(7).split(" ")[0])})),l=u[0],d=this.signalingLayer.getSSRCOwner(l);if(isNaN(l)||l<0)C.callErrorHandler(new Error("Invalid SSRC for remote stream[ssrc=".concat(l,",id=").concat(i,",type=").concat(r,"]")));else if(d){R.info("".concat(this," creating remote track[endpoint=").concat(d,",ssrc=").concat(l,",type=").concat(r,"]"));var h=this.signalingLayer.getPeerMediaInfo(d,r);if(h){var p=h.muted,f=h.videoType;this._createRemoteTrack(d,e,t,r,f,u,p)}else C.callErrorHandler(new Error("".concat(this,": no peer media info available for ").concat(d)))}else C.callErrorHandler(new Error("No SSRC owner known for remote stream[ssrc=".concat(l,",id=").concat(i,",type=").concat(r,"]")))}else C.callErrorHandler(new Error("No SSRC lines found in remote SDP for remote stream[msid=".concat(i,",type=").concat(r,"]")))}else C.callErrorHandler(new Error("No media lines found in remote SDP for remote stream[id=".concat(i,",type=").concat(r,"]")))}else C.callErrorHandler(new Error("MediaType undefined for remote track, stream id: ".concat(i)));else R.info("".concat(this," ignored remote 'stream added' event for non-user stream[id=").concat(i,"]"))},w.prototype._createRemoteTrack=function(e,t,n,i,r,a,o){var s=this.remoteTracks.get(e);s||(s=new Map,this.remoteTracks.set(e,s));var c=s.get(i);if(c&&c.getTrack()===n)R.info("".concat(this," ignored duplicated track event for track[endpoint=").concat(e,",type=").concat(i,"]"));else{c&&(R.error("".concat(this," received a second remote track for track[endpoint=").concat(e,",type=").concat(i,"]")+"deleting the existing track"),this._remoteTrackRemoved(c.getOriginalStream(),c.getTrack()));var u=new T.a(this.rtc,this.rtc.conference,e,t,n,i,r,a,o,this.isP2P);s.set(i,u),this.eventEmitter.emit(f.a.REMOTE_TRACK_ADDED,u,this)}},w.prototype._remoteStreamRemoved=function(e){if(j.a.isUserStream(e)){var t,n=e.getVideoTracks(),i=Object(r.a)(n);try{for(i.s();!(t=i.n()).done;){var a=t.value;this._remoteTrackRemoved(e,a)}}catch(d){i.e(d)}finally{i.f()}var o,s=e.getAudioTracks(),c=Object(r.a)(s);try{for(c.s();!(o=c.n()).done;){var u=o.value;this._remoteTrackRemoved(e,u)}}catch(d){c.e(d)}finally{c.f()}}else{var l=j.a.getStreamID(e);R.info("Ignored remote 'stream removed' event for stream[id=".concat(l,"]"))}},w.prototype._remoteTrackRemoved=function(e,t){var n=j.a.getStreamID(e),i=t&&j.a.getTrackID(t);j.a.isUserStreamById(n)?(R.info("".concat(this," remote track removed stream[id=").concat(n,",trackId=").concat(i,"]")),n?i?this._removeRemoteTrackById(n,i)||R.warn("".concat(this," Removed track not found for stream[id=").concat(n,",trackId=").concat(i,"]")):C.callErrorHandler(new Error("".concat(this," remote track removal failed - no track ID"))):C.callErrorHandler(new Error("".concat(this," remote track removal failed - no stream ID")))):R.info("".concat(this," ignored remote 'stream removed' event for non-user stream[id=").concat(n,"]"))},w.prototype._getRemoteTrackById=function(e,t){var n,i=Object(r.a)(this.remoteTracks.values());try{for(i.s();!(n=i.n()).done;){var a,o=n.value,s=Object(r.a)(o.values());try{for(s.s();!(a=s.n()).done;){var c=a.value;if(c.getStreamId()==e&&c.getTrackId()==t)return c}}catch(u){s.e(u)}finally{s.f()}}}catch(u){i.e(u)}finally{i.f()}},w.prototype.removeRemoteTracks=function(e){var t=[],n=this.remoteTracks.get(e);if(n){var i=n.get(h.a),r=n.get(h.c);i&&t.push(i),r&&t.push(r),this.remoteTracks.delete(e)}return R.debug("".concat(this," removed remote tracks[endpoint=").concat(e,",count=").concat(t.length)),t},w.prototype._removeRemoteTrack=function(e){e.dispose();var t=e.getParticipantId(),n=this.remoteTracks.get(t);n?n.delete(e.getType())||R.error("".concat(this," Failed to remove ").concat(e," - type mapping messed up ?")):R.error("".concat(this," removeRemoteTrack: no remote tracks map for endpoint=").concat(t)),this.eventEmitter.emit(f.a.REMOTE_TRACK_REMOVED,e)},w.prototype._removeRemoteTrackById=function(e,t){var n=this._getRemoteTrackById(e,t);return n&&this._removeRemoteTrack(n),n};var D=function(e){if("object"!==typeof e||null===e||"string"!==typeof e.sdp)return R.warn("An empty description was passed as an argument"),e;var t=n(74),r=t.parse(e.sdp);"undefined"!==typeof r&&"undefined"!==typeof r.media&&Array.isArray(r.media)&&r.media.forEach((function(e){var t=[],n=[];if("undefined"!==typeof e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&e.ssrcGroups.forEach((function(e){"undefined"!==typeof e.semantics&&"FID"===e.semantics&&"undefined"!==typeof e.ssrcs&&t.push(Number(e.ssrcs.split(" ")[0]))})),Array.isArray(e.ssrcs)){var r;for(r=0;r<e.ssrcs.length;r++)"object"===typeof e.ssrcs[r]&&"undefined"!==typeof e.ssrcs[r].id&&t.indexOf(e.ssrcs[r].id)>=0&&(n.push(e.ssrcs[r]),delete e.ssrcs[r]);for(r=0;r<e.ssrcs.length;r++)"undefined"!==typeof e.ssrcs[r]&&n.push(e.ssrcs[r]);e.ssrcs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!g.a.isChrome()||!g.a.isVersionGreaterThan(70))return e;var t=Object(i.a)(e);return e.filter((function(e){return e.attribute==="mslabel"&&e.value==="-"})).map((function(e){return e.id})).forEach((function(e){var n=t.find((function(t){return t.id===e&&"cname"===t.attribute}));n.value="".concat(d.a.RECVONLY,"-").concat(e),(t=t.filter((function(t){return t.id!==e}))).push(n)})),t}(n)}}));var a=t.write(r);return new RTCSessionDescription({type:e.type,sdp:a})};w.prototype.getLocalSSRC=function(e){var t=this._getSSRC(e.rtcId);return t&&t.ssrcs[0]},w.prototype._injectSsrcGroupForUnifiedSimulcast=function(e){var t=c.a.parse(e.sdp),n=t.media.find((function(e){return"video"===e.type}));n.ssrcGroups=n.ssrcGroups||[];var i=n.ssrcGroups.filter((function(e){return"FID"===e.semantics}));if(n.simulcast||n.simulcast_03){var r=[];if(i&&i.length?i.forEach((function(e){r.push(e.ssrcs.split(" ")[0])})):n.ssrcs.forEach((function(e){"msid"===e.attribute&&r.push(e.id)})),n.ssrcGroups.find((function(e){return"SIM"===e.semantics})))return e;n.ssrcGroups.push({semantics:"SIM",ssrcs:r.join(" ")})}return new RTCSessionDescription({type:e.type,sdp:c.a.write(t)})};var M={signalingState:function(){return this.peerconnection.signalingState},iceConnectionState:function(){return this.peerconnection.iceConnectionState},localDescription:function(){var e=this.peerconnection.localDescription;return e?(this.trace("getLocalDescription::preTransform",N(e)),this._usesUnifiedPlan&&!this.isP2P?(e=this.interop.toPlanB(e),this.trace("getLocalDescription::postTransform (Plan B)",N(e)),e=this._injectSsrcGroupForUnifiedSimulcast(e),this.trace("getLocalDescription::postTransform (inject ssrc group)",N(e))):this._usesUnifiedPlan||(g.a.doesVideoMuteByStreamRemove()&&(e=this.localSdpMunger.maybeAddMutedLocalVideoTracksToSDP(e),R.debug("getLocalDescription::postTransform (munge local SDP)",e)),e=function(e,t){if(!e)throw new Error("No local description passed in.");var n=new _.a(e.sdp),i=n.selectMedia(h.a),r=!1;i&&i.direction!==d.a.SENDRECV&&(t.startSilent?i.direction=d.a.INACTIVE:i.direction=d.a.SENDRECV,r=!0);var a=n.selectMedia(h.c);return a&&a.direction!==d.a.SENDRECV&&(a.direction=d.a.SENDRECV,r=!0),r?new RTCSessionDescription({type:e.type,sdp:n.toRawSDP()}):e}(e,this.options)),e=this.localSdpMunger.transformStreamIdentifiers(e)):(R.debug("".concat(this," getLocalDescription no localDescription found")),{})},remoteDescription:function(){var e=this.peerconnection.remoteDescription;return e?(this.trace("getRemoteDescription::preTransform",N(e)),this._usesUnifiedPlan&&(this.isP2P?e=this._adjustRemoteMediaDirection(e):(e=this.interop.toPlanB(e),this.trace("getRemoteDescription::postTransform (Plan B)",N(e)))),e):(R.debug("".concat(this," getRemoteDescription no remoteDescription found")),{})}};Object.keys(M).forEach((function(e){Object.defineProperty(w.prototype,e,{get:M[e]})})),w.prototype._getSSRC=function(e){return this.localSSRCs.get(e)},w.prototype._isSharingScreen=function(){var e=this.getLocalVideoTrack();return e&&e.videoType===v.DESKTOP},w.prototype._mungeCodecOrder=function(e){if(!this.codecPreference||this._usesTransceiverCodecPreferences)return e;var t,n=c.a.parse(e.sdp),i=Object(r.a)(n.media);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(this.codecPreference.enable&&a.type===this.codecPreference.mediaType)if(S.a.preferCodec(a,this.codecPreference.mimeType),this.codecPreference.mimeType===u.H264&&g.a.isReactNative()&&this.isP2P&&S.a.stripCodec(a,this.codecPreference.mimeType,!0),this.codecPreference.mimeType===u.VP9){var o=this.videoBitrates.VP9||this.videoBitrates,s=o.high?o.high:P,l=Math.floor((this._isSharingScreen()?P:s)/1e3);a.bandwidth=[{type:"AS",limit:l}]}else a.bandwidth=void 0;else a.type===this.codecPreference.mediaType&&S.a.stripCodec(a,this.codecPreference.mimeType)}}catch(d){i.e(d)}finally{i.f()}return new RTCSessionDescription({type:e.type,sdp:c.a.write(n)})},w.prototype.containsTrack=function(e){if(e.isLocal())return this.localTracks.has(e.rtcId);var t=e.getParticipantId(),n=this.remoteTracks.get(t);return Boolean(n&&n.get(e.getType())===e)},w.prototype.addTrack=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e.rtcId;if(R.info("".concat(this," adding ").concat(e)),this.localTracks.has(i))return Promise.reject(new Error("".concat(e," is already in ").concat(this)));if(this.localTracks.set(i,e),this._usesUnifiedPlan)try{this.tpcUtils.addTrack(e,n)}catch(l){return R.error("".concat(this," Adding track=").concat(e," failed: ").concat(null===l||void 0===l?void 0:l.message)),Promise.reject(l)}else{var r=e.getOriginalStream();if(r)this._addStream(r);else if(!g.a.doesVideoMuteByStreamRemove()||e.isAudioTrack()||e.isVideoTrack()&&!e.isMuted())return Promise.reject(new Error("".concat(this," no WebRTC stream for track=").concat(e)));if(g.a.doesVideoMuteByStreamRemove()&&e.isVideoTrack()&&e.isMuted()){var a=this.generateNewStreamSSRCInfo(e);this.sdpConsistency.setPrimarySsrc(a.ssrcs[0]);var o=a.groups.find((function(e){return"SIM"===e.semantics}));o&&this.simulcast.setSsrcCache(o.ssrcs);var s=a.groups.filter((function(e){return"FID"===e.semantics}));if(s){var c=new Map;s.forEach((function(e){var t=e.ssrcs[0],n=e.ssrcs[1];c.set(t,n)})),this.rtxModifier.setSsrcCache(c)}}}var u=Promise.resolve();return g.a.isFirefox()&&(u=u.then((function(){return t.tpcUtils.setEncodings(e)}))),u},w.prototype.addTrackUnmute=function(e){if(!this._assertTrackBelongs("addTrackUnmute",e))return Promise.reject("Track not found on the peerconnection");R.info("".concat(this," Adding track=").concat(e," as unmute"));var t=e.getOriginalStream();return t?this._usesUnifiedPlan?this.tpcUtils.addTrackUnmute(e):(this._addStream(t),Promise.resolve(!0)):(R.error("".concat(this," Unable to add track=").concat(e," as unmute - no WebRTC stream")),Promise.reject("Stream not found"))},w.prototype._addStream=function(e){this.peerconnection.addStream(e),this._addedStreams.push(e)},w.prototype._removeStream=function(e){this.peerconnection.removeStream(e),this._addedStreams=this._addedStreams.filter((function(t){return t!==e}))},w.prototype._assertTrackBelongs=function(e,t){var n=this.localTracks.has(t.rtcId);return n||R.error("".concat(this," ").concat(e,": track=").concat(t," does not belong to pc")),n},w.prototype.getConfiguredVideoCodec=function(){var e,t=null===(e=this.peerconnection.localDescription)||void 0===e?void 0:e.sdp,n=u.VP8;if(!t)return n;var i=c.a.parse(t).media.find((function(e){return e.type===h.c})).rtp[0].codec;return i?Object.values(u).find((function(e){return e===i.toLowerCase()})):n},w.prototype.setVideoCodecs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=null===t,i=t||e;this.codecPreference&&(e||t)?(this.codecPreference.enable=n,this.codecPreference.mimeType=i):e||t?this.codecPreference={enable:n,mediaType:h.c,mimeType:i}:R.warn("".concat(this," Invalid codec settings[preferred=").concat(e,",disabled=").concat(t,"],\n            atleast one value is needed"))},w.prototype.isMediaStreamInPc=function(e){return this._addedStreams.indexOf(e)>-1},w.prototype.removeTrack=function(e){var t=e.getOriginalStream();this.trace("removeStream",e.rtcId,t?t.id:void 0),this._assertTrackBelongs("removeStream",e)&&(this.localTracks.delete(e.rtcId),this.localSSRCs.delete(e.rtcId),t&&this.peerconnection.removeStream(t))},w.prototype.findSenderByKind=function(e){return this.peerconnection.getSenders().find((function(t){return t.track&&t.track.kind===e}))},w.prototype.findReceiverForTrack=function(e){return this.peerconnection.getReceivers().find((function(t){return t.track===e}))},w.prototype.findSenderForTrack=function(e){return this.peerconnection.getSenders().find((function(t){return t.track===e}))},w.prototype.replaceTrack=function(e,t){var n=this;if(this._usesUnifiedPlan)return R.debug("".concat(this," TPC.replaceTrack using unified plan")),this.tpcUtils.replaceTrack(e,t).then((function(){return n.isSimulcastOn()&&g.a.usesSdpMungingForSimulcast()}));R.debug("".concat(this," TPC.replaceTrack using plan B"));var i=Promise.resolve();return e&&this.removeTrack(e),t&&(i=this.addTrack(t)),i.then((function(){return!0}))},w.prototype.removeTrackMute=function(e){var t=e.getOriginalStream();return this.trace("removeStreamMute",e.rtcId,t?t.id:null),this._assertTrackBelongs("removeStreamMute",e)?this._usesUnifiedPlan?this.tpcUtils.removeTrackMute(e):t?(R.info("".concat(this," Removing track=").concat(e," as mute")),this._removeStream(t),Promise.resolve(!0)):(R.error("".concat(this," removeStreamMute - no WebRTC stream for track=").concat(e)),Promise.reject("Stream not found")):Promise.reject("Track not found in the peerconnection")},w.prototype.createDataChannel=function(e,t){return this.trace("createDataChannel",e,t),this.peerconnection.createDataChannel(e,t)},w.prototype._ensureSimulcastGroupIsLast=function(e){var t=e.sdp,n=t.indexOf("m=video"),i=t.indexOf("a=ssrc-group:SIM",n),r=t.lastIndexOf("a=ssrc-group");if(-1===i||-1===r||r===i)return e;var a=t.indexOf("\r\n",i),o=t.substring(i,a+2);r=(t=t.replace(o,"")).lastIndexOf("a=ssrc-group");var s=t.indexOf("\r\n",r),c=t.slice(0,s),u=o.trim(),l=t.slice(s);return t="".concat(c,"\r\n").concat(u).concat(l),new RTCSessionDescription({type:e.type,sdp:t})},w.prototype._adjustLocalMediaDirection=function(e){var t=new _.a(e.sdp),n=!1,i=t.selectMedia(h.a);if(i){var r=this.getDesiredMediaDirection(h.a);i.direction!==r&&(i.direction=r,R.info("".concat(this," Adjusted local audio direction to ").concat(r)),n=!0)}else R.warn("".concat(this,' No "audio" media found in the local description'));var a=t.selectMedia(h.c);if(a){var o=this.getDesiredMediaDirection(h.c);a.direction!==o&&(a.direction=o,R.info("".concat(this," Adjusted local video direction to ").concat(o)),n=!0)}else R.warn("".concat(this,' No "video" media found in the local description'));return n?new RTCSessionDescription({type:e.type,sdp:t.toRawSDP()}):e},w.prototype._adjustRemoteMediaDirection=function(e){var t=this,n=new _.a(e.sdp);return[h.a,h.c].forEach((function(e){var i=n.selectMedia(e),r=t.hasAnyTracksOfType(e),a=t.getRemoteTracks(null,e).length>0;i.direction=r&&a?d.a.SENDRECV:r?d.a.RECVONLY:d.a.SENDONLY})),new RTCSessionDescription({type:e.type,sdp:n.toRawSDP()})},w.prototype._mungeOpus=function(e){var t=this.options.audioQuality;if((null===t||void 0===t||!t.stereo)&&(null===t||void 0===t||!t.opusMaxAverageBitrate))return e;var n,i=c.a.parse(e.sdp),a=i.media,o=Object(r.a)(a);try{for(o.s();!(n=o.n()).done;){var s=n.value;if("audio"===s.type)if("continue"===function(){var e=s.rtp.find((function(e){return e.codec===u.OPUS})).payload;if(!e)return"continue";var n=s.fmtp.find((function(t){return t.payload===e}));n||(n={payload:e,config:""});var i=c.a.parseParams(n.config),r=!1;if(null!==t&&void 0!==t&&t.stereo&&(i.stereo=1,r=!0),null!==t&&void 0!==t&&t.opusMaxAverageBitrate&&(i.maxaveragebitrate=t.opusMaxAverageBitrate,r=!0),!r)return"continue";for(var a="",o=0,l=Object.keys(i);o<l.length;o++){var d=l[o];a+="".concat(d,"=").concat(i[d],"; ")}n.config=a.trim()}())continue}}catch(l){o.e(l)}finally{o.f()}return new RTCSessionDescription({type:e.type,sdp:c.a.write(i)})},w.prototype.setLocalDescription=function(e){var t=this,n=e;return this.trace("setLocalDescription::preTransform",N(n)),n=this._mungeCodecOrder(n),n=this._mungeOpus(n),this._usesUnifiedPlan?this.isP2P||(n=this.interop.toUnifiedPlan(n),this.trace("setLocalDescription::postTransform (Unified Plan)",N(n))):(n=this._adjustLocalMediaDirection(n),n=this._ensureSimulcastGroupIsLast(n)),new Promise((function(e,i){t.peerconnection.setLocalDescription(n).then((function(){t.trace("setLocalDescriptionOnSuccess");var i=S.a.getUfrag(n.sdp);i!==t.localUfrag&&(t.localUfrag=i,t.eventEmitter.emit(f.a.LOCAL_UFRAG_CHANGED,t,i)),e()}),(function(e){t.trace("setLocalDescriptionOnFailure",e),t.eventEmitter.emit(f.a.SET_LOCAL_DESCRIPTION_FAILED,e,t),i(e)}))}))},w.prototype.setAudioTransferActive=function(e){R.debug("".concat(this," audio transfer active: ").concat(e));var t=this.audioTransferActive!==e;return this.audioTransferActive=e,this._usesUnifiedPlan?(this.tpcUtils.setAudioTransferActive(e),!1):t},w.prototype.setSenderVideoDegradationPreference=function(){if(!this.peerconnection.getSenders)return R.debug("".concat(this," Browser does not support RTCRtpSender")),Promise.resolve();var e=this.getLocalVideoTrack(),t=this.findSenderByKind(h.c);if(!t)return Promise.resolve();var n=t.getParameters(),i=e.videoType===v.CAMERA?I:this.options.capScreenshareBitrate&&!this._usesUnifiedPlan?"maintain-resolution":I;return R.info("".concat(this," Setting a degradation preference [preference=").concat(i,",track=").concat(e)),n.degradationPreference=i,this.tpcUtils.updateEncodingsResolution(n),t.setParameters(n)},w.prototype.setMaxBitRate=function(){if(this.getConfiguredVideoCodec()===u.VP9||!window.RTCRtpSender)return Promise.resolve();var e=this.getLocalVideoTrack();if(!e)return Promise.resolve();var t=e.videoType,n=!this._usesUnifiedPlan&&t===v.DESKTOP;if(!(this.options.videoQuality&&this.options.videoQuality.maxBitratesVideo||n&&this.options.capScreenshareBitrate||this._usesUnifiedPlan))return Promise.resolve();var i=e._originalStream&&e._originalStream.id!==e.getStreamId(),r=this.findSenderByKind(h.c);if(!r)return Promise.resolve();var a=r.getParameters();if(!a.encodings||!a.encodings.length)return Promise.resolve();if(this.isSimulcastOn()){for(var o in a.encodings)if(a.encodings.hasOwnProperty(o)){var s=void 0;s=n?this.options.capScreenshareBitrate?i?P:5e5:void 0:this.tpcUtils.localStreamEncodingsConfig[o].maxBitrate,R.info("".concat(this," Setting a max bitrate of ").concat(s," bps on layer ")+"".concat(this.tpcUtils.localStreamEncodingsConfig[o].rid)),a.encodings[o].maxBitrate=s}}else{var c,l=null===(c=this.getTargetVideoBitrates())||void 0===c?void 0:c.high;if(t===v.CAMERA){var d=this.senderVideoMaxHeight?Math.floor(e.resolution/this.senderVideoMaxHeight):1,p=this.tpcUtils.localStreamEncodingsConfig.find((function(e){return e.scaleResolutionDownBy===d}));p&&(R.info("".concat(this," Setting max bitrate=").concat(p.maxBitrate," bps on track=").concat(e)),l=p.maxBitrate)}a.encodings[0].maxBitrate=l}return this.tpcUtils.updateEncodingsResolution(a),r.setParameters(a)},w.prototype.setRemoteDescription=function(e){var t=this;if(this.trace("setRemoteDescription::preTransform",N(e)),e=this._mungeCodecOrder(e),e=this._mungeOpus(e),this._usesUnifiedPlan){if(!this.isP2P){var n=this.peerconnection.remoteDescription;e=this.interop.toUnifiedPlan(e,n),this.trace("setRemoteDescription::postTransform (Unified)",N(e)),this.isSimulcastOn()&&(e=this.simulcast.mungeRemoteDescription(e),e=this.tpcUtils.insertUnifiedPlanSimulcastReceive(e),this.trace("setRemoteDescription::postTransform (sim receive)",N(e)))}}else this.isSimulcastOn()&&(e=this.simulcast.mungeRemoteDescription(e,!0),this.trace("setRemoteDescription::postTransform (simulcast)",N(e))),e=D(e);return this._usesUnifiedPlan&&(e=this.tpcUtils.ensureCorrectOrderOfSsrcs(e)),new Promise((function(n,i){t.peerconnection.setRemoteDescription(e).then((function(){t.trace("setRemoteDescriptionOnSuccess");var i=S.a.getUfrag(e.sdp);i!==t.remoteUfrag&&(t.remoteUfrag=i,t.eventEmitter.emit(f.a.REMOTE_UFRAG_CHANGED,t,i)),n()}),(function(e){t.trace("setRemoteDescriptionOnFailure",e),t.eventEmitter.emit(f.a.SET_REMOTE_DESCRIPTION_FAILED,e,t),i(e)}))}))},w.prototype.setSenderVideoConstraint=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(t<0)throw new Error("Invalid frameHeight: ".concat(t));if(g.a.isReactNative())return Promise.resolve();var n=null===t?this.senderVideoMaxHeight:t;if(this.senderVideoMaxHeight=n,null===n)return Promise.resolve();R.log("".concat(this," senderVideoMaxHeight: ").concat(n));var i=this.getLocalVideoTrack();if(!i||i.isMuted())return Promise.resolve();var r=this.findSenderByKind(h.c);if(!r)return Promise.resolve();var a=r.getParameters();if(!a||!a.encodings||!a.encodings.length)return Promise.resolve();if(this.isSimulcastOn()){this.encodingsEnabledState=this.tpcUtils.getLocalStreamHeightConstraints(i.track).map((function(e){return e<=n}));var o=this.tpcUtils.localStreamEncodingsConfig.findIndex((function(e){return 4===e.scaleResolutionDownBy}));for(var s in n>0&&-1!==o&&(this.encodingsEnabledState[o]=!0),a.encodings)a.encodings.hasOwnProperty(s)&&(a.encodings[s].active=this.encodingsEnabledState[s]);this.tpcUtils.updateEncodingsResolution(a)}else n>0?(a.encodings[0].scaleResolutionDownBy=i.videoType===v.DESKTOP||i.resolution<=n?1:i.resolution?Math.floor(i.resolution/n):void 0,a.encodings[0].active=!0):(a.encodings[0].scaleResolutionDownBy=void 0,a.encodings[0].active=!1);return R.info("".concat(this," setting max height=").concat(n,",encodings=").concat(JSON.stringify(a.encodings))),r.setParameters(a).then((function(){if(i.maxEnabledResolution=n,e.eventEmitter.emit(f.a.LOCAL_TRACK_MAX_ENABLED_RESOLUTION_CHANGED,i),e.isP2P||!e.isSimulcastOn())return e.setMaxBitRate()}))},w.prototype.setVideoTransferActive=function(e){R.debug("".concat(this," video transfer active: ").concat(e));var t=this.videoTransferActive!==e;return this.videoTransferActive=e,this._usesUnifiedPlan?(this.tpcUtils.setVideoTransferActive(e),!1):t},w.prototype.sendTones=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;if(!this._dtmfSender){if(this.peerconnection.getSenders){var i=this.peerconnection.getSenders().find((function(e){return e.dtmf}));this._dtmfSender=i&&i.dtmf,this._dtmfSender&&R.info("".concat(this," initialized DTMFSender using getSenders"))}if(!this._dtmfSender){var r=Array.from(this.localTracks.values()).find((function(e){return e.isAudioTrack()}));this.peerconnection.createDTMFSender&&r&&(this._dtmfSender=this.peerconnection.createDTMFSender(r.getTrack())),this._dtmfSender&&R.info("".concat(this," initialized DTMFSender using deprecated createDTMFSender"))}this._dtmfSender&&(this._dtmfSender.ontonechange=this._onToneChange.bind(this))}if(this._dtmfSender){if(this._dtmfSender.toneBuffer)return void this._dtmfTonesQueue.push({tones:e,duration:t,interToneGap:n});this._dtmfSender.insertDTMF(e,t,n)}else R.warn("".concat(this," sendTones - failed to select DTMFSender"))},w.prototype._onToneChange=function(e){if(this._dtmfSender&&""===e.tone&&this._dtmfTonesQueue.length){var t=this._dtmfTonesQueue.shift(),n=t.tones,i=t.duration,r=t.interToneGap;this._dtmfSender.insertDTMF(n,i,r)}},w.prototype.generateRecvonlySsrc=function(){var e=S.a.generateSsrc();R.info("".concat(this," generated new recvonly SSRC=").concat(e)),this.sdpConsistency.setPrimarySsrc(e)},w.prototype.clearRecvonlySsrc=function(){R.info("".concat(this," Clearing primary video SSRC!")),this.sdpConsistency.clearVideoSsrcCache()},w.prototype.close=function(){this.trace("stop"),this.signalingLayer.off(m.a,this._peerMutedChanged),this.signalingLayer.off(m.b,this._peerVideoTypeChanged),this._usesUnifiedPlan&&this.peerconnection.removeEventListener("track",this.onTrack);var e,t=Object(r.a)(this.remoteTracks.values());try{for(t.s();!(e=t.n()).done;){var n,i=e.value,a=Object(r.a)(i.values());try{for(a.s();!(n=a.n()).done;){var o=n.value;this._removeRemoteTrack(o)}}catch(s){a.e(s)}finally{a.f()}}}catch(s){t.e(s)}finally{t.f()}this.remoteTracks.clear(),this._addedStreams=[],this._dtmfSender=null,this._dtmfTonesQueue=[],this.rtc._removePeerConnection(this)||R.error("".concat(this," RTC._removePeerConnection returned false")),null!==this.statsinterval&&(window.clearInterval(this.statsinterval),this.statsinterval=null),R.info("".concat(this," Closing peerconnection")),this.peerconnection.close()},w.prototype.createAnswer=function(e){return this._createOfferOrAnswer(!1,e)},w.prototype.createOffer=function(e){return this._createOfferOrAnswer(!0,e)},w.prototype._createOfferOrAnswer=function(e,t){var n=this,i=e?"Offer":"Answer";this.trace("create".concat(i),JSON.stringify(t,null," "));var a=function(e,t,a){try{n.trace("create".concat(i,"OnSuccess::preTransform"),N(e)),n._usesUnifiedPlan||(n.hasAnyTracksOfType(h.c)||n.sdpConsistency.hasPrimarySsrcCached()||n.generateRecvonlySsrc(),e=new RTCSessionDescription({type:e.type,sdp:n.sdpConsistency.makeVideoPrimarySsrcsConsistent(e.sdp)}),n.trace("create".concat(i,"OnSuccess::postTransform ")+"(make primary audio/video ssrcs consistent)",N(e))),n.isSimulcastOn()&&g.a.usesSdpMungingForSimulcast()&&(!n.options.capScreenshareBitrate||n.options.capScreenshareBitrate&&!n._isSharingScreen())&&(e=n.simulcast.mungeLocalDescription(e),n.trace("create".concat(i)+"OnSuccess::postTransform (simulcast)",N(e))),!n.options.disableRtx&&g.a.usesSdpMungingForSimulcast()&&(e=new RTCSessionDescription({type:e.type,sdp:n.rtxModifier.modifyRtxSsrcs(e.sdp)}),n.trace("create".concat(i)+"OnSuccess::postTransform (rtx modifier)",N(e)));var o=function(e){var t=new Map,n=new Map;if("object"!==typeof e||null===e||"string"!==typeof e.sdp)return R.warn("An empty description was passed as an argument"),t;var i=c.a.parse(e.sdp);if(!Array.isArray(i.media))return t;var a,o=Object(r.a)(i.media);try{for(o.s();!(a=o.n()).done;){var s=a.value;if(Array.isArray(s.ssrcs)){if(Array.isArray(s.ssrcGroups)){var u,l=Object(r.a)(s.ssrcGroups);try{for(l.s();!(u=l.n()).done;){var d=u.value;if("undefined"!==typeof d.semantics&&"undefined"!==typeof d.ssrcs){var h=d.ssrcs.split(" ").map((function(e){return parseInt(e,10)})),p=h[0];d.ssrcs=h,n.has(p)||n.set(p,[]),n.get(p).push(d)}}}catch(C){l.e(C)}finally{l.f()}}var f,m=Object(r.a)(s.ssrcs);try{for(m.s();!(f=m.n()).done;){var v=f.value;if("msid"===v.attribute){var g=v.value,b=t.get(g);b||(b={ssrcs:[],groups:[],msid:g},t.set(g,b));var y=v.id;if(b.ssrcs.push(y),n.has(y)){var E,S=n.get(y),O=Object(r.a)(S);try{for(O.s();!(E=O.n()).done;){var _=E.value;b.groups.push(_)}}catch(C){O.e(C)}finally{O.f()}}}}}catch(C){m.e(C)}finally{m.f()}}}}catch(C){o.e(C)}finally{o.f()}return t}(e);R.debug("Got local SSRCs MAP: ",o),n._processLocalSSRCsMap(o),t(e)}catch(s){n.trace("create".concat(i,"OnError"),s),n.trace("create".concat(i,"OnError"),N(e)),R.error("".concat(n," create").concat(i,"OnError"),s,N(e)),a(s)}};if(this._usesTransceiverCodecPreferences){var o=this.peerconnection.getTransceivers().find((function(e){var t,n;return e.receiver&&(null===(t=e.receiver)||void 0===t||null===(n=t.track)||void 0===n?void 0:n.kind)===h.c}));if(o){var s,u,l,d=null===(s=RTCRtpReceiver.getCapabilities(h.c))||void 0===s?void 0:s.codecs,p=null===(u=this.codecPreference)||void 0===u?void 0:u.mimeType,m=null===(l=this.codecPreference)||void 0===l?void 0:l.enable;d&&p&&m?d.sort((function(e){return e.mimeType.toLowerCase()==="".concat(h.c,"/").concat(p)?-1:1})):d&&p&&(d=d.filter((function(e){return e.mimeType.toLowerCase()!=="".concat(h.c,"/").concat(p)})));try{o.setCodecPreferences(d)}catch(v){R.warn("".concat(this," Setting codec[preference=").concat(p,",enable=").concat(m,"] failed"),v)}}}return new Promise((function(r,o){(e?n.peerconnection.createOffer(t):n.peerconnection.createAnswer(t)).then((function(e){return a(e,r,o)}),(function(t){return function(t,r){n.trace("create".concat(i,"OnFailure"),t);var a=e?f.a.CREATE_OFFER_FAILED:f.a.CREATE_ANSWER_FAILED;n.eventEmitter.emit(a,t,n),r(t)}(t,o)}))}))},w.prototype._extractPrimarySSRC=function(e){return e&&e.groups&&e.groups.length?e.groups[0].ssrcs[0]:e&&e.ssrcs&&e.ssrcs.length?e.ssrcs[0]:null},w.prototype._processLocalSSRCsMap=function(e){var t,n=Object(r.a)(this.localTracks.values());try{for(n.s();!(t=n.n()).done;){var i=t.value,a=i.storedMSID;if(e.has(a)){var o=e.get(a);if(!o)return void R.error("".concat(this," No SSRC found for stream=").concat(a));var s=this.localSSRCs.get(i.rtcId),c=this._extractPrimarySSRC(o),u=this._extractPrimarySSRC(s);c!==u&&(u&&R.error("".concat(this," Overwriting SSRC for [track=").concat(i,",id=").concat(a,"]")+" with ssrc=".concat(o)),this.localSSRCs.set(i.rtcId,o),this.eventEmitter.emit(f.a.LOCAL_TRACK_SSRC_UPDATED,i,c))}else i.isVideoTrack()||i.isMuted()||R.warn("".concat(this," No SSRCs found in the local SDP for track[track=").concat(i,",id=").concat(a,"]"))}}catch(l){n.e(l)}finally{n.f()}},w.prototype.addIceCandidate=function(e){return this.trace("addIceCandidate",JSON.stringify({candidate:e.candidate,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex,usernameFragment:e.usernameFragment},null," ")),this.peerconnection.addIceCandidate(e)},w.prototype.getActiveSimulcastStreams=function(){var e,t=1;this.isSimulcastOn()&&this.encodingsEnabledState?t=null===(e=this.encodingsEnabledState.filter((function(e){return Boolean(e)})))||void 0===e?void 0:e.length:this.isSimulcastOn()&&(t=k.a.length);return t},w.prototype.getStats=function(){return this.peerconnection.getStats()},w.prototype.generateNewStreamSSRCInfo=function(e){var t=e.rtcId,n=this._getSSRC(t);if(n&&R.error("".concat(this," Overwriting local SSRCs for track id=").concat(t)),this.isSimulcastOn()&&(!this.options.capScreenshareBitrate||this.options.capScreenshareBitrate&&!this._isSharingScreen())){n={ssrcs:[],groups:[]};for(var i=0;i<k.a.length;i++)n.ssrcs.push(S.a.generateSsrc());n.groups.push({ssrcs:n.ssrcs.slice(),semantics:"SIM"})}else n={ssrcs:[S.a.generateSsrc()],groups:[]};if(!this.options.disableRtx)for(var r=n.ssrcs.length,a=0;a<r;++a){var o=n.ssrcs[a],s=S.a.generateSsrc();n.ssrcs.push(s),n.groups.push({ssrcs:[o,s],semantics:"FID"})}return n.msid=e.storedMSID,this.localSSRCs.set(t,n),n},w.prototype.toString=function(){return"TPC[id=".concat(this.id,",type=").concat(this.isP2P?"P2P":"JVB","]")}}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return p}));var i=n(69),r=n(15),a=n(6),o=n(8),s=n(18),c=n(39),u=n.n(c),l=n(19),d=n(97),h=Object(s.getLogger)(e),p=function(){function e(t,n){Object(a.a)(this,e),this.tpc=t,this.localEndpointId=n}return Object(o.a)(e,[{key:"_addMutedLocalVideoTracksToSDP",value:function(e){var t=this.tpc.getLocalTracks(l.c);if(!t.length)return!1;1!==t.length&&h.error("".concat(this.tpc," there is more than 1 video track ! ")+"Strange things may happen !",t);var n=e.selectMedia("video");if(!n)return h.debug("".concat(this.tpc," unable to hack local video track SDP")+'- no "video" media'),!1;var i,a=!1,o=Object(r.a)(t);try{for(o.s();!(i=o.n()).done;){var s=i.value,c=s.isMuted(),d=s.getOriginalStream(),p=d&&this.tpc.isMediaStreamInPc(d);if(c||!p){var f=this.tpc.isSimulcastOn()?this.tpc.simulcast.ssrcCache:[this.tpc.sdpConsistency.cachedPrimarySsrc];if(f.length){a=!0,n.direction=u.a.SENDRECV;var m,v=f[0],g="injected-".concat(v),b=Object(r.a)(f);try{for(b.s();!(m=b.n()).done;){var y=m.value;n.removeSSRC(y),n.addSSRCAttribute({id:y,attribute:"cname",value:g}),n.addSSRCAttribute({id:y,attribute:"msid",value:s.storedMSID})}}catch(S){b.e(S)}finally{b.f()}if(f.length>1){var E={ssrcs:f.join(" "),semantics:"SIM"};n.findGroup(E.semantics,E.ssrcs)||n.addSSRCGroup(E)}this.tpc.options.disableRtx||this.tpc.rtxModifier.modifyRtxSsrcs2(n)}else h.error("No SSRCs stored for: ".concat(s," in ").concat(this.tpc))}}}catch(S){o.e(S)}finally{o.f()}return a}},{key:"_generateMsidAttribute",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e||!t)return h.warn("Unable to munge local MSID - track id=".concat(t," or media type=").concat(e," is missing")),null;var i=this.tpc.id;return"-"!==n&&n?"".concat(n,"-").concat(i," ").concat(t,"-").concat(i):"".concat(this.localEndpointId,"-").concat(e,"-").concat(i," ").concat(t,"-").concat(i)}},{key:"_transformMediaIdentifiers",value:function(e){var t,n,a,o,s=this,c=this.tpc.id,l=Object(r.a)(e.ssrcs);try{for(l.s();!(o=l.n()).done;){var d=o.value;switch(d.attribute){case"cname":case"label":case"mslabel":d.value=d.value&&"".concat(d.value,"-").concat(c);break;case"msid":if(d.value){var p,f=d.value.split(" ");if(2===f.length)d.value=this._generateMsidAttribute(null===(p=e.mLine)||void 0===p?void 0:p.type,f[1],f[0]);else h.warn("Unable to munge local MSID - weird format detected: ".concat(d.value))}}}}catch(T){l.e(T)}finally{l.f()}var m=e.ssrcs.find((function(e){return"msid"===e.attribute}));if(this.tpc.isP2P||m&&(null===(t=e.mLine)||void 0===t?void 0:t.direction)!==u.a.RECVONLY&&(null===(n=e.mLine)||void 0===n?void 0:n.direction)!==u.a.INACTIVE){if(this.tpc.isP2P&&(null===(a=e.mLine)||void 0===a?void 0:a.direction)===u.a.SENDRECV){var v,g,b,y,E=null===(v=e.mLine)||void 0===v?void 0:v.msid,S=E&&E.split(" ")[1],O=Object(i.a)(new Set(null===(g=e.mLine)||void 0===g||null===(b=g.ssrcs)||void 0===b?void 0:b.map((function(e){return e.id})))),_=Object(r.a)(O);try{var C=function(){var t=y.value;if(!e.ssrcs.find((function(e){return e.id===t&&"msid"===e.attribute}))){var n,i=s._generateMsidAttribute(null===(n=e.mLine)||void 0===n?void 0:n.type,S);e.ssrcs.push({id:t,attribute:"msid",value:i})}};for(_.s();!(y=_.n()).done;)C()}catch(T){_.e(T)}finally{_.f()}}}else e.ssrcs=void 0,e.ssrcGroups=void 0}},{key:"maybeAddMutedLocalVideoTracksToSDP",value:function(e){if(!e)throw new Error("No local description passed in.");var t=new d.a(e.sdp);return this._addMutedLocalVideoTracksToSDP(t)?new RTCSessionDescription({type:e.type,sdp:t.toRawSDP()}):e}},{key:"transformStreamIdentifiers",value:function(e){if(!e||!e.sdp||!e.type)return e;var t=new d.a(e.sdp),n=t.selectMedia("audio");n&&this._transformMediaIdentifiers(n);var i=t.selectMedia("video");return i&&this._transformMediaIdentifiers(i),new RTCSessionDescription({type:e.type,sdp:t.toRawSDP()})}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return d}));var i=n(15),r=n(6),a=n(8),o=n(18),s=n(34),c=n(97),u=Object(o.getLogger)(e);function l(e,t,n){var i=t.id,r=t.msid,a=t.cname,o=e.getRtxSSRC(i);o!==n&&(o&&(e.removeSSRC(o),e.removeGroupsWithSSRC(o)),e.addSSRCAttribute({id:n,attribute:"cname",value:a}),e.addSSRCAttribute({id:n,attribute:"msid",value:r}),e.addSSRCGroup({semantics:"FID",ssrcs:"".concat(i," ").concat(n)}))}var d=function(){function e(){Object(r.a)(this,e),this.correspondingRtxSsrcs=new Map}return Object(a.a)(e,[{key:"clearSsrcCache",value:function(){this.correspondingRtxSsrcs.clear()}},{key:"setSsrcCache",value:function(e){u.debug("Setting ssrc cache to ",e),this.correspondingRtxSsrcs=e}},{key:"modifyRtxSsrcs",value:function(e){var t=new c.a(e),n=t.selectMedia("video");return n?this.modifyRtxSsrcs2(n)?t.toRawSDP():e:(u.debug("No 'video' media found in the sdp: ".concat(e)),e)}},{key:"modifyRtxSsrcs2",value:function(e){if("recvonly"===e.direction)return!1;if(e.getSSRCCount()<1)return!1;var t,n=e.getPrimaryVideoSSRCs(),r=Object(i.a)(n);try{for(r.s();!(t=r.n()).done;){var a=t.value,o=e.getSSRCAttrValue(a,"msid"),c=e.getSSRCAttrValue(a,"cname"),u=this.correspondingRtxSsrcs.get(a);if(!u){var d=e.getRtxSSRC(a);u=d||s.a.generateSsrc(),this.correspondingRtxSsrcs.set(a,u)}l(e,{id:a,cname:c,msid:o},u)}}catch(h){r.e(h)}finally{r.f()}return!0}},{key:"stripRtx",value:function(e){var t=new c.a(e),n=t.selectMedia("video");if(!n)return u.debug("No 'video' media found in the sdp: ".concat(e)),e;if("recvonly"===n.direction)return u.debug("RtxModifier doing nothing, video m line is recvonly"),e;if(n.getSSRCCount()<1)return u.debug("RtxModifier doing nothing, no video ssrcs present"),e;if(!n.containsAnySSRCGroups())return u.debug("RtxModifier doing nothing, no video ssrcGroups present"),e;var r=n.findGroups("FID");n.removeGroupsBySemantics("FID");var a,o=Object(i.a)(r);try{for(o.s();!(a=o.n()).done;){var s=a.value,l=Object(c.c)(s);n.removeSSRC(l)}}catch(d){o.e(d)}finally{o.f()}return t.toRawSDP()}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u}));var i=n(15),r=n(6),a=n(8),o=n(18),s=n(97),c=Object(o.getLogger)(e),u=function(){function e(t){Object(r.a)(this,e),this.clearVideoSsrcCache(),this.logPrefix=t}return Object(a.a)(e,[{key:"clearVideoSsrcCache",value:function(){this.cachedPrimarySsrc=null,this.injectRecvOnly=!1}},{key:"setPrimarySsrc",value:function(e){if("number"!==typeof e)throw new Error("Primary SSRC must be a number!");this.cachedPrimarySsrc=e}},{key:"hasPrimarySsrcCached",value:function(){return Boolean(this.cachedPrimarySsrc)}},{key:"makeVideoPrimarySsrcsConsistent",value:function(e){var t=new s.a(e),n=t.selectMedia("video");if(!n)return c.debug("".concat(this.logPrefix," no 'video' media found in the sdp: ").concat(e)),e;if("recvonly"===n.direction)this.cachedPrimarySsrc&&this.injectRecvOnly?n.addSSRCAttribute({id:this.cachedPrimarySsrc,attribute:"cname",value:"recvonly-".concat(this.cachedPrimarySsrc)}):c.info("".concat(this.logPrefix," no SSRC found for the recvonly video stream!"));else{var r=n.getPrimaryVideoSsrc();if(!r)return c.info("".concat(this.logPrefix," sdp-consistency couldn't parse new primary ssrc")),e;if(this.cachedPrimarySsrc){n.replaceSSRC(r,this.cachedPrimarySsrc);var a,o=Object(i.a)(n.ssrcGroups);try{for(o.s();!(a=o.n()).done;){var u=a.value;if("FID"===u.semantics){var l=Object(s.b)(u),d=Object(s.c)(u);l===r&&(u.ssrcs="".concat(this.cachedPrimarySsrc," ").concat(d))}}}catch(h){o.e(h)}finally{o.f()}}else this.cachedPrimarySsrc=r;this.injectRecvOnly=!0}return t.toRawSDP()}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return g}));var i=n(6),r=n(8),a=n(31),o=n(36),s=n(35),c=n(59),u=n(32),l=n(26),d=n(216),h=n(18).getLogger(e),p=n(29),f=!1,m=!1,v=["abort","canplay","canplaythrough","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","ratechange","stalled","suspend","waiting"],g=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e,r,o,s,c,u,l,d,p,f){var m;if(Object(i.a)(this,n),(m=t.call(this,r,s,c,(function(){}),u,l)).rtc=e,0===d.length)throw new TypeError("No SSRCs");return d.forEach((function(e){if("number"!==typeof e)throw new TypeError("SSRC ".concat(e," is not a number"))})),m.ssrcs=d,m.ownerEndpointId=o,m.muted=p,m.isP2P=f,h.debug("New remote track added: ".concat(Object(a.a)(m))),m.hasBeenMuted=p,m.rtc&&m.track&&m._bindTrackHandlers(),m._containerHandlers={},v.forEach((function(e){m._containerHandlers[e]=m._containerEventHandler.bind(Object(a.a)(m),e)})),m}return Object(r.a)(n,[{key:"_bindTrackHandlers",value:function(){var e=this;this.track.addEventListener("mute",(function(){return e._onTrackMute()})),this.track.addEventListener("unmute",(function(){return e._onTrackUnmute()})),this.track.addEventListener("ended",(function(){h.debug('"onended" event('.concat(Date.now(),"): ").concat(e))}))}},{key:"_onTrackMute",value:function(){h.debug('"onmute" event('.concat(Date.now(),"): ").concat(this)),this.rtc.eventEmitter.emit(p.REMOTE_TRACK_MUTE,this)}},{key:"_onTrackUnmute",value:function(){h.debug('"onunmute" event('.concat(Date.now(),"): ").concat(this)),this.rtc.eventEmitter.emit(p.REMOTE_TRACK_UNMUTE,this)}},{key:"setMute",value:function(e){this.muted!==e&&(e&&(this.hasBeenMuted=!0),this.stream&&(this.stream.muted=e),this.muted=e,this.emit(c.TRACK_MUTE_CHANGED,this))}},{key:"isMuted",value:function(){return this.muted}},{key:"getParticipantId",value:function(){return this.ownerEndpointId}},{key:"isLocal",value:function(){return!1}},{key:"getSSRC",value:function(){return this.ssrcs[0]}},{key:"getSSRCs",value:function(){return this.ssrcs}},{key:"_setVideoType",value:function(e){this.videoType!==e&&(this.videoType=e,this.emit(c.TRACK_VIDEOTYPE_CHANGED,e))}},{key:"_playCallback",value:function(){var e=this.isVideoTrack()?"video":"audio",t=window.performance.now();console.log("(TIME) Render ".concat(e,":\t"),t),this.conference.getConnectionTimes()["".concat(e,".render")]=t;var n=window.connectionTimes["obtainPermissions.start"],i=window.connectionTimes["obtainPermissions.end"],r=isNaN(i)||isNaN(n)?0:i-n,a=t-(this.conference.getConnectionTimes()["session.initiate"]-this.conference.getConnectionTimes()["muc.joined"])-r;this.conference.getConnectionTimes()["".concat(e,".ttfm")]=a,console.log("(TIME) TTFM ".concat(e,":\t"),a),l.a.sendAnalytics(Object(u.N)({media_type:e,muted:this.hasBeenMuted,value:a}))}},{key:"_attachTTFMTracker",value:function(e){f&&this.isAudioTrack()||m&&this.isVideoTrack()||(this.isAudioTrack()&&(f=!0),this.isVideoTrack()&&(m=!0),e.addEventListener("canplay",this._playCallback.bind(this)))}},{key:"_onTrackAttach",value:function(e){var t=this;h.debug("Track has been attached to a container: ".concat(this)),v.forEach((function(n){e.addEventListener(n,t._containerHandlers[n])}))}},{key:"_onTrackDetach",value:function(e){var t=this;h.debug("Track has been detached from a container: ".concat(this)),v.forEach((function(n){e.removeEventListener(n,t._containerHandlers[n])}))}},{key:"_containerEventHandler",value:function(e){h.debug("".concat(e," handler was called for a container with attached ").concat(this))}},{key:"_getStatus",value:function(){var e=this.track,t=e.enabled,n=e.muted,i=e.readyState;return"readyState: ".concat(i,", muted: ").concat(n,", enabled: ").concat(t)}},{key:"toString",value:function(){return"RemoteTrack[userID: ".concat(this.getParticipantId(),", type: ").concat(this.getType(),", ssrc: ").concat(this.getSSRC(),", p2p: ").concat(this.isP2P,", status: ").concat(this._getStatus(),"]")}}]),n}(d.a)}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return y}));var i=n(6),r=n(8),a=n(18),o=n(10),s=n(71),c=n.n(s),u=n(29),l=n(101),d=n(20),h=n(217),p=n(50),f=n(9),m=Object(a.getLogger)(e),v=[{width:1920,height:1080,layers:3,target:"high",targetRN:4e6},{width:1280,height:720,layers:3,target:"high",targetRN:25e5},{width:960,height:540,layers:3,target:"standard",targetRN:9e5},{width:640,height:360,layers:2,target:"standard",targetRN:5e5},{width:480,height:270,layers:2,target:"low",targetRN:35e4},{width:320,height:180,layers:1,target:"low",targetRN:15e4}],g=800;function b(e,t,n,i){if(n<15e3)return 1;var r=0,a=Math.min(t.height,t.width),o=v.find((function(e){return e.height<=a}));if(o&&e&&i.codec===c.a.VP8){var s=function(){var e=a;if(!(o=v.find((function(t){return t.height===e}))))return"break";r+=d.a.isReactNative()?o.targetRN:i[o.target]};for(a=o.height;a>=180;a/=2){if("break"===s())break}}else o&&(r=d.a.isReactNative()?o.targetRN:i[o.target]);return Math.min(r/1e3,function(e){if(e>6e4)return Number.MAX_SAFE_INTEGER;return g*Math.pow(1.08,e/1e3)}(Math.max(0,n-1e3)))}var y=function(){function e(t,n,r){var a=this;Object(i.a)(this,e),this.eventEmitter=n,this._conference=t,this._localStats={connectionQuality:100,jvbRTT:void 0},this._lastConnectionQualityUpdate=-1,this._remoteStats={},this._timeIceConnected=-1,this._timeVideoUnmuted=-1,r.config.startBitrate&&r.config.startBitrate>0&&(g=r.config.startBitrate),t.on(o.CONNECTION_INTERRUPTED,(function(){a._updateLocalConnectionQuality(0),a.eventEmitter.emit(l.LOCAL_STATS_UPDATED,a._localStats),a._broadcastLocalStats()})),t.room.addListener(f.ICE_CONNECTION_STATE_CHANGED,(function(e,t){e.isP2P||"connected"!==t||(a._timeIceConnected=window.performance.now())})),t.on(o.ENDPOINT_MESSAGE_RECEIVED,(function(e,t){"stats"===t.type&&a._updateRemoteStats(e.getId(),t.values)})),t.on(o.ENDPOINT_STATS_RECEIVED,(function(e,t){a._updateRemoteStats(e.getId(),t)})),t.statistics.addConnectionStatsListener(this._updateLocalStats.bind(this)),t.on(o.TRACK_MUTE_CHANGED,(function(e){e.isVideoTrack()&&(e.isMuted()?a._timeVideoUnmuted=-1:a._maybeUpdateUnmuteTime())})),t.on(o.TRACK_ADDED,(function(e){e.isVideoTrack()&&!e.isMuted()&&a._maybeUpdateUnmuteTime()})),t.rtc.on(u.LOCAL_TRACK_MAX_ENABLED_RESOLUTION_CHANGED,(function(e){a._localStats.maxEnabledResolution=e.maxEnabledResolution})),t.on(o.SERVER_REGION_CHANGED,(function(e){a._localStats.serverRegion=e})),t.on(o.PROPERTIES_CHANGED,(function(e){a._localStats.bridgeCount=Number((e||{})["bridge-count"])}))}return Object(r.a)(e,[{key:"_maybeUpdateUnmuteTime",value:function(){this._timeVideoUnmuted<0&&(this._timeVideoUnmuted=window.performance.now())}},{key:"_calculateConnectionQuality",value:function(e,t,n){var i,r=h[n],a=100;if(this._localStats.packetLoss&&(i=this._localStats.packetLoss.upload,t&&(i*=.5)),t||!r||e===p.DESKTOP||this._timeIceConnected<0||this._timeVideoUnmuted<0)void 0===i?(m.error("Cannot calculate connection quality, unknown packet loss."),a=100):a=i<=2?100:i<=4?70:i<=6?50:i<=8?30:i<=12?10:0;else{var o=this._conference.getActivePeerConnection();if(o){var s=o.isSimulcastOn(),c=o.getTargetVideoBitrates();c.codec=o.getConfiguredVideoCodec();var u=b(s,r,window.performance.now()-Math.max(this._timeVideoUnmuted,this._timeIceConnected),c);u=Math.min(u,2500),a=100*this._localStats.bitrate.upload/u}i&&i>=10&&(a=Math.min(a,30))}if(this._lastConnectionQualityUpdate>0){var l=this._localStats.connectionQuality,d=(window.performance.now()-this._lastConnectionQualityUpdate)/1e3;a=Math.min(a,l+2*d)}return Math.min(100,a)}},{key:"_updateLocalConnectionQuality",value:function(e){this._localStats.connectionQuality=e,this._lastConnectionQualityUpdate=window.performance.now()}},{key:"_broadcastLocalStats",value:function(){var e={bitrate:this._localStats.bitrate,packetLoss:this._localStats.packetLoss,connectionQuality:this._localStats.connectionQuality,jvbRTT:this._localStats.jvbRTT,serverRegion:this._localStats.serverRegion,maxEnabledResolution:this._localStats.maxEnabledResolution,avgAudioLevels:this._localStats.localAvgAudioLevels};try{this._conference.sendEndpointStatsMessage(e)}catch(t){}}},{key:"_updateLocalStats",value:function(e,t){if(!e.isP2P){var n=t.transport&&t.transport.length&&t.transport[0].rtt;this._localStats.jvbRTT=n||void 0}if(e===this._conference.getActivePeerConnection()){var i,r=!this._conference.isConnectionInterrupted(),a=this._conference.getLocalVideoTrack(),o=a?a.videoType:void 0,s=!a||a.isMuted(),c=a?Math.min(a.resolution,a.maxEnabledResolution):null;for(i in s||this._maybeUpdateUnmuteTime(),t)t.hasOwnProperty(i)&&(this._localStats[i]=t[i]);r&&this._updateLocalConnectionQuality(this._calculateConnectionQuality(o,s,c)),this.eventEmitter.emit(l.LOCAL_STATS_UPDATED,this._localStats),this._broadcastLocalStats()}}},{key:"_updateRemoteStats",value:function(e,t){this._remoteStats[e]={bitrate:t.bitrate,packetLoss:t.packetLoss,connectionQuality:t.connectionQuality,jvbRTT:t.jvbRTT,serverRegion:t.serverRegion,maxEnabledResolution:t.maxEnabledResolution,avgAudioLevels:t.avgAudioLevels},this.eventEmitter.emit(l.REMOTE_STATS_UPDATED,e,this._remoteStats[e])}},{key:"getStats",value:function(){return this._localStats}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u}));var i=n(6),r=n(8),a=n(18),o=n(64),s=n(10),c=Object(a.getLogger)(e),u=function(){function e(t){Object(i.a)(this,e),this._conference=t}return Object(r.a)(e,[{key:"_actOnIceFailed",value:function(){var e=this._conference.options.config,t=e.enableForcedReload,n=e.enableIceRestart,i="undefined"!==typeof n&&!n,r=this._conference.room.supportsRestartByTerminate(),a=r&&!n,u=this._conference.restartInProgress&&t;if(c.info("ICE failed,"+" enableForcedReload: ".concat(t,",")+" enableIceRestart: ".concat(n,",")+" restartInProgress: ".concat(this._conference.restartInProgress,",")+" supports restart by terminate: ".concat(r)),i||!n&&!r||u)return c.info("ICE failed, but ICE restarts are disabled"),void this._conference.eventEmitter.emit(s.CONFERENCE_FAILED,o.ICE_FAILED);var l=this._conference.jvbJingleSession,d=l&&l.getIceConnectionState();l?"connected"===d?c.info("ICE connection restored - not sending ICE failed"):(c.info("Sending ICE failed - the connection did not recover, "+"ICE state: ".concat(d,", ")+"use 'session-terminate': ".concat(a)),a?this._conference.jvbJingleSession.terminate((function(){c.info("session-terminate for ice restart - done")}),(function(e){c.error("session-terminate for ice restart - error: ".concat(e.message))}),{reason:"connectivity-error",reasonDescription:"ICE FAILED",requestRestart:!0,sendSessionTerminate:!0}):this._conference.jvbJingleSession.sendIceFailedNotification()):c.warn("Not sending ICE failed - no JVB connection")}},{key:"start",value:function(){var e=this;this._conference.xmpp.ping(65e3).then((function(){e._canceled||(e._iceFailedTimeout=window.setTimeout((function(){e._iceFailedTimeout=void 0,e._actOnIceFailed()}),2e3))}),(function(e){c.error("PING error/timeout - not sending ICE failed",e)}))}},{key:"cancel",value:function(){this._canceled=!0,window.clearTimeout(this._iceFailedTimeout)}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var i=n(6),r=n(8),a=n(31),o=n(36),s=n(35),c=n(55),u=n.n(c),l=n(10),d=n(59),h=n(20),p=n(76),f=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this))._conference=e,r._timeoutTrigger=null,r._hasAudioInput=null,h.a.supportsReceiverStats()||e.statistics.addAudioLevelListener(r._audioLevel.bind(Object(a.a)(r))),e.on(l.TRACK_ADDED,r._trackAdded.bind(Object(a.a)(r))),r}return Object(r.a)(n,[{key:"_clearTriggerTimeout",value:function(){clearTimeout(this._timeoutTrigger),this._timeoutTrigger=null}},{key:"_handleAudioInputStateChange",value:function(e){var t=0!==e;null!==this._hasAudioInput&&this._hasAudioInput===t||(this._hasAudioInput=t,this.emit(p.AUDIO_INPUT_STATE_CHANGE,this._hasAudioInput))}},{key:"_handleNoAudioInputDetection",value:function(e){var t=this;this._eventFired||(0!==e||this._timeoutTrigger?0!==e&&this._timeoutTrigger&&this._clearTriggerTimeout():this._timeoutTrigger=setTimeout((function(){t._eventFired=!0,t.emit(p.NO_AUDIO_INPUT)}),4e3))}},{key:"_audioLevel",value:function(e,t,n,i){if(i&&this._audioTrack){var r=e.localSSRCs.get(this._audioTrack.rtcId);r&&r.ssrcs.includes(t)&&(this._handleAudioInputStateChange(n),this._handleNoAudioInputDetection(n))}}},{key:"_trackAdded",value:function(e){var t=this;e.isLocalAudioTrack()&&(this._audioTrack=e,this._eventFired=!1,this._clearTriggerTimeout(),h.a.supportsReceiverStats()&&(e.on(d.NO_AUDIO_INPUT,(function(e){t._handleNoAudioInputDetection(e)})),e.on(d.TRACK_AUDIO_LEVEL_CHANGED,(function(e){t._handleNoAudioInputDetection(e),t._handleAudioInputStateChange(e)}))))}}]),n}(u.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(6),r=n(8),a=n(10),o=n(29),s=n.n(o),c=function(){function e(t){Object(i.a)(this,e),this.conference=t,t.addEventListener(a.TRACK_AUDIO_LEVEL_CHANGED,this._audioLevel.bind(this)),this.myUserID=this.conference.myUserId()}return Object(r.a)(e,[{key:"_audioLevel",value:function(e,t){!this.conference.isP2PActive()||t<=.6||e===this.myUserID&&this.conference.getLocalAudioTrack().isMuted()||this.conference.rtc.eventEmitter.emit(s.a.DOMINANT_SPEAKER_CHANGED,e)}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var i=n(6),r=n(8),a=n(31),o=n(36),s=n(35),c=n(55),u=n(100),l=n(76),d=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.call(this))._processing=!1,e._scoreArray=[],e._audioLvlArray=[],e._active=!1,e._calculateNoisyScore=e._calculateNoisyScore.bind(Object(a.a)(e)),e}return Object(r.a)(n,[{key:"_calculateNoisyScore",value:function(){var e=Object(u.b)(this._scoreArray),t=Object(u.b)(this._audioLvlArray);e<.2&&t>.04&&(this.emit(l.VAD_NOISY_DEVICE),this._setActiveState(!1)),this.reset()}},{key:"_recordValues",value:function(e,t){this._scoreArray.push(e),this._audioLvlArray.push(t)}},{key:"_setActiveState",value:function(e){this._active=e,this.emit(l.DETECTOR_STATE_CHANGE,this._active)}},{key:"changeMuteState",value:function(e){this._setActiveState(!e),this.reset()}},{key:"isActive",value:function(){return this._active}},{key:"reset",value:function(){this._processing=!1,this._scoreArray=[],this._audioLvlArray=[],clearTimeout(this._processTimeout)}},{key:"processVADScore",value:function(e){if(this._active)if(this._processing){var t=Object(u.c)(e.pcmData);this._recordValues(e.score,Object(u.b)(t))}else if(e.score<.2){var n=Object(u.c)(e.pcmData),i=Object(u.b)(n);i>.02&&(this._processing=!0,this._recordValues(e.score,i),this._processTimeout=setTimeout(this._calculateNoisyScore,1500))}}}]),n}(c.EventEmitter)},function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var i=n(6),r=n(8),a=n(31),o=n(36),s=n(35),c=n(55),u=n(100),l=n(76),d=function(e){Object(o.a)(n,e);var t=Object(s.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.call(this))._processing=!1,e._scoreArray=[],e._active=!1,e._calculateVADScore=e._calculateVADScore.bind(Object(a.a)(e)),e}return Object(r.a)(n,[{key:"_calculateVADScore",value:function(){Object(u.b)(this._scoreArray)>.6&&(this.emit(l.VAD_TALK_WHILE_MUTED),this._setActiveState(!1)),this.reset()}},{key:"_setActiveState",value:function(e){this._active=e,this.emit(l.DETECTOR_STATE_CHANGE,this._active)}},{key:"changeMuteState",value:function(e){this._setActiveState(e),this.reset()}},{key:"isActive",value:function(){return this._active}},{key:"processVADScore",value:function(e){this._active&&(this._processing?this._scoreArray.push(e.score):e.score>.9&&(this._processing=!0,this._scoreArray.push(e.score),this._processTimeout=setTimeout(this._calculateVADScore,700)))}},{key:"reset",value:function(){this._processing=!1,this._scoreArray=[],clearTimeout(this._processTimeout)}}]),n}(c.EventEmitter)},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return f}));var i=n(6),r=n(8),a=n(18),o=n(10),s=n(220),c=n(32),u=n(26),l=Object(a.getLogger)(e),d="e2e-ping-request",h="e2e-ping-response",p=function(){function e(t,n){Object(i.a)(this,e),this.participant=t,this.e2eping=n,this.id=t.getId(),this.requests={},this.lastRequestId=1,this.clearIntervals=this.clearIntervals.bind(this),this.sendRequest=this.sendRequest.bind(this),this.handleResponse=this.handleResponse.bind(this),this.maybeSendAnalytics=this.maybeSendAnalytics.bind(this),this.sendAnalytics=this.sendAnalytics.bind(this),n.isDataChannelOpen&&this.sendRequest(),this.pingInterval=window.setInterval(this.sendRequest,n.pingIntervalMs),this.analyticsInterval=window.setTimeout(this.maybeSendAnalytics,this.e2eping.analyticsIntervalMs)}return Object(r.a)(e,[{key:"clearIntervals",value:function(){this.pingInterval&&window.clearInterval(this.pingInterval),this.analyticsInterval&&window.clearInterval(this.analyticsInterval)}},{key:"sendRequest",value:function(){var e=this.lastRequestId++,t={type:d,id:e};this.e2eping.sendMessage(t,this.id),this.requests[e]={id:e,timeSent:window.performance.now()}}},{key:"handleResponse",value:function(e){var t=this.requests[e.id];t&&(t.rtt=window.performance.now()-t.timeSent,this.e2eping.eventEmitter.emit(s.E2E_RTT_CHANGED,this.participant,t.rtt)),this.maybeSendAnalytics()}},{key:"maybeSendAnalytics",value:function(){var e,t,n=window.performance.now(),i=1/0;for(t in this.requests)this.requests.hasOwnProperty(t)&&((e=this.requests[t]).timeSent<n-this.e2eping.analyticsIntervalMs?delete this.requests[t]:e.rtt&&(i=Math.min(i,e.rtt)));i<1/0&&this.sendAnalytics(i)}},{key:"sendAnalytics",value:function(e){u.a.sendAnalytics(Object(c.D)(this.id,this.participant.getProperty("region"),e))}}]),e}(),f=function(){function e(t,n,r){Object(i.a)(this,e),this.conference=t,this.eventEmitter=t.eventEmitter,this.sendMessage=r,this.pingIntervalMs=1e4,this.analyticsIntervalMs=6e4,this.participants={},this.isDataChannelOpen=!1,n&&n.e2eping&&("number"===typeof n.e2eping.pingInterval&&(this.pingIntervalMs=n.e2eping.pingInterval),"number"===typeof n.e2eping.analyticsInterval&&(this.analyticsIntervalMs=n.e2eping.analyticsInterval),this.analyticsIntervalMs>0&&this.analyticsIntervalMs<this.pingIntervalMs&&(this.analyticsIntervalMs=this.pingIntervalMs)),l.info("Initializing e2e ping; pingInterval=".concat(this.pingIntervalMs,", analyticsInterval=").concat(this.analyticsIntervalMs,".")),this.participantJoined=this.participantJoined.bind(this),t.on(o.USER_JOINED,this.participantJoined),this.participantLeft=this.participantLeft.bind(this),t.on(o.USER_LEFT,this.participantLeft),this.messageReceived=this.messageReceived.bind(this),t.on(o.ENDPOINT_MESSAGE_RECEIVED,this.messageReceived),this.dataChannelOpened=this.dataChannelOpened.bind(this),t.on(o.DATA_CHANNEL_OPENED,this.dataChannelOpened)}return Object(r.a)(e,[{key:"dataChannelOpened",value:function(){for(var e in this.isDataChannelOpen=!0,this.participants)if(this.participants.hasOwnProperty(e)){var t=this.participants[e];window.setTimeout(t.sendRequest,200)}}},{key:"messageReceived",value:function(e,t){t.type===d?this.handleRequest(e.getId(),t):t.type===h&&this.handleResponse(e.getId(),t)}},{key:"participantJoined",value:function(e,t){this.pingIntervalMs<=0||(this.participants[e]&&(l.info("Participant wrapper already exists for ".concat(e,". Clearing.")),this.participants[e].clearIntervals(),delete this.participants[e]),this.participants[e]=new p(t,this))}},{key:"participantLeft",value:function(e){this.pingIntervalMs<=0||this.participants[e]&&(this.participants[e].clearIntervals(),delete this.participants[e])}},{key:"handleRequest",value:function(e,t){if(t&&t.id){var n={type:h,id:t.id};this.sendMessage(n,e)}else l.info("Received an invalid e2e ping request from ".concat(e,"."))}},{key:"handleResponse",value:function(e,t){var n=this.participants[e];n&&n.handleResponse(t)}},{key:"stop",value:function(){for(var e in l.info("Stopping e2eping"),this.conference.off(o.USER_JOINED,this.participantJoined),this.conference.off(o.USER_LEFT,this.participantLeft),this.conference.off(o.ENDPOINT_MESSAGE_RECEIVED,this.messageReceived),this.conference.off(o.DATA_CHANNEL_OPENED,this.dataChannelOpened),this.participants)this.participants.hasOwnProperty(e)&&this.participants[e].clearIntervals();this.participants={}}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return c}));var i=n(6),r=n(8),a=n(18),o=n(10),s=Object(a.getLogger)(e),c=function(){function e(t){var n=this;Object(i.a)(this,e),this._conference=t,this._jvb121=!0,this._conference.addEventListener(o.USER_JOINED,(function(){return n.evaluateStatus()})),this._conference.addEventListener(o.USER_LEFT,(function(){return n.evaluateStatus()})),this._conference.addEventListener(o.P2P_STATUS,(function(){return n.evaluateStatus()}))}return Object(r.a)(e,[{key:"evaluateStatus",value:function(){var e=this._jvb121,t=!this._conference.isP2PActive()&&this._conference.getParticipantCount()<=2;e!==t&&(this._jvb121=t,s.debug("JVB121 status ".concat(e," => ").concat(t)),this._conference.eventEmitter.emit(o.JVB121_STATUS,e,t))}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return h}));var i=n(15),r=n(6),a=n(8),o=n(18),s=n(105),c=n.n(s),u=n(10),l=Object(o.getLogger)(e),d=function(){function e(){Object(r.a)(this,e),this._defaultConstraints={maxHeight:180},this._lastN=-1,this._maxFrameHeight=2160,this._selectedEndpoints=[],this._receiverVideoConstraints={constraints:{},defaultConstraints:this.defaultConstraints,lastN:this._lastN,onStageEndpoints:[],selectedEndpoints:this._selectedEndpoints}}return Object(a.a)(e,[{key:"constraints",get:function(){return this._receiverVideoConstraints.lastN=this._lastN,this._selectedEndpoints.length?(this._receiverVideoConstraints.constraints={},this._selectedEndpoints.length>1?(this._receiverVideoConstraints.defaultConstraints={maxHeight:this._maxFrameHeight},this._receiverVideoConstraints.onStageEndpoints=[],this._receiverVideoConstraints.selectedEndpoints=[]):(this._receiverVideoConstraints.constraints[this._selectedEndpoints[0]]={maxHeight:this._maxFrameHeight},this._receiverVideoConstraints.defaultConstraints=this._defaultConstraints,this._receiverVideoConstraints.onStageEndpoints=this._selectedEndpoints,this._receiverVideoConstraints.selectedEndpoints=[]),this._receiverVideoConstraints):this._receiverVideoConstraints}},{key:"updateLastN",value:function(e){var t=this._lastN!==e;return t&&(this._lastN=e,l.debug("Updating ReceiverVideoConstraints lastN(".concat(e,")"))),t}},{key:"updateReceiveResolution",value:function(e){var t=this._maxFrameHeight!==e;return t&&(this._maxFrameHeight=e,l.debug("Updating receive maxFrameHeight: ".concat(e))),t}},{key:"updateReceiverVideoConstraints",value:function(e){var t=!c()(this._receiverVideoConstraints,e);return t&&(this._receiverVideoConstraints=e,l.debug("Updating ReceiverVideoConstraints ".concat(JSON.stringify(e)))),t}},{key:"updateSelectedEndpoints",value:function(e){l.debug("Updating selected endpoints: ".concat(JSON.stringify(e))),this._selectedEndpoints=e}}]),e}(),h=function(){function e(t,n){var i,a,o=this;Object(r.a)(this,e),this._conference=t,this._rtc=n;var s=t.options.config;(this._lastN=null!==(i=null===s||void 0===s?void 0:s.startLastN)&&void 0!==i?i:(null===s||void 0===s?void 0:s.channelLastN)||-1,this._maxFrameHeight=2160,null===(a=null===s||void 0===s?void 0:s.useNewBandwidthAllocationStrategy)||void 0===a||a)?(this._receiverVideoConstraints=new d,this._receiverVideoConstraints.updateLastN(this._lastN)&&this._rtc.setNewReceiverVideoConstraints(this._receiverVideoConstraints.constraints)):this._rtc.setLastN(this._lastN);this._selectedEndpoints=[],this._conference.on(u._MEDIA_SESSION_STARTED,(function(e){return o._onMediaSessionStarted(e)}))}return Object(a.a)(e,[{key:"_onMediaSessionStarted",value:function(e){e.isP2P||!this._receiverVideoConstraints?e.setReceiverVideoConstraint(this._maxFrameHeight):(this._receiverVideoConstraints.updateReceiveResolution(this._maxFrameHeight),this._rtc.setNewReceiverVideoConstraints(this._receiverVideoConstraints.constraints))}},{key:"getLastN",value:function(){return this._lastN}},{key:"selectEndpoints",value:function(e){var t=this;if(this._selectedEndpoints=e,this._receiverVideoConstraints){var n=e.filter((function(e){return e!==t._conference.myUserId()})),i=JSON.parse(JSON.stringify(this._receiverVideoConstraints.constraints));n.length&&this._receiverVideoConstraints.updateSelectedEndpoints(n);var r=this._receiverVideoConstraints.constraints;c()(r,i)||this._rtc.setNewReceiverVideoConstraints(r)}else this._rtc.selectEndpoints(e)}},{key:"setLastN",value:function(e){if(this._lastN!==e){if(this._lastN=e,this._receiverVideoConstraints)return void(this._receiverVideoConstraints.updateLastN(e)&&this._rtc.setNewReceiverVideoConstraints(this._receiverVideoConstraints.constraints));this._rtc.setLastN(e)}}},{key:"setPreferredReceiveMaxFrameHeight",value:function(e){this._maxFrameHeight=e;var t,n=Object(i.a)(this._conference._getMediaSessions());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.isP2P||!this._receiverVideoConstraints)e&&r.setReceiverVideoConstraint(e);else this._receiverVideoConstraints.updateReceiveResolution(e)&&this._rtc.setNewReceiverVideoConstraints(this._receiverVideoConstraints.constraints)}}catch(a){n.e(a)}finally{n.f()}}},{key:"setReceiverConstraints",value:function(e){if(this._receiverVideoConstraints||(this._receiverVideoConstraints=new d),this._receiverVideoConstraints.updateReceiverVideoConstraints(e)){var t,n;this._lastN=null!==(t=e.lastN)&&void 0!==t?t:this._lastN,this._selectedEndpoints=null!==(n=e.selectedEndpoints)&&void 0!==n?n:this._selectedEndpoints,this._rtc.setNewReceiverVideoConstraints(e);var i=this._conference._getMediaSessions().find((function(e){return e.isP2P}));if(i){var r,a,o=null===(r=Object.values(e.constraints)[0])||void 0===r?void 0:r.maxHeight;if(!o)o=null===(a=e.defaultConstraints)||void 0===a?void 0:a.maxHeight;o&&i.setReceiverVideoConstraint(o)}}}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n(15),r=n(6),a=n(8),o=n(10),s=n(29),c=n.n(s),u=n(215),l=function(){function e(t,n){var i,a,s=this;Object(r.a)(this,e),this.conference=t,this.layerSuspensionEnabled=null===(i=t.options)||void 0===i||null===(a=i.config)||void 0===a?void 0:a.enableLayerSuspension,this.rtc=n,this.conference.on(o._MEDIA_SESSION_STARTED,(function(e){return s._onMediaSessionStarted(e)})),this.conference.on(o._MEDIA_SESSION_ACTIVE_CHANGED,(function(){return s._propagateSendMaxFrameHeight()})),this.rtc.on(c.a.SENDER_VIDEO_CONSTRAINTS_CHANGED,(function(e){var t;(null===(t=s._senderVideoConstraints)||void 0===t?void 0:t.idealHeight)!==e.idealHeight&&(s._senderVideoConstraints=e,s._propagateSendMaxFrameHeight())}))}return Object(a.a)(e,[{key:"_onMediaSessionStarted",value:function(e){var t=this;e.addListener(u.a.REMOTE_VIDEO_CONSTRAINTS_CHANGED,(function(e){e===t.conference._getActiveMediaSession()&&t._propagateSendMaxFrameHeight()})),e.setSenderVideoDegradationPreference(),e.setSenderMaxBitrates()}},{key:"_propagateSendMaxFrameHeight",value:function(){var e=this.selectSendMaxFrameHeight(),t=[];if(e>=0){var n,r=Object(i.a)(this.conference._getMediaSessions());try{for(r.s();!(n=r.n()).done;){var a=n.value;t.push(a.setSenderVideoConstraint(e))}}catch(o){r.e(o)}finally{r.f()}}return Promise.all(t)}},{key:"selectSendMaxFrameHeight",value:function(){var e,t=this.conference._getActiveMediaSession(),n=t?t.isP2P?t.getRemoteRecvMaxFrameHeight():this.layerSuspensionEnabled?null===(e=this._senderVideoConstraints)||void 0===e?void 0:e.idealHeight:void 0:void 0;return this.preferredSendMaxFrameHeight>=0&&n>=0?Math.min(this.preferredSendMaxFrameHeight,n):n>=0?n:this.preferredSendMaxFrameHeight}},{key:"setPreferredSendMaxFrameHeight",value:function(e){return this.preferredSendMaxFrameHeight=e,this._propagateSendMaxFrameHeight()}}]),e}()},function(e,t,n){"use strict";(function(e){var i=n(7),r=n(6),a=n(8),o=n(18),s=n(9),c=n.n(s),u=n(286),l=n(169),d=Object(o.getLogger)(e),h=function(){function e(t){Object(r.a)(this,e),this._sessions={},this._chatRoom=t,this.onPresence=this.onPresence.bind(this),this._chatRoom.eventEmitter.addListener(c.a.PRESENCE_RECEIVED,this.onPresence)}return Object(a.a)(e,[{key:"getSession",value:function(e){return this._sessions[e]}},{key:"onPresence",value:function(e){var t=e.fromHiddenDomain,n=e.presence;l.a.isFromFocus(n)?this._handleFocusPresence(n):t&&this._handleJibriPresence(n)}},{key:"startRecording",value:function(e){var t=this,n=new u.a(Object(i.a)(Object(i.a)({},e),{},{connection:this._chatRoom.connection}));return n.start({appData:e.appData,broadcastId:e.broadcastId,focusMucJid:this._chatRoom.focusMucJid,streamId:e.streamId}).then((function(){return t.getSession(n.getID())||(t._addSession(n),t._emitSessionUpdate(n)),n})).catch((function(e){return t._emitSessionUpdate(n),Promise.reject(e)}))}},{key:"stopRecording",value:function(e){var t=this.getSession(e);return t?t.stop({focusMucJid:this._chatRoom.focusMucJid}):Promise.reject(new Error("Could not find session"))}},{key:"_addSession",value:function(e){this._sessions[e.getID()]=e}},{key:"_createSession",value:function(e,t,n){var i=new u.a({connection:this._chatRoom.connection,focusMucJid:this._chatRoom.focusMucJid,mode:n,sessionID:e,status:t});return this._addSession(i),i}},{key:"_emitSessionUpdate",value:function(e,t){this._chatRoom.eventEmitter.emit(c.a.RECORDER_STATE_CHANGED,e,t)}},{key:"_handleFocusPresence",value:function(e){var t=l.a.getFocusRecordingUpdate(e);if(t){var n=t.error,i=t.initiator,r=t.recordingMode,a=t.sessionID,o=t.status,s=this.getSession(a);s||"off"!==o?s&&s.getStatus()===o&&s.getError()===n?d.warn("Ignoring duplicate presence update: ",JSON.stringify(t)):(s||(s=this._createSession(a,o,r)),s.setStatus(o),n&&s.setError(n),this._emitSessionUpdate(s,i)):d.warn("Ignoring recording presence update","Received a new session with status off.")}}},{key:"_handleJibriPresence",value:function(e){var t=l.a.getHiddenDomainUpdate(e),n=t.liveStreamViewURL,i=t.mode,r=t.sessionID;if(r){var a=this.getSession(r);a||(a=this._createSession(r,"",i)),a.setLiveStreamViewURL(n),this._emitSessionUpdate(a)}else d.warn("Ignoring potential jibri presence due to no session id.")}}]),e}();t.a=h}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return h}));var i=n(6),r=n(8),a=n(18),o=n(10),s=n(19),c=n(101),u=n(32),l=n(26),d=Object(a.getLogger)(e),h=function(){function e(t){Object(i.a)(this,e),this._conference=t,this._localAudioLevelCache={},this._reportedParticipants=[],this._audioProblemCandidates={},this._numberOfRemoteAudioLevelsReceived={},this._onLocalAudioLevelsReport=this._onLocalAudioLevelsReport.bind(this),this._onRemoteAudioLevelReceived=this._onRemoteAudioLevelReceived.bind(this),this._clearUserData=this._clearUserData.bind(this),this._conference.on(c.REMOTE_STATS_UPDATED,this._onRemoteAudioLevelReceived),this._conference.statistics.addConnectionStatsListener(this._onLocalAudioLevelsReport),this._conference.on(o.USER_LEFT,this._clearUserData)}return Object(r.a)(e,[{key:"_onRemoteAudioLevelReceived",value:function(e,t){var n=t.avgAudioLevels,i=this._numberOfRemoteAudioLevelsReceived[e]+1||0;if(this._numberOfRemoteAudioLevelsReceived[e]=i,!(-1!==this._reportedParticipants.indexOf(e)||e in this._audioProblemCandidates||n<=0||i<3)){var r=this._conference.getParticipantById(e);if(r)if(r.getTracksByMediaType(s.a).length>0&&r.isAudioMuted())return;var a=this._localAudioLevelCache[e];Array.isArray(a)&&!a.every((function(e){return 0===e}))||(this._audioProblemCandidates[e]={remoteAudioLevels:n,localAudioLevels:[]})}}},{key:"_onLocalAudioLevelsReport",value:function(e,t){var n=this,i=t.avgAudioLevels;e===this._conference.getActivePeerConnection()&&(Object.keys(i).forEach((function(e){if(-1===n._reportedParticipants.indexOf(e)){var t=n._localAudioLevelCache[e];Array.isArray(t)?t.length>=2&&t.shift():n._localAudioLevelCache[e]=[],n._localAudioLevelCache[e].push(i[e])}})),Object.keys(this._audioProblemCandidates).forEach((function(e){var t=n._audioProblemCandidates[e],r=t.localAudioLevels,a=t.remoteAudioLevels;if(r.push(i[e]),2===r.length){if(r.every((function(e){return"undefined"===typeof e||0===e}))){var o=JSON.stringify(r);l.a.sendAnalytics(Object(u.x)(e,o,a)),d.warn("A potential problem is detected with the audio output for participant ".concat(e,", local audio levels: ").concat(o,", remote audio levels: ").concat(a)),n._reportedParticipants.push(e),n._clearUserData(e)}delete n._audioProblemCandidates[e]}})))}},{key:"_clearUserData",value:function(e){delete this._localAudioLevelCache[e]}},{key:"dispose",value:function(){this._conference.off(c.REMOTE_STATS_UPDATED,this._onRemoteAudioLevelReceived),this._conference.off(o.USER_LEFT,this._clearUserData),this._conference.statistics.removeConnectionStatsListener(this._onLocalAudioLevelsReport),this._localAudioLevelCache=void 0,this._audioProblemCandidates=void 0,this._reportedParticipants=void 0,this._numberOfRemoteAudioLevelsReceived=void 0,this._conference=void 0}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return y}));var i=n(15),r=n(6),a=n(8),o=n(18),s=n(105),c=n.n(s),u=n(10),l=n(19),d=n(50),h=n(101),p=n(32),f=n(20),m=n(26),v=Object(o.getLogger)(e),g=function(){function e(t){Object(r.a)(this,e),this.name=t,this.count=0,this.sum=0,this.samples=[]}return Object(a.a)(e,[{key:"addNext",value:function(e){"number"!==typeof e?v.error("".concat(this.name," - invalid value for idx: ").concat(this.count),e):isNaN(e)||(this.sum+=e,this.samples.push(e),this.count+=1)}},{key:"calculate",value:function(){return this.sum/this.count}},{key:"appendReport",value:function(e){e["".concat(this.name,"_avg")]=this.calculate(),e["".concat(this.name,"_samples")]=JSON.stringify(this.samples)}},{key:"reset",value:function(){this.samples=[],this.sum=0,this.count=0}}]),e}(),b=function(){function e(t,n,i){var a=this;Object(r.a)(this,e),this.isP2P=n,this._n=i,this._sampleIdx=0,this._avgRTT=new g("rtt"),this._avgRemoteRTTMap=new Map,this._avgRtpStatsReporter=t,this._avgEnd2EndRTT=void 0,this._onConnectionStats=function(e,t){a.isP2P===e.isP2P&&a._calculateAvgStats(t)};var o=t._conference;o.statistics.addConnectionStatsListener(this._onConnectionStats),this.isP2P||(this._onUserLeft=function(e){return a._avgRemoteRTTMap.delete(e)},o.on(u.USER_LEFT,this._onUserLeft),this._onRemoteStatsUpdated=function(e,t){return a._processRemoteStats(e,t)},o.on(h.REMOTE_STATS_UPDATED,this._onRemoteStatsUpdated))}return Object(a.a)(e,[{key:"_calculateAvgStats",value:function(e){if(e){if(f.a.supportsRTTStatistics()&&e.transport&&e.transport.length&&this._avgRTT.addNext(e.transport[0].rtt),this._sampleIdx+=1,this._sampleIdx>=this._n){if(f.a.supportsRTTStatistics()){var t=this._avgRtpStatsReporter._conference,n={p2p:this.isP2P,conference_size:t.getParticipantCount()};if(e.transport&&e.transport.length&&Object.assign(n,{local_candidate_type:e.transport[0].localCandidateType,remote_candidate_type:e.transport[0].remoteCandidateType,transport_type:e.transport[0].type}),this._avgRTT.appendReport(n),this.isP2P){var i=this._avgRtpStatsReporter.jvbStatsMonitor._avgEnd2EndRTT;isNaN(i)||(n.rtt_diff=this._avgRTT.calculate()-i)}else{var r=this._calculateAvgRemoteRTT(),a=this._avgRTT.calculate();this._avgEnd2EndRTT=a+r,isNaN(a)||isNaN(r)||(n.end2end_rtt_avg=this._avgEnd2EndRTT)}m.a.sendAnalytics(Object(p.L)(n))}this._resetAvgStats()}}else v.error("No stats")}},{key:"_calculateAvgRemoteRTT",value:function(){var e,t=0,n=0,r=Object(i.a)(this._avgRemoteRTTMap.values());try{for(r.s();!(e=r.n()).done;){var a=e.value,o=a.calculate();isNaN(o)||(n+=o,t+=1,a.reset())}}catch(s){r.e(s)}finally{r.f()}return n/t}},{key:"_processRemoteStats",value:function(e,t){var n="number"===typeof t.jvbRTT,i=this._avgRemoteRTTMap.get(e);!i&&n&&(i=new g("".concat(e,"_stat_rtt")),this._avgRemoteRTTMap.set(e,i)),n?i.addNext(t.jvbRTT):i&&this._avgRemoteRTTMap.delete(e)}},{key:"_resetAvgStats",value:function(){this._avgRTT.reset(),this._avgRemoteRTTMap&&this._avgRemoteRTTMap.clear(),this._sampleIdx=0}},{key:"dispose",value:function(){var e=this._avgRtpStatsReporter._conference;e.statistics.removeConnectionStatsListener(this._onConnectionStats),this.isP2P||(e.off(h.REMOTE_STATS_UPDATED,this._onRemoteStatsUpdated),e.off(u.USER_LEFT,this._onUserLeft))}}]),e}(),y=function(){function e(t,n){var i=this;Object(r.a)(this,e),this._n=n,n>0?(v.info("Avg RTP stats will be calculated every ".concat(n," samples")),this._sampleIdx=0,this._conference=t,this._avgAudioBitrateUp=new g("bitrate_audio_upload"),this._avgAudioBitrateDown=new g("bitrate_audio_download"),this._avgVideoBitrateUp=new g("bitrate_video_upload"),this._avgVideoBitrateDown=new g("bitrate_video_download"),this._avgBandwidthUp=new g("bandwidth_upload"),this._avgBandwidthDown=new g("bandwidth_download"),this._avgPacketLossTotal=new g("packet_loss_total"),this._avgPacketLossUp=new g("packet_loss_upload"),this._avgPacketLossDown=new g("packet_loss_download"),this._avgRemoteFPS=new g("framerate_remote"),this._avgRemoteScreenFPS=new g("framerate_screen_remote"),this._avgLocalFPS=new g("framerate_local"),this._avgLocalScreenFPS=new g("framerate_screen_local"),this._avgRemoteCameraPixels=new g("pixels_remote"),this._avgRemoteScreenPixels=new g("pixels_screen_remote"),this._avgLocalCameraPixels=new g("pixels_local"),this._avgLocalScreenPixels=new g("pixels_screen_local"),this._avgCQ=new g("connection_quality"),this._cachedTransportStats=void 0,this._onLocalStatsUpdated=function(e){i._calculateAvgStats(e),i._maybeSendTransportAnalyticsEvent(e)},t.on(h.LOCAL_STATS_UPDATED,this._onLocalStatsUpdated),this._onP2PStatusChanged=function(){v.debug("Resetting average stats calculation"),i._resetAvgStats(),i.jvbStatsMonitor._resetAvgStats(),i.p2pStatsMonitor._resetAvgStats()},t.on(u.P2P_STATUS,this._onP2PStatusChanged),this._onJvb121StatusChanged=function(e,t){!0===t&&(v.info("Resetting JVB avg RTP stats"),i._resetAvgJvbStats())},t.on(u.JVB121_STATUS,this._onJvb121StatusChanged),this.jvbStatsMonitor=new b(this,!1,n),this.p2pStatsMonitor=new b(this,!0,n)):v.info("Avg RTP stats reports are disabled.")}return Object(a.a)(e,[{key:"_calculateAvgStats",value:function(e){if(e){var t=this._conference.isP2PActive(),n=this._conference.getParticipantCount();if(t||!(n<2)){var i=e.bitrate,r=e.bandwidth,a=e.packetLoss,o=e.framerate,s=e.resolution;if(i)if(r)if(a)if(o)if(s){if(this._avgAudioBitrateUp.addNext(i.audio.upload),this._avgAudioBitrateDown.addNext(i.audio.download),this._avgVideoBitrateUp.addNext(i.video.upload),this._avgVideoBitrateDown.addNext(i.video.download),f.a.supportsBandwidthStatistics()&&(this._avgBandwidthUp.addNext(r.upload),this._avgBandwidthDown.addNext(r.download)),this._avgPacketLossUp.addNext(a.upload),this._avgPacketLossDown.addNext(a.download),this._avgPacketLossTotal.addNext(a.total),this._avgCQ.addNext(e.connectionQuality),o&&(this._avgRemoteFPS.addNext(this._calculateAvgVideoFps(o,!1,d.CAMERA)),this._avgRemoteScreenFPS.addNext(this._calculateAvgVideoFps(o,!1,d.DESKTOP)),this._avgLocalFPS.addNext(this._calculateAvgVideoFps(o,!0,d.CAMERA)),this._avgLocalScreenFPS.addNext(this._calculateAvgVideoFps(o,!0,d.DESKTOP))),s&&(this._avgRemoteCameraPixels.addNext(this._calculateAvgVideoPixels(s,!1,d.CAMERA)),this._avgRemoteScreenPixels.addNext(this._calculateAvgVideoPixels(s,!1,d.DESKTOP)),this._avgLocalCameraPixels.addNext(this._calculateAvgVideoPixels(s,!0,d.CAMERA)),this._avgLocalScreenPixels.addNext(this._calculateAvgVideoPixels(s,!0,d.DESKTOP))),this._sampleIdx+=1,this._sampleIdx>=this._n){var c={p2p:t,conference_size:n};e.transport&&e.transport.length&&Object.assign(c,{local_candidate_type:e.transport[0].localCandidateType,remote_candidate_type:e.transport[0].remoteCandidateType,transport_type:e.transport[0].type}),this._avgAudioBitrateUp.appendReport(c),this._avgAudioBitrateDown.appendReport(c),this._avgVideoBitrateUp.appendReport(c),this._avgVideoBitrateDown.appendReport(c),f.a.supportsBandwidthStatistics()&&(this._avgBandwidthUp.appendReport(c),this._avgBandwidthDown.appendReport(c)),this._avgPacketLossUp.appendReport(c),this._avgPacketLossDown.appendReport(c),this._avgPacketLossTotal.appendReport(c),this._avgRemoteFPS.appendReport(c),isNaN(this._avgRemoteScreenFPS.calculate())||this._avgRemoteScreenFPS.appendReport(c),this._avgLocalFPS.appendReport(c),isNaN(this._avgLocalScreenFPS.calculate())||this._avgLocalScreenFPS.appendReport(c),this._avgRemoteCameraPixels.appendReport(c),isNaN(this._avgRemoteScreenPixels.calculate())||this._avgRemoteScreenPixels.appendReport(c),this._avgLocalCameraPixels.appendReport(c),isNaN(this._avgLocalScreenPixels.calculate())||this._avgLocalScreenPixels.appendReport(c),this._avgCQ.appendReport(c),m.a.sendAnalytics(Object(p.L)(c)),this._resetAvgStats()}}else v.error("No resolution");else v.error('No "framerate"');else v.error('No "packetloss"');else v.error('No "bandwidth"');else v.error('No "bitrate"')}}else v.error("No stats")}},{key:"_calculateAvgVideoPixels",value:function(e,t,n){for(var i=0,r=0,a=this._conference.myUserId(),o=0,s=Object.keys(e);o<s.length;o++){var c=s[o];if(t?c===a:c!==a){var u=t?null:this._conference.getParticipantById(c),l=e[c];if((t||u)&&l){var d=this._calculatePeerAvgVideoPixels(l,u,n);isNaN(d)||(i+=d,r+=1)}}}return i/r}},{key:"_calculatePeerAvgVideoPixels",value:function(e,t,n){var r=Object.keys(e).map((function(e){return Number(e)})),a=null,o=this._conference.getActivePeerConnection();t?(a=t.getTracksByMediaType(l.c))&&(r=r.filter((function(e){return a.find((function(t){return!t.isMuted()&&t.getSSRC()===e&&t.videoType===n}))}))):(a=this._conference.getLocalTracks(l.c),r=r.filter((function(e){return a.find((function(t){return!t.isMuted()&&o.getLocalSSRC(t)===e&&t.videoType===n}))})));var s,c=0,u=0,d=Object(i.a)(r);try{for(d.s();!(s=d.n()).done;){var h=s.value,p=Number(e[h].height)*Number(e[h].width);!isNaN(p)&&p>0&&(c+=p,u+=1)}}catch(f){d.e(f)}finally{d.f()}return c/u}},{key:"_calculateAvgVideoFps",value:function(e,t,n){for(var i=0,r=0,a=this._conference.myUserId(),o=0,s=Object.keys(e);o<s.length;o++){var c=s[o];if(t?c===a:c!==a){var u=t?null:this._conference.getParticipantById(c),l=e[c];if((t||u)&&l){var d=this._calculatePeerAvgVideoFps(l,u,n);isNaN(d)||(i+=d,r+=1)}}}return i/r}},{key:"_calculatePeerAvgVideoFps",value:function(e,t,n){var r=Object.keys(e).map((function(e){return Number(e)})),a=null,o=this._conference.getActivePeerConnection();t?(a=t.getTracksByMediaType(l.c))&&(r=r.filter((function(e){return a.find((function(t){return!t.isMuted()&&t.getSSRC()===e&&t.videoType===n}))}))):(a=this._conference.getLocalTracks(l.c),r=r.filter((function(e){return a.find((function(t){return!t.isMuted()&&o.getLocalSSRC(t)===e&&t.videoType===n}))})));var s,c=0,u=0,d=Object(i.a)(r);try{for(d.s();!(s=d.n()).done;){var h=s.value,p=Number(e[h]);!isNaN(p)&&p>0&&(c+=p,u+=1)}}catch(f){d.e(f)}finally{d.f()}return c/u}},{key:"_maybeSendTransportAnalyticsEvent",value:function(e){if(e&&e.transport&&e.transport.length){var t={p2p:e.transport[0].p2p,local_candidate_type:e.transport[0].localCandidateType,remote_candidate_type:e.transport[0].remoteCandidateType,transport_type:e.transport[0].type};this._cachedTransportStats&&c()(t,this._cachedTransportStats)||(this._cachedTransportStats=t,m.a.sendAnalytics(Object(p.M)(t)))}}},{key:"_resetAvgJvbStats",value:function(){this._resetAvgStats(),this.jvbStatsMonitor._resetAvgStats()}},{key:"_resetAvgStats",value:function(){this._avgAudioBitrateUp.reset(),this._avgAudioBitrateDown.reset(),this._avgVideoBitrateUp.reset(),this._avgVideoBitrateDown.reset(),this._avgBandwidthUp.reset(),this._avgBandwidthDown.reset(),this._avgPacketLossUp.reset(),this._avgPacketLossDown.reset(),this._avgPacketLossTotal.reset(),this._avgRemoteFPS.reset(),this._avgRemoteScreenFPS.reset(),this._avgLocalFPS.reset(),this._avgLocalScreenFPS.reset(),this._avgRemoteCameraPixels.reset(),this._avgRemoteScreenPixels.reset(),this._avgLocalCameraPixels.reset(),this._avgLocalScreenPixels.reset(),this._avgCQ.reset(),this._sampleIdx=0}},{key:"dispose",value:function(){this._conference.off(u.P2P_STATUS,this._onP2PStatusChanged),this._conference.off(h.LOCAL_STATS_UPDATED,this._onLocalStatsUpdated),this._conference.off(u.JVB121_STATUS,this._onJvb121StatusChanged),this.jvbStatsMonitor.dispose(),this.p2pStatsMonitor.dispose()}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n(6),r=n(8),a=n(10),o=n(9),s=n.n(o),c=n(249),u=n.n(c),l=function(){function e(t){Object(i.a)(this,e),this.stats={users:{},dominantSpeakerId:null};var n=t.myUserId();this.stats.users[n]=new u.a(n,null,!0),this.conference=t,t.addEventListener(a.DOMINANT_SPEAKER_CHANGED,this._onDominantSpeaker.bind(this)),t.addEventListener(a.USER_JOINED,this._onUserJoin.bind(this)),t.addEventListener(a.USER_LEFT,this._onUserLeave.bind(this)),t.addEventListener(a.DISPLAY_NAME_CHANGED,this._onDisplayNameChange.bind(this)),t.xmpp&&t.xmpp.addListener(s.a.SPEAKER_STATS_RECEIVED,this._updateStats.bind(this))}return Object(r.a)(e,[{key:"_onDominantSpeaker",value:function(e){var t=this.stats.users[this.stats.dominantSpeakerId],n=this.stats.users[e];t&&t.setDominantSpeaker(!1),n&&n.setDominantSpeaker(!0),this.stats.dominantSpeakerId=e}},{key:"_onUserJoin",value:function(e,t){t.isHidden()||this.stats.users[e]||(this.stats.users[e]=new u.a(e,t.getDisplayName()))}},{key:"_onUserLeave",value:function(e){var t=this.stats.users[e];t&&t.markAsHasLeft()}},{key:"_onDisplayNameChange",value:function(e,t){var n=this.stats.users[e];n&&n.setDisplayName(t)}},{key:"getStats",value:function(){return this.stats.users}},{key:"_updateStats",value:function(e){for(var t in e){var n=void 0,i=this.conference.getParticipantById(t);i&&i.isHidden()||(this.stats.users[t]?(n=this.stats.users[t]).getDisplayName()||n.setDisplayName(e[t].displayName):(n=new u.a(t,e[t].displayName),this.stats.users[t]=n,n.markAsHasLeft())),n.totalDominantSpeakerTime=e[t].totalDominantSpeakerTime}}}]),e}()},function(e,t,n){var i=n(309),r=n(502),a="before",o="recording",s="transcribing",c="finished";function u(){this.audioRecorder=new i,this.transcriptionService=new r,this.counter=null,this.startTime=null,this.transcription=null,this.callback=null,this.results=[],this.state=a,this.lineLength=0}function l(e,t){if(console.log("retrieved an answer from the transcription service. The answer has an"+" array of length: ".concat(t.wordArray.length)),t.wordArray.length>0){var n=t.startTime.getUTCMilliseconds()-e.startTime.getUTCMilliseconds();n<0&&(n=0);var i="[";t.wordArray.forEach((function(e){e.begin+=n,e.end+=n,i+="".concat(e.word,",")})),i+="]",console.log(i),t.wordArray.name=t.name}e.results.push(t.wordArray),e.counter--,console.log("current counter: ".concat(e.counter)),e.maybeMerge()}function d(e){for(var t=0;t<e.length;t++)0===e[t].length&&e.splice(t,1);return e.length>0}u.prototype.start=function(){if(this.state!==a)throw new Error("The transcription can only start when it's in the \"".concat(a,'" state. It\'s currently in the "').concat(this.state,'" state'));this.state=o,this.audioRecorder.start(),this.startTime=new Date},u.prototype.stop=function(e){var t=this;if(this.state!==o)throw new Error("The transcription can only stop when it's in the \"".concat(o,'" state. It\'s currently in the "').concat(this.state,'" state'));console.log("stopping recording and sending audio files"),this.audioRecorder.stop();var n=l.bind(null,this);this.audioRecorder.getRecordingResults().forEach((function(e){t.transcriptionService.send(e,n),t.counter++})),this.state=s,this.callback=e},u.prototype.maybeMerge=function(){this.state===s&&0===this.counter&&this.merge()},u.prototype.merge=function(){var e=this;console.log("starting merge process!\n The length of the array: ".concat(this.results.length)),this.transcription="";var t=this.results,n=[];d(t),t.forEach((function(e){return function(e,t){if(0===e.length)e.push(t);else{if(e[e.length-1].begin<=t.begin)return void e.push(t);for(var n=0;n<e.length;n++)if(t.begin<e[n].begin)return void e.splice(n,0,t);e.push(t)}}(n,e)}));for(var i=function(){var n=t[0];t.forEach((function(e){e[0].begin<n[0].begin&&(n=e)}));var i=n.shift();e.updateTranscription(i,n.name);for(var r=function(){var r=!1,a=n[0].begin;if(t.forEach((function(e){e[0].begin<a&&(r=!0)})),r)return"break";i=n.shift(),e.updateTranscription(i,null)};n.length>0;){if("break"===r())break}};d(t);)i();this.state=c,this.callback&&this.callback(this.transcription)},u.prototype.updateTranscription=function(e,t){void 0!==t&&null!==t&&(this.transcription+="\n".concat(t,":"),this.lineLength=t.length+1),this.lineLength+e.word.length>80&&(this.transcription+="\n    ",this.lineLength=4),this.transcription+=" ".concat(e.word),this.lineLength+=e.word.length+1},u.prototype.addTrack=function(e){this.audioRecorder.addTrack(e)},u.prototype.removeTrack=function(e){this.audioRecorder.removeTrack(e)},u.prototype.getTranscription=function(){if(this.state!==c)throw new Error("The transcription can only be retrieved when it's in the \"".concat(c,'" state. It\'s currently in the "').concat(this.state,'" state'));return this.transcription},u.prototype.getState=function(){return this.state},u.prototype.reset=function(){this.state=a,this.counter=null,this.transcription=null,this.startTime=null,this.callback=null,this.results=[],this.lineLength=0},e.exports=u},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return a}));var i=n(26),r=n(18).getLogger(e);function a(e){this.versions={},this.conference=e,this.conference.addCommandListener("versions",this.processVersions.bind(this))}a.prototype.processVersions=function(e,t,n){var a=this;if(this.conference._isFocus(n)){var o=[];e.children.forEach((function(e){var t=e.attributes.name,n=e.value;a.versions[t]!==n&&(a.versions[t]=n,r.info("Got ".concat(t," version: ").concat(n)),o.push({id:"component_version",component:t,version:n}))})),o.length>0&&i.a.sendLog(JSON.stringify(o))}else r.warn("Received versions not from the focus user: ".concat(e),n)},a.prototype.getComponentVersion=function(e){return this.versions[e]}}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return d}));var i=n(6),r=n(8),a=n(18),o=n(9),s=n.n(o),c=n(395),u=n(78),l=Object(a.getLogger)(e),d=function(){function e(t){Object(i.a)(this,e),this.chatRoom=t,this.eventEmitter=t.eventEmitter,l.debug("creating VideoSIPGW"),this.sessions={},this.sessionStateChangeListener=this.sessionStateChanged.bind(this),t.addPresenceListener("jibri-sip-call-state",this.handleJibriSIPState.bind(this))}return Object(r.a)(e,[{key:"handleJibriSIPState",value:function(e){var t=e.attributes;if(t){l.debug("Handle video sip gw state : ",t);var n=t.state;if(n!==this.state)switch(n){case u.STATE_ON:case u.STATE_OFF:case u.STATE_PENDING:case u.STATE_RETRYING:case u.STATE_FAILED:var i=t.sipaddress;if(!i)return;var r=this.sessions[i];r?r.setState(n,t.failure_reason):l.warn("Video SIP GW session not found:",i)}}}},{key:"createVideoSIPGWSession",value:function(e,t){if(this.sessions[e])return l.warn("There was already a Video SIP GW session for address",e),new Error(u.ERROR_SESSION_EXISTS);var n=new c.a(e,t,this.chatRoom);return n.addStateListener(this.sessionStateChangeListener),this.sessions[e]=n,n}},{key:"sessionStateChanged",value:function(e){var t=e.address;if(e.newState===u.STATE_OFF||e.newState===u.STATE_FAILED){var n=this.sessions[t];if(!n)return void l.error("Missing Video SIP GW session with address:",t);n.removeStateListener(this.sessionStateChangeListener),delete this.sessions[t]}this.eventEmitter.emit(s.a.VIDEO_SIP_GW_SESSION_STATE_CHANGED,e)}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return p}));var i=n(6),r=n(8),a=n(36),o=n(35),s=n(18),c=n(13),u=n(72),l=n(78),d=Object(s.getLogger)(e),h="STATE_CHANGED",p=function(e){Object(a.a)(n,e);var t=Object(o.a)(n);function n(e,r,a){var o;return Object(i.a)(this,n),(o=t.call(this)).sipAddress=e,o.displayName=r,o.chatRoom=a,o.state=void 0,o}return Object(r.a)(n,[{key:"stop",value:function(){this.state!==l.STATE_OFF&&this.state!==l.STATE_FAILED?this._sendJibriIQ("stop"):d.warn("Video SIP GW session already stopped or failed!")}},{key:"start",value:function(){this.state!==l.STATE_ON&&this.state!==l.STATE_OFF&&this.state!==l.STATE_PENDING&&this.state!==l.STATE_RETRYING?this._sendJibriIQ("start"):d.warn("Video SIP GW session already started!")}},{key:"setState",value:function(e,t){if(e!==this.state){var n=this.state;this.state=e,this.eventEmitter.emit(h,{address:this.sipAddress,failureReason:t,oldState:n,newState:this.state,displayName:this.displayName})}}},{key:"addStateListener",value:function(e){this.addListener(h,e)}},{key:"removeStateListener",value:function(e){this.removeListener(h,e)}},{key:"_sendJibriIQ",value:function(e){var t=this,n={xmlns:"http://jitsi.org/protocol/jibri",action:e,sipaddress:this.sipAddress};n.displayname=this.displayName;var i=Object(c.$iq)({to:this.chatRoom.focusMucJid,type:"set"}).c("jibri",n).up();d.debug("".concat(e," video SIP GW session"),i.nodeTree),this.chatRoom.connection.sendIQ(i,(function(){}),(function(n){d.error("Failed to ".concat(e," video SIP GW session, error: "),n),t.setState(l.STATE_FAILED)}))}}]),n}(u.a)}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u}));var i=n(15),r=n(18),a=n(59),o=n(44),s=n(26),c=Object(r.getLogger)(e);function u(){return new Promise((function(e){o.a.enumerateDevices((function(t){var n,r=t.filter((function(e){return"audioinput"===e.kind})),u=[],d=Object(i.a)(r);try{for(d.s();!(n=d.n()).done;){var h=n.value,p=o.a.obtainAudioAndVideoPermissions({devices:["audio"],micDeviceId:h.deviceId}).then((function(e){var t=e[0],n=t.getOriginalStream();return s.a.startLocalStats(n,t.setAudioLevel.bind(t)),t.addEventListener(a.LOCAL_TRACK_STOPPED,(function(){s.a.stopLocalStats(n)})),t}));u.push(p)}}catch(f){d.e(f)}finally{d.f()}Promise.allSettled(u).then((function(t){var n,r=t.filter((function(e){return"fulfilled"===e.status})),o=t.filter((function(e){return"rejected"===e.status})),s=r.map((function(e){return e.value})),u=o.map((function(e){return e.value})),d=Object(i.a)(u);try{for(d.s();!(n=d.n()).done;){var h=n.value;c.error("Failed to acquire audio device with error: ",h)}}catch(f){d.e(f)}finally{d.f()}var p,m=Object(i.a)(s);try{var v=function(){var t=p.value;t.on(a.TRACK_AUDIO_LEVEL_CHANGED,(function(n){n>.008&&(l(s),e({deviceId:t.deviceId,deviceLabel:t.track.label}))}))};for(m.s();!(p=m.n()).done;)v()}catch(f){m.e(f)}finally{m.f()}setTimeout((function(){l(s),e({deviceId:"",deviceLabel:""})}),3e3)}))}))}))}function l(e){var t,n=Object(i.a)(e);try{for(n.s();!(t=n.n()).done;){t.value.stopStream()}}catch(r){n.e(r)}finally{n.f()}}}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return v}));var i=n(7),r=n(73),a=n(6),o=n(8),s=n(18),c=n(13),u=n(19),l=n(50),d=n.n(l),h=n(44),p=n(398),f=n(108),m=Object(s.getLogger)(e),v=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(a.a)(this,e);var n=t.jitsiConnection,o=Object(r.a)(t,["jitsiConnection"]);this._options=Object(i.a)({iceConfig:n&&n.xmpp.connection.jingle.p2pIceConfig},o),this._peerConnection=null,this._onFatalError=this._onFatalError.bind(this),this._onSendMessage=this._onSendMessage.bind(this),this._onRemoteStream=this._onRemoteStream.bind(this)}return Object(o.a)(e,[{key:"processMessage",value:function(e){var t=e.from;if(t)if(this._peerConnection&&this._peerConnection.getPeerJid()!==t)this._onFatalError(t,f.a.CONNECTION_ERROR,"rejected");else{var n=this._convertStringToXML(e.data.iq),i=n&&n.find("jingle"),r=i&&i.attr("action");r===f.a.INITIATE&&(this._peerConnection=this._createPeerConnection(t,{isInitiator:!1,receiveVideo:!0})),this._peerConnection&&this._peerConnection.processMessage(i),r!==f.a.CONNECTION_ERROR&&r!==f.a.UNAVAILABLE&&r!==f.a.TERMINATE||this._selfCloseConnection()}}},{key:"start",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this._peerConnection=this._createPeerConnection(e,{isInitiator:!0,receiveVideo:!1}),this._peerConnection.start(t)}},{key:"stop",value:function(){this._peerConnection&&this._peerConnection.stop(),this._peerConnection=null}},{key:"_convertStringToXML",value:function(e){try{var t=(new DOMParser).parseFromString(e,"text/xml");return $(t)}catch(n){return m.error("Attempted to convert incorrectly formatted xml"),null}}},{key:"_createPeerConnection",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw new Error("Cannot create ProxyConnectionPC without a peer.");var n=Object(i.a)({iceConfig:this._options.iceConfig,onError:this._onFatalError,onRemoteStream:this._onRemoteStream,onSendMessage:this._onSendMessage,peerJid:e},t);return new p.a(n)}},{key:"_onFatalError",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";m.error("Received a proxy connection error",e,t,n);var i=Object(c.$iq)({to:e,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:t}).c("details").t(n).up();this._onSendMessage(e,i),this._peerConnection&&this._peerConnection.getPeerJid()===e&&this._selfCloseConnection()}},{key:"_onRemoteStream",value:function(e){if(!this._options.onRemoteStream)return m.error("Remote track received without callback."),void e.dispose();var t,n=e.isVideoTrack();n&&(t=this._options.convertVideoToDesktop?d.a.DESKTOP:d.a.CAMERA);var i=e.getOriginalStream(),r=h.a.createLocalTracks([{deviceId:"proxy:".concat(this._peerConnection.getPeerJid()),mediaType:n?u.c:u.a,sourceType:"proxy",stream:i,track:i.getVideoTracks()[0],videoType:t}]);this._options.onRemoteStream(r[0])}},{key:"_onSendMessage",value:function(e,t){if(this._options.onSendMessage)try{var n=(new XMLSerializer).serializeToString(t.nodeTree||t);this._options.onSendMessage(e,{iq:n})}catch(i){m.error("Attempted to send an incorrectly formatted iq.")}}},{key:"_selfCloseConnection",value:function(){this.stop(),this._options.onConnectionClosed&&this._options.onConnectionClosed()}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return v}));var i=n(7),r=n(6),a=n(8),o=n(18),s=n(29),c=n.n(s),u=n(9),l=n.n(u),d=n(44),h=n(183),p=n(77),f=n(108),m=Object(o.getLogger)(e),v=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(r.a)(this,e),this._options=Object(i.a)({iceConfig:{},isInitiator:!1,receiveAudio:!1,receiveVideo:!1},t),this._tracks=[],this._peerConnection=null,this._onError=this._onError.bind(this),this._onRemoteStream=this._onRemoteStream.bind(this),this._onSendMessage=this._onSendMessage.bind(this)}return Object(a.a)(e,[{key:"getPeerJid",value:function(){return this._options.peerJid}},{key:"processMessage",value:function(e){switch(e.attr("action")){case f.a.ACCEPT:this._onSessionAccept(e);break;case f.a.INITIATE:this._onSessionInitiate(e);break;case f.a.TERMINATE:this._onSessionTerminate(e);break;case f.a.TRANSPORT_INFO:this._onTransportInfo(e)}}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._peerConnection||(this._tracks=this._tracks.concat(e),this._peerConnection=this._createPeerConnection(),this._peerConnection.invite(e))}},{key:"stop",value:function(){this._peerConnection&&this._peerConnection.terminate(),this._onSessionTerminate()}},{key:"_createPeerConnection",value:function(){var e=this,t={connected:!0,jingle:{terminate:function(){}},sendIQ:this._onSendMessage,addEventListener:function(){return function(){}}},n=Object(i.a)({iceServers:p.a},this._options.iceConfig),r={addPresenceListener:function(){},connectionTimes:[],eventEmitter:{emit:function(t){switch(t){case l.a.CONNECTION_ICE_FAILED:case l.a.CONNECTION_FAILED:e._onError(f.a.CONNECTION_ERROR,t)}}},getMediaPresenceInfo:function(){return{}},removePresenceListener:function(){}};this._rtc=new d.a({},{}),this._rtc.addListener(c.a.REMOTE_TRACK_ADDED,this._onRemoteStream);var a=new h.a(void 0,void 0,this._options.peerJid,t,{offerToReceiveAudio:this._options.receiveAudio,offerToReceiveVideo:this._options.receiveVideo},n,!0,this._options.isInitiator);return a.initialize(r,this._rtc,{}),a}},{key:"_onError",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this._options.onError(this._options.peerJid,e,t)}},{key:"_onRemoteStream",value:function(e){this._tracks.push(e),this._options.onRemoteStream(e)}},{key:"_onSendMessage",value:function(e){this._options.onSendMessage(this._options.peerJid,e)}},{key:"_onSessionAccept",value:function(e){this._peerConnection?this._peerConnection.setAnswer(e):m.error("Received an answer when no peer connection exists.")}},{key:"_onSessionInitiate",value:function(e){var t=this;this._peerConnection?m.error("Received an offer when an offer was already sent."):(this._peerConnection=this._createPeerConnection(),this._peerConnection.acceptOffer(e,(function(){}),(function(){return t._onError(t._options.peerJid,f.a.CONNECTION_ERROR,"session initiate error")})))}},{key:"_onSessionTerminate",value:function(){this._tracks.forEach((function(e){return e.dispose()})),this._tracks=[],this._peerConnection&&this._peerConnection.onTerminated(),this._rtc&&(this._rtc.removeListener(c.a.REMOTE_TRACK_ADDED,this._onRemoteStream),this._rtc.destroy())}},{key:"_onTransportInfo",value:function(e){this._peerConnection.addIceCandidates(e)}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";t.a={error:{BUSY:"busy",ERROR:"error",RESOURCE_CONSTRAINT:"resource-constraint",SERVICE_UNAVAILABLE:"service-unavailable"},mode:{FILE:"file",STREAM:"stream"},status:{OFF:"off",ON:"on",PENDING:"pending"}}},function(e,t,n){"use strict";var i=n(60),r=n.n(i),a=n(87),o=n(55),s=n.n(o),c=n(20),u=n(96),l=n(163),d=n.n(l),h=n(135),p="preCallTestResults",f=new s.a,m=!1,v=null;function g(){if(!c.a.isReactNative())return new Promise((function(e){d.a.loadScript(h.a,!0,!0,void 0,e)}))}function b(e){return new Promise((function(t,n){var i=e.callStatsID,r=e.callStatsSecret,a=e.statisticsId||e.statisticsDisplayName||u.a.callStatsUserName;v.initialize(i,r,a,(function(e,i){"success"===e?(v.on(p,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];f.emit.apply(f,[p].concat(t))})),m=!0,t()):n({status:e,message:i})}),null,{disablePrecalltest:!0})}))}function y(){return(y=Object(a.a)(r.a.mark((function e(t){var n,i,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!m){e.next=2;break}throw new Error("Precall Test already initialized");case 2:if(n=t.callStatsID,i=t.callStatsSecret,a=t.disableThirdPartyRequests,n&&i&&!a){e.next=5;break}throw new Error("Callstats is disabled");case 5:return e.next=7,g();case 7:return v=new window.callstats,e.abrupt("return",b(t));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t.a={init:function(e){return y.apply(this,arguments)},execute:function(){return m?new Promise((function(e,t){f.on(p,(function(n,i){"success"===n?e(i):t({status:n,payload:i})})),v.makePrecallTest()})):Promise.reject("uninitialized")}}},function(e,t){e.exports={getTokenAuthUrl:function(e,t,n){return"string"!==typeof e?null:e.replace("{room}",t).replace("{roleUpgrade}",!0===n)}}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u}));var i=n(15),r=n(6),a=n(8),o=n(18),s=n(219),c=Object(o.getLogger)(e),u=function(){function e(){Object(r.a)(this,e),this._started=!1,this._streamsToMix=[],this._streamMSSArray=[]}return Object(a.a)(e,[{key:"addMediaStream",value:function(e){e.getAudioTracks()||c.warn("Added MediaStream doesn't contain audio tracks."),this._streamsToMix.push(e)}},{key:"start",value:function(){if(this._started)return this._mixedMSD.stream;if(this._audioContext=Object(s.a)(),!this._streamsToMix.length)return c.warn("No MediaStream's added to AudioMixer, nothing will happen."),null;this._started=!0,this._mixedMSD=this._audioContext.createMediaStreamDestination();var e,t=Object(i.a)(this._streamsToMix);try{for(t.s();!(e=t.n()).done;){var n=e.value,r=this._audioContext.createMediaStreamSource(n);r.connect(this._mixedMSD),this._streamMSSArray.push(r)}}catch(a){t.e(a)}finally{t.f()}return this._mixedMSD.stream}},{key:"reset",value:function(){this._started=!1,this._streamsToMix=[];var e,t=Object(i.a)(this._streamMSSArray);try{for(t.s();!(e=t.n()).done;){e.value.disconnect()}}catch(n){t.e(n)}finally{t.f()}this._streamMSSArray=[],this._audioContext&&(this._audioContext=void 0)}}]),e}()}).call(this,"/index.js")},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"b",(function(){return $})),n.d(t,"a",(function(){return te}));var i,r,a=n(15),o=n(69),s=n(24),c=n(6),u=n(8),l=n(31),h=n(36),p=n(35),f=n(12),m=(n(83),n(3)),v=n(117),g=n(106),b=n(11),y=n(28),E=n(17),S=n(55),O=n(62),_=n.n(O),C=n(4),T=n(7),j=n(90),A=n(54),k=n(22),R=n(122),I=n(56),P=n(61),w=n(86),N=n(58),D=n(41),M=n(45),L=n.n(M),x=n(33),F=n(137),U="p_info",V="p_pose",B="p_onStage",J="p_trackSt",H="main_screen_carrier",z="my_content",G=512,K=function(){},Q=function(){function e(t){Object(c.a)(this,e),this.conference=void 0,this.disposers=[],this.fragmentedMessages=[],this.fragmentedMessageHead={type:"",length:0},this.conference=t}return Object(u.a)(e,[{key:"sendAllAboutMe",value:function(){var e;K("sendAllAboutMe called."),this.sendPoseMessageNow(),this.sendMouseMessageNow(),b.a.local.sendInformation(),this.sendOnStage(),this.sendTrackStates(),(null===(e=E.b.tracks.localMainConnection)||void 0===e?void 0:e.localId)&&this.sendMainScreenCarrier(!0),this.sendMyContents(),this.sendAfkChanged()}},{key:"sendPoseMessageNow",value:function(){if(this.conference.channelOpened){var e=Object(m.B)(b.a.local.pose);this.conference.sendMessage(x.b.PARTICIPANT_POSE,e)}}},{key:"sendMouseMessageNow",value:function(){if(this.conference.channelOpened){var e=Object(m.x)(b.a.local.mouse);this.conference.sendMessage(x.b.PARTICIPANT_MOUSE,e)}}},{key:"sendParticipantInfo",value:function(){var e;if(b.a.local.informationToSend){config.bmRelayServer?this.conference.sendMessage(U,Object(T.a)({},b.a.local.informationToSend)):this.conference.setLocalParticipantProperty(U,Object(T.a)({},b.a.local.informationToSend));for(var t=b.a.local.information.name;"_"===t.slice(0,1);)t=t.slice(1);null===(e=this.conference._jitsiConference)||void 0===e||e.setDisplayName(t)}}},{key:"sendOnStage",value:function(){config.bmRelayServer?this.conference.sendMessage(B,b.a.local.physics.onStage):this.conference.channelOpened&&this.conference.setLocalParticipantProperty(B,b.a.local.physics.onStage)}},{key:"sendTrackStates",value:function(){config.bmRelayServer?this.conference.sendMessage(J,Object(T.a)({},b.a.local.trackStates)):this.conference.setLocalParticipantProperty(J,Object(T.a)({},b.a.local.trackStates))}},{key:"sendAfkChanged",value:function(){this.conference.sendMessage(x.b.PARTICIPANT_AFK,b.a.local.awayFromKeyboard)}},{key:"sendTrackLimits",value:function(e,t){this.conference.sendMessage(x.b.PARTICIPANT_TRACKLIMITS,t||[b.a.local.remoteVideoLimit,b.a.local.remoteAudioLimit],e||void 0)}},{key:"sendContentUpdateRequest",value:function(e,t){!this.conference.bmRelaySocket&&t.map((function(e){return e.url?e.url.length:0})).reduce((function(e,t){return e+t}))>G?this.sendFragmentedMessage(x.b.CONTENT_UPDATE_REQUEST,t,e):this.conference.sendMessage(x.b.CONTENT_UPDATE_REQUEST,t,e)}},{key:"sendContentRemoveRequest",value:function(e,t){this.conference.sendMessage(x.b.CONTENT_REMOVE_REQUEST,t,e)}},{key:"sendLeftContentRemoveRequest",value:function(e){Object(m.b)(!config.bmRelayServer),this.conference.sendMessage(x.b.LEFT_CONTENT_REMOVE_REQUEST,e)}},{key:"sendMainScreenCarrier",value:function(e){var t,n=null===(t=E.b.tracks.localMainConnection)||void 0===t?void 0:t.getParticipantId();n&&(config.bmRelayServer?this.conference.sendMessage(H,{carrierId:n,enabled:e}):this.conference.setLocalParticipantProperty(H,{carrierId:n,enabled:e}))}},{key:"sendMyContents",value:function(){if(config.bmRelayServer)this.sendContentUpdateRequest("",Array.from(E.b.roomContents.values()));else{var e=Array.from(E.b.localParticipant.myContents.values()),t=Object(D.j)(e);K("send all contents ".concat(JSON.stringify(t.map((function(e){return e.id}))),"."),t),this.conference.setLocalParticipantProperty(z,t)}}},{key:"onRoomProp",value:function(e,t){y.a.onUpdateProp(e,t)}},{key:"onParticipantTrackLimits",value:function(e){b.a.local.remoteVideoLimit=e[0],b.a.local.remoteAudioLimit=e[1]}},{key:"onParticipantLeft",value:function(e){var t;E.b.onParticipantLeft(e),w.b.participantLeft(e),b.a.leave(e),(null===(t=this.conference.bmRelaySocket)||void 0===t?void 0:t.readyState)===WebSocket.OPEN&&this.conference.sendMessage(x.b.PARTICIPANT_LEFT,e)}},{key:"onChatMessage",value:function(e,t){Object(m.b)(e);var n=b.a.find(e);n&&w.b.addMessage(new w.a(t.msg,n.id,n.information.name,n.information.avatarSrc,n.getColor(),t.ts,t.to?"private":"text"))}},{key:"onCallRemote",value:function(e){Object(m.b)(e);var t=b.a.find(e);t&&(w.b.calledBy(t),b.a.local.information.notifyCall&&Object(F.b)(Object(k.c)("noCalled",{name:null===t||void 0===t?void 0:t.information.name}),{icon:"./favicon.ico"}))}},{key:"onAfkChanged",value:function(e,t){Object(m.b)(e);var n=b.a.find(e);n&&(n.awayFromKeyboard=t)}},{key:"onKicked",value:function(e,t){var n,i=this;Object(m.b)(e),N.a.setType("kicked",null===(n=b.a.remote.get(e))||void 0===n?void 0:n.information.name,t);var r=window.localStorage.getItem("kickTimes"),a=void 0,o=[];this.conference.name&&(r&&(a=(o=JSON.parse(r)).find((function(e){return e.room===i.conference.name}))),a||(a={room:this.conference.name,time:0},o.push(a)),a.time=Date.now(),window.localStorage.setItem("kickTimes",JSON.stringify(o))),setTimeout((function(){window.location.reload()}),1e4)}},{key:"onParticipantOut",value:function(e){e.forEach((function(e){var t=b.a.find(e);t&&(t.physics.located=!1)}))}},{key:"onMouseOut",value:function(e){e.forEach((function(e){var t=b.a.find(e);t&&(t.mouse.position=[A.a,A.a])}))}},{key:"onContentOut",value:function(e){e.forEach((function(e){var t=E.b.find(e);if(t){var n=Object.assign({},t);n.pose={position:[A.a,A.a],orientation:t.pose.orientation},E.b.updateByRemoteRequest([n])}}))}},{key:"onParticipantInfo",value:function(e,t){if(Object(m.b)(e),null===P.a.testBot){var n=b.a.remote.get(e);if(n){var i=n.information.name;Object.assign(n.information,t),i!==n.information.name&&(i===I.d.name?w.b.participantJoined(e):w.b.participantNameChanged(e,i)),n.informationReceived=!0,K("Info of ".concat(e," received."))}}}},{key:"onParticipantTrackState",value:function(e,t){if(Object(m.b)(e),null===P.a.testBot){var n=b.a.remote.get(e);n&&Object.assign(n.trackStates,t)}}},{key:"onParticipantPose",value:function(e,t){Object(m.b)(e);var n=Object(m.L)(t),i=b.a.remote.get(e),r=b.a.local;if(i&&(i.pose.orientation=n.orientation,i.pose.position=n.position,i.physics.located=!0,r.information.notifyNear||r.information.notifyTouch)){var a=Object(m.A)(Object(m.M)(i.pose.position,r.pose.position)),o=3*I.a,s=I.a;i.lastDistance>s&&a<=s&&r.information.notifyTouch?Object(F.b)(Object(k.c)("noTouched",{name:i.information.name}),{icon:"./favicon.ico"}):i.lastDistance>o&&a<o&&r.information.notifyNear&&Object(F.b)(Object(k.c)("noNear",{name:i.information.name}),{icon:"./favicon.ico"}),i.lastDistance=a}}},{key:"onParticipantMouse",value:function(e,t){Object(m.b)(e);var n=Object(m.K)(t);if(null===P.a.testBot){var i=b.a.remote.get(e);i&&Object.assign(i.mouse,n)}}},{key:"onParticipantOnStage",value:function(e,t){Object(m.b)(e);var n=b.a.remote.get(e);n&&(n.physics.onStage=t)}},{key:"onYarnPhone",value:function(e,t){if(Object(m.b)(e),t.find((function(e){return e===b.a.localId}))){if(!b.a.yarnPhones.has(e)&&(b.a.yarnPhones.add(e),b.a.local.information.notifyYarn)){var n=b.a.find(e);n&&Object(F.b)(Object(k.c)("noYarn",{name:n.information.name}),{icon:"./favicon.ico"})}}else b.a.yarnPhones.delete(e)}},{key:"onMuteVideo",value:function(e){var t={};b.a.local.loadMediaSettingsFromStorage(t),b.a.local.muteVideo=e||t.stream.muteVideo}},{key:"onMuteAudio",value:function(e){var t={};b.a.local.loadMediaSettingsFromStorage(t),b.a.local.muteAudio=e||t.stream.muteAudio}},{key:"onReloadBrower",value:function(){window.location.reload()}},{key:"onMainScreenCarrier",value:function(e,t){Object(m.b)(e),b.a.remote.get(e)&&E.b.tracks.onMainScreenCarrier(t.carrierId,t.enabled)}},{key:"onMyContent",value:function(e,t){Object(m.b)(e);var n=Object(D.r)(t);E.b.checkDuplicatedWallpaper(e,n),E.b.replaceRemoteContents(n,e);b.a.remote.get(e);K("recv remote contents ".concat(JSON.stringify(n.map((function(e){return e.id})))," from ").concat(e,"."),n)}},{key:"onContentInfoUpdate",value:function(e){Object(m.b)(config.bmRelayServer),e.forEach((function(e){return E.b.roomContentsInfo.set(e.id,e)}))}},{key:"onContentUpdateRequest",value:function(e){var t=Object(D.r)(e);E.b.updateByRemoteRequest(t)}},{key:"onContentRemoveRequest",value:function(e){E.b.removeByRemoteRequest(e)}},{key:"onLeftContentRemoveRequest",value:function(e){console.log("onLeftContentRemoveRequest for ".concat(e,".")),E.b.removeLeftContentByRemoteRequest(e)}},{key:"bind",value:function(){var e,t=this;this.conference.on(x.b.PARTICIPANT_TRACKLIMITS,this.onParticipantTrackLimits),this.conference.on($.USER_LEFT,this.onParticipantLeft.bind(this)),this.conference.on($.USER_JOINED,(function(e){var n,i=null===(n=t.conference._jitsiConference)||void 0===n?void 0:n.getParticipantById(e).getDisplayName();i===j.b||i===j.c||b.a.join(e)})),this.conference.on($.REMOTE_TRACK_ADDED,(function(e){R.a.onRemoteTrackAdded(e),b.a.addRemoteTrack(e)||E.b.tracks.addRemoteTrack(e)})),this.conference.on($.REMOTE_TRACK_REMOVED,(function(e){b.a.removeRemoteTrack(e)||E.b.tracks.removeRemoteTrack(e)})),this.conference.on(x.b.CHAT_MESSAGE,this.onChatMessage),this.conference.on(x.b.CALL_REMOTE,this.onCallRemote),this.conference.on(x.b.KICK,(function(e,n){var i;null===(i=t.conference._jitsiConference)||void 0===i||i.room.leave(),t.onKicked(e,n)})),this.conference.on(x.b.PARTICIPANT_AFK,this.onAfkChanged),this.conference.on(U,this.onParticipantInfo),this.conference.on(J,this.onParticipantTrackState),this.conference.on(x.b.PARTICIPANT_POSE,this.onParticipantPose),this.conference.on(V,this.onParticipantPose),this.conference.on(x.b.PARTICIPANT_MOUSE,this.onParticipantMouse),this.conference.on(B,this.onParticipantOnStage),this.conference.on(x.b.YARN_PHONE,this.onYarnPhone),this.conference.on(x.b.MUTE_VIDEO,this.onMuteVideo),this.conference.on(x.b.MUTE_AUDIO,this.onMuteAudio),this.conference.on(x.b.RELOAD_BROWSER,this.onReloadBrower),this.conference.on(H,this.onMainScreenCarrier),this.conference.on(z,this.onMyContent),this.conference.on(x.b.CONTENT_UPDATE_REQUEST,this.onContentUpdateRequest),this.conference.on(x.b.CONTENT_REMOVE_REQUEST,this.onContentRemoveRequest),this.conference.on(x.b.LEFT_CONTENT_REMOVE_REQUEST,this.onLeftContentRemoveRequest),null===(e=this.conference._jitsiConference)||void 0===e||e.addEventListener(_.a.events.conference.DATA_CHANNEL_OPENED,(function(){t.conference.channelOpened=!0})),this.conference.on(x.b.FRAGMENT_HEAD,(function(e,n){t.fragmentedMessageHead=n,t.fragmentedMessages=[]})),this.conference.on(x.b.FRAGMENT_CONTENT,(function(e,n){if(t.fragmentedMessages[n.c]=n,t.fragmentedMessageHead.length&&t.fragmentedMessages.length===t.fragmentedMessageHead.length&&-1===t.fragmentedMessages.findIndex((function(e){return void 0===e}))){var i="";t.fragmentedMessages.forEach((function(e){return i+=e.s}));var r=JSON.parse(i);t.conference.emit(t.fragmentedMessageHead.type,e,r),t.fragmentedMessageHead={type:"",length:0},t.fragmentedMessages=[]}}))}},{key:"observeStart",value:function(){var e=this;if(this.disposers.push(Object(C.c)((function(){b.a.remote.forEach((function(t){t.called&&(t.called=!1,e.conference.sendMessage(x.b.CALL_REMOTE,{},t.id),w.b.callTo(t))}))}))),this.disposers.push(Object(C.c)(this.sendAfkChanged.bind(this))),this.disposers.push(Object(C.c)(this.sendParticipantInfo.bind(this))),this.disposers.push(Object(C.c)(this.sendTrackStates.bind(this))),config.bmRelayServer)this.disposers.push(Object(C.c)((function(){e.sendPoseMessageNow(),e.sendMouseMessageNow()})));else{var t=function(){return Math.ceil(Math.max(b.a.remote.size/4*50,50))},n=function(){},i=0,r="";this.disposers.push(Object(C.c)((function(){var a=t();a!==i&&(i=a,n=L.a.throttle((function(t){e.conference.channelOpened&&e.conference.sendMessage(x.b.PARTICIPANT_POSE,t)}),i));var o=Object(m.B)(b.a.local.pose);e.conference.channelOpened&&r!==o&&(n(o),r=o)})));var a=0,o="",s=function(){var n=Date.now(),i=30*t();if(n-a>i){var r=Object(m.B)(b.a.local.pose);o!==r&&(e.conference.setLocalParticipantProperty(V,r),a=n,o=r)}};s(),setInterval(s,2500);var c=0,u=function(e){};this.disposers.push(Object(C.c)((function(){!function(n){var i=t();c!==i&&(c=i,u=L.a.throttle((function(t){e.conference.sendMessage(x.b.PARTICIPANT_MOUSE,Object(m.x)(t))}),c)),e.conference.channelOpened&&u(Object(T.a)({},b.a.local.mouse))}()})))}this.disposers.push(Object(C.c)((function(){e.sendOnStage()})));this.disposers.push(Object(C.c)((function(){e.conference.channelOpened&&b.a.yarnPhoneUpdated&&(b.a.yarnPhoneUpdated=!1,e.conference.sendMessage(x.b.YARN_PHONE,Array.from(b.a.yarnPhones)))})))}},{key:"observeEnd",value:function(){this.disposers.forEach((function(e){return e()}))}},{key:"sendFragmentedMessage",value:function(e,t,n){var i=JSON.stringify(t),r={type:e,length:Math.ceil(i.length/G)};this.conference.sendMessage(x.b.FRAGMENT_HEAD,r,n);for(var a=0,o=0;o<i.length;o+=G)this.conference.sendMessage(x.b.FRAGMENT_CONTENT,{c:a,s:i.slice(o,o+G)},n),a+=1}},{key:"onBmMessage",value:function(e){K("Receive ".concat(e.length," relayed messages."));var t,n=Object(a.a)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;switch(i.t){case x.b.ROOM_PROP:this.onRoomProp.apply(this,Object(o.a)(JSON.parse(i.v)));break;case x.b.REQUEST_TO:this.sendAllAboutMe();break;case x.b.PARTICIPANT_AFK:this.onAfkChanged(i.p,JSON.parse(i.v));break;case x.b.CALL_REMOTE:this.onCallRemote(i.p);break;case x.b.CHAT_MESSAGE:this.onChatMessage(i.p,JSON.parse(i.v));break;case x.b.CONTENT_REMOVE_REQUEST:this.onContentRemoveRequest(JSON.parse(i.v));break;case x.b.LEFT_CONTENT_REMOVE_REQUEST:this.onLeftContentRemoveRequest(JSON.parse(i.v));break;case x.b.CONTENT_UPDATE_REQUEST:this.onContentUpdateRequest(JSON.parse(i.v));break;case x.b.CONTENT_INFO_UPDATE:this.onContentInfoUpdate(JSON.parse(i.v));break;case x.b.PARTICIPANT_MOUSE:this.onParticipantMouse(i.p,JSON.parse(i.v));break;case x.b.PARTICIPANT_POSE:this.onParticipantPose(i.p,JSON.parse(i.v));break;case x.b.PARTICIPANT_TRACKLIMITS:this.onParticipantTrackLimits(JSON.parse(i.v));break;case x.b.YARN_PHONE:this.onYarnPhone(i.p,JSON.parse(i.v));break;case x.b.RELOAD_BROWSER:this.onReloadBrower();break;case x.b.MUTE_VIDEO:this.onMuteVideo(JSON.parse(i.v));break;case x.b.MUTE_AUDIO:this.onMuteAudio(JSON.parse(i.v));break;case x.b.KICK:this.onKicked(i.p,JSON.parse(i.v));break;case x.b.PARTICIPANT_OUT:this.onParticipantOut(JSON.parse(i.v));break;case x.b.MOUSE_OUT:this.onMouseOut(JSON.parse(i.v));break;case x.b.CONTENT_OUT:this.onContentOut(JSON.parse(i.v));break;case H:this.onMainScreenCarrier(i.p,JSON.parse(i.v));break;case z:this.onMyContent(i.p,JSON.parse(i.v));break;case U:this.onParticipantInfo(i.p,JSON.parse(i.v));break;case B:this.onParticipantOnStage(i.p,JSON.parse(i.v));break;case V:this.onParticipantPose(i.p,JSON.parse(i.v));break;case J:this.onParticipantTrackState(i.p,JSON.parse(i.v));break;default:console.log("Unhandled message type ".concat(i.t," from ").concat(i.p))}}}catch(r){n.e(r)}finally{n.f()}this.checkInfo()}},{key:"checkInfo",value:function(){var e=Array.from(b.a.remote.values()).filter((function(e){return!e.informationReceived})).map((function(e){return e.id}));e.length&&(K("checkInfo sent ".concat(e)),this.conference.pushOrUpdateMessageViaRelay(x.b.REQUEST_TO,e))}}]),e}(),q=function(e){},W=function(e){},Y=function(e){},X=function(e){},Z=_.a.events.conference,$={USER_JOINED:"joined",USER_LEFT:"left",REMOTE_TRACK_ADDED:"remote_track_added",REMOTE_TRACK_REMOVED:"remote_track_removed"},ee=new Set(x.d);ee.add(x.a.CONTENT_UPDATE_REQUEST_BY_ID),ee.add(x.a.REQUEST_PARTICIPANT_STATES);var te=(i=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){var e;return Object(c.a)(this,n),(e=t.call(this))._jitsiConference=void 0,e.name="",e.localId="",e.sync=new Q(Object(l.a)(e)),Object(s.a)(e,"channelOpened",r,Object(l.a)(e)),e.bmRelaySocket=void 0,e.lastRequestTime=Date.now(),e.lastReceivedTime=Date.now(),e.messagesToSendToRelay=[],e.relayRttLast=50,e.relayRttAverage=50,e.stopStep=!1,e.localMicTrack=void 0,e.localCameraTrack=void 0,e.receivedMessages=[],Object(C.g)(Object(l.a)(e)),e}return Object(u.a)(n,[{key:"setRoomProp",value:function(e,t){this.pushOrUpdateMessageViaRelay(x.b.ROOM_PROP,[e,t]),y.a.onUpdateProp(e,t)}},{key:"init",value:function(e,t){var n,i;if(e){var r=window.localStorage.getItem("kickTimes");if(r){var a=JSON.parse(r).find((function(t){return t.room===e}));if(a){if(Date.now()-a.time<9e5)return void window.location.reload()}}}this.name=e,this._jitsiConference=t(),this.registerJistiConferenceEvents(),this.sync.bind(),null===(n=this._jitsiConference)||void 0===n||n.join(""),null===(i=this._jitsiConference)||void 0===i||i.setSenderVideoConstraint(1080),this.step(),d.conference=this,d.jc=this._jitsiConference,d.chatRoom=this._jitsiConference.room,d.showState=function(){console.log("carrierMap: ".concat(JSON.stringify(E.b.tracks.carrierMap))),console.log("contentCarriers: ".concat(JSON.stringify(E.b.tracks.contentCarriers))),console.log("remoteMains: ".concat(JSON.stringify(E.b.tracks.remoteMains.keys())))}}},{key:"uninit",value:function(){var e,t,n=this;(config.bmRelayServer&&b.a.localId&&this.sendMessage(x.b.PARTICIPANT_LEFT,b.a.localId),b.a.local.tracks.audio)&&(null===(e=this.removeTrack(b.a.local.tracks.audio))||void 0===e||e.then((function(){var e;null===(e=b.a.local.tracks.audio)||void 0===e||e.dispose()})));b.a.local.tracks.avatar&&(null===(t=this.removeTrack(b.a.local.tracks.avatar))||void 0===t||t.then((function(){var e;null===(e=b.a.local.tracks.avatar)||void 0===e||e.dispose()})));return this.sync.observeEnd(),this.stopStep=!0,new Promise((function(e,t){var i;null===(i=n._jitsiConference)||void 0===i||i.leave().then((function(t){var n,i=null!==(n=localStorage.getItem("log"))&&void 0!==n?n:"";i+="leave (".concat(t,"). "),localStorage.setItem("log",i),e(t)})).catch((function(e){t(e)})).finally((function(){n._jitsiConference=void 0}))}))}},{key:"step",value:function(){var e,t=this;if((null===(e=this.bmRelaySocket)||void 0===e?void 0:e.readyState)===WebSocket.OPEN){for(var n=Date.now()+40;Date.now()<n&&this.receivedMessages.length;){var i=this.receivedMessages.shift();i&&this.sync.onBmMessage([i])}var r=Math.min(Math.max((this.relayRttAverage-20)*b.a.remote.size/40,0)+20,3e3),a=r+2e4,o=Date.now();o<n&&this.bmRelaySocket&&!this.receivedMessages.length&&o-this.lastRequestTime>r&&(this.lastReceivedTime>=this.lastRequestTime||o-this.lastRequestTime>a)&&(this.lastRequestTime=o,this.pushOrUpdateMessageViaRelay(x.b.REQUEST_RANGE,[v.a.visibleArea(),b.a.audibleArea()]),this.sendMessageViaRelay())}this.stopStep?this.stopStep=!1:setTimeout((function(){t.step()}),50)}},{key:"doSetLocalMicTrack",value:function(e){var t;this.localMicTrack=e,this.localMicTrack.videoType="mic",null===(t=this._jitsiConference)||void 0===t||t.addTrack(this.localMicTrack)}},{key:"setLocalMicTrack",value:function(e){var t=this;return new Promise((function(n,i){var r;if(e)if(t.localMicTrack){var a,o=t.localMicTrack;null===(a=t._jitsiConference)||void 0===a||a.removeTrack(t.localMicTrack).then((function(){t.doSetLocalMicTrack(e),n(o)}))}else t.doSetLocalMicTrack(e),n(void 0);else t.localMicTrack?null===(r=t._jitsiConference)||void 0===r||r.removeTrack(t.localMicTrack).then((function(){var e=t.localMicTrack;t.localMicTrack=void 0,n(e)})):n(void 0)}))}},{key:"doSetLocalCameraTrack",value:function(e){var t;this.localCameraTrack=e,this.localCameraTrack.videoType="camera",null===(t=this._jitsiConference)||void 0===t||t.addTrack(this.localCameraTrack)}},{key:"setLocalCameraTrack",value:function(e){var t=this;return new Promise((function(n,i){var r;if(e)if(t.localCameraTrack){var a,o=t.localCameraTrack;null===(a=t._jitsiConference)||void 0===a||a.removeTrack(t.localCameraTrack).then((function(){t.doSetLocalCameraTrack(e),n(o)}))}else t.doSetLocalCameraTrack(e),n(void 0);else t.localCameraTrack?null===(r=t._jitsiConference)||void 0===r||r.removeTrack(t.localCameraTrack).then((function(){var e=t.localCameraTrack;t.localCameraTrack=void 0,n(e)})):n(void 0)}))}},{key:"getLocalMicTrack",value:function(){return this.localMicTrack}},{key:"getLocalCameraTrack",value:function(){return this.localCameraTrack}},{key:"sendCommand",value:function(e,t){var n;X("SEND sendCommand ".concat(e," ").concat(JSON.stringify(t))),null===(n=this._jitsiConference)||void 0===n||n.sendCommand(e,t)}},{key:"removeCommand",value:function(e){var t;null===(t=this._jitsiConference)||void 0===t||t.removeCommand(e)}},{key:"addCommandListener",value:function(e,t){var n;null===(n=this._jitsiConference)||void 0===n||n.addCommandListener(e,t)}},{key:"setLocalParticipantProperty",value:function(e,t){var n;X("SEND setLocalParticipantProperty ".concat(e," ").concat(JSON.stringify(t))),null===(n=this._jitsiConference)||void 0===n||n.setLocalParticipantProperty(e,JSON.stringify(t))}},{key:"getLocalParticipantProperty",value:function(e){var t;return null===(t=this._jitsiConference)||void 0===t?void 0:t.getLocalParticipantProperty(e)}},{key:"kickParticipant",value:function(e){var t;null===(t=this._jitsiConference)||void 0===t||t.kickParticipant(e)}},{key:"setSenderVideoConstraint",value:function(e){var t;null===(t=this._jitsiConference)||void 0===t||t.setSenderVideoConstraint(e)}},{key:"setReceiverConstraints",value:function(e){var t;null===(t=this._jitsiConference)||void 0===t||t.setReceiverConstraints(e)}},{key:"setPerceptibles",value:function(e){var t;X("SEND setPerceptibles ".concat(e[0].length," ").concat(e[1].length)),(null===(t=this._jitsiConference)||void 0===t?void 0:t.setPerceptibles)&&this._jitsiConference.setPerceptibles(e)}},{key:"reduceBitrate",value:function(){if(config.rtc&&this._jitsiConference&&this._jitsiConference.jvbJingleSession){var e=this._jitsiConference.jvbJingleSession;if(!e.bitRateAlreadyReduced&&e.peerconnection.peerconnection)e.bitRateAlreadyReduced=!0,e.peerconnection.peerconnection.getSenders().forEach((function(e){if(e&&e.track){var t=e.getParameters();0===t.encodings.length&&t.encodings.push({}),t.encodings.forEach((function(t){"video"===e.track.kind&&config.rtc.maxBitrateForVideo?t.maxBitrate=1024*config.rtc.maxBitrateForVideo:"audio"===e.track.kind&&(t.maxBitrate=1024*config.rtc.maxBitrateForAudio)})),e.setParameters(t)}}))}}},{key:"sendMessage",value:function(e,t,n){config.bmRelayServer?this.pushOrUpdateMessageViaRelay(e,t,n):this.sendMessageViaJitsi(e,t,n)}},{key:"sendMessageViaJitsi",value:function(e,t,n){var i,r,a,o=this._jitsiConference,s=!!(null===o||void 0===o||null===(i=o.rtc)||void 0===i||null===(r=i._channel)||void 0===r?void 0:r.isOpen()),c=null===o||void 0===o||null===(a=o.chatRoom)||void 0===a?void 0:a.connection.connected;if(X("SEND sendMessage type:".concat(e," to:").concat(n," val:").concat(JSON.stringify(t))),s||c){var u,l=s?{type:e,value:t}:JSON.stringify({type:e,value:t});null===(u=this._jitsiConference)||void 0===u||u.sendMessage(l,n||"",s)}else b.a.remote.size&&console.log("Conference.sendMessageViaJitsi() failed: Not connected.")}},{key:"connectToRelayServer",value:function(){var e=this;if(!this.bmRelaySocket){var t=function(){e.messagesToSendToRelay=[],e.pushOrUpdateMessageViaRelay(x.b.REQUEST_ALL,{},void 0,!0),e.sync.sendAllAboutMe(),e.sendMessageViaRelay()},n=function(t){if("string"===typeof t.data){e.lastReceivedTime=Date.now(),e.relayRttLast=e.lastReceivedTime-e.lastRequestTime;var n,i=JSON.parse(t.data);if(i.length)(n=e.receivedMessages).push.apply(n,Object(o.a)(i));i.length&&(e.relayRttAverage=.3*e.relayRttLast+.7*e.relayRttAverage)}},i=function(){setTimeout((function(){e.bmRelaySocket=new WebSocket(config.bmRelayServer),a()}),5e3)},r=function(){var t;console.error("Error in WebSocket for ".concat(config.bmRelayServer)),null===(t=e.bmRelaySocket)||void 0===t||t.close(3e3,"onError"),i()},a=function(){var a,o,s,c;null===(a=e.bmRelaySocket)||void 0===a||a.addEventListener("error",r),null===(o=e.bmRelaySocket)||void 0===o||o.addEventListener("message",n),null===(s=e.bmRelaySocket)||void 0===s||s.addEventListener("open",t),null===(c=e.bmRelaySocket)||void 0===c||c.addEventListener("close",i)};this.bmRelaySocket=new WebSocket(config.bmRelayServer),a()}}},{key:"pushOrUpdateMessageViaRelay",value:function(e,t,n,i){if(Object(m.b)(config.bmRelayServer),this.bmRelaySocket&&this.bmRelaySocket.readyState===WebSocket.OPEN)if(this.name&&b.a.localId){var r={t:e,v:""};i&&(r.r=this.name,r.p=b.a.localId),n&&(r.d=n);var o=this.messagesToSendToRelay.findIndex((function(e){return e.t===r.t&&e.r===r.r&&e.p===r.p&&e.d===r.d}));if(o>=0)if(ee.has(r.t)){var s,c=JSON.parse(this.messagesToSendToRelay[o].v),u=Object(a.a)(t);try{var l=function(){var e=s.value;c.findIndex((function(t){return t===e}))<0&&c.push(e)};for(u.s();!(s=u.n()).done;)l()}catch(v){u.e(v)}finally{u.f()}this.messagesToSendToRelay[o].v=JSON.stringify(c)}else if(x.c.has(r.t)){var d,h=JSON.parse(this.messagesToSendToRelay[o].v),p=Object(a.a)(t);try{var f=function(){var e=d.value,t=h.findIndex((function(t){return t.id===e.id}));t>=0?h[t]=e:h.push(e)};for(p.s();!(d=p.n()).done;)f()}catch(v){p.e(v)}finally{p.f()}this.messagesToSendToRelay[o].v=JSON.stringify(h)}else r.v=JSON.stringify(t),this.messagesToSendToRelay[o]=r;else r.v=JSON.stringify(t),this.messagesToSendToRelay.push(r)}else console.warn("Relay Socket: Not connected. room:".concat(this.name," id:").concat(b.a.localId,"."))}},{key:"sendMessageViaRelay",value:function(){var e,t,n=this;0!==this.messagesToSendToRelay.length&&((null===(e=this.bmRelaySocket)||void 0===e?void 0:e.readyState)===WebSocket.OPEN?(this.bmRelaySocket.send(JSON.stringify(this.messagesToSendToRelay)),this.messagesToSendToRelay=[]):null===(t=this.bmRelaySocket)||void 0===t||t.addEventListener("open",(function(){!function e(){var t,i;(null===(t=n.bmRelaySocket)||void 0===t?void 0:t.readyState)!==WebSocket.OPEN?setTimeout(e,100):(null===(i=n.bmRelaySocket)||void 0===i||i.send(JSON.stringify(n.messagesToSendToRelay)),n.messagesToSendToRelay=[])}()})))}},{key:"registerJistiConferenceEvents",value:function(){var e=this;this._jitsiConference?(this._jitsiConference.on(Z.ENDPOINT_MESSAGE_RECEIVED,(function(t,n){Y("ENDPOINT_MESSAGE_RECEIVED from ".concat(t.getId()),n),n.values?e.emit(n.type,t.getId(),n.values):e.emit(n.type,t.getId(),n.value)})),this._jitsiConference.on(Z.PARTICIPANT_PROPERTY_CHANGED,(function(t,n,i,r){Y("PARTICIPANT_PROPERTY_CHANGED from ".concat(t.getId()," prop:").concat(n," old,new:"),i,r),"codecType"!==n&&e.emit(n,t.getId(),JSON.parse(r),i)})),this._jitsiConference.on(Z.CONFERENCE_JOINED,(function(){W("Joined to a conference room."),e.onConferenceJoined()})),this._jitsiConference.on(Z.USER_JOINED,(function(t,n){W("New participant[".concat(t,"] joined.")),e.emit($.USER_JOINED,t,n)})),this._jitsiConference.on(Z.USER_LEFT,(function(t,n){e.emit($.USER_LEFT,t,n),W("A participant left.")})),this._jitsiConference.on(Z.TRACK_ADDED,(function(t){q("TRACK_ADDED: ".concat(t," type:").concat(t.getType()," usage:").concat(t.getUsageLabel()," tid:").concat(t.getId()," msid:").concat(t.getOriginalStream().id)),t.isLocal()?e.onLocalTrackAdded(t):(e.emit($.REMOTE_TRACK_ADDED,t),setTimeout((function(){e.reduceBitrate()}),3e3))})),this._jitsiConference.on(Z.TRACK_REMOVED,(function(t){q("TRACK_REMOVED: ".concat(t," type:").concat(t.getType()," ").concat(t.getUsageLabel()," tid:").concat(t.getId()," msid:").concat(t.getOriginalStream().id)),t.isLocal()?e.onLocalTrackRemoved(t):e.emit($.REMOTE_TRACK_REMOVED,t)})),this._jitsiConference.on(Z.REMOTE_TRACK_VIDEOTYPE_CHANGING,(function(e,t){b.a.removeRemoteTrack(e)})),this._jitsiConference.on(Z.REMOTE_TRACK_VIDEOTYPE_CHANGED,(function(e,t){b.a.addRemoteTrack(e)})),this._jitsiConference.on(Z.TRACK_MUTE_CHANGED,(function(e){if(q("TRACK_MUTE_CHANGED on ".concat(e,".")),!e.isLocal()){var t=e,n=b.a.find(t.getParticipantId());n&&t.isVideoTrack()&&(n.muteVideo=t.isMuted())}})),this._jitsiConference.on(_.a.events.conference.TRACK_AUDIO_LEVEL_CHANGED,(function(e,t){var n=g.a.find(e);n&&(n===g.a.local&&n.muteAudio?null===n||void 0===n||n.tracks.setAudioLevel(0):null===n||void 0===n||n.tracks.setAudioLevel(t))})),this._jitsiConference.on(_.a.events.conference.PRIVATE_MESSAGE_RECEIVED,(function(e,t,n){Y("PRIVATE_MESSAGE_RECEIVED",e,t,n)})),this._jitsiConference.on(_.a.events.conference.MESSAGE_RECEIVED,(function(e,t,n){Y("MESSAGE_RECEIVED",e,t,n)})),this._jitsiConference.on(_.a.events.conference.KICKED,(function(t,n){e.sync.onKicked(t.getId(),n)}))):console.error("Dose not connected to conference yet.")}},{key:"onConferenceJoined",value:function(){for(var e in this.localId=this._jitsiConference.myUserId(),b.a.setLocalId(this.localId),this.sync.observeStart(),b.a.local.devicePreference)void 0===b.a.local.devicePreference[e]&&(b.a.local.devicePreference[e]="");config.bmRelayServer||setTimeout(E.b.loadWallpaper.bind(E.b),2e3),config.bmRelayServer&&this.connectToRelayServer()}},{key:"onLocalTrackAdded",value:function(e){var t=b.a.local;e.isAudioTrack()?(t.muteAudio?e.mute():e.unmute(),t.tracks.audio=e):(t.tracks.avatar=e,t.muteVideo&&this.removeTrack(e))}},{key:"onLocalTrackRemoved",value:function(e){var t=b.a.local;e.isAudioTrack()?t.tracks.audio=void 0:t.tracks.avatar=void 0}},{key:"getLocalTracks",value:function(e){return this._jitsiConference?this._jitsiConference.getLocalTracks(e):[]}},{key:"getLocalVideoTrack",value:function(){return this._jitsiConference?this._jitsiConference.getLocalVideoTrack():null}},{key:"replaceTrack",value:function(e,t){this._jitsiConference&&this._jitsiConference.replaceTrack(e,t)}},{key:"removeTrack",value:function(e){var t;return null===(t=this._jitsiConference)||void 0===t?void 0:t.removeTrack(e)}},{key:"removeTracks",value:function(e){var t=this;e.forEach((function(e){var n;return null===(n=t._jitsiConference)||void 0===n?void 0:n.removeTrack(e)}))}},{key:"addTrack",value:function(e){var t;null===(t=this._jitsiConference)||void 0===t||t.addTrack(e)}},{key:"addTracks",value:function(e){var t,n=Object(a.a)(e);try{for(n.s();!(t=n.n()).done;){var i,r,o=t.value;if(o!==e[e.length-1])null===(i=this._jitsiConference)||void 0===i||i.addTrack(o);else null===(r=this._jitsiConference)||void 0===r||r.addTrack(o).then((function(){}))}}catch(s){n.e(s)}finally{n.f()}}}]),n}(S.EventEmitter),r=Object(f.a)(i.prototype,"channelOpened",[C.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),i)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t),function(e){var i=n(15),r=n(73),a=n(18),o=n.n(a),s=n(64),c=n(10),u=n(339),l=n(125),d=n(80),h=n(250),p=n(153),f=n(70),m=n(52),v=n(59),g=n(214),b=n(44),y=n(20),E=n(167),S=n(164),O=n(396),_=n(76),C=n(218),T=n(397),j=n(399),A=n(96),k=n(213),R=n(400),I=n(26),P=n(401),w=n.n(P),N=n(43),D=n.n(N),M=n(163),L=n.n(M),x=n(78),F=n(402),U=n(19),V=n(101),B=n(220),J=n(32),H=o.a.getLogger(e);function z(e){var t={audio_requested:e.devices.includes("audio"),video_requested:e.devices.includes("video"),screen_sharing_requested:e.devices.includes("desktop")};return t.video_requested&&(t.resolution=e.resolution),t}t.default=function(e){return"object"===typeof window.JitsiMeetJS?Object.assign({},window.JitsiMeetJS,e):e}({version:"{#COMMIT_HASH#}",JitsiConnection:u.a,ProxyConnectionService:T.a,constants:{participantConnectionStatus:S.a,recording:j.a,sipVideoGW:x,transcriptionStatus:g},events:{conference:c,connection:d,detection:_,track:v,mediaDevices:p,connectionQuality:V,e2eping:B},errors:{conference:s,connection:l,track:m},errorTypes:{JitsiTrackError:f.a},logLevels:o.a.levels,mediaDevices:h.a,analytics:I.a.analytics,init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};A.a.init(e.externalStorage),I.a.init(e),window.connectionTimes||(window.connectionTimes={}),!0!==e.enableAnalyticsLogging&&(H.warn("Analytics disabled, disposing."),this.analytics.dispose()),e.enableWindowOnErrorHandler&&D.a.addHandler(this.getGlobalOnErrorHandler.bind(this));var t=e.deploymentInfo;if(t&&Object.keys(t).length>0){var n={};for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.id="deployment_info",I.a.sendLog(JSON.stringify(n))}if(this.version){var r={id:"component_version",component:"lib-jitsi-meet",version:this.version};I.a.sendLog(JSON.stringify(r))}return b.a.init(e)},isDesktopSharingEnabled:function(){return b.a.isDesktopSharingEnabled()},isWebRtcSupported:function(){return b.a.isWebRtcSupported()},setLogLevel:function(e){o.a.setLogLevel(e)},setLogLevelById:function(e,t){o.a.setLogLevelById(e,t)},addGlobalLogTransport:function(e){o.a.addGlobalTransport(e)},removeGlobalLogTransport:function(e){o.a.removeGlobalTransport(e)},setGlobalLogOptions:function(e){o.a.setGlobalOptions(e)},createLocalTracks:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,a=!1,o=t.firePermissionPromptIsShownEvent,s=t.fireSlowPromiseEvent,c=Object(r.a)(t,["firePermissionPromptIsShownEvent","fireSlowPromiseEvent"]),u=o||n;return u&&!b.a.arePermissionsGrantedForAvailableDevices()?h.a.emitEvent(p.PERMISSION_PROMPT_IS_SHOWN,y.a.getName()):s&&window.setTimeout((function(){a||h.a.emitEvent(p.SLOW_GET_USER_MEDIA)}),1e3),window.connectionTimes||(window.connectionTimes={}),window.connectionTimes["obtainPermissions.start"]=window.performance.now(),b.a.obtainAudioAndVideoPermissions(c).then((function(t){if(a=!0,window.connectionTimes["obtainPermissions.end"]=window.performance.now(),I.a.sendAnalytics(Object(J.F)("success",z(c))),!b.a.options.disableAudioLevels)for(var n=function(e){var n=t[e],i=n.getOriginalStream();n.getType()===U.a&&(I.a.startLocalStats(i,n.setAudioLevel.bind(n)),n.addEventListener(v.LOCAL_TRACK_STOPPED,(function(){I.a.stopLocalStats(i)})))},r=0;r<t.length;r++)n(r);var o=b.a.getCurrentlyAvailableMediaDevices();if(o)for(var s=0;s<t.length;s++){t[s]._setRealDeviceIdFromDeviceList(o)}var u,l=Object(i.a)(t);try{for(l.s();!(u=l.n()).done;){var d=u.value;d.type===U.c&&"desktop"===d.videoType&&e.setVideoTrackContentHints(d.track,"detail")}}catch(h){l.e(h)}finally{l.f()}return t})).catch((function(e){if(a=!0,e.name===m.SCREENSHARING_USER_CANCELED){var n={id:"screensharing_user_canceled",message:e.message};I.a.sendLog(JSON.stringify(n)),I.a.sendAnalytics(Object(J.F)("warning",{reason:"extension install user canceled"}))}else if(e.name===m.NOT_FOUND){var i={id:"usermedia_missing_device",status:e.gum.devices};I.a.sendLog(JSON.stringify(i));var r=z(t);r.reason="device not found",r.devices=e.gum.devices.join("."),I.a.sendAnalytics(Object(J.F)("error",r))}else{I.a.sendGetUserMediaFailed(e);var o=z(t);o.reason=e.name,I.a.sendAnalytics(Object(J.F)("error",o))}return window.connectionTimes["obtainPermissions.end"]=window.performance.now(),Promise.reject(e)}))},createTrackVADEmitter:function(e,t,n){return C.a.create(e,t,n)},createAudioMixer:function(){return new F.a},getActiveAudioDevice:function(){return Object(O.a)()},isDeviceListAvailable:function(){return H.warn("This method is deprecated, use JitsiMeetJS.mediaDevices.isDeviceListAvailable instead"),this.mediaDevices.isDeviceListAvailable()},isDeviceChangeAvailable:function(e){return H.warn("This method is deprecated, use JitsiMeetJS.mediaDevices.isDeviceChangeAvailable instead"),this.mediaDevices.isDeviceChangeAvailable(e)},isMultipleAudioInputSupported:function(){return this.mediaDevices.isMultipleAudioInputSupported()},isCollectingLocalStats:function(){return I.a.audioLevelsEnabled&&k.a.isLocalStatsSupported()},enumerateDevices:function(e){H.warn("This method is deprecated, use JitsiMeetJS.mediaDevices.enumerateDevices instead"),this.mediaDevices.enumerateDevices(e)},getGlobalOnErrorHandler:function(e,t,n,i,r){H.error("UnhandledError: ".concat(e),"Script: ".concat(t),"Line: ".concat(n),"Column: ".concat(i),"StackTrace: ",r),I.a.reportGlobalError(r)},setNetworkInfo:function(e){var t=e.isOnline;E.b.updateNetworkInfo({isOnline:t})},setVideoTrackContentHints:function(e,t){"contentHint"in e?(e.contentHint=t,e.contentHint!==t&&H.debug("Invalid video track contentHint")):H.debug("MediaStreamTrack contentHint attribute not supported")},precallTest:R.a,util:{AuthUtil:w.a,ScriptUtil:L.a,browser:y.a}})}.call(this,"/index.js")},,,,function(e,t){e.exports={LOCAL_JID:"local"}},,,,,,,,,,,function(e,t){e.exports=function(e,t,n,i){this.blob=e,this.name=t,this.startTime=n,this.wordArray=i}},function(e,t,n){var i=n(503),r=n(309),a=n(504),o=function(){this.url=function(){var e="config does not contain an url to a Sphinx4 https server";if(void 0===config.sphinxURL)console.log(e);else{var t=config.sphinxURL;if(void 0!==t.includes&&t.includes("https://"))return t;console.log(e)}}()};o.prototype=Object.create(a.prototype),o.constructor=o,o.prototype.sendRequest=function(e,t){console.log("sending an audio file  to ".concat(this.url)),console.log("the audio file being sent: ".concat(e));var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE&&200===n.status)t(n.responseText);else if(n.readyState===XMLHttpRequest.DONE)throw new Error("unable to accept response from sphinx server. status: ".concat(n.status))},n.open("POST",this.url),n.setRequestHeader("Content-Type",r.determineCorrectFileType()),n.send(e),console.log("send ".concat(e))},o.prototype.formatResponse=function(e){var t=JSON.parse(e).objects;t.shift();var n=[];return t.forEach((function(e){return e.filler||n.push(new i(e.word,e.start,e.end))})),n},o.prototype.verify=function(e){if(console.log("response from server:".concat(e.toString())),"string"!==typeof e)return!1;var t;try{t=JSON.parse(e)}catch(i){return console.log(i),!1}if(void 0===t.objects)return!1;var n=t.objects;return!(!n[0]||!n[0]["session-id"])},e.exports=o},function(e,t){var n=function(e,t,n){this.word=e,this.begin=t,this.end=n};n.prototype.getWord=function(){return this.word},n.prototype.getBeginTime=function(){return this.begin},n.prototype.getEndTime=function(){return this.end},e.exports=n},function(e,t){var n=function(){throw new Error("TranscriptionService is abstract and cannot becreated")};n.prototype.send=function(e,t){var n=this;this.sendRequest(e.blob,(function(i){n.verify(i)?e.wordArray=n.formatResponse(i):(console.log("the retrieved response from the server is not valid!"),e.wordArray=[]),t(e)}))},n.prototype.sendRequest=function(e,t){throw new Error("TranscriptionService.sendRequest is abstract")},n.prototype.formatResponse=function(e){throw new Error("TranscriptionService.format is abstract")},n.prototype.verify=function(e){throw new Error("TranscriptionService.verify is abstract")},e.exports=n},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t);var i=n(7),r=n(27),a=n(0),o=n.n(a),s=Object(a.createContext)({}),c=s.Provider,u=Object(a.createContext)({}),l=u.Provider,h=function(){return Object(a.useContext)(u)},p=Object(a.createContext)({}),f=p.Provider,m=function(){return Object(a.useContext)(p)},v=Object(a.createContext)({}),g=v.Provider,b=function(){return Object(a.useContext)(v)},y=n(61),E=n(3),S=n(86),O=n(58),_=n(117),C=n(11),T=n(17),j=n(23),A=n(187),k=n(6),R=n(720),I=n(697),P=n(723),w=n(694),N=n(701),D=n(22),M=n(1),L=function(){Object(a.useEffect)((function(){_.a.keyInputUsers.add("AfkDialog")}));var e=function(e){_.a.keyInputUsers.delete("AfkDialog");var t=e;t.code&&(t.preventDefault(),t.stopPropagation()),O.a.clear()};return Object(M.jsx)(z,{onClose:e,children:Object(M.jsx)(w.a,{style:{fontSize:Object(E.w)()?"2em":"1em"},children:Object(M.jsx)(I.a,{color:"primary",variant:"contained",style:{textTransform:"none"},autoFocus:!0,onKeyDown:e,onClick:e,children:Object(D.c)("afkMessage")})})})};L.displayName="AfkDialog";var x=n.p+"static/media/usage.en.98a80f40.png",F=n.p+"static/media/usage.ja.0ce862b2.png",U=n(719),V=n(406),B=n.n(V),J=function(e){var t=m(),n=Object(a.useState)(t.local.information.name),i=Object(r.a)(n,2),o=i[0],s=i[1],c=sessionStorage.getItem("room"),u=Object(a.useState)(y.a.room?y.a.room:c||""),l=Object(r.a)(u,2),d=l[0],h=l[1],p=function(e){e&&(t.local.information.name!==o&&(t.local.information.name=o,t.local.sendInformation(),t.local.saveInformationToStorage(!0)),y.a.room=d,sessionStorage.setItem("room",d)),O.a.clear()},f=function(e){"Enter"===e.key?p(!0):"Esc"!==e.key&&"Escape"!==e.key||p(!1)},v=Object(D.d)(),g=v.t,b=v.i18n,S={fontSize:Object(E.w)()?"2em":"1em",height:Object(E.w)()?"2em":"1.5em"},_={fontSize:(Object(E.w)(),"1em")},C={height:Object(E.w)()?"4em":"3em"};return Object(M.jsx)(z,{onClose:function(){O.a.clear()},children:Object(M.jsxs)(w.a,{style:{fontSize:Object(E.w)()?"2em":"1em"},children:[Object(M.jsx)(I.a,{style:{position:"absolute",top:30,right:20,display:"none"},onClick:function(){var e=(D.b.findIndex((function(e){return e===b.language}))+1)%D.b.length;b.changeLanguage(D.b[e])},children:Object(M.jsx)(B.a,{})}),Object(M.jsx)("h2",{children:"EarShot Chat"}),Object(M.jsxs)("p",{children:[Object(M.jsx)("img",{style:{float:"right",width:"28em",display:"none"},src:"ja"===b.language?F:x,alt:"usage"}),g("enAbout"),"\xa0",Object(M.jsx)("a",{href:g("enTopPageUrl"),children:g("enMoreInfo")})]}),Object(M.jsx)("br",{}),Object(M.jsx)(U.a,{label:g("YourName"),multiline:!1,value:o,style:C,inputProps:{style:S,autoFocus:!0},InputLabelProps:{style:_},onChange:function(e){return s(e.target.value)},onKeyPress:f,fullWidth:!0}),Object(M.jsx)(R.a,{mt:4,children:Object(M.jsx)(U.a,{label:g("Venue"),multiline:!1,value:d,style:C,inputProps:{style:S,autoFocus:!1},InputLabelProps:{style:_},onChange:function(e){return h(e.target.value)},onKeyPress:f,fullWidth:!0})}),Object(M.jsx)(R.a,{mt:4,children:Object(M.jsx)(I.a,{variant:"contained",color:"primary",onClick:function(){return p(!0)},style:{fontSize:Object(E.w)()?"1.25em":"1em"},children:g("EnterTheVenue")})})]})})};J.displayName="TheEntrance";var H=new Map;H.set("entrance",Object(M.jsx)(J,{})),H.set("afk",Object(M.jsx)(L,{}));var z=function(e){return Object(M.jsxs)(P.a,Object(i.a)(Object(i.a)({},e),{},{open:O.a.show(),onClose:e.onClose,maxWidth:"md",fullWidth:!1,children:[O.a.title?Object(M.jsx)(N.a,{id:"simple-dialog-title",children:O.a.title}):void 0,e.children]}))},G=function(e){function t(){"retry"!==O.a.type&&O.a.clear()}return Object(M.jsx)(j.a,{children:function(){return O.a.type?H.has(O.a.type)?H.get(O.a.type):Object(M.jsxs)(z,{onClose:function(){t()},children:[Object(M.jsx)(w.a,{children:O.a.message}),"retry"!==O.a.type?Object(M.jsxs)(R.a,{mt:2,mb:2,ml:4,children:[Object(M.jsx)(I.a,{variant:"contained",color:"primary",style:{textTransform:"none"},onClick:function(){t()},children:Object(D.c)("emClose")}),"\xa0",Object(M.jsx)(I.a,{variant:"contained",color:"secondary",style:{textTransform:"none"},onClick:function(){O.a.supressedTypes.add(O.a.type),t()},children:Object(D.c)("emNeverShow")})]}):void 0]}):Object(M.jsx)(M.Fragment,{})}})};function K(e){var t=e.split("_");return Object(E.b)(t.length<=2),Object(M.jsxs)(M.Fragment,{children:[t[0],t[1]?Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)("strong",{children:t[1].substr(0,1)}),t[1].substr(1)]}):void 0]})}G.displayName="ErrorDialog";var Q=n(228),q=n.n(Q),W=n(68),Y=n(714),X=n(458),Z=n(710),$=n(699),ee=n(707),te=n(431),ne=n.n(te),ie=n(238),re=n.n(ie),ae=n(434),oe=n.n(ae),se=n(433),ce=n.n(se),ue=n(432),le=n.n(ue),de=n(237),he=n.n(de),pe=n(430),fe=n.n(pe),me=n(30),ve=n(33),ge=n(28),be=n(171),ye=n(703),Ee=n(702),Se=n(725),Oe=30,_e=function(e){return Object(M.jsx)(Ee.a,{container:!0,spacing:2,children:Object(M.jsx)(Se.a,{value:e.value,min:0,max:Oe,track:!1,valueLabelDisplay:"auto","aria-labelledby":"continuous-slider",style:{width:200},onChange:function(t,n){return e.setValue(n)},valueLabelFormat:function(e){return e===Oe?"\u221e":e.toString()}})})},Ce=function(){var e=m().local,t=Object(j.b)((function(){return e.remoteVideoLimit})),n=Object(j.b)((function(){return e.remoteAudioLimit})),i=Object(M.jsx)(_e,{value:t>=0?t:Oe,setValue:function(t){e.remoteVideoLimit=t===Oe?-1:t}}),r=Object(M.jsx)(_e,{value:n>=0?n:Oe,setValue:function(t){e.remoteAudioLimit=t===Oe?-1:t}});return Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)(ye.a,{control:i,label:Object(D.c)("videoLimit")}),Object(M.jsx)(ye.a,{control:r,label:Object(D.c)("audioLimit")}),Object(M.jsx)("br",{}),Object(M.jsx)(I.a,{variant:"contained",color:ge.a.passMatched?"primary":"default",style:{textTransform:"none"},disabled:!ge.a.passMatched,onClick:function(){ge.a.passMatched&&me.b.conference.sync.sendTrackLimits("",[e.remoteVideoLimit,e.remoteAudioLimit])},children:"Sync limits"})]})};function Te(e){if("Enter"===e.key){var t=ge.a.roomProps.get("password");ge.a.passMatched=ge.a.password===(t||"")}}function je(){return ge.a.passMatched?"primary":"default"}Ce.displayName="RemoteTrackLimitControl";var Ae=function(e){var t=o.a.useState(""),n=Object(r.a)(t,2),i=n[0],a=n[1],s=o.a.useState(!1),c=Object(r.a)(s,2),u=c[0],l=c[1],d=o.a.useState(!1),h=Object(r.a)(d,2),p=h[0],f=h[1],m=o.a.useRef(null),v=o.a.useRef(null);return Object(M.jsx)(j.a,{children:function(){var e=Object(E.t)(ge.a.backgroundFill)?"white":"black",t=Object(E.t)(ge.a.backgroundColor)?"white":"black";return Object(M.jsxs)(R.a,{m:2,children:[Object(M.jsx)(R.a,{m:2,children:Object(M.jsx)(Ce,{},"remotelimitcontrol")}),Object(M.jsxs)(R.a,{mt:2,mb:2,children:[Object(M.jsx)(U.a,{autoFocus:!0,label:"Admin password",type:"password",style:{marginTop:-12},value:null===ge.a||void 0===ge.a?void 0:ge.a.password,onChange:function(e){ge.a.password=e.currentTarget.value},onKeyPress:Te}),"\u2003",Object(M.jsx)(I.a,{variant:"contained",color:"primary",style:{textTransform:"none"},onClick:function(){var e=ge.a.roomProps.get("password");e||(e=""),ge.a.passMatched=(null===ge.a||void 0===ge.a?void 0:ge.a.password)===e},children:" Check "}),"\u2003",ge.a.passMatched?"OK":"Not matched"]}),Object(M.jsxs)(R.a,{mt:2,mb:2,children:[Object(M.jsx)(U.a,{label:"New password to update",type:"text",style:{marginTop:-12},value:null===ge.a||void 0===ge.a?void 0:ge.a.newPassword,onChange:function(e){ge.a.newPassword=e.currentTarget.value}}),"\u2003",Object(M.jsx)(I.a,{variant:"contained",color:je(),disabled:!ge.a.passMatched,style:{textTransform:"none"},onClick:function(){ge.a.passMatched&&me.b.conference.setRoomProp("password",ge.a.newPassword)},children:" Update password "}),"\u2003"]}),Object(M.jsxs)(R.a,{mt:2,children:[Object(M.jsx)(I.a,{variant:"contained",color:je(),style:{textTransform:"none"},disabled:!ge.a.passMatched,onClick:function(){ge.a.passMatched&&me.b.conference.sendMessage(ve.b.MUTE_VIDEO,!0)},children:" Mute all videos "})," \xa0",Object(M.jsx)(I.a,{variant:"contained",color:je(),style:{textTransform:"none"},disabled:!ge.a.passMatched,onClick:function(){ge.a.passMatched&&me.b.conference.sendMessage(ve.b.MUTE_VIDEO,!1)},children:" Show all videos "}),"\u2003",Object(M.jsx)(I.a,{variant:"contained",color:je(),style:{textTransform:"none"},disabled:!ge.a.passMatched,onClick:function(){ge.a.passMatched&&me.b.conference.sendMessage(ve.b.MUTE_AUDIO,!0)},children:" Mute all mics "}),"\xa0",Object(M.jsx)(I.a,{variant:"contained",color:je(),style:{textTransform:"none"},disabled:!ge.a.passMatched,onClick:function(){ge.a.passMatched&&me.b.conference.sendMessage(ve.b.MUTE_AUDIO,!1)},children:" Switch on all mics "})]}),Object(M.jsxs)(R.a,{mt:2,children:[Object(M.jsx)(I.a,{variant:"contained",color:je(),style:{textTransform:"none"},disabled:!ge.a.passMatched,onClick:function(){ge.a.passMatched&&T.b.removeAllContents()},children:" Remove all Contents "}),"\u2003",Object(M.jsx)(I.a,{variant:"contained",color:je(),style:{textTransform:"none"},disabled:!ge.a.passMatched,onClick:function(){ge.a.passMatched&&T.b.all.filter((function(e){return e.ownerName===i})).forEach((function(e){return T.b.removeByLocal(e.id)}))},children:" Clear contents by user name "})," \u2009",Object(M.jsx)(U.a,{label:"name",type:"text",style:{marginTop:-12},value:i,onChange:function(e){a(e.currentTarget.value)}})]}),Object(M.jsxs)(R.a,{mt:2,children:[Object(M.jsx)(I.a,{variant:"contained",color:je(),style:{textTransform:"none"},disabled:!ge.a.passMatched,onClick:function(){var e;ge.a.passMatched&&(me.b.conference.sendMessageViaJitsi(ve.b.RELOAD_BROWSER,{}),(null===(e=me.b.conference.bmRelaySocket)||void 0===e?void 0:e.readyState)===WebSocket.OPEN&&me.b.conference.pushOrUpdateMessageViaRelay(ve.b.RELOAD_BROWSER,{}))},children:" Reload "}),"\u2003",Object(M.jsx)(I.a,{variant:"contained",disabled:!ge.a.passMatched,style:{backgroundColor:Object(E.E)(ge.a.backgroundFill),color:e,textTransform:"none"},onClick:function(){ge.a.passMatched&&l(!0)},ref:m,children:"Back color"}),Object(M.jsx)($.a,{open:u,onClose:function(){l(!1),me.b.conference.setRoomProp("backgroundFill",JSON.stringify(ge.a.backgroundFill))},anchorEl:m.current,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:Object(M.jsx)(be.a,{color:{r:ge.a.backgroundFill[0],g:ge.a.backgroundFill[1],b:ge.a.backgroundFill[2]},disableAlpha:!0,onChange:function(e,t){t.preventDefault(),ge.a.backgroundFill=[e.rgb.r,e.rgb.g,e.rgb.b]}})}),"\xa0",Object(M.jsx)(I.a,{variant:"contained",disabled:!ge.a.passMatched,style:{backgroundColor:Object(E.E)(ge.a.backgroundColor),color:t,textTransform:"none"},onClick:function(){ge.a.passMatched&&f(!0)},ref:v,children:"Pattern color"}),Object(M.jsx)($.a,{open:p,onClose:function(){f(!1),me.b.conference.setRoomProp("backgroundColor",JSON.stringify(ge.a.backgroundColor))},anchorEl:v.current,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:Object(M.jsx)(be.a,{color:{r:ge.a.backgroundColor[0],g:ge.a.backgroundColor[1],b:ge.a.backgroundColor[2]},disableAlpha:!0,onChange:function(e,t){t.preventDefault(),ge.a.backgroundColor=[e.rgb.r,e.rgb.g,e.rgb.b]}})}),"\xa0",Object(M.jsx)(I.a,{variant:"contained",color:je(),style:{textTransform:"none"},disabled:!ge.a.passMatched,onClick:function(){ge.a.passMatched&&(ge.a.backgroundFill=[223,219,229],ge.a.backgroundColor=[185,178,196],me.b.conference.setRoomProp("backgroundFill",JSON.stringify(ge.a.backgroundFill)),me.b.conference.setRoomProp("backgroundColor",JSON.stringify(ge.a.backgroundColor)))},children:" Default "}),"\u2003"]})]})}})},ke=n(705),Re=n(704),Ie=function(){var e=m().local,t=Object(M.jsx)(j.a,{children:function(){return Object(M.jsx)(Re.a,{checked:e.physics.onStage,name:"broadcast",onChange:function(t){return e.setPhysics({onStage:t.target.checked})}})}}),n=Object(D.d)().t;return Object(M.jsx)(ke.a,{children:Object(M.jsx)(ye.a,{control:t,label:n("broadcastMyVoice")})})};Ie.displayName="BroadcastControl";var Pe=n(651),we=n(706),Ne=n(411),De=n.n(Ne);function Me(e,t){return{onMouseOver:function(n){var i;(null===(i=n.nativeEvent.sourceCapabilities)||void 0===i?void 0:i.firesTouchEvents)||(t.timeout&&(clearTimeout(t.timeout),t.timeout=void 0),e(!0))},onMouseOut:function(n){t.timeout&&clearTimeout(t.timeout),t.timeout=setTimeout((function(){e(!1),t.timeout=void 0}),500)}}}var Le,xe,Fe,Ue=function(e){var t=h();return Object(M.jsx)(we.a,{in:e.show,style:e.style,children:Object(M.jsx)(Pe.a,{className:e.className,color:e.color,onClick:function(n){e.onClickMore&&e.onClickMore(n,t)},size:"small",ref:e.buttonRef,children:Object(M.jsx)(De.a,{color:e.iconColor,htmlColor:e.htmlColor,fontSize:"large"})})})},Ve=n(709),Be=n(708),Je=Object(ee.a)((function(e){return{container:{display:"inline-block",marginLeft:e.spacing(2),marginRight:e.spacing(2),marginTop:e.spacing(1),marginBottom:e.spacing(1),pointerEvents:"auto"}}})),He=function(e){var t=Je(),n=Object(a.useState)(!1),o=Object(r.a)(n,2),s=o[0],c=o[1],u=Object(a.useRef)({timeout:void 0}).current;return Object(M.jsxs)("div",Object(i.a)(Object(i.a)({className:t.container+(e.className?" ".concat(e.className):""),style:e.style,ref:e.divRef},Me(c,u)),{},{children:[Object(M.jsx)(Be.a,{style:{height:e.size,width:e.size},onClick:function(t){e.onClick&&e.onClick(t)},onContextMenu:function(t){t.preventDefault(),e.onClickMore&&e.onClickMore(t)},color:e.color,onFocus:function(e){var t;null===(t=e.target)||void 0===t||t.blur()},children:e.children}),e.onClickMore?Object(M.jsx)(Ue,{style:{position:"relative",top:-35,left:-15,marginRight:-41},show:s,color:e.color,htmlColor:e.htmlColor,iconColor:e.iconColor,onClickMore:e.onClickMore}):void 0]}))},ze=function(e){return e.title?Object(M.jsx)(Ve.a,{placement:"top-start",arrow:!0,title:e.title,children:Object(M.jsx)("span",{style:{paddingTop:20},children:Object(M.jsx)(He,Object(i.a)({},e))})}):Object(M.jsx)(He,Object(i.a)({},e))},Ge=n(413),Ke=n(654),Qe=n(41),qe=n(24),We=n(12),Ye=(n(83),n(62)),Xe=n.n(Ye),Ze=n(4),$e=(Le=Ze.h.shallow,xe=function e(){Object(k.a)(this,e),Object(qe.a)(this,"videos",Fe,this),Object(Ze.g)(this)},Fe=Object(We.a)(xe.prototype,"videos",[Le],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xe),et=function(e){var t=e.setStep,n=b(),i=h(),r=m(),o=Object(j.b)((function(){return e.cameras.videos.map((function(e,t){return function(e,t,n){var i=!1;i=e.deviceId===r.local.devicePreference.videoInputDevice;var a=String.fromCharCode(65+n);return Object(M.jsx)(Z.a,{onClick:function(){t(e.deviceId)},children:"".concat(a,"\xa0").concat(i?"\ud83d\ude42\xa0":"\xa0\xa0\u2003").concat(e.label)},e.deviceId)}(e,s,t)}))}));function s(e){t("none"),e&&Xe.a.createLocalTracks({devices:["video"],cameraDeviceId:e}).then((function(e){if(e.length){var t=Object(Qe.h)(e,i,"camera");n.shareContent(t),Object(E.b)(t.id),n.tracks.addLocalContent(t.id,e)}}))}return Object(a.useEffect)((function(){var t=function(t){if("Key"===t.code.substr(0,3)){var n,i=t.code.charCodeAt(3)-65;s(null===(n=e.cameras.videos[i])||void 0===n?void 0:n.deviceId)}};return window.addEventListener("keypress",t),function(){window.removeEventListener("keypress",t)}}),[]),Object(M.jsx)(M.Fragment,{children:o})};et.displayName="CameraSelector";var tt=n(454),nt=n(700),it=n(653);function rt(e){var t=e.setStep,n=e.value,i=e.onFinishInput,r=e.inputField;return Object(M.jsxs)(nt.a,{children:[Object(M.jsx)(it.a,{children:r}),Object(M.jsx)(it.a,{children:Object(M.jsx)(I.a,{variant:"contained",color:"primary",onClick:function(){i(n),t("none")},children:"Done"})})]})}rt.displayName="Input";var at=function(e){var t=e.setStep,n=(e.type,Object(a.useState)([])),i=Object(r.a)(n,2),o=i[0],s=i[1],c=Object(D.d)().t,u=Object(M.jsx)(tt.a,{acceptedFiles:["image/*"],dropzoneText:c("imageDropzoneText"),onChange:s}),l=h();return Object(M.jsx)(rt,{setStep:t,onFinishInput:function(t){t.forEach((function(t,n){Object(Qe.d)(t,l,[30*n,-20*n],e.type).then((function(e){return T.b.shareContent(e)}))}))},value:o,inputField:u})},ot=n(422),st=n(231),ct=n(423),ut=n.n(ct),lt=n(713),dt=n(698),ht=n(721),pt=n(726),ft=n(233),mt=n.n(ft),vt=n(424),gt=n.n(vt),bt=n(425),yt=n.n(bt),Et=n(428),St=n.n(Et),Ot=n(235),_t=n.n(Ot),Ct=n(289),Tt=n.n(Ct),jt=n(427),At=n.n(jt),kt=n(185),Rt=n.n(kt),It=n(426),Pt=n.n(It),wt=n(232),Nt=n.n(wt),Dt=n(157),Mt=n(158),Lt=n(45),xt=n.n(Lt),Ft=n(711),Ut=n(712),Vt=function(e){var t=e.icon,n=e.text,i=e.onClick,r=K(n);return t?Object(M.jsxs)(it.a,{button:!0,dense:e.dense,onClick:i,children:[Object(M.jsx)(Ft.a,{style:{fontSize:Object(E.w)()?"2.5em":"1em"},children:t}),Object(M.jsx)(Ut.a,{style:{fontSize:Object(E.w)()?"2.5em":"1em"},primary:r,secondary:e.secondEl}),e.children]}):Object(M.jsxs)(it.a,{dense:e.dense,onClick:i,children:[Object(M.jsx)(Ut.a,{style:{fontSize:Object(E.w)()?"2.5em":"1em"},primary:r,secondary:e.secondEl}),e.children]})};function Bt(e){return new Promise((function(t,n){Dt.b.desktopSharingFrameRate.max=e.contents.screenFps,Xe.a.createLocalTracks({devices:["desktop"]}).then((function(e){t(e)})).catch((function(e){console.warn("Share screen error: ".concat(e))}))}))}var Jt=function(e){var t=Object(D.d)().t,n=b(),i=m(),s=h(),c=Object(j.b)((function(){return{main:n.tracks.localMains.size,contents:n.tracks.localContents.size}})),u=Object(j.b)((function(){return i.local.mouse.show})),l=Object(a.useRef)(null),d=o.a.useState(!1),p=Object(r.a)(d,2),f=p[0],v=p[1];function g(t){"camera"===t&&navigator.mediaDevices.enumerateDevices().then((function(t){e.cameras.videos=t.filter((function(e){return"videoinput"===e.kind}))})).catch((function(){console.warn("Device enumeration error")})),e.setStep(t)}var y=function(){var e;null===(e=l.current)||void 0===e||e.click()},S=function(){g("none"),function(e){var t=JSON.stringify(Object(Qe.k)(e.all)),n=new Blob([t],{type:"text/plain"}),i=document.createElement("a"),r=URL.createObjectURL(n);i.href=r,i.download="BinauralMeetSharedItems.json",document.body.appendChild(i),i.click(),setTimeout((function(){document.body.removeChild(i),window.URL.revokeObjectURL(r)}),0)}(n)},O=function(){g("none");var e=Object(Qe.g)("",s);n.shareContent(e),n.setEditing(e.id)},_=function(){g("none");var e=new Uint32Array(4);e=window.crypto.getRandomValues(e);var t="";e.forEach((function(e){return t+=e.toString(16)})),Object(Qe.c)("https://wbo.ophir.dev/boards/BinauralMeet_".concat(Mt.a.conference.name,"_").concat(t),s).then((function(e){n.shareContent(e),n.setEditing(e.id)}))},C=function(){Bt(e).then((function(e){if(e.length){var t=Object(Qe.h)(e,s,"screen");n.shareContent(t),Object(E.b)(t.id),n.tracks.addLocalContent(t.id,e)}})),g("none")},T=function(){Array.from(n.tracks.localContents.keys()).forEach((function(e){return n.removeByLocal(e)})),g("none")},A=function(){c.main?n.tracks.clearLocalMains():Bt(e).then((function(e){e.length&&n.tracks.addLocalMains(e)})),g("none")};return Object(a.useEffect)((function(){var e=function(e){s.keyInputUsers.has("shareDialog")&&("KeyI"===e.code?y():"KeyD"===e.code?S():"KeyF"===e.code?(e.preventDefault(),g("iframe")):"KeyT"===e.code?(e.preventDefault(),O()):"KeyG"===e.code?(e.preventDefault(),g("image")):"KeyW"===e.code?(e.preventDefault(),_()):"KeyB"===e.code?A():"KeyS"===e.code?C():"KeyM"===e.code?(i.local.mouse.show=!u,g("none")):"KeyC"===e.code?g("camera"):"KeyL"===e.code&&T())};return window.addEventListener("keypress",e),function(){window.removeEventListener("keypress",e)}}),[]),Object(M.jsxs)(nt.a,{children:[Object(M.jsx)(Vt,{text:t("shareImage"),icon:Object(M.jsx)(Tt.a,{}),onClick:function(){return g("image")}},"shareImage"),Object(M.jsx)(Vt,{text:t("shareText"),icon:Object(M.jsx)(Nt.a,{}),onClick:O},"shareText"),Object(M.jsx)(Vt,{text:t("shareWhiteboard"),icon:Object(M.jsx)(W.Icon,{icon:st.a,style:{fontSize:"1.5rem"}}),onClick:_},"shareWhiteboard"),Object(M.jsx)(lt.a,{}),Object(M.jsx)(lt.a,{}),Object(M.jsx)(Vt,{text:t("shareZoneImage"),icon:Object(M.jsx)(Tt.a,{}),onClick:function(){return g("zoneimage")}},"shareZoneImage"),Object(M.jsx)(lt.a,{}),Object(M.jsx)(Vt,{icon:Object(M.jsx)(W.Icon,{icon:ut.a,style:{fontSize:"1.5rem"}}),text:t(u?"stopMouse":"shareMouse"),onClick:function(){i.local.mouse.show=!u,g("none")}},"shareMouse"),Object(M.jsx)(Vt,{text:t("shareCamera"),icon:Object(M.jsx)(mt.a,{}),onClick:function(){return g("camera")}},"shareCamera"),Object(M.jsx)(Vt,{icon:Object(M.jsx)(Rt.a,{}),text:t("shareScreenContent"),onClick:C,secondEl:Object(M.jsx)(dt.a,{component:"fieldset",children:Object(M.jsx)(j.a,{children:function(){return Object(M.jsxs)(pt.a,{row:!0,"aria-label":"screen-fps",name:"FPS",value:e.contents.screenFps,onChange:function(t){e.contents.setScreenFps(Number(t.target.value))},onClick:function(e){e.stopPropagation(),setTimeout(C,100)},children:[Object(M.jsx)(ye.a,{value:1,control:Object(M.jsx)(ht.a,{}),label:"1"}),Object(M.jsx)(ye.a,{value:5,control:Object(M.jsx)(ht.a,{}),label:"5"}),Object(M.jsx)(ye.a,{value:15,control:Object(M.jsx)(ht.a,{}),label:"15"}),Object(M.jsx)(ye.a,{value:30,control:Object(M.jsx)(ht.a,{}),label:"30"}),Object(M.jsx)(ye.a,{value:60,control:Object(M.jsx)(ht.a,{}),label:Object(M.jsxs)("span",{children:["60\xa0\xa0\xa0\xa0",t("fps")]})})]})}})})},"shareScreenContent"),n.tracks.localContents.size?Object(M.jsx)("div",{style:{paddingLeft:"1em"},children:Object(M.jsx)(Vt,{dense:!0,icon:Object(M.jsx)(W.Icon,{icon:ot.a,style:{fontSize:"1.5rem"}}),text:t("stopScreen"),onClick:T},"stopScreen")}):void 0,Object(M.jsx)(lt.a,{}),Object(M.jsx)(it.a,{button:!0,dense:!0,onClick:function(){v(!f)},children:f?Object(M.jsx)(gt.a,{}):Object(M.jsx)(yt.a,{})}),Object(M.jsx)(Y.a,{in:f,timeout:"auto",unmountOnExit:!0,children:Object(M.jsxs)("div",{style:{paddingLeft:"1em"},children:[Object(M.jsx)(Vt,{text:t("shareIframe"),icon:Object(M.jsx)(_t.a,{}),onClick:function(){return g("iframe")}},"shareIframe"),Object(M.jsx)(Vt,{icon:c.main?Object(M.jsx)(Pt.a,{}):Object(M.jsx)(Rt.a,{}),text:c.main?t("stopScreenBackground"):t("shareScreenBackground"),onClick:A},"shareScreenBackground"),Object(M.jsx)(lt.a,{}),Object(M.jsx)("input",{type:"file",accept:"application/json",ref:l,style:{display:"none"},onChange:function(e){g("none"),function(e,t){var n,i=null===(n=e.currentTarget)||void 0===n?void 0:n.files;i&&i.length&&i[0].text().then((function(e){var n=JSON.parse(e);Object(Lt.isArray)(n)&&n.forEach((function(e){var n=Object(Qe.i)(e);if("screen"!==n.type&&"camera"!==n.type){var i=Object(Qe.b)();Object.assign(i,n),t.addLocalContent(i)}}))}))}(e,n)}}),Object(M.jsx)(Vt,{text:t("shareImport"),icon:Object(M.jsx)(At.a,{}),onClick:y},"shareImport"),Object(M.jsx)(Vt,{text:t("shareDownload"),icon:Object(M.jsx)(St.a,{}),onClick:S},"shareDownload")]})})]})};Jt.displayName="ShareMenu";var Ht=function(e){var t=e.setStep,n=e.onFinishInput,i=e.textLabel,o=e.defaultValue,s=Object(a.useState)(void 0===o?"":o),c=Object(r.a)(s,2),u=c[0],l=c[1],d=Object(M.jsx)(U.a,{label:i,multiline:e.multiline,value:u,onChange:function(e){return l(e.target.value)},fullWidth:!0,inputProps:{autoFocus:!0},onKeyPress:function(i){e.multiline||"Enter"!==i.key||(n(u),t("none"))}});return Object(M.jsx)(rt,{setStep:t,onFinishInput:n,value:u,inputField:d})};Ht.displayName="TextInput";var zt=function(e){var t=e.open,n=e.onClose,o=Object(a.useRef)(new $e),s=h(),c=Object(a.useState)("menu"),u=Object(r.a)(c,2),l=u[0],d=u[1];T.b.pasteEnabled="none"===l||"menu"===l;var p=Object(D.d)().t,f={menu:p("Create and Share"),text:p("Share Text"),iframe:p("Share iframe"),image:p("Share image"),zoneimage:p("Share zone image"),none:"None",camera:p("Select video camera to share")}[l],m=function(t,n){switch(t){case"menu":return Object(M.jsx)(Jt,Object(i.a)(Object(i.a)({},e),{},{setStep:n,cameras:o.current}));case"text":return Object(M.jsx)(Ht,{setStep:n,onFinishInput:function(e){T.b.shareContent(Object(Qe.g)(e,s))},textLabel:"Text",multiline:!0});case"iframe":return Object(M.jsx)(Ht,{setStep:n,onFinishInput:function(e){Object(Qe.c)(e,s).then((function(e){T.b.shareContent(e)}))},textLabel:"URL",multiline:!1});case"image":case"zoneimage":return Object(M.jsx)(at,{setStep:n,type:t});case"camera":return Object(M.jsx)(et,{setStep:n,cameras:o.current});default:throw new Error("Unknown step: ".concat(t))}}(l,(function(e){"none"===e?n():d(e)}));return Object(M.jsxs)(P.a,{open:t,onClose:n,onExited:function(){return d("menu")},maxWidth:"sm",fullWidth:!0,onPointerMove:function(e){s.setMouse([e.clientX,e.clientY])},children:[Object(M.jsx)(N.a,{id:"simple-dialog-title",style:{fontSize:Object(E.w)()?"2.5em":"1em"},children:f}),Object(M.jsx)(w.a,{children:m})]})};zt.displayName="ShareDialog";var Gt=Object(Ke.a)({root:{display:"inline-block"}}),Kt=function(e){var t=Gt(),n=b(),r=Object(j.b)((function(){return n.tracks.localMains.size+n.tracks.localContents.size})),a=Object(D.d)().t;return Object(M.jsxs)("div",{className:t.root,children:[Object(M.jsx)(ze,{size:e.size,color:r?"secondary":"primary",title:K(a("ttCreateAndshare")),"aria-label":"share",onClick:function(){return e.setShowDialog(!0)},children:Object(M.jsx)(W.Icon,{icon:Ge.a,style:{width:e.iconSize,height:e.iconSize}})}),Object(M.jsx)(zt,Object(i.a)(Object(i.a)({},e),{},{open:e.showDialog,onClose:function(){return e.setShowDialog(!1)}}))]})};Kt.displayName="ShareButton";var Qt=n(236),qt=n.n(Qt),Wt=n(429),Yt=n.n(Wt),Xt=function(){var e=Object(j.b)((function(){return C.a.local.soundLocalizationBase})),t=Object(D.d)().t;return Object(M.jsx)(ke.a,{children:Object(M.jsxs)(Ee.a,{component:"label",container:!0,alignItems:"center",spacing:1,children:[Object(M.jsx)(Ee.a,{item:!0,children:t("slUser")}),Object(M.jsx)(Ee.a,{item:!0,children:Object(M.jsx)(Re.a,{checked:"avatar"===e,onChange:function(){C.a.local.soundLocalizationBase="avatar"===e?"user":"avatar",C.a.local.saveMediaSettingsToStorage()},name:"soundLoc"})}),Object(M.jsx)(Ee.a,{item:!0,children:t("slAvatar")})]})})};Xt.displayName="SoundLocalizationSetting";var Zt=function(e){var t=m(),n=Object(j.b)((function(){return t.local.useStereoAudio})),i=o.a.useState(null),a=Object(r.a)(i,2),s=a[0],c=a[1],u=Object(D.d)().t;return Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)(ze,{size:e.size,title:Object(M.jsxs)(M.Fragment,{children:[E.s?u("headphoneL1Chrome"):u("headphoneL1")," ",Object(M.jsx)("br",{}),u("headphoneL2")]}),onClick:function(){t.local.useStereoAudio=!n,t.local.saveMediaSettingsToStorage()},color:n?"secondary":"primary",onClickMore:n?function(e){c(e.currentTarget)}:void 0,children:n?Object(M.jsx)(qt.a,{style:{width:e.iconSize,height:e.iconSize}}):Object(M.jsx)(Yt.a,{style:{width:e.iconSize,height:e.iconSize}})}),Object(M.jsx)($.a,{open:Boolean(s),onClose:function(){return c(null)},anchorEl:s,anchorOrigin:{vertical:"top",horizontal:"left"},anchorReference:"anchorEl",children:Object(M.jsxs)("div",{style:{padding:20},children:[u("soundLocalizationBasedOn")," ",Object(M.jsx)("br",{}),Object(M.jsx)(Xt,{})]})})]})};Zt.displayName="StereoAudioSwtich";var $t=Object(ee.a)({container:{position:"absolute",width:"100%",bottom:0,padding:0,outline:"none",pointerEvents:"none"},wrapper:{width:"100%"},wrapperInner:{width:"100%",display:"flex",alignItems:"flex-end"}}),en=function e(){Object(k.a)(this,e),this.timeoutOut=void 0,this.touched=!1},tn=function(e){var t=o.a.useState(!0),n=Object(r.a)(t,2),s=n[0],c=n[1],u=o.a.useState(!1),l=Object(r.a)(u,2),d=l[0],h=l[1],p=o.a.useState(!1),f=Object(r.a)(p,2),m=f[0],v=f[1];function g(t){t?e.map.keyInputUsers.add("shareDialog"):e.map.keyInputUsers.delete("shareDialog"),v(t)}var b=Object(a.useRef)(new en).current,y=Object(a.useRef)(null),E=Object(a.useRef)(null),S=e.participants,O=Object(j.b)((function(){return{muteA:S.local.muteAudio,muteS:S.local.muteSpeaker,muteV:S.local.muteVideo,onStage:S.local.physics.onStage}})),_=o.a.useState([]),C=Object(r.a)(_,2),T=C[0],A=C[1],k=o.a.useState(null),R=Object(r.a)(k,2),I=R[0],P=R[1],w=o.a.useState(null),N=Object(r.a)(w,2),L=N[0],x=N[1],F=o.a.useState(null),U=Object(r.a)(F,2),V=U[0],B=U[1],J=Object(D.d)().t,H=$t();function z(){return e.map.screenSize[1]-(e.map.mouse[1]-e.map.offset[1])<90}var Q=Object(j.b)(z);function ee(e){var t;e?(c(!0),b.timeoutOut&&(clearTimeout(b.timeoutOut),b.timeoutOut=void 0),null===(t=y.current)||void 0===t||t.focus()):b.timeoutOut||(b.timeoutOut=setTimeout((function(){c(!1),b.timeoutOut=void 0}),500))}return Object(a.useEffect)((function(){z()&&(b.touched=!0),ee(Q||!b.touched)}),[Q,b.touched]),Object(a.useEffect)((function(){var t=function(t){0===e.map.keyInputUsers.size&&(t.ctrlKey||t.metaKey||t.altKey||("KeyM"===t.code&&(S.local.muteAudio=!S.local.muteAudio,ee(!0)),"KeyC"===t.code&&(ee(!0),g(!0),t.preventDefault(),t.stopPropagation()),"KeyL"!==t.code&&"Escape"!==t.code||(S.local.awayFromKeyboard=!0)))};return window.addEventListener("keydown",t),function(){window.removeEventListener("keydown",t)}}),[]),o.a.useMemo((function(){function t(e,t){var n=!1;return"audioinput"===e.kind?n=e.deviceId===S.local.devicePreference.audioInputDevice:"audiooutput"===e.kind?n=e.deviceId===S.local.devicePreference.audioOutputDevice:"videoinput"===e.kind&&(n=e.deviceId===S.local.devicePreference.videoInputDevice),Object(M.jsxs)(Z.a,{onClick:function(){t(e.deviceId)},children:[" ",(n?"\u2714\xa0":"\u2003")+e.label]},e.deviceId)}var n=[Object(M.jsx)(Z.a,{children:Object(M.jsx)(Ie,{})},"broadcast")],r=[],a=[];function o(e){e&&(S.local.devicePreference.audioInputDevice=e,S.local.saveMediaSettingsToStorage()),P(null)}function c(e){e&&(S.local.devicePreference.audioOutputDevice=e,S.local.saveMediaSettingsToStorage()),x(null)}function u(e){e&&(S.local.devicePreference.videoInputDevice=e,S.local.saveMediaSettingsToStorage()),B(null)}T.forEach((function(e){if("audioinput"===e.kind){var i=n.pop();n.push(t(e,o)),n.push(i)}"audiooutput"===e.kind&&r.push(t(e,c)),"videoinput"===e.kind&&a.push(t(e,u))}));var l=e.height,p=e.height?.7*e.height:36;function f(e){navigator.mediaDevices.enumerateDevices().then(A).catch((function(){console.log("Device enumeration error")}))}function v(){e.map.keyInputUsers.delete("adminForm"),h(!1)}return Object(M.jsx)("div",{ref:y,className:H.container,onClickCapture:function(){e.contents.setEditing("")},children:Object(M.jsxs)(Y.a,{in:s,classes:H,children:[Object(M.jsx)(Zt,{size:l,iconSize:p}),Object(M.jsx)(He,{size:l,color:O.muteS?"primary":"secondary","aria-label":"speaker",onClick:function(){S.local.muteSpeaker=!O.muteS,S.local.muteSpeaker&&(S.local.muteAudio=!0),S.local.saveMediaSettingsToStorage()},onClickMore:function(e){f(),x(e.currentTarget)},children:O.muteS?Object(M.jsx)(he.a,{style:{width:p,height:p}}):Object(M.jsx)(fe.a,{style:{width:p,height:p}})}),Object(M.jsx)(X.a,{anchorEl:L,keepMounted:!0,open:Boolean(L),onClose:function(){c("")},children:r}),Object(M.jsx)(ze,{size:l,color:O.muteA?"primary":"secondary","aria-label":"mic",title:K(J("ttMicMute")),onClick:function(){S.local.muteAudio=!O.muteA,S.local.muteAudio||(S.local.muteSpeaker=!1),S.local.saveMediaSettingsToStorage()},onClickMore:function(e){f(),P(e.currentTarget)},children:O.muteA?Object(M.jsx)(re.a,{style:{width:p,height:p}}):O.onStage?Object(M.jsx)(W.Icon,{icon:q.a,style:{width:p,height:p},color:"gold"}):Object(M.jsx)(ne.a,{style:{width:p,height:p}})}),Object(M.jsx)(X.a,{anchorEl:I,keepMounted:!0,open:Boolean(I),onClose:function(){o("")},children:n}),Object(M.jsx)(He,{size:l,color:O.muteV?"primary":"secondary","aria-label":"camera",onClick:function(){S.local.muteVideo=!O.muteV,S.local.saveMediaSettingsToStorage()},onClickMore:function(e){f(),B(e.currentTarget)},children:O.muteV?Object(M.jsx)(le.a,{style:{width:p,height:p}}):Object(M.jsx)(ce.a,{style:{width:p,height:p}})}),Object(M.jsx)(X.a,{anchorEl:V,keepMounted:!0,open:Boolean(V),onClose:function(){u("")},children:a}),Object(M.jsx)(Kt,Object(i.a)(Object(i.a)({},e),{},{size:l,iconSize:p,showDialog:m,setShowDialog:g})),Object(M.jsx)(G,{}),Object(M.jsx)(He,{size:l,onClick:function(){e.map.keyInputUsers.add("adminForm"),h(!0)},divRef:E,style:{marginLeft:"auto",marginRight:10,opacity:.1},children:Object(M.jsx)(oe.a,{style:{width:p,height:p}})}),Object(M.jsx)($.a,{open:d,onClose:v,anchorEl:E.current,anchorOrigin:{vertical:"top",horizontal:"left"},anchorReference:"anchorEl",children:Object(M.jsx)(Ae,{close:v})})]})})}),[O.muteA,O.muteS,O.muteV,O.onStage,s,d,m,I,L,V,T])};tn.displayName="Footer";var nn=n(146),rn=Object(ee.a)({back:{position:"absolute",width:"100%",height:"100%",top:0,left:0},fill:{position:"absolute",width:"100%",height:"100%",top:0,left:0}}),an=Object(ee.a)({resizerVertical:{background:"#000",zIndex:1,boxSizing:"border-box",backgroundClip:"padding-box",width:11,margin:"0 -10px 0 0",borderLeft:"1px solid gray",borderRight:"transparent 10px solid",cursor:"col-resize"},resizerHorizontal:{background:"gray",zIndex:1,boxSizing:"border-box",backgroundClip:"padding-box",height:10.5,margin:"-5px 0 -5px 0",borderTop:"5px transparent solid",borderBottom:"5px transparent solid",cursor:"row-resize"}}),on=Object(ee.a)({container:{width:"100%"},title:function(e){return{fontSize:.8*e.fontSize,justifyContent:"start",justifyItems:"start",alignItems:"center",userSelect:"none",userDrag:"none",whiteSpace:"nowrap",width:"100%"}},outer:{display:"flex",whiteSpace:"nowrap"},line:function(e){return{display:"flex",justifyContent:"start",justifyItems:"start",alignItems:"center",userSelect:"none",userDrag:"none",whiteSpace:"nowrap",fontSize:e.fontSize,height:e.height,width:"100%",margin:"1px 0 1px 0"}}}),sn=n(727);function cn(e){return{width:e.size,height:e.size,color:e.colors[1],backgroundColor:e.colors[0],pointerEvents:"none",userDrag:"none",fontSize:.3*e.size,display:"inline-block"}}var un=.92;function ln(e,t){var n={width:t.size*un,height:t.size*un,borderStyle:"solid",borderWidth:.04*t.size,borderColor:t.colors[0]};return Object.assign(e,n)}var dn=Object(ee.a)({imageAvatar:function(e){var t=cn(e);return Object.assign(t,{textAlign:"right",verticalAlign:"top"}),e.border&&ln(t,e),t},textAvatar:function(e){var t=cn(e);return e.border&&ln(t,e),t}}),hn=function(e){var t=dn(e);return Object(M.jsx)(j.a,{children:function(){var n="";e.avatarSrc||(e.name.split(" ").forEach((function(e){return n+=e?e.substring(0,1):""})),n=n.substring(0,2));var i=e.border?e.size*un:e.size;return e.avatarSrc?Object(M.jsx)(sn.a,{src:e.avatarSrc,className:t.imageAvatar}):Object(M.jsx)(sn.a,{className:t.textAvatar,children:Object(M.jsx)("div",{style:{height:i,width:i,textAlign:"center",verticalAlign:"middle",display:"table-cell",whiteSpace:"nowrap"},children:n})})}})};hn.displayName="RawImageAvatar";var pn=function(e){return o.a.useMemo((function(){return Object(M.jsx)(hn,Object(i.a)({},e))}),[e.avatarSrc,e.border,e.colors,e.name,e.size,e.style])};function fn(e){var t=new Date(e),n=new Date,i=n.getFullYear()!==t.getFullYear()?t.getFullYear():void 0,r=i||n.getMonth()!==t.getMonth()?t.getMonth()+1:void 0,a=i||r||n.getDate()!==t.getDate()?t.getDate():void 0,o="".concat(t.getHours(),":").concat(t.getMinutes(),":").concat(t.getSeconds());return"".concat(i?"".concat(i,"."):"").concat(r?"".concat(r,"."):"").concat(a?"".concat(a," "):"").concat(o)}pn.displayName="ImageAvatar";var mn=n(435),vn=n.n(mn),gn={text:"black",called:"red",callTo:"black",log:"black",private:"purple"},bn={text:"white",called:"red",callTo:"white",log:"white",private:"purple"},yn=function(e){var t="log"===e.message.type||"callTo"===e.message.type?.6:1,n=e.lineHeight*t,i=e.fontSize*t;return Object(M.jsx)(j.a,{children:function(){var t=fn(e.message.timestamp),r=Object(E.t)(ge.a.backgroundFill)?bn:gn,a=Object(E.t)(ge.a.backgroundFill)?"rgba(0, 0, 0, 0.3)":"rgba(255, 255, 255, 0.3)";return Object(M.jsx)(Ve.a,{title:"private"===e.message.type?Object(M.jsxs)(M.Fragment,{children:[Object(D.c)(e.message.pid===e.participants.localId?"cmPrivateTo":"cmPrivateFrom",{name:e.message.name}),Object(M.jsx)("br",{}),t]}):Object(M.jsxs)(M.Fragment,{children:[e.message.name,Object(M.jsx)("br",{}),t]}),placement:"right",children:Object(M.jsxs)("div",{style:{wordWrap:"break-word",marginTop:2,fontSize:i,backgroundColor:a},children:[Object(M.jsx)("span",{style:{marginRight:"0.3em"},onClick:function(){var t=e.participants.find(e.message.pid);t&&e.map.focusOn(t)},children:Object(M.jsx)(pn,{name:e.message.name,colors:e.message.colors,avatarSrc:e.message.avatarUrl,size:n,border:!0})}),Object(M.jsx)("span",{style:{color:r[e.message.type]},children:e.message.text})]})})}})};function En(e,t,n){var i={msg:e,ts:Date.now(),to:t};Mt.a.conference.sendMessage(ve.b.CHAT_MESSAGE,i,t);var r=n.participants.local;if(t){var a=n.participants.remote.get(t);a&&S.b.addMessage(new S.a(e,r.id,a.information.name,r.information.avatarSrc,r.getColor(),Date.now(),"private"))}else S.b.addMessage(new S.a(e,r.id,r.information.name,r.information.avatarSrc,r.getColor(),Date.now(),"text"))}var Sn=function(e){var t=on({height:e.lineHeight,fontSize:e.fontSize}),n=o.a.useState(""),a=Object(r.a)(n,2),s=a[0],c=a[1];return Object(M.jsxs)("div",{className:t.container,style:{height:"100%",display:"flex",flexDirection:"column-reverse",overflowY:"auto",overflowX:"clip",whiteSpace:"pre-line"},children:[Object(M.jsxs)("form",{noValidate:!0,autoComplete:"off",children:[Object(M.jsx)(Ve.a,{title:Object(D.c)("cmSend"),placement:"right",children:Object(M.jsx)("div",{style:{position:"relative",top:26,marginTop:-26,textAlign:"right",zIndex:1e3},children:Object(M.jsx)(Pe.a,{size:"small",onClick:function(){var t,n,i,r=e.chat.sendTo?null===(t=e.participants)||void 0===t||null===(n=t.find(e.chat.sendTo))||void 0===n||null===(i=n.information)||void 0===i?void 0:i.name:void 0;En(s,r?e.chat.sendTo:"",e),c("")},children:Object(M.jsx)(vn.a,{color:"primary"})})})}),Object(M.jsx)(j.a,{children:function(){var t,n,i,r=e.chat.sendTo?null===(t=e.participants)||void 0===t||null===(n=t.find(e.chat.sendTo))||void 0===n||null===(i=n.information)||void 0===i?void 0:i.name:void 0,a=Object(E.t)(ge.a.backgroundFill)?"white":"black";return Object(M.jsx)(U.a,{label:r?Object(D.c)("cmToName",{name:r}):Object(D.c)("cmToAll"),multiline:!0,value:s,style:{width:"100%",userSelect:"none"},size:e.lineHeight>20?"medium":"small",InputProps:{style:{color:a}},InputLabelProps:{style:{color:a}},onFocus:function(){e.map.keyInputUsers.add("chat")},onBlur:function(){e.map.keyInputUsers.delete("chat")},onKeyDown:function(t){"Escape"!==t.key&&"Esc"!==t.key||(e.chat.sendTo="")},onKeyPress:function(t){"\n"===t.key&&(En(s,r?e.chat.sendTo:"",e),c(""))},onChange:function(e){c(e.target.value)}})}})]}),Object(M.jsx)("div",{children:Object(M.jsx)(j.a,{children:function(){return Object(M.jsx)(M.Fragment,{children:e.chat.messages.map((function(t,n){return Object(M.jsx)(yn,Object(i.a)({message:t},e),n)}))})}})})]})};Sn.displayName="Chat";var On=n(73),_n=n(54),Cn=n(69),Tn=n(239),jn=n(240),An=n.n(jn),kn=n(241),Rn=n.n(kn),In=n(230),Pn=n.n(In),wn=n(246),Nn=n.n(wn),Dn=n(245),Mn=n.n(Dn),Ln=n(244),xn=n.n(Ln),Fn=n(243),Un=n.n(Fn),Vn=n(452),Bn=n.n(Vn),Jn=new function e(){Object(k.a)(this,e),this.useTransparent=!0},Hn=n(436),zn=n(439),Gn=n.n(zn),Kn=n(440),Qn=n.n(Kn),qn=n(290),Wn=n.n(qn),Yn=n(444),Xn=n.n(Yn),Zn=Object(ee.a)({iframe:{width:"100%",height:"100%",pointerEvents:"none"},iframeEdit:{width:"100%",height:"100%"},iframeVScrool:function(e){return{width:e.content.size[0]+13+10,height:100*e.content.size[0],pointerEvents:"none"}},divScroll:function(e){return{width:e.content.size[0]+100,height:"100%",position:"relative",left:-15,overflow:"scroll"}},divClip:{width:"100%",height:"100%",overflow:"hidden"},divError:{width:"100%",height:"100%",overflow:"hidden",backgroundColor:"white"}});function $n(e){var t=Object(Qe.o)(e.params);t!==e.props.content.url&&e.props.updateAndSend&&(e.props.content.url=t,e.props.updateAndSend(e.props.content))}var ei,ti,ni,ii,ri=function(e){Object(E.b)("gdrive"===e.content.type);var t=Object(a.useRef)(null),n=b(),i=Object(Qe.n)(e.content.url),r=i.get("id"),o=i.get("mimeType"),s=Object(a.useRef)({props:e,params:i,scrolling:!1}).current;s.props=e,s.params=i,!o&&r&&Object(Qe.m)(r).then((function(t){(t.name&&e.content.name!==t.name||t.mimeType)&&(s.params.set("mimeType",t.mimeType),t.name&&(e.content.name=t.name),$n(s))}));var c=Zn(e),u=Object(j.b)((function(){return e.contents.editing===e.content.id})),l=Object(Qe.l)(u,s.params);Object(a.useEffect)((function(){var e=Number(s.params.get("top"));if(!u&&!s.scrolling&&t.current&&!isNaN(e)&&e!==t.current.scrollTop){var n=t.current.onscroll;t.current.onscroll=function(){},t.current.scrollTop=e,t.current.onscroll=n}})),Object(a.useEffect)((function(){function i(){var e=Number(s.params.get("top"));t.current&&t.current.scrollTop!==e&&(s.params.set("top",t.current.scrollTop.toString()),$n(s))}if(t.current){var r=n.localParticipant.myContents.has(e.content.id),a=100,o=r?xt.a.throttle((function(){return setTimeout(i,a)}),a):xt.a.debounce(i,a),c=xt.a.debounce((function(){s.scrolling=!1}),a);t.current.onscroll=function(){s.scrolling=!0,o(),c()}}}),[n.localParticipant.myContents,e.content.id]);var d=Object(Qe.p)(o);return Object(M.jsx)("div",{className:o?c.divClip:c.divError,children:o?Object(M.jsx)("div",{className:u||!d?c.divClip:c.divScroll,ref:t,onWheel:function(e){return e.ctrlKey||e.stopPropagation()},children:Object(M.jsx)("iframe",{src:l,title:e.content.url,className:u?c.iframeEdit:d?c.iframeVScrool:c.iframe})}):u?Object(M.jsx)("div",{className:c.divClip,onWheel:function(e){return e.ctrlKey||e.stopPropagation()},children:Object(M.jsx)("iframe",{src:l,title:e.content.url,className:c.iframeEdit})}):Object(M.jsx)("div",{style:{margin:"1em",whiteSpace:"pre-wrap"},children:Object(D.c)("gdFailed")})})},ai=n(8),oi=n(441),si=n.n(oi),ci=n(442),ui=n.n(ci),li=n(212),di=n(252);di.GlobalWorkerOptions.workerSrc="https://cdn.jsdelivr.net/npm/pdfjs-dist@2.7.570/build/pdf.worker.js";var hi=(ei=function(){function e(){Object(k.a)(this,e),this.newProps=void 0,this.props=void 0,this.mainUrl=void 0,this.document=void 0,this.pages=[],this.renderTask=void 0,this.canvas=null,this.textDiv=null,this.annotationDiv=null,this.prevSize=[0,0],this.pageNum=0,Object(qe.a)(this,"numPages",ti,this),Object(qe.a)(this,"showTop",ni,this),Object(qe.a)(this,"pageText",ii,this),Object(Ze.g)(this)}return Object(ai.a)(e,[{key:"render",value:function(){var e=this,t=this.pages[this.pageNum];if(this.canvas&&t){var n=t.getViewport({scale:1}),i=this.props.content;if(i.originalSize[0]!==n.width||i.originalSize[1]!==n.height)return i.originalSize=[n.width,n.height],i.size=[i.size[0],i.size[0]*i.originalSize[1]/i.originalSize[0]],this.props.updateOnly(this.props.content),!1;var r=3*this.props.content.size[0]/n.width,a=t.getViewport({scale:r});this.canvas.width=a.width,this.canvas.height=a.height;var o=this.canvas.getContext("2d");return o&&(this.renderTask&&this.renderTask.cancel(),this.renderTask=t.render({canvasContext:o,viewport:a}),this.renderTask.promise.then((function(){t.getTextContent().then((function(t){if(e.textDiv){var n=e.textDiv.childNodes;Array.from(n.values()).forEach((function(e){return e.remove()}));var i=[];Object(di.renderTextLayer)({textContent:t,container:e.textDiv,viewport:a,textDivs:i}),i.forEach((function(e){e.style.position="absolute",e.style.color="transparent",e.style.whiteSpace="pre",e.style.transformOrigin="0% 0%",e.style.whiteSpace="nowrap",e.style.verticalAlign="top"}))}})),e.renderTask=void 0})).catch((function(e){}))),!0}return!1}},{key:"updateProps",value:function(){var e=this;if(this.newProps!==this.props){this.props=this.newProps;var t=new URL(this.props.content.url);this.mainUrl=t.hash?t.href.substring(0,t.href.length-t.hash.length):t.href;var n,i=this.pageNum;if("#page="===t.hash.substr(0,6))(i=null!==(n=Number(t.hash.substr(6))-1)&&void 0!==n?n:0)<0&&(i=0),this.numPages&&i>=this.numPages&&(i=this.numPages-1);this.document&&i===this.pageNum?this.prevSize[0]===this.props.content.size[0]&&this.prevSize[1]===this.props.content.size[1]||this.render()&&(this.prevSize=Array.from(this.props.content.size)):(this.getPage(i).then((function(){e.render()})),this.pageNum=i,this.pageText=String(i+1))}}},{key:"getDocument",value:function(){var e=this;return new Promise((function(t,n){e.document?t(e.document):Object(di.getDocument)({url:Object(li.a)(e.mainUrl),cMapUrl:"https://cdn.jsdelivr.net/npm/pdfjs-dist@2.7.570/cmaps/",cMapPacked:!0}).promise.then((function(n){e.document=n,e.numPages=n.numPages,t(e.document)})).catch((function(t){console.error("PDF: failed to load ".concat(e.mainUrl)),n(t)}))}))}},{key:"getPage",value:function(e){var t=this;return new Promise((function(n,i){t.pages[e]?n(t.pages[e]):t.getDocument().then((function(r){r.getPage(e+1).then((function(i){t.pages[e]=i,n(t.pages[e])})).catch((function(e){i(e)}))})).catch((function(e){i(e)}))}))}},{key:"updateUrl",value:function(e){void 0!==e&&Number.isFinite(e)||(e=this.pageNum),e<0&&(e=0),e>=this.numPages&&(e=this.numPages-1);var t="".concat(this.mainUrl,"#page=").concat(e+1);if(t!==this.props.content.url){var n=Object.assign({},this.props.content);n.url=t,this.props.updateAndSend(n)}}}]),e}(),ti=Object(We.a)(ei.prototype,"numPages",[Ze.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ni=Object(We.a)(ei.prototype,"showTop",[Ze.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ii=Object(We.a)(ei.prototype,"pageText",[Ze.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ei),pi={onMouseDown:function(e){e.stopPropagation()},onMouseUp:function(e){e.stopPropagation()},onPointerDown:function(e){e.stopPropagation()},onPointerUp:function(e){e.stopPropagation()}},fi=function(e){Object(E.b)("pdf"===e.content.type);var t=Object(a.useRef)(new hi).current;t.newProps=e;var n=Object(a.useRef)(null),r=Object(a.useRef)(null),o=Object(a.useRef)(null),s=Object(j.b)((function(){return e.contents.editing===e.content.id}));return Object(a.useEffect)((function(){t.canvas=n.current,t.textDiv=r.current,t.annotationDiv=o.current}),[n.current]),Object(a.useEffect)((function(){t.updateProps()})),Object(M.jsxs)("div",{style:{overflow:"hidden",pointerEvents:"auto",userSelect:s?"text":"none"},onDoubleClick:function(t){s||(t.stopPropagation(),t.preventDefault(),e.contents.setEditing(e.content.id))},children:[Object(M.jsx)("canvas",{style:{width:"".concat(300,"%"),height:"".concat(300,"%"),transformOrigin:"top left",transform:"scale(".concat(1/3,")")},ref:n}),Object(M.jsx)("div",{ref:r,style:{position:"absolute",left:0,top:0,width:"".concat(300,"%"),height:"".concat(300,"%"),transformOrigin:"top left",transform:"scale(".concat(1/3,")"),lineHeight:1,overflow:"hidden"}}),Object(M.jsx)("div",{ref:o}),Object(M.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:40},onPointerEnter:function(){t.showTop=!0},onPointerLeave:function(){t.showTop=!1},children:Object(M.jsx)(j.a,{children:function(){return Object(M.jsx)(Y.a,{in:t.showTop,style:{position:"absolute",top:0,left:0,width:"100%"},children:Object(M.jsxs)(Ee.a,{container:!0,alignItems:"center",children:[Object(M.jsx)(Ee.a,{item:!0,children:Object(M.jsx)(Pe.a,Object(i.a)(Object(i.a)({size:"small",color:t.pageNum>0?"primary":"default"},pi),{},{onClick:function(e){e.stopPropagation(),t.updateUrl(t.pageNum-1)},onDoubleClick:function(e){e.stopPropagation()},children:Object(M.jsx)(si.a,{})}))}),Object(M.jsx)(Ee.a,{item:!0,xs:1,children:Object(M.jsx)(U.a,Object(i.a)(Object(i.a)({value:t.pageText},pi),{},{inputProps:{min:0,style:{textAlign:"center"}},onChange:function(e){t.pageText=e.target.value},onBlur:function(e){var n=Number(t.pageText);n>0&&t.updateUrl(n-1)},onKeyPress:function(e){if("Enter"===e.key){var n=Number(t.pageText);n>0&&t.updateUrl(n-1)}}}))}),Object(M.jsxs)(Ee.a,{item:!0,style:{fontSize:15},children:["/ ",t.numPages]}),Object(M.jsx)(Ee.a,{item:!0,children:Object(M.jsx)(Pe.a,Object(i.a)(Object(i.a)({size:"small",color:t.pageNum<t.numPages-1?"primary":"default"},pi),{},{onClick:function(e){e.stopPropagation(),t.updateUrl(t.pageNum+1)},onDoubleClick:function(e){e.stopPropagation()},children:Object(M.jsx)(ui.a,{})}))})]})})}})})]})},mi=Object(ee.a)({video:{width:"100%",height:"100%"}}),vi=function(e){Object(E.b)("screen"===e.content.type||"camera"===e.content.type);var t=mi(),n=Object(a.useRef)(null),i=o.a.useState(!1),s=Object(r.a)(i,2),c=s[0],u=s[1],l=Object(a.useRef)({});l.current={locals:Object(j.b)((function(){return Array.from(T.b.tracks.localContents.get(e.content.id)||[])})),remotes:Object(j.b)((function(){return Array.from(T.b.tracks.remoteContents.get(e.content.id)||[])})),content:e.content},l.current.locals.length>2&&console.error("content ".concat(e.content.id," has ").concat(l.current.locals.length," local tracks"),l.current.locals),l.current.remotes.length>2&&console.error("content ".concat(e.content.id," has ").concat(l.current.remotes.length," remote tracks"),l.current.remotes);var d=[];function h(){if(l.current.locals.length&&n.current){var t=n.current.srcObject instanceof MediaStream&&n.current.srcObject.getTracks();if(t&&t.length){var i=t.find((function(e){return"video"===e.kind})),r=null===i||void 0===i?void 0:i.getSettings(),a=[(null===r||void 0===r?void 0:r.width)||0,(null===r||void 0===r?void 0:r.height)||0];if(a[0]&&l.current.content.originalSize.toString()!==a.toString()){if(l.current.content.originalSize[0]){var o=l.current.content.originalSize[0]/a[0],s=l.current.content.originalSize[1]/a[1];if(o===s&&d.find((function(e){return e===o})))return}var c=l.current.content.size[0]/(l.current.content.originalSize[0]?l.current.content.originalSize[0]:a[0]);l.current.content.originalSize=a,l.current.content.size=Object(E.z)(c,a),e.updateAndSend(l.current.content)}}}}return Object(a.useEffect)((function(){!function(){if(Object(E.b)(0===l.current.locals.length||0===l.current.remotes.length),n.current){var e=new MediaStream;l.current.locals.forEach((function(t){"audio"!==t.getType()&&e.addTrack(t.getTrack())})),l.current.remotes.forEach((function(t){if("audio"!==t.getType()){e.addTrack(t.getTrack());var n=xt.a.debounce((function(){u(!0)}),3e3);t.getTrack().onmute=n,t.getTrack().onunmute=function(){n.cancel(),u(!1)}}}));var t=n.current.srcObject instanceof MediaStream&&n.current.srcObject.getTracks(),i=e.getTracks();i.length&&(xt.a.isEqual(t,i)||(console.log("prev-next:",t,i),n.current.srcObject=e,n.current.autoplay=!0))}}()}),[l.current.locals,l.current.remotes]),Object(a.useEffect)((function(){var e=setInterval(h,333);return function(){return clearInterval(e)}})),Object(M.jsx)("video",{className:t.video,style:c?{filter:"brightness(80%) sepia(25%)"}:{},ref:n})},gi=function e(){Object(k.a)(this,e),this.messages=[],this.isStatic=!1,this.abortScroll=!1,this.editing=!1};function bi(e,t,n){var i={messages:e,scroll:[t.scrollLeft,t.scrollTop]},r=JSON.stringify(i);n.content.url!==r&&n.updateAndSend&&(n.content.url=r,n.updateAndSend(n.content))}function yi(e,t){t.text.message=e;var n=t.member.messages.filter((function(e){return e.message.length}));t.div&&bi(n,t.div,t)}var Ei=function(e){var t=o.a.useState(e.text.message),n=Object(r.a)(t,2),s=n[0],c=n[1],u=Object(a.useRef)(void 0);Object(a.useEffect)((function(){u.current=xt.a.throttle(yi,1e3,{leading:!1})}),[]);var l=u.current;return Object(M.jsx)(j.a,{children:function(){return Object(M.jsxs)("div",{style:Object(i.a)(Object(i.a)({},e.css),{},{position:"relative",margin:0,border:0,padding:0,backgroundColor:"none"}),children:[Object(M.jsx)("div",{style:Object(i.a)(Object(i.a)({},e.css),{},{color:"red",position:"relative",width:"100%",overflow:"hidden",visibility:"hidden"}),children:s+"\u200b"}),Object(M.jsx)("textarea",{value:s,autoFocus:e.autoFocus,style:Object(i.a)(Object(i.a)({},e.css),{},{font:"inherit",verticalAlign:"baseline",resize:"none",position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",letterSpacing:"inherit",overflow:"hidden"}),onChange:function(t){c(t.currentTarget.value),l&&l(t.currentTarget.value,e)},onBlur:function(){l&&l.cancel(),yi(s,e)},onKeyDown:function(t){"Escape"!==t.key&&"Esc"!==t.key||(t.stopPropagation(),t.preventDefault(),l&&l.cancel(),yi(s,e),e.contents.setEditing(""))}})]})}})},Si=function(e){var t,n,r=fn(e.text.time),a=(null===(t=e.text.color)||void 0===t?void 0:t.length)?e.text.color:Object(E.p)(e.text.name),s=(null===(n=e.text.textColor)||void 0===n?void 0:n.length)?e.text.textColor:Object(E.m)(a),c={color:Object(E.F)(s,1),backgroundColor:Jn.useTransparent?Object(E.F)(a,.5):Object(E.F)(a,1),padding:"0.1em",fontSize:16,lineHeight:1.2,width:"100%",overflow:"clip",boxSizing:"border-box",whiteSpace:"pre-wrap",wordWrap:"break-word",overflowWrap:"break-word"},u=Object(On.a)(c,["backgroundColor"]);return u.backgroundColor=Object(E.F)(a,1),Object(M.jsx)(Ve.a,{title:Object(M.jsxs)(o.a.Fragment,{children:[e.text.name," ",Object(M.jsx)("br",{})," ",r]}),placement:"left",arrow:!0,suppressContentEditableWarning:!0,children:Object(M.jsx)("div",{children:e.textEditing?Object(M.jsx)(Ei,Object(i.a)(Object(i.a)({},e),{},{css:u})):Object(M.jsx)("div",{style:c,onPointerDown:function(){e.member.isStatic=!0},onPointerMove:function(){e.member.isStatic=!1},onPointerUp:function(t){if(e.member.isStatic){var n=t.target;if(n instanceof Node){t.preventDefault();var i=window.getSelection();if(i)if(i.rangeCount&&i.getRangeAt(0).toString())i.removeAllRanges();else{var r=document.createRange();r.selectNode(n),i.removeAllRanges(),i.addRange(r)}}}},children:e.textToShow})})})};function Oi(e,t){var n="",i="",r="";return t[1]?(r=n=t[1],i="_blank"):t[2]?(n=t[2],r=t[6]?t[6]:t[2],i=t[3]?"_self":"_blank"):(r=t[7],n=t[11],i=t[9]||t[10]?"_self":"_blank"),Object(E.v)(new URL(n))&&(i="_self"),Object(M.jsx)("a",{href:n,target:i,rel:"noreferrer",children:r},e)}var _i={height:"100%",width:"100%",whiteSpace:"pre-line",pointerEvents:"auto",overflowY:"auto",overflowX:"visible",wordWrap:"break-word"},Ci=Object(ee.a)({text:_i,textEdit:Object(i.a)(Object(i.a)({},_i),{},{cursor:"default",userSelect:"text"})}),Ti=function(e){Object(E.b)("text"===e.content.type);var t=o.a.useRef(new gi).current,n=Ci(),r=Object(a.useRef)(null),s=e.content.url,c=JSON.parse(s),u=Object(j.b)((function(){return e.contents.editing===e.content.id}));u&&e.contents.setBeforeChangeEditing((function(n,i){n===e.content.id&&""===i&&(r.current&&(t.messages=t.messages.filter((function(e){return e.message.length})),bi(t.messages,r.current,e)),e.contents.setBeforeChangeEditing())})),Object(a.useEffect)((function(){var e;!u&&r.current&&(r.current.scrollLeft===c.scroll[0]&&r.current.scrollTop===c.scroll[1]||(t.abortScroll=!0,null===(e=r.current)||void 0===e||e.scroll(c.scroll[0],c.scroll[1])))}),[c.scroll[0],c.scroll[1],u]);var l=new Set;c.messages.forEach((function(n){var i=t.messages.findIndex((function(e){return e.pid===n.pid&&e.time===n.time}));-1===i?(l.add(t.messages.length),t.messages.push(n)):n.pid!==e.participants.localId&&(l.add(i),t.messages[i]=n)})),t.messages=t.messages.filter((function(t,n){return t.pid===e.participants.localId||l.has(n)})),t.messages.sort(_n.e);var d=void 0;if(u){var h=t.messages.pop();h&&t.messages.push(h),(null===h||void 0===h?void 0:h.pid)!==e.participants.localId&&t.messages.push({message:"",pid:e.participants.localId,name:e.participants.local.information.name,color:e.participants.local.information.color,textColor:e.participants.local.information.textColor,time:Date.now()}),t.editing||(t.messages.reverse(),d=t.messages.find((function(t){return t.pid===e.participants.localId})),t.messages.reverse())}var p=t.messages.map((function(n,o){var s=u&&(n.pid===e.participants.localId||!e.participants.remote.has(n.pid)),c=[];if(!s){for(var l,h="https?:\\/\\/[-_.!~*'()a-zA-Z0-9;/?:@&=+$,%#]+",p=new RegExp("(".concat(h,")|")+"\\[(".concat(h,")(( *>)|( +move))?\\s*(\\S+)\\]")+"|\\[(\\S+)((\\s*>)|(\\s+move)|\\s)\\s*(".concat(h,")\\]")),f=0;null!==(l=p.exec(n.message.slice(f)));){var m=n.message.slice(f,f+l.index);m&&c.push(Object(M.jsx)("span",{children:m},f)),c.push(Oi(f+m.length,l)),f+=m.length+l[0].length}c.push(Object(M.jsx)("span",{children:n.message.slice(f)},f))}return Object(a.createElement)(Si,Object(i.a)(Object(i.a)({},e),{},{key:o,text:n,div:r.current,textToShow:c,member:t,textEditing:s,autoFocus:n===d}))})),f=xt.a.debounce((function(n){r.current&&(t.abortScroll?t.abortScroll=!1:bi(t.messages,r.current,e))}),200);return t.editing=u,Object(M.jsx)("div",{ref:r,className:u?n.textEdit:n.text,onWheel:function(e){return e.ctrlKey||e.stopPropagation()},onScroll:function(e){u||f(e)},children:p})},ji=n(15),Ai=n(56),ki=n(92);function Ri(e,t){var n=e;n.setSinkId&&n.setSinkId(t).then((function(){})).catch((function(){console.warn("audio.setSinkId:",t," failed")}))}var Ii,Pi,wi,Ni,Di,Mi,Li,xi,Fi,Ui=1e5,Vi=function(){function e(t,n,i,r){Object(k.a)(this,e),this.sourceNode=void 0,this.audioElement=void 0,this.gainNode=void 0,this.pannerNode=void 0,this.destination=void 0,this.context=void 0,this.playMode=void 0,this.audioDeviceId="",this.distance=1,this.interval=void 0,this._defaultPannerRefDistance=Ai.a,this.audibility=!1,this.context=t,this.destination=n,this.gainNode=this.createGainNode(t),this.pannerNode=this.createPannerNode(t),this.gainNode.connect(this.pannerNode),this.pannerNode.connect(this.destination),this.playMode=i,this.updateAudibility(r)}return Object(ai.a)(e,[{key:"setPlayMode",value:function(e){var t=this;switch(this.playMode=e,e){case"Pause":var n;null===(n=this.sourceNode)||void 0===n||n.disconnect(),this.interval&&(clearInterval(this.interval),this.interval=void 0),this.audioElement&&this.audioElement.pause();break;case"Context":var i;null===(i=this.sourceNode)||void 0===i||i.connect(this.gainNode),this.interval&&(clearInterval(this.interval),this.interval=void 0),this.audioElement&&this.audioElement.pause();break;case"Element":var r;null===(r=this.sourceNode)||void 0===r||r.disconnect(),this.audioElement||(this.audioElement=this.createAudioElement()),this.audioElement.muted=!1,this.interval||(this.interval=setInterval((function(){var e;O.a.type||(null===t||void 0===t||null===(e=t.audioElement)||void 0===e||e.play().then((function(){t.interval&&(clearInterval(t.interval),t.interval=void 0)})).catch((function(e){})))}),500));break;default:console.error("Unknown output: ".concat(e))}this.updateAudibility(this.audibility),this.updateVolume()}},{key:"setAudioOutput",value:function(e){this.audioDeviceId!==e&&(this.audioDeviceId=e,this.audioElement&&Ri(this.audioElement,this.audioDeviceId))}},{key:"updateStream",value:function(e){this.updateSourceStream(e),this.setPlayMode(this.playMode)}},{key:"updatePose",value:function(e){var t,n,i=e,r=Object(ki.i)(e.position),a=(r*r/(this.pannerNode.refDistance*this.pannerNode.refDistance)+this.pannerNode.refDistance-1)/(r||1);(this.distance=a*r,this.pannerNode.positionX&&this.pannerNode.orientationX)?(this.pannerNode.positionX.setValueAtTime(a*e.position[0],this.context.currentTime),this.pannerNode.positionY.setValueAtTime(a*e.position[1],this.context.currentTime),this.pannerNode.positionZ.setValueAtTime(a*e.position[2],this.context.currentTime),this.pannerNode.orientationX.setValueAtTime(e.orientation[0],this.context.currentTime),this.pannerNode.orientationY.setValueAtTime(e.orientation[1],this.context.currentTime),this.pannerNode.orientationZ.setValueAtTime(e.orientation[2],this.context.currentTime)):((t=this.pannerNode).setPosition.apply(t,Object(Cn.a)(Object(ki.h)(a,e.position))),(n=this.pannerNode).setOrientation.apply(n,Object(Cn.a)(e.orientation)));this.updateVolumeWithAssets(i)}},{key:"getContentsStatus",value:function(e,t){var n=0,i=T.b.all.length,r=e,a=t;e=-1*(e+30),t-=30;for(var o=0;o<i;o++){T.b.all[o].pose.position[0]+T.b.all[o].size[0]+100,T.b.all[o].pose.position[1]+T.b.all[o].size[1]+100,T.b.all[o].pose.position[0]-200,T.b.all[o].pose.position[1]-200,T.b.all[o].pose.position[0]+T.b.all[o].size[0]-50,T.b.all[o].pose.position[1]+T.b.all[o].size[1]-60;var s=Object(E.d)(T.b.all[o].pose),c=-1*(r+30),u=a-30,l=s.position[0],d=-1*s.position[2],h=(s.position[0],s.position[2],s.position[0]+T.b.all[o].size[0]-60),p=-1*s.position[2]+T.b.all[o].size[1]-60;s.position[0],T.b.all[o].size[0],s.position[2],T.b.all[o].size[1],s.position[0],T.b.all[o].size[0],s.position[2],T.b.all[o].size[1];if(c>=l-100&&c<=h+100&&u>=d-100&&u<=p+100)if(c>=l&&c<=h&&u>=d&&u<=p){if(!0===T.b.all[o].proximity){n=1;break}}else if(!0===T.b.all[o].proximity){n=2;break}}return n}},{key:"updateVolumeWithAssets",value:function(e){var t=0,n=0,i=0,r=0;"Element"===this.playMode&&(i=e.position[0],r=e.position[2],1===(n=this.getContentsStatus(i,r))?this.distance=90:2===n&&(this.distance=150),t=Math.pow(Math.max(this.distance,this.pannerNode.refDistance)/this.pannerNode.refDistance,-this.pannerNode.rolloffFactor)),this.audioElement&&(this.audioElement.volume=t)}},{key:"updateVolume",value:function(){var e=0;"Element"===this.playMode&&(e=Math.pow(Math.max(this.distance,this.pannerNode.refDistance)/this.pannerNode.refDistance,-this.pannerNode.rolloffFactor)),this.audioElement&&(this.audioElement.volume=e)}},{key:"defaultPannerRefDistance",get:function(){return this._defaultPannerRefDistance},set:function(e){this._defaultPannerRefDistance=e,this.pannerNode.refDistance!==Ui&&(this.pannerNode.refDistance=this._defaultPannerRefDistance)}},{key:"updateBroadcast",value:function(e){this.pannerNode.refDistance=e?Ui:this.defaultPannerRefDistance}},{key:"updatePannerConfig",value:function(e){var t=this;["coneInnerAngle","coneOuterAngle","coneOuterGain","distanceModel","maxDistance","distanceModel","panningModel","refDistance","rolloffFactor"].forEach((function(n){"refDistance"===n?t.defaultPannerRefDistance=e.refDistance:t.pannerNode[n]=e[n]}))}},{key:"updateAudibility",value:function(e){e?this.gainNode.connect(this.pannerNode):this.gainNode.disconnect(),this.audioElement&&(this.audioElement.muted=!e),this.audibility=e}},{key:"disconnect",value:function(){this.sourceNode&&this.sourceNode.disconnect(),this.gainNode.disconnect(),this.pannerNode.disconnect(),this.audioElement&&(this.audioElement.volume=0,this.audioElement.pause(),this.audioElement.remove())}},{key:"isBroadcast",get:function(){return this.pannerNode.refDistance===Ui}},{key:"createGainNode",value:function(e){var t=e.createGain();return t.gain.value=1,t}},{key:"createPannerNode",value:function(e){return e.createPanner()}},{key:"updateSourceStream",value:function(e){this.sourceNode&&this.sourceNode.disconnect(),void 0!==e?(this.sourceNode=this.context.createMediaStreamSource(e),void 0===this.audioElement&&(this.audioElement=this.createAudioElement()),this.audioElement.srcObject=e):this.sourceNode=void 0}},{key:"createAudioElement",value:function(){var e=new Audio;return Ri(e,this.audioDeviceId),e}}]),e}(),Bi=12*Ai.a,Ji=new(Ii=function(){function e(){Object(k.a)(this,e),Object(qe.a)(this,"coneInnerAngle",Pi,this),Object(qe.a)(this,"coneOuterAngle",wi,this),Object(qe.a)(this,"coneOuterGain",Ni,this),Object(qe.a)(this,"maxDistance",Di,this),Object(qe.a)(this,"panningModel",Mi,this),Object(qe.a)(this,"distanceModel",Li,this),Object(qe.a)(this,"refDistance",xi,this),Object(qe.a)(this,"rolloffFactor",Fi,this),this.refDistanceNormal=this.refDistance,Object(Ze.g)(this)}return Object(ai.a)(e,[{key:"hearableRange",get:function(){return 100*this.refDistance/Bi}},{key:"setHearableRange",value:function(e){this.refDistanceNormal=e/100*Bi;var t=C.a.local.physics.onStage;this.setBroadcast(t)}},{key:"setBroadcast",value:function(e){this.refDistance=e?99999:this.refDistanceNormal}},{key:"updateParameters",value:function(e){Object.assign(this,e)}}]),e}(),Pi=Object(We.a)(Ii.prototype,"coneInnerAngle",[Ze.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),wi=Object(We.a)(Ii.prototype,"coneOuterAngle",[Ze.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 180}}),Ni=Object(We.a)(Ii.prototype,"coneOuterGain",[Ze.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Di=Object(We.a)(Ii.prototype,"maxDistance",[Ze.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e4}}),Mi=Object(We.a)(Ii.prototype,"panningModel",[Ze.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"HRTF"}}),Li=Object(We.a)(Ii.prototype,"distanceModel",[Ze.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"exponential"}}),xi=Object(We.a)(Ii.prototype,"refDistance",[Ze.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5*Ai.a}}),Fi=Object(We.a)(Ii.prototype,"rolloffFactor",[Ze.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 38}}),Object(We.a)(Ii.prototype,"hearableRange",[Ze.d],Object.getOwnPropertyDescriptor(Ii.prototype,"hearableRange"),Ii.prototype),Object(We.a)(Ii.prototype,"setHearableRange",[Ze.b],Object.getOwnPropertyDescriptor(Ii.prototype,"setHearableRange"),Ii.prototype),Object(We.a)(Ii.prototype,"setBroadcast",[Ze.b],Object.getOwnPropertyDescriptor(Ii.prototype,"setBroadcast"),Ii.prototype),Object(We.a)(Ii.prototype,"updateParameters",[Ze.b],Object.getOwnPropertyDescriptor(Ii.prototype,"updateParameters"),Ii.prototype),Ii),Hi=Ji;Object(Ze.c)((function(){var e=C.a.local.physics.onStage;Ji.setBroadcast(e)}));var zi=n(443),Gi=n.n(zi),Ki=.1;function Qi(){return.001*Date.now()}var qi=Object(ee.a)({iframe:{width:"100%",height:"100%"}}),Wi=function e(){Object(k.a)(this,e),this.player=void 0,this.goal="",this.skipOnPlaying=0,this.pauseIntervalTimer=0,this.lastCurrentTimePaused=0,this.playTimeout=0,this.pauseTimeout=0,this.params=new Map,this.editing=!1,this.prevRelPos=[0,0],this.volumeUI=.5,this.volumeDist=0,this.prevVolumeDist=0,this.volumeIntervalTimer=0,this.props=void 0};function Yi(e){return function(e){return new Map(e.map((function(e){return e.split("=")})))}(e.split("&"))}function Xi(e){e.playTimeout&&(clearTimeout(e.playTimeout),e.playTimeout=0),e.pauseTimeout&&(clearTimeout(e.pauseTimeout),e.pauseTimeout=0)}function Zi(e,t,n){Object(E.b)(n.player),n.goal="playing",Xi(n);var i=(Qi()-e)*n.player.getPlaybackRate();if("playing"!==n.player.getState()||0!==n.player.getPlaylist().length&&n.player.getPlaylistIndex()!==t||!(Math.abs(n.player.getCurrentTime()-i)<Ki)){var r=-1e3;!function a(){if(n.player){var o=n.player.getCurrentTime();if("paused"===n.player.getState()&&Math.abs(r-o)<Ki)return n.player.play(),void Object(T.a)("ytSeekAndPlay: ".concat(n.player.getState(),"  ")+"cur:".concat(n.player.getCurrentTime(),"  toSeek:").concat(i),n.params);var s=Qi();i=(s-e)*n.player.getPlaybackRate();r=i+1*n.player.getPlaybackRate();var c=n.player.getDuration();"unstarted"!==n.player.getState()&&c||(n.skipOnPlaying=1,n.player.play(),c=n.player.getDuration()),t>=0&&t!==n.player.getPlaylistIndex()&&(n.skipOnPlaying=1,n.player.playVideoAt(t),c=n.player.getDuration()),c&&(n.player.pause(),r>c&&(e=s+1-(r%=c)/n.player.getPlaybackRate()),n.player.seek(r)),n.playTimeout=setTimeout(a,1e3)}}()}}function $i(e,t){Object(E.b)(t.player),t.goal="paused",Xi(t);!function n(){if(t.player){var i=t.params.get("index"),r=Number(i||-1);if("paused"!==t.player.getState()||r>=0&&r!==t.player.getPlaylistIndex())return"unstarted"===t.player.getState()&&t.player.play(),r>=0&&r!==t.player.getPlaylistIndex()&&t.player.playVideoAt(r),t.player.pause(),void(t.pauseTimeout=setTimeout(n,333));t.player.getCurrentTime()!==e&&(t.player.seek(e),Object(T.a)("ytSeekAndPause seek to ".concat(e),t.params)),t.lastCurrentTimePaused=t.player.getCurrentTime()}}()}function er(e,t,n){var i,r,a;(a=n.params).delete("playing"),a.delete("paused"),a.delete("ended"),n.params.set(e,String(t)),n.params.set("rate",String(null===(i=n.player)||void 0===i?void 0:i.getPlaybackRate()));var o=null===(r=n.player)||void 0===r?void 0:r.getPlaylistIndex();n.params.set("index",String(o||-1)),n.props.content.url=function(e){var t,n="",i="",r=Object(ji.a)(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n+="".concat(i).concat(a[0],"=").concat(a[1]),i="&"}}catch(o){r.e(o)}finally{r.f()}return n}(n.params),n.props.updateAndSend(n.props.content),Object(T.a)("YT SEND state ".concat(e," t=").concat(t),n.params)}function tr(e){if(e.player){var t=e.player.getState();if(e.editing||""!==e.goal||"paused"!==t)e.pauseIntervalTimer&&(clearInterval(e.pauseIntervalTimer),e.pauseIntervalTimer=0);else{var n=e.player.getCurrentTime();if(Object(T.a)("YT ytPauseInterval cur:".concat(n,", last:").concat(e.lastCurrentTimePaused," param").concat(e.params.get("paused"))),Math.abs(n-e.lastCurrentTimePaused)>Ki)e.lastCurrentTimePaused=n,n!==Number(e.params.get("paused"))&&er("paused",n,e)}}}function nr(e,t){t.player&&(t.volumeDist=function(e){var t=(e*e/(Ji.refDistance*Ji.refDistance)+Ji.refDistance-1)/(e||1)*e;return Math.pow(Math.max(t,Ji.refDistance)/Ji.refDistance,-Ji.rolloffFactor)}(e),t.player.setVolume(t.volumeUI*t.volumeDist*100))}function ir(e){if(e.props.participants){!function(e){if(e.player){if(1===e.volumeDist&&1===e.prevVolumeDist){var t=e.player.getVolume()/100;t!==e.volumeUI&&(e.volumeUI=t)}else e.player.setVolume(e.volumeUI*e.volumeDist*100);e.prevVolumeDist=e.volumeDist}}(e);var t=Object(E.M)(e.props.content.pose.position,e.props.participants.local.pose.position),n=Object(E.M)(t,e.prevRelPos);if(Object(E.A)(n)>.1*Ai.a){e.prevRelPos=[t[0],t[1]];for(var i=0;i<2;i++)t[i]<0&&(t[i]+=e.props.content.size[i],t[i]>0&&(t[i]=0));nr(Object(E.A)(t),e)}}}var rr=function(e){Object(E.b)("youtube"===e.content.type);var t=qi(),n=Object(a.useRef)(new Wi).current;n.props=e;var i=Object(j.b)((function(){return e.contents.editing===e.content.id})),r=n.params;if(n.params=Yi(e.content.url),!i&&(n.editing||!Object(E.J)(n.params,r))&&n.player){n.params.get("rate")!==r.get("rate")&&n.player.setPlaybackRate(Number(n.params.get("rate")));var o=n.params.get("playing"),s=void 0!==o&&o!==r.get("playing"),c=n.params.get("paused"),u=void 0!==c&&c!==r.get("paused");s?(Object(T.a)("YT render move to play=".concat(o," state")),Zi(Number(n.params.get("playing")),Number(n.params.get("index")),n)):u&&(Object(T.a)("YT render move to pause=".concat(c," state")),$i(Number(n.params.get("paused")),n))}return n.editing=i,Object(a.useEffect)((function(){Object(E.b)(e.content.id);var t=!1;if(!n.player){var i="#YT".concat(e.content.id),r=new Gi.a(i);n.params.has("playing")||n.params.has("paused")||n.params.has("ended")||(t=!0,n.params.set("playing",String(-1)),r.play()),n.player=r,Object(T.a)("YTPlayer for ".concat(i," created")),n.params.has("rate")&&r.setPlaybackRate(Number(n.params.get("rate"))),n.editing||(n.params.has("paused")?$i(Number(n.params.get("paused")),n):!t&&n.params.has("playing")&&Zi(Number(n.params.get("playing")),Number(n.params.get("index")),n)),r.on("error",(function(e){return Object(T.a)("YT on error ",e)})),r.on("buffering",(function(){return Object(T.a)("YT on buffering")})),r.on("cued",(function(){return Object(T.a)("YT on cued")})),r.on("unstarted",(function(){Object(T.a)("YT on unstarted"),r.unMute()})),r.on("ended",(function(){(Object(T.a)("YT on ended"),n.player)&&Zi(Qi(),0,n)})),r.on("paused",(function(){Object(T.a)("YT on paused at ".concat(r.getCurrentTime()," goal:").concat(n.goal),n.params),"paused"===n.goal?n.goal="":""===n.goal?n.params.has("paused")||setTimeout((function(){n.params.has("paused")||n.params.has("playing")||"paused"!==r.getState()||er("paused",r.getCurrentTime(),n)}),1e3):Object(T.a)("paused for goal ".concat(n.goal)),""!==n.goal||n.pauseIntervalTimer||(n.pauseIntervalTimer=setInterval(tr,333,n))})),r.on("playing",(function(){Object(T.a)("YT on playing goal=".concat(n.goal," skip=").concat(n.skipOnPlaying),n.params);var e=!1;if(r.getPlaylist().length>0&&r.getPlaylistIndex()!==Number(n.params.get("index"))&&(n.params.set("index",String(r.getPlaylistIndex())),e=!0),"playing"===n.goal)n.skipOnPlaying?n.skipOnPlaying=0:n.goal="";else if(""===n.goal){var t=Qi()-r.getCurrentTime()/r.getPlaybackRate(),i=Number(n.params.get("playing"));-1===i&&(i=t);var a=t-i;(!n.params.has("playing")||e||Math.abs(a)>Ki)&&er("playing",t,n)}})),r.on("playbackRateChange",(function(){Object(T.a)("YT on playbackRateChange");var e=Qi()-r.getCurrentTime()/r.getPlaybackRate(),t=r.getState();er("paused"===t?"paused":"playing"===t?"playing":"ended",e,n)}))}var a=n.player;return a&&(n.params.has("list")?(a.loadList({listType:"playlist",list:n.params.get("list")}),Object(T.a)("YT loadList: ".concat(n.params.get("list")))):n.params.has("v")&&(a.load(n.params.get("v")),Object(T.a)("YT load: ".concat(n.params.get("v"))))),n.volumeIntervalTimer||(n.volumeIntervalTimer=setInterval(ir,200,n)),function(){n.player&&n.player.destroy(),n.player=void 0,n.volumeIntervalTimer&&clearInterval(n.volumeIntervalTimer)}}),[]),Object(M.jsx)("div",{id:"YT".concat(e.content.id),className:t.iframe})};function ar(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;n<0&&(n=t);var i={img:Object(M.jsx)(Wn.a,{style:{fontSize:t,width:n}}),zoneimg:Object(M.jsx)(Wn.a,{style:{fontSize:t,width:n}}),text:Object(M.jsx)(Nt.a,{style:{fontSize:t,width:n}}),iframe:Object(M.jsx)(_t.a,{style:{fontSize:t,width:n}}),youtube:Object(M.jsx)(Xn.a,{style:{fontSize:t,width:n}}),screen:Object(M.jsx)(Rt.a,{style:{fontSize:t,width:n}}),gdrive:Object(M.jsx)("span",{style:{width:n,height:t},children:Object(M.jsx)(W.Icon,{icon:Qn.a,height:t})}),whiteboard:Object(M.jsx)("span",{style:{width:n,height:t},children:Object(M.jsx)(W.Icon,{icon:st.a,height:t})}),camera:Object(M.jsx)(mt.a,{style:{fontSize:t,width:n}}),pdf:Object(M.jsx)("span",{style:{width:n,height:t},children:Object(M.jsx)(W.Icon,{icon:Gn.a,height:t})}),"":void 0};return i[e]}function or(e,t){var n=t?t.type:"";return"whiteboard"===n?e?Object(D.c)("ctEndEditWhiteboard"):Object(D.c)("ctEditWhiteboard"):"gdrive"===n?e?Object(D.c)("ctEndEditGDrive"):Object(D.c)("ctEditGDrive"):"youtube"===n?e?Object(D.c)("ctEndEditYoutube"):Object(D.c)("ctEditYoutube"):"iframe"===n?e?Object(D.c)("ctEndEditIframe"):Object(D.c)("ctEditIframe"):"text"===n?e?Object(D.c)("ctEndEditText"):Object(D.c)("ctEditText"):""}var sr=Object(ee.a)({img:{width:"100%",height:"100%",verticalAlign:"bottom",userDrag:"none",pointerEvents:"none"},iframe:{width:"100%",height:"100%",pointerEvents:"none",border:"none"},iframeEdit:{width:"100%",height:"100%",border:"none"},div:{width:"100%",height:"100%"}}),cr=function(e){var t=sr(),n=Object(j.b)((function(){return e.contents.editing===e.content.id}));return"img"===e.content.type?Object(M.jsx)("img",{className:t.img,src:e.content.url,alt:e.content.name}):"iframe"===e.content.type||"whiteboard"===e.content.type?Object(M.jsx)("div",{className:t.div,children:Object(M.jsx)("iframe",{className:n?t.iframeEdit:t.iframe,style:"whiteboard"===e.content.type?{backgroundColor:"white"}:{},src:e.content.url,title:e.content.name},e.content.name)}):"youtube"===e.content.type?Object(M.jsx)(rr,Object(i.a)({},e)):"gdrive"===e.content.type?Object(M.jsx)(ri,Object(i.a)({},e)):"pdf"===e.content.type?Object(M.jsx)(fi,Object(i.a)({},e)):"text"===e.content.type?Object(M.jsx)(Ti,Object(i.a)({},e)):"screen"===e.content.type||"camera"===e.content.type?Object(M.jsx)(vi,Object(i.a)({},e)):Object(M.jsxs)("div",{children:["Unknown type:",e.content.type," for ",e.content.url]})},ur=function(e){return o.a.useMemo((function(){return Object(M.jsx)(cr,Object(i.a)({},e))}),[e.content.url,e.content.id,e.content.type,e.contents.editing===e.content.id,e.content.pose,e.content.size,e.content.originalSize])};ur.displayName="Content";var lr=n(445),dr=n(446),hr=n(447),pr=n.n(hr),fr=n(448),mr=n.n(fr),vr=n(449),gr=n.n(vr),br=n(450),yr=n.n(br),Er=n(717),Sr=n(718),Or=n(716),_r=n(715),Cr=n(451),Tr=n.n(Cr);function jr(e,t,n,i,r,a){var o={margin:0,padding:2,border:"none"};return Object(M.jsxs)(_r.a,{children:[Object(M.jsx)(Or.a,{align:"right",style:o,children:e}),Object(M.jsx)(Or.a,{align:"right",style:o,children:t}),Object(M.jsx)(Or.a,{align:"center",style:o,children:n}),Object(M.jsx)(Or.a,{style:o,children:i}),Object(M.jsx)(Or.a,{style:o,children:r})]},a)}var Ar=function(){function e(t){Object(k.a)(this,e),this.zorder=void 0,this.pinned=void 0,this.editing=void 0,this.name=void 0,this.pose=void 0,this.save(t)}return Object(ai.a)(e,[{key:"save",value:function(e){e.content&&(this.zorder=e.content.zorder,this.pinned=e.content.pinned,this.name=e.content.name,this.pose=e.content.pose,this.editing=e.contents.editing)}},{key:"restore",value:function(e){e.content&&(e.content.zorder=this.zorder,e.content.pinned=this.pinned,e.content.name=this.name,e.content.pose=this.pose,e.contents.setEditing(this.editing))}}]),e}(),kr=function(e){var t=o.a.useRef(new Ar(e)).current;function n(n,i){"enter"!==i&&"backdropClick"!==i||(t.save(e),e.content&&e.updateAndSend(e.content)),e.close()}var r=function(e){"Enter"===e.key&&n(0,"enter")},s=function(e){e.onClose,e.autoHideTitle,e.updateAndSend,e.updateOnly,e.close;return Object(On.a)(e,["onClose","autoHideTitle","updateAndSend","updateOnly","close"])}(e);return Object(M.jsx)($.a,Object(i.a)(Object(i.a)({onClose:n},s),{},{onMouseDown:function(e){e.stopPropagation()},children:Object(M.jsx)(j.a,{children:function(){var i,o,s,c;return Object(M.jsxs)(w.a,{children:[Object(M.jsx)("table",{children:Object(M.jsx)("tbody",{children:Object(M.jsxs)("tr",{children:[Object(M.jsx)("td",{children:ar(e.content?e.content.type:"",Ir)}),Object(M.jsx)("td",{children:Object(M.jsx)(U.a,{label:Object(D.c)("ctName"),multiline:!1,value:e.content?e.content.name:"",inputProps:{autoFocus:!0},style:{marginLeft:20,width:"100%"},onChange:function(t){e.content&&(e.content.name=t.target.value,e.updateOnly(e.content))},onKeyPress:r,fullWidth:!0})})]})})}),Object(M.jsxs)(R.a,{mt:2,mb:2,children:[Object(M.jsxs)(I.a,{variant:"contained",style:{textTransform:"none"},onClick:function(){e.content&&(Object(Qe.t)(e.content),e.updateOnly(e.content))},children:[Object(M.jsx)(Un.a,{}),"\xa0 ",Object(D.c)("ctMoveTop")]})," \xa0",Object(M.jsxs)(I.a,{variant:"contained",style:{textTransform:"none"},onClick:function(){e.content&&(Object(Qe.s)(e.content),e.updateOnly(e.content))},children:[Object(M.jsx)(xn.a,{}),"\xa0 ",Object(D.c)("ctMoveBottom")]})," \xa0"]}),Object(M.jsxs)(R.a,{mt:2,mb:2,children:[Object(M.jsxs)(I.a,{variant:"contained",style:{textTransform:"none"},onClick:function(){e.content&&Object(Qe.a)(e.content)},children:[Object(M.jsx)(W.Icon,{icon:Tn.a,height:Ir}),"\xa0 ",Object(D.c)("ctCopyToClipboard")]})," \xa0",Object(M.jsx)(I.a,{variant:"contained",style:{textTransform:"none"},onClick:function(){e.content&&e.map.focusOn(e.content)},children:Object(D.c)("ctFocus")})]}),Object(M.jsx)(Er.a,{size:"small",children:Object(M.jsx)(Sr.a,{children:[jr(Object(D.c)("ctUnpin"),Object(M.jsx)(W.Icon,{icon:Rn.a,height:Ir}),Object(M.jsx)(Re.a,{color:"primary",checked:null===(i=e.content)||void 0===i?void 0:i.pinned,onChange:function(t,n){e.content&&(e.content.pinned=n,e.updateOnly(e.content))}}),Object(M.jsx)(W.Icon,{icon:An.a,height:Ir}),Object(D.c)("ctPin"),"pin"),Object(M.jsx)(a.Fragment,{children:Object(_n.g)(e.content)?jr(or(!0,e.content),Object(M.jsx)(Tr.a,{}),Object(M.jsx)(Re.a,{color:"primary",checked:(null===(o=e.content)||void 0===o?void 0:o.id)===e.contents.editing,onChange:function(t,n){e.content&&e.contents.setEditing(n?e.content.id:"")}}),Object(M.jsx)(Mn.a,{}),or(!1,e.content)):void 0},"edit"),Object(M.jsx)(a.Fragment,{children:Object(_n.d)(e.content)?jr(Object(D.c)("ctUnWallpaper"),Object(M.jsx)(W.Icon,{icon:lr.a,height:Ir}),Object(M.jsx)(Re.a,{color:"primary",checked:Object(_n.h)(e.content),onChange:function(t,n){e.content&&(Object(Qe.q)(e.content,n),e.updateOnly(e.content))}}),Object(M.jsx)(W.Icon,{icon:dr.a,height:Ir}),Object(D.c)("ctWallpaper")):void 0},"wall"),Object(M.jsx)(a.Fragment,{children:jr(Object(D.c)("ctFrameVisible"),Object(M.jsx)(W.Icon,{icon:mr.a,height:Ir}),Object(M.jsx)(Re.a,{color:"primary",checked:null===(s=e.content)||void 0===s?void 0:s.noFrame,onChange:function(t,n){e.content&&(e.content.noFrame=!!n||void 0,e.updateOnly(e.content))}}),Object(M.jsx)(W.Icon,{icon:gr.a,height:Ir}),Object(D.c)("ctFrameInvisible"))},"noFrame"),Object(M.jsx)(a.Fragment,{children:jr(Object(D.c)("ctTransparent"),Object(M.jsx)(W.Icon,{icon:pr.a,height:Ir}),Object(M.jsx)(Se.a,{color:"primary",value:void 0===(null===(c=e.content)||void 0===c?void 0:c.opacity)?1e3:1e3*e.content.opacity,min:0,max:1e3,style:{width:"6em",marginLeft:"0.4em",marginRight:"0.4em"},onChange:function(t,n){e.content&&(e.content.opacity=1e3===n?void 0:n/1e3,e.updateOnly(e.content))}}),Object(M.jsx)(W.Icon,{icon:yr.a,height:Ir}),Object(D.c)("ctOpaque"))},"opacity")]})}),Object(M.jsxs)(R.a,{mt:2,mb:2,children:[Object(M.jsx)(I.a,{variant:"contained",color:"primary",style:{textTransform:"none"},onClick:function(){n(0,"enter")},children:Object(D.c)("btSave")}),Object(M.jsx)(I.a,{variant:"contained",color:"secondary",style:{textTransform:"none",marginLeft:15},onClick:function(){e.content&&(t.restore(e),e.updateOnly(e.content))},children:Object(D.c)("btCancel")}),Object(M.jsxs)(I.a,{variant:"contained",color:"secondary",style:{textTransform:"none",marginLeft:60},onClick:function(t){e.onClose(t)},children:[Object(M.jsx)(Nn.a,{})," \xa0 ",Object(D.c)("ctDelete")]})," \xa0\xa0"]})]})}})}))},Rr=function e(){Object(k.a)(this,e),this.buttons=0,this.dragCanceled=!1,this._down=!1,this.downTime=0,this.upTime=0},Ir=24,Pr=function(e){var t=Object(a.useState)(e.content.pose),n=Object(r.a)(t,2),s=n[0],c=n[1],u=Object(a.useState)(e.content.size),l=Object(r.a)(u,2),d=l[0],p=l[1],f=Object(a.useState)(d),v=Object(r.a)(f,2),g=v[0],b=v[1],y=Object(a.useState)(s.position),S=Object(r.a)(y,2),O=S[0],_=S[1],C=Object(a.useState)(!e.autoHideTitle||!e.content.pinned),T=Object(r.a)(C,2),A=T[0],k=T[1],R=Object(a.useState)(!1),I=Object(r.a)(R,2),P=I[0],w=I[1],N=Object(a.useState)(s.orientation),L=Object(r.a)(N,2),x=L[0],F=L[1],U=Object(a.useState)(!1),V=Object(r.a)(U,2),B=V[0],J=V[1],H=Object(a.useRef)(null),z=e.contents,G=Object(a.useState)(!1),K=Object(r.a)(G,2),Q=(K[0],K[1]),q=m(),Y=h(),X=Object(j.b)((function(){return z.editing===e.content.id}));function Z(t){z.setEditing(t?e.content.id:"")}var $=Object(a.useRef)(new Rr).current;function ee(){var t,n;H.current&&(H.current.resizable.orientation=s.orientation+e.map.rotation);var i=A?Ir:0;null===(t=H.current)||void 0===t||t.updatePosition({x:s.position[0],y:s.position[1]-i}),null===(n=H.current)||void 0===n||n.updateSize({width:d[0],height:d[1]+i})}function te(e){e.stopPropagation(),e.preventDefault()}function ne(){JSON.stringify(s)===JSON.stringify(e.content.pose)&&JSON.stringify(d)===JSON.stringify(e.content.size)||(e.content.size=Object(Cn.a)(d),e.content.pose=Object(i.a)({},s),e.updateAndSend(e.content))}Object(a.useEffect)((function(){$.dragCanceled=!0,"img"!=e.content.shareType&&setTimeout((function(){$._down}),3e3),xt.a.isEqual(d,e.content.size)||p(xt.a.cloneDeep(e.content.size)),xt.a.isEqual(s,e.content.pose)||c(xt.a.cloneDeep(e.content.pose))}),[e.content]),Object(a.useLayoutEffect)((function(){ee()}),[s,d,A,e.map.rotation]);var ie=e.autoHideTitle&&e.content.pinned,re={onDoubleClick:function(t){Object(_n.g)(e.content)&&(te(t),Z(!X))},onDrag:function(t){var n=t.down,i=t.delta,r=t.event,a=(t.xy,t.buttons);ie||(null===r||void 0===r||r.stopPropagation(),n&&function(t,n,i){if(!$.dragCanceled)if(2===n){var r;F((x+t[0]+t[1])%360),r=(null===i||void 0===i?void 0:i.shiftKey)||(null===i||void 0===i?void 0:i.ctrlKey)?x:x-x%15;var a=Object(E.a)(s.position,Object(E.y)(.5,d));s.position=Object(E.a)(s.position,Object(E.M)(Object(E.I)(s.orientation-r,a),a)),s.orientation=r,c(Object.assign({},s))}else{var o=e.map.rotateFromWindow(t),u=Object(E.I)(-s.orientation,o);s.position=Object(E.a)(s.position,u),c(Object.assign({},s))}}(i,a,r))},onDragStart:function(e){var t=e.event,n=e.currentTarget,i=(e.delta,e.buttons);J(!0),$.buttons=i,$.dragCanceled=!1,n instanceof Element&&t instanceof PointerEvent&&n.setPointerCapture(null===t||void 0===t?void 0:t.pointerId)},onDragEnd:function(t){var n=t.event,i=t.currentTarget;t.delta,t.buttons;J(!1),$.dragCanceled||ne(),$.dragCanceled=!1,i instanceof Element&&n instanceof PointerEvent&&i.releasePointerCapture(null===n||void 0===n?void 0:n.pointerId),e.map.keyInputUsers.size||2!==$.buttons||(w(!0),e.map.keyInputUsers.add("contentForm")),$.buttons=0},onPointerUp:function(e){X&&e.stopPropagation()},onPointerDown:function(e){X&&e.stopPropagation()},onMouseUp:function(e){if(X)e.stopPropagation();else if($.upTime=(new Date).getSeconds(),$.upTime-$.downTime<1&&"DIV"===String(Object(e.target).tagName)){if(!1===$._down)return;var t=q.local,n=Object(E.M)(Y.mouseOnMap,t.pose.position);if(Object(E.A)(n)>30){var i=Object(E.z)(Object(E.A)(n)/Object(E.A)(n),n);t.pose.orientation=180*Math.atan2(i[0],-i[1])/Math.PI,t.pose.position=Object(E.a)(t.pose.position,i),t.savePhysicsToStorage(!1)}}$._down=!1},onMouseMove:function(e){$._down=!1},onMouseOver:function(e){},onMouseDown:function(t){X?t.stopPropagation():($._down=!0,$.downTime=(new Date).getSeconds(),setTimeout((function(){e.autoHideTitle&&e.content.noFrame&&!0===$._down&&!1===A&&k(!0)}),1500),Q(!0))},onTouchStart:function(e){X&&e.stopPropagation()},onTouchEnd:function(e){X&&e.stopPropagation()}},ae=Object.assign({},re);ae.onDrag=function(t){var n;ie||e.map.keyInputUsers.has(e.content.id)||null===(n=re.onDrag)||void 0===n||n.call(undefined,t)};var oe=Nr({props:e,pose:s,size:d,showTitle:A,pinned:e.content.pinned,dragging:B,editing:X}),se=o.a.useRef(null),ce=o.a.useRef(null),ue=Object(nn.a)(ae),le=Object(nn.a)(re),de=Object(M.jsxs)("div",Object(i.a)(Object(i.a)({className:oe.rndContainer},ue()),{},{children:[Object(M.jsx)("div",Object(i.a)(Object(i.a)({className:oe.titlePosition},le()),{},{children:Object(M.jsxs)("div",{className:oe.titleContainer,onContextMenu:function(){w(!0),e.map.keyInputUsers.add("contentForm")},children:[Object(M.jsx)("div",{className:oe.type,children:ar(e.content.type,Ir,1.1*Ir)}),Object(M.jsx)(Ve.a,{placement:"top",title:e.content.pinned?Object(D.c)("ctUnpin"):Object(D.c)("ctPin"),children:Object(M.jsx)("div",{className:oe.pin,onClick:function(t){te(t),e.content.pinned=!e.content.pinned,e.updateAndSend(e.content)},onTouchStart:te,children:Object(M.jsx)(W.Icon,{icon:e.content.pinned?An.a:Rn.a,height:Ir,width:1.1*Ir})})}),Object(M.jsx)(Ve.a,{placement:"top",title:or(X,e.content),children:Object(M.jsx)("div",{className:oe.edit,onClick:function(e){te(e),Z(!X)},onTouchStart:te,children:X?Object(M.jsx)(Pn.a,{style:{fontSize:Ir}}):Object(M.jsx)(Mn.a,{style:{fontSize:Ir}})})}),e.content.pinned?void 0:Object(M.jsx)(Ve.a,{placement:"top",title:Object(D.c)("ctMoveTop"),children:Object(M.jsx)("div",{className:oe.titleButton,onClick:function(t){te(t),Object(Qe.t)(e.content),e.updateAndSend(e.content)},onTouchStart:te,children:Object(M.jsx)(Un.a,{})})}),e.content.pinned?void 0:Object(M.jsx)(Ve.a,{placement:"top",title:Object(D.c)("ctMoveBottom"),children:Object(M.jsx)("div",{className:oe.titleButton,onClick:function(t){te(t),Object(Qe.s)(e.content),e.updateAndSend(e.content)},onTouchStart:te,children:Object(M.jsx)(xn.a,{})})}),Object(M.jsx)(Ve.a,{placement:"top",title:Object(D.c)("ctCopyToClipboard"),children:Object(M.jsx)("div",{className:oe.titleButton,onClick:function(t){te(t),Object(Qe.a)(e.content)},onTouchStart:te,children:Object(M.jsx)(W.Icon,{icon:Tn.a,height:Ir})})}),"img"===e.content.shareType?void 0:Object(M.jsx)(Ve.a,{placement:"top",title:e.content.proximity?Object(D.c)("ctUnProximity"):Object(D.c)("ctProximity"),children:Object(M.jsx)("div",{className:oe.pin,onClick:function(t){te(t),e.content.proximity=!e.content.proximity,e.updateAndSend(e.content)},onTouchStart:te,children:Object(M.jsx)("img",{src:e.content.proximity?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAaIAAAGiCAYAAAClC8JvAAAACXBIWXMAAC4jAAAuIwF4pT92AAAgAElEQVR4nO3dX4xdV3XH8XNoYgIVsUGRqhbScVSnAl4ykYjgbcYImvASO6gJRXGwIyBFqJXHQCtRgXxHoX9oAr4uCLWFNjOQSuWPyJhWSgJp7HkptFTNjESSqlBlpokJaVwzF4nYsVF3te01yc3NzNy9zzlr/znn+5HuQ5SZ8f0zc3937b3O2qUxpgAAIJZX8MwDAGIiiAAAURFEAICoCCIAQFQEEQAgKoIIABAVQQQAiIogAgBERRABAKIiiAAAURFEAICoCCIAQFQEEQAgKoIIABAVQQQAiIogAgBERRABAKIiiAAAURFEAICoCCIAQFQEEQAgKoIIABAVQQQAiIogAgBERRABAKIiiAAAURFEAICoCCIAQFQEEQAgKoIIABAVQQQAiIogAgBERRABAKIiiAAAURFEAICoCCIAQFQEEQAgKoIIABAVQQQAiIogAgBERRABAKIiiAAAURFEAICoCCIAQFQEEQAgKoIIABAVQQQAiIogAgBERRABAKIiiAAAURFEAICoCCIAQFQEEQAgKoIIABAVQQQAiIogAgBERRABAKIiiAAAURFEAICoLuHpB5Cjsix3FkUxUxTF5NDdXyiKYs4Ys8aLmo/SGNP15wBAZsqy7BdFcXCTez0oimLaGLPE65oHgghAVsqytAFzzZj7TBhlhD0iANmQSmhcCFnbZZkOGSCIAGShLMvpLZbjNjJRlmWPVzd9LM0ByEJZlieKopjyvK92iW4nzQtpoyICkLyyLA9UCKFClugO8AqnjSACkLSyLHcURVFniY1qKHEEEYDU2WuFJirex4ExZo5XOG0EEYBkDV20WhWdcxkgiACkrCf7PFVRDWWArjkASZJ27eM17tuiMWaaVzd9BBGAJFVs1x52lTFmhVc3fSzNAUhOjXbtdUcJoXxQEQFIirRrL9XplOMi1rxQEQFITZ12batHCOWFighAMqRde6lGp9yqMWYnr2heqIgApKRfs12bcT4ZoiICkATatbuLIAKQBMcD77ZCu3amWJoDEJ20a9cJoVlCKF9URACiknbtlRp7Q7RrZ46KCEBsMzUbFGYIobxREQGIRtq1n6jx7y8bYyZ5BfNGRQQgpn7Nf7vOERFIBEEEIApp195T498+Zow5wauXP5bmAERBuzbWUREBCI52bQyjIgIQFO3aGEVFBCA02rXxElREAIKhXRsboSICEBLt2ngZgghAELRrYzMszQEIoizLlZonr9Ku3VJURADUlWVZ9/hv2rVbjIoIgCratTEOFREAbT3atbEVKiIAahpo1+b47w6gIgKgaa7mz+7x6rQfQQRAhbRrT9X42fO0a3cDS3MAVNRs17YNCpN0ynUDFRGAxjXQrt0nhLqDighAoxpo116VaohOuY6gIgLQtLrt2j1CqFuoiAA0hnZtVEFFBKBJtGvDG0EEoBG0a6MqluYANIJ2bVRFRQSgNtq1UQcVEYBaaNdGXVREAOpiujZqoSICUFlZlpNFUTxS40fQrg0qIgC19Gt+/wxPPwgiAJWUZbm3gXbtJZ59sDQHoJIG2rU5/hsXUBEB8FaWZa+Bdm1CCBcQREAD7KZ9WZZzZVkauZ2QtubWkcdVZ29n1RjDKB+8gCACarBvyjaApHNs/9BPsnsnbQ2jft127QbvC1qAIAIqkuWplZEAGnZN2950pV17s8frwrZrL4S7x8gBzQqAJ+kW63vskVzVlvE1dsmxZqfctXTKYRQVEeDInrUjb8T3eW7U1z0aIQm0a0MLFREwhuzz2GW4gzWeq925H3FAuza0UBEBWyjL8oDsA9UJoSL3qqiBdm2O/8amqIiADUgVtFBzKWrUIWNM3ZE4wTUxXdsYszO3x41wqIiAjTUdQlYv03buuu3aBxq8L2ghgggYYZsSFEKokDfzrC7kbKhdm+O/sSWW5oARDRxtME427dwNtGu3pnUdeqiIgBHSYjxQfF6yaFxooF37KCEEFwQRsDHNpoIpeZNPXZ3nYJDbMiTiIYiAjfWVq6Kku+do10ZI7BEBmyjL0s6JO6L4/MymOIWadu34pGKeHLoj9vVYaGu4E0TAFsqyXJLhpRqSnDYg08TrdMplP0UihqHjNWY2+RBgf18OtHFoLEEEbKEsy+miKI4rPkd2/loy19lI6/oTNX6EbdeebvAudYJM8HBdDr3dGNOK+YXrCCJgjLIs7SfQPYrPUzITqRuohmjX9iCXCvQrdCe2aoo5zQrAeNpnCqXUuFCnmqFd29HIgYpVWuRb1ZFIRQQ4kC6yw4rP1U0prP3bY84rfivTtR3J79Jm+0A+XtuW55uKCHCj3s6dyBy6qo+Rdu0x7H6jHKVxuIEQKka66rJGEAEO5E1Wc4luIpFjxat0u63mOFU8lKEDFY/XvDartQgiwJF0Ki0rPl8z0rUWU5VAYbr2BmQfqCddiBpDdFuDIAL8aFYt0adzy/U/ix7fMs81Qy83dKCi1r7ioE3PO0EEeJA//mOKz9l+uXYppr2Old9iIsuJyZB9IPs7ck9D+0CbadVSKEEE+NN+841dFa1JG/fRTb5kIOOJpmlQuEj2geZkH0h7GW65bUFE+zZQQYB27iSunpdOPlshre9d2YsoTxBAL2qwHduFDaHWfQAgiIAK5A16SbELatW25/KGny4ZTNoP2Ak3a/+9Nv5OsDQHVCBvBppLaKm0c2PEUDv2fYFCaFFGJ7X2Wi0qIqCGBo7SHofZbYmQKth++DgY6B6tyrTt1nclUhEB9Wg3FnChaAKG2rFDhNB6M8jOrrTGE0TAELkIccl13I68UcwrPod7Emjn7ixpx14K0I69bl5m9nXqmHWCCBASPifkIDyfN4Jel48VbyPZB1qQdmytgxGHLcqBgge62KBCEAEvDyHroOu4HdnD0QyLa2RpCMqGxvIsKZ9Btc7uA90u12R1dkIFzQrA5keCO582GqCdm2MWlNGOHQ8VETpProjfaPllynV/JkA793bauXXYU1IDt2Mfa3s7ti8qInSaw9HY9ogD54nYtHPng3bsdFARobMcQsiaKMvSpxLR7naKPvanDeQ1DdmOfahL7di+qIjQSbL5f4/jY/fan3EMuDp284ZWjSy1zgXcBzrK6bXjURGhczxDqKhwTpB2OzdVkaeRduxQY3muNcbMEELjEUTolAohtM62c0+6fGGAdm7f5cLOGjklNVQ79k3Sjr3U9effFUtz6AwJkkdqPF7ndu7i4r+3Qjt3PPKhoxeoAhpIK3anJiI0hYoInSAhVHdfZUquNXHV6mPFUzVySmqIEJqXIzt4PSqiIkLrDYVQE7PCaOdOlLRj95UbRYYtSiMCjSM1URGh1YZG9zQ1sHJC9hxcae/l0Ljw4impK4FCaMBYnmZREaG1Npgf1xTauRMRoR2bsTwKCCK0kmIIrZu3k5JdvlDuy4riMQJey4VtIANp55SXPYctylQElkEVsDSHtlpQHt+/36Odey1AO3cnNsqlHbsv7dghQmhVKs5pQkgPFRFax3cp7Prr31W84cori9e85jXFyZMni69/7e9dv5V27oCkHbsf6IC6gTQicBZUCDaIuHFry02Wa4zLbdeuq823H3r4J2bEo489/qz9f44/Z6/rc2e/1vW+VbzNtfF3uSiKaTliQ/O5G77Z36EdvC+Eu1ERoTVk2sARl8eza9fVxcPHj5++8g2vf91G///kj58+NT01dcWPfvTDcT9qVa4hcW1c0G7nvrYtV/TLPlA/0ESEQvaBZpiIEB57RGgFWbZpJISs1//ar17xhb/8q2ccftyEZ4u2djt39ktJkU5JZSxPRFREyJ7P/DiXEBp29dW/WThURQOpipw2s2WzXfP4AfumuqD489XEGMtDO3Z8VETImnSuOVcBX7n37065hpA1Nb3b5ctSm86dXVU0dEpq8LE8hFB8BBGy5Tu65/4HvnP6bW+97gqlx7s/oWPFs2nnHmrHfiRQO/aytGNzTVBCWJpDlqqE0A3Xv8O5ErLOnT9/5pXbtr3K41tSa+d2Xi6MoeEZgOMMpBGBkUgJoiJCdmRSwZzrG9hddx856xtC1sKxf/y557dMyR6HK5+v9ZX0dG7piAsVQrNyjRUhlCgqImTFd3TP4d6dZ3qHP+FT1VywNhgMrnvLddsdGhVGpdbOneQcugCP2zomVRBLcImjIkJu1EPILsndcceHqoRQUaGdW7MqKlKsiqQa0gyh9bE8ewmhPBBEyIaM7nEKoZtv+Z2iagjt2/e+V3mM+dnIjLzZjiVvlEcVXwPf5cIQnPfRPNl9oEN2ACzHM+SFIEIWfObH2RC6994vn6nyuD7+8U+YmiFUyL6HTwu1djt3T5Y0U6ExKfyo7AMxGy5DBBGSJ63IXiG07dJLvauh3uynznz2M3/+6oaejz0ptXMHmOgQy6KMNZrheqB80ayApPlOTTixuHjKjufxfUw2hGZ7n/QOrzGWjTFOR0UUFx/rkuLRFcm0c0tAH6/5Y1alESHLCRJ4KYIIydIc3TPsa9+479R7bn631oWut7u2DTf0Br0V58P8tJVluVaxdXsgI3k6cf5SVxBESJJc7PiIy32rE0IPPPjQ6Xfd8E7v7/Pge6z4gvKgzyTauX0mpQ+ZlyqIJbiWYY8IyRm64t7J5z7/hVRDqJBP/UznHiFNBfOOX744NJaHEGohgghJCTG6x3ryqZOnf//3PqwdQusOe7Zzzyrel2tSaeeWZcKtWtdXZWlzmnbsdmNpDsnwnZpQJ4Tevnv36ypesFrVMXuBpcv3yvOwojj+JqljxSWkbSU4Ka3dC3LaLGcDdQRBhCSEGt3jcfKqBuf9GZ9GjYpm2fBHKggiJMGndbnO6J4GpibUkVI7t3UVI3CQAvaIEJ3P6J6PfPQPn8s0hArZn6FxARhBRYSoqozuqTI14Zb3vLeIHELraOcGRlARIZqQo3sSCaGiwjlBMxwrjrajIkIUvlMTfvDoD86+ctu2y3zvq9LoniY4789IYB9WvC+HGBaKmAgiBBdqdM/dn+mf/YOPHfIOr0CcjxWXjsIl5WPFk2nnRvcQRAjKZ55a4qN7mpBSO/dRO8Fa8ecDmyKIEIzv1IRHH3v81Jvf9EbvYaSZhJC1ag9xc/3iAMdr086NKGhWQBBVRvdUCaHv/cv3T2USQtaEZzu39gWoTlPCgaYRRFAnexwLriH01a9/81TV0T237btV6zgHLc6np8oynuug0CqmXA/zA5pEEEHV0Ogep43293/gjuKW377JO0wizY9rgm87t/ax4lRFCI4gghrf+XHWrfv2Pel7f9YGg0GmIbTuoCxdjiV7OJqt1r7LhUBtBBE0OY/uWbdz4tf/z+fr7eieO+740PaMQ2idc7jIsNJVxfvivFwINIEgggoZ3aM5miaV+XFNsfszTsdECM2qxXe5EKiFIELjfObHjfr+v/37L7t+bYtCaJ1PVbQgJ5dqcV4uBOoiiNAoufCyUghZf/ulLzo1KiQ2P64pEzLOxxXTudEKBBEa08TV/w8+eP+FkNnqaxKeH9eEGY927qUA7dw+y4VAJUxWQCOaHkFjzx365Cf/6PyO7dtfuPbIdsfNzt65vX/kM21/0eaNMQdcvjDAseJe0x+AKggi1OY7NcGHPf7h8ssvL372s5+lcp5QKNdKxTNWgOncHCsOVQQRatEMoY5zns5dXHwdVpjOjVyxR4TKCCFVvvszTkt5FW2ncQGaqIhQSZWpCfBmL1qd9DhWXHs6t/NyIeCDigjeCKFgJjxbtDWrooKqCFoIIlRBCIVj27mdutZkDt1RxXs2Jd2RQKNYmoOXOlMTUFlS7dw+y4WACyoiOPMNob/+0j2Dp5/+yTP2w87z586d+fZDDz9jj/+Gt/2u5wRJQGi2WvsuFwJjURHBSVmWdn/goMvX2rB5+Pjx01e+4fUvO9zu+XPnzt522/7LOnZNUBN827mXFJdPB1IVcaw4GkEQYSyfqQlbhdA6OyHhurdc14ajG0K73RjjdHCdVFDHFe+f83JhbHKZwUZjkziN1o2tsu0HmxW1Dx82iLhx2+wmnVjG5bZr19Xmv5986n+Ng88e+YvTrj+X2ws3+yaww/X3VY5n13z+plP+25ElxBV+fxq92UDa2/hrxZswty3+kPdqhJD1nz/8r6f4o65063m8Ee9Uvi8nUv37kUMZu/67onmba/L1olkBG5LlDKdlIOtzn//Clstxoy655Jd+wTNfiW8796zifUmynVv2M+ns1LW/ySPlCSK8jO/onvsf+M7pG65/h3MIWT/96Rq/e9X4np7al+YCLUkdKy4h7dRUg9oa687kzQAvIX/IqiFkfetb/+B0AB425NvOrdlunVo7N+cnhbO9qfOqCCK8QD7ZLriG0F13HzlbJYQee/w/TrX4YLtQfI4Vt0usy4r367DrcmEAHG8eViPPN0GEC3znxx3u3XnmYx+ducz32Tv546dP7bnxRqqh+q7x3J/pyrHiHOKXIYII67xCqHf4E94Vzbnz588cOvSRK7h+qDF9j2PFTygfK77HdblQ2YkE7gM8EURYH93jFEL2xNSqIbRv3/texUSFRm33rHR6yo0LKVRFTHsIq5ng5zqabt98rre4+ZbfMc+fO/ec67VC686dO/9z+71ce6F22+lxfU1P+b4ciHz90A6ZBND134kQt7XGXreuvxF3+SafYJ1+YauGkHW4d+dz/NGq3hY836g1pw2s+Ux/UAoj7bDldvE2QxBxq/vH6jW656mTP36WEEr65jxux+e1r3hznv6gGEZMVtC9NTpZgTf0Dt605seNuuvuI2f4gw12W/J8oz6hfN+clwsVw+gAs+Yav61ozJpj+nbHyAVo97k8apdJ2pt54MGHTr/rhnd6fx9q8ZnOba//eETx6fY6tkKTXOO0k2nbtazIh50ljR9OEHVIiNE9BSEU00AqEafTUwOctrtb2saBrX8XCaJuCBVC3/mn48/81jve/itdf74jOmqMcWrpDnGsuDGGC0wxFtcRdYDv/Livfv2bp6qE0JNPnTz94Q/9LiEU10GP6dxrytf+TDQ5oRntRUXUclVG91S5YNWG0Nt3734dUxOS4Hus+IoML9XgtVyIbqIiarFQIWTnxxFCSZnyHLejWbX4HluBDqIiarGyLJdcQ2jm0EeLI5+92/vJYHRPsrz2Z8qytB9YphQfzFVyUB/wMlRELeU7P+7Tn/7TM77PBCGUNN/9Ge29HOfTftE9VEQt5NOWa0Po3nu/fGbbpZd6LcmdP/+L527dd9urCaGk+bZz95VPN6WdGxuiImqZsix7riFkL1j9ylfmz/qGkPXHf/JnJSGUPN/9Ge3p3FRF2BBB1CJyUNphl0e0PjXhldu2eR9u15v91BlOWM2Gbzu3ZmPBhHxQAl6CpbmWkBC6x+XR1BndQwhliXZuJI0gagFp1T3u+ki++71/PfW2t17nfVz3175x36n33PxujvnO003GmAWXe+77+1TBvDHG55hztBxBlDnmx8FRau3c12oN0ER+2CPKGCEED777M9oVSwrHiiMRBFGmhqYmOIXQXXcfOVt1fhwh1Boz8nszllx8Oqv4wKfkSBKApbkc+Y7usc0Jjz72qPe1QsyPayXn/RmmcyMUKqLM+IaQdeu+9xFCWLdflnTHks42zYkLtHPjAoIoPws+IWT9xq5d/+Pz9c+fO3f2gx/4ICHUXs77M3Li67LiM+G8XIj2IogyIqN7vDuZTj377OWuX2tH99x22/7LHnzw/pY+i6iwP6M9nZvGhY4jiDJR51jn7373n1/r+rWM7ukMn6rILgUfU3xi9nseW4GWoVkhA7KO7jS6ZzOPPvb4qTe/6Y1bXozK1ITOmTXGOO3RyJigJxSfIK/pD2gXKqLE+cyP28qeG2+8wjYgbPQla4PB4Jb3vLcghDpnxmMOXYh2bqYtdBRBlDCf+XHj2MYD2wX3xb+ZG9hzhAo5T8j+92t37NjOclwn+U7ntst5q4pPVI/GhW5iaS5R0mL7iNa9e/8H7igWTxwv6IyDzzlBTX442oTzciHagyBKkO/oHqAm3+ncmnPo7HTuSY4V7xaW5hJDCCEC3/0ZzYrFd7kQLUBFlBBZH19SPAsG2MyqVCKux4pXvpzAEceKdwgVUSKGRvcQQohhwvPCVe1jxbnItUMIogRUmR8HKPBt59YMi2to5+4OluYSUJalnR+3p+vPA5LgdXoqx4qjCVREkclaOyGEVPiO29GeQ6f585EIKqKIAmz4AlUsG2OcjooowhwrfhXt3O1GRRRJWZYzhBAS5bs/o1210LjQclREEQS4Oh2oy2t/hnZu1EFFFBghhEz47s/M0M6NqgiigGRqAn9QyMVhj3buNdq5URVLc4EwugeZOmaMcT7NlXZuVEFFFAAhhIzt8Wzn1qxamEPXUlREypiagBagnRuqqIgUEUJoCd/9Ge29nDnln4/ACCIlhBBapu96eqpUK0cVH/6U53IhEkcQ6ekTQmgR3/0Z7encVEUtQhApYHQPWuqgZzu3ZmPBhEwnQQvQrNCwsixtJXSwVQ8KeJHvseK0c2MsKqIGyYYuIYQ2892foZ0bY1ERNYTRPeiQVWOM0xJdEaad+1pjzFKXXoC2oSJqQFmWewkhdIjv/ox2OzdjszJHENUkUxPo4EHX9BJr53YeQ4T0sDRXA6N70HFHjTFOlZGE1ori34rXciHSQkVUkbSxEkLoMt92bs12a7tcSONCpqiIKmBqAvAC33buJcW/G9vOPckcuvxQEXkihICX8N2f0ayKaOfOFBWRpwCtqEBufNu5F+zxEoqPkWPFM0NF5EFG9xBCwEv57s9oj+ahKsoMQeSI+XHAlmY827lnFZ/OKY4VzwtLcw7k097h5O8oENe8McYpAGjnxjAqojHkkxUhBIy3X66tGytQOzdVUSYIoi0wPw7wsmzbp12/wRgzJ9+jhYooE5d0/QnYjHyyI4SAzS3LpQwXbhWPY7BV0XGe425jj2gDjO4BXsZeLLo0FDxLTZ0DpNjOzVTuTBBEIwgh4ILloeBZ0nxDlzFBTzT4I21ozsjSHzJAEA2RTp4lxRMlgRSpVTuuGuxMXbTHTjDmJy8EkWB0DzokWLXjqoF27lUJICYqZIggIoTQfosxqx1XFbtUbTXXN8YwTSFjBBFTE9Auq+uBI51sWW3We07nnpe9oCSDFe46H0SEEDK3OBI8Wb8pl2U57dDOvSgBREdcS3Q6iAghZGYwssTWyv2Qsiz79tC9Df6XrfZ6dMO1T2eDiKkJyMBwU8GJrnSCyZ7t3NC1RasyUXuBZbh26mQQEUJIVKuW2eqSQNrJElz7dS6I5DTJ+xK4K+i2TiyzAS46FURMTUBEnVxmA1wkMfRUlsp6MtFgVTpiFhr+NwghhJTFtTtACqJWRNKqObfJSJ3bm+qOIYSgLOtrd4DYogSRDDm0ITM15kuvqruEwdQEKKCpAGhQ0CCSUOhtco3ARo4ZY/bW/PcIIdRBtQMoCxZEsg/Ur7A8trtKRxEhhIqodoDA1INI9oF6Dstwm1k2xjgfPzz072odtoX2oNoBEqAWRBWW4bbi1bjABavYBNUOkCCV9m25aHSuwS61vq1wPN44djb07yJfqyPX7VDtAIlqvCJSOPZ33azrmSOK9wHpWh65bocLRoFMaARRU0f+bsS5nVv5fiCuwUi1w3gcIGNJTFbwYLvuXNu57dfOcBFrK9BUALSYRhBpbgDvsV14Lp+A7X5SWZYzNC1kaXGo4mGZDWg5jaU52y23oliJrBpjnJsRyrI8UaN1HPoGI9UOy2xAx6i0b0slckTxqTxkjOk73heXo4cRzvJItcMyG9BxmtcRrWwyzLQJAzkwy2kZkCPBo+LaHQBb0gwi7UrkqDFmxvG+7JQ3QhoXdHHtDgBvqiN+AozZoZ07ruWRaoemAgDetINI+8LSRWPMtMf90VwubDuu3QGgIsTQU+1KxHk6t4weuk/xvrQJTQUAgggRRLRz54GmAgBRBDmPKMA0bJ92bubQdbCpQI6Ln2QvC0hPyIPxlhQPqfNt5+43dDxFLjo3qUC6NtdvwxWw/V3puX5wAaAvZBCl1M6tvVwYU+cmFcjrORw84z7wDIwxOwLdPQBjBAuiIr127rYcntfpFuoalfa1NGAAaQgdRKm1c2suF2p4SQu1LLN1uqmgRvOJ874iAF2vCPn8yqf1WcV/YkpatF05LeVFZJsK5u1R6fIJfocNWntAoF1y63oIiapLj5ON3xMAlQStiIo027m1lwt90ELtqca1YV7VMwA9wYOoCLM/k8Ox4sxla4B8sPlplZ9kjClTezxAF0UJokL/wlLfdu4Qc+g47E1J1b0+gghIQ8wg0m7nnjfGHHC8L00vF3LYW0BVP9QQREAaogVREeacIOcW3ZrLhUyhjoggAvIWO4i0zwnSaudepIU6HSzNAXmLGkRFmP2Zm4wxC473ZaPlwsFQ6NBUkJg6zSYEEZCGFIJoh1RFWucE+bZzr4+JWSN40lej/Z72bSAR0YOoSKydG/koy9JekHyk4h12bmYBoCvoZIXNGGPmZN9Fy4xUXp1jKzz7hi1LWK1gX0tpdKkaQkWNiQwAGpZERVQk1s6dKwmbSVlanNzg+IMDrvtlKZLfETtJ4UADDS7OA3IB6EomiIrE2rlzIMEzfPzBuH22ZWNMFjPW5CC79UCdbHg4bTbPA9AFqQVRUu3cKavaLZZqp9jIQXaTymdF3S7LwQASkFQQFYm1c6esRvW4O/akh5ElRJeD7Jrk1UUJQN8lqT3HtrtNuui02rn79kr8Dl+EOh16o35kmc1lCVET3ZNAYpKriIp6o/1dZd/OXaN1Wb0iCLzM5oNrh4AEJRlERZjp3JM5d01JlfFIxW9vbI8k8jKbj+xfc6CtUg6iOm+0LrJv5y7Lcq1itWHflKerdBAOLbOtVzsxl9l8tKpjEmiTZIOoCNPOHX3jvo6ap8vaMNq71UUIef8AAALpSURBVOOXi4CHg0erQtVkH+cMXXJAulIPIu1jxbPeM6g54madnWixIG3z1vBSW6rLbK4qV34Awkk6iIow7dzZXlMS8ZjzHCzKJAn2hIDEJR9ExcU33JVUpnOnRrmpI0ertkWbpTggH0kMPXUwo/izJ+S6pVxxXcxFNoBul844QgjISBYVUaH/yZ+qKE+rsr81xz4QkK+cgkh7PyT3vSLNGX2p4LRcoIWSG/GzGbvpXJbl0aIoDir9E9luastz02uggy41yxI6SxI8NB4ALZRNRVTotnMfMsb0G/6ZwQW47krb4lDFs9TheYBAp2QVREVz184Ma9WBeRmF0WAkdDgxFeio7IKoaK6dO/sTSzeTaBitjgQP+zsALsg1iOoeK35UrjVp7dJPgAuBx1kc2d9hmQ3AhrIMoqJ6y/KizB3rxKdxCex+gFE9yxI4S3SzAfCVcxD5tHN3+mp7uWC319B0isFwpUNTAYC6sg2i4uIbbH9MO/dAKoI+b5YvHDh4QAaaunQeLkuX4nq1s0QLNYCm5R5EO+RT+UZLT/NSBfHGuQE5V2iHhJK1NjSBe4XnDUAoWQdR8WIY9Ye6xI5JBUQ7MABkIPsgAgDkLZfp2wCAliKIAABREUQAgKgIIgBAVAQRACAqgggAEBVBBACIiiACAERFEAEAoiKIAABREUQAgKgIIgBAVAQRACAqgggAEBVBBACIiiACAERFEAEAoiKIAABREUQAgKgIIgBAVAQRACAqgggAEBVBBACIiiACAERFEAEAoiKIAABREUQAgKgIIgBAVAQRACAqgggAEBVBBACIiiACAERFEAEAoiKIAABREUQAgKgIIgBAVAQRACAqgggAEBVBBACIiiACAERFEAEAoiKIAABREUQAgKgIIgBAVAQRACAqgggAEBVBBACIiiACAERFEAEAoiKIAABREUQAgKgIIgBAVAQRACAqgggAEBVBBACIiiACAERFEAEAoiKIAADxFEXx/2sbXN6a4A2RAAAAAElFTkSuQmCC":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAaIAAAGiCAYAAAClC8JvAAAACXBIWXMAAC4jAAAuIwF4pT92AAAcTElEQVR4nO3df4hm13kf8HuDpcgBZ2VjMIktVgK5v2zQKrFo/1spNMj+J5KhcVOwszJN1OCm0a6dltKm7GwcEkLkakVL/3Bsshsr0NQQrQKJ7MZY2lBo2tJ6FtLGaQzeqe20hkXekcFaK4JTrnRGHo3mxznve88998fnA4ONPTvz7t3d9zvPOc95ThtCaACglu/z5AGoSRABUJUgAqAqQQRAVYIIgKoEEQBVCSIAqhJEAFQliACoShABUJUgAqAqQQRAVYIIgKoEEQBVCSIAqhJEAFQliACoShABUJUgAqAqQQRAVYIIgKoEEQBVCSIAqhJEAFQliACoShABUJUgAqAqQQRAVYIIgKoEEQBVCSIAqhJEAFQliACoShABUJUgAqAqQQRAVYIIgKoEEQBVCSIAqhJEAFQliACoShABUJUgAqAqQQRAVYIIgKoEEQBVCSIAqhJEAFQliACoShABUJUgAqAqQQRAVYIIgKoEEQBVCSIAqhJEAFQliACoShABUJUgAqAqQQRAVYIIgKoEEQBVCSIAqhJEAFQliACoShABUJUgAqAqQQRAVYIIgKoEEQBVCSIAqhJEAFQliACoShABUJUgAqAqQQRAVYIIgKoEEQBVCSIAqhJEAFQliACoShABUJUgAqAqQQRAVYIIgKoEEQBVCSIAqhJEAFQliACoShABUJUgAqAqQQRAVYIIgKoEEQBVCSIAqhJEAFQliACoShABUJUgAqAqQQRAVYIIgKoEEQBVCSIAqhJEAFQliACoShABUJUgAqAqQQRAVYIIgKoEEQBVCSIAqhJEAFQliACoShABUJUgAqAqQQQ9aNv21rZtN9q2vd62bWjb9mrbtvd6tnC0NoTgMcEaugBqmuZ00zTH9nyV7aZp7g0hbHq+cDBBBCtq2/bBpmnON01z/JCvcCWEcMIzhoNZmoNMbdve3rbts03TPHlECHXuatv2Ic8YDqYigkTdPlDTNN0y3COZz6xbors9hHDds4bXUxFBgljVXF0hhJq4d3Tac4b9qYjgELHzrdsHuquH53RHCOGq5w2vpSKCA7Rt2wXQMz2FUBMDDdhDEME+Ykv2Kstwh3nA2SJ4PUtzsI+2bTd7rIR22woh3O6Zw/eoiGB/pcLieNu2GhdgF0EE+3u24HPZiK3gsHiNIIIDlWwsOBbPI8HiNfaI4GBxesLJgo9IOzeL16iI4FClR/Nc8PhBEMGBYrXyeMEndFI7N1iag0PFpoKr+1zx0Bft3CyeiggOEQeVlmwsOB4Pz8JiqYggQXfjasKVD6synZtFUxFBmpKNC8fMoWPJVESQaIB27rtdK84SCSJI1N3M2jTNVws+r8shBF10LI6lOUgU27nPFXxeXTv3g/48WBoVEWTQzg39UxFBhtjZVnJ6tnZuFkdFBCsoeF9RE9u5T5hDx1KoiGA1Jasi07lZFBURrKht20vd9d8Fn999IYSS9yLBKAgiWJF2buiHpTlY0UDt3KWvooDqVESwhiHauWPjgjl0zJaKCPbo9n5S7wkaop278NeH6lREsEvbtt2tqaeaprkSQjiR+my0c8PqVEQQ7Qqhzl2Z+zOl27lN52a2VETwSgh153bO7nkWWfcEaeeG1aiIWLxY+ewNoWaFg6WnY3iVoipilgQRixZD6LcOeQaPxPNCR4p7OCXDIne5ECbB0hyLFa9ceDLh9598sDS2c2+6VhzSqYhYpLZtu464C4m/95OZ7dwl58Qd087N3KiIWJwYQs9mHkLNuidogGvF79DOzVyoiFiUFUOoifcE5VQipadna1xgNlRELEYP+ze57dy7zyWVoJ2bWVARsQgxhJ5ds4kgt517o3A7d+oeF4yaIGL2doVQHyN4xtTOnbtcCKNkaY7ZKzDxQDs39EhFxKzFfZq+x+6cjGeQjjRQO7drxZk0FRGzVbhZQDs39ERFxCzFvZOSHWvH46DUVKX3cjQuMFkqImYnYX7ca9x55zubk/fe17zpTW9qvv3tbzef/tQnU3+pdm7ogSBiVnJD6DcefezGL/zCPw4333TTG3f+t+vb29sPP/xzxz77H/59ype4GEJIGkQ6xLXiOcuFMBaCiNnInZrw9Of+6Ln33v9333LQ//8zP/uPUquju0MImymfeMC9R306E0IwdYFJEUTMQt8h1MTK6M233pry9ZLbuZtXXutV7dzwPZoVmLwSIdS59dixY6fPfCzlSya3c0euFYddBBGTFvddLqSG0NmNj7+QEkI7fuRH37OV+KnJb/4hhO6A7eXUz1/BqRjOMAmCiMnKHd3ThdDG2V96Y8Knvuqll166JfFTx9bOrSpiMgQRU1Y0hDpP/+EfvC3j009nzKHrmhsu5r6eDLnLhVCNZgUmKedMzk9+4Kea33niM9+56aY3/EDO7zWjWWE37dyQSUXE5OSG0BNP/PYLuSHU6c4SrfBsTmVeK156Orc5dIyeIGJS4htrVgjtPqyaauPcr7yQeKB1P8lv/iGE7nNTGyJWcTpWXjBagojJiFMTkg6DdmN7HnvsX19bNYTObfyr7F+3y8n4WlPlfG4u7dyMnj0iJiFndE8XQl985pnnbnvH25PbtHd87vNfeO597/3x7F+3j67KOZExh670dG5z6BgtFRGjF8/ETCmEmjg5IadFu2RV1LiziDETRIzarqkJSf7Nv/13YwihHTnt3F333OM9f//dcpcLYTCW5hitUqN79vra17/x3I/dd99bvvKVvyjxKEbVzp2zXAhDURExSrmje373s793bYQh1KzQzl1yCS13uRAGoSJidIYY3dPEA6v3vOeeYwVDaMfYpnOfcK04Y6IiYoyKh9CLf/VXL3QHVgcIoWaE7dwaFxgVFRGjkjM14aMf+2ff+cSjv549MaELoQ9+8KffuMaB1VXkXiveTeh+oODr0c7NaKiIGI3c0T2/9mu/0q7y2iuEUBMrkZz9mdJ7OaoiRkMQMQpt256fwOiedZ3NbOc+V/C1aOdmNCzNUV3u1IQ//Z9/euP7b7459Z6gV/UwuqcPT4UQkq5nGKCd27XijIKKiKpWGd2zSgj95qcvbI8ghDoPZLZzl75WXDs31amIqCa+IT+T8v1HNLqnD1dCCMlXebdtu5naRbiiO7RzU5OKiCri1IRLqd/7qd///WszCaHOXZn7M64VZ9ZURAxuqNE9/+vPvnztXX/rb751pH/C2rkhUhExqLgBf2mI+XEP/MRPjDWEmhG2c6uKqEYQMZhdo3uSxtd88lO/tT3S+XF9GVM7d+5yIfTG0hyDGGp+3HdffPHGu9/17lsmEEI7kufQxWe4WXgOnXZuBqciYijnU0OoG92z6vy4D33o1JRCqIkHS8cyndscOqpQEVFczuiezo3vfjf7wGql+XF92QohJC3RNcNcK66dm0GpiCgqN4ROn/lYs8qB1Y985OenGkKd423b5jQjlK5aLhT++vAagohi4uZ3cgh1fuRH37OV+3q60T2f/tQnp/4HuRH3gI4U26wvFnwtycuF0AdBRBE5o3t2e+mll7KqoZHMj+tD7v7MRmwuKEVVxGAEEb1bNYQ6T//hH7wt9XMf/cT5GzMJoR2PZLZzlzz7k7tcCCvTrECvcqcm7Ofr3/jLa2//4R869DDqSEf39EE7N4ujIqI3fYRQ58yZj76164I76P+fcQg1K7Rzl57OrZ2b4gQRvYhLSmuHUKfrfutasb/85//7m7v/9y6cuuscZhxCO5L3Z0II3bikywVfS/JyIazK0hxry52akOP++9/XvOO2217+FTPojMtxLoSQVI3ESvRLBV9L8nIhrEIQsZaSIbRwudO5s85rreD9sfqC3gki1jLApW1LdjGEkDSIdIBrxbOmP0AOe0SsLP4ULoTKORWX3Y4UK6fS7dwaFyhCRcRKBlgK4hVZ+zNt217Vzs3UqIjI1rbteSE0mK6d+8GMb1byTqFjLtCjBBURWdaZmsDKxjad++4QwmbBr8/CqIhIlhtC3b1C//1/bH6t+2Gn++j++09+4Kc88Hy5+zOlb1pVFdErFRFJ4vLQk6mf//Tn/ui5g675ntGg0iHltnN3YfFIwdennZveCCKOlDu657AQ2vGBv/8PmgnfH1SLdm5mydIchyoRQp1f/uVz3zzqc3idUyO6Vlw7N71REXGg3J+qf/ezv3ftA3/v/YdOzd6tbVsPP9/Y2rlPuFacdamI2Neu0T1JIXR24+Mv5IQQKzsZm0ZSlW7nVhWxNhURr5M7P64LoY2zv5TVfNBN0v7+m2/WsLCarViJpDYudE0FDxR8PffF68thJSoi9nOpZAh1Lv/xf3rek1/Z8cx7iErftKoqYi0qIl4jZ3RPdybod574zHduuukNP5DzFL/74os33v2ud9/yla/8hYe/uqz9mdhYcLbg6/lwCCH5HiXYTUXEq3JD6IknfvuF3BDqfOhDp4TQ+nL3Z87H8CplIy7pQjZBxMviT8xZIXTzTTdlL8l1h1mdH+pNbjt3ySW63OVCeJWlObJG99x55zubZy9fvvb2H/6h7A45ExWKyG3nLnl/lHZuVqIiWrjcEPriM888t0oIPfqJ8zeEUBG57dwlqxbTuVmJimjB4rLOM6lP4P987evP3faOtx85NWGvz33+C8+9770/nv3rSDa2a8W1c5NFRbRQcXRP8tDKbnSPEBqtY5mVzkbhxgVVEVkE0QKVmh+315/8l/92TQgN5mzbtklDSOMeTsmwuCtzuZCFszS3MKXnx+342te/8dyP3XffW7RpD+qpEELSba7x78Gma8UZAxXRggw1P04IVfPAiKZz5y4XsmAqooUYYn5c5/r29vY977nnmBCq5koI4UTqNx/gWvE7tHNzFBXRciTPj/uHP/Nws0oIdYNMH37454RQXbn7M6XnxGlc4EgqogVYZXRP7tSELoQ++MGffqOpCaOgnZtJURHN3BAh1BFCo5K7P3NaOzc1CaIZy5kf101N+MxnLt4wP242ctq5rw/Qzq1xgQNZmpupVUb3rHJg1fy4URvbteLaudmXimiGhgoh8+NG72RqO3dUeg6dC/TYl4poZnLnx/3nP/mv1/7O374n+6yQ0T2TsRVCSFqia7RzU4mKaEZWmR8nhGbveOb+TOm9HLe48joqopkYan6cEJqk3HburnHhkYK/Ue3cvIaKaAZyR/f8xqOP3VglhLrRPf/k5z8ihKYnd3+m9HRuVRGvIYgmbpX5cb/4sdO35P6uzY+bvEcy27lLNhbkLhcyc5bmJmyo+XHf+Mv/e+3ekyffKoQmTzs3o6QimrYLqSHUTU34l//in2f/1NGN7jlz5qNCaB5y27lL3inkWnFepSKaqNz5YH/25T//5t/463/tbTm/W/PjZmls7dx3hxA25/moSaUimqDcELr//vc1QojoeBz9lKr0TauqIgTR1MRN3qxJye+47bbs3+Wv/uqvN0Jotk7H/cUjxcOnjxd8EN1yYdKtssyXIJqQOLrnsdxX/Pzzz2d9vvlxs5e7P1O6nVtVtHD2iCYiZ37cfra3n//WD/7gm9581Oc5sLooyfsz6/79S3AuhGAW3UKpiCYgTk1Y603gk7/56SMrHCG0OMmVSAih25e8UvABJS8XMj+CaOR2je5Zyz/9xTO3dEGz39foGhO65TghtDi5+zOlp3NboluqbmnOxzg/mqbpQqg78Bf6+ji78fHvfOv69esh+o9f+OL/u/POd/b29X1M7uNqzt//OFS35O/xhPej5X3YIxqpuEyxWepke3fA9fnt7ebzn396Do+L9STvz8QxQV8t+Lyzpj8wD4JohHJH98Cacqdzd6F1tuBD/3Dck2IhBNHICCEquRhCSDq8Wrpa76Y/xCU6c+gWQrPC+JwXQlRwKnUO3RDTuQe4oI8RURGNSO7oHuhZ7nTuknPotmNV5FrxBVARjYQQYgROxoOrqUpWRbmX+TFhKqIRGODUOqTK2p8Z4Aco14ovgIqoMiHEyOTuz5SeQ6cqWgBBVJEQYqROZ1wrfrXwRITc5UImyNJcJbtG9xxb5ANg7MbUzu1a8ZlTEVUghJiA3Hbu0nPotHPPmIpoYEKICRlTO3fnDu3c86QiGlBcwrgghJiI3P2Z0lWL6dwzpSIaiNE9TJR2bopTEQ1HCDFFue3cp10rTi5BNID4U6IQYqrOZrRzXy8cFndp554fS3OFGd3DTDwVQki+zbVt26vauUmlIiqobdvzQoiZeCC1nTvSzk0yFVEhpiYwQ1dCCCdSf1vauUmlIipACDFTufszpfdy3OI6E4KoZ23bPiiEmLHz8SjCkWK18njBR3Eyc7mQkRJEPYpTE/yUxpzl7s+Uns7t39sMCKKeGN3DguS2cxe9VrxtW40LE6dZoQdxqeKqEGJBtHPTGxXRmnaN7hFCLEluO3fJxgXXik+cimgN5sexcFshhKQlumaYdu67QwibS/9DmSIV0XouCSEWLHd/pnQ7tzl0EyWIVhRH95T86Q6mYGNk7dzJ+1aMh6W5FZgfB6/xeAghqTIaoLEna7mQcVARZWrbdkMIwWs8MrJ2bo0LE6MiymB0Dxwo91px7dy8SkWUSAjBoXLH7ZRu59a4MCEqogRxasKXRv9Coa6xtXObzj0RKqIj7BrdAxxubO3c9oomQhAdwvw4yLLV7c2k/oIB2rl1z02EpbkDmJoAR9qK/0Ze/lhlGaxwO3dWAwX1vMGzfz0hBPu63DTNZvy3sdnH/kvX2RbbrR8r8MgtqU+EimgPIQQv29oTOkXf1Nu23ez531zyIVvqE0R7mJrAQvVe7eSIrd/P9PClugB9qHRw0i9BtIsQYiEGrXZStW3bDRF+YMVf3h1i3QghOD80QYIoatu2+wv8yCheDPTryk7orNpUMIQ4JuirK3yri9315SYpTJcgMjWBedneEzqTWqKKjQtnEz/9cgwgdxBN3OKDSAgxcVd2LbONttpJldjOvRWX4S6M69WzqkUHUby75MkRvBRIdXnX2Z3NOS5HHfLvcjvOkDtvGW5eFhtEpiYwAVt7qp3FLEHFlYrz8d/nTgBdMDtunhYZREKIkZpEU8GQurZurdjzt7ggip05m0KIEZj9MhukWNSIn7gRekkIUcFil9ngKKMIoniq+nQ8zLYdNyN7HeFudA8Du7Kn2ln8MhscpOrSXFwmu3DA5VhPhRAe7PF79T3LCnZM+uwO1FYliGJ1spEwyeDDfZwVMLqHnmkqgB4NHkTxBseNxH2abl39xDqbuEKINal2oLDBgijuA51fYXns3Kr7RUKIFah2YGDFgyguw51fIxC2Y1WU9YZgdA8JVDswAkWDKHMZ7jBZjQtrTPFl3lQ7MEJF2rfj5IILPXapPZB5wvr2nr4v07W9+9yOA6MwXkUqorZtu580j/f8Za+EEE5Ufg2M19aeaseBUZiI3oOoxyt/95Pczl34dVDf5T2TClQ7MFFTC6JuueX21Dedtm2fPeCwLNOiqQBmrEQQlW4USG7n1rQwWbsve9u0zAbzVmqPqHQlckdqx1Pm1cPUcXlPxWOZDRakVBCVrkSS27kTrx5mOFt7qh3LbLBwxc4RtW17PmGW3DruS30Tc7i1Kmd3gEOVDKLSlUhuO7fGhfKc3QGyDTFZ4bGCfyzauetydgdY2xCz5koeLM1t5zYEdT3O7gC9GyKISlciOe3cGhfSbe9ZYtNUABQxyDUQ2rknQVMBUMVQQVS6nftyCOHejNez9Dl023uW2GZf7cS/g11zy3XVHYzLkBfjjamde2mNC4ubVBAnwN8bP07s+cHjYgjhoYovD9hlyCAqvT+zFUJIvv5h5u3ci5tUEH+42PlI+XO9W5cfjMNgQdQMc7D0TAjhfOJrmcscukW3UK+x55f8dwUoa9Agal5549js8cK8vXLbuUsvF5Zwec8y26KbCtYIoqxbf4FyagRR6f2Zx0MIpxNfy9jbubVQH2GNv0/bIYRbB32xwL4GD6LmlTePS9313wW/RU4795jm0GmhzhR/mPjWKr82hNDWfO3AK2oF0djauUsuFx5kcS3Upazx55fcaQmU84Yaz7b7Sb9t23MFD5ae7JZsMt5kTg/Qzu2yt3IuVfhBAuhJlSCKzscAKLU/082VS2rn7gKrbdunel4udNnbcDxbmLBqQdS9Mcfp3KX2Z453Xz+jRff0GkG0tWeZTbUDkKjKHtFuI2vnTm0FvrKnm01TQUVrtOHbI4IRGEMQja2de3OfOXSXNRWM1xqzAwURjED1IGqGaedOHucSw2gnuATPyK1z+aL2bRiHsQTR7bESKdW4kNXOzTTEwaZfWvHFZs0mBMr5vjE827jHUnLuV9fOvchxLt2bdXdoNy6BzkashFYNoSb+4AOMwCgqoubw/Zm+zP4n4PgM915/sLvKTN4vG6NYOT8Yl07X/Xvy4RDChak+C5iT0QRRM8y4neRrxaciVno7wZPSffjmKZxpiqGzE6YnClzZMYnnAEswqiBqyt8TlNXOPXYrdou9P4RwaWy/tSMusuubi/FgRGpOVjjIRsF27mNxL2ryb0KxelzlzfpEHIlTzT5LiENfUDirqhimbnRBFMftXGya5lShb3GqOwC54OkHgzct7FlmS11CLOWiA8gwLqNbmmu0cydZs3U5+ZqMNV7bUMtsOWa1NAtzMcogata7eTPVKPdKcrRte33FsO5tj2QEy2w5Jv9nDnM05iDSzn2ENSdSrNS+PLJlthxnMgbgAgMabRA12rmPtM54m+jIN+d4EHZ3xTPWa9UPo0sORmzUQdRo5z7UmvtEO7bi3U07M/V2L7WNeZktlYOrMHJTCKI+3mwPM+mflteYPD13XcA+ZGgtjN8oZs0dJrZZXyz4LU7FfY+p8tP+63XX0J8QQjANo6+Imu81LlwtuD8x2apogGczFdsxlM87JwTTMvqKqInXiheezj3ZqmiAZzNmXfg8FfeBbu0GugohmJ5JVEQ7Cu+HTH2vqOSV62PitlyYmTHOmjtM1678ZKGvPfWfpB+Kb9BzWqLbir+nzRg87hCCGZpURdSUa+eexQ2uA5y7Ku3KTrXThY9lNliGKQZR3+3c3ZvfvTO6GmJKYXR5T8VjBhws0OSCqHnlzbbbnH+khy91LnZZzeoNcKRhtL2n2rG/A7xsqkG0bsvy5XjYcbZLP3E0z6WKe0ZX9lQ7ltmAfU0yiJrV56x1m9+nlzKBOQb2hTUGo6baioGzqZsNyDXZIGry2rm341mb2S3DpYjV0UaPTR6793Y0FQBrmXoQ3ZtwrfhTsQpa/JtlbPTo9o8eTAzwrbgE+mz8z00t1EDfJh1EzStvrhcOuFb8Sgwgy0T7iJMkdn80uyZwXxc4wFAmH0TN925zPR035q/EJTjDQAEmYBZBBMB0TWLoKQDzJYgAqEoQAVCVIAKgKkEEQFWCCICqBBEAVQkiAKoSRABUJYgAqEoQAVCVIAKgKkEEQFWCCICqBBEAVQkiAKoSRABUJYgAqEoQAVCVIAKgKkEEQFWCCICqBBEAVQkiAKoSRABUJYgAqEoQAVCVIAKgKkEEQFWCCICqBBEAVQkiAKoSRABUJYgAqEoQAVCVIAKgKkEEQFWCCICqBBEAVQkiAKoSRABUJYgAqEoQAVCVIAKgKkEEQFWCCICqBBEAVQkiAKoSRABUJYgAqEoQAVCVIAKgKkEEQFWCCICqBBEAVQkiAKoSRABUJYgAqKdpmv8P7s8LT82k1gYAAAAASUVORK5CYII=",height:Ir,width:1.1*Ir,alt:""})})}),Object(M.jsx)("div",{className:oe.titleButton,onClick:function(t){te(t),e.map.keyInputUsers.add("contentForm"),w(!0)},onTouchStart:te,ref:ce,children:Object(M.jsx)(Bn.a,{})}),Object(M.jsx)(kr,Object(i.a)(Object(i.a)({open:P},e),{},{close:function(){w(!1),e.content.pinned&&k(!1),e.map.keyInputUsers.delete("contentForm"),e.updateAndSend(e.content)},anchorEl:se.current,anchorOrigin:{vertical:"top",horizontal:"right"}})),Object(M.jsx)("div",{className:oe.note,onClick:function(t){var n;te(t),null===(n=e.onShare)||void 0===n||n.call(null,t)},onTouchStart:te,children:"Share"}),e.content.pinned?void 0:Object(M.jsx)("div",{className:oe.close,onClick:function(t){var n;te(t),null===(n=e.onClose)||void 0===n||n.call(null,t)},onTouchStart:te,children:Object(M.jsx)(Nn.a,{})})]})})),Object(M.jsx)("div",{className:oe.content,ref:se,children:Object(M.jsx)(ur,Object(i.a)({},e))})]}));return Object(M.jsx)("div",{className:oe.container,style:{zIndex:e.content.zIndex},onContextMenu:function(e){e.stopPropagation(),e.preventDefault()},children:Object(M.jsx)(Hn.a,{className:oe.rndCls,enableResizing:ie?Mr:Dr,disableDragging:ie,ref:H,onResizeStart:function(e){$.dragCanceled=!1,e.stopPropagation(),e.preventDefault(),b(d),_(s.position)},onResize:function(t,n,i,r,a){if(t.stopPropagation(),t.preventDefault(),$.dragCanceled)ee();else{var o=(Object(E.j)(e.map.matrix)+Object(E.k)(e.map.matrix))/2,u=[r.width/o,r.height/o];"left"!==n&&"right"!==n||(u[1]=0),"top"!==n&&"bottom"!==n||(u[0]=0);var l=!1,d=[0,0];"left"!==n&&"topLeft"!==n&&"bottomLeft"!==n||(d[0]=-u[0],l=l||0!==u[0]),"top"!==n&&"topLeft"!==n&&"topRight"!==n||(d[1]=-u[1],l=l||0!==u[1]),l&&(s.position=Object(E.a)(O,d),c(Object.assign({},s)));var h=Object(E.a)(g,u);if(e.content.originalSize[0]){var f=e.content.originalSize[0]/e.content.originalSize[1];h[0]>f*h[1]&&(h[0]=f*h[1]),h[0]<f*h[1]&&(h[1]=h[0]/f)}p(h)}},onResizeStop:function(){$.dragCanceled||ne(),$.dragCanceled=!1},children:de})})},wr={"&:hover":{backgroundColor:"rosybrown"},"&:active":{backgroundColor:"firebrick"}},Nr=Object(ee.a)({container:function(e){var t=new DOMMatrix;return t.rotateSelf(0,0,e.pose.orientation),{display:e.props.hideAll?"none":"block",width:0,height:0,transform:t.toString(),position:"absolute"}},rndCls:function(e){return{borderRadius:e.showTitle?"0.5em 0.5em 0 0":"0 0 0 0",backgroundColor:e.props.content.noFrame?"rgba(0,0,0,0)":Jn.useTransparent?"rgba(200,200,200,0.5)":"rgba(200,200,200,1)",boxShadow:e.props.content.noFrame?void 0:Jn.useTransparent?"0.2em 0.2em 0.2em 0.2em rgba(0,0,0,0.4)":"0.2em 0.2em 0.2em 0.2em rgba(100,100,100,1)"}},rndContainer:function(e){return{width:"100%",height:"100%"}},dashed:function(e){return{width:"100%",height:"100%",borderWidth:3,borderStyle:"dashed",borderColor:"red",borderRadius:1}},titlePosition:function(e){return e.showTitle?{}:{width:0,heihgt:0,position:"absolute",top:0}},titleContainer:function(e){var t={display:"flex",width:e.size[0],overflow:"hidden",userSelect:"none",userDrag:"none"};return e.showTitle||(t.position="absolute",t.bottom=0),t},content:function(e){return{position:"absolute",top:(e.showTitle?Ir:0)-(e.editing?3:0),left:e.editing?-3:0,width:e.size[0],height:e.size[1],userDrag:"none",pointerEvents:(e.dragging,"auto"),borderWidth:3,borderColor:"yellow",borderStyle:e.editing?"solid":"none",cursor:(e.editing,"default"),opacity:e.props.content.opacity}},note:function(e){return e.showTitle?Object(i.a)({visibility:e.props.onShare?"visible":"hidden",whiteSpace:"pre",borderRadius:"0.5em 0 0 0"},wr):{visibility:"hidden"}},pin:function(e){return e.showTitle?Object(i.a)({display:e.props.onShare?"none":"block",height:Ir,whiteSpace:"pre",cursor:"default"},wr):{display:"none"}},titleButton:function(e){return e.showTitle?Object(i.a)({display:"block",height:Ir,whiteSpace:"pre",cursor:"default"},wr):{display:"none"}},edit:function(e){return e.showTitle?Object(i.a)({display:e.props.onShare||!Object(_n.g)(e.props.content)?"none":"block",height:Ir,whiteSpace:"pre",cursor:"default"},wr):{display:"none"}},type:function(e){return{display:e.showTitle?"block":"none",height:Ir}},close:function(e){return Object(i.a)({visibility:e.showTitle?"visible":"hidden",position:"absolute",right:0,margin:0,padding:0,height:Ir,borderRadius:"0 0.5em 0 0",cursor:"default"},wr)}}),Dr={bottom:!0,bottomLeft:!0,bottomRight:!0,left:!0,right:!0,top:!0,topLeft:!0,topRight:!0},Mr={bottom:!1,bottomLeft:!1,bottomRight:!1,left:!1,right:!1,top:!1,topLeft:!1,topRight:!1};Pr.displayName="RndContent";var Lr=function(e){return{onClose:function(t){Object(T.a)("RndContent onClose for ",e.content.id),t.stopPropagation(),e.map.keyInputUsers.delete(e.content.id),e.map.keyInputUsers.delete("contentForm"),e.contents.removeByLocal(e.content.id)},updateAndSend:function(t){e.contents.updateByLocal(Object.assign({},t))},updateOnly:function(t){e.contents.updateLocalOnly(Object.assign({},t))}}},xr=function(e){var t=e.map,n=Object(j.b)((function(){return e.contents.editing===e.content.id}));return Object(_n.f)(e.content)&&(n?t.keyInputUsers.add(e.content.id):t.keyInputUsers.delete(e.content.id)),Object(M.jsx)(Pr,Object(i.a)(Object(i.a)({},e),{},{autoHideTitle:!0},Lr(e)))};xr.displayName="SharedContent";var Fr=function(e){var t=on({height:e.lineHeight,fontSize:e.fontSize}),n=o.a.useState(!1),a=Object(r.a)(n,2),s=a[0],c=a[1],u=o.a.useRef(null),l=(e.lineHeight,e.content,Object(On.a)(e,["lineHeight","content"]));return Object(M.jsx)(j.a,{children:function(){var n,r,a=ar(e.content.type,e.fontSize),o=Object(E.o)(e.content.ownerName),d=e.contents.find(e.content.id);return(null===(n=e.content.color)||void 0===n?void 0:n.length)&&(o[0]=Object(E.E)(e.content.color)),(null===(r=e.content.textColor)||void 0===r?void 0:r.length)&&(o[1]=Object(E.E)(e.content.textColor)),Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)(Ve.a,{title:e.content.ownerName,placement:"right",children:Object(M.jsxs)("div",{className:t.line,style:{backgroundColor:o[0],color:o[1]},ref:u,onClick:function(){var t=T.b.find(e.content.id);if(t)e.map.focusOn(t);else{T.b.requestContent([e.content.id]);var n=Object(Ze.c)((function(){var t=T.b.find(e.content.id);t&&(e.map.focusOn(t),n())}))}},onContextMenu:function(){if(T.b.find(e.content.id))c(!0),e.map.keyInputUsers.add("contentForm");else{T.b.requestContent([e.content.id]);var t=Object(Ze.c)((function(){T.b.find(e.content.id)&&(c(!0),e.map.keyInputUsers.add("contentForm"),t())}))}},children:[a,e.content.name]})}),Object(M.jsx)(kr,Object(i.a)(Object(i.a)(Object(i.a)({},l),{},{contents:e.contents,content:d},Lr(e)),{},{open:s,close:function(){c(!1),e.map.keyInputUsers.delete("contentForm")},anchorEl:u.current,anchorOrigin:{vertical:"top",horizontal:"right"}}))]})}})},Ur=function(e){var t=e.contents,n=Object(j.b)((function(){var e=Array.from(t.roomContentsInfo.size?t.roomContentsInfo.values():t.all);return e.sort((function(e,t){var n=e.name.localeCompare(t.name);return 0===n&&(n=e.ownerName.localeCompare(t.ownerName)),0===n&&(n=e.type.localeCompare(t.type)),0===n&&(n=e.id.localeCompare(t.id)),n})),e})),r=on({height:e.lineHeight,fontSize:e.fontSize}),a=e.participants,o=n.map((function(n){return Object(M.jsx)(Fr,Object(i.a)(Object(i.a)({content:n},e),{},{participant:a.find(t.owner.get(n.id))}),n.id)})),s=Object(D.d)().t,c=Object(j.b)((function(){return Object(E.t)(ge.a.backgroundFill)?"white":"black"}));return Object(M.jsxs)("div",{className:r.container,children:[Object(M.jsx)("div",{className:r.title,style:{color:c},children:s("Contents")}),o]})};Ur.displayName="ContentList";var Vr=n(722),Br=n(181),Jr=n(124),Hr={fontSize:Object(Jr.j)()?"2em":"1em",height:Object(Jr.j)()?"2em":"1.5em"},zr={height:Object(Jr.j)()?"4em":"3em"},Gr={fontSize:(Object(Jr.j)(),"1em")},Kr={fontSize:Object(Jr.j)()?"2.5rem":"1rem"},Qr=function(e){var t=m().local,n=Object(a.useState)(),s=Object(r.a)(n,2),c=s[0],u=s[1],l=Object(a.useState)(!1),d=Object(r.a)(l,2),h=d[0],p=d[1],f=Object(a.useState)(!1),v=Object(r.a)(f,2),g=v[0],b=v[1],y=Object(D.d)().t;function S(n,i){"enter"!==i&&"backdropClick"!==i||(t.sendInformation(),t.saveInformationToStorage(!0)),e.close()}var O=function(e){"Enter"===e.key?S(0,"enter"):"Esc"!==e.key&&"Escape"!==e.key||t.loadInformationFromStorage()};function _(e){e.preventDefault(),u(null),t.information.avatarSrc=""}function C(e){e.preventDefault(),c&&Object(Br.b)(c).then((function(e){t.information.avatarSrc=e}))}var T=o.a.useRef(null),A=o.a.useRef(null),k=(e.close,Object(On.a)(e,["close"]));return Object(M.jsxs)($.a,Object(i.a)(Object(i.a)({},k),{},{onClose:S,children:[Object(M.jsx)(N.a,{children:Object(M.jsx)("span",{style:{fontSize:Object(Jr.j)()?"2.5em":"1em"},children:y("lsTitle")})}),Object(M.jsxs)(w.a,{children:[Object(M.jsx)(j.a,{children:function(){var e=t.getColorRGB(),n=t.getTextColorRGB(),r=Object(E.t)(e)?"white":"black",a=Object(E.t)(n)?"lightgray":"gray";return Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)(U.a,{label:y("YourName"),multiline:!1,value:t.information.name,style:zr,inputProps:{style:Hr,autoFocus:!0},InputLabelProps:{style:Gr},onChange:function(e){t.information.name=e.target.value},onKeyPress:O,fullWidth:!0}),Object(M.jsxs)(R.a,{mt:3,children:[Object(M.jsx)("div",{style:{fontSize:12},children:y("lsColor")}),Object(M.jsxs)(R.a,{ml:2,children:[Object(M.jsx)(I.a,{variant:"contained",style:{backgroundColor:Object(E.E)(e),color:r,textTransform:"none"},onClick:function(){p(!0)},ref:T,children:y("lsColorAvatar")}),Object(M.jsx)($.a,{open:h,onClose:function(){p(!1)},anchorEl:T.current,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:Object(M.jsx)(be.a,{color:{r:e[0],g:e[1],b:e[2]},disableAlpha:!0,onChange:function(e,n){n.preventDefault(),t.information.color=[e.rgb.r,e.rgb.g,e.rgb.b]}})}),Object(M.jsx)(I.a,{variant:"contained",style:{color:Object(E.E)(n),backgroundColor:a,marginLeft:15,textTransform:"none"},onClick:function(){b(!0)},ref:A,children:y("lsColorText")}),Object(M.jsx)($.a,{open:g,anchorOrigin:{vertical:"bottom",horizontal:"right"},onClose:function(){b(!1)},anchorEl:A.current,children:Object(M.jsx)(be.a,{color:{r:n[0],g:n[1],b:n[2]},onChange:function(e,n){n.preventDefault(),t.information.textColor=[e.rgb.r,e.rgb.g,e.rgb.b]}})}),Object(M.jsx)(I.a,{variant:"contained",style:{marginLeft:15,textTransform:"none"},onClick:function(){t.information.color=[],t.information.textColor=[]},children:y("lsAutoColor")})]})]}),Object(M.jsxs)(R.a,{mt:3,children:[Object(M.jsx)("div",{style:{fontSize:12},children:y("lsImage")}),Object(M.jsxs)(R.a,{mt:-1,ml:2,children:[Object(M.jsxs)("form",{onSubmit:C,style:{lineHeight:"2em",fontSize:Object(Jr.j)()?"2.5em":"1em"},children:[Object(M.jsx)("div",{style:{fontSize:12,marginTop:8},children:y("lsImageFile")}),t.information.avatarSrc?Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)("img",{src:t.information.avatarSrc,style:{height:"1.5em",verticalAlign:"middle"},alt:"avatar"}),Object(M.jsx)("input",{style:Kr,type:"submit",onClick:_,value:"\u2715"})," \xa0"]}):void 0,Object(M.jsx)("input",{style:Kr,type:"file",onChange:function(e){var t;u(null===(t=e.target.files)||void 0===t?void 0:t.item(0))}}),Object(M.jsx)("input",{style:Kr,type:"submit",value:"Upload"})]},"information"),Object(M.jsx)(U.a,{label:y("lsEmail"),multiline:!1,value:t.info.email,style:Object(i.a)(Object(i.a)({},zr),{},{marginTop:8}),inputProps:{style:Hr,autoFocus:!0},InputLabelProps:{style:Gr},onChange:function(e){return t.info.email=e.target.value},onKeyPress:O,fullWidth:!0})]})]}),Object(M.jsxs)(R.a,{mt:3,children:[Object(M.jsx)("div",{style:{fontSize:12},children:y("lsNotification")}),Object(M.jsxs)(R.a,{mt:-1,ml:2,children:[Object(M.jsx)(ye.a,{control:Object(M.jsx)(Vr.a,{color:"primary",checked:t.information.notifyCall,onChange:function(e){t.information.notifyCall=e.target.checked}}),label:y("lsNotifyCall")}),Object(M.jsx)(ye.a,{control:Object(M.jsx)(Vr.a,{color:"primary",checked:t.information.notifyTouch,onChange:function(e){t.information.notifyTouch=e.target.checked}}),label:y("lsNotifyTouch")}),Object(M.jsx)(ye.a,{control:Object(M.jsx)(Vr.a,{color:"primary",checked:t.information.notifyNear,onChange:function(e){t.information.notifyNear=e.target.checked}}),label:y("lsNotifyNear")}),Object(M.jsx)(ye.a,{control:Object(M.jsx)(Vr.a,{color:"primary",checked:t.information.notifyYarn,onChange:function(e){t.information.notifyYarn=e.target.checked}}),label:y("lsNotifyYarn")})]})]})]})}}),Object(M.jsxs)(R.a,{mt:4,mb:3,children:[Object(M.jsx)(I.a,{variant:"contained",color:"primary",style:{textTransform:"none"},onClick:function(){S(0,"enter")},children:y("btSave")}),Object(M.jsx)(I.a,{variant:"contained",color:"secondary",style:{marginLeft:15,textTransform:"none"},onClick:function(){t.loadInformationFromStorage()},children:y("btCancel")}),Object(M.jsx)(I.a,{variant:"contained",style:{marginLeft:15,textTransform:"none"},onClick:function(){e.map.focusOn(t)},children:y("ctFocus")})]})]})]}))},qr=function(e){var t,n,a=o.a.useState(""),s=Object(r.a)(a,2),c=s[0],u=s[1],l=o.a.useState(""),d=Object(r.a)(l,2),h=d[0],p=d[1];function f(t,n){e.close()}var m=Object.assign({},e);return delete m.close,Object(M.jsxs)($.a,Object(i.a)(Object(i.a)({},m),{},{onClose:f,children:[Object(M.jsx)(N.a,{children:null===(t=e.participant)||void 0===t?void 0:t.information.name}),Object(M.jsxs)(w.a,{children:[Object(M.jsx)(R.a,{mb:2,children:Object(M.jsx)(I.a,{variant:"contained",style:{textTransform:"none"},onClick:function(){var t;f(),null===(t=e.participant)||void 0===t||t.call()},children:Object(D.c)("rsCall")})}),Object(M.jsx)(R.a,{mb:2,children:Object(M.jsx)(I.a,{variant:"contained",style:{textTransform:"none"},onClick:function(){e.participant&&(C.a.yarnPhones.has(e.participant.id)?C.a.yarnPhones.delete(e.participant.id):C.a.yarnPhones.add(e.participant.id),f())},children:e.participant&&C.a.yarnPhones.has(e.participant.id)?Object(D.c)("rsCutYarnPhone"):Object(D.c)("rsConnectYarnPhone")})}),Object(M.jsx)(R.a,{mb:2,children:Object(M.jsx)(I.a,{variant:"contained",style:{textTransform:"none"},onClick:function(){e.participant&&(S.b.sendTo=e.participant.id,f())},children:Object(D.c)("rsChatTo",{name:null===(n=e.participant)||void 0===n?void 0:n.information.name})})}),Object(M.jsx)(R.a,{mb:2,children:Object(M.jsx)(I.a,{variant:"contained",style:{textTransform:"none"},onClick:function(){e.participant&&e.map.focusOn(e.participant)},children:Object(D.c)("ctFocus")})}),ge.a.passMatched&&Object(M.jsxs)(M.Fragment,{children:[Object(M.jsxs)(R.a,{mb:2,children:["To kick this user type 'kick' and enter. \u2009",Object(M.jsx)(U.a,{label:"kick",type:"text",style:{marginTop:-22},value:c,onChange:function(e){u(e.currentTarget.value)},onKeyPress:function(t){if("Enter"===t.key&&"kick"===c){if(!e.participant)return;me.b.conference.kickParticipant(e.participant.id),setTimeout((function(){me.b.conference.sendMessage(ve.b.KICK,"Kicked by administrator.",e.participant.id)}),5e3),e.close()}}})]}),Object(M.jsxs)(R.a,{mb:2,children:["Clear this user's contents.\u2009",Object(M.jsx)(U.a,{label:"clear",type:"text",style:{marginTop:-22},value:h,onChange:function(e){p(e.currentTarget.value)},onKeyPress:function(t){if("Enter"===t.key&&"clear"===h){if(!e.participant)return;var n=T.b.participants.get(e.participant.id);null===n||void 0===n||n.myContents.forEach((function(e){return T.b.removeByLocal(e.id)})),e.close()}}})]})]})]})]}))},Wr=n(650),Yr=n(652),Xr=function e(){Object(k.a)(this,e),this.address="",this.port=0,this.protocol=""},Zr=function e(){Object(k.a)(this,e),this.remotes=[]},$r=new function e(){Object(k.a)(this,e),this.sessions=[],this.open=!1,this.update=!1,this.interval=void 0,this.messageServer=""},ea=function(e){var t=Object(a.useState)(!1),n=Object(r.a)(t,2),o=n[0],s=n[1];$r.open=!0===e.open,$r.update=o,e.open?$r.interval||($r.interval=setInterval((function(){var e,t,n=null===(e=me.b.conference._jitsiConference)||void 0===e?void 0:e.room;if($r.open&&n){var i,r,a,o=null===(i=n.xmpp)||void 0===i||null===(r=i.connection)||void 0===r||null===(a=r.jingle)||void 0===a?void 0:a.sessions,c=Object.keys(o).length;for($r.sessions.splice(c);$r.sessions.length<c;)$r.sessions.push(new Zr);for(var u in o){var l,d,h=null===(l=o[u])||void 0===l||null===(d=l.peerconnection)||void 0===d?void 0:d.peerconnection;h&&h.getStats().then((function(e){var t=[];e.forEach((function(e,n){"candidate-pair"===e.type&&(e.bytesReceived>0||e.bytesSent>0)&&t.push(e)}));var n=t.map((function(e){return e.remoteCandidateId})),i=$r.sessions[$r.sessions.length-1];i.remotes=[],n.forEach((function(t){var n=new Xr,r=e.get(t);n.address=r.address,n.port=r.port,n.protocol=r.protocol,i.remotes.push(n)}))}))}s(!$r.update)}if((null===(t=me.b.conference.bmRelaySocket)||void 0===t?void 0:t.readyState)===WebSocket.OPEN)$r.messageServer=config.bmRelayServer;else{var p,f=null===(p=me.b.conference._jitsiConference)||void 0===p?void 0:p.room;$r.open&&f?$r.messageServer="bridge":$r.messageServer="prosody"}}),100),console.log("setInterval")):$r.interval&&(clearInterval($r.interval),$r.interval=void 0,console.log("clearInterval"));var c=e.close,u=Object(On.a)(e,["close"]);return Object(M.jsx)(Yr.a,Object(i.a)(Object(i.a)({},u),{},{children:Object(M.jsxs)(Wr.a,{style:{background:"rgba(255,255,255,0.6)",padding:"0.4em"},children:[Object(M.jsxs)("div",{style:{overflowY:"auto"},children:[Object(M.jsx)("strong",{children:"Servers"}),Object(M.jsx)("br",{}),0===$r.sessions.length?Object(M.jsx)("div",{children:"No WebRTC"}):$r.sessions.map((function(e,t){return Object(M.jsxs)("div",{children:["WebRTC: ",e.remotes.map((function(e,t){return Object(M.jsxs)("span",{children:[e.address," ",e.port,"/",e.protocol,Object(M.jsx)("br",{})]},t.toString())}))]},t)})),Object(M.jsxs)("div",{children:[" Message: ",$r.messageServer]})]}),Object(M.jsx)(I.a,{variant:"contained",color:"primary",style:{textTransform:"none",marginTop:"0.4em"},onClick:c,children:" Close "})]})}))},ta=function(e){var t=Object(j.b)((function(){return e.participant.information.name})),n=Object(j.b)((function(){return e.participant.information.avatarSrc})),a=Object(j.b)((function(){return Object(Ai.e)(e.participant.information)})),s=Object(j.b)((function(){return e.lineHeight})),c=on({height:e.lineHeight,fontSize:e.fontSize}),u=o.a.useState(!1),l=Object(r.a)(u,2),d=l[0],h=l[1],p=o.a.useRef(null);return Object(M.jsxs)(M.Fragment,{children:[Object(M.jsx)(Ve.a,{title:e.participant.id,placement:"right",children:Object(M.jsxs)("div",{className:c.outer,ref:p,onClick:function(){if(e.participant.physics.located)e.map.focusOn(e.participant);else{config.bmRelayServer&&me.b.conference.pushOrUpdateMessageViaRelay(ve.b.REQUEST_PARTICIPANT_STATES,[e.participant.id]);var t=Object(Ze.c)((function(){e.participant.physics.located&&(e.map.focusOn(e.participant),t())}))}},onContextMenu:function(){if(e.participant.physics.located)h(!0),e.map.keyInputUsers.add("participantList");else{config.bmRelayServer&&me.b.conference.pushOrUpdateMessageViaRelay(ve.b.REQUEST_PARTICIPANT_STATES,[e.participant.id]);var t=Object(Ze.c)((function(){e.participant.physics.located&&(h(!0),e.map.keyInputUsers.add("participantList"),t())}))}},children:[Object(M.jsx)(pn,{border:!0,colors:a,size:1.05*s,name:t,avatarSrc:n}),Object(M.jsx)("div",{className:c.line,style:{backgroundColor:a[0],color:a[1],width:"100%"},children:t})]})}),e.participant.id===e.participants.localId?Object(M.jsx)(Qr,{map:e.map,open:d,close:function(){h(!1),e.map.keyInputUsers.delete("participantList")},anchorEl:p.current,anchorOrigin:{vertical:"top",horizontal:"right"}}):Object(M.jsx)(qr,Object(i.a)(Object(i.a)({},e),{},{open:d,close:function(){h(!1),e.map.keyInputUsers.delete("participantList")},participant:e.participants.remote.get(e.participant.id),anchorEl:p.current,anchorOrigin:{vertical:"top",horizontal:"right"}}))]})},na=function(e){var t=o.a.useState(!1),n=Object(r.a)(t,2),a=n[0],s=n[1],c=e.participants,u=on({height:e.lineHeight,fontSize:e.fontSize}),l=e.localId,d=e.remoteIds,h=(e.lineHeight,e.fontSize,Object(On.a)(e,["localId","remoteIds","lineHeight","fontSize"])),p=Object(j.b)((function(){return Object(E.t)(ge.a.backgroundFill)?"white":"black"}));d.sort((function(e,t){var n=c.remote.get(e),i=c.remote.get(t),r=n.information.name.localeCompare(i.information.name,void 0,{sensitivity:"accent"});return 0===r&&(r=(n.information.avatarSrc||"").localeCompare(i.information.avatarSrc||"",void 0,{sensitivity:"accent"})),r}));var f=d.map((function(t){return Object(M.jsx)(ta,Object(i.a)({participant:c.remote.get(t)},e),t)})),m=Object(M.jsx)(ta,Object(i.a)({participant:c.local},e),l),v=o.a.useRef(null);return Object(M.jsxs)("div",{className:u.container,children:[Object(M.jsxs)("div",{className:u.title,style:{color:p},ref:v,onClick:function(){s(!0)},children:[(c.remote.size+1).toString()," in ",me.b.conference.name]}),Object(M.jsx)(ea,Object(i.a)(Object(i.a)({open:a,close:function(){s(!1)}},h),{},{anchorEl:v.current})),m,f]})};na.displayName="ParticipantList";var ia=o.a.memo((function(e){var t=Object(j.b)((function(){return e.participants.localId})),n=Object(j.b)((function(){return Array.from(e.participants.remote.keys())}));return Object(M.jsx)(na,Object(i.a)(Object(i.a)({},e),{},{localId:t,remoteIds:n}))})),ra={lineHeight:20,fontSize:16};var aa=Object.assign({},ra),oa=function(e){var t=an(),n=Object(a.useState)(1),o=Object(r.a)(n,2),s=o[0],c=o[1],u=Object(nn.a)({onClickCapture:function(){e.contents.setEditing("")},onPinch:function(e){var t=Object(r.a)(e.da,2),n=t[0],i=t[1],a=(e.origin,e.event,e.memo);if(void 0===a)return[n,i];var o=Object(r.a)(a,1)[0];return function(e){Object.assign(aa,ra),aa.fontSize*=e,aa.lineHeight*=e,c(e)}(function(e,t){var n=e*t;return n>4?4:n<.5?.5:n}(s,n>10?n/o:n<-10?o/n:1+(n-o)/10)),[n,i]}},{eventOptions:{passive:!1}});return Object(M.jsx)("div",Object(i.a)(Object(i.a)({},u()),{},{style:{backgroundColor:Object(E.E)(ge.a.backgroundLeftFill)},children:Object(M.jsxs)(A.a,{split:"horizontal",defaultSize:"80%",resizerClassName:t.resizerHorizontal,paneStyle:{overflowY:"auto",overflowX:"hidden",width:"100%"},children:[Object(M.jsxs)(A.a,{split:"horizontal",defaultSize:"50%",resizerClassName:t.resizerHorizontal,paneStyle:{overflowY:"auto",overflowX:"hidden",width:"100%"},children:[Object(M.jsx)(ia,Object(i.a)(Object(i.a)({},e),aa)),Object(M.jsx)(Ur,Object(i.a)(Object(i.a)({},e),aa))]}),Object(M.jsx)(Sn,Object(i.a)(Object(i.a)({},e),aa))]})}))};oa.displayName="LeftBar";var sa=Object(ee.a)({videoContainer:{height:"100%",width:"100%",backgroundColor:"none"},video:{marginLeft:"auto",marginRight:"auto",display:"block",width:"100%"}}),ca=function(e,t){e.srcObject=t,e.autoplay=!0},ua=function(e){var t=sa(),n=b(),i=Object(j.b)((function(){return n.tracks.mainStream})),s=Object(a.useRef)(null);Object(a.useEffect)((function(){s&&s.current&&ca(s.current,i||null)}),[i]);var c=Object(a.useState)(),u=Object(r.a)(c,2),l=u[0],h=u[1],p=Object(a.useRef)({});p.current.debugVideos=l;var f=Object(a.useRef)([]);if(e.showAllTracks){for(;f.current.length<(l?l.length:0);)f.current.push(o.a.createRef());f.current.forEach((function(e,t){e.current&&l&&t<l.length&&ca(e.current,l[t].stream)}))}Object(a.useEffect)((function(){if(e.showAllTracks){var t;(null===(t=p.current)||void 0===t?void 0:t.interval)&&(clearInterval(p.current.interval),p.current.interval=void 0),p.current.interval=setInterval((function(){var e=d.tpc;if(e&&e.peerconnection){var t=[],n=new Set(e.peerconnection.getLocalStreams()),i=new Set(e.peerconnection.getRemoteStreams());e.localTracks.forEach((function(i,r){var a=i.getOriginalStream(),o=n.delete(a);t.push({stream:a,label:"Local ssrc:".concat(e.getLocalSSRC(i),"\ntype:").concat(i.getType(),"\n")+"videoType:".concat(i.videoType,"\nmsid:").concat(null===a||void 0===a?void 0:a.id)+(o?"OK":" NOT in pc"),color:"blue"})}));var r,a=Object(ji.a)(n.values());try{for(a.s();!(r=a.n()).done;){var o=r.value;t.push({stream:o,label:"Local X msid:".concat(null===o||void 0===o?void 0:o.id),color:"red"})}}catch(m){a.e(m)}finally{a.f()}e.remoteTrackMaps.forEach((function(e){e.forEach((function(e,n){var r=e.getOriginalStream(),a=i.delete(r);t.push({stream:r,label:"Remote ssrc:".concat(e.getSSRC(),"\ntype:").concat(e.getType(),"\n")+"videoType:".concat(e.videoType,"\nmsid:").concat(null===r||void 0===r?void 0:r.id)+(a?"OK":" NOT in pc"),color:"red"})}))}));var s,c=Object(ji.a)(i.values());try{for(c.s();!(s=c.n()).done;){var u=s.value;t.push({stream:u,label:"Remote X msid:".concat(null===u||void 0===u?void 0:u.id),color:"blue"})}}catch(m){c.e(m)}finally{c.f()}var l=f.current.map((function(e){return!!e}));xt.a.isEqual(p.current.elementFlags,l)&&xt.a.isEqual(p.current.debugVideos,t)||(h(t),p.current.elementFlags=xt.a.cloneDeep(l))}}),1e3)}else{var n;(null===(n=p.current)||void 0===n?void 0:n.interval)&&(clearInterval(p.current.interval),p.current.interval=void 0)}}),[e.showAllTracks]);var m=e.showAllTracks&&l?l.map((function(e,t){return Object(M.jsxs)("div",{style:{display:"inline-block",position:"relative",verticalAlign:"top"},children:[Object(M.jsx)("video",{style:{width:300},ref:f.current[t]}),Object(M.jsx)("div",{style:{position:"absolute",left:0,top:0,color:e.color,whiteSpace:"pre-wrap"},children:e.label})]},t)})):void 0;return Object(M.jsxs)("div",{className:t.videoContainer,children:[Object(M.jsx)("video",{ref:s,className:t.video,style:{visibility:i?"visible":"hidden"}}),Object(M.jsx)("div",{style:{position:"absolute",left:0,top:0},children:m})]})};ua.displayName="MainScreen";var la=n(453),da=n.n(la);function ha(e,t){var n=e*t;return n>fa.maxScale?fa.maxScale/e:n<fa.minScale?fa.minScale/e:t}var pa=Object(ee.a)({root:{position:"absolute",width:"100%",height:"100%",top:0,left:0,userDrag:"none",userSelect:"none",overflow:"hidden"},center:{position:"absolute",margin:"auto",left:0,right:0,top:0,bottom:0,width:0,height:0},transform:function(e){return{position:"absolute",width:0,height:0,transform:e.matrix.toString()}}}),fa={minScale:.2,maxScale:5},ma=function e(){Object(k.a)(this,e),this.prebThirdPersonView=!1,this.mouseDown=!1,this.dragging=!1,this.upTime=0,this.downTime=0,this.downXpos=0,this.downYpos=0,this.upXpos=0,this.upYpos=0},va=function(e){var t=h(),n=Object(j.b)((function(){return t.matrix})),o=Object(a.useRef)(null),s=Object(a.useRef)(null);function c(){return t.offset}var u=m(),l=Object(j.b)((function(){return u.local.thirdPersonView})),d=Object(a.useRef)(new ma).current,p=Object(E.N)(n,u.local.pose.position);if(l!==d.prebThirdPersonView)if(d.prebThirdPersonView=l,l){var f=Object(E.C)(Object(E.i)(n));if(f){var v=S(-f,p);t.setCommittedMatrix(v)}}else{var g=u.local.pose.orientation,b=Object(E.C)(Object(E.i)(n));if(g+b){var y=S(-(g+b),p);t.setCommittedMatrix(y)}}function S(e,i){var r=(new DOMMatrix).rotateSelf(0,0,e),a=Object(E.O)(i,r,n);return t.setMatrix(a),a}var O=Object(nn.a)({onDragStart:function(e){var t=e.buttons,n=e.xy;document.body.focus(),d.dragging=!0,d.mouseDown=!0,1===t&&(d.downTime=(new Date).getSeconds(),d.downXpos=n[0],d.downYpos=n[1])},onDrag:function(e){var i=e.down,r=e.delta,a=e.xy,o=e.buttons;if((r[0]||r[1])&&(d.mouseDown=!1),d.dragging&&i&&s.current)if(l||2!==o){var h=Object(E.H)(n.inverse(),r),p=n.translate.apply(n,Object(Cn.a)(h));t.setMatrix(p)}else{var f=Object(E.N)(n,u.local.pose.position),m=Object(ki.a)(a,c()),v=Object(ki.p)(m,f),g=Object(ki.p)(v,r),b=Object(E.e)(v,g)/(Object(E.P)(v)*Object(E.P)(g)),y=Object(E.e)(Object(E.G)(v),r)>0?-1:1,O=Math.acos(b)*y;if(isNaN(O))return;var _=S(Object(E.C)(O),f);u.local.pose.orientation=-Object(E.C)(Object(E.i)(_))}},onDragEnd:function(i){var a=i.event,o=(i.currentTarget,i.delta,i.xy);i.buttons;d.mouseDown&&e.contents.setEditing(""),d.upXpos=o[0],d.upYpos=o[1],d.upTime=(new Date).getSeconds();var s=d.upTime-d.downTime;if(d.upXpos>=d.downXpos-20&&d.upXpos<=d.downXpos+20&&d.upYpos>=d.downYpos-20&&d.upYpos<=d.downYpos+20&&"DIV"===String(Object(null===a||void 0===a?void 0:a.target).tagName)&&s<2){var c,l=u.local,h=Array.from(u.remote.keys()).filter((function(e){return e!==u.localId})),p=Object(ji.a)(h.entries());try{for(p.s();!(c=p.n()).done;){var f,m,v=Object(r.a)(c.value,2),g=v[0],b=(v[1],Number(null===(f=u.remote.get(h[g]))||void 0===f?void 0:f.pose.position[0])),y=Number(null===(m=u.remote.get(h[g]))||void 0===m?void 0:m.pose.position[1]),E=Number(t.mouseOnMap[0]),S=Number(t.mouseOnMap[1]);if(E>=b-30&&E<=b+30&&S>=y-30&&S<=y+30)return}}catch(C){p.e(C)}finally{p.f()}var O=Object(ki.p)(t.mouseOnMap,l.pose.position);if(Object(ki.i)(O)>Ai.a/2){var _=Object(ki.g)(Object(ki.i)(O)/Object(ki.i)(O),O);l.pose.orientation=180*Math.atan2(_[0],-_[1])/Math.PI,l.pose.position=Object(ki.a)(l.pose.position,_),l.savePhysicsToStorage(!1)}}t.setCommittedMatrix(n),d.dragging=!1,d.mouseDown=!1},onPinch:function(e){var i=Object(r.a)(e.da,2),a=i[0],o=i[1],s=e.origin,d=(e.event,e.memo);if(void 0===d)return[a,o];var h=Object(r.a)(d,2),p=h[0],f=h[1],m=Object(ki.a)(s,c()),v=a>10?a/p:a<-10?p/a:1+(a-p)/10;v=ha(Object(E.j)(n),v);var g=l?(new DOMMatrix).scaleSelf(v,v,1):(new DOMMatrix).scaleSelf(v,v,1).rotateSelf(0,0,o-f),b=Object(E.O)(m,g,n);return t.setMatrix(b),l||(u.local.pose.orientation=-Object(E.C)(Object(E.i)(b))),[a,o]},onPinchEnd:function(){return t.setCommittedMatrix(n)},onWheel:function(e){var i=e.movement,r=(e.ctrlKey,e.event,Math.pow(1.2,i[1]/1e3));if(1!==(r=ha(Object(E.j)(n),r))){var a=n.scale.apply(n,[r,r,1].concat(Object(Cn.a)(Object(E.N)(n.inverse(),t.mouse))));t.setMatrix(a)}},onWheelEnd:function(){return t.setCommittedMatrix(n)},onMove:function(e){var n=e.xy;t.setMouse(n),u.local.mouse.position=Object.assign({},t.mouseOnMap)},onTouchStart:function(e){t.setMouse([e.touches[0].clientX,e.touches[0].clientY]),u.local.mouse.position=Object.assign({},t.mouseOnMap)}},{eventOptions:{passive:!1}});Object(a.useEffect)((function(){_()}),[]),Object(a.useEffect)((function(){function e(e){e.ctrlKey&&(window.visualViewport&&window.visualViewport.scale>1?e.deltaY<0&&e.preventDefault():e.preventDefault())}return window.document.body.addEventListener("wheel",e,{passive:!1}),function(){return window.document.body.removeEventListener("wheel",e)}}),[]);var _=Object(a.useRef)((function(){if(s.current){for(var e=s.current,n=0;e;)n+=e.offsetLeft,e=e.offsetParent;t.setScreenSize([s.current.clientWidth,s.current.clientHeight]),t.setLeft(n)}})).current,C=pa({matrix:n});return Object(M.jsxs)("div",Object(i.a)(Object(i.a)({className:C.root,ref:s},O()),{},{children:[Object(M.jsx)(da.a,{onResize:_}),Object(M.jsx)("div",{className:C.center,children:Object(M.jsx)("div",{id:"map-transform",className:C.transform,ref:o,children:e.children})})]}))};va.displayName="MapBase";var ga=n(63);var ba=function e(){Object(k.a)(this,e),this.timerId=void 0,this.event=void 0,this.keys=new Set,this.timerAgain=!1};var ya=Object(ee.a)({root:function(e){return{display:"flex",justifyContent:"center",alignItems:"center",width:e.size,height:e.size,clipPath:"circle(".concat(.5*(e.size||0),"px  at center)"),overflow:"hidden"}},videoLargerWidth:function(e){return{height:"100%",transform:"scale(".concat(e.mirror?-1:1,", 1)")}},videoLargerHeight:function(e){return{width:"100%",transform:"scale(".concat(e.mirror?-1:1,", 1)")}}}),Ea=function(e){var t=ya(e),n=Object(a.useRef)(null);return Object(a.useEffect)((function(){var i,r,a,o;null!==n&&null!==n.current&&(i=n.current,r=e.stream,a=t.videoLargerWidth,o=t.videoLargerHeight,i.srcObject=r,i.autoplay=!0,i.onloadedmetadata=function(){var e=i.width,t=i.height;void 0!==e&&void 0!==t?i.className=e>=t?a:o:(console.error("video stream width || height is undefined"),i.className=a)})}),[n,t.videoLargerWidth,t.videoLargerHeight,e.stream]),Object(M.jsx)("div",{className:t.root,style:e.style,children:Object(M.jsx)("video",{ref:n,style:e.style})})};Ea.defaultProps={size:100},Ea.displayName="StreamAvatar";var Sa=function(e){var t=e.name,n=e.avatarSrc,r=e.colors,a=e.stream,o=Object(On.a)(e,["name","avatarSrc","colors","stream"]);return void 0===a?Object(M.jsx)(pn,Object(i.a)({name:t,colors:r,avatarSrc:n},o)):Object(M.jsx)(Ea,Object(i.a)({stream:a},o))};Sa.displayName="ComposedAvatar";var Oa=function(e){var t=e.participant;return Object(M.jsx)(j.a,{children:function(){var n=t.getColor(),r=t.information,a={colors:n,avatarSrc:r.avatarSrc,name:r.name};return Object(M.jsx)(Sa,Object(i.a)(Object(i.a)({},a),{},{stream:t.showVideo?t.tracks.avatarStream:void 0,colors:n,size:e.size,style:{pointerEvents:"none"},mirror:e.isLocal}))}})},_a=function(e){return o.a.useMemo((function(){return Object(M.jsx)(Oa,Object(i.a)({},e))}),[e.size,e.participant.information.avatarSrc,e.participant.information.color,e.participant.information.name,e.participant.information.textColor])};_a.displayName="MemorizedAvatar";var Ca=12,Ta=.5,ja=Object(ee.a)({root:function(e){return{position:"absolute",left:e.position[0],top:e.position[1]}},pointerRotate:function(e){return{transform:"rotate(".concat(e.orientation,"deg)")}},pointer:function(e){return{position:"absolute",width:"".concat(Ca*e.size),left:"-".concat(Ca*e.size*Ta,"px"),top:"-".concat(Ca*e.size*Ta,"px"),pointerEvents:"none"}},avatar:function(e){return{position:"absolute",left:"-".concat(e.size*Ta,"px"),top:"-".concat(e.size*Ta,"px")}},icon:function(e){return{position:"absolute",width:.4*e.size,height:.4*e.size,left:.6*e.size,top:.6*e.size,pointerEvents:"none"}},iconProximity:function(e){return{position:"absolute",width:.6*e.size,height:.6*e.size,left:.7*e.size,top:.4*e.size,pointerEvents:"none"}},more:function(e){return{position:"absolute",width:.4*e.size,height:.4*e.size,left:.9*e.size,top:.3*-e.size}}}),Aa=function(e,t){var n=h(),a=e.participant,s=Object(j.b)((function(){return{position:a.pose.position,orientation:a.pose.orientation,mousePosition:a.mouse.position,awayFromKeyboard:a.awayFromKeyboard}})),c=Object(j.b)((function(){return a.information.name})),u=Object(j.b)((function(){return a.trackStates.micMuted?0:Math.pow(a.tracks.audioLevel,.5)})),l=Object(j.b)((function(){return a.trackStates.micMuted})),d=Object(j.b)((function(){return a.trackStates.speakerMuted})),p=Object(j.b)((function(){return a.trackStates.headphone})),f=Object(j.b)((function(){return a.physics.onStage})),m=ja(Object(i.a)(Object(i.a)({},s),{},{size:e.size})),v=a?a.getColor():["white","black"],g=Object(r.a)(v,2),b=g[0],y=g[1],E=e.size/2+2,S=e.isLocal,O=e.size*Ca*Ta,_=Ca*e.size*Ta,C=[.1,.2,.3,.4,.5,.6],T=C.map((function(t){return u>t?Object(M.jsxs)(o.a.Fragment,{children:[Object(M.jsx)("circle",{r:e.size*Ta+t*O,cy:_,cx:_,stroke:b,fill:"none",opacity:.4*(1-t),strokeDasharray:"4 4 4 24"}),Object(M.jsx)("circle",{r:e.size*Ta+t*O,cy:_,cx:_,stroke:"black",fill:"none",opacity:.4*(1-t),strokeDasharray:"4 32",strokeDashoffset:"-4"})]},t):void 0})),A=C.map((function(e){return u>e?Object(M.jsx)(o.a.Fragment,{children:Object(M.jsx)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGkAAABqCAYAAAC/Fn+UAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKMklEQVR4nO1dT2gXRxR+LXqwRg0IjYJiIpiL2ERrQT3EFuspBe2lhopVwVoqlSY9qIeKtelBPajFYmkrqJUWPRnBHEqVJjlUodYmFQ+N4B8U1IJgNNZDCpZvnbXr5r3Z3dmZ3d/mtx+E/Nt/v/nmvfnmzZu3Lzx58oRKVDZeLPmpfJQkFQAlSQVASVIBUJJUAJQkFQAlSQVASVIBUJJUAJQkFQAlSQXAuII/fy0RNauf69VXEP1EdF/93pPPI6ZHkUgCAa8rUvC11OAaQ4q4nsD3+zHOyxWVHgUHGeuIaCURzXJ0jwEiOkJEXUR03dE9UqESSapVxLQ7JEZCryLsSMb31aKSSII7+0xZzZScn+UGEe1XZOXuDiuBpFplNTvyfhAGQ+rZcrWsvElap3ps3pYThQFFVi4KMa95Ur36wIcLQBDQRES/qA5Vm/XN87Cklcp9FIEcDgPKA/RndcOsLQk98WSBCSJlVT2KqEyQlSXVKutZkdUHi4vum2fo9uO7NGfybFo6bXHS03cqReoUWZBUq3pek+sbJcW+y9/SiWunnp01bcLL9H7jamqd+WaSKx11bVWuSapYgh6OPKLlP73D/g9kdczdmMSynBLlckyqWIKAKw+uiv+78/hv2nrhC/rw3Da6/c/dOJdb63Iu5dKSegyDoIkAi+i+dcY7ZWndIpr+Ul3s09f0fURXHlzTHlMzbqJnVTFdYIcSR1bhiqQjqnc5xeCDq7Tlt06v5/sNenDJLmqcPDvWbUHwlgud9Me9S5HHts5YRtubP4lz2bdVsNYaXJC0Tk1SnQIEbfp1Gw3/++i527RMW0R7Fm5PdOuL9y7Rd4M/RJI1f+o879qTxk/UHTakllSszaNsk1SvHs7pPEgiiNSg37XMrI9AjkPxcdf1MWdyAx1cvDuKqIHAYmRq2BYOziMJOoJIDfqmwLhzctlhzxolYAzbdG6r5yo1aLI5f7JJUrtroYCe/l7fZm1PTwtYCFxa+9yN4pVAVOfA3qg77bBlTbZIqnU98wZBnQP7Ul0DVrjy7HpadLrVU3a4poS2hhV0cPEuT4xw6Ltz3nONEbCi9GyR5HS5AY2bliAgqASfWsM+j7TeO+fY4xdMneepRYkoRCukcxWW2pjk2iCp3qXc9segtICC48Yrf+IKKc6NM5DzOqI6+/dFjU+pPYwNkpy5OXz4zv69VsagGr0a89wXXOAgE4nQEYVn23/5G92lZ6W1prQkObUiDM5REYG4QENvaHxXezSsClYrEdUhiInuW2c9S9UgVUdOS5KzoCIsCL3bJjY0rvbEAOY6EmAZElGQ6Ig8cMBkWINZaoJrhLQktVttxUCoBr3TBSAGjrV85UlsaZzREdU+9wNvwhwGohUR1mTcodOQZD31Ch8S44JtC+IAiX2s5YBoVSAKajAsCjCPktxehDWtNc2PSEuSFXgSu38vbTq3LVXEICkQMUeIR3JheJZDTMNjnQlxvDBgTRFLG0ZtliZ2d19nSRc98//T+xlL05PG19D0CS9Tzfgaby3n4ciw9x3zDFviwMf5t7qf/YwOMDzySD2DrPDQSSQXi3FsQYgUfD50qjBWNawQLY2ITpkQZZqw3ywR5FuF7YY3Qbjhoe5WNaxkycJYg2fnnhtu7OvFu577G0jD2BS2fHQ6DUlG4sHU3Ym9AaGSSiAIDR62jEODP4pzIT9mx4kJSRS0zR7dDCCNu77CFJN4nilJ1sLwrtAnhGt0cyGMUW2z+YSm7ps/j/obVoI5SPdWSGxNY5akFk0SiU5iwx1y1gSrDCs9kMrJ8d/1UjwzS8p6S0piIEKwvalDOxfCmBUG3J5kTb4QCuJVQeVpEN6NGAkTkoxnzlkDEQLMhaRFPIyd3HJF6ww+6YRzYwumvsIeqxmXEq+5jfmNzXBJEARJwjmSG5PGMQ4xU8FiYUxbUhDI9OEaXlJjjVNGZxxxqnWOkJmky+tL2oZVVSIAKcQcOHktpYWFCY1ISLGCqiJJSnAcHhke9TdERvhj3eVXSKi6YhtcQJWTzHETLLNA1ZEkWUglo+pI4uYwnNXEVWc2VZyEqiJJyuzhZDQ2lrHHhhTi7QyWVqqKJG5tiFREOwzJQsKEPmREh22YkFTIQkrS8gnmTpy748QEJzqk+ZAUiVBI1IZFr9IVCS8tbEBOauHmTrAiboWYa3gp/BOVQpYEJiQVxpKidknAMri5k78pLQzOLQ4O8SRpJHxvzMd/BtMx6YbheZnBT02WCEJ0XNoUdlrIEQ9bkmRxXP5DAIkrgZmSlFmhCVNEpFd5S9xcbz9+7RTb8AjQhkNA0j245YsAErfdmCWJc02kLOj7lgOsm4NlHPqLV4CtM5eP+lvvXV7S6xYcTYYLU5LEPaEGBSucAFaCzJ0g8Ds2iUnjBZIyOfcI9xUmHYRyYkRSiwpDJh3cVN31qxuOyhhC0iEWzbBAJk0Ig8CH7b1z3snGMH/XeNyULimBhlOAkriI6KRGoiuNBO+SkvXRGEmqirSPPKIT17q8bB7biBMo1eXcYSwKWxFk/fGrp9jj2xq0lXmMdqWniThY2wYPUpFMj7FCyklwAVixt+NPIAiuC/l4YaBDSW4xoo5ELiQNpTh/FKI2bNkE5lBr+jaLLg7PsOe10eUAPHEhWLy0qKhw1LRUaNrYnfXqH66JgmxGORrdHIq85fYO1lV+LmwL5cRFCMZlbdKS5KSejpeO1dxh/bqwHuRv61Ku0Dl2L/yUFQCHNAU5IqzoRppITVqSrisztg40EvLmbAFuKmpzNMYgWDFHEJY5JDfHiYsQct3pRy73zEIh2iLqYYTER24eNpdxLu7pJgSeYFgeJy4CuJHW49iIgvvW5GTvrC/l05YIQONzuyCiattFVWDhxEUIFbH7nNS2TKtKLwhbFoUG9XPvnsrrjZ71mBKErTQRbq7XxrhtswAUiEpfEUODuFVRgpvI0txLt8wRsxrYfBtxTpuLfvvVviVn9YVsuT4dEE1AXQbdxmqsQ21viqx9t9NWINr2yuw616XUQBRWPTGQ2473QcHBenT7dhOUUrMmqGyTdF25PadFCTGGTF9Sx44XEQtuLOIWJYxJ0JDt+haFL+8ZJkqaiHKo5vKePjIplItJqr9skLQAe7UXyqVKLzkNK0SBQx3gOqVldgbOaoO7TOm6r/bhVCRRuoZPaD1U5OLtFCBqwPF9jBBeXgc5mKBiib1SCKLyhSL/v1Bk+oQ6L4Ek4aawMfNCkSAwqH6c5Q0dIdPXyJUvuUqOMf+SK1JziGaTdNsKwJe2q+fHQV5bX66rD7veZfTcImA9bygXl/krTfPen3REVQjZmfNzSBhSHak5z40K5cuAeZQvA45A+VrtEMoX1JcvqLeKeiU2mtWXSfDWT5jvCXzP3Z1FoUgkcagN1I+rZ8qU9QdIKOReXxoDJFUFqq7YRhFRklQAlCQVACVJBUBJUgFQklQAlCQVACVJBUBJUgFQklQAlCRVOojoPx4KiXBU4OpUAAAAAElFTkSuQmCC",className:m.iconProximity,alt:""})},e):void 0}));return Object(M.jsxs)("div",{className:m.root+" dragHandle",onContextMenu:e.onContextMenu,children:[Object(M.jsx)("div",{className:m.pointerRotate,children:Object(M.jsxs)("svg",{className:m.pointer,width:e.size*Ca,height:e.size*Ca,xmlns:"http://www.w3.org/2000/svg",children:[Object(M.jsx)("circle",{r:E,cy:_,cx:_,stroke:"none",fill:b}),T,"arrow"===config.avatar?Object(M.jsxs)("g",{transform:"translate(".concat(_," ").concat(_,") rotate(-135) "),children:[Object(M.jsx)("rect",{style:{pointerEvents:"fill"},height:E,width:E,fill:b}),S?Object(M.jsx)("path",{d:"M 0 ".concat(E," h ").concat(E," v ").concat(-E)+"a ".concat(E," ").concat(E," 0 1 0 ").concat(-E," ").concat(E),fill:"none",stroke:y}):void 0]}):Object(M.jsx)("g",{style:{pointerEvents:"fill"}})]})}),Object(M.jsx)("div",{className:m.avatar,style:{transform:"rotate(".concat(-n.rotation,"deg)")},children:Object(M.jsx)(Ve.a,{title:c,children:Object(M.jsxs)("div",{children:[Object(M.jsx)(_a,Object(i.a)({},e)),A,p?Object(M.jsx)(qt.a,{className:m.icon,htmlColor:"rgba(0, 0, 0, 0.3)"}):void 0,d?Object(M.jsx)(he.a,{className:m.icon,color:"secondary"}):l?Object(M.jsx)(re.a,{className:m.icon,color:"secondary"}):void 0,!l&&f?Object(M.jsx)(W.Icon,{className:m.icon,icon:q.a,color:"gold"}):void 0]})})})]})};Aa.displayName="RawParticipant";var ka=function(e){return o.a.useMemo((function(){return Object(M.jsx)(Aa,Object(i.a)({},e))}),[e.size,e.participant.id,e.participant.information.avatarSrc,e.participant.information.color,e.participant.information.name,e.participant.information.textColor])};ka.displayName="MemorizedParticipant";var Ra=180,Ia=360,Pa=.5,wa=Object(ee.a)({more:function(e){return{position:"absolute",width:.5*e.size,height:.5*e.size,left:e.position[0]+.4*e.size,top:e.position[1]-.8*e.size}}}),Na=function(e){var t=m(),n=t.local;Object(E.b)(e.participant.id===n.id);var s=Object(a.useRef)({}).current,c=function(){var i=e.map.toWindow(n.pose.position),a=[i[0],i[1]],o=.2,c=e.map.left+e.map.screenSize[0]*o,u=e.map.left+.8*e.map.screenSize[0],l=.8*e.map.screenSize[1],d=t.local.thirdPersonView?e.map.screenSize[1]*o:l;a[0]<c&&(a[0]=c),a[0]>u&&(a[0]=u),a[1]<d&&(a[1]=d),a[1]>l&&(a[1]=l);var h=Object(E.M)(i,a),p=Math.sqrt(h[0]*h[0]+h[1]*h[1]);p>600?h=Object(E.z)(600/p,h):p<100&&(h=Object(E.z)(100/p,h));var f=Object(E.z)(.1,e.map.rotateFromWindow(h));if(Math.abs(f[0])+Math.abs(f[1])>.2){var m=e.map.matrix.translate(-f[0],-f[1]),v=e.map.rotateFromWindow([m.e,m.f]),g=.5,b=!1;v[0]<-ga.b*g&&(v[0]=-ga.b*g,b=!0),v[0]>ga.b*g&&(v[0]=ga.b*g,b=!0),v[1]<-ga.b*g&&(v[1]=-ga.b*g,b=!0),v[1]>ga.b*g&&(v[1]=ga.b*g,b=!0);var y=e.map.rotateToWindow(v),S=Object(r.a)(y,2);return m.e=S[0],m.f=S[1],e.map.setMatrix(m),e.map.setCommittedMatrix(m),s.scrollAgain=!b,!b}return s.scrollAgain=!1,!1},u=function(i){!function(i){var r=Object(E.M)(i.xy,e.map.toWindow(n.pose.position)),a=Math.sqrt(r[0]*r[0]+r[1]*r[1]);if(a>50&&(r=Object(E.z)(50/a,r)),t.local.thirdPersonView){var o=e.map.rotateFromWindow(r);n.pose.position=Object(E.a)(n.pose.position,o),s.smoothedDelta||(s.smoothedDelta=[r[0],r[1]]),s.smoothedDelta=Object(E.a)(Object(E.z)(1-.8,o),Object(E.z)(.8,s.smoothedDelta));var c=Math.atan2(s.smoothedDelta[0],-s.smoothedDelta[1])*Ra/Math.PI-n.pose.orientation;c<-180&&(c+=Ia),c>Ra&&(c-=Ia),n.pose.orientation+=.2*c}else n.pose.position=Object(E.a)(e.map.rotateFromWindow(r),n.pose.position);n.savePhysicsToStorage(!1)}(i)},l=new Set(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","KeyQ","KeyW","KeyE","KeyA","KeyS","KeyD"]);!function(e,t,n,i,r){var o=Object(a.useRef)(new ba).current;function s(){var t;o.timerAgain||o.keys.size?(o.timerAgain||(null===(t=o.event)||void 0===t?void 0:t.target)===document.body)&&(o.timerAgain=e(o.keys)):o.timerId&&(clearInterval(o.timerId),o.timerId=void 0)}t||(t=33);var c=function(e){r&&!r()||(n&&!(null===n||void 0===n?void 0:n.has(e.code))||e.preventDefault(),i&&!(null===i||void 0===i?void 0:i.has(e.code))||e.stopPropagation(),o.event=e,o.keys.add(e.code),o.timerId||o.event.target!==document.body||(o.timerId=setInterval(s,t)))},u=function(e){r&&!r()||(n&&!(null===n||void 0===n?void 0:n.has(e.code))||e.preventDefault(),i&&!(null===i||void 0===i?void 0:i.has(e.code))||e.stopPropagation(),o.event=e,o.keys.delete(e.code))},l=function(){o.keys.clear()};Object(a.useEffect)((function(){return window.addEventListener("keydown",c),window.addEventListener("keyup",u),window.addEventListener("blur",l),function(){window.removeEventListener("keydown",c),window.removeEventListener("keyup",u),window.removeEventListener("blur",l)}}),[])}((function(i){var r=function(i){var r=0,a=0,o=!1;(i.has("ArrowUp")||i.has("KeyW"))&&(r=10,o=!0),(i.has("ArrowDown")||i.has("KeyS"))&&(r=-5,o=!0),(i.has("ArrowLeft")||i.has("KeyA")||i.has("KeyQ"))&&(a=-5,o=!0),(i.has("ArrowRight")||i.has("KeyD")||i.has("KeyE"))&&(a=5,o=!0),(i.has("ShiftLeft")||i.has("ShiftRight"))&&(a*=2,r*=2);var s=n.pose.orientation+a;if(s>Ra&&(s-=Ia),s<-180&&(s+=Ia),n.pose.orientation=s,!t.local.thirdPersonView){var c=Object(E.N)(e.map.matrix,t.local.pose.position),u=(new DOMMatrix).rotateSelf(0,0,-a),l=Object(E.O)(c,u,e.map.matrix);e.map.setMatrix(l),e.map.setCommittedMatrix(l)}var d=Object(E.I)(n.pose.orientation,[0,-r]),h=Object(E.a)(n.pose.position,d);return h[0]<-ga.b*Pa&&(h[0]=-ga.b*Pa),h[0]>ga.b*Pa&&(h[0]=ga.b*Pa),h[1]<-ga.b*Pa&&(h[1]=-ga.b*Pa),h[1]>ga.b*Pa&&(h[1]=ga.b*Pa),n.pose.position=h,n.savePhysicsToStorage(!1),o}(i);return!(!s.scrollAgain&&!r)&&c()}),33,l,l,(function(){return 0===e.map.keyInputUsers.size}));var d=function(e,t,n,i,r){var o=Object(a.useRef)(null),s=Object(a.useRef)({state:{}}).current,c=function(){s.state.dragging||s.timerAgain?n&&(s.timerAgain=n(s.state)):(clearInterval(s.timerId),s.timerId=0)};function u(e){e.preventDefault(),e.stopPropagation()}Object(a.useEffect)((function(){var e=o.current;return null===e||void 0===e||e.addEventListener("touchmove",u,{passive:!1}),function(){null===e||void 0===e||e.removeEventListener("touchmove",u)}}),[o.current]);var l={target:o,onMouseDown:function(e){e.stopPropagation()},onTouchStart:function(e){e.stopPropagation()},onPointerDown:function(e){e.stopPropagation(),s.state={dragging:!1,buttons:e.buttons,xy:[e.clientX,e.clientY],start:[e.clientX,e.clientY],startTime:Date.now(),event:e},1&e.buttons&&o.current&&(!t||function(e,t,n){for(var i=e;i&&i!==t;){if(i.attributes){var r=i.attributes.getNamedItem("class");if(r&&r.value.includes(n))return i}i=i.parentNode}return null}(e.target,o.current,t))&&(e.target.setPointerCapture(e.pointerId),s.timerId||(s.timerId=setInterval(c,i)),s.state.dragging=!0)},onPointerOut:function(e){e.stopPropagation(),Object.assign(s.state,{dragging:!1,buttons:e.buttons,xy:[e.clientX,e.clientY],event:e})},onPointerUp:function(e){l.onPointerOut(e)},onTouchEnd:function(e){e.stopPropagation();var t=Object(E.A)(Object(E.M)(s.state.xy,s.state.start)),n=Date.now()-s.state.startTime;t<5&&n>.5&&r&&r(e)},onPointerMove:function(t){var n;t.stopPropagation(),Object.assign(s.state,{dragging:!!(null===(n=s.state)||void 0===n?void 0:n.dragging),buttons:t.buttons,xy:[t.clientX,t.clientY],event:t}),s.state.dragging&&(1&t.buttons?e(s.state):s.state.dragging=!1)}};return l}(u,"dragHandle",(function(e){return e.dragging&&u(e),c()}),33,(function(){T(!0)}));Object(a.useEffect)((function(){var e;null===(e=d.target.current)||void 0===e||e.focus({preventScroll:!0})}));var h=Object(j.b)((function(){return{position:n.pose.position,size:e.size}})),p=n?n.getColor():["white","black"],f=Object(r.a)(p,1)[0],v=wa(h),g=o.a.useState(!1),b=Object(r.a)(g,2),y=b[0],S=b[1],O=o.a.useState(!1),_=Object(r.a)(O,2),C=_[0],T=_[1],A=Me(S,s);function k(){T(!0),e.map.keyInputUsers.add("LocalParticipantConfig")}var R=Object(a.useRef)(null);return Object(M.jsxs)("div",Object(i.a)(Object(i.a)(Object(i.a)({ref:d.target},d),A),{},{children:[Object(M.jsx)(ka,Object(i.a)(Object(i.a)({},e),{},{isLocal:!0,onContextMenu:function(e){e.preventDefault(),k()}})),Object(M.jsx)(Ue,Object(i.a)(Object(i.a)({show:y,className:v.more,htmlColor:f},A),{},{buttonRef:R,onClickMore:k})),Object(M.jsx)(Qr,{map:e.map,open:C,close:function(){T(!1),e.map.keyInputUsers.delete("LocalParticipantConfig")},anchorEl:R.current,anchorOrigin:{vertical:"top",horizontal:"left"},anchorReference:"anchorEl"})]}))},Da=function(e){return o.a.useMemo((function(){return Object(M.jsx)(Na,Object(i.a)({},e))}),[e.size,e.participant.id,e.participant.information.avatarSrc,e.participant.information.color,e.participant.information.name,e.participant.information.textColor])};Da.displayName="MemorizedLocalParticipant";var Ma=function(e){var t=m(),n=t.find(e.participantId),i=Object(j.b)((function(){return n.mouse.position})),a=Object(j.b)((function(){return n.information.name})),o=n.getColor(),s=Object(r.a)(o,1)[0];if(!i)return Object(M.jsx)("div",{});var c=e.participantId===t.localId,u=Object(M.jsx)("div",{style:{width:18,height:30,left:i[0],top:i[1],position:"absolute",pointerEvents:c?"none":"auto"},children:Object(M.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 60 100",children:Object(M.jsx)("polygon",{points:"32,100 53,92 36,57 60,56 0,0 0,81 16,65 32,100",stroke:"black",fill:s,strokeWidth:"6"})})});return c?u:Object(M.jsx)(Ve.a,{title:a,children:u})},La=Object(ee.a)({more:function(e){return{position:"absolute",width:.5*e.size,height:.5*e.size,left:e.position[0]+.4*e.size,top:e.position[1]-.8*e.size}}}),xa=function(e){var t=o.a.useRef({}).current,n=o.a.useState(!1),a=Object(r.a)(n,2),s=a[0],c=Me(a[1],t),u=o.a.useState(!1),l=Object(r.a)(u,2),d=l[0],h=l[1],p=e.participant.getColor(),f=Object(r.a)(p,1)[0],m=Object(j.b)((function(){return{position:e.participant.pose.position,size:e.size}})),v=La(m);function g(){e.map.keyInputUsers.add("remoteForm"),h(!0)}var b=o.a.useRef(null);return Object(M.jsxs)("div",Object(i.a)(Object(i.a)({},c),{},{onClick:function(t){return n=e.participant.id,void(d||(C.a.yarnPhones.has(n)?C.a.yarnPhones.delete(n):C.a.yarnPhones.add(n)));var n},onContextMenu:function(e){e.preventDefault(),g()},children:[Object(M.jsx)(ka,Object(i.a)(Object(i.a)({},e),{},{isLocal:!1})),Object(M.jsx)(Ue,Object(i.a)(Object(i.a)({show:s,className:v.more,htmlColor:f},c),{},{buttonRef:b,onClickMore:function(e){e.stopPropagation(),g()}})),Object(M.jsx)(qr,{open:d,close:function(){e.map.keyInputUsers.delete("remoteForm"),h(!1)},map:e.map,participant:e.participant,anchorEl:b.current,anchorOrigin:{vertical:"top",horizontal:"left"},anchorReference:"anchorEl"})]}))},Fa=function(e){var t=Math.min(e.start[0],e.end[0]),n=Math.min(e.start[1],e.end[1]),i=Math.abs(e.start[0]-e.end[0]),r=Math.abs(e.start[1]-e.end[1]);return Object(M.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",style:{position:"absolute",left:t,top:n,width:i,height:r,pointerEvents:"stroke"},viewBox:"0, 0, ".concat(i,", ").concat(r),onClick:function(){e.participants.yarnPhones.delete(e.remote)},children:Object(M.jsx)("line",{x1:e.start[0]-t,y1:e.start[1]-n,x2:e.end[0]-t,y2:e.end[1]-n,stroke:"black"})})},Ua=function(e){var t=m(),n=Object(j.b)((function(){return Array.from(t.remote.keys()).filter((function(e){return t.find(e).physics.located}))})),i=Object(j.b)((function(){return t.localId})),r=n.map((function(n){return Object(M.jsx)(xa,{map:e.map,participants:t,participant:t.remote.get(n),size:Ai.a},n)})),a=Object(M.jsx)(Da,{map:e.map,participants:t,participant:t.local,size:Ai.a},"local"),o=Object(j.b)((function(){return Array.from(t.yarnPhones).map((function(e){var n=t.local.pose.position,i=t.remote.get(e);if(i){var r=i.pose.position;return Object(M.jsx)(Fa,{start:n,end:r,participants:t,remote:e},e)}}))})),s=Object(j.b)((function(){return Array.from(t.remote.keys()).filter((function(e){return t.find(e).mouse.show}))})).map((function(e){return Object(M.jsx)(Ma,{participantId:e},"M_".concat(e))})),c=Object(j.b)((function(){return t.local.mouse.show}))?Object(M.jsx)(Ma,{participantId:i},"M_local"):void 0;return null!==y.a.testBot?Object(M.jsx)("div",{}):Object(M.jsxs)("div",{style:{position:"absolute",zIndex:32767},children:[o,r,a,s,c]})};Ua.displayName="ParticipantsLayer";var Va=function(e){var t=e.map;function n(e){var n;T.b.pasteEnabled&&0===t.keyInputUsers.size&&e.clipboardData&&(e.preventDefault(),(null===(n=e.clipboardData)||void 0===n?void 0:n.types.includes("Files"))?Array.from(n.items).forEach((function(e){var n=e.getAsFile();if("file"===e.kind&&n){var i=void 0;-1!==e.type.indexOf("image")?i=Qe.d:"application/pdf"===e.type&&(i=Qe.f),i&&i(n,t).then((function(e){e.name=n.name,T.b.shareContent(e)}))}})):(null===n||void 0===n?void 0:n.types.includes("text/plain"))?n.items[0].getAsString((function(e){var n=void 0;if(0===e.indexOf("http://")||0===e.indexOf("https://")){var i=new URL(e),r=e.slice(-4);Object(E.v)(i)?(n=Object(Qe.g)(e,t)).name="! recursive reference":".jpg"===r||".JPG"===r||"jpeg"===r||"JPEG"===r||".png"===r||".PNG"===r||".gif"===r||".GIF"===r||".svg"===r||".SVG"===r?Object(Qe.e)(e,t).then((function(e){e.name=i.pathname,T.b.shareContent(e)})):Object(Qe.c)(e,t).then((function(n){"iframe"===n.type&&((n=Object(Qe.g)(e,t)).name="".concat(i.host).concat(i.pathname).concat(i.search)),"youtube"===n.type?n.name="".concat(i.search.substring(1)):n.name="".concat(i.host).concat(i.pathname).concat(i.search),T.b.shareContent(n)}))}else(n=Object(Qe.g)(e,t)).name=e.substring(0,20);n&&T.b.shareContent(n)})):console.error("Unhandled content types=",null===n||void 0===n?void 0:n.types))}Object(a.useEffect)((function(){window.document.body.addEventListener("paste",(function(e){n(e)}),{passive:!1}),window.document.body.addEventListener("drop",(function(e){var t;(t=e).preventDefault(),t.stopPropagation()}),{passive:!1}),window.document.body.addEventListener("dragover",(function(e){var t;e.preventDefault(),e.stopPropagation(),(null===(t=e.dataTransfer)||void 0===t?void 0:t.dropEffect)&&(e.dataTransfer.dropEffect="copy")}),{passive:!1})}),[]);var r=Object(j.b)((function(){return T.b.pasted}));return Object(M.jsx)(Pr,Object(i.a)(Object(i.a)({},e),{},{hideAll:""===r.type,content:r,onShare:function(e){r.zorder=Math.floor(Date.now()/_n.c),r.pinned=!0,r.proximity=!0,T.b.addLocalContent(xt.a.cloneDeep(r)),T.b.setPasted(Object(Qe.b)())},onClose:function(e){T.b.setPasted(Object(Qe.b)()),e.stopPropagation()},updateAndSend:function(e){T.b.setPasted(e)},updateOnly:function(e){T.b.setPasted(e)}}))},Ba=Object(ee.a)({slContainer:{userDrag:"none",userSelect:"none"}}),Ja=o.a.memo((function(e){var t=Ba(),n=(e.transparent,Object(On.a)(e,["transparent"]));return Object(M.jsxs)("div",{className:t.slContainer,children:[Object(M.jsx)(j.a,{children:function(){var t=Array.from(e.contents.all),r=e.transparent?t.filter((function(e){return!Object(_n.h)(e)})):t;return Object(M.jsx)(M.Fragment,{children:r.map((function(e){return Object(M.jsx)(xr,Object(i.a)({content:e},n),e.id)}))})}}),Object(M.jsx)(Va,Object(i.a)({},n))]})}),(function(e,t){return xt.a.isEqual(e.contents.all,t.contents.all)&&e.transparent===t.transparent}));Ja.displayName="ShareLayer";var Ha=Object(ee.a)({img:function(e){if(e.transparent)return{display:"none"};var t=Object(E.E)(e.fill);return{position:"absolute",top:.5*-ga.b,left:.5*-ga.b,backgroundColor:t,height:ga.b,width:ga.b}},logo:function(e){return e.transparent?{display:"none"}:{position:"absolute",top:0,right:0,bottom:0,left:0,margin:"auto",height:"10em",userDrag:"none",userSelect:"none",pointerEvents:"none"}}}),za=function(e){var t=Object(i.a)({color:[0,0,0],fill:[0,0,0]},e);Object(j.b)((function(){t.color=ge.a.backgroundColor,t.fill=ge.a.backgroundFill}));var n=Ha(t);return Object(M.jsx)(j.a,{children:function(){return Object(M.jsx)("div",{className:n.img})}})};za.displayName="Background";var Ga=function(e){return Object(M.jsxs)(va,Object(i.a)(Object(i.a)({},e),{},{children:[Object(M.jsx)(za,{transparent:e.transparent}),Object(M.jsx)(Ja,Object(i.a)({},e)),Object(M.jsx)(Ua,Object(i.a)({},e))]}))};Ga.displayName="Map";var Ka=function(){var e=an(),t=rn(),n={map:_.a,participants:C.a,contents:T.b,chat:S.b},o=Object(a.useRef)(null),s=Object(a.useRef)(null),u=Object(a.useState)(!1),d=Object(r.a)(u,2),h=d[0],p=d[1],m=!1;return window.addEventListener("keydown",(function(e){"F3"===e.key&&!1===m&&(e.preventDefault(),m=!0,!0===h?p(!1):!1===h&&p(!0))}),{}),window.addEventListener("touchmove",(function(e){e.preventDefault()}),{passive:!1,capture:!1}),window.addEventListener("contextmenu",(function(e){e.preventDefault()}),{passive:!1,capture:!1}),window.onerror=function(e,t,n,i,r){return"Ping timeout"!==(null===r||void 0===r?void 0:r.message)&&"Strophe: Websocket error [object Event]"!==(null===r||void 0===r?void 0:r.message)||null!==e||null!==t||null!==n||null!==i?console.warn("Global handler: ".concat(e),t,n,i,r):(O.a.setType("connection"),null!==y.a.testBot&&window.location.reload()),!0},Object(M.jsx)(j.a,{children:function(){return Object(M.jsx)(f,{value:C.a,children:Object(M.jsx)(c,{value:S.b,children:Object(M.jsx)(g,{value:T.b,children:Object(M.jsx)(l,{value:_.a,children:Object(M.jsx)("div",{ref:o,className:t.back,children:Object(M.jsxs)(A.a,{pane2Style:!0===h?{display:"block",backgroundColor:"#FF00FF30"}:{display:"none",backgroundColor:"#FFF"},ref:s,className:t.fill,split:"vertical",resizerClassName:e.resizerVertical,minSize:0,defaultSize:!0===h?"85%":"100%",children:[Object(M.jsxs)(a.Fragment,{children:[Object(M.jsx)(ua,{showAllTracks:false}),Object(M.jsx)(j.a,{children:function(){return Object(M.jsx)(Ga,Object(i.a)({transparent:void 0!==T.b.tracks.mainStream||false},n))}}),Object(M.jsx)(tn,Object(i.a)(Object(i.a)({},n),{},{height:Object(E.w)()&&Object(E.u)()?100:void 0}))]}),Object(M.jsx)("div",{style:{display:!0===h?"block":"none"},children:Object(M.jsx)(oa,Object(i.a)({},n))})]})})})})})})}})};Ka.displayName="App";var Qa=Hi;var qa=function(){function e(t,n,i,r){Object(k.a)(this,e),this.disposers=[],this.disposers.push(Object(Ze.c)((function(){var e=null===i||void 0===i?void 0:i.getParticipantId(),a=e&&T.b.tracks.carrierMap.get(e),o=a?T.b.find(a):void 0,s=xt.a.clone(t.get().pose);if("user"===t.get().soundLocalizationBase&&(s.orientation=0),n&&!n.physics.located)r.updatePose(Object(E.d)({orientation:0,position:[ga.b,ga.b]}));else{var c=function(e,t,n){var i=xt.a.cloneDeep(t?t.pose:n?n.pose:{position:[0,0],orientation:0});if(n)e.position.forEach((function(t,r){if(e.position[r]>i.position[r]){var a=e.position[r]-i.position[r];i.position[r]+=Math.min(n.size[r],a>0?a:0)}}));else if(t&&C.a.yarnPhones.has(t.id)){var r=Object(E.M)(i.position,e.position),a=Object(E.A)(r);if(a>.5*Ai.a){var o=Object(E.z)(.5/a,r);i.position=Object(E.a)(e.position,o)}}return Object(E.q)(e,i)}(s,n,o),u=Object(E.d)(c);r.updatePose(u)}}))),this.disposers.push(Object(Ze.c)((function(){var e=n?n.tracks.audio:i;r.updateStream(null===e||void 0===e?void 0:e.getOriginalStream())}))),this.disposers.push(Object(Ze.c)((function(){return r.updatePannerConfig(Qa)}))),this.disposers.push(Object(Ze.c)((function(){return r.updateBroadcast(!!(null===n||void 0===n?void 0:n.physics.onStage))})))}return Object(ai.a)(e,[{key:"dispose",value:function(){var e,t=Object(ji.a)(this.disposers);try{for(t.s();!(e=t.n()).done;){(0,e.value)()}}catch(n){t.e(n)}finally{t.f()}}}]),e}(),Wa=n(122),Ya=function(){function e(){Object(k.a)(this,e),this.audioContext=new window.AudioContext,this.audioDestination=this.audioContext.createMediaStreamDestination(),this.audioElement=new Audio,this.playMode="Pause",this.nodes={},this.audioElement.srcObject=this.audioDestination.stream}return Object(ai.a)(e,[{key:"addSpeaker",value:function(e){return Object(E.b)(void 0===this.nodes[e]),this.nodes[e]=new Vi(this.audioContext,this.audioDestination,this.playMode,!this.audioOutputMuted),this.nodes[e]}},{key:"removeSpeaker",value:function(e){this.nodes[e].disconnect(),delete this.nodes[e]}},{key:"switchPlayMode",value:function(e,t){var n=this;if(Object(E.b)("Pause"!==e),"Pause"===this.playMode&&Object(Ze.c)((function(){var e=new Set(Wa.a.tracksToAccept[1].map((function(e){return e.endpointId})));for(var t in n.nodes)e.has(t)?n.nodes[t].setPlayMode(n.playMode):n.nodes[t].setPlayMode("Pause")})),e!==this.playMode||t!==this.audioOutputMuted){switch(this.playMode=e,e){case"Context":var i=setInterval((function(){O.a.type||("suspended"!==n.audioContext.state&&clearInterval(i),n.audioContext.resume(),n.audioElement.play())}),1e3);for(var r in this.nodes)this.nodes[r].setPlayMode(e);break;case"Element":for(var a in this.audioContext.suspend(),this.audioElement.pause(),this.nodes)this.nodes[a].setPlayMode(e);break;default:console.error("Unsupported play mode: ".concat(e))}this.audioOutputMuted=t}}},{key:"setAudioOutput",value:function(e){for(var t in Ri(this.audioElement,e),this.nodes)this.nodes[t].setAudioOutput(e)}},{key:"audioOutputMuted",get:function(){return!(this.audioDestination.stream.getTracks().length>0&&this.audioDestination.stream.getTracks()[0].enabled)},set:function(e){for(var t in this.nodes)this.nodes[t].updateAudibility(!e);this.audioDestination.stream.getTracks().forEach((function(t){t.enabled=!e}))}}]),e}(),Xa=new(function(){function e(){var t=this;Object(k.a)(this,e),this.manager=new Ya,this.connectedGroups={},this.participantsMemo=new Map,this.contentsMemo=new Map,this.onPopulationChange=function(){var e=new Map(C.a.remote),n=Object(E.f)(e,t.participantsMemo);Object(E.f)(t.participantsMemo,e).forEach(t.remove),n.forEach(t.add),t.participantsMemo=e},this.onScreenContentsChange=function(){var e=new Map(T.b.tracks.remoteContents),n=Object(E.f)(e,t.contentsMemo);Object(E.f)(t.contentsMemo,e).forEach(t.removeContent),n.forEach(t.addContent),t.contentsMemo=e},this.remove=function(e){var n=e.id;t.connectedGroups[n].dispose(),delete t.connectedGroups[n],t.manager.removeSpeaker(n)},this.add=function(e){var n=t.manager.addSpeaker(e.id);t.connectedGroups[e.id]=new qa(C.a.local_,e,void 0,n)},this.removeContent=function(e){var n=Array.from(e.values()).find((function(e){return"audio"===e.getType()}));if(n){var i=n.getParticipantId();i?(t.connectedGroups[i].dispose(),delete t.connectedGroups[i],t.manager.removeSpeaker(i)):console.error("removeContent: track does not have content id.",n)}},this.addContent=function(e){var n=Array.from(e.values()).find((function(e){return"audio"===e.getType()}));if(n){var i=n.getParticipantId();if(i){var r=t.manager.addSpeaker(i);t.connectedGroups[i]=new qa(C.a.local_,void 0,n,r)}else console.error("addContent: track does not have content id.",n)}},null===y.a.testBot&&(Object(Ze.c)(this.onPopulationChange),Object(Ze.c)(this.onScreenContentsChange),Object(Ze.c)((function(){var e=C.a.local.muteSpeaker||C.a.local.awayFromKeyboard;t.manager.switchPlayMode(C.a.local.useStereoAudio?"Context":"Element",e)})))}return Object(ai.a)(e,[{key:"setAudioOutput",value:function(e){this.manager.setAudioOutput(e)}}]),e}()),Za=n(137);Object(Ze.c)((function(){var e=C.a.local.devicePreference.audioInputDevice,t=C.a.local.muteAudio||C.a.local.awayFromKeyboard;if(C.a.localId&&!t&&null===y.a.testBot){var n=me.b.conference.getLocalMicTrack();if(n&&n.getDeviceId()===e)return;new Promise((function(e,t){var n=C.a.local.devicePreference.audioInputDevice;Xe.a.createLocalTracks({devices:["audio"],constraints:config.rtc.audioConstraints,micDeviceId:n}).then((function(t){me.b.conference.setLocalMicTrack(t[0]),e(t[0])})).catch(t)})).finally(Za.a)}else{me.b.conference.setLocalMicTrack(void 0).then((function(e){null===e||void 0===e||e.dispose(),C.a.local.tracks.audioLevel=0}))}})),Object(Ze.c)((function(){var e=C.a.local.devicePreference.audioOutputDevice;e&&Xa.setAudioOutput(e)}));Object(Ze.c)((function(){var e=C.a.local.devicePreference.videoInputDevice,t=C.a.local.muteVideo||C.a.local.awayFromKeyboard;if(C.a.localId&&!t&&null===y.a.testBot){var n=me.b.conference.getLocalCameraTrack();if(n&&n.getDeviceId()===e)return;new Promise((function(e,t){var n=C.a.local.devicePreference.videoInputDevice;Xe.a.createLocalTracks({devices:["video"],constraints:config.rtc.videoConstraints,cameraDeviceId:n}).then((function(t){me.b.conference.setLocalCameraTrack(t[0]),e(t[0])})).catch(t)})).finally(Za.a)}else{me.b.conference.setLocalCameraTrack(void 0).then((function(e){return null===e||void 0===e?void 0:e.dispose()}))}}));n(280);var $a=n(57),eo=n.n($a);function to(){}function no(){eo.a.render(Object(M.jsx)(Ka,{}),document.getElementById("root"))}Object(Ze.e)({enforceActions:"never"}),Object(D.a)().then((function(){var e=Object(E.D)(to)();e.then(Object(E.D)(no)),e.then(Object(E.D)(ro))}));var io="";function ro(){window.addEventListener("beforeunload",(function(e){if(io="".concat(io,"beforeunload called. ").concat(Date()," "),localStorage.setItem("log",io),!O.a.type&&(T.b.tracks.localMains.size||T.b.tracks.localContents.size))return io+="Ask user. ",e.preventDefault(),e.stopImmediatePropagation(),e.returnValue="",localStorage.setItem("log",io),e.returnValue;me.b.leaveConference(),me.b.disconnect().then((function(e){io+="Diconnected (".concat(e,"). "),localStorage.setItem("log",io)})).catch((function(e){io+="Failed to diconnected (".concat(e,"). "),localStorage.setItem("log",io)}))})),O.a.connectionStart(),me.b.init().then((function(){Object(Ze.j)((function(){return""===O.a.type}),(function(){var e=y.a.room||"_";me.b.joinConference(e)}))}))}}],[[647,1,2]]]);
//# sourceMappingURL=main.3cc1e568.chunk.js.map
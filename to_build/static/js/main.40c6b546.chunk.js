(this["webpackJsonpbinaural-meet"]=this["webpackJsonpbinaural-meet"]||[]).push([[0],[,,,,function(e,t,n){"use strict";n.d(t,"b",(function(){return i.a})),n.d(t,"t",(function(){return i.g})),n.d(t,"L",(function(){return i.k})),n.d(t,"f",(function(){return i.c})),n.d(t,"g",(function(){return i.d})),n.d(t,"s",(function(){return i.f})),n.d(t,"h",(function(){return i.e})),n.d(t,"y",(function(){return i.j})),n.d(t,"w",(function(){return i.h})),n.d(t,"x",(function(){return i.i})),n.d(t,"c",(function(){return i.b})),n.d(t,"j",(function(){return r})),n.d(t,"k",(function(){return a})),n.d(t,"i",(function(){return s})),n.d(t,"Q",(function(){return c})),n.d(t,"P",(function(){return u})),n.d(t,"J",(function(){return l})),n.d(t,"a",(function(){return d.a})),n.d(t,"O",(function(){return d.r})),n.d(t,"A",(function(){return d.h})),n.d(t,"B",(function(){return d.i})),n.d(t,"C",(function(){return d.k})),n.d(t,"E",(function(){return d.m})),n.d(t,"r",(function(){return d.e})),n.d(t,"d",(function(){return d.b})),n.d(t,"K",(function(){return d.o})),n.d(t,"e",(function(){return d.c})),n.d(t,"R",(function(){return d.s})),n.d(t,"I",(function(){return d.n})),n.d(t,"q",(function(){return d.d})),n.d(t,"u",(function(){return d.f})),n.d(t,"D",(function(){return d.l})),n.d(t,"z",(function(){return d.g})),n.d(t,"N",(function(){return d.q})),n.d(t,"M",(function(){return d.p})),n.d(t,"F",(function(){return h})),n.d(t,"p",(function(){return p.d})),n.d(t,"m",(function(){return p.b})),n.d(t,"v",(function(){return p.e})),n.d(t,"l",(function(){return p.a})),n.d(t,"G",(function(){return p.f})),n.d(t,"o",(function(){return p.c})),n.d(t,"H",(function(){return p.g})),n.d(t,"n",(function(){return f}));var i=n(123),o=n(69);function r(e){return Math.abs(Math.sign(e.a)*Math.sqrt(Math.pow(e.a,2)+Math.pow(e.c,2)))}function a(e){return Math.abs(Math.sign(e.d)*Math.sqrt(Math.pow(e.b,2)+Math.pow(e.d,2)))}function s(e){return Math.atan2(-e.c,e.a)}function c(e,t,n){var i,r=(new DOMMatrix).translate(-e[0],-e[1]),a=(i=new DOMMatrix).translateSelf.apply(i,Object(o.a)(e));return[a,t,r,n].reduce((function(e,t){return e.multiplySelf(t)}),new DOMMatrix)}function u(e,t){return[e.a*t[0]+e.c*t[1]+e.e,e.b*t[0]+e.d*t[1]+e.f]}function l(e,t){return[e.a*t[0]+e.c*t[1],e.b*t[0]+e.d*t[1]]}var d=n(91);function h(e){return function(){return new Promise((function(t,n){try{e(),t()}catch(i){throw n(i),i}}))}}var p=n(128);function f(e){return new Promise((function(t,n){var i=new XMLHttpRequest;i.timeout=5e3,i.open("GET",e),i.onreadystatechange=function(){if(this.readyState===this.LOADING){var e=this.getResponseHeader("Content-Type");this.abort(),t(e)}},i.send()}))}},,,,,function(e,t){e.exports={ADD_ICE_CANDIDATE_FAILED:"xmpp.add_ice_candidate_failed",AUDIO_MUTED_BY_FOCUS:"xmpp.audio_muted_by_focus",VIDEO_MUTED_BY_FOCUS:"xmpp.video_muted_by_focus",AUTHENTICATION_REQUIRED:"xmpp.authentication_required",BRIDGE_DOWN:"xmpp.bridge_down",CALL_ACCEPTED:"xmpp.callaccepted.jingle",CALL_INCOMING:"xmpp.callincoming.jingle",CALL_ENDED:"xmpp.callended.jingle",CHAT_ERROR_RECEIVED:"xmpp.chat_error_received",CONFERENCE_PROPERTIES_CHANGED:"xmpp.conference_properties_changed",CONNECTION_ESTABLISHED:"xmpp.connection.connected",CONNECTION_FAILED:"xmpp.connection.failed",CONNECTION_INTERRUPTED:"xmpp.connection.interrupted",CONNECTION_RESTORED:"xmpp.connection.restored",CONNECTION_ICE_FAILED:"xmpp.connection.ice.failed",CONNECTION_RESTARTED:"xmpp.connection.restart",CONNECTION_STATUS_CHANGED:"xmpp.connection.status.changed",DISPLAY_NAME_CHANGED:"xmpp.display_name_changed",EMUC_ROOM_ADDED:"xmpp.emuc_room_added",EMUC_ROOM_REMOVED:"xmpp.emuc_room_removed",ETHERPAD:"xmpp.etherpad",FOCUS_DISCONNECTED:"xmpp.focus_disconnected",FOCUS_LEFT:"xmpp.focus_left",GRACEFUL_SHUTDOWN:"xmpp.graceful_shutdown",ICE_RESTARTING:"rtc.ice_restarting",ICE_RESTART_SUCCESS:"rtc.ice_restart_success",KICKED:"xmpp.kicked",LOCAL_ROLE_CHANGED:"xmpp.localrole_changed",MEETING_ID_SET:"xmpp.meeting_id_set",MESSAGE_RECEIVED:"xmpp.message_received",INVITE_MESSAGE_RECEIVED:"xmpp.invite_message_received",PRIVATE_MESSAGE_RECEIVED:"xmpp.private_message_received",MUC_MEMBER_BOT_TYPE_CHANGED:"xmpp.muc_member_bot_type_changed",MUC_DESTROYED:"xmpp.muc_destroyed",MUC_JOINED:"xmpp.muc_joined",MUC_MEMBER_JOINED:"xmpp.muc_member_joined",MUC_MEMBER_LEFT:"xmpp.muc_member_left",MUC_LOBBY_MEMBER_JOINED:"xmpp.muc_lobby_member_joined",MUC_LOBBY_MEMBER_UPDATED:"xmpp.muc_lobby_member_updated",MUC_LOBBY_MEMBER_LEFT:"xmpp.muc_lobby_member_left",MUC_DENIED_ACCESS:"xmpp.muc_denied access",MUC_LEFT:"xmpp.muc_left",MUC_ROLE_CHANGED:"xmpp.muc_role_changed",MUC_LOCK_CHANGED:"xmpp.muc_lock_changed",MUC_MEMBERS_ONLY_CHANGED:"xmpp.muc_members_only_changed",PARTICIPANT_AUDIO_MUTED:"xmpp.audio_muted",PARTICIPANT_VIDEO_MUTED:"xmpp.video_muted",PARTICIPANT_VIDEO_TYPE_CHANGED:"xmpp.video_type",PARTICIPANT_FEATURES_CHANGED:"xmpp.participant_features_changed",PASSWORD_REQUIRED:"xmpp.password_required",PHONE_NUMBER_CHANGED:"conference.phoneNumberChanged",PRESENCE_RECEIVED:"xmpp.presence_received",PRESENCE_STATUS:"xmpp.presence_status",PROMPT_FOR_LOGIN:"xmpp.prompt_for_login",READY_TO_JOIN:"xmpp.ready_to_join",RECORDER_STATE_CHANGED:"xmpp.recorderStateChanged",REMOTE_STATS:"xmpp.remote_stats",RENEGOTIATION_FAILED:"xmpp.renegotiation_failed",RESERVATION_ERROR:"xmpp.room_reservation_error",ROOM_CONNECT_ERROR:"xmpp.room_connect_error",ROOM_CONNECT_NOT_ALLOWED_ERROR:"xmpp.room_connect_error.not_allowed",ROOM_JOIN_ERROR:"xmpp.room_join_error",ROOM_CONNECT_MEMBERS_ONLY_ERROR:"xmpp.room_connect_error.members_only",ROOM_MAX_USERS_ERROR:"xmpp.room_max_users_error",SENDING_CHAT_MESSAGE:"xmpp.sending_chat_message",SENDING_PRIVATE_CHAT_MESSAGE:"xmpp.sending_private_chat_message",SESSION_ACCEPT_TIMEOUT:"xmpp.session_accept_timeout",SPEAKER_STATS_RECEIVED:"xmpp.speaker_stats_received",CONFERENCE_TIMESTAMP_RECEIVED:"xmpp.conference_timestamp_received",AV_MODERATION_APPROVED:"xmpp.av_moderation.approved",AV_MODERATION_RECEIVED:"xmpp.av_moderation.received",AV_MODERATION_CHANGED:"xmpp.av_moderation.changed",AV_MODERATION_PARTICIPANT_APPROVED:"xmpp.av_moderation.participant.approved",START_MUTED_FROM_FOCUS:"xmpp.start_muted_from_focus",SUBJECT_CHANGED:"xmpp.subject_changed",SUSPEND_DETECTED:"xmpp.suspend_detected",TRANSCRIPTION_STATUS_CHANGED:"xmpp.transcription_status_changed",TRANSPORT_INFO:"xmpp.transportinfo.jingle",VIDEO_SIP_GW_AVAILABILITY_CHANGED:"xmpp.videoSIPGWAvailabilityChanged",VIDEO_SIP_GW_SESSION_STATE_CHANGED:"xmpp.videoSIPGWSessionStateChanged",ICE_CONNECTION_STATE_CHANGED:"xmpp.ice_connection_state_changed",JSON_MESSAGE_RECEIVED:"xmmp.json_message_received"}},function(e,t,n){"use strict";n.r(t),n.d(t,"AUDIO_INPUT_STATE_CHANGE",(function(){return i})),n.d(t,"AUTH_STATUS_CHANGED",(function(){return o})),n.d(t,"BEFORE_STATISTICS_DISPOSED",(function(){return r})),n.d(t,"CONFERENCE_ERROR",(function(){return a})),n.d(t,"CONFERENCE_FAILED",(function(){return s})),n.d(t,"CONFERENCE_JOINED",(function(){return c})),n.d(t,"CONFERENCE_LEFT",(function(){return u})),n.d(t,"CONFERENCE_UNIQUE_ID_SET",(function(){return l})),n.d(t,"CONNECTION_ESTABLISHED",(function(){return d})),n.d(t,"CONNECTION_INTERRUPTED",(function(){return h})),n.d(t,"CONNECTION_RESTORED",(function(){return p})),n.d(t,"DATA_CHANNEL_OPENED",(function(){return f})),n.d(t,"DISPLAY_NAME_CHANGED",(function(){return m})),n.d(t,"DOMINANT_SPEAKER_CHANGED",(function(){return v})),n.d(t,"CONFERENCE_CREATED_TIMESTAMP",(function(){return g})),n.d(t,"DTMF_SUPPORT_CHANGED",(function(){return b})),n.d(t,"ENDPOINT_MESSAGE_RECEIVED",(function(){return y})),n.d(t,"ENDPOINT_STATS_RECEIVED",(function(){return A})),n.d(t,"JVB121_STATUS",(function(){return E})),n.d(t,"KICKED",(function(){return O})),n.d(t,"PARTICIPANT_KICKED",(function(){return S})),n.d(t,"LAST_N_ENDPOINTS_CHANGED",(function(){return C})),n.d(t,"LOCK_STATE_CHANGED",(function(){return _})),n.d(t,"SERVER_REGION_CHANGED",(function(){return j})),n.d(t,"_MEDIA_SESSION_STARTED",(function(){return T})),n.d(t,"_MEDIA_SESSION_ACTIVE_CHANGED",(function(){return k})),n.d(t,"MEMBERS_ONLY_CHANGED",(function(){return I})),n.d(t,"MESSAGE_RECEIVED",(function(){return R})),n.d(t,"NO_AUDIO_INPUT",(function(){return w})),n.d(t,"NOISY_MIC",(function(){return D})),n.d(t,"PRIVATE_MESSAGE_RECEIVED",(function(){return N})),n.d(t,"PARTICIPANT_CONN_STATUS_CHANGED",(function(){return P})),n.d(t,"PARTCIPANT_FEATURES_CHANGED",(function(){return M})),n.d(t,"PARTICIPANT_PROPERTY_CHANGED",(function(){return L})),n.d(t,"P2P_STATUS",(function(){return x})),n.d(t,"PHONE_NUMBER_CHANGED",(function(){return F})),n.d(t,"PROPERTIES_CHANGED",(function(){return B})),n.d(t,"RECORDER_STATE_CHANGED",(function(){return U})),n.d(t,"VIDEO_SIP_GW_AVAILABILITY_CHANGED",(function(){return V})),n.d(t,"VIDEO_SIP_GW_SESSION_STATE_CHANGED",(function(){return J})),n.d(t,"START_MUTED_POLICY_CHANGED",(function(){return G})),n.d(t,"STARTED_MUTED",(function(){return H})),n.d(t,"SUBJECT_CHANGED",(function(){return z})),n.d(t,"SUSPEND_DETECTED",(function(){return Q})),n.d(t,"TALK_WHILE_MUTED",(function(){return K})),n.d(t,"TRACK_ADDED",(function(){return Y})),n.d(t,"TRACK_AUDIO_LEVEL_CHANGED",(function(){return W})),n.d(t,"TRACK_MUTE_CHANGED",(function(){return q})),n.d(t,"TRACK_REMOVED",(function(){return X})),n.d(t,"TRANSCRIPTION_STATUS_CHANGED",(function(){return Z})),n.d(t,"USER_JOINED",(function(){return $})),n.d(t,"USER_LEFT",(function(){return ee})),n.d(t,"USER_ROLE_CHANGED",(function(){return te})),n.d(t,"USER_STATUS_CHANGED",(function(){return ne})),n.d(t,"BOT_TYPE_CHANGED",(function(){return ie})),n.d(t,"LOBBY_USER_JOINED",(function(){return oe})),n.d(t,"LOBBY_USER_UPDATED",(function(){return re})),n.d(t,"LOBBY_USER_LEFT",(function(){return ae})),n.d(t,"AV_MODERATION_APPROVED",(function(){return se})),n.d(t,"AV_MODERATION_CHANGED",(function(){return ce})),n.d(t,"AV_MODERATION_PARTICIPANT_APPROVED",(function(){return ue}));var i="conference.audio_input_state_changed",o="conference.auth_status_changed",r="conference.beforeStatisticsDisposed",a="conference.error",s="conference.failed",c="conference.joined",u="conference.left",l="conference.unique_id_set",d="conference.connectionEstablished",h="conference.connectionInterrupted",p="conference.connectionRestored",f="conference.dataChannelOpened",m="conference.displayNameChanged",v="conference.dominantSpeaker",g="conference.createdTimestamp",b="conference.dtmfSupportChanged",y="conference.endpoint_message_received",A="conference.endpoint_stats_received",E="conference.jvb121Status",O="conference.kicked",S="conference.participant_kicked",C="conference.lastNEndpointsChanged",_="conference.lock_state_changed",j="conference.server_region_changed",T="conference.media_session.started",k="conference.media_session.active_changed",I="conference.membersOnlyChanged",R="conference.messageReceived",w="conference.no_audio_input",D="conference.noisy_mic",N="conference.privateMessageReceived",P="conference.participant_conn_status_changed",M="conference.partcipant_features_changed",L="conference.participant_property_changed",x="conference.p2pStatus",F="conference.phoneNumberChanged",B="conference.propertiesChanged",U="conference.recorderStateChanged",V="conference.videoSIPGWAvailabilityChanged",J="conference.videoSIPGWSessionStateChanged",G="conference.start_muted_policy_changed",H="conference.started_muted",z="conference.subjectChanged",Q="conference.suspendDetected",K="conference.talk_while_muted",Y="conference.trackAdded",W="conference.audioLevelsChanged",q="conference.trackMuteChanged",X="conference.trackRemoved",Z="conference.transcriptionStatusChanged",$="conference.userJoined",ee="conference.userLeft",te="conference.roleChanged",ne="conference.statusChanged",ie="conference.bot_type_changed",oe="conference.lobby.userJoined",re="conference.lobby.userUpdated",ae="conference.lobby.userLeft",se="conference.av_moderation.approved",ce="conference.av_moderation.changed",ue="conference.av_moderation.participant.approved"},,function(e,t,n){"use strict";var i,o,r,a,s,c,u,l,h,p,f,m,v,g,b,y,A,E,O,S,C,_,j,T,k,I,R,w,D,N,P,M,L,x,F,B,U,V=n(21),J=n(6),G=n(8),H=n(11),z=(n(81),n(54)),Q=n(3),K=n(66),Y=n(25),W=n(35),q=n(34),X=n(60),Z=n(4),$=n(334),ee=n.n($),te=(i=function e(){Object(J.a)(this,e),Object(V.a)(this,"audioInputDevice",o,this),Object(V.a)(this,"videoInputDevice",r,this),Object(V.a)(this,"audioOutputDevice",a,this),Object(Q.g)(this)},o=Object(H.a)(i.prototype,"audioInputDevice",[Q.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),r=Object(H.a)(i.prototype,"videoInputDevice",[Q.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),a=Object(H.a)(i.prototype,"audioOutputDevice",[Q.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),i),ne=n(124),ie=(s=Q.h.shallow,c=Q.h.ref,u=Q.h.ref,l=Q.b.bound,h=Q.b.bound,p=Q.b.bound,f=function(e){Object(W.a)(n,e);var t=Object(q.a)(n);function n(){var e;return Object(J.a)(this,n),(e=t.call(this,!0)).devicePreference=new te,Object(V.a)(e,"tracks",m,Object(Y.a)(e)),Object(V.a)(e,"useStereoAudio",v,Object(Y.a)(e)),Object(V.a)(e,"thirdPersonView",g,Object(Y.a)(e)),Object(V.a)(e,"soundLocalizationBase",b,Object(Y.a)(e)),Object(V.a)(e,"zone",y,Object(Y.a)(e)),Object(V.a)(e,"remoteVideoLimit",A,Object(Y.a)(e)),Object(V.a)(e,"remoteAudioLimit",E,Object(Y.a)(e)),Object(V.a)(e,"audioInputDevice",O,Object(Y.a)(e)),Object(V.a)(e,"videoInputDevice",S,Object(Y.a)(e)),Object(V.a)(e,"audioOutputDevice",C,Object(Y.a)(e)),e.information=e.information,Object(V.a)(e,"informationToSend",_,Object(Y.a)(e)),e.informationToSend=void 0,Object(Q.g)(Object(Y.a)(e)),e.loadInformationFromStorage(),X.a.name&&(e.information.name=X.a.name),e.useStereoAudio=null!==X.a.headphone,e.muteAudio=null!==X.a.muteMic,e.muteVideo=null===X.a.cameraOn,e.loadMediaSettingsFromStorage(),e.loadPhysicsFromStorage(),Object(Q.c)((function(){var t="https://www.gravatar.com/avatar/",n=e.information.avatarSrc;if((!n||n.includes(t,0))&&e.information.email){var i=ee()(e.information.email.trim().toLowerCase());n="".concat(t).concat(i,"?d=404")}n&&Object(Z.c)(n).then((function(t){e.information.avatarSrc=t})).catch((function(){e.information.avatarSrc=""}))})),e}return Object(G.a)(n,[{key:"setThirdPersonView",value:function(e){this.thirdPersonView=e}},{key:"trackStates",get:function(){return{micMuted:this.muteAudio,speakerMuted:this.muteSpeaker,headphone:this.useStereoAudio}}},{key:"info",get:function(){return this.information}},{key:"sendInformation",value:function(){var e=this.information,t=(e.email,Object(K.a)(e,["email"]));this.informationToSend=t}},{key:"saveInformationToStorage",value:function(e){var t=sessionStorage;e&&(t=localStorage),t.setItem("localParticipantInformation",JSON.stringify(this.information))}},{key:"loadInformationFromStorage",value:function(){var e=localStorage;sessionStorage.getItem("localParticipantInformation")&&(e=sessionStorage);var t=e.getItem("localParticipantInformation");t&&Object.assign(this.information,JSON.parse(t))}},{key:"saveMediaSettingsToStorage",value:function(){var e={stream:{muteVideo:this.muteVideo,muteAudio:this.muteAudio,muteSpeaker:this.muteSpeaker},device:this.devicePreference,headphone:this.useStereoAudio,soundLocalizationBase:this.soundLocalizationBase};localStorage.setItem("localParticipantStreamControl",JSON.stringify(e)),sessionStorage.setItem("localParticipantStreamControl",JSON.stringify(e))}},{key:"loadMediaSettingsFromStorage",value:function(e){var t=localStorage.getItem("localParticipantStreamControl"),n=sessionStorage.getItem("localParticipantStreamControl"),i=void 0,o=void 0;t&&(i=JSON.parse(t)),n&&(o=JSON.parse(n));var r=i;r&&(r.stream.muteVideo=!0,o&&(r.stream.muteVideo=o.stream.muteVideo),e?Object.assign(e,r):(Object.assign(this,r.stream),Object.assign(this.devicePreference,r.device),this.useStereoAudio=r.headphone,this.soundLocalizationBase=r.soundLocalizationBase))}},{key:"savePhysicsToStorage",value:function(e){var t=sessionStorage;e&&(t=localStorage);var n={pose:this.pose,physics:this.physics};t.setItem("localParticipantPhysics",JSON.stringify(n))}},{key:"loadPhysicsFromStorage",value:function(){var e=localStorage;sessionStorage.getItem("localParticipantPhysics")&&(e=sessionStorage);var t=e.getItem("localParticipantPhysics");if(t){var n=JSON.parse(t);Object.assign(this.physics,n.physics),Object.assign(this.pose,n.pose)}}}]),n}(ne.a),m=Object(H.a)(f.prototype,"tracks",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ne.c}}),v=Object(H.a)(f.prototype,"useStereoAudio",[Q.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),g=Object(H.a)(f.prototype,"thirdPersonView",[Q.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return config.thirdPersonView}}),b=Object(H.a)(f.prototype,"soundLocalizationBase",[Q.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return config.soundLocalizationBase?config.soundLocalizationBase:"user"}}),y=Object(H.a)(f.prototype,"zone",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),A=Object(H.a)(f.prototype,"remoteVideoLimit",[Q.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return config.remoteVideoLimit||-1}}),E=Object(H.a)(f.prototype,"remoteAudioLimit",[Q.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return config.remoteAudioLimit||-1}}),O=Object(H.a)(f.prototype,"audioInputDevice",[Q.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),S=Object(H.a)(f.prototype,"videoInputDevice",[Q.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),C=Object(H.a)(f.prototype,"audioOutputDevice",[Q.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),_=Object(H.a)(f.prototype,"informationToSend",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Object(H.a)(f.prototype,"setThirdPersonView",[Q.b],Object.getOwnPropertyDescriptor(f.prototype,"setThirdPersonView"),f.prototype),Object(H.a)(f.prototype,"trackStates",[Q.d],Object.getOwnPropertyDescriptor(f.prototype,"trackStates"),f.prototype),Object(H.a)(f.prototype,"sendInformation",[Q.b],Object.getOwnPropertyDescriptor(f.prototype,"sendInformation"),f.prototype),Object(H.a)(f.prototype,"loadInformationFromStorage",[l],Object.getOwnPropertyDescriptor(f.prototype,"loadInformationFromStorage"),f.prototype),Object(H.a)(f.prototype,"loadMediaSettingsFromStorage",[h],Object.getOwnPropertyDescriptor(f.prototype,"loadMediaSettingsFromStorage"),f.prototype),Object(H.a)(f.prototype,"loadPhysicsFromStorage",[p],Object.getOwnPropertyDescriptor(f.prototype,"loadPhysicsFromStorage"),f.prototype),f),oe=n(183),re=(j=Q.h.shallow,T=Q.h.ref,k=function(e){Object(W.a)(n,e);var t=Object(q.a)(n);function n(e){var i;return Object(J.a)(this,n),(i=t.call(this)).information=i.information,i.informationReceived=!1,Object(V.a)(i,"tracks",I,Object(Y.a)(i)),Object(V.a)(i,"trackStates",R,Object(Y.a)(i)),Object(V.a)(i,"called",w,Object(Y.a)(i)),Object(V.a)(i,"inLocalsZone",D,Object(Y.a)(i)),Object(V.a)(i,"closedZone",N,Object(Y.a)(i)),i.lastDistance=0,Object(Q.g)(Object(Y.a)(i)),i.id=e,i}return Object(G.a)(n,[{key:"call",value:function(){this.called=!0}}]),n}(ne.a),I=Object(H.a)(k.prototype,"tracks",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ne.c}}),R=Object(H.a)(k.prototype,"trackStates",[Q.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ne.b}}),w=Object(H.a)(k.prototype,"called",[Q.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),D=Object(H.a)(k.prototype,"inLocalsZone",[Q.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),N=Object(H.a)(k.prototype,"closedZone",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),Object(H.a)(k.prototype,"call",[Q.b],Object.getOwnPropertyDescriptor(k.prototype,"call"),k.prototype),k),ae=new(P=Q.h.shallow,M=Q.h.shallow,L=function(){function e(){Object(J.a)(this,e),Object(V.a)(this,"remote",x,this),this.local_=Q.h.box(new ie),Object(V.a)(this,"playback",F,this),Object(V.a)(this,"yarnPhones",B,this),Object(V.a)(this,"yarnPhoneUpdated",U,this),Object(Q.g)(this)}return Object(G.a)(e,[{key:"count",get:function(){return this.remote.size}},{key:"local",get:function(){return this.local_.get()}},{key:"localId",get:function(){return this.local.id}},{key:"setLocalId",value:function(e){this.local.id=e}},{key:"join",value:function(e){var t=new re(e);t.physics.located=!1,this.remote.set(e,t)}},{key:"leave",value:function(e){this.remote.delete(e)}},{key:"leaveAll",value:function(){this.remote.clear(),this.setLocalId("")}},{key:"find",value:function(e){return e===this.localId?this.local:this.remote.get(e)}},{key:"getPlayback",value:function(e){var t=this.playback.get(e);return t||(t=new oe.a(e),this.playback.set(e,t)),t}},{key:"addPlaybackStream",value:function(e){}},{key:"addRemoteTrack",value:function(e){var t=this.remote.get(e.getParticipantId());return!!t&&(e.isAudioTrack()?t.tracks.audio=e:(t.tracks.avatar=e,e.getTrack().addEventListener("ended",(function(){t.tracks.avatar=void 0})),e.getTrack().addEventListener("mute",(function(){t.tracks.onMuteChanged(e,!0)})),e.getTrack().addEventListener("unmute",(function(){t.tracks.onMuteChanged(e,!1)}))),!0)}},{key:"removeRemoteTrack",value:function(e){var t=this.remote.get(e.getParticipantId());return!!t&&(e.isAudioTrack()?t.tracks.audio=void 0:t.tracks.avatar=void 0,!0)}},{key:"isLocal",value:function(e){return e===this.localId}},{key:"audibleArea",value:function(){return[this.local.pose.position[0],this.local.pose.position[1],7*z.a]}}]),e}(),x=Object(H.a)(L.prototype,"remote",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Map}}),F=Object(H.a)(L.prototype,"playback",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Map}}),B=Object(H.a)(L.prototype,"yarnPhones",[Q.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Set}}),U=Object(H.a)(L.prototype,"yarnPhoneUpdated",[Q.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(H.a)(L.prototype,"count",[Q.d],Object.getOwnPropertyDescriptor(L.prototype,"count"),L.prototype),Object(H.a)(L.prototype,"local",[Q.d],Object.getOwnPropertyDescriptor(L.prototype,"local"),L.prototype),Object(H.a)(L.prototype,"localId",[Q.d],Object.getOwnPropertyDescriptor(L.prototype,"localId"),L.prototype),Object(H.a)(L.prototype,"setLocalId",[Q.b],Object.getOwnPropertyDescriptor(L.prototype,"setLocalId"),L.prototype),Object(H.a)(L.prototype,"join",[Q.b],Object.getOwnPropertyDescriptor(L.prototype,"join"),L.prototype),Object(H.a)(L.prototype,"leave",[Q.b],Object.getOwnPropertyDescriptor(L.prototype,"leave"),L.prototype),Object(H.a)(L.prototype,"leaveAll",[Q.b],Object.getOwnPropertyDescriptor(L.prototype,"leaveAll"),L.prototype),L);d.participants=ae;t.a=ae},,,function(e,t,n){"use strict";n.d(t,"b",(function(){return oe})),n.d(t,"a",(function(){return ae}));var i,o,r,a,s,c,u,l,h,p,f,m,v,g,b,y,A,E,O,S,C,_,j,T,k,I,R,w=n(14),D=n(69),N=n(8),P=n(25),M=n(35),L=n(34),x=n(21),F=n(6),B=n(11),U=(n(81),n(30)),V=n(29),J=n(46),G=n(54),H=n(4),z=n(12),Q=n(55),K=n(44),Y=n.n(K),W=n(3),q=n(42),X=n(89),Z=n(61),$=n.n(Z),ee=function(e){Object(M.a)(n,e);var t=Object(L.a)(n);function n(){var e;Object(F.a)(this,n);for(var i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).jitsiConnection=void 0,e.jitsiConference=void 0,e.localId="",e}return Object(N.a)(n,[{key:"init",value:function(){var e=this;return new Promise((function(t,n){e.initJitsiConnection().then((function(){e.jitsiConnection?(e.jitsiConference=e.jitsiConnection.initJitsiConference(U.b.conference.name,config),e.jitsiConference.on($.a.events.conference.CONFERENCE_JOINED,(function(){var n;e.localId=e.jitsiConference.myUserId(),null===(n=e.jitsiConference)||void 0===n||n.setPerceptibles([[],[]]),t("")})),e.jitsiConference.setDisplayName(X.b),e.jitsiConference.join(""),e.jitsiConference.setSenderVideoConstraint(1080)):n("No connection has been established.")}))}))}},{key:"addTrack",value:function(e){this.jitsiConference?this.jitsiConference.addTrack(e):console.error("Not joined to conference yet.")}},{key:"removeTrack",value:function(e){return this.jitsiConference?this.jitsiConference.removeTrack(e):(console.error("Not joined to conference yet."),Promise.reject())}},{key:"getParticipantId",value:function(){return Object(H.b)(this.jitsiConference),this.localId}},{key:"getLocalTracks",value:function(){var e,t=null===(e=this.jitsiConference)||void 0===e?void 0:e.getLocalTracks();return t||[]}},{key:"initJitsiConnection",value:function(){var e=this;return new Promise((function(t,n){e.jitsiConnection=new $.a.JitsiConnection(null,void 0,config),e.jitsiConnection.addEventListener($.a.events.connection.CONNECTION_ESTABLISHED,(function(){t($.a.events.connection.CONNECTION_ESTABLISHED)})),e.jitsiConnection.addEventListener($.a.events.connection.CONNECTION_FAILED,(function(){n($.a.events.connection.CONNECTION_FAILED)})),e.jitsiConnection.connect()}))}},{key:"disconnect",value:function(){var e=this;return new Promise((function(t,n){var i;e.jitsiConnection?e.jitsiConference?e.jitsiConference.leave().then((function(){var n;null===(n=e.jitsiConnection)||void 0===n||n.disconnect().then((function(){t("")})).catch((function(t){console.log("ConnForCont: Fail to disconnect by ".concat(t,". I'm:").concat(e.localId))}))})).catch((function(t){console.log("ConnForCont: Fail to leave by ".concat(t,". I'm:").concat(e.localId))})):null===(i=e.jitsiConnection)||void 0===i||i.disconnect().then((function(){t("")})).catch((function(t){console.log("ConnForCont no conf: Fail to disconnect by ".concat(t,". I'm:").concat(e.localId))})):n("No connection has been established.")}))}}]),n}(Q.EventEmitter),te="mainScreen",ne=console.log,ie=(i=W.h.shallow,o=W.h.shallow,r=function(){function e(t){Object(F.a)(this,e),this.sharedContents=void 0,Object(x.a)(this,"carrierMap",a,this),this.remoteTrackPool=new Map,this.localMainConnection=void 0,Object(x.a)(this,"localMains",s,this),this.contentCarriers=new Map,Object(x.a)(this,"localContents",c,this),Object(x.a)(this,"remoteMains",u,this),Object(x.a)(this,"remoteContents",l,this),Object(W.g)(this),this.sharedContents=t}return Object(N.a)(e,[{key:"allContentStreams",value:function(){var e=[];return this.localContents.forEach((function(t,n){t.size&&e.push({cid:n,stream:new MediaStream(Array.from(t).map((function(e){return e.getTrack()})))})})),this.remoteContents.forEach((function(t,n){t.size&&e.push({cid:n,stream:new MediaStream(Array.from(t).map((function(e){return e.getTrack()})))})})),e}},{key:"clearConnection",value:function(){this.clearAllRemotes(),this.clearLocalContentCarriers()}},{key:"clearAllRemotes",value:function(){this.carrierMap.clear(),this.remoteTrackPool.clear(),this.remoteMains.clear(),this.remoteContents.clear()}},{key:"clearLocalContentCarriers",value:function(){var e;this.contentCarriers.forEach((function(e){return e.disconnect()})),this.contentCarriers.clear(),null===(e=this.localMainConnection)||void 0===e||e.disconnect(),this.localMainConnection=void 0}},{key:"restoreLocalCarriers",value:function(){var e=this;if(this.localContents.forEach((function(t,n){e.createConnectionForContent(n,Array.from(t))})),this.localMains.size){var t=this.localMains;this.localMains=new Set,this.addLocalMains(Array.from(t))}}},{key:"onUpdateContent",value:function(e){var t=this;if(ne("update SC: id:".concat(e.id," pid:").concat(e.url," cid in map:").concat(this.carrierMap.get(e.url))),e.url){Object(H.b)(!this.carrierMap.has(e.url)||this.carrierMap.get(e.url)===e.id),this.carrierMap.set(e.url,e.id);var n=this.remoteTrackPool.get(e.url);this.remoteTrackPool.delete(e.url),null===n||void 0===n||n.forEach((function(e){t.addRemoteContent(e)}))}}},{key:"addRemoteTrack",value:function(e){var t=e.getParticipantId(),n=this.carrierMap.get(t);if(n)n===te?this.addRemoteMain(e):config.bmRelayServer?this.contentCarriers.has(n)?ne("SC addRT:Local: cid:".concat(n," pid:").concat(e.getParticipantId()," track:").concat(e.toString())):(ne("SC addRT:cid:".concat(n," pid:").concat(e.getParticipantId()," track:").concat(e.toString())),this.addRemoteContent(e)):this.sharedContents.localParticipant.myContents.has(n)?ne("SC addRT:Local: cid:".concat(n," pid:").concat(e.getParticipantId()," track:").concat(e.toString())):(ne("SC addRT:cid:".concat(n," pid:").concat(e.getParticipantId()," track:").concat(e.toString())),this.addRemoteContent(e));else{var i=this.remoteTrackPool.get(t);i||(i=new Set,this.remoteTrackPool.set(t,i)),i.add(e)}}},{key:"removeRemoteTrack",value:function(e){var t=e.getParticipantId(),n=this.carrierMap.get(t);if(n===te)this.removeRemoteMain(e);else if(n)this.removeRemoteContent(e);else{var i=this.remoteTrackPool.get(e.getParticipantId());null===i||void 0===i||i.delete(e),0===(null===i||void 0===i?void 0:i.size)&&this.remoteTrackPool.delete(e.getParticipantId())}}},{key:"onMainScreenCarrier",value:function(e,t){var n=this;if(t){this.carrierMap.set(e,te);var i=this.remoteTrackPool.get(e);null===i||void 0===i||i.forEach((function(e){return n.addRemoteMain(e)})),this.remoteTrackPool.delete(e)}else this.remoteMains.delete(e),this.carrierMap.delete(e)}},{key:"addLocalMains",value:function(e){var t=this;Object(H.b)(e.length),e.find((function(e){return t.localMains.has(e)}))?console.error("addLocalMain: one of track in ".concat(e," already in localMains.")):(e.forEach((function(e){return t.localMains.add(e)})),this.localMainConnection?e.forEach((function(e){return t.localMainConnection.addTrack(e)})):(this.localMainConnection=new ee,this.localMainConnection.init().then((function(){U.b.conference.sync.sendMainScreenCarrier(!0),e.forEach((function(e){return t.localMainConnection.addTrack(e)}))}))),e.forEach((function(e){return e.getTrack().onended=function(){ne("stop sharing screen of ",e),t.removeLocalMain(e)}})))}},{key:"removeLocalMain",value:function(e){var t=this;this.localMains.delete(e)?(U.b.conference.sync.sendMainScreenCarrier(!1),this.localMainConnection.removeTrack(e).then((function(){0===t.localMainConnection.getLocalTracks().length&&(t.localMainConnection.disconnect(),t.localMainConnection=void 0)}))):console.error("removeLocalMain: track ".concat(e," not found in localMains."))}},{key:"clearLocalMains",value:function(){var e,t=new Set(this.localMains),n=Object(w.a)(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;this.removeLocalMain(i)}}catch(o){n.e(o)}finally{n.f()}}},{key:"mainStream",get:function(){var e=[];if(this.localMains.size)e=Array.from(this.localMains.values()).filter((function(e){return"audio"!==e.getType()}));else{var t=Array.from(this.remoteMains.keys());if(t.length){t.sort();var n=this.remoteMains.get(t[t.length-1]);n&&(e=Array.from(n.values()))}}if(e.length){var i,o=new MediaStream,r=Object(w.a)(e);try{for(r.s();!(i=r.n()).done;){var a=i.value;o.addTrack(a.getTrack())}}catch(s){r.e(s)}finally{r.f()}return o}}},{key:"addRemoteMain",value:function(e){var t,n,i=e.getParticipantId(),o=null===(t=this.localMainConnection)||void 0===t?void 0:t.getParticipantId();i>(o||"")&&this.clearLocalMains(),this.remoteMains.has(e.getParticipantId())||this.remoteMains.set(e.getParticipantId(),new Set),null===(n=this.remoteMains.get(e.getParticipantId()))||void 0===n||n.add(e)}},{key:"removeRemoteMain",value:function(e){var t,n;null===(t=this.remoteMains.get(e.getParticipantId()))||void 0===t||t.delete(e),0===(null===(n=this.remoteMains.get(e.getParticipantId()))||void 0===n?void 0:n.size)&&(this.remoteMains.delete(e.getParticipantId()),this.carrierMap.delete(e.getParticipantId()))}},{key:"addLocalContent",value:function(e,t){Object(H.b)(t.length);var n=new Set(this.localContents.get(e));t.forEach((function(e){return n.add(e)})),Object(H.b)(!this.localContents.has(e)),this.localContents.set(e,n),this.createConnectionForContent(e,t)}},{key:"createConnectionForContent",value:function(e,t){var n=this,i=new ee;this.contentCarriers.set(e,i),i.init().then((function(){n.carrierMap.set(i.getParticipantId(),e);var o=n.sharedContents.find(e);Object(H.b)(o),o.url=i.getParticipantId(),n.sharedContents.updateByLocal(Object.assign({},o)),t.forEach((function(e){return i.addTrack(e)})),t[0].getTrack().onended=function(t){n.sharedContents.removeByLocal(e)}}))}},{key:"clearLocalContent",value:function(e){var t=this.localContents.get(e);if(null===t||void 0===t||t.forEach((function(e){e.getTrack().onended=null,e.stopStream()})),t){var n=this.contentCarriers.get(e);Object(H.b)(n),this.carrierMap.delete(n.getParticipantId()),t.forEach((function(e){return n.removeTrack(e).then((function(){0===n.getLocalTracks().length&&n.disconnect()}))}))}this.localContents.delete(e),this.contentCarriers.delete(e)}},{key:"addRemoteContent",value:function(e){var t=this.carrierMap.get(e.getParticipantId());if(t){var n=this.remoteContents.get(t),i=new Set(n);i.add(e),this.remoteContents.set(t,i)}else console.warn("No cid found for carrier ".concat(e.getParticipantId()," of track ").concat(e.toString()))}},{key:"removeRemoteContent",value:function(e){var t=this.carrierMap.get(e.getParticipantId());if(t){var n=this.remoteContents.get(t);null===n||void 0===n||n.delete(e),0===(null===n||void 0===n?void 0:n.size)&&(this.remoteContents.delete(t),this.carrierMap.delete(t))}else console.warn("No cid found for carrier ".concat(e.getParticipantId()," of track ").concat(e.toString()))}},{key:"clearRemoteContent",value:function(e){var t=this.sharedContents.find(e);t&&t.url?(this.carrierMap.delete(t.url),this.remoteContents.delete(e)):console.warn("No pid found for content ".concat(e))}},{key:"remoteMainTrack",value:function(){if(0===this.localMains.size){var e=Array.from(this.remoteMains.keys());if(e.length){e.sort();var t=this.remoteMains.get(e[e.length-1]);if(t){var n=Array.from(t);return[n.find((function(e){return e.isVideoTrack()})),n.find((function(e){return e.isAudioTrack()}))]}}}}}]),e}(),a=Object(B.a)(r.prototype,"carrierMap",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Map}}),s=Object(B.a)(r.prototype,"localMains",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Set}}),c=Object(B.a)(r.prototype,"localContents",[W.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Map}}),u=Object(B.a)(r.prototype,"remoteMains",[W.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Map}}),l=Object(B.a)(r.prototype,"remoteContents",[W.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Map}}),Object(B.a)(r.prototype,"addLocalMains",[W.b],Object.getOwnPropertyDescriptor(r.prototype,"addLocalMains"),r.prototype),Object(B.a)(r.prototype,"removeLocalMain",[W.b],Object.getOwnPropertyDescriptor(r.prototype,"removeLocalMain"),r.prototype),Object(B.a)(r.prototype,"clearLocalMains",[W.b],Object.getOwnPropertyDescriptor(r.prototype,"clearLocalMains"),r.prototype),Object(B.a)(r.prototype,"mainStream",[W.d],Object.getOwnPropertyDescriptor(r.prototype,"mainStream"),r.prototype),Object(B.a)(r.prototype,"addRemoteMain",[W.b],Object.getOwnPropertyDescriptor(r.prototype,"addRemoteMain"),r.prototype),Object(B.a)(r.prototype,"removeRemoteMain",[W.b],Object.getOwnPropertyDescriptor(r.prototype,"removeRemoteMain"),r.prototype),Object(B.a)(r.prototype,"addLocalContent",[W.b],Object.getOwnPropertyDescriptor(r.prototype,"addLocalContent"),r.prototype),Object(B.a)(r.prototype,"clearLocalContent",[W.b],Object.getOwnPropertyDescriptor(r.prototype,"clearLocalContent"),r.prototype),Object(B.a)(r.prototype,"addRemoteContent",[W.b],Object.getOwnPropertyDescriptor(r.prototype,"addRemoteContent"),r.prototype),Object(B.a)(r.prototype,"removeRemoteContent",[W.b],Object.getOwnPropertyDescriptor(r.prototype,"removeRemoteContent"),r.prototype),Object(B.a)(r.prototype,"clearRemoteContent",[W.b],Object.getOwnPropertyDescriptor(r.prototype,"clearRemoteContent"),r.prototype),r),oe=function(e){},re=function(e){},ae=35;function se(e,t){return e.zorder-t.zorder}var ce=(h=W.h.shallow,p=function e(t){Object(F.a)(this,e),this.participantId="",Object(x.a)(this,"myContents",f,this),Object(H.b)(!config.bmRelayServer),Object(W.g)(this),this.participantId=t},f=Object(B.a)(p.prototype,"myContents",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Map}}),p),ue=new(m=W.h.shallow,v=W.h.shallow,g=W.h.shallow,b=W.h.shallow,y=W.h.shallow,A=W.h.ref,E=function(e){Object(M.a)(n,e);var t=Object(L.a)(n);function n(){var e;Object(F.a)(this,n),(e=t.call(this)).contentIdCounter=0,e.localId="",e.beforeChangeEditing=void 0,e.tracks=new ie(Object(P.a)(e)),Object(x.a)(e,"pasteEnabled",O,Object(P.a)(e)),Object(x.a)(e,"editing",S,Object(P.a)(e)),Object(x.a)(e,"all",C,Object(P.a)(e)),e.sorted=[],Object(x.a)(e,"zones",_,Object(P.a)(e)),Object(x.a)(e,"closedZones",j,Object(P.a)(e)),e.participants=new Map,e.pendToRemoves=new Map,Object(x.a)(e,"roomContents",T,Object(P.a)(e)),Object(x.a)(e,"roomContentsInfo",k,Object(P.a)(e)),Object(x.a)(e,"pasted",I,Object(P.a)(e)),e.owner=new Map,e.wallpapers="",e.oldWallPapers=[],Object(x.a)(e,"screenFps",R,Object(P.a)(e)),Object(W.g)(Object(P.a)(e)),Object(W.c)((function(){var t=z.a.localId;Array.from(e.owner.keys()).forEach((function(n){e.owner.get(n)===e.localId&&e.owner.set(n,t)}));var n=e.participants.get(e.localId);n&&(e.participants.delete(e.localId),n.participantId=t,e.participants.set(t,n)),e.localId=t,oe("Set new local id ".concat(e.localId))}));var i=localStorage.getItem("screenFps");return i&&(e.screenFps=JSON.parse(i)),Object(W.c)((function(){localStorage.setItem("screenFps",JSON.stringify(e.screenFps))})),Object(W.c)((function(){var t=z.a.local.pose.position;z.a.local.zone=e.zones.find((function(e){return Object(H.u)(t,.5*G.a,Object(H.q)(e.pose,e.size))}))})),Object(W.c)((function(){var t=e.closedZones.map((function(e){return{content:e,rect:Object(H.q)(e.pose,e.size)}}));z.a.remote.forEach((function(e){if(!e.muteAudio&&e.physics.located){var n=t.find((function(t){return Object(H.u)(e.pose.position,.5*G.a,t.rect)}));e.closedZone=null===n||void 0===n?void 0:n.content}else e.closedZone=void 0}))})),e}return Object(N.a)(n,[{key:"setEditing",value:function(e){e!==this.editing&&this.beforeChangeEditing&&this.beforeChangeEditing(this.editing,e),this.editing=e}},{key:"setBeforeChangeEditing",value:function(e,t){t&&t!==this.editing||(this.beforeChangeEditing=e)}},{key:"getParticipant",value:function(e){Object(H.b)(!config.bmRelayServer);var t=this.participants.get(e);return t||(t=new ce(e),this.participants.set(e,t)),t}},{key:"setPasted",value:function(e){console.log("setPasted:",e),this.pasted=e}},{key:"sharePasted",value:function(){this.shareContent(this.pasted),this.pasted=Object(q.b)()}},{key:"shareContent",value:function(e){Object(q.t)(e),this.addLocalContent(e)}},{key:"localParticipant",get:function(){return this.getParticipant(this.localId)}},{key:"find",value:function(e){if(config.bmRelayServer)return this.roomContents.get(e);var t,n=this.owner.get(e);return n?null===(t=this.participants.get(n))||void 0===t?void 0:t.myContents.get(e):void 0}},{key:"removeSameWallpaper",value:function(e){var t=this;Object(H.b)(!config.bmRelayServer);var n=!1;return this.localParticipant.myContents.forEach((function(i){if(Object(J.j)(i)){var o=e.find((function(e){return i.url===e.url&&Y.a.isEqual(i.pose,e.pose)}));o&&o.id!==i.id&&o.zorder<=i.zorder&&(t.removeByLocal(i.id),n=!0,console.warn("My wallpapers id:".concat(i.id," url:").concat(i.url," removed.")))}})),n}},{key:"checkDuplicatedWallpaper",value:function(e,t){var n=this;if(Object(H.b)(!config.bmRelayServer),!config.bmRelayServer){var i=t.filter(J.j);this.localParticipant.myContents.forEach((function(e){if(Object(J.j)(e)){var t=i.find((function(t){return e.url===t.url&&Y.a.isEqual(e.pose,t.pose)}));t&&t.zorder<=e.zorder&&(n.removeByLocal(e.id),console.warn("My wallpapers id:".concat(e.id," url:").concat(e.url," removed.")))}}))}}},{key:"removeDuplicated",value:function(){var e=this;Object(H.b)(!config.bmRelayServer);var t=!1;this.participants.forEach((function(n){if(n.participantId>e.localParticipant.participantId){var i=Object(H.s)(n.myContents,e.localParticipant.myContents);i.forEach((function(t,n){e.disposeContent(t),e.localParticipant.myContents.delete(n)})),t=t||0!==i.size}})),t&&U.b.conference.sync.sendMyContents()}},{key:"updateAll",value:function(){var e=[];config.bmRelayServer?Object.assign(e,Array.from(this.roomContents.values())):(this.removeDuplicated(),this.participants.forEach((function(t){e.push.apply(e,Object(D.a)(t.myContents.values()))})),this.pendToRemoves.forEach((function(t){e.push.apply(e,Object(D.a)(t.myContents.values()))})));var t=Array.from(e).sort(se);t.forEach((function(e,t){e.zIndex=t+1})),this.all=e,this.sorted=t,this.zones=this.sorted.filter((function(e){return void 0!==e.zone})).reverse(),this.closedZones=this.zones.filter((function(e){return"close"===e.zone})),config.bmRelayServer||this.saveWallpaper()}},{key:"getWallpaper",value:function(){var e=this.sorted.findIndex((function(e){return!Object(J.j)(e)}));return e<0&&(e=this.sorted.length),this.sorted.slice(0,e)}},{key:"saveWallpaper",value:function(){var e=this;if(this.localId){this.wallpapers||this.loadWallpaper();var t=this.getWallpaper();if(t.find((function(t,n){return t!==e.oldWallPapers[n]}))||t.length!==this.oldWallPapers.length){this.oldWallPapers=t,this.removeSameWallpaper(t)&&(t=this.getWallpaper());var n={room:U.b.conference.name,contents:Object(q.k)(t)},i=[],o=localStorage.getItem("wallpapers");o&&(i=JSON.parse(o));var r=i.findIndex((function(e){return e.room===n.room}));-1===r?i.push(n):i[r]=n,localStorage.setItem("wallpapers",JSON.stringify(i))}}}},{key:"loadWallpaper",value:function(){var e=this;if(!this.wallpapers){var t=this.getWallpaper();if(t.length)this.wallpapers=JSON.stringify(t);else{var n=localStorage.getItem("wallpapers");if(n){var i=JSON.parse(n).find((function(e){return e.room===U.b.conference.name}));i&&(i.contents.forEach((function(t){var n=Object(q.b)();Object.assign(n,t),e.addLocalContent(n)})),this.wallpapers=JSON.stringify(this.getWallpaper()))}else this.wallpapers=JSON.stringify([])}}}},{key:"addLocalContent",value:function(e){if(config.bmRelayServer)e.id||(e.id=this.getUniqueId()),this.updateByLocal(e);else{if(!z.a.localId)return void console.error("addLocalContant() failed. Invalid Participant ID.");e.id||(e.id=this.getUniqueId()),this.localParticipant.myContents.set(e.id,e),this.owner.set(e.id,z.a.localId),this.updateAll(),U.b.conference.sync.sendMyContents()}}},{key:"takeContentsFromDead",value:function(e,t){var n=this,i=!1;return e.myContents.forEach((function(o,r){t&&t!==r||("screen"===o.type||"camera"===o.type?(e.myContents.delete(r),n.owner.delete(r),n.disposeContent(o)):(n.localParticipant.myContents.set(r,o),e.myContents.delete(r),n.owner.set(r,n.localId),i=!0,oe("set owner for cid=",r," pid=",n.localId)))})),0===e.myContents.size&&(this.participants.delete(e.participantId),this.pendToRemoves.delete(e.participantId)),i}},{key:"getOrTakeContent",value:function(e,t){var n=this.owner.get(e);if(n){var i=this.participants.get(n);if(i)return n===this.localId||z.a.remote.has(n)?{pid:n,pc:i,take:!1}:(this.takeContentsFromDead(i),U.b.conference.sendMessage(V.b.PARTICIPANT_LEFT,[n]),{pid:this.localId,pc:this.participants.get(this.localId),take:!0});var o=this.pendToRemoves.get(n);if(o&&this.takeContentsFromDead(o,e))return{pid:this.localId,pc:this.participants.get(this.localId),take:!0}}return console.error("".concat(t,": No owner for cid=").concat(e)),{pid:n,pc:void 0,take:!1}}},{key:"checkAndGetContent",value:function(e,t){var n=this.owner.get(e);if(n){var i=n?this.participants.get(n):void 0;return i||console.error("".concat(t,": Owner does not have cid=").concat(e)),{pid:n,pc:i}}return console.error("".concat(t,": No owner for cid=").concat(e)),{pid:n,pc:void 0}}},{key:"updateLocalOnly",value:function(e){if(config.bmRelayServer)this.roomContents.set(e.id,e);else{var t=this.checkAndGetContent(e.id,"updateByLocal").pc;t&&t.myContents.set(e.id,e)}this.updateAll()}},{key:"updateByLocal",value:function(e){if(config.bmRelayServer)this.roomContents.set(e.id,e),U.b.conference.sync.sendContentUpdateRequest("",[e]),this.updateAll(),this.roomContentsInfo.set(e.id,e);else{var t=this.getOrTakeContent(e.id,"updateByLocal"),n=t.pid,i=t.pc;i&&(n===this.localId?(i.myContents.set(e.id,e),this.updateAll(),U.b.conference.sync.sendMyContents()):n&&U.b.conference.sync.sendContentUpdateRequest(n,[e]))}}},{key:"removeByLocal",value:function(e){if(config.bmRelayServer){var t=this.roomContents.get(e);t&&(this.disposeContent(t),this.roomContents.delete(e)),U.b.conference.sync.sendContentRemoveRequest("",[e]),this.roomContentsInfo.delete(e),this.updateAll()}else{var n,i=this.getOrTakeContent(e,"removeByLocal"),o=i.pid,r=i.pc,a=i.take;r?(a&&(console.log("sendLeftContentRemoveRequest of ".concat(e,".")),U.b.conference.sync.sendLeftContentRemoveRequest([e])),o===this.localId?(this.removeMyContent(e),U.b.conference.sync.sendMyContents()):o&&z.a.remote.has(o)&&U.b.conference.sync.sendContentRemoveRequest(o,[e])):o&&(null===(n=U.b.conference.bmRelaySocket)||void 0===n?void 0:n.readyState)===WebSocket.OPEN&&(z.a.remote.has(o)||U.b.conference.pushOrUpdateMessageViaRelay(V.b.PARTICIPANT_LEFT,[o]))}}},{key:"requestContent",value:function(e){config.bmRelayServer&&U.b.conference.pushOrUpdateMessageViaRelay(V.b.CONTENT_UPDATE_REQUEST_BY_ID,e)}},{key:"updateByRemoteRequest",value:function(e){if(config.bmRelayServer){var t,n=Object(w.a)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;this.roomContents.set(i.id,i),"screen"!==i.type&&"camera"!==i.type||this.tracks.onUpdateContent(i)}}catch(u){n.e(u)}finally{n.f()}}else{var o,r=this.getParticipant(this.localId),a=Object(w.a)(e);try{for(a.s();!(o=a.n()).done;){var s=o.value,c=this.owner.get(s.id);c===this.localId?r.myContents.set(s.id,s):console.error("Update request of ".concat(s.id," is for ").concat(c," and not for me."))}}catch(u){a.e(u)}finally{a.f()}U.b.conference.sync.sendMyContents()}this.updateAll()}},{key:"removeByRemoteRequest",value:function(e){if(config.bmRelayServer){var t,n=Object(w.a)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,o=this.roomContents.get(i);o?(this.disposeContent(o),this.roomContents.delete(i)):ue.editing===i&&(ue.editing=""),ue.roomContentsInfo.delete(i)}}catch(l){n.e(l)}finally{n.f()}this.updateAll()}else{var r,a=Object(w.a)(e);try{for(a.s();!(r=a.n()).done;){var s=r.value,c=this.checkAndGetContent(s,"removeByRemoteRequest"),u=c.pid;c.pc&&(u===this.localId?this.removeMyContent(s):console.error("remote try to remove my content"))}}catch(l){a.e(l)}finally{a.f()}U.b.conference.sync.sendMyContents()}}},{key:"removeLeftContentByRemoteRequest",value:function(e){Object(H.b)(!config.bmRelayServer);var t,n=Object(w.a)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,o=this.owner.get(i);if(o){var r=this.pendToRemoves.get(o);r||(r=this.participants.get(o)),r&&(r.myContents.delete(i),this.owner.delete(i),0===r.myContents.size&&(this.participants.delete(o),this.pendToRemoves.delete(o)))}}}catch(a){n.e(a)}finally{n.f()}}},{key:"removeMyContent",value:function(e,t){Object(H.b)(!config.bmRelayServer),t||(t=this.localId);var n=this.getParticipant(t),i=n.myContents.get(e);i?(this.disposeContent(i),n.myContents.delete(e),this.owner.delete(e),this.updateAll(),t===this.localId&&U.b.conference.sync.sendMyContents()):console.log("I don't have ".concat(e," to remove."))}},{key:"replaceRemoteContents",value:function(e,t){Object(H.b)(!config.bmRelayServer),t===ue.localId&&console.error("A remote tries to replace local contents."),this.updateRemoteContents(e,t);var n=this.getParticipant(t);if(n){var i=new Map(e.map((function(e){return[e.id,e]}))),o=Object(H.f)(n.myContents,i);this.removeRemoteContents(Array.from(o.keys()),t)}}},{key:"updateRemoteContents",value:function(e,t){var n=this;Object(H.b)(!config.bmRelayServer),t===ue.localId&&console.error("A remote tries to updates local contents."),e.forEach((function(e){n.pendToRemoves.forEach((function(t){return t.myContents.delete(e.id)}));var i=n.getParticipant(t);if(oe("updateContents for participant:".concat(t)),re(" update ".concat(e.id," by ").concat(e)),re(" myContents=",JSON.stringify(null===i||void 0===i?void 0:i.myContents)),i.myContents.has(e.id)){var o=n.owner.get(e.id);o!==t&&console.error("Owner not match for cid=".concat(e.id," owner=").concat(o," pid=").concat(t,"."))}else n.owner.set(e.id,t);i.myContents.set(e.id,e),ue.roomContentsInfo.set(e.id,Object(J.g)(e)),"screen"!==e.type&&"camera"!==e.type||n.tracks.onUpdateContent(e)})),this.pendToRemoves.forEach((function(e){0===e.myContents.size&&n.pendToRemoves.delete(e.participantId)})),this.updateAll()}},{key:"removeRemoteContents",value:function(e,t){var n=this;Object(H.b)(!config.bmRelayServer),t===ue.localId&&console.error("Remote removes local contents.");var i=this.getParticipant(t);e.forEach((function(e){var t=i.myContents.get(e);t?(n.disposeContent(t),i.myContents.delete(e),n.owner.delete(e),n.roomContentsInfo.delete(e)):console.error("removeByRemote: failed to find content cid=".concat(e))})),this.updateAll()}},{key:"onParticipantLeft",value:function(e){if(!config.bmRelayServer){oe("onParticipantLeft called with pid = ",e);var t=this.participants.get(e);if(t){var n=Array.from(z.a.remote.keys());n.push(this.localId),n.sort();var i=n.findIndex((function(t){return t>e})),o=n[i>=0?i:0];oe("next = ",o);var r=!1;o===this.localId?(oe("Next is me"),r=this.takeContentsFromDead(t)||r,oe("remove:",e," current:",JSON.stringify(n)),oe("local contents sz:",this.localParticipant.myContents.size," json:",JSON.stringify(Array.from(this.localParticipant.myContents.keys())))):(oe("Next is remote"),this.pendToRemoveParticipant(t)),this.updateAll(),r&&U.b.conference.sync.sendMyContents()}}}},{key:"pendToRemoveParticipant",value:function(e){var t=this;Object(H.b)(!config.bmRelayServer),Array.from(e.myContents.values()).filter((function(e){return"camera"===e.type||"screen"===e.type})).forEach((function(n){e.myContents.delete(n.id),t.owner.delete(n.id)})),this.pendToRemoves.set(e.participantId,e),this.participants.delete(e.participantId)}},{key:"clearAllRemotes",value:function(){var e=this;config.bmRelayServer?(this.roomContents.clear(),this.roomContentsInfo.clear()):(Array.from(this.participants.keys()).filter((function(t){return t!==e.localId})).forEach((function(t){var n=e.participants.get(t);n&&n.myContents.forEach((function(t){return e.roomContentsInfo.delete(t.id)})),e.participants.delete(t)})),this.tracks.clearConnection())}},{key:"removeAllContents",value:function(){var e=this;if(config.bmRelayServer){var t=Array.from(this.roomContentsInfo.keys());U.b.conference.sync.sendContentRemoveRequest("",t),this.roomContents.clear(),this.roomContentsInfo.clear()}else this.participants.forEach((function(t,n){if(n!==e.localId){var i=Array.from(t.myContents.values());U.b.conference.sync.sendContentRemoveRequest(n,i.map((function(e){return e.id})))}})),this.pendToRemoves.forEach((function(e){var t=Array.from(e.myContents.values());U.b.conference.sync.sendLeftContentRemoveRequest(t.map((function(e){return e.id})))})),this.owner.clear(),this.participants.clear(),this.pendToRemoves.clear(),U.b.conference.sync.sendMyContents(),this.roomContentsInfo.clear();this.updateAll()}},{key:"getUniqueId",value:function(){for(var e=z.a.localId;;){this.contentIdCounter+=1;var t="".concat(e,"_").concat(this.contentIdCounter);if(config.bmRelayServer){if(!this.roomContents.has(t))return t}else if(!this.owner.has(t))return t}return""}},{key:"disposeContent",value:function(e){e.id===this.editing&&this.setEditing(""),"screen"!==e.type&&"camera"!==e.type||(this.tracks.contentCarriers.has(e.id)?this.tracks.clearLocalContent(e.id):this.tracks.clearRemoteContent(e.id))}},{key:"setScreenFps",value:function(e){this.screenFps=e}}]),n}(Q.EventEmitter),Object(B.a)(E.prototype,"setEditing",[W.b],Object.getOwnPropertyDescriptor(E.prototype,"setEditing"),E.prototype),O=Object(B.a)(E.prototype,"pasteEnabled",[W.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),S=Object(B.a)(E.prototype,"editing",[W.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),C=Object(B.a)(E.prototype,"all",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_=Object(B.a)(E.prototype,"zones",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),j=Object(B.a)(E.prototype,"closedZones",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),T=Object(B.a)(E.prototype,"roomContents",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Map}}),k=Object(B.a)(E.prototype,"roomContentsInfo",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Map}}),I=Object(B.a)(E.prototype,"pasted",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Object(q.b)()}}),Object(B.a)(E.prototype,"setPasted",[W.b],Object.getOwnPropertyDescriptor(E.prototype,"setPasted"),E.prototype),Object(B.a)(E.prototype,"sharePasted",[W.b],Object.getOwnPropertyDescriptor(E.prototype,"sharePasted"),E.prototype),Object(B.a)(E.prototype,"shareContent",[W.b],Object.getOwnPropertyDescriptor(E.prototype,"shareContent"),E.prototype),Object(B.a)(E.prototype,"localParticipant",[W.d],Object.getOwnPropertyDescriptor(E.prototype,"localParticipant"),E.prototype),R=Object(B.a)(E.prototype,"screenFps",[W.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),Object(B.a)(E.prototype,"setScreenFps",[W.b],Object.getOwnPropertyDescriptor(E.prototype,"setScreenFps"),E.prototype),E);d.contents=ue;t.c=ue},,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return r}));var i="audio",o="presenter",r="video"},function(e,t,n){"use strict";var i=n(338);t.a=new i.a},,function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"d",(function(){return c})),n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return h}));var i=n(286),o=n(460),r=n(728),a=n(192);function s(e,t){return i.a.t(e,t)}function c(){return Object(r.a)()}var u={en:{translation:{enAbout:"A video chat with a 2D map, where you will hear others' voices based on the location. It holds multiple conversations in a venue parallelly, and you may walk around between them. Sharing screens, cameras, texts, images, YouTube, and documents on google drive are supported. You may drop or paste on the map.",enTopPageUrl:"https://scrapbox.io/binaural-meet/Top_page",enMoreInfo:"... more info",YourName:"MY NAME",Venue:"MEETING ADDRESS",EnterTheVenue:"Enter the venue",Contents:"Contents","Create and Share":"Create and Share","Share Text":"Share Text","Share iframe":"Share web page (Can't display many sites)","Share image":"Share image","Share zone image":"Share zone image","Select video camera to share":"Select video camera to share",shareImport:"_Import shared items from file",shareImportTip:"Load the shared content from the downloaded .json file.",shareDownload:"_Download shared items as a file",shareDownloadTip:"Download all shared contents except screen sharing and cameras to a file.",shareIframe:"I_frame",shareIframeTip:"Web pages that can be displayed are limited to those that can be displayed in an iframe.",shareText:"_Text (can paste directly)",sharePaste:"Paste from clipboard (_v)",sharePasteTip:"Ctrl+V / Cmd+V shortcut directly works on the map. URL to PDF, images, YouTube, Google Docs",shareImage:"Ima_ge (can paste directly)",shareZoneImage:"Zone Ima_ge (can paste directly)",shareImageTip:"Image files will be uploaded to gyazo.com. You can also paste the URL of the image.",shareWhiteboard:"_Whiteboard",shareWhiteboardTip:"Place the wbo.ophir.dev whiteboard.",shareEditEnd:"Stop editing",shareCamera:"_Camera",shareScreenBackground:"Screen as the _background",stopScreenBackground:"Stop _background screen",shareScreenContent:"_Screen",shareScreenContentTip:"Reducing the screen update frequency (fps) will reduce the network load.",stopScreen:"C_lose all screen and camera windows",frameRateSetting:"Frame rate:",fps:"fps",shareMouse:"_Mouse cursor",shareMouseTip:"Show the mouse cursor to other participants. The avatar also always gazes at the mouse cursor.",stopMouse:"Stop sharing _Mouse cursor",ttCreateAndshare:"_Create and share",ttMicMute:"_Mic mute",headphoneL1Chrome:"Stereo headphone (Caution: no echo cancel)",headphoneL1:"Stereo headphone",headphoneL2:"Monaural speaker",etConnection:"No connection",emConnection:"Please check internet connection. Binaural Meet uses https. If internet is OK, the server may have problems.",etMicPermission:"No permission to use microphone",emMicPermission:"Your browser does not permit to use microphone. Please give me the permission and reload your browser.",etNoMic:"No microphone",emNoMic:"Please check if your PC has a microphone. Binaural Meet requires it.",emClose:"Close",emNeverShow:"Never show this in this session",etNoChannel:"No data channel",emNoChannel:"Please check firewall setting. Binaural Meet connect to https (port 443/TCP) and port 8801-8810/UDP or 80/TCP.",etRetry:"Please reload",emRetry:"The connection had been cut off once. Please click the reload button of the browser.",imageDropzoneText:"Drag and drop images here or click",lsTitle:"Avatar and notification setting",lsName:"Name",lsColor:"Color",lsColorAvatar:"Avatar",lsColorText:"Text",lsAutoColor:"Auto",lsImage:"Avatar image",lsEmail:"Input email to use Gravatar's image",lsImageFile:"Upload file to use image file",btSave:"Save and close",btCancel:"Cancel change",lsNotifyCall:"Called",lsNotifyTouch:"Touched",lsNotifyNear:"Approached",lsNotifyYarn:"Yarn phone",rsCall:"Call",lsNotification:"Notification",rsConnectYarnPhone:"Connect yarn phone",rsCutYarnPhone:"Disconnect yarn phone",rsChatTo:"Send chat only to {{name}}",ctPin:"Lock position and size",ctUnpin:"Unlock position and size",ctProximity:"Disable Sound Proximity",ctUnProximity:"Enable Sound Proximity",ctEdit:"Start editing (No view sync)",ctEndEdit:"End editing (Sync view)",ctEditIframe:"Browse page (No sync)",ctEndEditIframe:"End browse (No sync)",ctEditText:"Edit (No scroll sync)",ctEndEditText:"End edit (Sync scroll)",ctEditWhiteboard:"Edit (No scroll sync)",ctEndEditWhiteboard:"End edit (No scroll sync)",ctEditGDrive:"Edit/Update (No scroll sync)",ctEndEditGDrive:"End edit (No auto-update)",ctEndEditYoutube:"Sync play pos",ctEditYoutube:"No sync",ctMoveTop:"Move to the top",ctMoveBottom:"Move to the bottom",ctWallpaper:"Make this wallpaper",ctUnWallpaper:"Remove this from wallpaper",ctCopyToClipboard:"Copy to clipboard",ctMaximize:"Zoom and move to maximize this content",ctUnMaximize:"Unmaximize and restore the view",ctDelete:"Delete",ctClose:"Close",ctName:"Titile",ctFocus:"Show it in the center",ctFrameVisible:"Normal frame",ctFrameInvisible:"Invisible frame",ctOpenAudioZone:"Meeting space",ctClosedAudioZone:"Sound proof room",ctNotAudioZone:"Just an image",ctOpaque:"Opaque",ctTransparent:"Transparent",upload:"Upload",Save:"Save",Clear:"Clear",Cancel:"Cancel",broadcastMyVoice:"Broadcast my voice",soundLocalizationBasedOn:"Sound localization based on",slAvatar:"Avatar (avatar's direction)",slUser:"User (top is front)",usage:"How to use",cmJoined:"{{name}} joined.",cmLeft:"{{name}} Left.",cmNameChanged:"{{old}} changed its name to {{new}}.",cmCallBy:"{{name}} called you.",cmCallTo:"You called {{name}}.",cmToAll:"To all",cmToName:"To {{name}}",cmSend:"Send (CTRL+Enter)",cmPrivateFrom:"Private from {{name}}",cmPrivateTo:"Private to {{name}}",noCalled:"{{name}} called you.",noTouched:"{{name}} touched you.",noNear:"{{name}} approached you.",noYarn:"{{name}} connected yarn.",afkTitle:"In away from keyboard mode (L / Esc)",afkMessage:"Hit any key or click mouse to return.",gdFailed:"The file in Google Drive could not be accessed.\r\nChange the file-sharing settings so that everyone on the Internet can see it.",videoLimit:"Limit on the number of video streams",audioLimit:"Limit on the number of audio streams"}},ja:{translation:{enAbout:"\u4f4d\u7f6e\u306b\u5fdc\u3058\u3066\u58f0\u304c\u5c4a\u304f2D\u30de\u30c3\u30d7\u4ed8\u304d\u30d3\u30c7\u30aa\u30c1\u30e3\u30c3\u30c8\u3067\u3059\u3002\u4f1a\u5834\u5185\u306b\u8907\u6570\u306e\u4f1a\u8a71\u304c\u4e26\u7acb\u3057\u3001\u4f1a\u8a71\u9593\u3092\u6b69\u304d\u56de\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u753b\u9762\u3001\u30ab\u30e1\u30e9\u3001\u30c6\u30ad\u30b9\u30c8\u3001\u753b\u50cf\u3001YouTube\u3001Google\u30c9\u30e9\u30a4\u30d6\u306e\u6587\u66f8\u3092\u5171\u6709\u3067\u304d\u307e\u3059\u3002\u30de\u30c3\u30d7\u306bURL\u7b49\u3092\u30c9\u30ed\u30c3\u30d7/\u30da\u30fc\u30b9\u30c8\u3067\u304d\u307e\u3059\u3002",enTopPageUrl:"https://scrapbox.io/binaural-meet/%E3%83%88%E3%83%83%E3%83%97%E3%83%9A%E3%83%BC%E3%82%B8",enMoreInfo:"\u8a73\u7d30",YourName:"\u304a\u540d\u524d",Venue:"\u4f1a\u5834\u540d",EnterTheVenue:"\u5165\u5834",Contents:"\u5171\u6709","Create and Share":"\u5171\u6709 (c)","Share Text":"\u30c6\u30ad\u30b9\u30c8\u306e\u5171\u6709","Share iframe":"Web\u30da\u30fc\u30b8\u306e\u5171\u6709(\u591a\u304f\u306e\u30b5\u30a4\u30c8\u3092\u8868\u793a\u3067\u304d\u307e\u305b\u3093)","Share image":"\u753b\u50cf\u306e\u5171\u6709","Share zone image":"\u753b\u50cf\u306e\u5171\u6709","Select video camera to share":"\u5171\u6709\u3059\u308b\u30ab\u30e1\u30e9\u306e\u9078\u629e",shareImport:"\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u30a4\u30f3\u30dd\u30fc\u30c8 (_i)",shareImportTip:"\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u3001\u5171\u6709\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002",shareDownload:"\u30d5\u30a1\u30a4\u30eb\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9 (_d)",shareDownloadTip:"\u753b\u9762\u5171\u6709\u3068\u30ab\u30e1\u30e9\u4ee5\u5916\u306e\u5168\u5171\u6709\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u30d5\u30a1\u30a4\u30eb\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002",shareIframe:"Web\u30da\u30fc\u30b8 (_f)",shareIframeTip:"\u8868\u793a\u3067\u304d\u308bWeb\u30da\u30fc\u30b8\u306fiframe\u3067\u8868\u793a\u3067\u304d\u308b\u3082\u306e\u306b\u9650\u3089\u308c\u307e\u3059\u3002",shareText:"\u30c6\u30ad\u30b9\u30c8 (_t / \u76f4\u63a5\u30da\u30fc\u30b9\u30c8\u53ef)",sharePaste:"\u30da\u30fc\u30b9\u30c8 (_v)",sharePasteTip:"\u30de\u30c3\u30d7\u4e0a\u3067 Ctrl+V / Cmd+V \u3067\u3082\u8cbc\u4ed8\u3051\u3067\u304d\u307e\u3059\u3002PDF\u3001\u753b\u50cf\u3001YouTube\u3001Google Docs\u3078\u306eURL\u3092\u8a8d\u8b58\u3057\u307e\u3059\u3002",shareImage:"\u753b\u50cf (_g)",shareZoneImage:"\u753b\u50cf (_g / \u76f4\u63a5\u30da\u30fc\u30b9\u30c8\u53ef)",shareImageTip:"\u30de\u30c3\u30d7\u4e0a\u3067 Ctrl+V / Cmd+V \u3067\u8cbc\u4ed8\u3051\u3067\u304d\u307e\u3059\u3002\u753b\u50cf\u306f gyazo.com \u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u307e\u3059\u3002\u753b\u50cf\u306eURL\u3082\u8cbc\u4ed8\u3051\u3067\u304d\u307e\u3059\u3002",shareWhiteboard:"\u30db\u30ef\u30a4\u30c8\u30dc\u30fc\u30c9 (_w)",shareWhiteboardTip:"wbo.ophir.dev \u306e\u30db\u30ef\u30a4\u30c8\u30dc\u30fc\u30c9\u3092\u7f6e\u304d\u307e\u3059\u3002",shareEditEnd:"\u7de8\u96c6\u7d42\u4e86",shareCamera:"\u30d3\u30c7\u30aa\u30ab\u30e1\u30e9 (_c)",shareScreenBackground:"\u80cc\u666f\u306b\u753b\u9762\u5171\u6709 (_b)",stopScreenBackground:"\u80cc\u666f\u306e\u753b\u9762\u5171\u6709\u3092\u505c\u6b62 (_b)",shareScreenContent:"\u753b\u9762\u5171\u6709 (_s)",shareScreenContentTip:"\u753b\u9762\u66f4\u65b0\u306e\u983b\u5ea6(fps)\u3092\u4e0b\u3052\u308b\u3068\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8ca0\u8377\u304c\u6e1b\u308a\u307e\u3059\u3002",stopScreen:"\u753b\u9762\u5171\u6709\u30fb\u30ab\u30e1\u30e9\u3092\u3059\u3079\u3066\u9589\u3058\u308b (_l)",shareMouse:"\u30de\u30a6\u30b9\u30ab\u30fc\u30bd\u30eb (_m)",shareMouseTip:"\u30de\u30a6\u30b9\u30ab\u30fc\u30bd\u30eb\u304c\u4ed6\u306e\u53c2\u52a0\u8005\u306b\u3082\u898b\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u30a2\u30d0\u30bf\u30fc\u306e\u76ee\u3082\u30de\u30a6\u30b9\u30ab\u30fc\u30bd\u30eb\u3092\u5411\u3044\u3066\u3044\u307e\u3059\u3002",fps:"fps",ttCreateAndshare:"\u4f5c\u6210\u3068\u5171\u6709 (_c)",stopMouse:"\u30de\u30a6\u30b9\u30ab\u30fc\u30bd\u30eb\u306e\u5171\u6709\u505c\u6b62 (_m)",frameRateSetting:"\u30d5\u30ec\u30fc\u30e0\u30ec\u30fc\u30c8",ttMicMute:"\u30de\u30a4\u30af\u306e\u30df\u30e5\u30fc\u30c8 (_m)",headphoneL1Chrome:"\u30d8\u30c3\u30c9\u30d5\u30a9\u30f3 (\u30b9\u30c6\u30ec\u30aa / \u6ce8\u610f:\u30a8\u30b3\u30ad\u30e3\u30f3\u306a\u3057)",headphoneL1:"\u30d8\u30c3\u30c9\u30d5\u30a9\u30f3 (\u30b9\u30c6\u30ec\u30aa)",headphoneL2:"\u30b9\u30d4\u30fc\u30ab\u30fc (\u30e2\u30ce\u30e9\u30eb)",etConnection:"\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a\u306a\u3057",emConnection:"\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002Binaural Meet\u306f https \u3092\u4f7f\u3044\u307e\u3059\u3002\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u63a5\u7d9a\u306e\u554f\u984c\u3067\u306a\u3051\u308c\u3070\u3001\u30b5\u30fc\u30d0\u306e\u554f\u984c\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002",etMicPermission:"\u30de\u30a4\u30af\u5229\u7528\u4e0d\u53ef",emMicPermission:"\u30d6\u30e9\u30a6\u30b6\u304c\u30de\u30a4\u30af\u306e\u5229\u7528\u3092\u8a31\u53ef\u3057\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u30d6\u30e9\u30a6\u30b6\u306eURL\u306e\u5de6\u306e\u9375\u306e\u30a2\u30a4\u30b3\u30f3\u304b\u3089\u8a31\u53ef\u3057\u3001\u30d6\u30e9\u30a6\u30b6\u3092\u30ea\u30ed\u30fc\u30c9\u3057\u3066\u304f\u3060\u3055\u3044\u3002",etNoMic:"\u30de\u30a4\u30af\u304c\u3042\u308a\u307e\u305b\u3093",emNoMic:"Binaural Meet\u306b\u306f\u30de\u30a4\u30af\u304c\u5fc5\u8981\u3067\u3059\u3002\u30d1\u30bd\u30b3\u30f3\u306b\u30de\u30a4\u30af\u304c\u3064\u3044\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002",emClose:"\u9589\u3058\u308b",emNeverShow:"\u3053\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u3067\u306f\u8868\u793a\u3057\u306a\u3044",etNoChannel:"\u30c7\u30fc\u30bf\u901a\u4fe1\u304c\u3067\u304d\u307e\u305b\u3093",emNoChannel:"\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u306e\u8a2d\u5b9a\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002Binaural Meet \u306f https(443\u756a)\u3068\u30018801-8810\u756a\u304b80\u756a\u306e\u30dd\u30fc\u30c8\u306b\u63a5\u7d9a\u3057\u307e\u3059\u3002",etRetry:"\u30d6\u30e9\u30a6\u30b6\u306e\u66f4\u65b0\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044",emRetry:"\u4e00\u5ea6\u63a5\u7d9a\u304c\u5207\u308c\u307e\u3057\u305f\u3002\u30d6\u30e9\u30a6\u30b6\u306e\u66f4\u65b0(\u30ea\u30ed\u30fc\u30c9)\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044\u3002",imageDropzoneText:"\u753b\u50cf\u3092\u30c9\u30e9\u30c3\u30b0\uff06\u30c9\u30ed\u30c3\u30d7\u3059\u308b\u304b\u3001\u30af\u30ea\u30c3\u30af\u3057\u3066\u304f\u3060\u3055\u3044",lsTitle:"\u30a2\u30d0\u30bf\u30fc\u3068\u901a\u77e5\u306e\u8a2d\u5b9a",lsColor:"\u8272",lsColorAvatar:"\u30a2\u30d0\u30bf\u30fc\u8272",lsColorText:"\u6587\u5b57\u8272",lsAutoColor:"\u81ea\u52d5",lsName:"\u304a\u540d\u524d",lsImage:"\u30a2\u30d0\u30bf\u30fc\u306e\u753b\u50cf",lsEmail:"Gravatar\u306e\u753b\u50cf\u3092\u4f7f\u3046\u5834\u5408\u306fEmail\u3092\u5165\u529b",lsImageFile:"\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u306e\u5834\u5408\u306f\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9",btSave:"\u4fdd\u5b58\u3057\u3066\u9589\u3058\u308b",btCancel:" \u3082\u3068\u306b\u623b\u3059 ",lsNotification:"\u901a\u77e5\u306e\u8a2d\u5b9a",lsNotifyCall:"\u547c\u51fa",lsNotifyTouch:"\u63a5\u89e6",lsNotifyNear:"\u63a5\u8fd1",lsNotifyYarn:"\u7cf8\u96fb\u8a71",rsCall:"\u547c\u3073\u51fa\u3059",rsConnectYarnPhone:"\u7cf8\u96fb\u8a71\u3092\u3064\u306a\u3050",rsCutYarnPhone:"\u7cf8\u96fb\u8a71\u3092\u5207\u308b",rsChatTo:"{{name}}\u3060\u3051\u306b\u30c1\u30e3\u30c3\u30c8\u3092\u9001\u308b",ctPin:"\u4f4d\u7f6e/\u30b5\u30a4\u30ba\u3092\u56fa\u5b9a\u3059\u308b",ctUnpin:"\u4f4d\u7f6e/\u30b5\u30a4\u30ba\u3092\u53ef\u5909\u306b\u3059\u308b",ctProximity:"\u4f4d\u7f6e/\u30b5\u30a4\u30ba\u3092\u56fa\u5b9a\u3059\u308b",ctUnProximity:"\u4f4d\u7f6e/\u30b5\u30a4\u30ba\u3092\u53ef\u5909\u306b\u3059\u308b",ctEditIframe:"\u30da\u30fc\u30b8\u3092\u30d6\u30e9\u30a6\u30ba (\u975e\u540c\u671f)",ctEndEditIframe:"\u30d6\u30e9\u30a6\u30ba\u3092\u7d42\u4e86 (\u540c\u671f\u306a\u3057)",ctEditText:"\u7de8\u96c6\u958b\u59cb (\u8868\u793a\u4f4d\u7f6e\u306f\u975e\u540c\u671f)",ctEndEditText:"\u7de8\u96c6\u7d42\u4e86 (\u8868\u793a\u4f4d\u7f6e\u3092\u540c\u671f)",ctEditWhiteboard:"\u7de8\u96c6\u958b\u59cb (\u8868\u793a\u4f4d\u7f6e\u306f\u975e\u540c\u671f)",ctEndEditWhiteboard:"\u7de8\u96c6\u7d42\u4e86 (\u8868\u793a\u4f4d\u7f6e\u306f\u975e\u540c\u671f)",ctEditGDrive:"\u7de8\u96c6\u958b\u59cb\u30fb\u8868\u793a\u66f4\u65b0 (\u8868\u793a\u4f4d\u7f6e\u306f\u975e\u540c\u671f)",ctEndEditGDrive:"\u7de8\u96c6\u7d42\u4e86 (\u81ea\u52d5\u66f4\u65b0\u306a\u3057)",ctEndEditYoutube:"\u518d\u751f\u4f4d\u7f6e\u3092\u540c\u671f",ctEditYoutube:"\u540c\u671f\u3057\u306a\u3044",ctMoveTop:"\u4e00\u756a\u4e0a\u306b\u79fb\u52d5",ctMoveBottom:"\u4e00\u756a\u4e0b\u306b\u79fb\u52d5",ctWallpaper:"\u58c1\u7d19\u306b\u3059\u308b",ctUnWallpaper:"\u58c1\u7d19\u304b\u3089\u306f\u305a\u3059",ctCopyToClipboard:"\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u306b\u30b3\u30d4\u30fc",ctMaximize:"\u6700\u5927\u5316\u3059\u308b\u3088\u3046\u306b\u62e1\u5927\u3059\u308b",ctUnMaximize:"\u6700\u5927\u5316\u3068\u62e1\u5927\u3092\u623b\u3059",ctFocus:"\u4e2d\u592e\u306b\u8868\u793a",ctDelete:"\u524a\u9664\u3059\u308b",ctClose:"\u9589\u3058\u308b",ctName:"\u30bf\u30a4\u30c8\u30eb",ctFrameVisible:"\u30d5\u30ec\u30fc\u30e0\u3042\u308a",ctFrameInvisible:"\u30d5\u30ec\u30fc\u30e0\u306a\u3057",ctOpenAudioZone:"\u4f1a\u8b70\u5834\u6240",ctClosedAudioZone:"\u9632\u97f3\u4f1a\u8b70\u5ba4",ctNotAudioZone:"\u305f\u3060\u306e\u753b\u50cf",ctOpaque:"\u4e0d\u900f\u660e",ctTransparent:"\u900f\u660e",upload:"\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9",Save:"\u4fdd\u5b58",Clear:"\u30af\u30ea\u30a2",Cancel:"\u30ad\u30e3\u30f3\u30bb\u30eb",broadcastMyVoice:"\u58f0\u3092\u5168\u54e1\u306b\u5c4a\u3051\u308b",soundLocalizationBasedOn:"\u97f3\u50cf\u5b9a\u4f4d\u306e\u5411\u304d\u306e\u57fa\u6e96",slAvatar:"\u30a2\u30d0\u30bf\u30fc\u306e\u5411\u304d",slUser:"\u30e6\u30fc\u30b6\u30fc\u306e\u5411\u304d(\u4e0a\u304c\u524d)",usage:"\u4f7f\u3044\u65b9",cmJoined:"{{name}}\u304c\u53c2\u52a0\u3002",cmLeft:"{{name}}\u304c\u9000\u51fa\u3002",cmNameChanged:"{{old}} \u304c {{new}} \u306b\u540d\u524d\u3092\u5909\u66f4\u3002",cmCallBy:"{{name}}\u304c\u3042\u306a\u305f\u3092\u547c\u3073\u307e\u3057\u305f\u3002",cmCallTo:"\u3042\u306a\u305f\u304c{{name}}\u3092\u547c\u3073\u307e\u3057\u305f\u3002",cmToAll:"\u5168\u54e1\u3078",cmToName:"{{name}}\u3078",cmSend:"\u9001\u4fe1 (CTRL+Enter)",cmPrivateFrom:"{{name}}\u304b\u3089\u500b\u4eba\u5b9b",cmPrivateTo:"\u81ea\u5206\u304b\u3089{{name}}\u5b9b",noCalled:"{{name}}\u304c\u547c\u3073\u307e\u3057\u305f\u3002",noTouched:"{{name}}\u304c\u89e6\u308c\u307e\u3057\u305f\u3002",noNear:"{{name}}\u304c\u8fd1\u3065\u304d\u307e\u3057\u305f\u3002",noYarn:"{{name}}\u304c\u7cf8\u96fb\u8a71\u3092\u3064\u306a\u304e\u307e\u3057\u305f\u3002",afkTitle:"\u96e2\u5e2d\u4e2d\u30e2\u30fc\u30c9 (L / Esc)",afkMessage:"\u30ad\u30fc\u304b\u30de\u30a6\u30b9\u30af\u30ea\u30c3\u30af\u3067\u623b\u308a\u307e\u3059\u3002",gdFailed:"Google Drive\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\r\n\u30d5\u30a1\u30a4\u30eb\u3092\u5171\u6709\u8a2d\u5b9a\u3092\u5909\u3048\u3001\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u4e0a\u306e\u5168\u54e1\u304c\u95b2\u89a7\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002",videoLimit:"\u6620\u50cf\u30b9\u30c8\u30ea\u30fc\u30e0\u6570\u306e\u4e0a\u9650",audioLimit:"\u97f3\u58f0\u30b9\u30c8\u30ea\u30fc\u30e0\u6570\u306e\u4e0a\u9650"}}},l=Object.keys(u),d={resources:u,supportedLngs:l,fallbackLng:l[0],interpolation:{escapeValue:!1}};function h(){return i.a.use(a.e).use(o.a).init(d)}},,,,,function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return S}));var i,o=n(14),r=n(55),a=n.n(r),s=n(10),c=n(70),u=n(32),l=n(80),d=n(20),h=n(166),p=n.n(h),f=n(340),m=n(116),v=n(216),g=n(341),b=n(342),y=n(135),A=n(18).getLogger(e),E=!1;function O(e){m.a.isBackendInitialized()||m.a.initBackend({callStatsID:e.callStatsID,callStatsSecret:e.callStatsSecret,userName:e.userName,aliasName:e.aliasName,applicationName:e.applicationName,getWiFiStatsMethod:e.getWiFiStatsMethod,confID:e.confID,siteID:e.siteID})||A.error("CallStats Backend initialization failed bad")}function S(e,t){this.rtpStatsMap=new Map,this.eventEmitter=new a.a,this.xmpp=e,this.options=t||{},this.callStatsIntegrationEnabled=this.options.callStatsID&&this.options.callStatsSecret&&this.options.enableCallStats&&!0!==S.disableThirdPartyRequests,this.callStatsIntegrationEnabled&&(this.callStatsApplicationLogsDisabled=this.options.callStatsApplicationLogsDisabled,d.a.isReactNative()?O(this.options):function(e){E||(p.a.loadScript(e.customScriptUrl||y.a,!0,!0,void 0,(function(){return O(e)})),E=!0)}(this.options),this.options.confID||A.warn('"confID" is not defined')),this.callsStatsInstances=new Map,S.instances.add(this)}S.init=function(e){S.audioLevelsEnabled=!e.disableAudioLevels,"number"===typeof e.pcStatsInterval&&(S.pcStatsInterval=e.pcStatsInterval),"number"===typeof e.audioLevelsInterval&&(S.audioLevelsInterval=e.audioLevelsInterval),"number"===typeof e.longTasksStatsInterval&&(S.longTasksStatsInterval=e.longTasksStatsInterval),S.disableThirdPartyRequests=e.disableThirdPartyRequests},S.audioLevelsEnabled=!1,S.audioLevelsInterval=200,S.pcStatsInterval=1e4,S.disableThirdPartyRequests=!1,S.analytics=f.a,Object.defineProperty(S,"instances",{get:function(){return i||(i=new Set),i}}),S.prototype.startRemoteStats=function(e){this.stopRemoteStats(e);try{var t=new b.a(e,S.audioLevelsInterval,S.pcStatsInterval,this.eventEmitter);t.start(S.audioLevelsEnabled),this.rtpStatsMap.set(e.id,t)}catch(n){A.error("Failed to start collecting remote statistics: ".concat(n))}},S.localStats=[],S.startLocalStats=function(e,t){if(S.audioLevelsEnabled){var n=new v.a(e,S.audioLevelsInterval,t);this.localStats.push(n),n.start()}},S.prototype.addAudioLevelListener=function(e){S.audioLevelsEnabled&&this.eventEmitter.on(l.a,e)},S.prototype.removeAudioLevelListener=function(e){S.audioLevelsEnabled&&this.eventEmitter.removeListener(l.a,e)},S.prototype.addBeforeDisposedListener=function(e){this.eventEmitter.on(l.b,e)},S.prototype.removeBeforeDisposedListener=function(e){this.eventEmitter.removeListener(l.b,e)},S.prototype.addConnectionStatsListener=function(e){this.eventEmitter.on(l.d,e)},S.prototype.removeConnectionStatsListener=function(e){this.eventEmitter.removeListener(l.d,e)},S.prototype.addByteSentStatsListener=function(e){this.eventEmitter.on(l.c,e)},S.prototype.removeByteSentStatsListener=function(e){this.eventEmitter.removeListener(l.c,e)},S.prototype.addLongTasksStatsListener=function(e){this.eventEmitter.on(l.e,e)},S.prototype.attachLongTasksStats=function(e){var t=this;d.a.supportsPerformanceObserver()?(this.performanceObserverStats=new g.a(this.eventEmitter,S.longTasksStatsInterval),e.on(s.CONFERENCE_JOINED,(function(){return t.performanceObserverStats.startObserver()})),e.on(s.CONFERENCE_LEFT,(function(){return t.performanceObserverStats.stopObserver()}))):A.warn("Performance observer for long tasks not supported by browser!")},S.prototype.getLongTasksStats=function(){return this.performanceObserverStats?this.performanceObserverStats.getLongTasksStats():null},S.prototype.removeLongTasksStatsListener=function(e){this.eventEmitter.removeListener(l.e,e)},S.prototype.setSpeakerList=function(e){for(var t=0,n=Array.from(this.rtpStatsMap.values());t<n.length;t++){var i=n[t];i.peerconnection.isP2P||i.setSpeakerList(e)}},S.prototype.dispose=function(){try{this.callsStatsInstances.size||this.eventEmitter.emit(l.b);var e,t=Object(o.a)(this.callsStatsInstances.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;this.stopCallStats(n.tpc)}}catch(s){t.e(s)}finally{t.f()}var i,r=Object(o.a)(this.rtpStatsMap.keys());try{for(r.s();!(i=r.n()).done;){var a=i.value;this._stopRemoteStats(a)}}catch(s){r.e(s)}finally{r.f()}this.eventEmitter&&this.eventEmitter.removeAllListeners()}finally{S.instances.delete(this)}},S.stopLocalStats=function(e){if(S.audioLevelsEnabled)for(var t=0;t<S.localStats.length;t++)if(S.localStats[t].stream===e){S.localStats.splice(t,1)[0].stop();break}},S.prototype._stopRemoteStats=function(e){var t=this.rtpStatsMap.get(e);t&&(t.stop(),this.rtpStatsMap.delete(e))},S.prototype.stopRemoteStats=function(e){this._stopRemoteStats(e.id)},S.prototype.startCallStats=function(e,t){if(this.callStatsIntegrationEnabled)if(this.callsStatsInstances.has(e.id))A.error("CallStats instance for ${tpc} exists already");else{A.info("Starting CallStats for ".concat(e,"..."));var n=new m.a(e,{confID:this.options.confID,remoteUserID:t});this.callsStatsInstances.set(e.id,n)}},S._getAllCallStatsInstances=function(){var e,t=new Set,n=Object(o.a)(S.instances);try{for(n.s();!(e=n.n()).done;){var i,r=e.value,a=Object(o.a)(r.callsStatsInstances.values());try{for(a.s();!(i=a.n()).done;){var s=i.value;t.add(s)}}catch(c){a.e(c)}finally{a.f()}}}catch(c){n.e(c)}finally{n.f()}return t},S.prototype.stopCallStats=function(e){var t=this.callsStatsInstances.get(e.id);t&&(1===this.callsStatsInstances.size&&this.eventEmitter.emit(l.b),this.callsStatsInstances.delete(e.id),t.sendTerminateEvent())},S.prototype.isCallstatsEnabled=function(){return this.callStatsIntegrationEnabled},S.prototype.sendConnectionResumeOrHoldEvent=function(e,t){var n=this.callsStatsInstances.get(e.id);n&&n.sendResumeOrHoldEvent(t)},S.prototype.sendIceConnectionFailedEvent=function(e){var t=this.callsStatsInstances.get(e.id);t&&t.sendIceConnectionFailedEvent()},S.prototype.sendMuteEvent=function(e,t,n){var i=e&&this.callsStatsInstances.get(e.id);m.a.sendMuteEvent(t,n,i)},S.prototype.sendScreenSharingEvent=function(e,t){var n,i=Object(o.a)(this.callsStatsInstances.values());try{for(i.s();!(n=i.n()).done;){n.value.sendScreenSharingEvent(e,t)}}catch(r){i.e(r)}finally{i.f()}},S.prototype.sendDominantSpeakerEvent=function(e){var t,n=Object(o.a)(this.callsStatsInstances.values());try{for(n.s();!(t=n.n()).done;){t.value.sendDominantSpeakerEvent()}}catch(i){n.e(i)}finally{n.f()}this.xmpp.sendDominantSpeakerEvent(e)},S.sendActiveDeviceListEvent=function(e){var t=S._getAllCallStatsInstances();if(t.size){var n,i=Object(o.a)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;m.a.sendActiveDeviceListEvent(e,r)}}catch(a){i.e(a)}finally{i.f()}}else m.a.sendActiveDeviceListEvent(e,null)},S.prototype.associateStreamWithVideoTag=function(e,t,n,i,o,r){var a=this.callsStatsInstances.get(e.id);a&&a.associateStreamWithVideoTag(t,n,i,o,r)},S.sendGetUserMediaFailed=function(e){var t=e instanceof c.a?function(e){var t=new Error;return t.stack=e.stack,t.name=(e.name||"Unknown error")+(e.gum&&e.gum.error&&e.gum.error.name?" - ".concat(e.gum.error.name):""),t.constraintName=e.gum&&e.gum.constraints?JSON.stringify(e.gum.constraints):"",t.message=e.message,t}(e):e,n=S._getAllCallStatsInstances();if(n.size){var i,r=Object(o.a)(n);try{for(r.s();!(i=r.n()).done;){var a=i.value;m.a.sendGetUserMediaFailed(t,a)}}catch(s){r.e(s)}finally{r.f()}}else m.a.sendGetUserMediaFailed(t,null)},S.prototype.sendCreateOfferFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendCreateOfferFailed(e)},S.prototype.sendCreateAnswerFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendCreateAnswerFailed(e)},S.prototype.sendSetLocalDescFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendSetLocalDescFailed(e)},S.prototype.sendSetRemoteDescFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendSetRemoteDescFailed(e)},S.prototype.sendAddIceCandidateFailed=function(e,t){var n=this.callsStatsInstances.get(t.id);n&&n.sendAddIceCandidateFailed(e)},S.sendLog=function(e){var t,n=new Set,i=Object(o.a)(S.instances);try{for(i.s();!(t=i.n()).done;){var r=t.value;if(r.callStatsApplicationLogsDisabled)return;r.callsStatsInstances.size&&n.add(r.callsStatsInstances.values().next().value)}}catch(u){i.e(u)}finally{i.f()}if(n.size){var a,s=Object(o.a)(n);try{for(s.s();!(a=s.n()).done;){var c=a.value;m.a.sendApplicationLog(e,c)}}catch(u){s.e(u)}finally{s.f()}}else m.a.sendApplicationLog(e,null)},S.prototype.sendFeedback=function(e,t){return S.analytics.sendEvent(u.n,{rating:e,comment:t}),m.a.sendFeedback(this.options.confID,e,t)},S.LOCAL_JID=n(496).LOCAL_JID,S.reportGlobalError=function(e){e instanceof c.a&&e.gum?S.sendGetUserMediaFailed(e):S.sendLog(e)},S.sendAnalyticsAndLog=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e?(t="object"===typeof e?e:{name:e,properties:n},A.log(JSON.stringify(t)),this.analytics.sendEvent(e,n)):A.warn("No event or event name given.")},S.sendAnalytics=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.analytics.sendEvent(e,t)}}).call(this,"/index.js")},,function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"d",(function(){return u})),n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return d}));var i=n(7),o=Object(i.a)(Object(i.a)({},{PARTICIPANT_AFK:"p_afk",PARTICIPANT_TRACKSTATES:"p_trackSt"}),{},{PARTICIPANT_INFO:"p_info",MAIN_SCREEN_CARRIER:"main_screen_carrier",MY_CONTENT:"my_content"}),r={PARTICIPANT_TRACKLIMITS:"m_track_limits",YARN_PHONE:"YARN_PHONE",CHAT_MESSAGE:"m_chat",CALL_REMOTE:"call_remote",MUTE_VIDEO:"m_mute_video",MUTE_AUDIO:"m_mute_audio",RELOAD_BROWSER:"m_reload",KICK:"m_kick"},a=(new Set(Object.values(r)),{CONTENT_UPDATE_REQUEST:"c_update",CONTENT_INFO_UPDATE:"c_info_update"}),s=new Set(Object.values(a)),c={LEFT_CONTENT_REMOVE_REQUEST:"left_c_remove",CONTENT_REMOVE_REQUEST:"c_remove",PARTICIPANT_OUT:"p_out",MOUSE_OUT:"m_out",CONTENT_OUT:"c_out"},u=new Set(Object.values(c)),l={CONTENT_UPDATE_REQUEST_BY_ID:"c_update_by_id",REQUEST_ALL:"req_all",REQUEST_RANGE:"req_range",REQUEST_PARTICIPANT_STATES:"req_p_state"},d=Object(i.a)(Object(i.a)(Object(i.a)(Object(i.a)(Object(i.a)(Object(i.a)(Object(i.a)({},a),c),r),o),{PARTICIPANT_POSE:"mp",PARTICIPANT_MOUSE:"mm",PARTICIPANT_ON_STAGE:"p_onStage"}),l),{},{PARTICIPANT_LEFT:"m_participant_left",ROOM_PROP:"room_prop",REQUEST_TO:"req_to",FRAGMENT_HEAD:"frag_head",FRAGMENT_CONTENT:"frag_cont"})},function(e,t,n){"use strict";var i=n(89);n.d(t,"a",(function(){return i.a}));n(160);var o=n(161);n.d(t,"b",(function(){return o.a}))},function(e,t){e.exports={CREATE_ANSWER_FAILED:"rtc.create_answer_failed",CREATE_OFFER_FAILED:"rtc.create_offer_failed",DATA_CHANNEL_OPEN:"rtc.data_channel_open",ENDPOINT_CONN_STATUS_CHANGED:"rtc.endpoint_conn_status_changed",DOMINANT_SPEAKER_CHANGED:"rtc.dominant_speaker_changed",LASTN_ENDPOINT_CHANGED:"rtc.lastn_endpoint_changed",PERCEPTIBLE_CHANGED:"rtc.perceptibles_changed",PERMISSIONS_CHANGED:"rtc.permissions_changed",SENDER_VIDEO_CONSTRAINTS_CHANGED:"rtc.sender_video_constraints_changed",LASTN_VALUE_CHANGED:"rtc.lastn_value_changed",LOCAL_TRACK_SSRC_UPDATED:"rtc.local_track_ssrc_updated",LOCAL_TRACK_MAX_ENABLED_RESOLUTION_CHANGED:"rtc.local_track_max_enabled_resolution_changed",TRACK_ATTACHED:"rtc.track_attached",REMOTE_TRACK_ADDED:"rtc.remote_track_added",REMOTE_TRACK_MUTE:"rtc.remote_track_mute",REMOTE_TRACK_REMOVED:"rtc.remote_track_removed",REMOTE_TRACK_UNMUTE:"rtc.remote_track_unmute",SET_LOCAL_DESCRIPTION_FAILED:"rtc.set_local_description_failed",SET_REMOTE_DESCRIPTION_FAILED:"rtc.set_remote_description_failed",AUDIO_OUTPUT_DEVICE_CHANGED:"rtc.audio_output_device_changed",DEVICE_LIST_CHANGED:"rtc.device_list_changed",DEVICE_LIST_WILL_CHANGE:"rtc.device_list_will_change",DEVICE_LIST_AVAILABLE:"rtc.device_list_available",ENDPOINT_MESSAGE_RECEIVED:"rtc.endpoint_message_received",ENDPOINT_STATS_RECEIVED:"rtc.endpoint_stats_received",LOCAL_UFRAG_CHANGED:"rtc.local_ufrag_changed",REMOTE_UFRAG_CHANGED:"rtc.remote_ufrag_changed"}},function(e,t,n){"use strict";n.d(t,"t",(function(){return o})),n.d(t,"u",(function(){return r})),n.d(t,"v",(function(){return a})),n.d(t,"w",(function(){return s})),n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return l})),n.d(t,"d",(function(){return d})),n.d(t,"e",(function(){return h})),n.d(t,"f",(function(){return p})),n.d(t,"g",(function(){return f})),n.d(t,"h",(function(){return m})),n.d(t,"i",(function(){return v})),n.d(t,"j",(function(){return g})),n.d(t,"k",(function(){return b})),n.d(t,"l",(function(){return y})),n.d(t,"m",(function(){return A})),n.d(t,"n",(function(){return E})),n.d(t,"o",(function(){return O})),n.d(t,"p",(function(){return S})),n.d(t,"q",(function(){return C})),n.d(t,"r",(function(){return _})),n.d(t,"s",(function(){return j})),n.d(t,"z",(function(){return T})),n.d(t,"B",(function(){return k})),n.d(t,"A",(function(){return I})),n.d(t,"C",(function(){return R})),n.d(t,"D",(function(){return w})),n.d(t,"E",(function(){return D})),n.d(t,"F",(function(){return N})),n.d(t,"J",(function(){return P})),n.d(t,"G",(function(){return M})),n.d(t,"H",(function(){return L})),n.d(t,"I",(function(){return x})),n.d(t,"K",(function(){return F})),n.d(t,"L",(function(){return B})),n.d(t,"M",(function(){return U})),n.d(t,"x",(function(){return V})),n.d(t,"y",(function(){return J})),n.d(t,"N",(function(){return G}));var i=n(7),o="operational",r="page",a="track",s="ui",c="restart",u="session-accept.timeout",l="session-initiate.received",d="session-initiate.timeout",h="terminate",p="transport-replace.received",f="transport-replace.success",m="decline",v="established",g="failed",b="switch.to.jvb",y="available.device",A="connection.disconnected",E="feedback",O="ice.duration",S="ice.establishment.duration.diff",C="ice.state.changed",_="track.no-bytes-sent",j="track.unmuted",T=function(){var e="bridge.down";return{action:e,actionSubject:e,type:o}},k=function(e,t,n){return{type:o,action:"connection.failed",attributes:Object(i.a)({error_type:e,error_message:t},n)}};function I(e,t){return{action:e,attributes:t,source:"conference",type:o}}var R=function(e,t){var n="connection.stage.reached";return{action:n,actionSubject:e,attributes:t,source:n,type:o}},w=function(e,t,n){return{attributes:{participant_id:e,region:t,rtt:n},name:"e2e_rtt",type:o}},D=function(){var e="focus.left";return{action:e,actionSubject:e,type:o}},N=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{type:o,source:"get.user.media",action:e,attributes:t}},P=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="duration";return{type:o,source:"peer.conn.status",action:t,attributes:e}},M=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{type:o,action:e,source:"jingle",attributes:t}},L=function(e,t){return{attributes:{media_type:e,value:t},action:"track.no.data.from.source",type:o}},x=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{type:o,action:e,source:"p2p",attributes:t}},F=function(e){return{type:o,action:"remotely.muted",mediaType:e}},B=function(e){return{type:o,action:"rtp.stats",attributes:e}},U=function(e){return{type:o,action:"transport.stats",attributes:e}};function V(e,t,n){return{type:o,action:"audio.output.problem",attributes:{userID:e,localAudioLevels:t,remoteAudioLevels:n}}}var J=function(e,t){return{type:o,action:"bridge-channel.error",attributes:{code:e,reason:t}}},G=function(e){return R("ttfm",e)}},function(e,t,n){"use strict";(function(e){var i=n(69),o=n(14),r=n(18),a=n(71),s=n.n(a),c=n(38),u=n.n(c),l=n(20),d=n(120),h=n.n(d),p=Object(r.getLogger)(e),f={filterSpecialChars:function(e){return e?e.replace(/[\\\/\{,\}\+]/g,""):e},iceparams:function(e,t){var n,i,o=null;return(i=f.findLine(e,"a=ice-ufrag:",t))&&(n=f.findLine(e,"a=ice-pwd:",t))&&(o={ufrag:f.parseICEUfrag(i),pwd:f.parseICEPwd(n)}),o},parseICEUfrag:function(e){return e.substring(12)},buildICEUfrag:function(e){return"a=ice-ufrag:".concat(e)},parseICEPwd:function(e){return e.substring(10)},buildICEPwd:function(e){return"a=ice-pwd:".concat(e)},parseMID:function(e){return e.substring(6)},parseMLine:function(e){var t={},n=e.substring(2).split(" ");return t.media=n.shift(),t.port=n.shift(),t.proto=n.shift(),""===n[n.length-1]&&n.pop(),t.fmt=n,t},buildMLine:function(e){return"m=".concat(e.media," ").concat(e.port," ").concat(e.proto," ").concat(e.fmt.join(" "))},parseRTPMap:function(e){var t={},n=e.substring(9).split(" ");return t.id=n.shift(),n=n[0].split("/"),t.name=n.shift(),t.clockrate=n.shift(),t.channels=n.length?n.shift():"1",t},parseSCTPMap:function(e){var t=e.substring(10).split(" ");return[t[0],t[1],t.length>2?t[2]:null]},buildRTPMap:function(e){var t="a=rtpmap:".concat(e.getAttribute("id")," ").concat(e.getAttribute("name"),"/").concat(e.getAttribute("clockrate"));return e.getAttribute("channels")&&"1"!==e.getAttribute("channels")&&(t+="/".concat(e.getAttribute("channels"))),t},parseCrypto:function(e){var t={},n=e.substring(9).split(" ");return t.tag=n.shift(),t["crypto-suite"]=n.shift(),t["key-params"]=n.shift(),n.length&&(t["session-params"]=n.join(" ")),t},parseFingerprint:function(e){var t={},n=e.substring(14).split(" ");return t.hash=n.shift(),t.fingerprint=n.shift(),t},parseFmtp:function(e){var t=[],n=e.split(" ");n.shift(),n=n.join(" ").split(";");for(var i=0;i<n.length;i++){for(var o=n[i].split("=")[0];o.length&&" "===o[0];)o=o.substring(1);var r=n[i].split("=")[1];o&&r?t.push({name:o,value:r}):o&&t.push({name:"",value:o})}return t},parseICECandidate:function(e){var t={},n=e.split(" ");t.foundation=n[0].substring(12),t.component=n[1],t.protocol=n[2].toLowerCase(),t.priority=n[3],t.ip=n[4],t.port=n[5],t.type=n[7],t.generation=0;for(var i=8;i<n.length;i+=2)switch(n[i]){case"raddr":t["rel-addr"]=n[i+1];break;case"rport":t["rel-port"]=n[i+1];break;case"generation":t.generation=n[i+1];break;case"tcptype":t.tcptype=n[i+1];break;default:p.log('parseICECandidate not translating "'.concat(n[i],'" = "').concat(n[i+1],'"'))}return t.network="1",t.id=Math.random().toString(36).substr(2,10),t},buildICECandidate:function(e){var t=["a=candidate:".concat(e.foundation),e.component,e.protocol,e.priority,e.ip,e.port,"typ",e.type].join(" ");switch(t+=" ",e.type){case"srflx":case"prflx":case"relay":e.hasOwnAttribute("rel-addr")&&e.hasOwnAttribute("rel-port")&&(t+="raddr",t+=" ",t+=e["rel-addr"],t+=" ",t+="rport",t+=" ",t+=e["rel-port"],t+=" ")}return e.hasOwnAttribute("tcptype")&&(t+="tcptype",t+=" ",t+=e.tcptype,t+=" "),t+="generation",t+=" ",t+=e.hasOwnAttribute("generation")?e.generation:"0"},parseSSRC:function(e){for(var t=new Map,n=e.split("\r\n"),i=0;i<n.length;i++)if("a=ssrc:"===n[i].substring(0,7)){var o=n[i].split("a=ssrc:")[1].split(" ")[0];t.get(o)||t.set(o,[]),t.get(o).push(n[i])}return t},parseRTCPFB:function(e){var t=e.substr(10).split(" "),n={};return n.pt=t.shift(),n.type=t.shift(),n.params=t,n},parseExtmap:function(e){var t=e.substr(9).split(" "),n={};return n.value=t.shift(),-1===n.value.indexOf("/")?n.direction="both":(n.direction=n.value.substr(n.value.indexOf("/")+1),n.value=n.value.substr(0,n.value.indexOf("/"))),n.uri=t.shift(),n.params=t,n},findLine:function(e,t,n){for(var i=e.split("\r\n"),o=0;o<i.length;o++)if(i[o].substring(0,t.length)===t)return i[o];if(!n)return!1;i=n.split("\r\n");for(var r=0;r<i.length;r++)if(i[r].substring(0,t.length)===t)return i[r];return!1},findLines:function(e,t,n){for(var i=e.split("\r\n"),o=[],r=0;r<i.length;r++)i[r].substring(0,t.length)===t&&o.push(i[r]);if(o.length||!n)return o;i=n.split("\r\n");for(var a=0;a<i.length;a++)i[a].substring(0,t.length)===t&&o.push(i[a]);return o},candidateToJingle:function(e){if(0===e.indexOf("candidate:"))e="a=".concat(e);else if("a=candidate:"!==e.substring(0,12))return p.log("parseCandidate called with a line that is not a candidate line"),p.log(e),null;"\r\n"===e.substring(e.length-2)&&(e=e.substring(0,e.length-2));var t={},n=e.split(" ");if("typ"!==n[6])return p.log("did not find typ in the right place"),p.log(e),null;t.foundation=n[0].substring(12),t.component=n[1],t.protocol=n[2].toLowerCase(),t.priority=n[3],t.ip=n[4],t.port=n[5],t.type=n[7],t.generation="0";for(var i=8;i<n.length;i+=2)switch(n[i]){case"raddr":t["rel-addr"]=n[i+1];break;case"rport":t["rel-port"]=n[i+1];break;case"generation":t.generation=n[i+1];break;case"tcptype":t.tcptype=n[i+1];break;default:p.log('not translating "'.concat(n[i],'" = "').concat(n[i+1],'"'))}return t.network="1",t.id=Math.random().toString(36).substr(2,10),t},candidateFromJingle:function(e){var t="a=candidate:";t+=e.getAttribute("foundation"),t+=" ",t+=e.getAttribute("component"),t+=" ";var n=e.getAttribute("protocol");switch(l.a.isFirefox()&&"ssltcp"===n.toLowerCase()&&(n="tcp"),t+=n,t+=" ",t+=e.getAttribute("priority"),t+=" ",t+=e.getAttribute("ip"),t+=" ",t+=e.getAttribute("port"),t+=" ",t+="typ",t+=" ".concat(e.getAttribute("type")),t+=" ",e.getAttribute("type")){case"srflx":case"prflx":case"relay":e.getAttribute("rel-addr")&&e.getAttribute("rel-port")&&(t+="raddr",t+=" ",t+=e.getAttribute("rel-addr"),t+=" ",t+="rport",t+=" ",t+=e.getAttribute("rel-port"),t+=" ")}return"tcp"===n.toLowerCase()&&(t+="tcptype",t+=" ",t+=e.getAttribute("tcptype"),t+=" "),t+="generation",t+=" ",t+=e.getAttribute("generation")||"0","".concat(t,"\r\n")},parsePrimaryVideoSsrc:function(e){var t=e.ssrcs.map((function(e){return e.id})).filter((function(e,t,n){return n.indexOf(e)===t})).length,n=e.ssrcGroups&&e.ssrcGroups.length||0;if(!(t>1&&0===n)){var i=null;if(1===t)i=e.ssrcs[0].id;else if(2===t){var o=e.ssrcGroups.find((function(e){return"FID"===e.semantics}));o&&(i=o.ssrcs.split(" ")[0])}else if(t>=3){var r=e.ssrcGroups.find((function(e){return"SIM"===e.semantics}));r&&(i=r.ssrcs.split(" ")[0])}return i}},generateSsrc:function(){return h.a.randomInt(1,4294967295)},getSsrcAttribute:function(e,t,n){for(var i=0;i<e.ssrcs.length;++i){var o=e.ssrcs[i];if(o.id===t&&o.attribute===n)return o.value}},parseGroupSsrcs:function(e){return e.ssrcs.split(" ").map((function(e){return parseInt(e,10)}))},getMedia:function(e,t){return e.media.find((function(e){return e.type===t}))},getUfrag:function(e){var t=e.split("\n").filter((function(e){return e.startsWith("a=ice-ufrag:")}));if(t.length>0)return t[0].substr("a=ice-ufrag:".length)},preferCodec:function(e,t){if(e&&t){var n=e.rtp.filter((function(e){return e.codec&&e.codec.toLowerCase()===t.toLowerCase()})).map((function(e){return e.payload}));if(n){var i,r=e.payloads.toString().split(" ").map((function(e){return parseInt(e,10)})),a=Object(o.a)(n.reverse());try{for(a.s();!(i=a.n()).done;){var s=i.value,c=r.indexOf(s);r.splice(c,1),r.unshift(s)}}catch(u){a.e(u)}finally{a.f()}e.payloads=r.join(" ")}}},stripCodec:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e&&t){var r,a=[],c=[],l=t.toLowerCase()===s.a.H264&&n,d=Object(o.a)(e.rtp);try{for(d.s();!(r=d.n()).done;){var h=r.value;h.codec&&h.codec.toLowerCase()===t.toLowerCase()&&(l?a.push(h.payload):c.push(h.payload))}}catch(b){d.e(b)}finally{d.f()}if(l&&(c=e.fmtp.filter((function(e){return a.indexOf(e.payload)>-1&&e.config.includes("profile-level-id=64")})).map((function(e){return e.payload}))),c.length>0){var p,f=c.map((function(e){return"apt=".concat(e)})),m=e.fmtp.filter((function(e){return-1!==f.indexOf(e.config)}));(p=c).push.apply(p,Object(i.a)(m.map((function(e){return e.payload}))));var v=e.payloads.toString().split(" ").map(Number),g=v.filter((function(e){return-1===c.indexOf(e)}));0===g.length?(e.port=0,e.direction=u.a.INACTIVE,e.payloads="*"):e.payloads=g.join(" "),e.rtp=e.rtp.filter((function(e){return-1!==g.indexOf(e.payload)})),e.fmtp=e.fmtp.filter((function(e){return-1!==g.indexOf(e.payload)})),e.rtcpFb&&(e.rtcpFb=e.rtcpFb.filter((function(e){return-1!==g.indexOf(e.payload)})))}}}};t.a=f}).call(this,"/index.js")},,,,,function(e,t){e.exports={INACTIVE:"inactive",RECVONLY:"recvonly",SENDONLY:"sendonly",SENDRECV:"sendrecv"}},,function(e,t,n){"use strict";(function(e){var i=n(66),o=n(6),r=n(8),a=n(35),s=n(34),c=n(55),u=n.n(c),l=n(18),d=n(137),h=n.n(d),p=n(70),f=n(52),m=n(153),v=n.n(m),g=n(31),b=n.n(g),y=n(220),A=n.n(y),E=n(47),O=n.n(E),S=n(32),C=n(20),_=n(33),j=n(27),T=n(41),k=n.n(T),I=n(72),R=n(152),w=Object(l.getLogger)(e);C.a.usesAdapter()&&n(654);var D,N=new u.a,P={video:{height:{ideal:720,max:720,min:180},width:{ideal:1280,max:1280,min:320}}},M="default",L=!1,x=!1,F=!1,B=!1,U=!1,V=null,J=document.createElement("audio"),G="undefined"!==typeof J.setSinkId,H=[];function z(){}function Q(e,t){var n=Boolean(t)&&t.getAudioTracks().length>0,i=Boolean(t)&&t.getVideoTracks().length>0,o={};-1!==e.indexOf("video")&&(o.video=i),-1!==e.indexOf("audio")&&(o.audio=n),N.emit(b.a.PERMISSIONS_CHANGED,o)}function K(e){var t=e.filter((function(e){return"audioinput"===e.kind})).length,n=e.filter((function(e){return"audiooutput"===e.kind})).length,i=e.filter((function(e){return"videoinput"===e.kind})).length,o=e.filter((function(e){return"videooutput"===e.kind})).length;e.forEach((function(e){var r={audio_input_device_count:t,audio_output_device_count:n,video_input_device_count:i,video_output_device_count:o,device_id:e.deviceId,device_group_id:e.groupId,device_kind:e.kind,device_label:e.label};j.a.sendAnalytics(S.l,r)}))}function Y(e){(function(e){return e.length!==H.length||e.map(t).sort().join("")!==H.map(t).sort().join("");function t(e){return JSON.stringify({kind:e.kind,deviceId:e.deviceId,groupId:e.groupId,label:e.label,facing:e.facing})}})(e)&&(H=e.slice(0),w.info("list of media devices has changed:",H),K(H),N.emit(b.a.DEVICE_LIST_WILL_CHANGE,H),N.emit(b.a.DEVICE_LIST_CHANGED,H))}var W=new(function(e){Object(a.a)(n,e);var t=Object(s.a)(n);function n(){return Object(o.a)(this,n),t.call(this,N)}return Object(r.a)(n,[{key:"init",value:function(){var e,t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"boolean"===typeof n.disableAEC&&(F=n.disableAEC,w.info("Disable AEC: ".concat(F))),"boolean"===typeof n.disableNS&&(B=n.disableNS,w.info("Disable NS: ".concat(B))),"boolean"===typeof n.disableAP&&(x=n.disableAP,w.info("Disable AP: ".concat(x))),"boolean"===typeof n.disableAGC&&(U=n.disableAGC,w.info("Disable AGC: ".concat(U))),"boolean"===typeof(null===(e=n.audioQuality)||void 0===e?void 0:e.stereo)&&(V=n.audioQuality.stereo,w.info("Stereo: ".concat(V))),window.clearInterval(D),D=void 0,C.a.isReactNative()?(this.RTCPeerConnectionType=RTCPeerConnection,this.attachMediaStream=void 0,this.getStreamID=function(e){var t=e.id;return"number"===typeof t?t:_.a.filterSpecialChars(t)},this.getTrackID=function(e){return e.id}):(this.RTCPeerConnectionType=RTCPeerConnection,this.attachMediaStream=q((function(e,t){e&&(e.srcObject=t)})),this.getStreamID=function(e){return e.id},this.getTrackID=function(e){return e.id}),this.pcConstraints=C.a.isChromiumBased()||C.a.isReactNative()?{optional:[{googScreencastMinBitrate:100},{googCpuOveruseDetection:!0}]}:{},R.b.init(n),this.isDeviceListAvailable()&&this.enumerateDevices((function(e){H=e.slice(0),w.debug("Available devices: ",H),K(H),N.emit(b.a.DEVICE_LIST_AVAILABLE,H),C.a.supportsDeviceChangeEvent()?navigator.mediaDevices.addEventListener("devicechange",(function(){return t.enumerateDevices(z)})):D=window.setInterval((function(){return t.enumerateDevices(z)}),3e3)}))}},{key:"enumerateDevices",value:function(e){navigator.mediaDevices.enumerateDevices().then((function(t){Y(t),e(t)})).catch((function(t){w.warn("Failed to  enumerate devices. ".concat(t)),Y([]),e([])}))}},{key:"_getUserMedia",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return new Promise((function(i,o){var r,a=!1;"number"===typeof n&&!isNaN(n)&&n>0&&(r=setTimeout((function(){a=!0,r=void 0,o(new p.a(f.TIMEOUT))}),n)),navigator.mediaDevices.getUserMedia(t).then((function(t){w.log("onUserMediaSuccess"),Q(e,t),a||("undefined"!==typeof r&&clearTimeout(r),i(t))})).catch((function(n){w.warn("Failed to get access to local media. ".concat(n," ").concat(JSON.stringify(t)));var i=new p.a(n,t,e);a||("undefined"!==typeof r&&clearTimeout(r),o(n)),i.name===f.PERMISSION_DENIED&&Q(e,void 0)}))}))}},{key:"_getDesktopMedia",value:function(){return R.b.isSupported()?new Promise((function(e,t){R.b.obtainStream((function(t){e(t)}),(function(e){t(e)}))})):Promise.reject(new Error("Desktop sharing is not supported!"))}},{key:"_getMissingTracks",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=[],i=e.includes("audio"),o=t&&t.getAudioTracks().length>0;i&&!o&&n.push("audio");var r=e.includes("video"),a=t&&t.getVideoTracks().length>0;return r&&!a&&n.push("video"),n}},{key:"obtainAudioAndVideoPermissions",value:function(e){var t=this,n=e.timeout,o=Object(i.a)(e,["timeout"]),r=[],a=function(){if(!(-1!==(o.devices||[]).indexOf("desktop")))return Promise.resolve();var e=o.desktopSharingSourceDevice;if(e){var t=H&&H.find((function(t){return"videoinput"===t.kind&&(t.deviceId===e||t.label===e)}));if(!t)return Promise.reject(new p.a({name:"ConstraintNotSatisfiedError"},{},[e]));var i={video:{deviceId:t.deviceId}};return this._getUserMedia(["video"],i,n).then((function(e){return{sourceType:"device",stream:e}}))}return this._getDesktopMedia()}.bind(this),s=function(){var e=(o.devices||["audio","video"]).filter((function(e){return"audio"===e||"video"===e}));if(!e.length)return Promise.resolve();var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=h()(t.constraints||P);if(e.indexOf("video")>=0){if(A.a[t.resolution]){var i=A.a[t.resolution];n.video={height:{ideal:i.height},width:{ideal:i.width}}}if(n.video||(n.video={}),C.a.isWebKitBased()&&(n.video.height&&n.video.height.ideal?n.video.height={ideal:n.video.height.ideal}:w.warn("Ideal camera height missing, camera may not start properly"),n.video.width&&n.video.width.ideal?n.video.width={ideal:n.video.width.ideal}:w.warn("Ideal camera width missing, camera may not start properly")),t.cameraDeviceId)n.video.deviceId=t.cameraDeviceId;else{var o=t.facingMode||v.a.USER;n.video.facingMode=o}}else n.video=!1;return e.indexOf("audio")>=0?(n.audio&&"boolean"!==typeof n.audio||(n.audio={}),n.audio={autoGainControl:!U&&!x,deviceId:t.micDeviceId,echoCancellation:!F&&!x,noiseSuppression:!B&&!x},V&&Object.assign(n.audio,{channelCount:2})):n.audio=!1,n}(e,o);return w.info("Got media constraints: ",JSON.stringify(t)),this._getUserMedia(e,t,n)}.bind(this);return a().then((function(e){if(e){var t=e.stream,n=e.sourceId,i=e.sourceType,o=t.getAudioTracks();if(o.length){var a=new MediaStream(o);r.push({stream:a,sourceId:n,sourceType:i,track:a.getAudioTracks()[0]})}var s=t.getVideoTracks();if(s.length){var c=new MediaStream(s);r.push({stream:c,sourceId:n,sourceType:i,track:c.getVideoTracks()[0],videoType:O.a.DESKTOP})}}})).then(s).then((function(e){if(e){var t=e.getAudioTracks();if(t.length){var n=new MediaStream(t);r.push({stream:n,track:n.getAudioTracks()[0],effects:o.effects})}var i=e.getVideoTracks();if(i.length){var a=new MediaStream(i);r.push({stream:a,track:a.getVideoTracks()[0],videoType:O.a.CAMERA,effects:o.effects})}}})).then((function(){return r})).catch((function(e){return r.forEach((function(e){var n=e.stream;t.stopMediaStream(n)})),Promise.reject(e)}))}},{key:"isDeviceListAvailable",value:function(){return Boolean(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)}},{key:"isDeviceChangeAvailable",value:function(e){return"output"!==e&&"audiooutput"!==e||G}},{key:"stopMediaStream",value:function(e){e&&(e.getTracks().forEach((function(e){e.stop&&e.stop()})),e.stop&&e.stop(),e.release&&e.release())}},{key:"isDesktopSharingEnabled",value:function(){return R.b.isSupported()}},{key:"setAudioOutputDevice",value:function(e){return this.isDeviceChangeAvailable("output")?J.setSinkId(e).then((function(){M=e,L=!0,w.log("Audio output device set to ".concat(e)),N.emit(b.a.AUDIO_OUTPUT_DEVICE_CHANGED,e)})):Promise.reject(new Error("Audio output device change is not supported"))}},{key:"getAudioOutputDevice",value:function(){return M}},{key:"getCurrentlyAvailableMediaDevices",value:function(){return H}},{key:"arePermissionsGrantedForAvailableDevices",value:function(){return H.some((function(e){return Boolean(e.label)}))}},{key:"getEventDataForActiveDevice",value:function(e){var t=[],n={deviceId:e.deviceId,kind:e.kind,label:e.label,groupId:e.groupId};return t.push(n),{deviceList:t}}},{key:"setSuspendVideo",value:function(e,t){e.optional||(e.optional=[]),e.optional=e.optional.filter((function(e){return!e.hasOwnProperty("googSuspendBelowMinBitrate")})),t&&e.optional.push({googSuspendBelowMinBitrate:"true"})}}]),n}(I.a));function q(e){return function(t,n){var i=e.apply(W,arguments);return n&&W.isDeviceChangeAvailable("output")&&n.getAudioTracks&&n.getAudioTracks().length&&L&&t.setSinkId(W.getAudioOutputDevice()).catch((function(e){var n=new p.a(e,null,["audiooutput"]);k.a.callUnhandledRejectionHandler({promise:this,reason:n}),w.warn("Failed to set audio output device for the element. Default audio output device will be used instead",t,n)})),i}}t.a=W}).call(this,"/index.js")},function(e,t){var n=[],i=window.onerror;var o=window.onunhandledrejection;window.onerror=function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];n.forEach((function(e){return e.apply(void 0,t)})),i&&i.apply(void 0,t)},window.onunhandledrejection=function(e){n.forEach((function(t){return t(null,null,null,null,e.reason)})),o&&o(e)};var r={addHandler:function(e){n.push(e)},callErrorHandler:function(e){var t=window.onerror;t&&t(null,null,null,null,e)},callUnhandledRejectionHandler:function(e){var t=window.onunhandledrejection;t&&t(e)}};e.exports=r},function(e,t,n){"use strict";n.d(t,"r",(function(){return m})),n.d(t,"b",(function(){return b})),n.d(t,"d",(function(){return A})),n.d(t,"f",(function(){return E})),n.d(t,"e",(function(){return O})),n.d(t,"g",(function(){return j})),n.d(t,"c",(function(){return T})),n.d(t,"h",(function(){return k})),n.d(t,"i",(function(){return R})),n.d(t,"k",(function(){return w})),n.d(t,"j",(function(){return N})),n.d(t,"a",(function(){return M})),n.d(t,"p",(function(){return L})),n.d(t,"l",(function(){return x})),n.d(t,"n",(function(){return F})),n.d(t,"o",(function(){return B})),n.d(t,"m",(function(){return U})),n.d(t,"t",(function(){return V})),n.d(t,"s",(function(){return J})),n.d(t,"q",(function(){return G}));var i=n(14),o=n(6),r=n(215),a=n(184),s=n(46),c=n(4),u=n(243),l=n(44),d=n.n(l),h=n(12),p=n(15),f=Object.assign({},u.b,{name:"",ownerName:"",color:[],textColor:[],type:"",url:"",size:[0,0],originalSize:[0,0],id:"",zorder:0,pinned:!1,shareType:""});function m(e){return e}var v,g=function e(){Object(o.a)(this,e),this.name=void 0,this.ownerName=void 0,this.color=void 0,this.textColor=void 0,this.type=void 0,this.url=void 0,this.id=void 0,this.zorder=void 0,this.pinned=void 0,this.pose=void 0,this.size=void 0,this.originalSize=void 0,this.noFrame=void 0,this.opacity=void 0,this.shareType=void 0,Object.assign(this,d.a.cloneDeep(f))};function b(){var e=new g;return e.ownerName=h.a.local.information.name,e.color=h.a.local.information.color,e.textColor=h.a.local.information.textColor,e.zorder=Date.now(),e}function y(e,t,n){e.type="pdf",e.url=t,e.pose.position[0]=n.mouseOnMap[0],e.pose.position[1]=n.mouseOnMap[1],e.size[0]=500,e.size[1]=1.41421356*e.size[0]}function A(e,t){return new Promise((function(n,o){var a=b(),s=new URL(e);if("youtu.be"===s.hostname||"youtube.com"===s.hostname||"www.youtube.com"===s.hostname){var u=s.search.slice(1).split("&"),l=new Map(u.map((function(e){return e.split("=")})));"youtu.be"===s.hostname&&l.set("v",s.pathname.slice(1)),a.url="";var d,h=Object(i.a)(l);try{for(h.s();!(d=h.n()).done;){var f=d.value;""===a.url?a.url="".concat(f[0],"=").concat(f[1]):a.url="".concat(a.url,"&").concat(f[0],"=").concat(f[1])}}catch(g){h.e(g)}finally{h.f()}a.type="youtube",a.pose.position[0]=t.mouseOnMap[0],a.pose.position[1]=t.mouseOnMap[1],a.size[0]=640,a.size[1]=380}else if("drive.google.com"===s.hostname||"docs.google.com"===s.hostname){a.type="gdrive";var m=s.pathname.slice(s.pathname.indexOf("/d/")+3),v=m.slice(0,m.indexOf("/"));a.url="id=".concat(v),a.pose.position[0]=t.mouseOnMap[0],a.pose.position[1]=t.mouseOnMap[1],a.size[0]=900,a.size[1]=700}else"wbo.ophir.dev"===s.hostname?(a.type="whiteboard",a.url=e,a.pose.position[0]=t.mouseOnMap[0],a.pose.position[1]=t.mouseOnMap[1],a.size[0]=700,a.size[1]=740):".pdf"===s.pathname.substring(s.pathname.length-4)||".PDF"===s.pathname.substring(s.pathname.length-4)?y(a,e,t):Object(c.n)(Object(r.a)(e)).then((function(i){"application/pdf"===i&&(y(a,e,t),n(a))})).finally((function(){a.type||(a.type="iframe",a.url=e,a.pose.position[0]=t.mouseOnMap[0],a.pose.position[1]=t.mouseOnMap[1],a.size[0]=600,a.size[1]=800,n(a))}));a.type&&(n(a),Object(p.b)("".concat(a.type," created url = ").concat(a.url)))}))}function E(e,t){var n=b();n.type="text";var i={messages:[{message:e,pid:h.a.localId,name:h.a.local.information.name,color:h.a.local.information.color,textColor:h.a.local.information.textColor,time:Date.now()}],scroll:[0,0]};n.url=JSON.stringify(i),n.pose.position[0]=t.mouseOnMap[0],n.pose.position[1]=t.mouseOnMap[1];var o=Math.ceil(Math.sqrt(e.length));return n.size[0]=Math.max(20*o,200),n.size[1]=Math.max(25*o,o?25:75),n}function O(e,t,n,i){return new Promise((function(o,r){Object(a.b)(e).then((function(e){S(e,t,n,i).then(o)})).catch(r)}))}function S(e,t,n,i){return new Promise((function(o,r){Object(a.a)(e).then((function(r){var a=b();console.log(" TYPE ",i),a.type="img","image"===i?(a.shareType="img",a.noFrame=!0):"zoneimage"===i&&(a.shareType="zoneimg",a.noFrame=!0),a.url=e,a.size=[r[0],r[1]],a.originalSize=[r[0],r[1]];for(var s=0;s<a.pose.position.length;s+=1)a.pose.position[s]=n?t.mouseOnMap[s]+n[s]:t.mouseOnMap[s]-.5*a.size[s];o(a)}))}))}function C(e){}function _(e,t,n){return console.error("createContentOfPdf called."),new Promise((function(e,t){if(gapi){gapi.client.init({apiKey:"AIzaSyCE4B2cKycH0fVmBznwfr1ynnNf2qNEU9M",clientId:"188672642721-3f8u1671ecugbl2ukhjmb18nv283upm0.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/drive.appdata",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]}).then((function(){console.log("Before getAuthInstance"),v=gapi.auth2.getAuthInstance(),console.log("Before listen updateSigninStatus"),v.isSignedIn.listen(C)}),(function(e){console.log("gapi.client.init failed:",e)}))}}))}function j(e,t,n){var i=b();i.type=n,i.url="",i.pose.position[0]=t.mouseOnMap[0],i.pose.position[1]=t.mouseOnMap[1];var o=e.find((function(e){return"video"===e.getType()})),r=null===o||void 0===o?void 0:o.getTrack().getSettings();return i.originalSize=r?[r.width||0,r.height||0]:[0,0],i.size=[(i.originalSize[0]||640)/2,(i.originalSize[1]||360)/2],i}function T(e,t){return new Promise((function(n,i){var o=void 0;if(0===e.indexOf("http://")||0===e.indexOf("https://")){var r=new URL(e),a=e.slice(-4);Object(c.x)(r)?((o=E(e,t)).name="! recursive reference",n(o)):".jpg"===a||".JPG"===a||"jpeg"===a||"JPEG"===a||".png"===a||".PNG"===a||".gif"===a||".GIF"===a||".svg"===a||".SVG"===a?S(e,t).then((function(e){e.name=r.pathname,n(e)})).catch(i):A(e,t).then((function(i){"iframe"===i.type&&((i=E(e,t)).name="".concat(r.host).concat(r.pathname).concat(r.search)),"youtube"===i.type?i.name="".concat(r.search.substring(1)):i.name="".concat(r.host).concat(r.pathname).concat(r.search),n(i)})).catch(i)}else(o=E(e,t)).name=e.substring(0,20),n(o)}))}function k(e,t){return new Promise((function(n,i){(null===e||void 0===e?void 0:e.types.includes("Files"))?function(){for(var o=Array.from(e.items),r=[],a=[],s=function(){var e=u[c],s=e.getAsFile();if("file"===e.kind&&s){var l=void 0;-1!==e.type.indexOf("image")?l=O:"application/pdf"===e.type&&(l=_),l&&l(s,t).then((function(e){e.name=s.name,r.push(e),r.length+a.length===o.length&&(r.length?n(r):i(a))})).catch((function(e){a.push(e),r.length+a.length===o.length&&(r.length?n(r):i(a))}))}else a.push("Creator not found.")},c=0,u=o;c<u.length;c++)s()}():(null===e||void 0===e?void 0:e.types.includes("text/plain"))?e.items[0].getAsString((function(e){T(e,t).then((function(e){return n([e])})).catch(i)})):(console.error("Unhandled content types:",null===e||void 0===e?void 0:e.types),i("Unhandled content types:".concat(null===e||void 0===e?void 0:e.types)))}))}var I=Object(c.h)({zorder:!0,name:!0,ownerName:!0,color:!0,textColor:!0,type:!0,url:!0,pose:!0,size:!0,originalSize:!0,pinned:!0,noFrame:!0,opacity:!0,zone:!0,shareType:!0});function R(e){return I(e)}function w(e){return e.map(R)}var D=Object(c.h)({zorder:!0,name:!0,ownerName:!0,color:!0,textColor:!0,type:!0,url:!0,pose:!0,size:!0,originalSize:!0,pinned:!0,noFrame:!0,opacity:!0,zone:!0,id:!0,shareType:!0});function N(e){return e.map(D)}function P(e){var t=document.createElement("textarea");t.value=e,t.selectionStart=0,t.selectionEnd=t.value.length;var n=t.style;n.position="fixed",n.left="-100%",document.body.appendChild(t),t.focus();var i=document.execCommand("copy");return t.blur(),document.body.removeChild(t),i}function M(e){if("text"===e.type){var t=JSON.parse(e.url);P(t.messages.length?t.messages.map((function(e){return e.message})).reduce((function(e,t){return e?e+"\n":""+t})):"")}else if("youtube"===e.type){var n=e.url.split("&").filter((function(e){var t=e.split("=")[0];return"v"===t||"list"===t})),i=n.length?n.reduce((function(e,t){return(e?e+"&":"")+t})):"";P("https://www.youtube.com/watch?".concat(i))}else if("gdrive"===e.type){P(x(!0,F(e.url)))}else P(e.url)}function L(e){return!e||!("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e||"application/vnd.google-apps.presentation"===e||"application/vnd.google-apps.spreadsheet"===e||"image"===e.slice(0,5)||"video"===e.slice(0,5)||"audio"===e.slice(0,5))}function x(e,t){var n=t.get("id"),i=t.get("mimeType");i=i||"";var o="application/vnd.google-apps.",r="https://drive.google.com/file/d/".concat(n,"/preview");if(e||function(e){return!!e&&("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e||"application/vnd.google-apps.spreadsheet"===e||"application/vnd.google-apps.document"===e||"application/vnd.google-apps.presentation"===e)}(i))if(i.substr(0,o.length)===o){var a=i.substr(o.length);"failed"!==a&&("spreadsheet"===a&&(a="spreadsheets"),r="https://docs.google.com/".concat(a,"/d/").concat(n,"/edit"))}else if("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===i){r="https://docs.google.com/".concat("spreadsheets","/d/").concat(n,"/edit")}return r}function F(e){var t=e.indexOf("?"),n=t>=0?e.substr(t):e;return new Map(n.split("&").map((function(e){return e.split("=")})))}function B(e){var t="";return e.forEach((function(e,n){t="".concat(t).concat(t?"&":"").concat(n,"=").concat(e)})),t}function U(e){return new Promise((function(t,n){gapi?(gapi.client.setApiKey("AIzaSyCE4B2cKycH0fVmBznwfr1ynnNf2qNEU9M"),gapi.client.load("drive","v3",(function(){gapi.client.drive.files.get({fileId:e,fields:"mimeType,name"}).then((function(e){var n=JSON.parse(e.body);t({mimeType:n.mimeType,name:n.name})})).catch((function(e){console.debug("GAPI error",e),n(e)}))}))):n("gapi is not loaded")}))}function V(e){if(Object(s.j)(e)){var t=p.c.sorted.findIndex((function(e){return e.zorder>s.b}));if(t<0&&(t=p.c.sorted.length),(t-=1)>=0){var n=p.c.sorted[t].zorder+1;e.zorder=n<=s.b?n:s.b}}else e.zorder=Math.floor(Date.now()/s.c)}function J(e){if(Object(s.j)(e)){var t=p.c.sorted[0];t!==e&&(e.zorder=t.zorder-1)}else{var n=p.c.sorted.find((function(e){return e.zorder>s.b}));n?e.zorder=n.zorder-1:V(e)}}function G(e,t){if(t){var n=s.b-(Math.floor(Date.now()/s.c)-e.zorder);n<0&&(n=e.zorder%s.b),e.zorder=n}else e.zorder=e.zorder+s.b}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return R}));var i=n(14),o=n(6),r=n(8),a=n(25),s=n(35),c=n(34),u=n(18),l=n(10),d=n(19),h=n(31),p=n.n(h),f=n(47),m=n.n(f),v=n(20),g=n(27),b=n(41),y=n.n(b),A=n(72),E=n(100),O=n(368),S=n(187),C=n(40),_=n(369),j=Object(u.getLogger)(e),T=0,k=0;function I(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map((function(e){var t=e.sourceId,n=e.sourceType,i=e.stream,o=e.track,r=e.videoType,a=e.effects,s=o.getSettings(),c=s.deviceId,u=s.facingMode;return k=Object(E.d)(k),new S.a({deviceId:c,facingMode:u,mediaType:o.kind,rtcId:k,sourceId:t,sourceType:n,stream:i,track:o,videoType:r||null,effects:a})}))}var R=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(o.a)(this,n),(i=t.call(this)).conference=e,i.peerConnections=new Map,i.localTracks=[],i.options=r,i._channel=null,i._lastN=void 0,i._lastNEndpoints=null,i._maxFrameHeight=void 0,i._selectedEndpoints=null,i._lastNChangeListener=i._onLastNChanged.bind(Object(a.a)(i)),i._onDeviceListChanged=i._onDeviceListChanged.bind(Object(a.a)(i)),i._updateAudioOutputForAudioTracks=i._updateAudioOutputForAudioTracks.bind(Object(a.a)(i)),i._videoType=m.a.CAMERA,C.a.isDeviceChangeAvailable("output")&&(C.a.addListener(p.a.AUDIO_OUTPUT_DEVICE_CHANGED,i._updateAudioOutputForAudioTracks),C.a.addListener(p.a.DEVICE_LIST_CHANGED,i._onDeviceListChanged)),i}return Object(r.a)(n,[{key:"destroy",value:function(){C.a.removeListener(p.a.AUDIO_OUTPUT_DEVICE_CHANGED,this._updateAudioOutputForAudioTracks),C.a.removeListener(p.a.DEVICE_LIST_CHANGED,this._onDeviceListChanged),this._channelOpenListener&&this.removeListener(p.a.DATA_CHANNEL_OPEN,this._channelOpenListener)}},{key:"initializeBridgeChannel",value:function(e,t){var n=this;this._channel=new O.a(e,t,this.eventEmitter),this._channelOpenListener=function(){var e=function(e,t,n){y.a.callErrorHandler(e),j.error("Cannot send ".concat(t,"(").concat(JSON.stringify(n),") endpoint message"),e)};if(n._receiverVideoConstraints)try{n._channel.sendNewReceiverVideoConstraintsMessage(n._receiverVideoConstraints)}catch(t){e(t,"ReceiverVideoConstraints",n._receiverVideoConstraints)}if(n._selectedEndpoints)try{n._channel.sendSelectedEndpointsMessage(n._selectedEndpoints)}catch(t){e(t,"SelectedEndpointsChangedEvent",n._selectedEndpoint)}if("undefined"!==typeof n._maxFrameHeight)try{n._channel.sendReceiverVideoConstraintMessage(n._maxFrameHeight)}catch(t){e(t,"ReceiverVideoConstraint",n._maxFrameHeight)}if("undefined"!==typeof n._lastN&&-1!==n._lastN)try{n._channel.sendSetLastNMessage(n._lastN)}catch(t){e(t,"LastNChangedEvent",n._lastN)}try{n._channel.sendVideoTypeMessage(n._videoType)}catch(t){e(t,"VideoTypeMessage",n._videoType)}n.removeListener(p.a.DATA_CHANNEL_OPEN,n._channelOpenListener),n._channelOpenListener=null},this.addListener(p.a.DATA_CHANNEL_OPEN,this._channelOpenListener),this.addListener(p.a.LASTN_ENDPOINT_CHANGED,this._lastNChangeListener)}},{key:"_onDeviceListChanged",value:function(){this._updateAudioOutputForAudioTracks(C.a.getAudioOutputDevice())}},{key:"_onLastNChanged",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=this._lastNEndpoints||[],i=[],o=[];this._lastNEndpoints=t,i=n.filter((function(t){return!e.isInLastN(t)})),o=t.filter((function(e){return-1===n.indexOf(e)})),this.conference.eventEmitter.emit(l.LAST_N_ENDPOINTS_CHANGED,i,o)}},{key:"onCallEnded",value:function(){this._channel&&(this._channel&&"websocket"===this._channel.mode&&this._channel.close(),this._channel=null)}},{key:"setNewReceiverVideoConstraints",value:function(e){this._receiverVideoConstraints=e,this._channel&&this._channel.isOpen()&&this._channel.sendNewReceiverVideoConstraintsMessage(e)}},{key:"setReceiverVideoConstraint",value:function(e){this._maxFrameHeight=e,this._channel&&this._channel.isOpen()&&this._channel.sendReceiverVideoConstraintMessage(e)}},{key:"setVideoType",value:function(e){this._videoType!==e&&(this._videoType=e,this._channel&&this._channel.isOpen()&&this._channel.sendVideoTypeMessage(e))}},{key:"selectEndpoints",value:function(e){this._selectedEndpoints=e,this._channel&&this._channel.isOpen()&&this._channel.sendSelectedEndpointsMessage(e)}},{key:"createPeerConnection",value:function(e,t,n,i){var o=JSON.parse(JSON.stringify(C.a.pcConstraints));"undefined"!==typeof i.abtestSuspendVideo&&(C.a.setSuspendVideo(o,i.abtestSuspendVideo),g.a.analytics.addPermanentProperties({abtestSuspendVideo:i.abtestSuspendVideo})),i.enableInsertableStreams&&(j.debug("E2EE - setting insertable streams constraints"),t.encodedInsertableStreams=!0,t.forceEncodedAudioInsertableStreams=!0,t.forceEncodedVideoInsertableStreams=!0),(v.a.isReactNative()||v.a.isChromiumBased()&&!i.usesUnifiedPlan)&&(t.sdpSemantics="plan-b"),i.forceTurnRelay&&(t.iceTransportPolicy="relay"),t.bundlePolicy="max-bundle",T=Object(E.d)(T);var r=new _.a(this,T,e,t,o,n,i);return this.peerConnections.set(r.id,r),r}},{key:"_removePeerConnection",value:function(e){var t=e.id;return!!this.peerConnections.has(t)&&(this.peerConnections.delete(t),!0)}},{key:"addLocalTrack",value:function(e){if(!e)throw new Error("track must not be null nor undefined");this.localTracks.push(e),e.conference=this.conference}},{key:"getLocalVideoTrack",value:function(){var e=this.getLocalTracks(d.c);return e.length?e[0]:void 0}},{key:"getLocalAudioTrack",value:function(){var e=this.getLocalTracks(d.a);return e.length?e[0]:void 0}},{key:"getLocalEndpointId",value:function(){return this.conference.myUserId()}},{key:"getLocalTracks",value:function(e){var t=this.localTracks.slice();return void 0!==e&&(t=t.filter((function(t){return t.getType()===e}))),t}},{key:"getRemoteTracks",value:function(e){var t,n=[],o=Object(i.a)(this.peerConnections.values());try{for(o.s();!(t=o.n()).done;){var r=t.value.getRemoteTracks(void 0,e);r&&(n=n.concat(r))}}catch(a){o.e(a)}finally{o.f()}return n}},{key:"setAudioMute",value:function(e){var t=[];return this.getLocalTracks(d.a).forEach((function(n){t.push(e?n.mute():n.unmute())})),Promise.all(t)}},{key:"setVideoMute",value:function(e){var t=[];return this.getLocalTracks(d.c).concat(this.getLocalTracks(d.b)).forEach((function(n){t.push(e?n.mute():n.unmute())})),Promise.all(t)}},{key:"removeLocalTrack",value:function(e){var t=this.localTracks.indexOf(e);-1!==t&&this.localTracks.splice(t,1)}},{key:"closeBridgeChannel",value:function(){this._channel&&(this._channel.close(),this._channel=null,this.removeListener(p.a.LASTN_ENDPOINT_CHANGED,this._lastNChangeListener))}},{key:"setAudioLevel",value:function(e,t,n,i){var o=e.getTrackBySSRC(t);o&&(o.isAudioTrack()?(o.isLocal()!==i&&j.error("".concat(o," was expected to ").concat(i?"be":"not be"," local")),o.setAudioLevel(n,e)):j.warn("Received audio level for non-audio track: ".concat(t)))}},{key:"sendChannelMessage",value:function(e,t){if(!this._channel)throw new Error("Channel support is disabled!");this._channel.sendMessage(e,t)}},{key:"sendEndpointStatsMessage",value:function(e){this._channel&&this._channel.isOpen()&&this._channel.sendEndpointStatsMessage(e)}},{key:"setLastN",value:function(e){this._lastN!==e&&(this._lastN=e,this._channel&&this._channel.isOpen()&&this._channel.sendSetLastNMessage(e),this.eventEmitter.emit(p.a.LASTN_VALUE_CHANGED,e))}},{key:"setPerceptibles",value:function(e){this._channel&&this._channel.isOpen()&&this._channel.sendSetPercieveEventMessage(e),this.eventEmitter.emit(p.a.PERCEPTIBLES_CHANGED,e)}},{key:"isInLastN",value:function(e){return!this._lastNEndpoints||this._lastNEndpoints.indexOf(e)>-1}},{key:"_updateAudioOutputForAudioTracks",value:function(e){var t,n=this.getRemoteTracks(d.a),o=Object(i.a)(n);try{for(o.s();!(t=o.n()).done;){t.value.setAudioOutput(e)}}catch(r){o.e(r)}finally{o.f()}}}],[{key:"createLocalTracks",value:function(e){return I(e)}},{key:"obtainAudioAndVideoPermissions",value:function(e){return C.a.obtainAudioAndVideoPermissions(e).then((function(e){return I(e)}))}},{key:"addListener",value:function(e,t){C.a.addListener(e,t)}},{key:"removeListener",value:function(e,t){C.a.removeListener(e,t)}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.options=e,C.a.init(this.options)}},{key:"attachMediaStream",value:function(e,t){return C.a.attachMediaStream(e,t)}},{key:"getStreamID",value:function(e){return C.a.getStreamID(e)}},{key:"getTrackID",value:function(e){return C.a.getTrackID(e)}},{key:"isDeviceListAvailable",value:function(){return C.a.isDeviceListAvailable()}},{key:"isDeviceChangeAvailable",value:function(e){return C.a.isDeviceChangeAvailable(e)}},{key:"isWebRtcSupported",value:function(){return v.a.isSupported()}},{key:"getAudioOutputDevice",value:function(){return C.a.getAudioOutputDevice()}},{key:"getCurrentlyAvailableMediaDevices",value:function(){return C.a.getCurrentlyAvailableMediaDevices()}},{key:"arePermissionsGrantedForAvailableDevices",value:function(){return C.a.arePermissionsGrantedForAvailableDevices()}},{key:"getEventDataForActiveDevice",value:function(e){return C.a.getEventDataForActiveDevice(e)}},{key:"setAudioOutputDevice",value:function(e){return C.a.setAudioOutputDevice(e)}},{key:"isUserStream",value:function(e){return n.isUserStreamById(C.a.getStreamID(e))}},{key:"isUserStreamById",value:function(e){return e&&"mixedmslabel"!==e&&"default"!==e}},{key:"enumerateDevices",value:function(e){C.a.enumerateDevices(e)}},{key:"stopMediaStream",value:function(e){C.a.stopMediaStream(e)}},{key:"isDesktopSharingEnabled",value:function(){return C.a.isDesktopSharingEnabled()}}]),n}(A.a)}).call(this,"/index.js")},,,function(e,t,n){"use strict";n.d(t,"g",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return r})),n.d(t,"f",(function(){return a})),n.d(t,"d",(function(){return s})),n.d(t,"h",(function(){return c})),n.d(t,"j",(function(){return u})),n.d(t,"a",(function(){return l})),n.d(t,"i",(function(){return d})),n.d(t,"e",(function(){return h}));function i(e){return{id:e.id,name:e.name,ownerName:e.ownerName,color:e.color,textColor:e.textColor,type:e.type,shareType:e.shareType}}var o=100,r=31536e7/o;function a(e){return"text"===e.type||"pdf"===e.type}function s(e){return e&&"camera"!==e.type&&"screen"!==e.type}function c(e){return e&&("text"===e.type||"iframe"===e.type||"pdf"===e.type||"whiteboard"===e.type||"gdrive"===e.type||"youtube"===e.type)}function u(e){return e&&e.zorder<=r}var l=1048576;function d(e){return!e||e.pose.position[0]===l}function h(e,t){return e.time-t.time}},function(e,t){e.exports={CAMERA:"camera",DESKTOP:"desktop",NONE:"none"}},,,,,function(e,t,n){"use strict";n.r(t),n.d(t,"CONSTRAINT_FAILED",(function(){return i})),n.d(t,"ELECTRON_DESKTOP_PICKER_ERROR",(function(){return o})),n.d(t,"ELECTRON_DESKTOP_PICKER_NOT_FOUND",(function(){return r})),n.d(t,"GENERAL",(function(){return a})),n.d(t,"NOT_FOUND",(function(){return s})),n.d(t,"PERMISSION_DENIED",(function(){return c})),n.d(t,"SCREENSHARING_GENERIC_ERROR",(function(){return u})),n.d(t,"SCREENSHARING_USER_CANCELED",(function(){return l})),n.d(t,"TIMEOUT",(function(){return d})),n.d(t,"TRACK_IS_DISPOSED",(function(){return h})),n.d(t,"TRACK_NO_STREAM_FOUND",(function(){return p})),n.d(t,"UNSUPPORTED_RESOLUTION",(function(){return f}));var i="gum.constraint_failed",o="gum.electron_desktop_picker_error",r="gum.electron_desktop_picker_not_found",a="gum.general",s="gum.not_found",c="gum.permission_denied",u="gum.screensharing_generic_error",l="gum.screensharing_user_canceled",d="gum.timeout",h="track.track_is_disposed",p="track.no_stream_found",f="gum.unsupported_resolution"},,function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return r})),n.d(t,"d",(function(){return a})),n.d(t,"c",(function(){return s})),n.d(t,"e",(function(){return c}));var i=n(128),o=60,r={name:"Anonymous",email:"",avatarSrc:"",color:[],textColor:[],notifyCall:!0,notifyTouch:!1,notifyNear:!1,notifyYarn:!1},a={name:"",avatarSrc:"",color:[],textColor:[]},s={located:!0,onStage:!1,awayFromKeyboard:!1};function c(e){var t=e.color;t.length||(t=e.name.length?Object(i.d)(e.name):[208,208,224]);var n=e.textColor;n.length||(n=Object(i.b)(t));var o=Object(i.a)(t);return[Object(i.f)(t),Object(i.f)(n),Object(i.f)(o)]}},,,function(e,t,n){"use strict";var i=n(21),o=n(6),r=n(8),a=(n(81),n(11)),s=n(62),c=n(30),u=n(89),l=n(22),h=n(122),p=n(54),f=n(60),m=n(4),v=n(187);var g,b,y,A,E=n(95),O=n(12),S=n(3),C=new(g=function(){function e(){var t=this;Object(o.a)(this,e),Object(i.a)(this,"type",b,this),Object(i.a)(this,"types",y,this),Object(i.a)(this,"supressedTypes",A,this),this.reason="",this.name="",this.videoInputs=[],this.audioInputs=[],this.audioOutputs=[],this.canvas=void 0,this.oscillator=void 0,Object(S.g)(this),null!==f.a.testBot&&this.clear(),Object(S.c)((function(){t.show()?E.b.keyInputUsers.add("errorDialog"):E.b.keyInputUsers.delete("errorDialog")})),Object(S.c)((function(){O.a.local.awayFromKeyboard&&t.setType("afk")}))}return Object(r.a)(e,[{key:"fatal",get:function(){return!this.type}},{key:"setType",value:function(e,t,n){this.type=e,this.types.add(e),this.reason=n,this.name=t}},{key:"title",get:function(){switch(this.type){case"connection":return Object(l.c)("etConnection");case"retry":return Object(l.c)("etRetry");case"noMic":return Object(l.c)("etNoMic");case"micPermission":return Object(l.c)("etMicPermission");case"channel":return Object(l.c)("etNoChannel");case"entrance":return"";case"afk":return Object(l.c)("afkTitle");case"kicked":return"Kicked by ".concat(this.name,". ").concat(this.reason)}return this.type}},{key:"message",get:function(){switch(this.type){case"connection":return Object(l.c)("emConnection");case"retry":return Object(l.c)("emRetry");case"noMic":return Object(l.c)("emNoMic");case"micPermission":return Object(l.c)("emMicPermission");case"channel":return Object(l.c)("emNoChannel");case"entrance":return"";case"afk":return Object(l.c)("afkMessage");case"kicked":return""}return"no message defined for ".concat(this.type)}},{key:"show",value:function(){if(""===this.type){var e=Object(m.g)(this.types,this.supressedTypes);e.size&&(this.type=e.values().next().value)}return""!==this.type&&!this.supressedTypes.has(this.type)}},{key:"enumerateDevices",value:function(){var e=this;navigator.mediaDevices.enumerateDevices().then((function(t){e.videoInputs=[],e.audioInputs=[],e.audioOutputs=[],t.forEach((function(t){"videoinput"===t.kind&&e.videoInputs.push(t),"audioinput"===t.kind&&e.audioInputs.push(t),"audiooutput"===t.kind&&e.audioOutputs.push(t)}))})).catch((function(){console.error("Device enumeration error")}))}},{key:"connectionStart",value:function(){var e=this;null!==f.a.skipEntrance&&(this.clear(),O.a.local.sendInformation()),this.enumerateDevices(),null===f.a.testBot?Object(S.j)((function(){return""===e.type}),(function(){setTimeout(e.checkConnection.bind(e),4e3)})):setTimeout(this.startTestBot.bind(this),3e3)}},{key:"clear",value:function(e){"afk"===this.type&&(O.a.local.awayFromKeyboard=!1),e?(this.types.delete(e),this.type===e&&(this.type="")):(this.types.clear(),this.type="")}},{key:"checkConnection",value:function(){c.b.state!==u.a.CONNECTED?(this.setType("connection"),setTimeout(this.checkConnection.bind(this),5e3)):(this.clear("connection"),this.checkMic())}},{key:"checkMic",value:function(){!O.a.localId||O.a.local.muteAudio||c.b.conference.getLocalMicTrack()?(O.a.local.muteAudio&&setTimeout(this.checkMic.bind(this),5e3),this.clear("noMic"),this.clear("micPermission"),this.checkRemote()):(this.audioInputs.length?this.setType("micPermission"):(this.clear("micPermission"),this.setType("noMic")),setTimeout(this.checkMic.bind(this),5e3))}},{key:"checkRemote",value:function(){O.a.remote.size>0?setTimeout(this.checkChannel.bind(this),3e3):setTimeout(this.checkRemote.bind(this),1e3)}},{key:"checkChannel",value:function(){var e,t;O.a.remote.size>0?(null===(e=c.b.conference._jitsiConference)||void 0===e||null===(t=e.rtc._channel)||void 0===t?void 0:t.isOpen())?this.clear("channel"):(this.setType("channel"),setTimeout(this.checkChannel.bind(this),5e3)):this.checkRemote()}},{key:"startTestBot",value:function(){var e=this,t=0,n=new AudioContext;this.oscillator=n.createOscillator(),this.oscillator.type="triangle";var i=n.createMediaStreamDestination();this.oscillator.connect(i),this.oscillator.start(),this.canvas=document.createElement("canvas");var o=240,r=240;this.canvas.style.width="".concat(o,"px"),this.canvas.style.height="".concat(r,"px");var a=this.canvas.getContext("2d"),u=[Math.random()*s.b/2,(Math.random()-.5)*s.b];setInterval((function(){var i,o;if(a&&n){null===(i=e.oscillator)||void 0===i||i.frequency.setValueAtTime(440+t%440,n.currentTime);var r=["green","blue"],s=h.a.tracksToAccept[0].length?O.a.remote.get(h.a.tracksToAccept[0][0].endpointId):void 0;s&&!(null===s||void 0===s?void 0:s.tracks.avatarOk)&&(r[0]="yellow"),s&&(null===s||void 0===s||null===(o=s.tracks.audio)||void 0===o?void 0:o.getTrack().muted)&&(r[1]="red"),a.fillStyle=r[0],a.beginPath(),a.ellipse(151.2,79.2,24,96,t/20,0,2*Math.PI),a.fill(),a.fillStyle=r[1],a.beginPath(),a.ellipse(151.2,79.2,24,96,-t/20,0,2*Math.PI),a.fill(),t+=1}}),50);var l="01234567890ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijlkmnopqrstuvwxyz",d=function(){return l.substr(Math.floor(Math.random()*l.length),1)};O.a.local.information=p.b,O.a.local.information.name="testBot ".concat(d()).concat(d()).concat(d()),O.a.local.sendInformation(),O.a.local.pose.position=u;var f=function(){O.a.local.pose.position=Object(m.a)(u,Object(m.B)(100,[Math.cos(t/60),Math.sin(t/60)]))},g=window;if(g.requestIdleCallback){!function e(){setTimeout((function(){f(),g.requestIdleCallback(e)}),50)}()}else setInterval(f,1e3);var b=this.canvas.captureStream(20),y=i.stream,A=new MediaStream;A.addTrack(y.getAudioTracks()[0]),A.addTrack(b.getVideoTracks()[0]);var E=function(e){var t=e.getVideoTracks()[0],n=e.getAudioTracks()[0],i=void 0,o=void 0;return n&&(i={videoType:null,mediaType:"audio",rtcId:0,stream:new MediaStream([n]),track:n,effects:void 0,resolution:n.getSettings().height,deviceId:"videofile_chrome",facingMode:"environment"}),t&&(o={videoType:"camera",mediaType:"video",rtcId:1,stream:new MediaStream([t]),track:t,effects:void 0,resolution:t.getSettings().height,deviceId:"videofile_chrome",facingMode:"environment"}),[o?new v.a(o):void 0,i?new v.a(i):void 0]}(A);c.b.conference.setLocalCameraTrack(E[0]),c.b.conference.setLocalMicTrack(E[1])}}]),e}(),Object(a.a)(g.prototype,"fatal",[S.d],Object.getOwnPropertyDescriptor(g.prototype,"fatal"),g.prototype),b=Object(a.a)(g.prototype,"type",[S.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"entrance"}}),y=Object(a.a)(g.prototype,"types",[S.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Set}}),A=Object(a.a)(g.prototype,"supressedTypes",[S.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Set}}),Object(a.a)(g.prototype,"setType",[S.b],Object.getOwnPropertyDescriptor(g.prototype,"setType"),g.prototype),Object(a.a)(g.prototype,"title",[S.d],Object.getOwnPropertyDescriptor(g.prototype,"title"),g.prototype),Object(a.a)(g.prototype,"message",[S.d],Object.getOwnPropertyDescriptor(g.prototype,"message"),g.prototype),Object(a.a)(g.prototype,"connectionStart",[S.b],Object.getOwnPropertyDescriptor(g.prototype,"connectionStart"),g.prototype),Object(a.a)(g.prototype,"clear",[S.b],Object.getOwnPropertyDescriptor(g.prototype,"clear"),g.prototype),Object(a.a)(g.prototype,"checkConnection",[S.b],Object.getOwnPropertyDescriptor(g.prototype,"checkConnection"),g.prototype),Object(a.a)(g.prototype,"checkMic",[S.b],Object.getOwnPropertyDescriptor(g.prototype,"checkMic"),g.prototype),Object(a.a)(g.prototype,"checkChannel",[S.b],Object.getOwnPropertyDescriptor(g.prototype,"checkChannel"),g.prototype),g);d.error=C;t.a=C},function(e,t,n){"use strict";n.r(t),n.d(t,"LOCAL_TRACK_STOPPED",(function(){return i})),n.d(t,"TRACK_AUDIO_LEVEL_CHANGED",(function(){return o})),n.d(t,"TRACK_AUDIO_OUTPUT_CHANGED",(function(){return r})),n.d(t,"TRACK_MUTE_CHANGED",(function(){return a})),n.d(t,"TRACK_VIDEOTYPE_CHANGED",(function(){return s})),n.d(t,"NO_DATA_FROM_SOURCE",(function(){return c})),n.d(t,"NO_AUDIO_INPUT",(function(){return u}));var i="track.stopped",o="track.audioLevelsChanged",r="track.audioOutputChanged",a="track.trackMuteChanged",s="track.videoTypeChanged",c="track.no_data_from_source",u="track.no_audio_input"},,function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i=function(e){var t=new URL(decodeURI(e)),n=["room","name","headphone","speaker","cameraOn","muteMic","testBot","skipEntrance"].reduce((function(e,n){return e[n]=t.searchParams.get(n),e}),{});return n.room=t.pathname.substr(1).toLowerCase().replace(/[./@]/,"_")+(n.room?n.room.toLowerCase():""),n}(window.location.href)},function(e,t,n){e.exports=n(492).default},function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var i=5e3,o=[0,0]},function(e,t,n){"use strict";n.r(t),n.d(t,"AUTHENTICATION_REQUIRED",(function(){return i})),n.d(t,"CHAT_ERROR",(function(){return o})),n.d(t,"CONFERENCE_DESTROYED",(function(){return r})),n.d(t,"CONFERENCE_MAX_USERS",(function(){return a})),n.d(t,"CONNECTION_ERROR",(function(){return s})),n.d(t,"CONFERENCE_RESTARTED",(function(){return c})),n.d(t,"NOT_ALLOWED_ERROR",(function(){return u})),n.d(t,"MEMBERS_ONLY_ERROR",(function(){return l})),n.d(t,"CONFERENCE_ACCESS_DENIED",(function(){return d})),n.d(t,"FOCUS_DISCONNECTED",(function(){return h})),n.d(t,"FOCUS_LEFT",(function(){return p})),n.d(t,"GRACEFUL_SHUTDOWN",(function(){return f})),n.d(t,"ICE_FAILED",(function(){return m})),n.d(t,"INCOMPATIBLE_SERVER_VERSIONS",(function(){return v})),n.d(t,"OFFER_ANSWER_FAILED",(function(){return g})),n.d(t,"PASSWORD_NOT_SUPPORTED",(function(){return b})),n.d(t,"PASSWORD_REQUIRED",(function(){return y})),n.d(t,"RESERVATION_ERROR",(function(){return A})),n.d(t,"VIDEOBRIDGE_NOT_AVAILABLE",(function(){return E}));var i="conference.authenticationRequired",o="conference.chatError",r="conference.destroyed",a="conference.max_users",s="conference.connectionError",c="conference.restarted",u="conference.connectionError.notAllowed",l="conference.connectionError.membersOnly",d="conference.connectionError.accessDenied",h="conference.focusDisconnected",p="conference.focusLeft",f="conference.gracefulShutdown",m="conference.iceFailed",v="conference.incompatible_server_versions",g="conference.offerAnswerFailed",b="conference.passwordNotSupported",y="conference.passwordRequired",A="conference.reservationError",E="conference.videobridgeNotAvailable"},,function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var i=n(28),o=n(14),r=n(38),a=n.n(r),s=n(20),c=n(33);function u(e){for(var t=e.split("\r\nm="),n=1,i=t.length;n<i;n++){var o="m=".concat(t[n]);n!==i-1&&(o+="\r\n"),t[n]=o}var r="".concat(t.shift(),"\r\n");this.media=t,this.raw=r+t.join(""),this.session=r}u.prototype.failICE=!1,u.prototype.removeTcpCandidates=!1,u.prototype.removeUdpCandidates=!1,u.prototype.getMediaSsrcMap=function(){for(var e=this,t={},n=function(n){var i={mediaindex:n,mid:c.a.parseMID(c.a.findLine(e.media[n],"a=mid:")),ssrcs:{},ssrcGroups:[]};t[n]=i,c.a.findLines(e.media[n],"a=ssrc:").forEach((function(e){var t=e.substring(7).split(" ")[0];i.ssrcs[t]||(i.ssrcs[t]={ssrc:t,lines:[]}),i.ssrcs[t].lines.push(e)})),c.a.findLines(e.media[n],"a=ssrc-group:").forEach((function(e){var t=e.indexOf(" "),n=e.substr(0,t).substr(13),o=e.substr(14+n.length).split(" ");o.length&&i.ssrcGroups.push({semantics:n,ssrcs:o})}))},i=0;i<this.media.length;i++)n(i);return t},u.prototype.containsSSRC=function(e){var t=this.getMediaSsrcMap(),n=!1;return Object.keys(t).forEach((function(i){n||t[i].ssrcs[e]&&(n=!0)})),n},u.prototype.toJingle=function(e,t){c.a.findLines(this.session,"a=group:").forEach((function(t){var n=t.split(" "),i=n.shift().substr(8);e.c("group",{xmlns:"urn:xmpp:jingle:apps:grouping:0",semantics:i});for(var o=0;o<n.length;o++)e.c("content",{name:n[o]}).up();e.up()}));for(var n=0;n<this.media.length;n++){var r=c.a.parseMLine(this.media[n].split("\r\n")[0]);if("audio"===r.media||"video"===r.media||"application"===r.media){var u=void 0,l=c.a.findLine(this.media[n],"a=ssrc:");u=!!l&&l.substring(7).split(" ")[0],e.c("content",{creator:t,name:r.media});var d=c.a.findLine(this.media[n],"a=mid:");if(d){var h=c.a.parseMID(d);e.attrs({name:h})}if("audio"===r.media||"video"===r.media){e.c("description",{xmlns:"urn:xmpp:jingle:apps:rtp:1",media:r.media}),u&&e.attrs({ssrc:u});for(var p=0;p<r.fmt.length;p++){var f=c.a.findLine(this.media[n],"a=rtpmap:".concat(r.fmt[p]));e.c("payload-type",c.a.parseRTPMap(f));var m=c.a.findLine(this.media[n],"a=fmtp:".concat(r.fmt[p]));if(m)for(var v=c.a.parseFmtp(m),g=0;g<v.length;g++)e.c("parameter",v[g]).up();this.rtcpFbToJingle(n,e,r.fmt[p]),e.up()}if(u){var b,y=c.a.parseSSRC(this.media[n]),A=Object(o.a)(y);try{for(A.s();!(b=A.n()).done;){var E=Object(i.a)(b.value,2),O=E[0],S=E[1];e.c("source",{ssrc:O,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),S.forEach((function(t){var n=t.indexOf(" "),i=t.substr(n+1);if(e.c("parameter"),-1===i.indexOf(":"))e.attrs({name:i});else{var o=i.split(":",2)[0];e.attrs({name:o});var r=i.split(":",2)[1];r=c.a.filterSpecialChars(r),e.attrs({value:r})}e.up()})),e.up()}}catch(R){A.e(R)}finally{A.f()}c.a.findLines(this.media[n],"a=ssrc-group:").forEach((function(t){var n=t.indexOf(" "),i=t.substr(0,n).substr(13),o=t.substr(14+i.length).split(" ");o.length&&(e.c("ssrc-group",{semantics:i,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),o.forEach((function(t){return e.c("source",{ssrc:t}).up()})),e.up())}))}var C=c.a.findLines(this.media[n],"a=rid:");if(C.length&&s.a.usesRidsForSimulcast()){var _=C.map((function(e){return e.split(":")[1]})).map((function(e){return e.split(" ")[0]}));_.forEach((function(t){e.c("source",{rid:t,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),e.up()})),c.a.findLine(this.media[n],"a=simulcast:")&&(e.c("rid-group",{semantics:"SIM",xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),_.forEach((function(t){e.c("source",{rid:t}).up()})),e.up())}c.a.findLine(this.media[n],"a=rtcp-mux")&&e.c("rtcp-mux").up(),this.rtcpFbToJingle(n,e,"*");for(var j=c.a.findLines(this.media[n],"a=extmap:"),T=0;T<j.length;T++){var k=c.a.parseExtmap(j[T]);if(e.c("rtp-hdrext",{xmlns:"urn:xmpp:jingle:apps:rtp:rtp-hdrext:0",uri:k.uri,id:k.value}),k.hasOwnProperty("direction"))switch(k.direction){case a.a.SENDONLY:e.attrs({senders:"responder"});break;case a.a.RECVONLY:e.attrs({senders:"initiator"});break;case a.a.SENDRECV:e.attrs({senders:"both"});break;case a.a.INACTIVE:e.attrs({senders:"none"})}e.up()}e.up()}this.transportToJingle(n,e);var I=this.media[n];c.a.findLine(I,"a=".concat(a.a.SENDRECV),this.session)?e.attrs({senders:"both"}):c.a.findLine(I,"a=".concat(a.a.SENDONLY),this.session)?e.attrs({senders:"initiator"}):c.a.findLine(I,"a=".concat(a.a.RECVONLY),this.session)?e.attrs({senders:"responder"}):c.a.findLine(I,"a=".concat(a.a.INACTIVE),this.session)&&e.attrs({senders:"none"}),"0"!==r.port||c.a.findLine(I,"a=bundle-only",this.session)||e.attrs({senders:"rejected"}),e.up()}}return e.up(),e},u.prototype.transportToJingle=function(e,t){var n=this;t.c("transport");var i=c.a.findLine(this.media[e],"a=sctpmap:",this.session);if(i){var o=c.a.parseSCTPMap(i);t.c("sctpmap",{xmlns:"urn:xmpp:jingle:transports:dtls-sctp:1",number:o[0],protocol:o[1]}),o.length>2&&t.attrs({streams:o[2]}),t.up()}c.a.findLines(this.media[e],"a=fingerprint:",this.session).forEach((function(i){var o=c.a.parseFingerprint(i);o.xmlns="urn:xmpp:jingle:apps:dtls:0",t.c("fingerprint").t(o.fingerprint),delete o.fingerprint;var r=c.a.findLine(n.media[e],"a=setup:",n.session);r&&(o.setup=r.substr(8)),t.attrs(o),t.up()}));var r=c.a.iceparams(this.media[e],this.session);r&&(r.xmlns="urn:xmpp:jingle:transports:ice-udp:1",t.attrs(r),c.a.findLines(this.media[e],"a=candidate:",this.session).forEach((function(e){var i=c.a.candidateToJingle(e);n.failICE&&(i.ip="1.1.1.1");var o=i&&"string"===typeof i.protocol?i.protocol.toLowerCase():"";n.removeTcpCandidates&&("tcp"===o||"ssltcp"===o)||n.removeUdpCandidates&&"udp"===o||t.c("candidate",i).up()})));t.up()},u.prototype.rtcpFbToJingle=function(e,t,n){c.a.findLines(this.media[e],"a=rtcp-fb:".concat(n)).forEach((function(e){var n=c.a.parseRTCPFB(e);"trr-int"===n.type?(t.c("rtcp-fb-trr-int",{xmlns:"urn:xmpp:jingle:apps:rtp:rtcp-fb:0",value:n.params[0]}),t.up()):(t.c("rtcp-fb",{xmlns:"urn:xmpp:jingle:apps:rtp:rtcp-fb:0",type:n.type}),n.params.length>0&&t.attrs({subtype:n.params[0]}),t.up())}))},u.prototype.rtcpFbFromJingle=function(e,t){var n="",i=e.find('>rtcp-fb-trr-int[xmlns="urn:xmpp:jingle:apps:rtp:rtcp-fb:0"]');return i.length&&(n+="a=rtcp-fb:* trr-int ",i.attr("value")?n+=i.attr("value"):n+="0",n+="\r\n"),e.find('>rtcp-fb[xmlns="urn:xmpp:jingle:apps:rtp:rtcp-fb:0"]').each((function(e,i){n+="a=rtcp-fb:".concat(t," ").concat(i.getAttribute("type")),i.hasAttribute("subtype")&&(n+=" ".concat(i.getAttribute("subtype"))),n+="\r\n"})),n},u.prototype.fromJingle=function(e){var t=this,n=Date.now();this.raw="v=0\r\n"+"o=- ".concat(n," 2 IN IP4 0.0.0.0\r\n")+"s=-\r\nt=0 0\r\n";var i=$(e).find('>group[xmlns="urn:xmpp:jingle:apps:grouping:0"]');i.length&&i.each((function(e,n){var i=$(n).find(">content").map((function(e,t){return t.getAttribute("name")})).get();i.length>0&&(t.raw+="a=group:".concat(n.getAttribute("semantics")||n.getAttribute("type")," ").concat(i.join(" "),"\r\n"))})),this.session=this.raw,e.find(">content").each((function(e,n){var i=t.jingle2media($(n));t.media.push(i)})),this.raw=this.session+this.media.join("")},u.prototype.jingle2media=function(e){var t=this,n=e.find(">description"),i=e.find('>transport[xmlns="urn:xmpp:jingle:transports:ice-udp:1"]'),o="",r=i.find('>sctpmap[xmlns="urn:xmpp:jingle:transports:dtls-sctp:1"]'),s={media:n.attr("media"),port:"1"};if("rejected"===e.attr("senders")&&(s.port="0"),i.find('>fingerprint[xmlns="urn:xmpp:jingle:apps:dtls:0"]').length?s.proto=r.length?"DTLS/SCTP":"RTP/SAVPF":s.proto="RTP/AVPF",r.length){o+="m=application ".concat(s.port," DTLS/SCTP ").concat(r.attr("number"),"\r\n"),o+="a=sctpmap:".concat(r.attr("number")," ").concat(r.attr("protocol"));var u=r.attr("streams");o+=u?" ".concat(u,"\r\n"):"\r\n"}else s.fmt=n.find(">payload-type").map((function(e,t){return t.getAttribute("id")})).get(),o+="".concat(c.a.buildMLine(s),"\r\n");switch(o+="c=IN IP4 0.0.0.0\r\n",r.length||(o+="a=rtcp:1 IN IP4 0.0.0.0\r\n"),i.length&&(i.attr("ufrag")&&(o+="".concat(c.a.buildICEUfrag(i.attr("ufrag")),"\r\n")),i.attr("pwd")&&(o+="".concat(c.a.buildICEPwd(i.attr("pwd")),"\r\n")),i.find('>fingerprint[xmlns="urn:xmpp:jingle:apps:dtls:0"]').each((function(e,t){o+="a=fingerprint:".concat(t.getAttribute("hash")),o+=" ".concat($(t).text()),o+="\r\n",t.hasAttribute("setup")&&(o+="a=setup:".concat(t.getAttribute("setup"),"\r\n"))}))),i.find(">candidate").each((function(e,n){var i=n.getAttribute("protocol");i="string"===typeof i?i.toLowerCase():"",t.removeTcpCandidates&&("tcp"===i||"ssltcp"===i)||t.removeUdpCandidates&&"udp"===i||(t.failICE&&n.setAttribute("ip","1.1.1.1"),o+=c.a.candidateFromJingle(n))})),e.attr("senders")){case"initiator":o+="a=".concat(a.a.SENDONLY,"\r\n");break;case"responder":o+="a=".concat(a.a.RECVONLY,"\r\n");break;case"none":o+="a=".concat(a.a.INACTIVE,"\r\n");break;case"both":o+="a=".concat(a.a.SENDRECV,"\r\n")}return o+="a=mid:".concat(e.attr("name"),"\r\n"),n.find(">rtcp-mux").length&&(o+="a=rtcp-mux\r\n"),n.find(">payload-type").each((function(e,n){o+="".concat(c.a.buildRTPMap(n),"\r\n"),$(n).find(">parameter").length&&(o+="a=fmtp:".concat(n.getAttribute("id")," "),o+=$(n).find(">parameter").map((function(e,t){var n=t.getAttribute("name");return(n?"".concat(n,"="):"")+t.getAttribute("value")})).get().join("; "),o+="\r\n"),o+=t.rtcpFbFromJingle($(n),n.getAttribute("id"))})),o+=this.rtcpFbFromJingle(n,"*"),n.find('>rtp-hdrext[xmlns="urn:xmpp:jingle:apps:rtp:rtp-hdrext:0"]').each((function(e,t){o+="a=extmap:".concat(t.getAttribute("id")," ").concat(t.getAttribute("uri"),"\r\n")})),n.find('>ssrc-group[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each((function(e,t){var n=t.getAttribute("semantics"),i=$(t).find(">source").map((function(e,t){return t.getAttribute("ssrc")})).get();i.length&&(o+="a=ssrc-group:".concat(n," ").concat(i.join(" "),"\r\n"))})),n.find('>source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each((function(e,t){var n=t.getAttribute("ssrc");$(t).find(">parameter").each((function(e,t){var i=t.getAttribute("name"),r=t.getAttribute("value");r=c.a.filterSpecialChars(r),o+="a=ssrc:".concat(n," ").concat(i),r&&r.length&&(o+=":".concat(r)),o+="\r\n"}))})),o}},,,,,function(e,t,n){"use strict";var i=n(52),o={};function r(e,t,n){if("object"===typeof e&&"undefined"!==typeof e.name)switch(this.gum={error:e,constraints:t,devices:n&&Array.isArray(n)?n.slice(0):void 0},e.name){case"NotAllowedError":case"PermissionDeniedError":case"SecurityError":this.name=i.PERMISSION_DENIED,this.message=o[this.name]+(this.gum.devices||[]).join(", ");break;case"DevicesNotFoundError":case"NotFoundError":this.name=i.NOT_FOUND,this.message=o[this.name]+(this.gum.devices||[]).join(", ");break;case"ConstraintNotSatisfiedError":case"OverconstrainedError":var r=e.constraintName||e.constraint;t&&t.video&&(!n||n.indexOf("video")>-1)&&("minWidth"===r||"maxWidth"===r||"minHeight"===r||"maxHeight"===r||"width"===r||"height"===r||"deviceId"===r)?(this.name=i.UNSUPPORTED_RESOLUTION,this.message=o[this.name]+function(e,t){if(t&&t.video&&t.video.mandatory)switch(e){case"width":return t.video.mandatory.minWidth;case"height":return t.video.mandatory.minHeight;default:return t.video.mandatory[e]||""}return""}(r,t)):(this.name=i.CONSTRAINT_FAILED,this.message=o[this.name]+e.constraintName);break;default:this.name=i.GENERAL,this.message=e.message||o[this.name]}else{if("string"!==typeof e)throw new Error("Invalid arguments");o[e]?(this.name=e,this.message=t||o[e]):this.message=e}this.stack=e.stack||(new Error).stack}o[i.UNSUPPORTED_RESOLUTION]="Video resolution is not supported: ",o[i.SCREENSHARING_USER_CANCELED]="User canceled screen sharing prompt",o[i.SCREENSHARING_GENERIC_ERROR]="Unknown error from screensharing",o[i.ELECTRON_DESKTOP_PICKER_ERROR]="Unkown error from desktop picker",o[i.ELECTRON_DESKTOP_PICKER_NOT_FOUND]="Failed to detect desktop picker",o[i.GENERAL]="Generic getUserMedia error",o[i.PERMISSION_DENIED]="User denied permission to use device(s): ",o[i.NOT_FOUND]="Requested device(s) was/were not found: ",o[i.CONSTRAINT_FAILED]="Constraint could not be satisfied: ",o[i.TIMEOUT]="Could not start media source. Timeout occured!",o[i.TRACK_IS_DISPOSED]="Track has been already disposed",o[i.TRACK_NO_STREAM_FOUND]="Track does not have an associated Media Stream",r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,t.a=r},function(e,t){e.exports={H264:"h264",OPUS:"opus",VP8:"vp8",VP9:"vp9"}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(6),o=n(8),r=n(55),a=n.n(r),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new a.a;Object(i.a)(this,e),this.eventEmitter=t,this.addEventListener=this.on=this.addListener,this.removeEventListener=this.off=this.removeListener}return Object(o.a)(e,[{key:"addListener",value:function(e,t){var n=this;return this.eventEmitter.addListener(e,t),function(){return n.removeEventListener(e,t)}}},{key:"removeListener",value:function(e,t){this.eventEmitter.removeListener(e,t)}}]),e}()},,,function(e,t,n){"use strict";n.r(t),n.d(t,"DETECTOR_STATE_CHANGE",(function(){return i})),n.d(t,"AUDIO_INPUT_STATE_CHANGE",(function(){return o})),n.d(t,"NO_AUDIO_INPUT",(function(){return r})),n.d(t,"VAD_NOISY_DEVICE",(function(){return a})),n.d(t,"VAD_REPORT_PUBLISHED",(function(){return s})),n.d(t,"VAD_SCORE_PUBLISHED",(function(){return c})),n.d(t,"VAD_TALK_WHILE_MUTED",(function(){return u}));var i="detector_state_change",o="audio_input_state_changed",r="no_audio_input_detected",a="detection.vad_noise_device",s="vad-report-published",c="detection.vad_score_published",u="detection.vad_talk_while_muted"},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return I})),n.d(t,"d",(function(){return R})),n.d(t,"c",(function(){return w})),n.d(t,"b",(function(){return D})),n.d(t,"e",(function(){return N}));var i=n(6),o=n(8),r=n(35),a=n(34),s=n(18),c=n(13),u=(n(497),n(125)),l=n(79),d=n(9),h=n.n(d),p=n(20),f=n(185),m=n(41),v=n.n(m),g=n(72),b=n(120),y=n.n(b),A=n(279),E=n(129),O=n(351),S=n(357),C=n(364),_=n(365),j=n(366),T=Object(s.getLogger)(e),k=/<failure.*><not-allowed\/><text>(.*)<\/text><\/failure>/gi;var I=[{urls:"stun:meet-jit-si-turnrelay.jitsi.net:443"}],R="type",w="http://jitsi.org/protocol/jigasi",D="https://jitsi.org/meet/e2ee",N=function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(e,o){var r,a;Object(i.a)(this,n),(a=t.call(this)).connection=null,a.disconnectInProgress=!1,a.connectionTimes={},a.options=e,a.token=o,a.authenticatedUser=!1,Object(j.a)(),Object(C.a)();var s=e.xmppPing||{};return s.domain=e.hosts.domain,a.connection=function(e){var t=e.enableWebsocketResume,n=e.serviceUrl,i=void 0===n?"/http-bind":n,o=e.shard,r=e.token,a=e.websocketKeepAlive,s=e.websocketKeepAliveUrl,c=e.xmppPing;return r&&(i+="".concat(-1===i.indexOf("?")?"?":"&","token=").concat(r)),new E.a({enableWebsocketResume:t,serviceUrl:i,websocketKeepAlive:a,websocketKeepAliveUrl:s,xmppPing:c,shard:o})}({enableWebsocketResume:e.enableWebsocketResume,serviceUrl:e.serviceUrl||e.bosh,token:o,websocketKeepAlive:e.websocketKeepAlive,websocketKeepAliveUrl:e.websocketKeepAliveUrl,xmppPing:s,shard:null===(r=e.deploymentInfo)||void 0===r?void 0:r.shard}),a.connection.on(E.a.Events.CONN_SHARD_CHANGED,(function(){var e={shard_changed:!0,suspend_time:a.connection.ping.getPingSuspendTime(),time_since_last_success:a.connection.getTimeSinceLastSuccess()};a.eventEmitter.emit(l.CONNECTION_FAILED,u.OTHER_ERROR,void 0,void 0,e)})),a._initStrophePlugins(),a.caps=new A.a(a.connection,a.options.clientNode),a.initFeaturesList(),$(window).on("beforeunload unload",(function(e){a.disconnect(e).catch((function(){}))})),a}return Object(o.a)(n,[{key:"initFeaturesList",value:function(){this.caps.addFeature("urn:xmpp:jingle:1"),this.caps.addFeature("urn:xmpp:jingle:apps:rtp:1"),this.caps.addFeature("urn:xmpp:jingle:transports:ice-udp:1"),this.caps.addFeature("urn:xmpp:jingle:apps:dtls:0"),this.caps.addFeature("urn:xmpp:jingle:transports:dtls-sctp:1"),this.caps.addFeature("urn:xmpp:jingle:apps:rtp:audio"),this.caps.addFeature("urn:xmpp:jingle:apps:rtp:video"),this.options.disableRtx||p.a.isFirefox()&&p.a.isVersionLessThan(84)||this.caps.addFeature("urn:ietf:rfc:4588"),!0===this.options.enableOpusRed&&p.a.supportsAudioRed()&&this.caps.addFeature("http://jitsi.org/opus-red"),("undefined"===typeof this.options.enableRemb||this.options.enableRemb)&&this.caps.addFeature("http://jitsi.org/remb"),p.a.isFirefox()||"undefined"!==typeof this.options.enableTcc&&!this.options.enableTcc||this.caps.addFeature("http://jitsi.org/tcc"),this.caps.addFeature("urn:ietf:rfc:5761"),this.caps.addFeature("urn:ietf:rfc:5888"),p.a.isChromiumBased()&&!0===this.options.enableLipSync&&(T.info("Lip-sync enabled !"),this.caps.addFeature("http://jitsi.org/meet/lipsync")),this.connection.rayo&&this.caps.addFeature("urn:xmpp:rayo:client:1"),f.a.isSupported(this.options)&&this.caps.addFeature(D,!1,!0)}},{key:"getConnection",value:function(){return this.connection}},{key:"connectionHandler",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,o=window.performance.now(),r=c.Strophe.getStatusString(n).toLowerCase();if(this.connectionTimes[r]=o,T.log("(TIME) Strophe ".concat(r).concat(i?"[".concat(i,"]"):"",":\t"),o),this.eventEmitter.emit(h.a.CONNECTION_STATUS_CHANGED,t,n,i),n===c.Strophe.Status.CONNECTED||n===c.Strophe.Status.ATTACHED)this._sysMessageHandler&&(this.connection._stropheConn.deleteHandler(this._sysMessageHandler),this._sysMessageHandler=null),this.sendDiscoInfo&&this.connection.jingle.getStunAndTurnCredentials(),T.info("My Jabber ID: ".concat(this.connection.jid)),this._resetState(),this.sendDiscoInfo&&this.caps.getFeaturesAndIdentities(this.options.hosts.domain).then((function(t){var n=t.features,i=t.identities;n.has(c.Strophe.NS.PING)||T.error("Ping NOT supported by ".concat(e.options.hosts.domain," - please enable ping in your XMPP server config")),e._processDiscoInfoIdentities(i,void 0)})).catch((function(e){var t="Feature discovery error";v.a.callErrorHandler(new Error("".concat(t,": ").concat(e))),T.error(t,e)})),this.sendDiscoInfo=!1,t.password&&(this.authenticatedUser=!0),this.connection&&this.connection.connected&&c.Strophe.getResourceFromJid(this.connection.jid)&&this.eventEmitter.emit(l.CONNECTION_ESTABLISHED,c.Strophe.getResourceFromJid(this.connection.jid));else if(n===c.Strophe.Status.CONNFAIL)"x-strophe-bad-non-anon-jid"===i?this.anonymousConnectionFailed=!0:this.connectionFailed=!0,this.lastErrorMsg=i,"giving-up"===i&&this.eventEmitter.emit(l.CONNECTION_FAILED,u.OTHER_ERROR,i);else if(n===c.Strophe.Status.ERROR)this.lastErrorMsg=i;else if(n===c.Strophe.Status.DISCONNECTED){this.connection.ping.stopInterval();var a=Boolean(this.disconnectInProgress),s=i||this.lastErrorMsg;if(this.anonymousConnectionFailed)this.eventEmitter.emit(l.CONNECTION_FAILED,u.PASSWORD_REQUIRED);else if(this.connectionFailed)this.eventEmitter.emit(l.CONNECTION_FAILED,u.OTHER_ERROR,s,void 0,this._getConnectionFailedReasonDetails());else if(a)this.eventEmitter.emit(l.CONNECTION_DISCONNECTED,s);else{T.error("XMPP connection dropped!");var d=c.Strophe.getLastErrorStatus();d>=500&&d<600?this.eventEmitter.emit(l.CONNECTION_FAILED,u.SERVER_ERROR,s||"server-error",void 0,this._getConnectionFailedReasonDetails()):this.eventEmitter.emit(l.CONNECTION_FAILED,u.CONNECTION_DROPPED_ERROR,s||"connection-dropped-error",void 0,this._getConnectionFailedReasonDetails())}}else if(n===c.Strophe.Status.AUTHFAIL){var p=this.getConnection().getLastFailedMessage();this.eventEmitter.emit(l.CONNECTION_FAILED,u.PASSWORD_REQUIRED,i||this._parseConnectionFailedMessage(p),t)}}},{key:"_processDiscoInfoIdentities",value:function(e,t){var n=this;e.forEach((function(e){if("av_moderation"===e.type&&(n.avModerationComponentAddress=e.name),"speakerstats"===e.type&&(n.speakerStatsComponentAddress=e.name),"conference_duration"===e.type&&(n.conferenceDurationComponentAddress=e.name),"lobbyrooms"===e.type){n.lobbySupported=!0;var i=function(e){e.forEach((function(e){e.endsWith("#displayname_required")&&n.eventEmitter.emit(l.DISPLAY_NAME_REQUIRED)}))};t?i(t):e.name&&n.caps.getFeaturesAndIdentities(e.name,e.type).then((function(e){var t=e.features;return i(t)})).catch((function(e){return T.warn("Error getting features from lobby.",e&&e.message)}))}})),(this.avModerationComponentAddress||this.speakerStatsComponentAddress||this.conferenceDurationComponentAddress)&&this.connection.addHandler(this._onPrivateMessage.bind(this),null,"message",null,null)}},{key:"_parseConnectionFailedMessage",value:function(e){if(!e)return null;var t=k.exec(e);return t?t[1]:null}},{key:"_connect",value:function(e,t){this._resetState(),this.sendDiscoInfo=!0,this.connection._stropheConn&&this.connection._stropheConn._addSysHandler?this._sysMessageHandler=this.connection._stropheConn._addSysHandler(this._onSystemMessage.bind(this),null,"message"):T.warn("Cannot attach strophe system handler, jiconop cannot operate"),this.connection.connect(e,t,this.connectionHandler.bind(this,{jid:e,password:t}))}},{key:"_onSystemMessage",value:function(e){var t=this;if(0!==$(e).find(">services").length||0!==$(e).find(">query").length){this.sendDiscoInfo=!1;var n=this.connection.jingle.onReceiveStunAndTurnCredentials(e),i=Object(A.b)(e),o=i.features,r=i.identities;this._processDiscoInfoIdentities(r,o),r.forEach((function(e){"shard"===e.type&&(t.options.deploymentInfo.shard=e.name)})),(n||r.size>0||o.size>0)&&(this.connection._stropheConn.deleteHandler(this._sysMessageHandler),this._sysMessageHandler=null)}}},{key:"attach",value:function(e){this._resetState(),this.sendDiscoInfo=!0;var t=this.connectionTimes.attaching=window.performance.now();T.log("(TIME) Strophe Attaching:\t",t),this.connection.attach(e.jid,e.sid,parseInt(e.rid,10)+1,this.connectionHandler.bind(this,{jid:e.jid,password:e.password}))}},{key:"_resetState",value:function(){this.anonymousConnectionFailed=!1,this.connectionFailed=!1,this.lastErrorMsg=void 0,this.disconnectInProgress=void 0}},{key:"connect",value:function(e,t){if(!e){var n=this.options.hosts,i=n.anonymousdomain,o=n.domain,r=i||o,a=window.location;if(i){var s=a&&a.search;(s&&-1!==s.indexOf("login=true")||this.token)&&(r=o)}e=r||a&&a.hostname}return this._connect(e,t)}},{key:"createRoom",value:function(e,t,n){var i="".concat(e,"@").concat(t.customDomain?t.customDomain:this.options.hosts.muc.toLowerCase(),"/"),o=n?n(this.connection.jid,this.authenticatedUser):y.a.randomHexString(8).toLowerCase();return T.info("JID ".concat(this.connection.jid," using MUC nickname ").concat(o)),i+=o,this.connection.emuc.createRoom(i,null,t)}},{key:"getJid",value:function(){return this.connection.jid}},{key:"getJingleLog",value:function(){var e=this.connection.jingle;return e?e.getLog():{}}},{key:"getXmppLog",value:function(){return(this.connection.logger||{}).log||null}},{key:"dial",value:function(){var e;(e=this.connection.rayo).dial.apply(e,arguments)}},{key:"ping",value:function(e){var t=this;return new Promise((function(n,i){t.connection.ping.ping(t.connection.pingDomain,n,i,e)}))}},{key:"getSessions",value:function(){return this.connection.jingle.sessions}},{key:"disconnect",value:function(e){var t=this;return this.disconnectInProgress?this.disconnectInProgress:this.connection?(this.disconnectInProgress=new Promise((function(e){t.eventEmitter.on(h.a.CONNECTION_STATUS_CHANGED,(function n(i,o){o===c.Strophe.Status.DISCONNECTED&&(e(),t.eventEmitter.removeListener(h.a.CONNECTION_STATUS_CHANGED,n))}))})),this._cleanupXmppConnection(e),this.disconnectInProgress):Promise.resolve()}},{key:"_cleanupXmppConnection",value:function(e){if(!this.connection.isUsingWebSocket&&this.connection.flush(),!this.connection.isUsingWebSocket&&null!==e&&"undefined"!==typeof e){var t=e.type;if(("beforeunload"===t||"unload"===t)&&(this.connection.options.sync=!0,this.connection.sendUnavailableBeacon()))return}this.connection.disconnect(),!0!==this.connection.options.sync&&this.connection.flush()}},{key:"_initStrophePlugins",value:function(){var e={jvb:{iceServers:[]},p2p:{iceServers:[]}},t=this.options.p2p&&this.options.p2p.stunServers||I;Array.isArray(t)&&(T.info("P2P STUN servers: ",t),e.p2p.iceServers=t),this.options.p2p&&this.options.p2p.iceTransportPolicy&&(T.info("P2P ICE transport policy: ",this.options.p2p.iceTransportPolicy),e.p2p.iceTransportPolicy=this.options.p2p.iceTransportPolicy),this.connection.addConnectionPlugin("emuc",new O.a(this)),this.connection.addConnectionPlugin("jingle",new S.a(this,this.eventEmitter,e)),this.connection.addConnectionPlugin("rayo",new _.a)}},{key:"_getConnectionFailedReasonDetails",value:function(){var e={};if(this.options.deploymentInfo&&this.options.deploymentInfo.shard&&this.connection.lastResponseHeaders){var t=this.connection.lastResponseHeaders.trim().split(/[\r\n]+/),n={};t.forEach((function(e){var t=e.split(": "),i=t.shift(),o=t.join(": ");n[i]=o})),e.shard_changed=this.options.deploymentInfo.shard!==n["x-jitsi-shard"]}return e.suspend_time=this.connection.ping.getPingSuspendTime(),e.time_since_last_success=this.connection.getTimeSinceLastSuccess(),e}},{key:"sendDominantSpeakerEvent",value:function(e){if(this.speakerStatsComponentAddress&&e){var t=Object(c.$msg)({to:this.speakerStatsComponentAddress});t.c("speakerstats",{xmlns:"http://jitsi.org/jitmeet",room:e}).up(),this.connection.send(t)}}},{key:"tryParseJSONAndVerify",value:function(e){if(!e)return!1;try{var t=JSON.parse(e);if(t&&"object"===typeof t){var n=t[R];if("undefined"!==typeof n)return t;T.debug("parsing valid json but does not have correct structure","topic: ",n)}}catch(i){return T.error("Error parsing json ".concat(e),i),!1}return!1}},{key:"_onPrivateMessage",value:function(e){var t=e.getAttribute("from");if(t!==this.speakerStatsComponentAddress&&t!==this.conferenceDurationComponentAddress&&t!==this.avModerationComponentAddress)return!0;var n=$(e).find(">json-message").text(),i=this.tryParseJSONAndVerify(n);return!i||("speakerstats"===i[R]&&i.users?this.eventEmitter.emit(h.a.SPEAKER_STATS_RECEIVED,i.users):"conference_duration"===i[R]&&i.created_timestamp?this.eventEmitter.emit(h.a.CONFERENCE_TIMESTAMP_RECEIVED,i.created_timestamp):"av_moderation"===i[R]&&this.eventEmitter.emit(h.a.AV_MODERATION_RECEIVED,i),!0)}}]),n}(g.a)}).call(this,"/index.js")},function(e,t,n){"use strict";n.r(t),n.d(t,"STATUS_AVAILABLE",(function(){return i})),n.d(t,"STATUS_UNDEFINED",(function(){return o})),n.d(t,"STATUS_BUSY",(function(){return r})),n.d(t,"STATE_ON",(function(){return a})),n.d(t,"STATE_OFF",(function(){return s})),n.d(t,"STATE_PENDING",(function(){return c})),n.d(t,"STATE_RETRYING",(function(){return u})),n.d(t,"STATE_FAILED",(function(){return l})),n.d(t,"ERROR_NO_CONNECTION",(function(){return d})),n.d(t,"ERROR_SESSION_EXISTS",(function(){return h}));var i="available",o="undefined",r="busy",a="on",s="off",c="pending",u="retrying",l="failed",d="error_no_connection",h="error_session_already_exists"},,function(e,t,n){"use strict";n.r(t),n.d(t,"CONNECTION_DISCONNECTED",(function(){return i})),n.d(t,"CONNECTION_ESTABLISHED",(function(){return o})),n.d(t,"CONNECTION_FAILED",(function(){return r})),n.d(t,"WRONG_STATE",(function(){return a})),n.d(t,"DISPLAY_NAME_REQUIRED",(function(){return s}));var i="connection.connectionDisconnected",o="connection.connectionEstablished",r="connection.connectionFailed",a="connection.wrongState",s="connection.display_name_required"},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return r})),n.d(t,"d",(function(){return a})),n.d(t,"e",(function(){return s}));var i="statistics.audioLevel",o="statistics.before_disposed",r="statistics.byte_sent_stats",a="statistics.connectionstats",s="statistics.long_tasks_stats"},,,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var i,o,r,a=n(21),s=n(8),c=n(11),u=(n(81),n(6)),l=n(22),d=n(12),h=n(3),p=function e(t,n,i,o,r,a,s){Object(u.a)(this,e),this.type="text",this.text=void 0,this.pid=void 0,this.name=void 0,this.avatarUrl=void 0,this.timestamp=void 0,this.colors=void 0,this.text=t,this.pid=n,this.name=i,this.avatarUrl=o,this.colors=r,this.timestamp=a,this.type=s},f=new(i=function(){function e(){Object(u.a)(this,e),Object(a.a)(this,"messages",o,this),Object(a.a)(this,"sendTo",r,this),Object(h.g)(this)}return Object(s.a)(e,[{key:"limitMessages",value:function(){f.messages.length>1e3&&f.messages.splice(0,f.messages.length-1e3)}},{key:"addMessage",value:function(e){this.messages.push(e),this.limitMessages()}},{key:"participantNameChanged",value:function(e,t){var n=d.a.find(e);if(n){var i=new p("",n.id,n.information.name,n.information.avatarSrc,n.getColor(),Date.now(),"log");i.text=Object(l.c)("cmNameChanged",{old:t,new:i.name}),this.addMessage(i)}}},{key:"participantJoined",value:function(e){var t=d.a.find(e);if(t){var n=new p("",t.id,t.information.name,t.information.avatarSrc,t.getColor(),Date.now(),"log");n.text=Object(l.c)("cmJoined",{name:n.name}),this.addMessage(n)}}},{key:"participantLeft",value:function(e){var t=d.a.find(e);if(t){var n=new p("",t.id,t.information.name,t.information.avatarSrc,t.getColor(),Date.now(),"log");n.text=Object(l.c)("cmLeft",{name:n.name}),this.addMessage(n)}}},{key:"calledBy",value:function(e){var t=new p("",e.id,e.information.name,e.information.avatarSrc,e.getColor(),Date.now(),"called");t.text=Object(l.c)("cmCallBy",{name:t.name}),this.addMessage(t)}},{key:"callTo",value:function(e){var t=new p("",e.id,e.information.name,e.information.avatarSrc,e.getColor(),Date.now(),"callTo");t.text=Object(l.c)("cmCallTo",{name:t.name}),this.addMessage(t)}}]),e}(),o=Object(c.a)(i.prototype,"messages",[h.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),r=Object(c.a)(i.prototype,"sendTo",[h.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Object(c.a)(i.prototype,"limitMessages",[h.b],Object.getOwnPropertyDescriptor(i.prototype,"limitMessages"),i.prototype),Object(c.a)(i.prototype,"addMessage",[h.b],Object.getOwnPropertyDescriptor(i.prototype,"addMessage"),i.prototype),i);t.b=f},,function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return r}));var i={DISCONNECTED:"disconnected",CONNECTING:"connecting",CONNECTED:"connected"},o="_contentTrackCarrier",r="_roomInfoPeeper"},,function(e,t,n){"use strict";function i(e,t){return[e[0]+t[0],e[1]+t[1]]}function o(e,t){return[e[0]-t[0],e[1]-t[1]]}function r(e,t){return[t[0]*e,t[1]*e]}function a(e,t){return[e*t[0],e*t[1]]}function s(e,t){return[e*t[0],e*t[1],e*t[2]]}function c(e){var t=0;return e.forEach((function(e){return t+=e*e})),Math.sqrt(t)}function u(e){return e*Math.PI/180}function l(e){return 180*e/Math.PI}function d(e,t){var n=u(e.orientation),i=Math.sin(n),o=Math.cos(n),r=[t.position[0]-e.position[0],t.position[1]-e.position[1]],a=[r[1]*i+r[0]*o,r[1]*o-r[0]*i],s=t.orientation-e.orientation;return{position:a,orientation:s<0?s+360:s}}function h(e){var t=u(e.orientation);return{position:[e.position[0],0,-e.position[1]],orientation:[Math.sin(t),0,Math.cos(t)]}}function p(e,t){var n=e*(Math.PI/180),i=Math.cos(n),o=Math.sin(n);return[i*t[0]-o*t[1],o*t[0]+i*t[1]]}function f(e,t){return e[0]*t[0]+e[1]*t[1]}function m(e){return Math.sqrt(e.reduce((function(e,t){return e+t*t}),0))}function v(e){return[e[1],-e[0]]}function g(e,t){if(0===e.orientation)return[e.position[1],e.position[0]+t[0],e.position[1]+t[1],e.position[0]];var n=p(e.orientation,e.position),i=p(e.orientation,[t[0],0]),o=p(e.orientation,[0,t[1]]),r=[n[0],n[0]+i[0],n[0]+o[0],n[0]+i[0]+o[0]],a=[n[1],n[1]+i[1],n[1]+o[1],n[1]+i[1]+o[1]];return r.sort((function(e,t){return e-t})),a.sort((function(e,t){return e-t})),[a[0],r[3],a[3],r[0]]}function b(e,t,n){return n[3]<=e[0]-t&&e[0]+t<=n[1]&&n[0]<=e[1]-t&&e[1]+t<=n[2]}function y(e){return Math.round(100*e)/100}function A(e){return"".concat(y(e.position[0]),",").concat(y(e.position[1]),",").concat(y(e.orientation))}function E(e){return"".concat(e.position[0],",").concat(e.position[1],",").concat(e.show?"t":"")}function O(e){var t=e.split(",");return{position:[Number(t[0]),Number(t[1])],orientation:Number(t[2])}}function S(e){var t=e.split(",");return{position:[Number(t[0]),Number(t[1])],show:!!t[2]}}n.d(t,"a",(function(){return i})),n.d(t,"r",(function(){return o})),n.d(t,"h",(function(){return r})),n.d(t,"i",(function(){return a})),n.d(t,"j",(function(){return s})),n.d(t,"k",(function(){return c})),n.d(t,"m",(function(){return l})),n.d(t,"e",(function(){return d})),n.d(t,"b",(function(){return h})),n.d(t,"o",(function(){return p})),n.d(t,"c",(function(){return f})),n.d(t,"s",(function(){return m})),n.d(t,"n",(function(){return v})),n.d(t,"d",(function(){return g})),n.d(t,"f",(function(){return b})),n.d(t,"l",(function(){return A})),n.d(t,"g",(function(){return E})),n.d(t,"q",(function(){return O})),n.d(t,"p",(function(){return S}))},,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return A}));var i,o,r,a,s,c,u,l,h=n(21),p=n(6),f=n(8),m=n(11),v=(n(81),n(54)),g=n(4),b=n(15),y=n(3),A={minScale:.2,maxScale:5},E=.5,O=new(i=function(){function e(){Object(p.a)(this,e),Object(h.a)(this,"matrix",o,this),Object(h.a)(this,"committedMatrix",r,this),Object(h.a)(this,"matrixBeforeZoom",a,this),Object(h.a)(this,"screenSize",s,this),Object(h.a)(this,"left",c,this),Object(h.a)(this,"mouse",u,this),Object(h.a)(this,"mouseOnMap",l,this),this.keyInputUsers=new Set,Object(y.g)(this),this.loadMatrixFromStorage()}return Object(f.a)(e,[{key:"offset",get:function(){return[-(this.left+this.screenSize[0]*E),-this.screenSize[1]*E]}},{key:"offsetFromElement",get:function(){return[-this.screenSize[0]*E,-this.screenSize[1]*E]}},{key:"rotation",get:function(){return Object(g.E)(Object(g.i)(this.committedMatrix))}},{key:"setMatrix",value:function(e){this.matrix=e}},{key:"setCommittedMatrix",value:function(e){var t=this.toWindow(this.mouseOnMap);this.committedMatrix=e,this.mouseOnMap=this.fromWindow(t),this.saveMatrixToStorage(!1),this.matrixBeforeZoom=void 0}},{key:"setScreenSize",value:function(e){this.screenSize[0]=e[0],this.screenSize[1]=e[1]}},{key:"setLeft",value:function(e){this.left=e}},{key:"setMouse",value:function(e){this.mouse=Object(g.a)(e,this.offset),this.mouseOnMap=Object(g.P)(this.matrix.inverse(),this.mouse)}},{key:"focusOn",value:function(e){var t=this.matrix.inverse(),n=Object(g.O)(e.pose.position,[t.e,t.f]),i=(new DOMMatrix).translate(-n[0],-n[1]).preMultiplySelf(this.matrix);this.setMatrix(i),this.setCommittedMatrix(i)}},{key:"zoomTo",value:function(e){var t=this.matrix,n=Array.from(e.size);n[1]+=b.a;var i=[O.screenSize[0]/n[0],O.screenSize[1]/n[1]],o=Math.max(Math.min(i[0],i[1],A.maxScale),A.minScale),r=Object(g.j)(t),a=t.inverse(),s=Object(g.O)(e.pose.position,[a.e,a.f]),c=n[0]/2,u=this.screenSize[1]/o/2-b.a,l=(new DOMMatrix).translate(-s[0]-c,-s[1]-u).preMultiplySelf(t).preMultiplySelf((new DOMMatrix).scale(o/r));console.log("newScale:".concat(o," old").concat(r,"  newMat scaleX=").concat(Object(g.j)(l))),this.setMatrix(l),this.setCommittedMatrix(l),this.matrixBeforeZoom=t,console.log("zoomTo: before: ".concat(this.matrixBeforeZoom))}},{key:"restoreZoom",value:function(){this.matrixBeforeZoom&&(this.setMatrix(this.matrixBeforeZoom),this.setCommittedMatrix(this.matrixBeforeZoom))}},{key:"zoomed",get:function(){return void 0!==this.matrixBeforeZoom}},{key:"toWindow",value:function(e){return Object(g.O)(Object(g.P)(this.matrix,e),this.offset)}},{key:"fromWindow",value:function(e){return Object(g.P)(this.matrix.inverse(),Object(g.a)(e,this.offset))}},{key:"toElement",value:function(e){return Object(g.O)(Object(g.P)(this.matrix,e),this.offsetFromElement)}},{key:"rotateFromWindow",value:function(e){return Object(g.J)(this.matrix.inverse(),e)}},{key:"rotateToWindow",value:function(e){return Object(g.J)(this.matrix,e)}},{key:"visibleArea",value:function(){var e=this.fromWindow([0,0]),t=this.fromWindow(this.screenSize),n=v.a;return[e[1]-n,t[0]+n,t[1]+n,e[0]-n]}},{key:"saveMatrixToStorage",value:function(e){var t=sessionStorage;e&&(t=localStorage);var n=[this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f];t.setItem("mapMatrix",JSON.stringify(n))}},{key:"loadMatrixFromStorage",value:function(){var e=localStorage;sessionStorage.getItem("mapMatrix")&&(e=sessionStorage);var t=e.getItem("mapMatrix");if(t){var n=JSON.parse(t),i=new DOMMatrix;i.a=n[0],i.b=n[1],i.c=n[2],i.d=n[3],i.e=n[4],i.f=n[5],this.setMatrix(i),this.setCommittedMatrix(i)}}}]),e}(),o=Object(m.a)(i.prototype,"matrix",[y.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new DOMMatrixReadOnly}}),r=Object(m.a)(i.prototype,"committedMatrix",[y.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new DOMMatrixReadOnly}}),a=Object(m.a)(i.prototype,"matrixBeforeZoom",[y.h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s=Object(m.a)(i.prototype,"screenSize",[y.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[0,0]}}),Object(m.a)(i.prototype,"offset",[y.d],Object.getOwnPropertyDescriptor(i.prototype,"offset"),i.prototype),Object(m.a)(i.prototype,"offsetFromElement",[y.d],Object.getOwnPropertyDescriptor(i.prototype,"offsetFromElement"),i.prototype),Object(m.a)(i.prototype,"rotation",[y.d],Object.getOwnPropertyDescriptor(i.prototype,"rotation"),i.prototype),c=Object(m.a)(i.prototype,"left",[y.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),u=Object(m.a)(i.prototype,"mouse",[y.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[0,0]}}),l=Object(m.a)(i.prototype,"mouseOnMap",[y.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[0,0]}}),Object(m.a)(i.prototype,"setMatrix",[y.b],Object.getOwnPropertyDescriptor(i.prototype,"setMatrix"),i.prototype),Object(m.a)(i.prototype,"setCommittedMatrix",[y.b],Object.getOwnPropertyDescriptor(i.prototype,"setCommittedMatrix"),i.prototype),Object(m.a)(i.prototype,"setScreenSize",[y.b],Object.getOwnPropertyDescriptor(i.prototype,"setScreenSize"),i.prototype),Object(m.a)(i.prototype,"setLeft",[y.b],Object.getOwnPropertyDescriptor(i.prototype,"setLeft"),i.prototype),Object(m.a)(i.prototype,"setMouse",[y.b],Object.getOwnPropertyDescriptor(i.prototype,"setMouse"),i.prototype),Object(m.a)(i.prototype,"focusOn",[y.b],Object.getOwnPropertyDescriptor(i.prototype,"focusOn"),i.prototype),Object(m.a)(i.prototype,"zoomTo",[y.b],Object.getOwnPropertyDescriptor(i.prototype,"zoomTo"),i.prototype),Object(m.a)(i.prototype,"restoreZoom",[y.b],Object.getOwnPropertyDescriptor(i.prototype,"restoreZoom"),i.prototype),Object(m.a)(i.prototype,"zoomed",[y.d],Object.getOwnPropertyDescriptor(i.prototype,"zoomed"),i.prototype),Object(m.a)(i.prototype,"loadMatrixFromStorage",[y.b],Object.getOwnPropertyDescriptor(i.prototype,"loadMatrixFromStorage"),i.prototype),i);d.map=O,t.b=O},function(e,t,n){"use strict";(function(e){var i,o,r=n(190),a=n(18),s=n(356),c=n.n(s),u=Object(a.getLogger)(e);function l(){return"".concat(Math.random().toString(16),"000000000").substr(2,8)}t.a={_storage:r.b,init:function(e){this._storage=e||r.b},get callStatsUserName(){return i||(i=this._storage.getItem("callStatsUserName"))||(i=function(){var e=c.a.generateUsername();return u.log("generated callstats uid",e),e}(),this._storage.setItem("callStatsUserName",i)),i},get machineId(){if(!o){var e=this._storage.getItem("billingId");o=e||this._storage.getItem("jitsiMeetId"),e?this._storage.setItem("jitsiMeetId",e):o||(o=function(){var e=l()+l()+l()+l();return u.log("generated id",e),e}(),this._storage.setItem("jitsiMeetId",o))}return o},get sessionId(){return this._storage.getItem("sessionId")},set sessionId(e){e?this._storage.setItem("sessionId",e):this._storage.removeItem("sessionId")}}}).call(this,"/index.js")},function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return d}));var i=n(14),o=n(6),r=n(8),a=n(73);function s(e){return parseInt(e.ssrcs.split(" ")[0],10)}function c(e){return parseInt(e.ssrcs.split(" ")[1],10)}function u(e){return e.ssrcs?e.ssrcs.map((function(e){return e.id})).filter((function(e,t,n){return n.indexOf(e)===t})).length:0}var l=function(){function e(t){if(Object(o.a)(this,e),!t)throw new Error("mLine is undefined");this.mLine=t}return Object(r.a)(e,[{key:"ssrcs",get:function(){return this.mLine.ssrcs||(this.mLine.ssrcs=[]),this.mLine.ssrcs},set:function(e){this.mLine.ssrcs=e}},{key:"direction",get:function(){return this.mLine.direction},set:function(e){this.mLine.direction=e}},{key:"ssrcGroups",get:function(){return this.mLine.ssrcGroups||(this.mLine.ssrcGroups=[]),this.mLine.ssrcGroups},set:function(e){this.mLine.ssrcGroups=e}},{key:"getSSRCAttrValue",value:function(e,t){var n=this.ssrcs.find((function(n){return n.id===e&&n.attribute===t}));return n&&n.value}},{key:"removeSSRC",value:function(e){this.mLine.ssrcs&&this.mLine.ssrcs.length&&(this.mLine.ssrcs=this.mLine.ssrcs.filter((function(t){return t.id!==e})))}},{key:"addSSRCAttribute",value:function(e){this.ssrcs.push(e)}},{key:"findGroup",value:function(e,t){return this.ssrcGroups.find((function(n){return n.semantics===e&&(!t||t===n.ssrcs)}))}},{key:"findGroups",value:function(e){return this.ssrcGroups.filter((function(t){return t.semantics===e}))}},{key:"findGroupByPrimarySSRC",value:function(e,t){return this.ssrcGroups.find((function(n){return n.semantics===e&&s(n)===t}))}},{key:"findSSRCByMSID",value:function(e){return this.ssrcs.find((function(t){return"msid"===t.attribute&&(null===e||t.value===e)}))}},{key:"getSSRCCount",value:function(){return u(this.mLine)}},{key:"containsAnySSRCGroups",value:function(){return void 0!==this.mLine.ssrcGroups}},{key:"getPrimaryVideoSsrc",value:function(){var e=this.mLine.type;if("video"!==e)throw new Error("getPrimarySsrc doesn't work with '".concat(e,"'"));if(1===u(this.mLine))return this.mLine.ssrcs[0].id;if(this.mLine.ssrcGroups){var t=this.findGroup("SIM");if(t)return s(t);var n=this.findGroup("FID");if(n)return s(n);var i=this.findGroup("FEC-FR");if(i)return s(i)}}},{key:"getRtxSSRC",value:function(e){var t=this.findGroupByPrimarySSRC("FID",e);return t&&c(t)}},{key:"getSSRCs",value:function(){return this.ssrcs.map((function(e){return e.id})).filter((function(e,t,n){return n.indexOf(e)===t}))}},{key:"getPrimaryVideoSSRCs",value:function(){var e=this.mLine.type;if("video"!==e)throw new Error("getPrimaryVideoSSRCs doesn't work with ".concat(e));var t,n=this.getSSRCs(),o=Object(i.a)(this.ssrcGroups);try{for(o.s();!(t=o.n()).done;){var r=t.value;if("FID"===r.semantics||"FEC-FR"===r.semantics){var a=c(r);n.splice(n.indexOf(a),1)}}}catch(s){o.e(s)}finally{o.f()}return n}},{key:"dumpSSRCGroups",value:function(){return JSON.stringify(this.mLine.ssrcGroups)}},{key:"removeGroupsWithSSRC",value:function(e){this.mLine.ssrcGroups&&(this.mLine.ssrcGroups=this.mLine.ssrcGroups.filter((function(t){return-1===t.ssrcs.indexOf("".concat(e))})))}},{key:"removeGroupsBySemantics",value:function(e){this.mLine.ssrcGroups&&(this.mLine.ssrcGroups=this.mLine.ssrcGroups.filter((function(t){return t.semantics!==e})))}},{key:"replaceSSRC",value:function(e,t){this.mLine.ssrcs&&this.mLine.ssrcs.forEach((function(n){n.id===e&&(n.id=t)}))}},{key:"addSSRCGroup",value:function(e){this.ssrcGroups.push(e)}}]),e}(),d=function(){function e(t){Object(o.a)(this,e),this.parsedSDP=a.parse(t)}return Object(r.a)(e,[{key:"selectMedia",value:function(e){var t=this.parsedSDP.media.find((function(t){return t.type===e}));return t?new l(t):null}},{key:"toRawSDP",value:function(){return a.write(this.parsedSDP)}}]),e}()},,,function(e,t,n){"use strict";n.d(t,"d",(function(){return r})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return c}));var i=n(6),o=n(8);function r(e){var t=e;return e>=Number.MAX_SAFE_INTEGER&&(t=0),t+1}function a(e){return e.length>0?e.reduce((function(e,t){return e+t}))/e.length:0}function s(e){return e.filter((function(e){return e>=0}))}var c=function(){function e(){Object(i.a)(this,e),this.average=0,this.n=0}return Object(o.a)(e,[{key:"addNext",value:function(e){"number"===typeof e&&(this.n+=1,this.average=this.average+(e-this.average)/this.n)}},{key:"getAverage",value:function(){return this.average}}]),e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"LOCAL_STATS_UPDATED",(function(){return i})),n.d(t,"REMOTE_STATS_UPDATED",(function(){return o}));var i="cq.local_stats_updated",o="cq.remote_stats_updated"},,,,,function(e,t,n){"use strict";var i=n(12);n.d(t,"a",(function(){return i.a}))},function(e,t,n){"use strict";n.d(t,"b",(function(){return g})),n.d(t,"a",(function(){return b}));var i=n(14),o=n(6),r=n(8),a=n(4),s=n(12),c=n(42),u=n(15),l=n(29),h=function(){function e(t,n,i){Object(o.a)(this,e),this.startTime=0,this.media=void 0,this.pid=void 0,this.cid=void 0,this.role=void 0,this.blobs=[],this.onData=function(){},this.role=n,this.pid=null===i||void 0===i?void 0:i.pid,this.cid=null===i||void 0===i?void 0:i.cid,this.media=new MediaRecorder(t),this.media.addEventListener("dataavailable",this.onDataAvailable.bind(this))}return Object(r.a)(e,[{key:"onDataAvailable",value:function(e){var t=e.data;this.blobs.push(t),console.log("p:".concat(this.pid," c:").concat(this.cid," role:").concat(this.role," blob type:").concat(t.type," size:").concat(t.size)+"url:".concat(window.URL.createObjectURL(t))),this.onData(this)}}]),e}(),p=function e(t,n){Object(o.a)(this,e),this.msg=void 0,this.time=void 0,this.msg=t,this.time=n||Date.now()},f=function(){function e(){Object(o.a)(this,e),this.medias=[],this.messages=[],this.recording=!1}return Object(r.a)(e,[{key:"recordMessage",value:function(e){this.recording&&this.messages.push(new p(e))}},{key:"start",value:function(e){this.recording=!0,this.makeMediaRecorders();var t,n=Object(i.a)(this.medias);try{for(n.s();!(t=n.n()).done;){var o=t.value;o.media.start(),o.startTime=Date.now()}}catch(p){n.e(p)}finally{n.f()}var r=Object(c.j)(e.contents.all);this.messages.push({msg:{t:l.b.CONTENT_UPDATE_REQUEST,v:JSON.stringify(r)},time:Date.now()});var s=Array.from(e.participants.remote.values());s.unshift(e.participants.local);for(var u=0,d=s;u<d.length;u++){var h=d[u];this.messages.push({msg:{t:l.b.PARTICIPANT_INFO,p:h.id,v:JSON.stringify(h.information)},time:Date.now()}),this.messages.push({msg:{t:l.b.PARTICIPANT_POSE,p:h.id,v:JSON.stringify(Object(a.D)(h.pose))},time:Date.now()}),this.messages.push({msg:{t:l.b.PARTICIPANT_MOUSE,p:h.id,v:JSON.stringify(Object(a.z)(h.mouse))},time:Date.now()})}}},{key:"stopMediaRecordings",value:function(){var e=this;this.recording=!1;var t=0;return new Promise((function(n,o){if(e.medias.length){var r,a=Object(i.a)(e.medias);try{for(a.s();!(r=a.n()).done;){var s=r.value;s.onData=function(){++t===e.medias.length&&n(e.medias)},s.media.stop()}}catch(c){a.e(c)}finally{a.f()}}else n(e.medias)}))}},{key:"stop",value:function(){var e=this;return new Promise((function(t){e.stopMediaRecordings().then((function(n){var o=[],r=[],a=new Blob([JSON.stringify(e.messages)],{type:"application/json"}),s={role:"message",size:a.size,type:a.type};o.push(a),r.push(s);var c,u=Object(i.a)(n);try{for(u.s();!(c=u.n()).done;){var l=c.value;if(l.blobs.length){var d=new Blob(l.blobs),h={pid:l.pid,cid:l.cid,role:l.role,size:d.size,type:l.blobs[0].type,time:l.startTime};o.push(d),r.push(h)}}}catch(m){u.e(m)}finally{u.f()}o.unshift(new Blob([JSON.stringify(r)],{type:"application/json"}));var p=new Uint32Array(1);p[0]=o[0].size,o.unshift(new Blob([p]));var f=new Blob(o,{type:"application/octet-stream"});t(f)}))}))}},{key:"makeMediaRecorders",value:function(){var e=Array.from(s.a.remote.values());e.push(s.a.local);for(var t=0,n=e;t<n.length;t++){var o=n[t];o.tracks.avatarStream&&this.medias.push(new h(o.tracks.avatarStream,"avatar",{pid:o.id})),o.tracks.audioStream&&this.medias.push(new h(o.tracks.audioStream,"mic",{pid:o.id}))}var r,a=u.c.tracks.allContentStreams(),c=Object(i.a)(a);try{for(c.s();!(r=c.n()).done;){var l=r.value,d=u.c.find(l.cid);!d||"screen"!==d.type&&"camera"!==d.type?console.error("Failed to find content cid=".concat(l.cid,".")):this.medias.push(new h(l.stream,d.type,{cid:d.id}))}}catch(p){c.e(p)}finally{c.f()}}}]),e}(),m=function e(t,n){Object(o.a)(this,e),this.blob=void 0,this.time=void 0,this.cid=void 0,this.pid=void 0,this.role=void 0,this.blob=t,this.time=n.time,this.cid=n.cid,this.pid=n.pid,this.role=n.role},v=function(){function e(){Object(o.a)(this,e),this.messages=[],this.medias=[]}return Object(r.a)(e,[{key:"load",value:function(e){var t=this;return new Promise((function(n){var o=0;e.slice(o,o+4).arrayBuffer().then((function(r){o+=4;var a=new Int32Array(r)[0],s=0;e.slice(o,o+a).text().then((function(r){o+=a;var c=JSON.parse(r);console.log(JSON.stringify(c));var u,l=Object(i.a)(c);try{var d=function(){var i=u.value;"message"===i.role?e.slice(o,o+i.size).text().then((function(e){t.messages=JSON.parse(e),++s===c.length&&n(t)})):e.slice(o,o+i.size).arrayBuffer().then((function(e){var o=new Blob([e],{type:i.type});t.medias.push(new m(o,i)),++s===c.length&&n(t)})),o+=i.size};for(l.s();!(u=l.n()).done;)d()}catch(h){l.e(h)}finally{l.f()}e.size!==o&&console.error("archive size ".concat(e.size," not matched to end of blobs ").concat(o,"."))}))}))}))}},{key:"play",value:function(e,t){var n=this,i=Array.from(this.messages),o=Array.from(this.medias);i.sort((function(e,t){return e.time-t.time})),o.sort((function(e,t){return e.time-t.time}));var r=this.messages.length&&this.medias.length?Math.min(this.messages[0].time,this.medias[0].time):this.messages.length?this.messages[0].time:this.medias[0].time;function a(e){for(;i.length&&i[0].time<r;){var t=i.shift();e.playMessage(t.msg)}for(;o.length&&o[0].time<r;){var n=o.shift();e.playMedia(n)}r+=30,(i.length||o.length)&&setTimeout((function(){a(e)}),30)}setTimeout((function(){a(n)}),30)}},{key:"playMedia",value:function(e){if(console.log("media:".concat(e.blob.type,", pid:").concat(e.pid,", cid:").concat(e.pid,", role:").concat(e.role)),e.pid){var t=s.a.getPlayback(e.pid);"mic"===e.role?t.audioBlob=e.blob:"avatar"===e.role&&(t.videoBlob=e.blob)}}},{key:"playMessage",value:function(e){switch(e.t){case l.b.PARTICIPANT_INFO:if(e.p)s.a.getPlayback(e.p).information=JSON.parse(e.v);break;case l.b.PARTICIPANT_POSE:if(e.p)s.a.getPlayback(e.p).pose=Object(a.N)(JSON.parse(e.v));break;case l.b.PARTICIPANT_MOUSE:if(e.p)s.a.getPlayback(e.p).mouse=Object(a.M)(JSON.parse(e.v))}}}]),e}(),g=new f,b=new v;d.recorder=g,d.player=b},function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return r}));var i="pending",o="active",r="ended"},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i={ACCEPT:"session-accept",CONNECTION_ERROR:"connection-error-encountered",INITIATE:"session-initiate",TERMINATE:"session-terminate",TRANSPORT_INFO:"transport-info",UNAVAILABLE:"unavailable"}},,,,,,,function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return D}));var i,o=n(14),r=n(6),a=n(8),s=n(20),c=n(41),u=n.n(c),l=n(18).getLogger(e),d="createOffer",h="createAnswer",p="setLocalDescription",f="setRemoteDescription",m="addIceCandidate",v="getUserMedia",g="iceConnectionFailure",b="applicationLog",y="fabricHold",A="fabricResume",E="audioMute",O="audioUnmute",S="videoPause",C="videoResume",_="screenShareStart",j="screenShareStop",T="dominantSpeaker",k="activeDeviceList",I="error",R="event",w="mstWithUserID",D=function(){function e(t,n){Object(r.a)(this,e),this.confID=n.confID,this.tpc=t,this.peerconnection=t.peerconnection,this.remoteUserID=n.remoteUserID||"jitsi",this.hasFabric=!1,e.fabrics.add(this),e.backendInitialized&&(this._addNewFabric(),1===e.fabrics.size&&e._emptyReportQueue(this))}return Object(a.a)(e,[{key:"_addNewFabric",value:function(){l.info("addNewFabric",this.remoteUserID);try{var t={remoteEndpointType:this.tpc.isP2P?e.backend.endpointType.peer:e.backend.endpointType.server},n=e.backend.addNewFabric(this.peerconnection,this.remoteUserID,e.backend.fabricUsage.multiplex,this.confID,t,e._addNewFabricCallback);this.hasFabric=!0;var i="success"===n.status;return i||l.error("callstats fabric not initilized",n.message),i}catch(o){return u.a.callErrorHandler(o),!1}}},{key:"associateStreamWithVideoTag",value:function(t,n,i,o,r){if(e.backend){var a=n?e.userID:i;e.backendInitialized?e.backend.associateMstWithUserID(this.peerconnection,a,this.confID,t,o,r):e.reportsQueue.push({type:w,pc:this.peerconnection,data:{callStatsId:a,containerId:r,ssrc:t,usageLabel:o}})}}},{key:"sendDominantSpeakerEvent",value:function(){e._reportEvent(this,T)}},{key:"sendTerminateEvent",value:function(){e.backendInitialized&&e.backend.sendFabricEvent(this.peerconnection,e.backend.fabricEvent.fabricTerminated,this.confID),e.fabrics.delete(this)}},{key:"sendIceConnectionFailedEvent",value:function(){e._reportError(this,g,null,this.peerconnection)}},{key:"sendCreateOfferFailed",value:function(t){e._reportError(this,d,t,this.peerconnection)}},{key:"sendCreateAnswerFailed",value:function(t){e._reportError(this,h,t,this.peerconnection)}},{key:"sendResumeOrHoldEvent",value:function(t){e._reportEvent(this,t?A:y)}},{key:"sendScreenSharingEvent",value:function(t,n){var i;n&&(i={ssrc:n}),e._reportEvent(this,t?_:j,i)}},{key:"sendSetLocalDescFailed",value:function(t){e._reportError(this,p,t,this.peerconnection)}},{key:"sendSetRemoteDescFailed",value:function(t){e._reportError(this,f,t,this.peerconnection)}},{key:"sendAddIceCandidateFailed",value:function(t){e._reportError(this,m,t,this.peerconnection)}}],[{key:"_addNewFabricCallback",value:function(t,n){e.backend&&"success"!==t&&l.error("Monitoring status: ".concat(t," msg: ").concat(n))}},{key:"_initCallback",value:function(t,n){if(l.log("CallStats Status: err=".concat(t," msg=").concat(n)),"success"===t){e.backendInitialized=!0;var i,r=!1,a=null,s=Object(o.a)(e.fabrics.values());try{for(s.s();!(i=s.n()).done;){var c=i.value;c.hasFabric||(l.debug("addNewFabric - initCallback"),c._addNewFabric()&&(r=!0,a||(a=c)))}}catch(u){s.e(u)}finally{s.f()}r&&e._emptyReportQueue(a)}}},{key:"_emptyReportQueue",value:function(t){var n,i=t.confID,r=t.peerconnection,a=Object(o.a)(e.reportsQueue);try{for(a.s();!(n=a.n()).done;){var s=n.value;if(s.type===I){var c=s.data;e._reportError(t,c.type,c.error,c.pc||r)}else if(s.type===R){var u=s.data;e.backend.sendFabricEvent(s.pc||r,u.event,i,u.eventData)}else if(s.type===w){var l=s.data;e.backend.associateMstWithUserID(s.pc||r,l.callStatsId,i,l.ssrc,l.usageLabel,l.containerId)}}}catch(d){a.e(d)}finally{a.f()}e.reportsQueue.length=0}},{key:"_reportError",value:function(t,n,i,o){var r=i;r||(l.warn("No error is passed!"),r=new Error("Unknown error")),e.backendInitialized&&t?e.backend.reportError(o,t.confID,n,r):e.reportsQueue.push({type:I,data:{error:r,pc:o,type:n}})}},{key:"_reportEvent",value:function(t,n,i){var o=t&&t.peerconnection,r=t&&t.confID;e.backendInitialized&&t?e.backend.sendFabricEvent(o,n,r,i):e.reportsQueue.push({confID:r,pc:o,type:R,data:{event:n,eventData:i}})}},{key:"_traceAndCatchBackendCalls",value:function(e){for(var t=function(){var t=i[n],o=e[t];e[t]=function(){try{for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return o.apply(e,n)}catch(r){u.a.callErrorHandler(r)}}},n=0,i=["associateMstWithUserID","sendFabricEvent","sendUserFeedback"];n<i.length;n++)t();for(var o=function(){var t=a[r],n=e[t];e[t]=function(){for(var i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];l.debug(t,o),n.apply(e,o)}},r=0,a=["associateMstWithUserID","sendFabricEvent","sendUserFeedback"];r<a.length;r++)o();var c=e.reportError;e.reportError=function(t,n,i){for(var o=arguments.length,r=new Array(o>3?o-3:0),a=3;a<o;a++)r[a-3]=arguments[a];i===b?s.a.isReactNative()||console&&console.debug("reportError",t,n,i):l.debug.apply(l,["reportError",t,n,i].concat(r));try{c.call.apply(c,[e,t,n,i].concat(r))}catch(d){i===b?console&&console.error("reportError",d):u.a.callErrorHandler(d)}}}},{key:"fabrics",get:function(){return i||(i=new Set),i}},{key:"initBackend",value:function(t){if(e.backend)throw new Error("CallStats backend has been initialized already!");try{var n,i=callstats;if(e.backend=new i,e._traceAndCatchBackendCalls(e.backend),e.userID={aliasName:t.aliasName,userName:t.userName},e.callStatsID=t.callStatsID,e.callStatsSecret=t.callStatsSecret,t.applicationName&&(n={applicationVersion:"".concat(t.applicationName," (").concat(s.a.getName(),")")}),t.confID){var o=t.confID.match(/.*\/(.*)\/.*/);n.siteID=t.siteID||o&&o[1]||"/"}e.backend.initialize(e.callStatsID,e.callStatsSecret,e.userID,e._initCallback,void 0,n);var r=t.getWiFiStatsMethod;return r&&(e.backend.attachWifiStatsHandler(r),r().then((function(e){e&&l.info("Reported wifi addresses:",JSON.parse(e).addresses)})).catch((function(){}))),!0}catch(a){return u.a.callErrorHandler(a),e.backend=null,l.error(a),!1}}},{key:"isBackendInitialized",value:function(){return Boolean(e.backend)}},{key:"sendActiveDeviceListEvent",value:function(t,n){e._reportEvent(n,k,t)}},{key:"sendApplicationLog",value:function(t,n){try{e._reportError(n,b,t,n&&n.peerconnection)}catch(i){console&&"function"===typeof console.error&&console.error("sendApplicationLog failed",i)}}},{key:"sendFeedback",value:function(t,n,i){return new Promise((function(o,r){if(e.backend)e.backend.sendUserFeedback(t,{userID:e.userID,overall:n,comment:i},(function(e,t){"success"===e?o(t):r(t)}));else{var a="Failed to submit feedback to CallStats - no backend";l.error(a),r(a)}}))}},{key:"sendGetUserMediaFailed",value:function(t,n){e._reportError(n,v,t,null)}},{key:"sendMuteEvent",value:function(t,n,i){var o;o="video"===n?t?S:C:t?E:O,e._reportEvent(i,o)}}]),e}();D.backend=null,D.reportsQueue=[],D.backendInitialized=!1,D.callStatsID=null,D.callStatsSecret=null,D.userID=null}).call(this,"/index.js")},,,,function(e,t){function n(e,t){return Math.floor(Math.random()*(t-e+1))+e}function i(e){return e[n(0,e.length-1)]}var o={randomHexDigit:function(){return i("0123456789abcdef")},randomHexString:function(e){for(var t="";e--;)t+=this.randomHexDigit();return t},randomElement:i,randomAlphanumStr:function(e){for(var t="",n=0;n<e;n+=1)t+=i("0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ");return t},randomInt:n};e.exports=o},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var i=n(8),o=n(35),r=n(34),a=n(6),s=n(72);function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return function e(){Object(a.a)(this,e)}}();return function(e){Object(o.a)(n,e);var t=Object(r.a)(n);function n(){var e;Object(a.a)(this,n);for(var i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).connection=null,e}return Object(i.a)(n,[{key:"init",value:function(e){this.connection=e}}]),n}(e)}t.b=c();var u=c(s.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return S}));var i,o,r=n(30),a=n(21),s=n(6),c=n(8),u=n(11),l=(n(81),n(7)),h=n(54),p=n(4),f=n(106),m=n(15),v=n(3),g=function(e){};function b(e){return{pose:Object(l.a)({},e.pose),onStage:!1}}var y=(i=function(){function e(){Object(s.a)(this,e),this.local=void 0,this.updateAll=!0,this.updateSet=new Set,this.limits=[-1,-1],this.limitUpdated=!1,this.priorityMaps=[new Map,new Map],this.lastPriority=[[],[]],Object(a.a)(this,"tracksToAccept",o,this),this.disposers=[],this._enabled=!1,this.local=b(f.a.local),Object(v.g)(this)}return Object(c.a)(e,[{key:"clear",value:function(){this.disable(),this.updateAll=!0,this.updateSet.clear(),this.priorityMaps.forEach((function(e){return e.clear()})),this.lastPriority=[[],[]],this.tracksToAccept=[[],[]]}},{key:"setLimits",value:function(e){this.limits[0]=e[0],this.limits[1]=e[1],this.limitUpdated=!0}},{key:"onRemoteTrackAdded",value:function(e){this.updateSet.add(e.getParticipantId())}},{key:"enabled",get:function(){return this._enabled}},{key:"enable",value:function(){var e=this;this.updateAll=!0;var t=Object(v.c)((function(){var t=f.a.local;e.local=b(t),e.updateAll=!0})),n=new Map,i=Object(v.c)((function(){var e=new Map(f.a.remote),t=Object(p.f)(e,n);Object(p.f)(n,e).forEach(s),t.forEach(u),n=e})),o=new Map,r=Object(v.c)((function(){var e=new Map(m.c.tracks.remoteContents),t=Object(p.f)(e,o);Object(p.f)(o,e).forEach(c),t.forEach(l),o=e})),a=new Map,s=function(t){var n=a.get(t.id);if(void 0===n)throw new Error("Cannot find disposer for remote participant with id: ".concat(t.id));n(),e.priorityMaps.forEach((function(e){return e.delete(t.id)})),a.delete(t.id),e.updateSet.add(t.id),g("onRemoveParticipant:",t,e.priorityMaps[0])},c=function(t,n){var i=a.get(n);if(void 0===i)throw new Error("Cannot find disposer for remote participant with id: ".concat(n));i(),e.priorityMaps.forEach((function(e){return e.delete(n)})),a.delete(n),e.updateSet.add(n),g("onRemoveContent:",n,e.priorityMaps[0])},u=function(t){a.set(t.id,Object(v.c)((function(){if(t.tracks.audio||t.tracks.avatar){t.physics.onStage||f.a.yarnPhones.has(t.id),t.pose.position;e.updateSet.add(t.id)}}))),g("onAddParticipant:",t,e.priorityMaps[0])},l=function(t,n){a.set(n,Object(v.c)((function(){if(t.size){m.c.find(n);e.updateSet.add(t.values().next().value.getParticipantId())}}))),g("onAddContent:",n,e.priorityMaps[0])};this.disposers=[t,i,r],this._enabled=!0}},{key:"disable",value:function(){this.disposers.forEach((function(e){return e()})),this._enabled=!1}},{key:"update",value:function(){if(!this.haveUpdates)return this.lastPriority;var e=this.calcPriority();return this.updateAll=!1,this.updateSet.clear(),this.limitUpdated=!1,e}},{key:"calcPriority",value:function(){var e=this;Array.from(f.a.remote.keys()).filter((function(t){return!!e.updateAll||e.updateSet.has(t)})).forEach((function(t){var n=f.a.remote.get(t);n&&[n.tracks.avatar,n.tracks.audio].forEach((function(t,i){if(t){var o=function(e,t){return{endpointId:e.id,onStage:t.isAudioTrack()&&(e.physics.onStage||f.a.yarnPhones.has(e.id)||e.inLocalsZone),pose:Object(l.a)({},e.pose),size:[0,0],offset:0,priority:0,muted:t.isAudioTrack()?e.muteAudio:e.muteVideo}}(n,t);o.priority=e.calcPriorityValue(e.local,o),e.priorityMaps[i].set(n.id,o)}}))})),Array.from(m.c.tracks.remoteContents.values()).map((function(e){var t=e.values().next();return t.done?void 0:t.value.getParticipantId()})).filter((function(t){return t&&(!!e.updateAll||e.updateSet.has(t))})).forEach((function(t){var n=m.c.tracks.carrierMap.get(t),i=n?m.c.find(n):void 0;if(i){var o=Array.from(m.c.tracks.remoteContents.get(i.id));[o.find((function(e){return e.isVideoTrack()})),o.find((function(e){return e.isAudioTrack()}))].forEach((function(t,n){if(t){var o=function(e,t){return{endpointId:t.getParticipantId(),onStage:!1,pose:Object(l.a)({},e.pose),size:e.size,offset:10*-h.a,priority:0,muted:!1}}(i,t);o.priority=e.calcPriorityValue(e.local,o),e.priorityMaps[n].set(i.id,o)}}))}}));var t=this.priorityMaps.map((function(e){return Array.from(e.values()).sort((function(e,t){return e.priority-t.priority}))})),n=m.c.tracks.remoteMainTrack();n&&t.forEach((function(e,t){var i=n[t];if(i){var o=function(e){return{endpointId:e.getParticipantId(),onStage:!0,pose:{position:[0,0],orientation:0},size:[0,0],offset:100*-h.a,priority:0,muted:!1}}(i);e.unshift(o)}}));var i=[[],[]];i[0]=t[0].filter((function(e){return!e.muted})),i[0].splice(this.limits[0]),i[1]=t[1];var o=t[1].filter((function(e){return e.muted})).length;i[1].splice(Math.min(this.limits[0]+o,i[1].length)),this.tracksToAccept=i;var r=this.tracksToAccept.map((function(e){return e.map((function(e){return e.endpointId}))}));return this.lastPriority=r,this.lastPriority}},{key:"calcPriorityValue",value:function(e,t){if(t.onStage)return 0;var n=t.size.map((function(n,i){var o=t.pose.position[i]-e.pose.position[i];return o<0&&(o+=n)>0&&(o=0),o}));return Math.sqrt(n[0]*n[0]+n[1]*n[1])+t.offset}},{key:"haveUpdates",get:function(){return this.updateAll||0!==this.updateSet.size||this.limitUpdated}}]),e}(),o=Object(u.a)(i.prototype,"tracksToAccept",[v.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[[],[]]}}),i),A=n(275),E=n(44),O=n.n(E),S=new y;d.priorityCalculator=S;var C=void 0;Object(v.c)((function(){var e=A.a.state;"connected"===e?(S.enable(),C=window.setInterval(_,1e3)):"disconnected"===e&&(S.disable(),void 0!==C&&clearInterval(C))})),Object(v.c)((function(){var e=f.a.local;S.setLimits([e.remoteVideoLimit,e.remoteAudioLimit])}));var _=function(){var e=void 0;return function(){var t=S.update();if(!O.a.isEqual(t,e)){var n={onStageEndpoints:t[0]};r.b.conference.setReceiverConstraints(n),r.b.conference.setPerceptibles(t),g("setPerceptibles:",t),e=O.a.cloneDeep(t)}}}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"g",(function(){return a})),n.d(t,"k",(function(){return s})),n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return u})),n.d(t,"f",(function(){return l})),n.d(t,"e",(function(){return d})),n.d(t,"j",(function(){return h})),n.d(t,"h",(function(){return p})),n.d(t,"i",(function(){return f})),n.d(t,"b",(function(){return m}));var i=n(28),o=n(14);function r(e){if(!e)throw new Error("Not a truthy value")}var a=/Chrome/.test(navigator.userAgent);/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor);function s(e,t){var n;if(e.size!==t.size)return!1;var r,a=Object(o.a)(e);try{for(a.s();!(r=a.n()).done;){var s=Object(i.a)(r.value,2),c=s[0],u=s[1];if((n=t.get(c))!==u||void 0===n&&!t.has(c))return!1}}catch(l){a.e(l)}finally{a.f()}return!0}function c(e,t){var n,i=new Map(e),r=Object(o.a)(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;i.delete(a[0])}}catch(s){r.e(s)}finally{r.f()}return i}function u(e,t){var n,i=new Set(e),r=Object(o.a)(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;i.delete(a)}}catch(s){r.e(s)}finally{r.f()}return i}function l(e,t){var n=new Map;return e.forEach((function(e,i){t.has(i)&&n.set(i,e)})),n}function d(e){return function(t){var n,i={},r=Object(o.a)(Object.keys(e));try{for(r.s();!(n=r.n()).done;){var a=n.value;i[a]=t[a]}}catch(s){r.e(s)}finally{r.f()}return i}}function h(){return!!navigator.userAgent.match(/iPhone|Android.+Mobile/)}function p(){return window.parent.screen.width<window.parent.screen.height}function f(e){return e.host===window.location.host&&e.pathname===window.location.pathname}function m(e){var t=new Image;return t.src=e,new Promise((function(n,i){t.onload=function(){n(e)},t.onerror=function(){i("")}}))}},function(e,t,n){"use strict";n.d(t,"c",(function(){return B})),n.d(t,"b",(function(){return U})),n.d(t,"a",(function(){return V}));var i,o,r,a,s,c,u,l,d,h,p,f,m,v,g,b,y,A,E,O,S,C,_,j,T,k=n(25),I=n(35),R=n(34),w=n(21),D=n(6),N=n(8),P=n(11),M=(n(81),n(54)),L=n(4),x=n(243),F=n(3),B=(i=F.h.ref,o=F.h.ref,r=function(){function e(){Object(D.a)(this,e),Object(w.a)(this,"audio",a,this),Object(w.a)(this,"avatar",s,this),Object(w.a)(this,"avatarOk",c,this),Object(F.g)(this)}return Object(N.a)(e,[{key:"audioStream",get:function(){var e;return null===(e=this.audio)||void 0===e?void 0:e.getOriginalStream()}},{key:"avatarStream",get:function(){var e;return this.avatarOk?null===(e=this.avatar)||void 0===e?void 0:e.getOriginalStream():void 0}},{key:"onMuteChanged",value:function(e,t){e===this.avatar&&(this.avatarOk=!t)}}]),e}(),a=Object(P.a)(r.prototype,"audio",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),s=Object(P.a)(r.prototype,"avatar",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),c=Object(P.a)(r.prototype,"avatarOk",[F.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!this.avatar||!this.avatar.getTrack().muted}}),Object(P.a)(r.prototype,"audioStream",[F.d],Object.getOwnPropertyDescriptor(r.prototype,"audioStream"),r.prototype),Object(P.a)(r.prototype,"avatarStream",[F.d],Object.getOwnPropertyDescriptor(r.prototype,"avatarStream"),r.prototype),Object(P.a)(r.prototype,"onMuteChanged",[F.b],Object.getOwnPropertyDescriptor(r.prototype,"onMuteChanged"),r.prototype),r),U=(u=function e(){Object(D.a)(this,e),Object(w.a)(this,"micMuted",l,this),Object(w.a)(this,"speakerMuted",d,this),Object(w.a)(this,"headphone",h,this),Object(F.g)(this)},l=Object(P.a)(u.prototype,"micMuted",[F.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),d=Object(P.a)(u.prototype,"speakerMuted",[F.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),h=Object(P.a)(u.prototype,"headphone",[F.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),u),V=(p=F.h.shallow,f=F.h.shallow,m=F.h.shallow,v=F.b.bound,g=function(e){Object(I.a)(n,e);var t=Object(R.a)(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Object(D.a)(this,n),e=t.call(this),Object(w.a)(e,"id",b,Object(k.a)(e)),Object(w.a)(e,"physics",y,Object(k.a)(e)),Object(w.a)(e,"mouse",A,Object(k.a)(e)),Object(w.a)(e,"awayFromKeyboard",E,Object(k.a)(e)),Object(w.a)(e,"information",O,Object(k.a)(e)),Object(w.a)(e,"muteAudio",S,Object(k.a)(e)),Object(w.a)(e,"muteSpeaker",C,Object(k.a)(e)),Object(w.a)(e,"muteVideo",_,Object(k.a)(e)),Object(w.a)(e,"audioLevel",j,Object(k.a)(e)),Object(w.a)(e,"recording",T,Object(k.a)(e)),Object(F.g)(Object(k.a)(e)),e.information=i?M.b:M.d,e}return Object(N.a)(n,[{key:"setAudioLevel",value:function(e){this.audioLevel=e}},{key:"showAudio",get:function(){return!this.muteAudio}},{key:"showVideo",get:function(){return!this.muteVideo}},{key:"getColor",value:function(){var e=this.information.color;e.length||(e=this.information.name.length?Object(L.p)(this.information.name):[208,208,224]);var t=this.information.textColor;t.length||(t=Object(L.m)(e));var n=Object(L.l)(e);return[Object(L.G)(e),Object(L.G)(t),Object(L.G)(n)]}},{key:"getColorRGB",value:function(){return this.information.color.length?this.information.color:Object(L.p)(this.information.name)}},{key:"getTextColorRGB",value:function(){var e=this.information.textColor;if(!e.length){var t=this.information.color;t.length||(t=Object(L.p)(this.information.name)),e=Object(L.m)(t)}return e}},{key:"setPhysics",value:function(e){Object.assign(this.physics,e)}}]),n}(x.a),b=Object(P.a)(g.prototype,"id",[F.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),y=Object(P.a)(g.prototype,"physics",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return M.c}}),A=Object(P.a)(g.prototype,"mouse",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{position:[0,0],show:!1}}}),E=Object(P.a)(g.prototype,"awayFromKeyboard",[F.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),O=Object(P.a)(g.prototype,"information",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S=Object(P.a)(g.prototype,"muteAudio",[F.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),C=Object(P.a)(g.prototype,"muteSpeaker",[F.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_=Object(P.a)(g.prototype,"muteVideo",[F.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),j=Object(P.a)(g.prototype,"audioLevel",[F.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Object(P.a)(g.prototype,"setAudioLevel",[F.b],Object.getOwnPropertyDescriptor(g.prototype,"setAudioLevel"),g.prototype),T=Object(P.a)(g.prototype,"recording",[F.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(P.a)(g.prototype,"showAudio",[F.d],Object.getOwnPropertyDescriptor(g.prototype,"showAudio"),g.prototype),Object(P.a)(g.prototype,"showVideo",[F.d],Object.getOwnPropertyDescriptor(g.prototype,"showVideo"),g.prototype),Object(P.a)(g.prototype,"setPhysics",[v],Object.getOwnPropertyDescriptor(g.prototype,"setPhysics"),g.prototype),g)},function(e,t,n){"use strict";n.r(t),n.d(t,"CONNECTION_DROPPED_ERROR",(function(){return i})),n.d(t,"OTHER_ERROR",(function(){return o})),n.d(t,"PASSWORD_REQUIRED",(function(){return r})),n.d(t,"SERVER_ERROR",(function(){return a}));var i="connection.droppedError",o="connection.otherError",r="connection.passwordRequired",a="connection.serverError"},,,function(e,t,n){"use strict";function i(e){for(var t=0,n=0;n!==e.length;n+=1)t=e.charCodeAt(n)+13*t;var i=t%4096;return[17*(Math.floor(i/256)%16),17*(Math.floor(i/16)%16),17*(Math.floor(i)%16)]}function o(e){return r(e)?[255,255,136]:[0,0,136]}function r(e){return e[0]+e[1]+.2*e[2]<340}function a(e){return[255-e[0],255-e[1],255-e[2]]}function s(e){var t=[Math.floor(e[0]),Math.floor(e[1]),Math.floor(e[2])],n=t[1],i=t[2];return"#".concat("0".concat(t[0].toString(16)).slice(-2)).concat("0".concat(n.toString(16)).slice(-2)).concat("0".concat(i.toString(16)).slice(-2))}function c(e){return function(e){var t=e[0]/17,n=e[1]/17,i=e[2]/17,o=r(e)?"#FF8":"#008";return["#".concat(t.toString(16)).concat(n.toString(16)).concat(i.toString(16)),o,"#".concat((15-t).toString(16)).concat((15-n).toString(16)).concat((15-i).toString(16))]}(i(e))}function u(e,t){return"rgba(".concat(e[0],",").concat(e[1],",").concat(e[2],",").concat(t,")")}n.d(t,"d",(function(){return i})),n.d(t,"b",(function(){return o})),n.d(t,"e",(function(){return r})),n.d(t,"a",(function(){return a})),n.d(t,"f",(function(){return s})),n.d(t,"c",(function(){return c})),n.d(t,"g",(function(){return u}))},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return v}));var i=n(14),o=n(6),r=n(8),a=n(25),s=n(35),c=n(34),u=n(18),l=n(13),d=(n(498),n(72)),h=n(347),p=n(349),f=n(350),m=Object(u.getLogger)(e),v=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e){var i,r=e.enableWebsocketResume,s=e.websocketKeepAlive,c=e.websocketKeepAliveUrl,u=e.serviceUrl,d=e.shard,m=e.xmppPing;return Object(o.a)(this,n),(i=t.call(this))._options={enableWebsocketResume:"undefined"===typeof r||r,pingOptions:m,shard:d,websocketKeepAlive:"undefined"===typeof s?6e4:Number(s),websocketKeepAliveUrl:c},i._stropheConn=new l.Strophe.Connection(u),i._usesWebsocket=u.startsWith("ws:")||u.startsWith("wss:"),i._stropheConn.maxRetries=3,i._rawInputTracker=new p.a,i._rawInputTracker.startTracking(Object(a.a)(i),i._stropheConn),i._resumeTask=new h.a(i._stropheConn),i._deferredIQs=[],i.addConnectionPlugin("ping",new f.a({getTimeSinceLastServerResponse:function(){return i.getTimeSinceLastSuccess()},onPingThresholdExceeded:function(){return i._onPingErrorThresholdExceeded()},pingOptions:m})),i._oneSuccessfulConnect=!1,i}return Object(r.a)(n,[{key:"connected",get:function(){var e=this._stropheConn&&this._stropheConn._proto&&this._stropheConn._proto.socket;return(this._status===l.Strophe.Status.CONNECTED||this._status===l.Strophe.Status.ATTACHED)&&(!this.isUsingWebSocket||e&&e.readyState===WebSocket.OPEN)}},{key:"disco",get:function(){return this._stropheConn.disco}},{key:"disconnecting",get:function(){return!0===this._stropheConn.disconnecting}},{key:"domain",get:function(){return this._stropheConn.domain}},{key:"isUsingWebSocket",get:function(){return this._usesWebsocket}},{key:"jid",get:function(){return this._stropheConn.jid}},{key:"lastResponseHeaders",get:function(){return this._stropheConn._proto&&this._stropheConn._proto.lastResponseHeaders}},{key:"logger",get:function(){return this._stropheConn.logger}},{key:"options",get:function(){return this._stropheConn.options}},{key:"pingDomain",get:function(){var e;return(null===(e=this._options.pingOptions)||void 0===e?void 0:e.domain)||this.domain}},{key:"service",get:function(){return this._stropheConn.service}},{key:"status",get:function(){return this._status}},{key:"addConnectionPlugin",value:function(e,t){this[e]=t,t.init(this)}},{key:"addHandler",value:function(){var e;(e=this._stropheConn).addHandler.apply(e,arguments)}},{key:"attach",value:function(e,t,n,i){for(var o,r=arguments.length,a=new Array(r>4?r-4:0),s=4;s<r;s++)a[s-4]=arguments[s];(o=this._stropheConn).attach.apply(o,[e,t,n,this._stropheConnectionCb.bind(this,i)].concat(a))}},{key:"connect",value:function(e,t,n){for(var i,o=arguments.length,r=new Array(o>3?o-3:0),a=3;a<o;a++)r[a-3]=arguments[a];(i=this._stropheConn).connect.apply(i,[e,t,this._stropheConnectionCb.bind(this,n)].concat(r))}},{key:"_stropheConnectionCb",value:function(e,t){this._status=t;var i,o=!1;t===l.Strophe.Status.CONNECTED||t===l.Strophe.Status.ATTACHED?(this._maybeEnableStreamResume(),this._usesWebsocket&&this._oneSuccessfulConnect&&this._keepAliveAndCheckShard(),this._oneSuccessfulConnect=!0,this._maybeStartWSKeepAlive(),this._processDeferredIQs(),this._resumeTask.cancel(),this.ping.startInterval((null===(i=this._options.pingOptions)||void 0===i?void 0:i.domain)||this.domain)):t===l.Strophe.Status.DISCONNECTED&&(this.ping.stopInterval(),(o=this._tryResumingConnection())||clearTimeout(this._wsKeepAlive));if(!o){for(var r=arguments.length,a=new Array(r>2?r-2:0),s=2;s<r;s++)a[s-2]=arguments[s];e.apply(void 0,[t].concat(a)),this.eventEmitter.emit(n.Events.CONN_STATUS_CHANGED,t)}}},{key:"_clearDeferredIQs",value:function(){var e,t=Object(i.a)(this._deferredIQs);try{for(t.s();!(e=t.n()).done;){e.value.reject(new Error("disconnect"))}}catch(n){t.e(n)}finally{t.f()}this._deferredIQs=[]}},{key:"closeWebsocket",value:function(){this._stropheConn&&this._stropheConn._proto&&(this._stropheConn._proto._closeSocket(),this._stropheConn._proto._onClose(null))}},{key:"disconnect",value:function(){var e;this._resumeTask.cancel(),clearTimeout(this._wsKeepAlive),this._clearDeferredIQs(),(e=this._stropheConn).disconnect.apply(e,arguments)}},{key:"flush",value:function(){var e;(e=this._stropheConn).flush.apply(e,arguments)}},{key:"getTimeSinceLastSuccess",value:function(){return this._rawInputTracker.getTimeSinceLastSuccess()}},{key:"getLastFailedMessage",value:function(){return this._rawInputTracker.getLastFailedMessage()}},{key:"_maybeEnableStreamResume",value:function(){if(this._options.enableWebsocketResume){var e=this._stropheConn.streamManagement;this.isUsingWebSocket?e?e.isSupported()?e.getResumeToken()||(m.info("Enabling XEP-0198 stream management"),e.enable(!0)):m.warn("Stream resume enabled, but XEP-0198 is not supported by the server"):m.warn("Stream resume enabled, but Strophe streamManagement plugin is not installed"):m.warn("Stream resume enabled, but WebSockets are not enabled")}}},{key:"_maybeStartWSKeepAlive",value:function(){var e=this,t=this._options.websocketKeepAlive;if(this._usesWebsocket&&t>0){this._wsKeepAlive||m.info("WebSocket keep alive interval: ".concat(t,"ms")),clearTimeout(this._wsKeepAlive);var n=t+60*Math.random()*1e3;m.debug("Scheduling next WebSocket keep-alive in ".concat(n,"ms")),this._wsKeepAlive=setTimeout((function(){return e._keepAliveAndCheckShard().then((function(){return e._maybeStartWSKeepAlive()}))}),n)}}},{key:"_keepAliveAndCheckShard",value:function(){var e=this,t=this._options,i=t.shard,o=t.websocketKeepAliveUrl,r=o||this.service.replace("wss://","https://").replace("ws://","http://");return fetch(r).then((function(t){if(i){var o=t.headers.get("x-jitsi-shard");o!==i&&(m.error("Detected that shard changed from ".concat(i," to ").concat(o)),e.eventEmitter.emit(n.Events.CONN_SHARD_CHANGED))}})).catch((function(e){m.error("Websocket Keep alive failed for url: ".concat(r),{error:e})}))}},{key:"_processDeferredIQs",value:function(){var e,t=this,n=Object(i.a)(this._deferredIQs);try{var o=function(){var n=e.value;if(n.iq){clearTimeout(n.timeout);var i=Date.now()-n.start;t.sendIQ(n.iq,(function(e){return n.resolve(e)}),(function(e){return n.reject(e)}),i)}};for(n.s();!(e=n.n()).done;)o()}catch(r){n.e(r)}finally{n.f()}this._deferredIQs=[]}},{key:"send",value:function(e){if(!this.connected)throw new Error("Not connected");this._stropheConn.send(e)}},{key:"sendIQ",value:function(e,t,n,i){if(this.connected)return this._stropheConn.sendIQ(e,t,n,i);n("Not connected")}},{key:"sendIQ2",value:function(e,t){var n=this,i=t.timeout;return new Promise((function(t,o){if(n.connected)n.sendIQ(e,(function(e){return t(e)}),(function(e){return o(e)}),i);else{var r={iq:e,resolve:t,reject:o,start:Date.now(),timeout:setTimeout((function(){r.iq=void 0,o(void 0)}),i)};n._deferredIQs.push(r)}}))}},{key:"_onPingErrorThresholdExceeded",value:function(){this.isUsingWebSocket&&(m.warn("Ping error threshold exceeded - killing the WebSocket"),this.closeWebsocket())}},{key:"sendPresence",value:function(e,t,n,i){this.connected?this._stropheConn.sendPresence(e,t,n,i):n("Not connected")}},{key:"sendUnavailableBeacon",value:function(){if(!navigator.sendBeacon||this._stropheConn.disconnecting||!this._stropheConn.connected)return!1;this._stropheConn._changeConnectStatus(l.Strophe.Status.DISCONNECTING),this._stropheConn.disconnecting=!0;var e=this._stropheConn._proto._buildBody().attrs({type:"terminate"}),t=Object(l.$pres)({xmlns:l.Strophe.NS.CLIENT,type:"unavailable"});e.cnode(t.tree());var n=navigator.sendBeacon(-1===this.service.indexOf("https://")?"https:".concat(this.service):this.service,l.Strophe.serialize(e.tree()));return m.info("Successfully send unavailable beacon ".concat(n)),this._stropheConn._proto._abortAllRequests(),this._stropheConn._doDisconnect(),!0}},{key:"_tryResumingConnection",value:function(){var e=this._stropheConn.streamManagement;return!(!e||!e.getResumeToken())&&(this._resumeTask.schedule(),!0)}}],[{key:"Events",get:function(){return{CONN_STATUS_CHANGED:"CONN_STATUS_CHANGED",CONN_SHARD_CHANGED:"CONN_SHARD_CHANGED"}}},{key:"Status",get:function(){return l.Strophe.Status}}]),n}(d.a)}).call(this,"/index.js")},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}));var i="signaling.peerMuted",o="signaling.peerVideoType"},,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}));var i="https://api.callstats.io/static/callstats-ws.min.js",o=5},,,function(e,t,n){"use strict";function i(){"granted"!==Notification.permission&&"denied"!==Notification.permission&&Notification.requestPermission()}function o(e,t){"granted"===Notification.permission&&new Notification(e,t)}n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}))},,,,,,function(e,t,n){"use strict";var i,o,r,a,s,c,u,l=n(21),d=n(6),h=n(8),p=n(11),f=(n(81),n(3)),m=(i=function(){function e(){Object(d.a)(this,e),this.defaultBackgroundFill=[255,255,255],this.defaultBackgroundColor=[255,255,255],Object(l.a)(this,"roomProps",o,this),Object(l.a)(this,"password",r,this),Object(l.a)(this,"newPassword",a,this),Object(l.a)(this,"passMatched",s,this),Object(l.a)(this,"backgroundFill",c,this),Object(l.a)(this,"backgroundColor",u,this),Object(f.g)(this)}return Object(h.a)(e,[{key:"onUpdateProp",value:function(e,t){switch(void 0===t?this.roomProps.delete(e):this.roomProps.set(e,t),e){case"backgroundFill":this.backgroundFill=t?JSON.parse(t):this.defaultBackgroundFill;break;case"backgroundColor":this.backgroundColor=t?JSON.parse(t):this.defaultBackgroundColor}}}]),e}(),o=Object(p.a)(i.prototype,"roomProps",[f.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Map}}),r=Object(p.a)(i.prototype,"password",[f.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),a=Object(p.a)(i.prototype,"newPassword",[f.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),s=Object(p.a)(i.prototype,"passMatched",[f.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),c=Object(p.a)(i.prototype,"backgroundFill",[f.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.defaultBackgroundFill}}),u=Object(p.a)(i.prototype,"backgroundColor",[f.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.defaultBackgroundColor}}),Object(p.a)(i.prototype,"onUpdateProp",[f.b],Object.getOwnPropertyDescriptor(i.prototype,"onUpdateProp"),i.prototype),i);t.a=new m},,,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(6),o=n(8),r=function(){function e(){var t=this;Object(i.a)(this,e),this.promise=new Promise((function(e,n){t.resolve=function(){t.clearRejectTimeout(),e.apply(void 0,arguments)},t.reject=function(){t.clearRejectTimeout(),n.apply(void 0,arguments)}})),this.then=this.promise.then.bind(this.promise),this.catch=this.promise.catch.bind(this.promise)}return Object(o.a)(e,[{key:"clearRejectTimeout",value:function(){clearTimeout(this._timeout)}},{key:"setRejectTimeout",value:function(e){var t=this;this._timeout=setTimeout((function(){t.reject(new Error("timeout"))}),e)}}]),e}()},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return s}));var i=n(70),o=n(52),r=n(20),a=n(18).getLogger(e),s=5,c={obtainStream:null,init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=e,this.obtainStream=this._createObtainStreamMethod(),this.obtainStream||a.info("Desktop sharing disabled")},_createObtainStreamMethod:function(){return r.a.isNWJS()?function(e,t){window.JitsiMeetNW.obtainDesktopStream(e,(function(e,n){var r;r=e&&"InvalidStateError"===e.name?new i.a(o.SCREENSHARING_USER_CANCELED):new i.a(e,n,["desktop"]),"function"===typeof t&&t(r)}))}:r.a.isElectron()?this.obtainScreenOnElectron:r.a.isReactNative()&&r.a.supportsGetDisplayMedia()?this.obtainScreenFromGetDisplayMediaRN:r.a.supportsGetDisplayMedia()?this.obtainScreenFromGetDisplayMedia:(a.log("Screen sharing not supported on ",r.a.getName()),null)},_getAudioConstraints:function(){var e=this.options.audioQuality;return null===e||void 0===e||!e.stereo||{autoGainControl:!1,channelCount:2,echoCancellation:!1,noiseSuppression:!1}},isSupported:function(){return null!==this.obtainStream},obtainScreenOnElectron:function(e,t){var n=this;if(window.JitsiMeetScreenObtainer&&window.JitsiMeetScreenObtainer.openDesktopPicker){var r=this.options,a=r.desktopSharingFrameRate,c=r.desktopSharingSources;window.JitsiMeetScreenObtainer.openDesktopPicker({desktopSharingSources:c||["screen","window"]},(function(r,c){var u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(r){var l,d,h=!1;if(u){h={};var p=n._getAudioConstraints();"boolean"!==typeof p&&(h={optional:p}),"screen"===c&&(h.mandatory={chromeMediaSource:"desktop"})}var f={audio:h,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,minFrameRate:null!==(l=null===a||void 0===a?void 0:a.min)&&void 0!==l?l:s,maxFrameRate:null!==(d=null===a||void 0===a?void 0:a.max)&&void 0!==d?d:s,maxWidth:window.screen.width,maxHeight:window.screen.height}}};navigator.mediaDevices.getUserMedia(f).then((function(t){return e({stream:t,sourceId:r,sourceType:c})}),t)}else t(new i.a(o.SCREENSHARING_USER_CANCELED))}),(function(e){return t(new i.a(o.ELECTRON_DESKTOP_PICKER_ERROR,e))}))}else t(new i.a(o.ELECTRON_DESKTOP_PICKER_NOT_FOUND))},obtainScreenFromGetDisplayMedia:function(e,t){var n;n=navigator.getDisplayMedia?navigator.getDisplayMedia.bind(navigator):navigator.mediaDevices.getDisplayMedia.bind(navigator.mediaDevices);var r=this.options.desktopSharingFrameRate,s="object"!==typeof r||{frameRate:r},c=this._getAudioConstraints();s.frameRate&&delete s.frameRate.min;var u={video:s,audio:c,cursor:"always"};a.info("Using getDisplayMedia for screen sharing",u),n(u).then((function(t){e({stream:t,sourceId:t.id})})).catch((function(e){var n={errorName:e&&e.name,errorMsg:e&&e.message,errorStack:e&&e.stack};a.error("getDisplayMedia error",u,n),n.errorMsg&&-1!==n.errorMsg.indexOf("denied by system")?t(new i.a(o.PERMISSION_DENIED)):t(new i.a(o.SCREENSHARING_USER_CANCELED))}))},obtainScreenFromGetDisplayMediaRN:function(e,t){a.info("Using getDisplayMedia for screen sharing"),navigator.mediaDevices.getDisplayMedia({video:!0}).then((function(t){e({stream:t,sourceId:t.id})})).catch((function(){t(new i.a(o.SCREENSHARING_USER_CANCELED))}))}};t.b=c}).call(this,"/index.js")},function(e,t){e.exports={ENVIRONMENT:"environment",USER:"user"}},,function(e,t,n){"use strict";n.r(t),n.d(t,"DEVICE_LIST_CHANGED",(function(){return i})),n.d(t,"PERMISSIONS_CHANGED",(function(){return o})),n.d(t,"PERMISSION_PROMPT_IS_SHOWN",(function(){return r})),n.d(t,"SLOW_GET_USER_MEDIA",(function(){return a}));var i="mediaDevices.devicechange",o="rtc.permissions_changed",r="mediaDevices.permissionPromptIsShown",a="mediaDevices.slowGetUserMedia"},,,,,function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return A})),n.d(t,"a",(function(){return E}));var i=n(6),o=n(8),r=n(35),a=n(34),s=n(122),c=n(60),u=n(57),l=n(12),d=n(15),h=n(55),p=n(282),f=n.n(p),m=n(61),v=n.n(m),g=n(462),b=n(89),y=function(e){};e.$=f.a,e.jQuery=f.a;var A={useIPv6:!1,disableSimulcast:!0,enableWindowOnErrorHandler:!0,enableAnalyticsLogging:!1,disableThiredPartyRequests:!1,disableAudioLevels:!1,desktopSharingChromeExtId:"mbocklcggfhnbahlnepmldehdhpjfcjp",desktopSharingChromeDisabled:!1,desktopSharingChromeSources:["screen","window"],desktopSharingChromeMinExtVersion:"0.1",desktopSharingFirefoxDisabled:!1,desktopSharingFrameRate:{min:.3,max:30}},E=function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(){var e;Object(i.a)(this,n);for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r)))._jitsiConnection=void 0,e._store=void 0,e.conference=new g.a,e.version="0.0.1",e.state=b.a.DISCONNECTED,e}return Object(o.a)(n,[{key:"Store",set:function(e){this._store=e}},{key:"init",value:function(){var e=this;return Object.assign(A,config.rtc.screenOptions),new Promise((function(t,n){v.a.init(A),v.a.setLogLevel("warn"),e._jitsiConnection=new v.a.JitsiConnection(null,void 0,config),e._jitsiConnection.addEventListener(v.a.events.connection.CONNECTION_ESTABLISHED,(function(){e.onStateChanged(b.a.CONNECTED),t(v.a.events.connection.CONNECTION_ESTABLISHED)})),e._jitsiConnection.addEventListener(v.a.events.connection.CONNECTION_FAILED,(function(){e.onStateChanged(b.a.DISCONNECTED),n(v.a.events.connection.CONNECTION_FAILED)})),e._jitsiConnection.addEventListener(v.a.events.connection.CONNECTION_DISCONNECTED,(function(){e.onStateChanged(b.a.DISCONNECTED)})),e._jitsiConnection.connect(),e.onStateChanged(b.a.CONNECTING)}))}},{key:"joinConference",value:function(e){var t=this;if(!this._jitsiConnection)throw new Error("No connection has been established.");this.conference.init(e,(function(){var n;return null===(n=t._jitsiConnection)||void 0===n?void 0:n.initJitsiConference(e.toLowerCase(),config)}))}},{key:"leaveConference",value:function(){return this.conference.uninit()}},{key:"disconnect",value:function(){var e;return this._jitsiConnection?(y("Disconnection order has been sent."),null===(e=this._jitsiConnection)||void 0===e?void 0:e.disconnect()):Promise.reject("No connection has been established.")}},{key:"reconnect",value:function(){var e=this;u.a.setType("retry"),l.a.leaveAll(),d.c.clearAllRemotes(),s.a.clear(),this.leaveConference().then((function(){console.log("Disconnected but succeed in leaving... strange ... try to join again.")})).catch((function(){var t;console.log("Disconnected and failed to leave... try to join again"),null===(t=e.conference.bmRelaySocket)||void 0===t||t.close()})).finally((function(){null!==c.a.testBot&&window.location.reload()}))}},{key:"onStateChanged",value:function(e){var t=this;this.state!==e&&e===b.a.DISCONNECTED&&setTimeout((function(){t._jitsiConnection.disconnect().finally((function(){setTimeout(t.reconnect.bind(t),1e3)}))}),1e3),this.state=e,this._store&&this._store.changeState(this.state)}}]),n}(h.EventEmitter)}).call(this,n(93))},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=n(212),o=new(n(160).a);o.Store=i.a,d.connection=o},,,,,function(e,t,n){var i=n(495),o={loadScript:function(e,t,n,o,r,a){var s=document,c="script",u=s.createElement(c),l=s.getElementsByTagName(c)[0];if(u.async=t,o){var d=i();if(d){var h=d.src,p=h.substring(0,h.lastIndexOf("/")+1);h&&p&&(e=p+e)}}r&&(u.onload=r),a&&(u.onerror=a),u.src=e,n?l.parentNode.insertBefore(u,l):l.parentNode.appendChild(u)}};e.exports=o},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return g})),n.d(t,"b",(function(){return b}));var i=n(7),o=n(14),r=n(6),a=n(8),s=n(18),c=n(10),u=n(58),l=n(19),d=n(31),h=n.n(d),p=n(32),f=n(20),m=n(27),v=Object(s.getLogger)(e),g={ACTIVE:"active",INACTIVE:"inactive",INTERRUPTED:"interrupted",RESTORING:"restoring"},b=function(){function e(t,n,i){Object(r.a)(this,e),this.rtc=t,this.conference=n,this.trackTimers={},this.connStatusFromJvb={},this.outOfLastNTimeout="number"===typeof i.outOfLastNTimeout?i.outOfLastNTimeout:500,this.rtcMuteTimeout="number"===typeof i.rtcMuteTimeout?i.rtcMuteTimeout:1e4,this.rtcMutedTimestamp={},v.info("RtcMuteTimeout set to: ".concat(this.rtcMuteTimeout)),this.enteredLastNTimestamp=new Map,this.restoringTimers=new Map,this.connectionStatusMap=new Map}return Object(a.a)(e,[{key:"_getVideoFrozenTimeout",value:function(e){return this.rtc.isInLastN(e)?this.rtcMuteTimeout:this.outOfLastNTimeout}},{key:"init",value:function(){this._onEndpointConnStatusChanged=this.onEndpointConnStatusChanged.bind(this),this.rtc.addListener(h.a.ENDPOINT_CONN_STATUS_CHANGED,this._onEndpointConnStatusChanged),this._onP2PStatus=this.refreshConnectionStatusForAll.bind(this),this.conference.on(c.P2P_STATUS,this._onP2PStatus),this._onUserLeft=this.onUserLeft.bind(this),this.conference.on(c.USER_LEFT,this._onUserLeft),f.a.supportsVideoMuteOnConnInterrupted()&&(this._onTrackRtcMuted=this.onTrackRtcMuted.bind(this),this.rtc.addListener(h.a.REMOTE_TRACK_MUTE,this._onTrackRtcMuted),this._onTrackRtcUnmuted=this.onTrackRtcUnmuted.bind(this),this.rtc.addListener(h.a.REMOTE_TRACK_UNMUTE,this._onTrackRtcUnmuted),this._onRemoteTrackAdded=this.onRemoteTrackAdded.bind(this),this.conference.on(c.TRACK_ADDED,this._onRemoteTrackAdded),this._onRemoteTrackRemoved=this.onRemoteTrackRemoved.bind(this),this.conference.on(c.TRACK_REMOVED,this._onRemoteTrackRemoved),this._onSignallingMuteChanged=this.onSignallingMuteChanged.bind(this),this._onTrackVideoTypeChanged=this.onTrackVideoTypeChanged.bind(this)),this._onLastNChanged=this._onLastNChanged.bind(this),this.conference.on(c.LAST_N_ENDPOINTS_CHANGED,this._onLastNChanged),this._onLastNValueChanged=this.refreshConnectionStatusForAll.bind(this),this.rtc.on(h.a.LASTN_VALUE_CHANGED,this._onLastNValueChanged)}},{key:"dispose",value:function(){this.rtc.removeListener(h.a.ENDPOINT_CONN_STATUS_CHANGED,this._onEndpointConnStatusChanged),f.a.supportsVideoMuteOnConnInterrupted()&&(this.rtc.removeListener(h.a.REMOTE_TRACK_MUTE,this._onTrackRtcMuted),this.rtc.removeListener(h.a.REMOTE_TRACK_UNMUTE,this._onTrackRtcUnmuted),this.conference.off(c.TRACK_ADDED,this._onRemoteTrackAdded),this.conference.off(c.TRACK_REMOVED,this._onRemoteTrackRemoved)),this.conference.off(c.LAST_N_ENDPOINTS_CHANGED,this._onLastNChanged),this.rtc.removeListener(h.a.LASTN_VALUE_CHANGED,this._onLastNValueChanged),this.conference.off(c.P2P_STATUS,this._onP2PStatus),this.conference.off(c.USER_LEFT,this._onUserLeft);for(var e=0,t=Object.keys(this.trackTimers);e<t.length;e++){var n=t[e];this.clearTimeout(n),this.clearRtcMutedTimestamp(n)}for(var i in this.connectionStatusMap)this.connectionStatusMap.hasOwnProperty(i)&&this.onUserLeft(i);this.connStatusFromJvb={}}},{key:"onEndpointConnStatusChanged",value:function(e,t){v.debug("Detector RTCEvents.ENDPOINT_CONN_STATUS_CHANGED(".concat(Date.now(),"): ").concat(e,": ").concat(t)),e!==this.conference.myUserId()&&(this.connStatusFromJvb[e]=t,this.figureOutConnectionStatus(e))}},{key:"_changeConnectionStatus",value:function(e,t){if(e.getConnectionStatus()!==t){var n=e.getId();e._setConnectionStatus(t),v.debug("Emit endpoint conn status(".concat(Date.now(),") ").concat(n,": ").concat(t)),m.a.sendLog(JSON.stringify({id:"peer.conn.status",participant:n,status:t})),this.conference.eventEmitter.emit(c.PARTICIPANT_CONN_STATUS_CHANGED,n,t)}}},{key:"clearTimeout",value:function(e){this.trackTimers[e]&&(window.clearTimeout(this.trackTimers[e]),this.trackTimers[e]=null)}},{key:"clearRtcMutedTimestamp",value:function(e){this.rtcMutedTimestamp[e]=null}},{key:"onRemoteTrackAdded",value:function(e){var t=this;e.isLocal()||e.getType()!==l.c||(v.debug("Detector on remote track added for: ".concat(e.getParticipantId())),e.on(u.TRACK_MUTE_CHANGED,this._onSignallingMuteChanged),e.on(u.TRACK_VIDEOTYPE_CHANGED,(function(n){return t._onTrackVideoTypeChanged(e,n)})))}},{key:"onRemoteTrackRemoved",value:function(e){if(!e.isLocal()&&e.getType()===l.c){var t=e.getParticipantId();v.debug("Detector on remote track removed: ".concat(t)),e.off(u.TRACK_MUTE_CHANGED,this._onSignallingMuteChanged),this.clearTimeout(t),this.clearRtcMutedTimestamp(t),this.figureOutConnectionStatus(t)}}},{key:"isVideoTrackFrozen",value:function(e){if(!f.a.supportsVideoMuteOnConnInterrupted())return!1;var t=e.getId(),n=e.hasAnyVideoTrackWebRTCMuted(),i=this.rtcMutedTimestamp[t],o=this._getVideoFrozenTimeout(t);return n&&"number"===typeof i&&Date.now()-i>=o}},{key:"refreshConnectionStatusForAll",value:function(){var e,t=this.conference.getParticipants(),n=Object(o.a)(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;this.figureOutConnectionStatus(i.getId())}}catch(r){n.e(r)}finally{n.f()}}},{key:"figureOutConnectionStatus",value:function(t){var n=this.conference.getParticipantById(t);if(n){var o=this.conference.isP2PActive(),r=this._isRestoringTimedout(t),a=0===this.conference.getLastN(),s=n.isVideoMuted()||a,c=this.isVideoTrackFrozen(n),u=this.rtc.isInLastN(t),d=this.connStatusFromJvb[t];"boolean"!==typeof d&&(d=!0);var h=o?e._getNewStateForP2PMode(s,c):e._getNewStateForJvbMode(d,u,r,s,c);h!==g.RESTORING&&this._clearRestoringTimer(t),v.debug("Figure out conn status for ".concat(t,", is video muted: ").concat(s," is active(jvb): ").concat(d," video track frozen: ").concat(c," p2p mode: ").concat(o," is in last N: ").concat(u," currentStatus => newStatus: ").concat(n.getConnectionStatus()," => ").concat(h));var p=this.connectionStatusMap[t]||{};if(!("p2p"in p)||!("connectionStatus"in p)||p.p2p!==o||p.connectionStatus!==h){var f=Date.now();if(this.maybeSendParticipantConnectionStatusEvent(t,f),this.connectionStatusMap[t]=Object(i.a)(Object(i.a)({},p),{},{connectionStatus:h,p2p:o,startedMs:f}),!("videoType"in this.connectionStatusMap[t])){var m=n.getTracksByMediaType(l.c);Array.isArray(m)&&0!==m.length&&(this.connectionStatusMap[t].videoType=m[0].videoType)}}this._changeConnectionStatus(n,h)}else v.debug("figure out conn status - no participant for: ".concat(t))}},{key:"maybeSendParticipantConnectionStatusEvent",value:function(e,t){var n=this.connectionStatusMap[e];n&&"startedMs"in n&&"videoType"in n&&"connectionStatus"in n&&"p2p"in n&&(n.value=t-n.startedMs,m.a.sendAnalytics(Object(p.J)(n)))}},{key:"_onLastNChanged",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=Date.now();v.debug("leaving/entering lastN",e,t,n);var i,r=Object(o.a)(e);try{for(r.s();!(i=r.n()).done;){var a=i.value;this.enteredLastNTimestamp.delete(a),this._clearRestoringTimer(a),this.figureOutConnectionStatus(a)}}catch(l){r.e(l)}finally{r.f()}var s,c=Object(o.a)(t);try{for(c.s();!(s=c.n()).done;){var u=s.value;this.enteredLastNTimestamp.set(u,n),this.figureOutConnectionStatus(u)}}catch(l){c.e(l)}finally{c.f()}}},{key:"_clearRestoringTimer",value:function(e){var t=this.restoringTimers.get(e);t&&(clearTimeout(t),this.restoringTimers.delete(e))}},{key:"_isRestoringTimedout",value:function(e){var t=this,n=this.enteredLastNTimestamp.get(e);return!!(n&&Date.now()-n>=1e4)||(this.restoringTimers.get(e)||this.restoringTimers.set(e,setTimeout((function(){return t.figureOutConnectionStatus(e)}),1e4)),!1)}},{key:"onUserLeft",value:function(e){this.maybeSendParticipantConnectionStatusEvent(e,Date.now()),delete this.connectionStatusMap[e]}},{key:"onTrackRtcMuted",value:function(e){var t=this,n=e.getParticipantId(),i=this.conference.getParticipantById(n);if(v.debug("Detector track RTC muted: ".concat(n),Date.now()),i){if(this.rtcMutedTimestamp[n]=Date.now(),!i.isVideoMuted()){this.clearTimeout(n);var o=this._getVideoFrozenTimeout(n);this.trackTimers[n]=window.setTimeout((function(){v.debug("Set RTC mute timeout for: ".concat(n,"                     of ").concat(o," ms")),t.clearTimeout(n),t.figureOutConnectionStatus(n)}),o)}}else v.error("No participant for id: ".concat(n))}},{key:"onTrackRtcUnmuted",value:function(e){var t=e.getParticipantId();v.debug("Detector track RTC unmuted: ".concat(t),Date.now()),this.clearTimeout(t),this.clearRtcMutedTimestamp(t),this.figureOutConnectionStatus(t)}},{key:"onSignallingMuteChanged",value:function(e){var t=e.getParticipantId();v.debug("Detector on track signalling mute changed: ".concat(t),e.isMuted()),this.figureOutConnectionStatus(t)}},{key:"onTrackVideoTypeChanged",value:function(e,t){var n=e.getParticipantId(),o=Date.now();this.maybeSendParticipantConnectionStatusEvent(n,o),this.connectionStatusMap[n]=Object(i.a)(Object(i.a)({},this.connectionStatusMap[n]||{}),{},{videoType:t,startedMs:o})}}],[{key:"_getNewStateForJvbMode",value:function(e,t,n,i,o){return e?i?g.ACTIVE:f.a.supportsVideoMuteOnConnInterrupted()?o?t?n?g.INTERRUPTED:g.RESTORING:g.INACTIVE:g.ACTIVE:t?g.ACTIVE:g.INACTIVE:g.INTERRUPTED}},{key:"_getNewStateForP2PMode",value:function(e,t){return f.a.supportsVideoMuteOnConnInterrupted()?e||!t?g.ACTIVE:g.INTERRUPTED:g.ACTIVE}}]),e}()}).call(this,"/index.js")},,,,function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u}));var i=n(6),o=n(8),r=n(35),a=n(34),s=n(18),c=n(72),u="NETWORK_INFO_CHANGED",l=Object(s.getLogger)(e),d=new(function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.call(this))._current={isOnline:!0},e}return Object(o.a)(n,[{key:"updateNetworkInfo",value:function(e){var t=e.isOnline;l.debug("updateNetworkInfo",{isOnline:t}),this._current={isOnline:!0===t},this.eventEmitter.emit(u,this._current)}},{key:"isOnline",value:function(){return!0===this._current.isOnline}}]),n}(c.a));t.b=d}).call(this,"/index.js")},function(e,t,n){"use strict";t.a={getFocusRecordingUpdate:function(e){var t=e&&e.getElementsByTagName("jibri-recording-status")[0];if(t)return{error:t.getAttribute("failure_reason"),initiator:t.getAttribute("initiator"),recordingMode:t.getAttribute("recording_mode"),sessionID:t.getAttribute("session_id"),status:t.getAttribute("status")}},getHiddenDomainUpdate:function(e){var t=e.getElementsByTagName("live-stream-view-url")[0],n=t&&t.textContent,i=e.getElementsByTagName("mode")[0],o=i&&i.textContent&&i.textContent.toLowerCase(),r=e.getElementsByTagName("session_id")[0];return{liveStreamViewURL:n,mode:o,sessionID:r&&r.textContent}},getSessionIdFromIq:function(e){var t=e&&e.getElementsByTagName("jibri")[0];return t&&t.getAttribute("session_id")},getSessionId:function(e){var t=e.getElementsByTagName("session_id")[0];return t&&t.textContent},isFromFocus:function(e){return e.getAttribute("from").includes("focus")}}},,,function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return D}));var i=n(53),o=n(59),r=n.n(o),a=n(14),s=n(85),c=n(6),u=n(8),l=n(25),d=n(35),h=n(34),p=n(193),f=n.n(p),m=n(18),v=n(105),g=n.n(v),b=n(287),y=n(10),A=n(151),E=n(72),O=n(76),S=Object(m.getLogger)(e),C="olm",_="error",j="key-info",T="key-info-ack",k="session-ack",I="session-init",R=Symbol("OlmData"),w={OLM_ID_KEY_READY:"olm.id_key_ready",PARTICIPANT_E2EE_CHANNEL_READY:"olm.participant_e2ee_channel_ready",PARTICIPANT_KEY_UPDATED:"olm.partitipant_key_updated"},D=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var i;return Object(c.a)(this,n),(i=t.call(this))._conf=e,i._init=new A.a,i._key=void 0,i._keyIndex=-1,i._reqs=new Map,i._sessionInitialization=void 0,n.isSupported()?(i._bootstrapOlm(),i._conf.on(y.ENDPOINT_MESSAGE_RECEIVED,i._onEndpointMessageReceived.bind(Object(l.a)(i))),i._conf.on(y.CONFERENCE_LEFT,i._onConferenceLeft.bind(Object(l.a)(i))),i._conf.on(y.USER_LEFT,i._onParticipantLeft.bind(Object(l.a)(i))),i._conf.on(y.PARTICIPANT_PROPERTY_CHANGED,i._onParticipantPropertyChanged.bind(Object(l.a)(i)))):i._init.reject(new Error("Olm not supported")),i}return Object(u.a)(n,[{key:"initSessions",value:function(){var e=Object(s.a)(r.a.mark((function e(){var t,n,i,o,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._sessionInitialization){e.next=4;break}throw new Error("OlmAdapter initSessions called multiple times");case 4:return this._sessionInitialization=new A.a,e.next=7,this._init;case 7:t=[],n=this._conf.myUserId(),i=Object(a.a)(this._conf.getParticipants()),e.prev=10,i.s();case 12:if((o=i.n()).done){e.next=20;break}return s=o.value,e.next=16,s.getFeatures();case 16:e.sent.has(O.b)&&n<s.getId()&&t.push(this._sendSessionInit(s));case 18:e.next=12;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(10),i.e(e.t0);case 25:return e.prev=25,i.f(),e.finish(25);case 28:return e.next=30,Promise.allSettled(t);case 30:this._sessionInitialization.resolve(),this._sessionInitialization=void 0;case 32:case"end":return e.stop()}}),e,this,[[10,22,25,28]])})));return function(){return e.apply(this,arguments)}}()},{key:"updateKey",value:function(){var e=Object(s.a)(r.a.mark((function e(t){var n,o,s,c,u=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._key=t,this._keyIndex++,n=[],o=Object(a.a)(this._conf.getParticipants()),e.prev=4,c=function(){var e,t=s.value,o=t.getId(),r=u._getParticipantOlmData(t);if(!r.session)return S.warn("Tried to send key to participant ".concat(o," but we have no session")),"continue";var a=Object(b.a)(),c=(e={},Object(i.a)(e,O.d,C),Object(i.a)(e,"olm",{type:j,data:{ciphertext:u._encryptKeyInfo(r.session),uuid:a}}),e),l=new A.a;l.setRejectTimeout(5e3),l.catch((function(){u._reqs.delete(a)})),u._reqs.set(a,l),n.push(l),u._sendMessage(c,o)},o.s();case 7:if((s=o.n()).done){e.next=13;break}if("continue"!==c()){e.next=11;break}return e.abrupt("continue",11);case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),o.e(e.t0);case 18:return e.prev=18,o.f(),e.finish(18);case 21:return e.next=23,Promise.allSettled(n);case 23:return e.abrupt("return",this._keyIndex);case 24:case"end":return e.stop()}}),e,this,[[4,15,18,21]])})));return function(t){return e.apply(this,arguments)}}()},{key:"updateCurrentKey",value:function(e){return this._key=e,this._keyIndex}},{key:"clearParticipantSession",value:function(e){var t=this._getParticipantOlmData(e);t.session&&(t.session.free(),t.session=void 0)}},{key:"clearAllParticipantsSessions",value:function(){var e,t=Object(a.a)(this._conf.getParticipants());try{for(t.s();!(e=t.n()).done;){var n=e.value;this.clearParticipantSession(n)}}catch(i){t.e(i)}finally{t.f()}}},{key:"_bootstrapOlm",value:function(){var e=Object(s.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S.debug("Initializing Olm..."),e.prev=1,e.next=4,Olm.init();case 4:this._olmAccount=new Olm.Account,this._olmAccount.create(),t=JSON.parse(this._olmAccount.identity_keys()),this._idKey=t.curve25519,S.debug("Olm ".concat(Olm.get_library_version().join(".")," initialized")),this._init.resolve(),this.eventEmitter.emit(w.OLM_ID_KEY_READY,this._idKey),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),S.error("Failed to initialize Olm",e.t0),this._init.reject(e.t0);case 17:case"end":return e.stop()}}),e,this,[[1,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"_encryptKeyInfo",value:function(e){var t={};return void 0!==this._key&&(t.key=!!this._key&&f.a.fromByteArray(this._key),t.keyIndex=this._keyIndex),e.encrypt(JSON.stringify(t))}},{key:"_getParticipantOlmData",value:function(e){return e[R]=e[R]||{},e[R]}},{key:"_onConferenceLeft",value:function(){var e=Object(s.a)(r.a.mark((function e(){var t,n,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S.debug("Conference left"),e.next=3,this._init;case 3:t=Object(a.a)(this._conf.getParticipants());try{for(t.s();!(n=t.n()).done;)i=n.value,this._onParticipantLeft(i.getId(),i)}catch(o){t.e(o)}finally{t.f()}this._olmAccount&&(this._olmAccount.free(),this._olmAccount=void 0);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_onEndpointMessageReceived",value:function(){var e=Object(s.a)(r.a.mark((function e(t,n){var o,a,s,c,u,l,d,h,p,m,v,b,y,A,E,R,D,P,M,L,x,F,B,U,V,J;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n[O.d]===C){e.next=2;break}return e.abrupt("return");case 2:if(n.olm){e.next=5;break}return S.warn("Incorrectly formatted message"),e.abrupt("return");case 5:return e.next=7,this._init;case 7:o=n.olm,a=t.getId(),s=this._getParticipantOlmData(t),e.t0=o.type,e.next=e.t0===I?13:e.t0===k?15:e.t0===_?17:e.t0===j?19:e.t0===T?21:23;break;case 13:return s.session?(S.warn("Participant ".concat(a," already has a session")),this._sendError(t,"Session already established")):((u=new Olm.Session).create_outbound(this._olmAccount,o.data.idKey,o.data.otKey),s.session=u,c={},Object(i.a)(c,O.d,C),Object(i.a)(c,"olm",{type:k,data:{ciphertext:this._encryptKeyInfo(u),uuid:o.data.uuid}}),l=c,this._sendMessage(l,a),this.eventEmitter.emit(w.PARTICIPANT_E2EE_CHANNEL_READY,a)),e.abrupt("break",23);case 15:return s.session?(S.warn("Participant ".concat(a," already has a session")),this._sendError(t,"No session found")):o.data.uuid===s.pendingSessionUuid?(d=o.data.ciphertext,h=this._reqs.get(o.data.uuid),(p=new Olm.Session).create_inbound(this._olmAccount,d.body),this._olmAccount.remove_one_time_keys(p),m=p.decrypt(d.type,d.body),s.session=p,s.pendingSessionUuid=void 0,this.eventEmitter.emit(w.PARTICIPANT_E2EE_CHANNEL_READY,a),this._reqs.delete(o.data.uuid),h.resolve(),(v=N(m)).key&&(b=f.a.toByteArray(v.key),y=v.keyIndex,s.lastKey=b,this.eventEmitter.emit(w.PARTICIPANT_KEY_UPDATED,a,b,y))):(S.warn("Received ACK with the wrong UUID"),this._sendError(t,"Invalid UUID")),e.abrupt("break",23);case 17:return S.error(o.data.error),e.abrupt("break",23);case 19:return s.session?(A=o.data.ciphertext,E=s.session.decrypt(A.type,A.body),void 0!==(R=N(E)).key&&void 0!==R.keyIndex&&(P=!!R.key&&f.a.toByteArray(R.key),M=R.keyIndex,g()(s.lastKey,P)||(s.lastKey=P,this.eventEmitter.emit(w.PARTICIPANT_KEY_UPDATED,a,P,M)),D={},Object(i.a)(D,O.d,C),Object(i.a)(D,"olm",{type:T,data:{ciphertext:this._encryptKeyInfo(s.session),uuid:o.data.uuid}}),L=D,this._sendMessage(L,a))):(S.debug("Received key info message from ".concat(a," but we have no session for them!")),this._sendError(t,"No session found while processing key-info")),e.abrupt("break",23);case 21:return s.session?(x=o.data.ciphertext,F=s.session.decrypt(x.type,x.body),void 0!==(B=N(F)).key&&void 0!==B.keyIndex&&(U=!!B.key&&f.a.toByteArray(B.key),V=B.keyIndex,g()(s.lastKey,U)||(s.lastKey=U,this.eventEmitter.emit(w.PARTICIPANT_KEY_UPDATED,a,U,V))),J=this._reqs.get(o.data.uuid),this._reqs.delete(o.data.uuid),J.resolve()):(S.debug("Received key info ack message from ".concat(a," but we have no session for them!")),this._sendError(t,"No session found while processing key-info-ack")),e.abrupt("break",23);case 23:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_onParticipantLeft",value:function(e,t){S.debug("Participant ".concat(e," left")),this.clearParticipantSession(t)}},{key:"_onParticipantPropertyChanged",value:function(){var e=Object(s.a)(r.a.mark((function e(t,n,o,a){var s,c,u,l,d,h;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=n,e.next="e2ee.enabled"===e.t0?3:20;break;case 3:if(!a||!this._conf.isE2EEEnabled()){e.next=19;break}return s=this._conf.myUserId(),c=t.getId(),e.next=8,t.getFeatures();case 8:if(!(e.sent.has(O.b)&&s<c)){e.next=19;break}if(!this._sessionInitialization){e.next=13;break}return e.next=13,this._sessionInitialization;case 13:return e.next=15,this._sendSessionInit(t);case 15:l=this._getParticipantOlmData(t),d=Object(b.a)(),u={},Object(i.a)(u,O.d,C),Object(i.a)(u,"olm",{type:j,data:{ciphertext:this._encryptKeyInfo(l.session),uuid:d}}),h=u,this._sendMessage(h,c);case 19:return e.abrupt("break",20);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n,i,o){return e.apply(this,arguments)}}()},{key:"_sendError",value:function(e,t){var n,o=e.getId(),r=(n={},Object(i.a)(n,O.d,C),Object(i.a)(n,"olm",{type:_,data:{error:t}}),n);this._sendMessage(r,o)}},{key:"_sendMessage",value:function(e,t){this._conf.sendMessage(e,t)}},{key:"_sendSessionInit",value:function(e){var t,n=this,o=e.getId(),r=this._getParticipantOlmData(e);if(r.session)return S.warn("Tried to send session-init to ".concat(o," but we already have a session")),Promise.reject();if(void 0!==r.pendingSessionUuid)return S.warn("Tried to send session-init to ".concat(o," but we already have a pending session")),Promise.reject();this._olmAccount.generate_one_time_keys(1);var a=JSON.parse(this._olmAccount.one_time_keys()),s=Object.values(a.curve25519)[0];if(!s)return Promise.reject(new Error("No one-time-keys generated"));this._olmAccount.mark_keys_as_published();var c=Object(b.a)(),u=(t={},Object(i.a)(t,O.d,C),Object(i.a)(t,"olm",{type:I,data:{idKey:this._idKey,otKey:s,uuid:c}}),t),l=new A.a;return l.setRejectTimeout(5e3),l.catch((function(){n._reqs.delete(c),r.pendingSessionUuid=void 0})),this._reqs.set(c,l),this._sendMessage(u,o),r.pendingSessionUuid=c,l}}],[{key:"isSupported",value:function(){return"undefined"!==typeof window.Olm}}]),n}(E.a);function N(e){try{return JSON.parse(e)}catch(t){return{}}}D.events=w}).call(this,"/index.js")},,,,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return A}));var i,o,r,a,s,c,u,l,d=n(21),h=n(6),p=n(8),f=n(25),m=n(35),v=n(34),g=n(11),b=(n(81),n(3)),y=n(124),A=(i=b.h.ref,o=function(e){Object(m.a)(n,e);var t=Object(v.a)(n);function n(e){var i;return Object(h.a)(this,n),(i=t.call(this)).information=i.information,i.informationReceived=!1,Object(d.a)(i,"trackStates",r,Object(f.a)(i)),Object(d.a)(i,"called",a,Object(f.a)(i)),Object(d.a)(i,"inLocalsZone",s,Object(f.a)(i)),Object(d.a)(i,"closedZone",c,Object(f.a)(i)),Object(d.a)(i,"videoBlob",u,Object(f.a)(i)),Object(d.a)(i,"audioBlob",l,Object(f.a)(i)),i.lastDistance=0,Object(b.g)(Object(f.a)(i)),i.id=e,i}return Object(p.a)(n,[{key:"call",value:function(){this.called=!0}}]),n}(y.a),r=Object(g.a)(o.prototype,"trackStates",[b.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new y.b}}),a=Object(g.a)(o.prototype,"called",[b.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),s=Object(g.a)(o.prototype,"inLocalsZone",[b.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),c=Object(g.a)(o.prototype,"closedZone",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),u=Object(g.a)(o.prototype,"videoBlob",[b.h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l=Object(g.a)(o.prototype,"audioBlob",[b.h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Object(g.a)(o.prototype,"call",[b.b],Object.getOwnPropertyDescriptor(o.prototype,"call"),o.prototype),o)},function(e,t,n){"use strict";function i(e){return new Promise((function(t,n){var i=new FormData;i.append("access_token","e9889a51fca19f2712ec046016b7ec0808953103e32cd327b91f11bfddaa8533"),i.append("imagedata",e),fetch("https://upload.gyazo.com/api/upload",{method:"POST",body:i}).then((function(e){return e.json()})).then((function(e){t(e.url)})).catch((function(e){console.error(e),n("")}))}))}function o(e){return new Promise((function(t,n){var i=new Image;i.src=e,i.onload=function(){var e=[i.width,i.height];t(e)},i.onerror=function(){n([0,0])}}))}n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}))},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return E}));var i=n(59),o=n.n(i),r=n(14),a=n(85),s=n(6),c=n(8),u=n(18),l=n(277),d=n.n(l),h=n(10),p=n(31),f=n.n(p),m=n(20),v=n(151),g=n(346),b=n(175),y=n(278),A=Object(u.getLogger)(e),E=function(){function e(t){var n=this;Object(s.a)(this,e),this.conference=t,this._conferenceJoined=!1,this._enabled=!1,this._key=void 0,this._enabling=void 0,this._e2eeCtx=new g.a,this._olmAdapter=new b.a(t),this._ratchetKey=d()(this._ratchetKeyImpl,5e3),this._rotateKey=d()(this._rotateKeyImpl,5e3),this.conference.on(h.CONFERENCE_JOINED,(function(){n._conferenceJoined=!0})),this.conference.on(h.PARTICIPANT_PROPERTY_CHANGED,this._onParticipantPropertyChanged.bind(this)),this.conference.on(h.USER_JOINED,this._onParticipantJoined.bind(this)),this.conference.on(h.USER_LEFT,this._onParticipantLeft.bind(this)),this.conference.on(h._MEDIA_SESSION_STARTED,this._onMediaSessionStarted.bind(this)),this.conference.on(h.TRACK_ADDED,(function(e){return e.isLocal()&&n._onLocalTrackAdded(e)})),this.conference.rtc.on(f.a.REMOTE_TRACK_ADDED,(function(e,t){return n._setupReceiverE2EEForTrack(t,e)})),this.conference.on(h.TRACK_MUTE_CHANGED,this._trackMuteChanged.bind(this)),this._olmAdapter.on(b.a.events.OLM_ID_KEY_READY,this._onOlmIdKeyReady.bind(this)),this._olmAdapter.on(b.a.events.PARTICIPANT_E2EE_CHANNEL_READY,this._onParticipantE2EEChannelReady.bind(this)),this._olmAdapter.on(b.a.events.PARTICIPANT_KEY_UPDATED,this._onParticipantKeyUpdated.bind(this))}return Object(c.a)(e,[{key:"isEnabled",value:function(){return this._enabled}},{key:"setEnabled",value:function(){var e=Object(a.a)(o.a.mark((function e(t){var n,i,a,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t!==this._enabled){e.next=2;break}return e.abrupt("return");case 2:if(e.t0=this._enabling,!e.t0){e.next=6;break}return e.next=6,this._enabling;case 6:if(this._enabling=new v.a,this._enabled=t,!t){e.next=13;break}return e.next=11,this._olmAdapter.initSessions();case 11:e.next=16;break;case 13:n=Object(r.a)(this.conference.getParticipants());try{for(n.s();!(i=n.n()).done;)a=i.value,this._e2eeCtx.cleanup(a.getId())}catch(o){n.e(o)}finally{n.f()}this._olmAdapter.clearAllParticipantsSessions();case 16:return this.conference.setLocalParticipantProperty("e2ee.enabled",t),this.conference._restartMediaSessions(),this._key=!!t&&this._generateKey(),e.next=21,this._olmAdapter.updateKey(this._key);case 21:s=e.sent,this._e2eeCtx.setKey(this.conference.myUserId(),this._key,s),this._enabling.resolve();case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_generateKey",value:function(){return window.crypto.getRandomValues(new Uint8Array(32))}},{key:"_onLocalTrackAdded",value:function(e){var t,n=Object(r.a)(this.conference._getMediaSessions());try{for(n.s();!(t=n.n()).done;){var i=t.value;this._setupSenderE2EEForTrack(i,e)}}catch(o){n.e(o)}finally{n.f()}}},{key:"_onMediaSessionStarted",value:function(e){var t,n=this.conference.getLocalTracks(),i=Object(r.a)(n);try{for(i.s();!(t=i.n()).done;){var o=t.value;this._setupSenderE2EEForTrack(e,o)}}catch(a){i.e(a)}finally{i.f()}}},{key:"_onOlmIdKeyReady",value:function(e){A.debug("Olm id key ready: ".concat(e)),this.conference.setLocalParticipantProperty("e2ee.idKey",e)}},{key:"_onParticipantJoined",value:function(){this._conferenceJoined&&this._enabled&&this._ratchetKey()}},{key:"_onParticipantLeft",value:function(e){this._e2eeCtx.cleanup(e),this._enabled&&this._rotateKey()}},{key:"_onParticipantE2EEChannelReady",value:function(e){A.debug("E2EE channel with participant ".concat(e," is ready"))}},{key:"_onParticipantKeyUpdated",value:function(e,t,n){A.debug("Participant ".concat(e," updated their key")),this._e2eeCtx.setKey(e,t,n)}},{key:"_onParticipantPropertyChanged",value:function(){var e=Object(a.a)(o.a.mark((function e(t,n,i,r){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=n,e.next="e2ee.idKey"===e.t0?3:"e2ee.enabled"===e.t0?5:7;break;case 3:return A.debug("Participant ".concat(t.getId()," updated their id key: ").concat(r)),e.abrupt("break",7);case 5:return!r&&this._enabled&&(this._olmAdapter.clearParticipantSession(t),this._rotateKey()),e.abrupt("break",7);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,i,o){return e.apply(this,arguments)}}()},{key:"_ratchetKeyImpl",value:function(){var e=Object(a.a)(o.a.mark((function e(){var t,n,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return A.debug("Ratchetting key"),e.next=3,Object(y.a)(this._key);case 3:return t=e.sent,e.next=6,Object(y.b)(t);case 6:n=e.sent,this._key=new Uint8Array(n),i=this._olmAdapter.updateCurrentKey(this._key),this._e2eeCtx.setKey(this.conference.myUserId(),this._key,i);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_rotateKeyImpl",value:function(){var e=Object(a.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return A.debug("Rotating key"),this._key=this._generateKey(),e.next=4,this._olmAdapter.updateKey(this._key);case 4:t=e.sent,this._e2eeCtx.setKey(this.conference.myUserId(),this._key,t);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_setupReceiverE2EEForTrack",value:function(e,t){if(this._enabled){var n=e.findReceiverForTrack(t.track);n?this._e2eeCtx.handleReceiver(n,t.getType(),t.getParticipantId()):A.warn("Could not handle E2EE for ".concat(t,": receiver not found in: ").concat(e))}}},{key:"_setupSenderE2EEForTrack",value:function(e,t){if(this._enabled){var n=e.peerconnection,i=n&&n.findSenderForTrack(t.track);i?this._e2eeCtx.handleSender(i,t.getType(),t.getParticipantId()):A.warn("Could not handle E2EE for ".concat(t,": sender not found in ").concat(n))}}},{key:"_trackMuteChanged",value:function(e){if(m.a.doesVideoMuteByStreamRemove()&&e.isLocal()&&e.isVideoTrack()&&!e.isMuted()){var t,n=Object(r.a)(this.conference._getMediaSessions());try{for(n.s();!(t=n.n()).done;){var i=t.value;this._setupSenderE2EEForTrack(i,e)}}catch(o){n.e(o)}finally{n.f()}}}}],[{key:"isSupported",value:function(e){return m.a.supportsInsertableStreams()&&b.a.isSupported()&&!(e.testing&&e.testing.disableE2EE)}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return P}));var i=n(14),o=n(6),r=n(8),a=n(25),s=n(35),c=n(34),u=n(18),l=n(13),d=n(71),h=n(38),p=n.n(h),f=n(32),m=n(9),v=n.n(m),g=n(152),b=n(65),y=n(194),A=n(33),E=n(27),O=n(358),S=n(41),C=n.n(S),_=n(360),j=n(20),T=n(361),k=n(108),I=n(218),R=n(362),w=n(129),D=Object(u.getLogger)(e),N=1e4,P=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e,i,r,s,c,u,l,d){var h;return Object(o.a)(this,n),(h=t.call(this,e,i,r,s,c,u,d))._bridgeSessionId=null,h._cachedOldLocalSdp=void 0,h._cachedNewLocalSdp=void 0,h._iceCheckingStartedTimestamp=null,h._gatheringStartedTimestamp=null,h.localRecvMaxFrameHeight=void 0,h._localVideoActive=!0,h._remoteVideoActive=!0,h._gatheringReported=!1,h.lasticecandidate=!1,h.closed=!1,h.isP2P=l,h.remoteRecvMaxFrameHeight=void 0,h.signalingLayer=new R.a,h.modificationQueue=new O.a,h.wasConnected=!1,h.establishmentDuration=void 0,h._xmppListeners=[],h._xmppListeners.push(s.addEventListener(w.a.Events.CONN_STATUS_CHANGED,h.onXmppStatusChanged.bind(Object(a.a)(h)))),h._removeSenderVideoConstraintsChangeListener=void 0,h}return Object(r.a)(n,[{key:"_assertNotEnded",value:function(){return this.state!==k.b}},{key:"doInitialize",value:function(e){var t=this;this.failICE=Boolean(e.failICE),this.lasticecandidate=!1,this.options=e,this.isReconnect=!1,this.wasstable=!1,this.webrtcIceUdpDisable=Boolean(e.webrtcIceUdpDisable),this.webrtcIceTcpDisable=Boolean(e.webrtcIceTcpDisable);var n={disableRtx:e.disableRtx};if(e.gatherStats&&(n.maxstats=300),n.capScreenshareBitrate=!1,n.enableInsertableStreams=e.enableInsertableStreams,n.videoQuality=e.videoQuality,n.forceTurnRelay=e.forceTurnRelay,n.audioQuality=e.audioQuality,n.usesUnifiedPlan=this.usesUnifiedPlan=j.a.supportsUnifiedPlan()&&(j.a.isFirefox()||j.a.isWebKitBased()||!this.isP2P&&j.a.isChromiumBased()&&e.enableUnifiedOnChrome),this.isP2P){n.disableSimulcast=!0;var i=this._abtestSuspendVideoEnabled(e);"undefined"!==typeof i&&(n.abtestSuspendVideo=i)}else{var o,r;n.disableSimulcast=e.disableSimulcast||e.preferH264&&!e.disableH264||e.videoQuality&&e.videoQuality.preferredCodec===d.H264,n.capScreenshareBitrate=n.disableSimulcast||!("number"===typeof(null===(o=e.desktopSharingFrameRate)||void 0===o?void 0:o.max)&&(null===(r=e.desktopSharingFrameRate)||void 0===r?void 0:r.max)>g.a),E.a.analytics.addPermanentProperties({capScreenshareBitrate:n.capScreenshareBitrate})}e.startSilent&&(n.startSilent=!0),this.peerconnection=this.rtc.createPeerConnection(this.signalingLayer,this.iceConfig,this.isP2P,n),this.peerconnection.onicecandidate=function(e){if(e){var n=e.candidate,i=window.performance.now();if(n){null===t._gatheringStartedTimestamp&&(t._gatheringStartedTimestamp=i);var o=n.protocol;if("string"===typeof o)if("tcp"===(o=o.toLowerCase())||"ssltcp"===o){if(t.webrtcIceTcpDisable)return}else if("udp"===o&&t.webrtcIceUdpDisable)return}else t._gatheringReported||(E.a.sendAnalytics(f.o,{phase:"gathering",value:i-t._gatheringStartedTimestamp,p2p:t.isP2P,initiator:t.isInitiator}),t._gatheringReported=!0);t.sendIceCandidate(n)}},this.peerconnection.onsignalingstatechange=function(){"stable"===t.peerconnection.signalingState?t.wasstable=!0:"closed"!==t.peerconnection.signalingState&&"closed"!==t.peerconnection.connectionState||t.room.eventEmitter.emit(v.a.SUSPEND_DETECTED,t)},this.peerconnection.oniceconnectionstatechange=function(){var e=window.performance.now(),n=!1;switch(t.isP2P||(t.room.connectionTimes["ice.state.".concat(t.peerconnection.iceConnectionState)]=e),D.log("(TIME) ICE ".concat(t.peerconnection.iceConnectionState," ").concat(t.isP2P?"P2P":"JVB",":\t"),e),E.a.sendAnalytics(f.q,{p2p:t.isP2P,state:t.peerconnection.iceConnectionState,signaling_state:t.peerconnection.signalingState,reconnect:t.isReconnect,value:e}),t.room.eventEmitter.emit(v.a.ICE_CONNECTION_STATE_CHANGED,t,t.peerconnection.iceConnectionState),t.peerconnection.iceConnectionState){case"checking":t._iceCheckingStartedTimestamp=e;break;case"connected":if("stable"===t.peerconnection.signalingState){n=!0;var i=!t.options.enableIceRestart&&t.room.supportsRestartByTerminate();(t.isReconnect||i)&&t.room.eventEmitter.emit(v.a.CONNECTION_RESTORED,t)}if(!t.wasConnected&&(t.wasstable||n||t.usesUnifiedPlan&&t.isInitiator&&j.a.isChromiumBased())){E.a.sendAnalytics(f.o,{phase:"checking",value:e-t._iceCheckingStartedTimestamp,p2p:t.isP2P,initiator:t.isInitiator});var o=Math.min(t._iceCheckingStartedTimestamp,t._gatheringStartedTimestamp);t.establishmentDuration=e-o,E.a.sendAnalytics(f.o,{phase:"establishment",value:t.establishmentDuration,p2p:t.isP2P,initiator:t.isInitiator}),t.wasConnected=!0,t.room.eventEmitter.emit(v.a.CONNECTION_ESTABLISHED,t)}t.isReconnect=!1;break;case"disconnected":t.isReconnect=!0,t.wasstable&&t.room.eventEmitter.emit(v.a.CONNECTION_INTERRUPTED,t);break;case"failed":t.room.eventEmitter.emit(v.a.CONNECTION_ICE_FAILED,t)}},this.peerconnection.onnegotiationneeded=function(){var e=t.peerconnection.signalingState,n=t.peerconnection.remoteDescription;if(t.usesUnifiedPlan&&"stable"===e&&n&&"string"===typeof n.sdp){D.debug("".concat(t," onnegotiationneeded fired on ").concat(t.peerconnection," in state: ").concat(e));t.modificationQueue.push((function(e){var n=new b.a(t.peerconnection.localDescription.sdp);t._renegotiate().then((function(){var i=new b.a(t.peerconnection.localDescription.sdp);t.notifyMySSRCUpdate(n,i),e()}),e)}),(function(e){e?D.error("".concat(t," onnegotiationneeded error"),e):D.debug("".concat(t," onnegotiationneeded executed - OK"))}))}},this.signalingLayer.setChatRoom(this.room)}},{key:"getRemoteRecvMaxFrameHeight",value:function(){if(this.isP2P)return this.remoteRecvMaxFrameHeight}},{key:"sendIceCandidate",value:function(e){var t=this,n=new b.a(this.peerconnection.localDescription.sdp);if(e&&e.candidate.length&&!this.lasticecandidate){var i=A.a.iceparams(n.media[e.sdpMLineIndex],n.session),o=A.a.candidateToJingle(e.candidate);if(!i||!o){var r="failed to get ice && jcand";return C.a.callErrorHandler(new Error(r)),void D.error(r)}i.xmlns="urn:xmpp:jingle:transports:ice-udp:1",this.usedrip?(0===this.dripContainer.length&&setTimeout((function(){0!==t.dripContainer.length&&(t.sendIceCandidates(t.dripContainer),t.dripContainer=[])}),150),this.dripContainer.push(e)):this.sendIceCandidates([e])}else D.log("".concat(this," sendIceCandidate: last candidate")),this.lasticecandidate=!0}},{key:"sendIceCandidates",value:function(e){var t=this;if(this._assertNotEnded("sendIceCandidates")){D.log("".concat(this," sendIceCandidates ").concat(JSON.stringify(e)));for(var n=Object(l.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"transport-info",initiator:this.initiatorJid,sid:this.sid}),i=new b.a(this.peerconnection.localDescription.sdp),o=function(o){var r=e.filter((function(e){return e.sdpMLineIndex===o})),a=A.a.parseMLine(i.media[o].split("\r\n")[0]);if(r.length>0){var s=A.a.iceparams(i.media[o],i.session);s.xmlns="urn:xmpp:jingle:transports:ice-udp:1",n.c("content",{creator:t.initiatorJid===t.localJid?"initiator":"responder",name:r[0].sdpMid?r[0].sdpMid:a.media}).c("transport",s);for(var c=0;c<r.length;c++){var u=A.a.candidateToJingle(r[c].candidate);t.failICE&&(u.ip="1.1.1.1"),n.c("candidate",u).up()}var l=A.a.findLine(i.media[o],"a=fingerprint:",i.session);if(l){var d=A.a.parseFingerprint(l);d.required=!0,n.c("fingerprint",{xmlns:"urn:xmpp:jingle:apps:dtls:0"}).t(d.fingerprint),delete d.fingerprint,n.attrs(d),n.up()}n.up(),n.up()}},r=0;r<i.media.length;r++)o(r);this.connection.sendIQ(n,null,this.newJingleErrorHandler(n),N)}}},{key:"sendIceFailedNotification",value:function(){var e=Object(l.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-info",initiator:this.initiatorJid,sid:this.sid}).c("ice-state",{xmlns:"http://jitsi.org/protocol/focus"}).t("failed").up();this._bridgeSessionId&&e.c("bridge-session",{xmlns:"http://jitsi.org/protocol/focus",id:this._bridgeSessionId}),this.connection.sendIQ2(e,{timeout:65}).catch(this.newJingleErrorHandler(e))}},{key:"addIceCandidates",value:function(e){var t=this;if("closed"!==this.peerconnection.signalingState){var n=[];if(e.find(">content>transport>candidate").each((function(e,t){var i=A.a.candidateFromJingle(t);i=i.replace("\r\n","").replace("a=","");var o=new RTCIceCandidate({sdpMLineIndex:0,sdpMid:"",candidate:i});n.push(o)})),n.length){D.debug("".concat(this," Queued add (").concat(n.length,") ICE candidates task")),this.modificationQueue.push((function(e){var o,r=Object(i.a)(n);try{for(r.s();!(o=r.n()).done;){var a=o.value;t.peerconnection.addIceCandidate(a).then((function(){return D.debug("".concat(t," addIceCandidate ok!"))}),(function(e){return D.error("".concat(t," addIceCandidate failed!"),e)}))}}catch(s){r.e(s)}finally{r.f()}e(),D.debug("".concat(t," ICE candidates task finished"))}))}else D.error("".concat(this," No ICE candidates to add ?"),e[0]&&e[0].outerHTML)}else D.warn("".concat(this," Ignored add ICE candidate when in closed state"))}},{key:"readSsrcInfo",value:function(e){var t=this;$(e).find('>description>source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each((function(e,n){var i=Number(n.getAttribute("ssrc"));t.isP2P?t.signalingLayer.setSSRCOwner(i,l.Strophe.getResourceFromJid(t.remoteJid)):$(n).find('>ssrc-info[xmlns="http://jitsi.org/jitmeet"]').each((function(e,n){var o=n.getAttribute("owner");o&&o.length&&(isNaN(i)||i<0?D.warn("".concat(t," Invalid SSRC ").concat(i," value received for ").concat(o)):t.signalingLayer.setSSRCOwner(i,l.Strophe.getResourceFromJid(o)))}))}))}},{key:"generateRecvonlySsrc",value:function(){this.peerconnection?this.peerconnection.generateRecvonlySsrc():D.error("".concat(this," Unable to generate recvonly SSRC - no peerconnection"))}},{key:"getConfiguredVideoCodec",value:function(){return this.peerconnection.getConfiguredVideoCodec()}},{key:"acceptOffer",value:function(e,t,n,i){var o=this;this.setOfferAnswerCycle(e,(function(){o.sendSessionAccept(t,n)}),n,i)}},{key:"invite",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!this.isInitiator)throw new Error("Trying to invite from the responder session");var n=function(n){var o,r=[],a=Object(i.a)(t);try{for(a.s();!(o=a.n()).done;){var s=o.value;r.push(e.peerconnection.addTrack(s,e.isInitiator))}}catch(c){a.e(c)}finally{a.f()}Promise.all(r).then((function(){return e.peerconnection.createOffer(e.mediaConstraints)})).then((function(t){return e.peerconnection.setLocalDescription(t)})).then((function(){e.sendSessionInitiate(e.peerconnection.localDescription.sdp)})).then((function(){return n()}),(function(e){return n(e)}))};D.debug("".concat(this," Queued invite task")),this.modificationQueue.push(n,(function(t){t?D.error("".concat(e," invite error"),t):D.debug("".concat(e," invite executed - OK"))}))}},{key:"sendSessionInitiate",value:function(e){var t=this,n=Object(l.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-initiate",initiator:this.initiatorJid,sid:this.sid});new b.a(e).toJingle(n,this.isInitiator?"initiator":"responder"),n=n.tree(),D.info("".concat(this," Session-initiate: "),n),this.connection.sendIQ(n,(function(){D.info("".concat(t,' Got RESULT for "session-initiate"'))}),(function(e){D.error("".concat(t,' "session-initiate" error'),e)}),N)}},{key:"setAnswer",value:function(e){var t=this;if(!this.isInitiator)throw new Error("Trying to set an answer on the responder session");this.setOfferAnswerCycle(e,(function(){D.info("".concat(t," setAnswer - succeeded"))}),(function(e){D.error("".concat(t," setAnswer failed: "),e)}))}},{key:"setOfferAnswerCycle",value:function(e,t,n){var o=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=function(t){var n,a=[],s=Object(i.a)(r);try{for(s.s();!(n=s.n()).done;){var c=n.value;a.push(o.peerconnection.addTrack(c,o.isInitiator))}}catch(h){s.e(h)}finally{s.f()}var u=o._processNewJingleOfferIq(e),l=o.peerconnection.localDescription.sdp,d=$(e).find('>bridge-session[xmlns="http://jitsi.org/protocol/focus"]').attr("id");d!==o._bridgeSessionId&&(o._bridgeSessionId=d),Promise.all(a).then((function(){return o._renegotiate(u.raw)})).then((function(){if(o.state===k.c&&(o.state=k.a,!o.isP2P||o._localVideoActive&&!o.localRecvMaxFrameHeight||o.sendContentModify()),l){var e=new b.a(o.peerconnection.localDescription.sdp);o.notifyMySSRCUpdate(new b.a(l),e)}})).then((function(){return t()}),(function(e){return t(e)}))};D.debug("".concat(this," Queued setOfferAnswerCycle task")),this.modificationQueue.push(a,(function(e){e?(D.error("".concat(o," setOfferAnswerCycle task failed: ").concat(e)),n(e)):(D.debug("".concat(o," setOfferAnswerCycle task done")),t())}))}},{key:"setVideoCodecs",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this.peerconnection.getConfiguredVideoCodec();if(this._assertNotEnded()&&t!==i){D.info("".concat(this," Switching video codec from ").concat(i," to ").concat(t)),this.peerconnection.setVideoCodecs(t,n);var o=function(t){e._renegotiate().then((function(){return D.debug("".concat(e," setVideoCodecs task is done")),t()}),(function(n){return D.error("".concat(e," setVideoCodecs task failed: ").concat(n)),t(n)}))};D.debug("".concat(this," Queued setVideoCodecs task")),this.modificationQueue.push(o)}}},{key:"replaceTransport",value:function(e,t,n){var i=this;if(this.options.enableForcedReload){var o=new b.a(this.peerconnection.localDescription.sdp);return this.sendTransportAccept(o,t,n),void this.room.eventEmitter.emit(v.a.CONNECTION_RESTARTED,this)}this.room.eventEmitter.emit(v.a.ICE_RESTARTING,this);var r=e.clone();e.find(">content[name='data']").attr("senders","rejected"),e.find(">content>description>source").remove(),e.find(">content>description>ssrc-group").remove();var a=e.find(">content>transport>fingerprint");a.attr("hash","sha-1"),a.text("00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00"),this.setOfferAnswerCycle(e,(function(){i.setOfferAnswerCycle(r,(function(){var e=new b.a(i.peerconnection.localDescription.sdp);i.sendTransportAccept(e,t,n),i.room.eventEmitter.emit(v.a.ICE_RESTART_SUCCESS,i,r)}),n)}),n)}},{key:"sendSessionAccept",value:function(e,t){var n=this,i=new b.a(this.peerconnection.localDescription.sdp),o=Object(l.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-accept",initiator:this.initiatorJid,responder:this.responderJid,sid:this.sid});this.webrtcIceTcpDisable&&(i.removeTcpCandidates=!0),this.webrtcIceUdpDisable&&(i.removeUdpCandidates=!0),this.failICE&&(i.failICE=!0),i.toJingle(o,this.initiatorJid===this.localJid?"initiator":"responder"),o=o.tree(),D.info("".concat(this," Sending session-accept"),o),this.connection.sendIQ(o,e,this.newJingleErrorHandler(o,(function(e){t(e),n.room.eventEmitter.emit(v.a.SESSION_ACCEPT_TIMEOUT,n)})),N)}},{key:"sendContentModify",value:function(){var e=this.localRecvMaxFrameHeight,t=this._localVideoActive?"both":"none",n=Object(l.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"content-modify",initiator:this.initiatorJid,sid:this.sid}).c("content",{name:"video",senders:t});"undefined"!==typeof e&&(n=n.c("max-frame-height",{xmlns:"http://jitsi.org/jitmeet/video"}).t(e)),D.info("".concat(this," sending content-modify, video senders: ").concat(t,", max frame height: ").concat(e)),this.connection.sendIQ(n,null,this.newJingleErrorHandler(n),N)}},{key:"setReceiverVideoConstraint",value:function(e){D.info("".concat(this," setReceiverVideoConstraint - max frame height: ").concat(e)),this.localRecvMaxFrameHeight=e,this.isP2P?this.state===k.a&&this.sendContentModify():this.rtc.setReceiverVideoConstraint(e)}},{key:"sendTransportAccept",value:function(e,t,n){var i=this,o=Object(l.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"transport-accept",initiator:this.initiatorJid,sid:this.sid});e.media.forEach((function(t,n){var r=A.a.parseMLine(t.split("\r\n")[0]);o.c("content",{creator:i.initiatorJid===i.localJid?"initiator":"responder",name:r.media}),e.transportToJingle(n,o),o.up()})),o=o.tree(),D.info("".concat(this," Sending transport-accept: "),o),this.connection.sendIQ(o,t,this.newJingleErrorHandler(o,n),N)}},{key:"sendTransportReject",value:function(e,t){var n=Object(l.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"transport-reject",initiator:this.initiatorJid,sid:this.sid});n=n.tree(),D.info("".concat(this," Sending 'transport-reject'"),n),this.connection.sendIQ(n,e,this.newJingleErrorHandler(n,t),N)}},{key:"setSenderMaxBitrates",value:function(){return this._assertNotEnded()?this.peerconnection.setMaxBitRate():Promise.resolve()}},{key:"setSenderVideoConstraint",value:function(e){if(this._assertNotEnded()){if(D.info("".concat(this," setSenderVideoConstraint: ").concat(e)),!this.isP2P&&j.a.isReactNative()&&"undefined"!==typeof e){var t=e>0;return this.setMediaTransferActive(!0,t)}return this.peerconnection.setSenderVideoConstraint(e)}return Promise.resolve()}},{key:"setSenderVideoDegradationPreference",value:function(){return this._assertNotEnded()?this.peerconnection.setSenderVideoDegradationPreference():Promise.resolve()}},{key:"terminate",value:function(e,t,n){if(this.state!==k.b){if(!n||Boolean(n.sendSessionTerminate)){var i=Object(l.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"session-terminate",initiator:this.initiatorJid,sid:this.sid}).c("reason").c(n&&n.reason||"success").up();n&&n.reasonDescription?i.c("text").t(n.reasonDescription).up().up():i.up(),this._bridgeSessionId&&i.c("bridge-session",{xmlns:"http://jitsi.org/protocol/focus",id:this._bridgeSessionId,restart:n&&!0===n.requestRestart}).up(),i=i.tree(),D.info("".concat(this," Sending session-terminate"),i),this.connection.sendIQ(i,e,this.newJingleErrorHandler(i,t),N)}else D.info("".concat(this," Skipped sending session-terminate"));this.connection.jingle.terminate(this.sid)}}},{key:"onTerminated",value:function(e,t){D.info("".concat(this," Session terminated"),e,t),this._xmppListeners.forEach((function(e){return e()})),this._xmppListeners=[],this._removeSenderVideoConstraintsChangeListener&&this._removeSenderVideoConstraintsChangeListener(),this.close()}},{key:"onXmppStatusChanged",value:function(e){e===w.a.Status.CONNECTED&&this._cachedOldLocalSdp&&(D.info("".concat(this," Sending SSRC update on reconnect")),this.notifyMySSRCUpdate(this._cachedOldLocalSdp,this._cachedNewLocalSdp))}},{key:"_parseSsrcInfoFromSourceAdd",value:function(e,t){var n=[];return $(e).each((function(e,i){var o=$(i).attr("name"),r="";$(i).find('ssrc-group[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each((function(){var e=this.getAttribute("semantics"),t=$(this).find(">source").map((function(){return this.getAttribute("ssrc")})).get();t.length&&(r+="a=ssrc-group:".concat(e," ").concat(t.join(" "),"\r\n"))})),$(i).find('source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each((function(){var e=$(this).attr("ssrc");t.containsSSRC(e)?D.warn("".concat(this," Source-add request for existing SSRC: ").concat(e)):$(this).find(">parameter").each((function(){r+="a=ssrc:".concat(e," ").concat($(this).attr("name")),$(this).attr("value")&&$(this).attr("value").length&&(r+=":".concat($(this).attr("value"))),r+="\r\n"}))})),t.media.forEach((function(e,t){A.a.findLine(e,"a=mid:".concat(o))&&(n[t]||(n[t]=""),n[t]+=r)}))})),n}},{key:"addRemoteStream",value:function(e){this._addOrRemoveRemoteStream(!0,e)}},{key:"removeRemoteStream",value:function(e){this._addOrRemoveRemoteStream(!1,e)}},{key:"removeRemoteStreamsOnLeave",value:function(e){var t=this,n=[],i=function(i){var o=t.peerconnection.getRemoteSourceInfoByParticipant(e);if(o.length){var r=new b.a(t.peerconnection.localDescription.sdp),a=t._processRemoteRemoveSource(o);n=t.peerconnection.removeRemoteTracks(e),t._renegotiate(a.raw).then((function(){var e=new b.a(t.peerconnection.localDescription.sdp);t.notifyMySSRCUpdate(r,e),i()})).catch((function(e){return i(e)}))}else i()};return new Promise((function(o,r){D.debug("".concat(t," Queued removeRemoteStreamsOnLeave task for participant ").concat(e)),t.modificationQueue.push(i,(function(e){e?(D.error("".concat(t," removeRemoteStreamsOnLeave error:"),e),r(e)):(D.info("".concat(t," removeRemoteStreamsOnLeave done!")),o(n))}))}))}},{key:"_addOrRemoveRemoteStream",value:function(e,t){var n=this,i=e?"addRemoteStream":"removeRemoteStream";e&&this.readSsrcInfo(t);D.debug("".concat(this," Queued ").concat(i," task")),this.modificationQueue.push((function(o){if(!n.peerconnection.localDescription||!n.peerconnection.localDescription.sdp){var r="".concat(i," - localDescription not ready yet");return D.error(r),void o(r)}D.log("".concat(n," Processing ").concat(i));var a=new b.a(n.peerconnection.localDescription.sdp),s=new b.a(n.peerconnection.remoteDescription.sdp),c=e?n._parseSsrcInfoFromSourceAdd(t,s):n._parseSsrcInfoFromSourceRemove(t,s),u=e?n._processRemoteAddSource(c):n._processRemoteRemoveSource(c);n._renegotiate(u.raw).then((function(){var e=new b.a(n.peerconnection.localDescription.sdp);D.log("".concat(n," ").concat(i," - OK")),n.notifyMySSRCUpdate(a,e),o()}),(function(e){D.error("".concat(n," ").concat(i," failed:"),e),o(e)}))}))}},{key:"_processNewJingleOfferIq",value:function(e){var t=new b.a("");return this.webrtcIceTcpDisable&&(t.removeTcpCandidates=!0),this.webrtcIceUdpDisable&&(t.removeUdpCandidates=!0),this.failICE&&(t.failICE=!0),t.fromJingle(e),this.readSsrcInfo($(e).find(">content")),t}},{key:"_processRemoteRemoveSource",value:function(e){var t=this,n=this.usesUnifiedPlan?new b.a(this.peerconnection.peerconnection.remoteDescription.sdp):new b.a(this.peerconnection.remoteDescription.sdp);return e.forEach((function(e,i){(e=e.split("\r\n")).pop(),t.usesUnifiedPlan?e.forEach((function(e){var i=n.media.findIndex((function(t){return t.includes(e)}));if(i>-1)if(n.media[i]=n.media[i].replace("".concat(e,"\r\n"),""),t.isP2P){var o,r=null===(o=A.a.parseMLine(n.media[i].split("\r\n")[0]))||void 0===o?void 0:o.media,a=t.peerconnection.getDesiredMediaDirection(r,!1);[p.a.SENDRECV,p.a.SENDONLY].forEach((function(e){n.media[i]=n.media[i].replace("a=".concat(e),"a=".concat(a))}))}else n.media[i]=n.media[i].replace("a=".concat(p.a.SENDONLY),"a=".concat(p.a.INACTIVE))})):e.forEach((function(e){n.media[i]=n.media[i].replace("".concat(e,"\r\n"),"")}))})),n.raw=n.session+n.media.join(""),n}},{key:"_processRemoteAddSource",value:function(e){var t=this,n=new b.a(this.peerconnection.remoteDescription.sdp);return e.forEach((function(e,i){if(n.media[i]+=e,t.isP2P&&t.usesUnifiedPlan){var o,r=null===(o=A.a.parseMLine(n.media[i].split("\r\n")[0]))||void 0===o?void 0:o.media,a=t.peerconnection.getDesiredMediaDirection(r,!0);[p.a.RECVONLY,p.a.INACTIVE].forEach((function(e){n.media[i]=n.media[i].replace("a=".concat(e),"a=".concat(a))}))}})),n.raw=n.session+n.media.join(""),n}},{key:"_renegotiate",value:function(e){if("closed"===this.peerconnection.signalingState){var t=new Error("Attempted to renegotiate in state closed");return this.room.eventEmitter.emit(v.a.RENEGOTIATION_FAILED,t,this),Promise.reject(t)}var n=e||this.peerconnection.remoteDescription.sdp;if(!n){var i=new Error("Can not renegotiate without remote description, current state: ".concat(this.state));return this.room.eventEmitter.emit(v.a.RENEGOTIATION_FAILED,i,this),Promise.reject(i)}var o=new RTCSessionDescription({type:this.isInitiator?"answer":"offer",sdp:n});return this.isInitiator?this._initiatorRenegotiate(o):this._responderRenegotiate(o)}},{key:"_responderRenegotiate",value:function(e){var t=this;return D.debug("".concat(this," Renegotiate: setting remote description")),this.peerconnection.setRemoteDescription(e).then((function(){return D.debug("".concat(t," Renegotiate: creating answer")),t.peerconnection.createAnswer(t.mediaConstraints).then((function(e){return D.debug("".concat(t," Renegotiate: setting local description")),t.peerconnection.setLocalDescription(e)}))}))}},{key:"_initiatorRenegotiate",value:function(e){var t=this;return D.debug("".concat(this," Renegotiate: creating offer")),this.peerconnection.createOffer(this.mediaConstraints).then((function(n){return D.debug("".concat(t," Renegotiate: setting local description")),t.peerconnection.setLocalDescription(n).then((function(){return D.debug("".concat(t," Renegotiate: setting remote description")),t.peerconnection.setRemoteDescription(e)}))}))}},{key:"replaceTrack",value:function(e,t){var n=this,i=function(i){D.debug("".concat(n," replaceTrack worker started. oldTrack = ").concat(e,", newTrack = ").concat(t));var o=n.peerconnection.localDescription.sdp;n.usesUnifiedPlan||(n.peerconnection.options.capScreenshareBitrate&&e&&t&&t.isVideoTrack()&&n.peerconnection.clearRecvonlySsrc(),!e&&t&&t.isVideoTrack()?n.peerconnection.clearRecvonlySsrc():e&&e.isVideoTrack()&&!t&&(n.peerconnection.clearRecvonlySsrc(),n.peerconnection.generateRecvonlySsrc())),n.peerconnection.replaceTrack(e,t).then((function(i){var r=Promise.resolve();return D.debug("".concat(n," TPC.replaceTrack finished. shouldRenegotiate = ").concat(i,", JingleSessionState = ").concat(n.state)),i&&(e||t)&&n.state===k.a&&(r=n._renegotiate().then((function(){var e=new b.a(n.peerconnection.localDescription.sdp);n.notifyMySSRCUpdate(new b.a(o),e)}))),r.then((function(){if(t&&t.isVideoTrack())return D.debug("".concat(n," replaceTrack worker: configuring video stream")),n.peerconnection.setSenderVideoDegradationPreference().then((function(){return n.peerconnection.setSenderVideoConstraint()})).then((function(){return n.peerconnection.setMaxBitRate()}))}))})).then((function(){return i()}),(function(e){return i(e)}))};return new Promise((function(o,r){D.debug("".concat(n," Queued replaceTrack task. Old track = ").concat(e,", new track = ").concat(t)),n.modificationQueue.push(i,(function(e){e?(D.error("".concat(n," Replace track error:"),e),r(e)):(D.info("".concat(n,"  Replace track done!")),o())}))}))}},{key:"_parseSsrcInfoFromSourceRemove",value:function(e,t){var n=[];return $(e).each((function(e,i){var o=$(i).attr("name"),r="";$(i).find('ssrc-group[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each((function(){var e=this.getAttribute("semantics"),t=$(this).find(">source").map((function(){return this.getAttribute("ssrc")})).get();t.length&&(r+="a=ssrc-group:".concat(e," ").concat(t.join(" "),"\r\n"))}));var a=[];$(i).find('source[xmlns="urn:xmpp:jingle:apps:rtp:ssma:0"]').each((function(){var e=$(this).attr("ssrc");a.push(e)})),t.media.forEach((function(e,t){A.a.findLine(e,"a=mid:".concat(o))&&(n[t]||(n[t]=""),a.forEach((function(i){var o=A.a.findLines(e,"a=ssrc:".concat(i));o.length&&(n[t]+="".concat(o.join("\r\n"),"\r\n"))})),n[t]+=r)}))})),n}},{key:"_verifyNoSSRCChanged",value:function(e,t){var n=new b.a(this.peerconnection.localDescription.sdp),i=new y.a(t,n),o=i.getNewMedia();if(Object.keys(o).length)return D.error("".concat(this," - some SSRC were added on ").concat(e),o),!1;var r=(i=new y.a(n,t)).getNewMedia();return!Object.keys(r).length||(D.error("".concat(this," - some SSRCs were removed on ").concat(e),r),!1)}},{key:"addTrackAsUnmute",value:function(e){var t=this;return this._addRemoveTrackAsMuteUnmute(!1,e).then((function(){if(e.isVideoTrack()&&j.a.doesVideoMuteByStreamRemove())return t.setSenderMaxBitrates().then((function(){return t.setSenderVideoDegradationPreference()})).then((function(){return t.setSenderVideoConstraint()}))}))}},{key:"removeTrackAsMute",value:function(e){return this._addRemoveTrackAsMuteUnmute(!0,e)}},{key:"_addRemoveTrackAsMuteUnmute",value:function(e,t){var n=this;if(!t)return Promise.reject('invalid "track" argument value');var i=e?"removeTrackMute":"addTrackUnmute",o=function(o){var r=n.peerconnection;if(r){var a=r.localDescription.sdp;(e?r.removeTrackMute(t):r.addTrackUnmute(t)).then((function(e){e&&a&&r.remoteDescription.sdp?n._renegotiate().then((function(){n._verifyNoSSRCChanged(i,new b.a(a)),o()})):o()}),o)}else o("Error:  tried ".concat(i," track with no active peer")+"connection")};return D.debug("".concat(this," Queued ").concat(i," task")),new Promise((function(e,t){n.modificationQueue.push(o,(function(o){o?(D.error("".concat(n," ").concat(i," failed")),t(o)):(D.debug("".concat(n," ").concat(i," done")),e())}))}))}},{key:"setMediaTransferActive",value:function(e,t){var n=this;if(!this.peerconnection)return Promise.reject('Can not modify transfer active state, before "initialize" is called');var i=e?"audio active":"audio inactive",o=t?"video active":"video inactive";D.info("".concat(this," Queued make ").concat(o,", ").concat(i," task"));var r=function(i){var o=n.state===k.a,r=n.peerconnection.setAudioTransferActive(e);n._localVideoActive!==t&&(n._localVideoActive=t,n.isP2P&&o&&n.sendContentModify());var a=n.peerconnection.setVideoTransferActive(n._localVideoActive&&n._remoteVideoActive);o&&(r||a)?n._renegotiate().then(i,i):i()};return new Promise((function(e,t){n.modificationQueue.push(r,(function(r){r?(D.error("".concat(n," Make ").concat(o,", ").concat(i," task failed!")),t(r)):(D.debug("".concat(n," Make ").concat(o,", ").concat(i," task done!")),e())}))}))}},{key:"modifyContents",value:function(e){var t=this,i=n.parseVideoSenders(e),o=n.parseMaxFrameHeight(e);if(o&&(D.info("".concat(this," received remote max frame height: ").concat(o)),this.remoteRecvMaxFrameHeight=o,this.eventEmitter.emit(I.a.REMOTE_VIDEO_CONSTRAINTS_CHANGED,this)),null!==i){D.debug("".concat(this,' queued "content-modify" task(video senders="').concat(i,'")')),this.modificationQueue.push((function(e){t._assertNotEnded("content-modify")&&t._modifyRemoteVideoActive(i)?t._renegotiate().then(e,e):e()}),(function(e){e?D.error("".concat(t,' "content-modify" failed'),e):D.debug("".concat(t,' "content-modify" task(video senders="').concat(i,'") done'))}))}else D.error("".concat(this,' - failed to parse video "senders" attribute in')+'"content-modify" action')}},{key:"_modifyRemoteVideoActive",value:function(e){var t="both"===e||"initiator"===e&&this.isInitiator||"responder"===e&&!this.isInitiator;return t!==this._remoteVideoActive&&(D.debug("".concat(this," new remote video active: ").concat(t)),this._remoteVideoActive=t),this.peerconnection.setVideoTransferActive(this._localVideoActive&&this._remoteVideoActive)}},{key:"notifyMySSRCUpdate",value:function(e,t){if(this.state===k.a){if(!this.connection.connected)return this._cachedOldLocalSdp||(this._cachedOldLocalSdp=e),this._cachedNewLocalSdp=t,void D.warn("".concat(this," Not sending SSRC update while the signaling is disconnected"));this._cachedOldLocalSdp=void 0,this._cachedNewLocalSdp=void 0;var n=new y.a(t,e),i=Object(l.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"source-remove",initiator:this.initiatorJid,sid:this.sid});n.toJingle(i)&&(D.info("".concat(this," Sending source-remove"),i.tree()),this.connection.sendIQ(i,null,this.newJingleErrorHandler(i),N)),n=new y.a(e,t);var o=Object(l.$iq)({to:this.remoteJid,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:"source-add",initiator:this.initiatorJid,sid:this.sid});n.toJingle(o)&&(D.info("".concat(this," Sending source-add"),o.tree()),this.connection.sendIQ(o,null,this.newJingleErrorHandler(o),N))}else D.warn("".concat(this," Skipping SSRC update in '").concat(this.state," ' state."))}},{key:"newJingleErrorHandler",value:function(e,t){var n=this;return function(e){var i={},o=$(e).find("error");if(o.length){i.code=o.attr("code");var r=$(e).find("error :first");r.length&&(i.reason=r[0].tagName);var a=o.find(">text");a.length&&(i.msg=a.text())}e||(i.reason="timeout"),i.session=n.toString(),t?t(i):n.state===k.b&&"item-not-found"===i.reason?D.debug("".concat(n," Jingle error: ").concat(JSON.stringify(i))):C.a.callErrorHandler(new Error("Jingle error: ".concat(JSON.stringify(i))))}}},{key:"getIceConnectionState",value:function(){return this.peerconnection.getConnectionState()}},{key:"close",value:function(){var e=this;this.state=k.b,this.establishmentDuration=void 0,this.peerconnection&&(this.peerconnection.onicecandidate=null,this.peerconnection.oniceconnectionstatechange=null,this.peerconnection.onnegotiationneeded=null,this.peerconnection.onsignalingstatechange=null),D.debug("".concat(this," Clearing modificationQueue")),this.modificationQueue.clear(),D.debug("".concat(this," Queued PC close task")),this.modificationQueue.push((function(t){e.signalingLayer.setChatRoom(null),e.peerconnection&&e.peerconnection.close(),t(),D.debug("".concat(e," PC close task done!"))})),D.debug("".concat(this," Shutdown modificationQueue!")),this.modificationQueue.shutdown()}},{key:"toString",value:function(){return"JingleSessionPC[session=".concat(this.isP2P?"P2P":"JVB",",initiator=").concat(this.isInitiator,",sid=").concat(this.sid,"]")}},{key:"_abtestSuspendVideoEnabled",value:function(e){var t=e.abTesting;if(t&&t.enableSuspendVideoTest){var n=this._getInitiatorJid();return Object(_.integerHash)(n)%2===0}}}],[{key:"parseVideoSenders",value:function(e){var t=e.find('>content[name="video"]');if(t.length){var n=t[0].getAttribute("senders");if("both"===n||"initiator"===n||"responder"===n||"none"===n)return n}return null}},{key:"parseMaxFrameHeight",value:function(e){var t=e.find('>content[name="video"]>max-frame-height');return t.length?Number(t.text()):null}}]),n}(T.a)}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return T}));var i=n(6),o=n(8),r=n(25),a=n(103),s=n(84),c=n(35),u=n(34),l=n(18),d=n(70),h=n(52),p=n(58),f=n(153),m=n.n(f),v=n(19),g=n(31),b=n.n(g),y=n(47),A=n.n(y),E=n(32),O=n(20),S=n(27),C=n(219),_=n(40),j=Object(l.getLogger)(e),T=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var o,a=e.deviceId,s=e.facingMode,c=e.mediaType,u=e.resolution,l=e.rtcId,d=e.sourceId,h=e.sourceType,f=e.stream,m=e.track,v=e.videoType,g=e.effects,y=void 0===g?[]:g;Object(i.a)(this,n),(o=t.call(this,null,f,m,(function(){return o.emit(p.LOCAL_TRACK_STOPPED)}),c,v))._setEffectInProgress=!1;var E=y.find((function(e){return e.isEnabled(Object(r.a)(o))}));return E&&o._startStreamEffect(E),o.rtcId=l,o.sourceId=d,o.sourceType=h,o.resolution=m.getSettings().height,o.maxEnabledResolution=u,o._constraints=m.getConstraints(),Object.keys(o._constraints).length||v!==A.a.CAMERA||(o._constraints={height:m.getSettings().height,width:m.getSettings().width}),o.deviceId=a,o._prevSetMuted=Promise.resolve(),o._facingMode=s,o._trackEnded=!1,o._hasSentData=!1,o._testDataSent=!0,o._realDeviceId=""===o.deviceId?void 0:o.deviceId,o._trackMutedTS=0,o._onDeviceListWillChange=function(e){var t=o._realDeviceId;o._setRealDeviceIdFromDeviceList(e),("undefined"===typeof o.getTrack().readyState&&"undefined"!==typeof o._realDeviceId&&!e.find((function(e){return e.deviceId===o._realDeviceId}))||"undefined"!==typeof t&&"undefined"===typeof o._realDeviceId)&&(o._trackEnded=!0)},o.isAudioTrack()&&_.a.isDeviceChangeAvailable("output")&&(o._onAudioOutputDeviceChanged=o.setAudioOutput.bind(Object(r.a)(o)),_.a.addListener(b.a.AUDIO_OUTPUT_DEVICE_CHANGED,o._onAudioOutputDeviceChanged)),_.a.addListener(b.a.DEVICE_LIST_WILL_CHANGE,o._onDeviceListWillChange),o._initNoDataFromSourceHandlers(),o}return Object(o.a)(n,[{key:"isEnded",value:function(){return this.isVideoTrack()&&this.isMuted()?this._trackEnded:"ended"===this.getTrack().readyState||this._trackEnded}},{key:"_initNoDataFromSourceHandlers",value:function(){var e=this;this._isNoDataFromSourceEventsEnabled()&&(this._setHandler("track_mute",(function(){e._trackMutedTS=window.performance.now(),e._fireNoDataFromSourceEvent()})),this._setHandler("track_unmute",(function(){e._fireNoDataFromSourceEvent(),S.a.sendAnalyticsAndLog(E.s,{media_type:e.getType(),track_type:"local",value:window.performance.now()-e._trackMutedTS})})),this.isVideoTrack()&&this.videoType===A.a.CAMERA&&this._setHandler("track_ended",(function(){e.isReceivingData()||e._fireNoDataFromSourceEvent()})))}},{key:"_isNoDataFromSourceEventsEnabled",value:function(){return!this.isVideoTrack()||this.videoType!==A.a.DESKTOP}},{key:"_fireNoDataFromSourceEvent",value:function(){var e=!this.isReceivingData();this.emit(p.NO_DATA_FROM_SOURCE,e),S.a.sendAnalytics(Object(E.H)(this.getType(),e)),S.a.sendLog(JSON.stringify({name:p.NO_DATA_FROM_SOURCE,log:e}))}},{key:"_setRealDeviceIdFromDeviceList",value:function(e){var t=this.getTrack(),n="".concat(t.kind,"input"),i=e.find((function(e){return e.kind===n&&e.label===t.label}));if(!i&&"default"===this._realDeviceId){var o=(t.label||"").replace("Default - ","");i=e.find((function(e){return e.kind===n&&e.label===o}))}this._realDeviceId=i?i.deviceId:void 0}},{key:"_setStream",value:function(e){Object(a.a)(Object(s.a)(n.prototype),"_setStream",this).call(this,e),e?(this.storedMSID=this.getMSID(),j.debug("Setting new MSID: ".concat(this.storedMSID," on ").concat(this))):j.debug("Setting 'null' stream on ".concat(this))}},{key:"_startStreamEffect",value:function(e){this._streamEffect=e,this._originalStream=this.stream,this._setStream(this._streamEffect.startEffect(this._originalStream)),this.track=this.stream.getTracks()[0]}},{key:"_stopStreamEffect",value:function(){this._streamEffect&&(this._streamEffect.stopEffect(),this._setStream(this._originalStream),this._originalStream=null,this.track=this.stream?this.stream.getTracks()[0]:null)}},{key:"_switchStreamEffect",value:function(e){this._streamEffect&&(this._stopStreamEffect(),this._streamEffect=void 0),e&&this._startStreamEffect(e)}},{key:"setEffect",value:function(e){var t=this;if("undefined"===typeof this._streamEffect&&"undefined"===typeof e)return Promise.resolve();if("undefined"!==typeof e&&!e.isEnabled(this))return Promise.reject(new Error("Incompatible effect instance!"));if(!0===this._setEffectInProgress)return Promise.reject(new Error("setEffect already in progress!"));if(this.isMuted()&&!this.isAudioTrack())return this._streamEffect=e,Promise.resolve();var n=this.conference;return n?(this._setEffectInProgress=!0,n.removeTrack(this).then((function(){return t._switchStreamEffect(e),t.isVideoTrack()&&t.containers.forEach((function(e){return _.a.attachMediaStream(e,t.stream)})),n.addTrack(t)})).then((function(){t._setEffectInProgress=!1})).catch((function(e){throw t._setEffectInProgress=!1,t._switchStreamEffect(),j.error("Failed to switch to the new stream!",e),e}))):(this._switchStreamEffect(e),this.isVideoTrack()&&this.containers.forEach((function(e){return _.a.attachMediaStream(e,t.stream)})),Promise.resolve())}},{key:"mute",value:function(){return this._queueSetMuted(!0)}},{key:"unmute",value:function(){return this._queueSetMuted(!1)}},{key:"_queueSetMuted",value:function(e){var t=this._setMuted.bind(this,e);return this._prevSetMuted=this._prevSetMuted.then(t,t),this._prevSetMuted}},{key:"_setMuted",value:function(e){var t=this;if(this.isMuted()===e)return Promise.resolve();if(this.disposed)return Promise.reject(new d.a(h.TRACK_IS_DISPOSED));var n=Promise.resolve(),i=function(){return j.info("Mute ".concat(t,": ").concat(e))};if(this.isAudioTrack()||this.videoType===A.a.DESKTOP||!O.a.doesVideoMuteByStreamRemove())i(),this._streamEffect&&this._streamEffect.setMuted?this._streamEffect.setMuted(e):this.track&&(this.track.enabled=!e);else if(e)n=new Promise((function(e,n){i(),t._removeStreamFromConferenceAsMute((function(){t._streamEffect&&t._stopStreamEffect(),t._unregisterHandlers(),t.stopStream(),t._setStream(null),e()}),n)}));else{i();var o={cameraDeviceId:this.getDeviceId(),devices:[v.c],effects:this._streamEffect?[this._streamEffect]:[],facingMode:this.getCameraFacingMode()};n=(n=_.a.obtainAudioAndVideoPermissions(Object.assign({},o,{constraints:{video:this._constraints}}))).then((function(e){var n=t.getType()===v.b?v.c:t.getType(),i=e.find((function(e){return e.track.kind===n}));if(!i)throw new d.a(h.TRACK_NO_STREAM_FOUND);return t._setStream(i.stream),t.track=i.track,t.videoType!==i.videoType&&(j.warn("".concat(t,": video type has changed after unmute!"),t.videoType,i.videoType),t.videoType=i.videoType),t._streamEffect&&t._startStreamEffect(t._streamEffect),t.containers.map((function(e){return _.a.attachMediaStream(e,t.stream)})),t._addStreamToConferenceAsUnmute()}))}return n.then((function(){return t._sendMuteStatus(e)})).then((function(){return t.emit(p.TRACK_MUTE_CHANGED,t)}))}},{key:"_addStreamToConferenceAsUnmute",value:function(){var e=this;return this.conference?new Promise((function(t,n){e.conference._addLocalTrackAsUnmute(e).then(t,(function(e){return n(new Error(e))}))})):Promise.resolve()}},{key:"_removeStreamFromConferenceAsMute",value:function(e,t){this.conference?this.conference._removeLocalTrackAsMute(this).then(e,(function(e){return t(new Error(e))})):e()}},{key:"_sendMuteStatus",value:function(e){var t=this;return this.conference&&this.conference.room?new Promise((function(n){t.conference.room[t.isAudioTrack()?"setAudioMute":"setVideoMute"](e,n)})):Promise.resolve()}},{key:"dispose",value:function(){var e=this,t=Promise.resolve();return this._streamEffect&&(t=this.setEffect()),this.conference&&(t=t.then((function(){return e.conference.removeTrack(e)}))),this.stream&&(this.stopStream(),this.detach()),_.a.removeListener(b.a.DEVICE_LIST_WILL_CHANGE,this._onDeviceListWillChange),this._onAudioOutputDeviceChanged&&_.a.removeListener(b.a.AUDIO_OUTPUT_DEVICE_CHANGED,this._onAudioOutputDeviceChanged),t.then((function(){return Object(a.a)(Object(s.a)(n.prototype),"dispose",e).call(e)}))}},{key:"isMuted",value:function(){return!this.stream||(!(!this.isVideoTrack()||this.isActive())||(this._streamEffect&&this._streamEffect.isMuted?this._streamEffect.isMuted():!this.track||!this.track.enabled))}},{key:"_setConference",value:function(e){this.conference=e;for(var t=0;t<this.containers.length;t++)this._maybeFireTrackAttached(this.containers[t])}},{key:"isLocal",value:function(){return!0}},{key:"getDeviceId",value:function(){return this._realDeviceId||this.deviceId}},{key:"getParticipantId",value:function(){return this.conference&&this.conference.myUserId()}},{key:"_onByteSentStatsReceived",value:function(e,t){var n=this;t>0&&(this._hasSentData=!0);var i=e.getConnectionState();this._testDataSent&&"connected"===i&&(setTimeout((function(){n._hasSentData||(j.warn("".concat(n," 'bytes sent' <= 0:                         ").concat(t)),S.a.analytics.sendEvent(E.r,{media_type:n.getType()}))}),3e3),this._testDataSent=!1)}},{key:"getCameraFacingMode",value:function(){if(this.isVideoTrack()&&this.videoType===A.a.CAMERA){var e,t,n=null===(e=(t=this.track).getSettings)||void 0===e?void 0:e.call(t);return n&&"facingMode"in n?n.facingMode:"undefined"!==typeof this._facingMode?this._facingMode:m.a.USER}}},{key:"stopStream",value:function(){this._stopStreamInProgress=!0;try{_.a.stopMediaStream(this.stream)}finally{this._stopStreamInProgress=!1}}},{key:"_switchCamera",value:function(){this.isVideoTrack()&&this.videoType===A.a.CAMERA&&"function"===typeof this.track._switchCamera&&(this.track._switchCamera(),this._facingMode=this._facingMode===m.a.ENVIRONMENT?m.a.USER:m.a.ENVIRONMENT)}},{key:"isReceivingData",value:function(){return!(!this.isVideoTrack()||!this.isMuted()&&!this._stopStreamInProgress&&this.videoType!==A.a.DESKTOP)||!!this.stream&&(this._effectEnabled?this._originalStream:this.stream).getTracks().some((function(e){return(!("readyState"in e)||"live"===e.readyState)&&(!("muted"in e)||!0!==e.muted)}))}},{key:"toString",value:function(){return"LocalTrack[".concat(this.rtcId,",").concat(this.getType(),"]")}}]),n}(C.a)}).call(this,"/index.js")},,,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(33);function o(e,t){if(!t)return!1;if(e.length!==t.length)return!1;for(var n=0,i=e.length;n<i;n++)if(e[n]instanceof Array&&t[n]instanceof Array){if(!e[n].equals(t[n]))return!1}else if(e[n]!==t[n])return!1;return!0}function r(e,t){if(this.mySDP=e,this.otherSDP=t,!e)throw new Error('"mySDP" is undefined!');if(!t)throw new Error('"otherSDP" is undefined!')}r.prototype.getNewMedia=function(){var e=this.mySDP.getMediaSsrcMap(),t=this.otherSDP.getMediaSsrcMap(),n={};return Object.keys(t).forEach((function(i){var r=e[i],a=t[i];r||!a?(Object.keys(a.ssrcs).forEach((function(e){if(-1===Object.keys(r.ssrcs).indexOf(e))n[i]||(n[i]={mediaindex:a.mediaindex,mid:a.mid,ssrcs:{},ssrcGroups:[]}),n[i].ssrcs[e]=a.ssrcs[e];else if(a.ssrcs[e].lines&&r.ssrcs[e].lines){void 0!==r.ssrcs[e].lines.find((function(e){return-1!==e.indexOf("msid")}))!==(void 0!==a.ssrcs[e].lines.find((function(e){return-1!==e.indexOf("msid")})))&&(n[i]||(n[i]={mediaindex:a.mediaindex,mid:a.mid,ssrcs:{},ssrcGroups:[]}),n[i].ssrcs[e]=a.ssrcs[e])}})),a.ssrcGroups.forEach((function(e){for(var t=!1,s=0;s<r.ssrcGroups.length;s++){var c=r.ssrcGroups[s];if(e.semantics===c.semantics&&o(e.ssrcs,c.ssrcs)){t=!0;break}}t||(n[i]||(n[i]={mediaindex:a.mediaindex,mid:a.mid,ssrcs:{},ssrcGroups:[]}),n[i].ssrcGroups.push(e))}))):n[i]=a})),n},r.prototype.toJingle=function(e){var t=this.getNewMedia(),n=!1;return Object.keys(t).forEach((function(o){n=!0;var r=t[o];e.c("content",{name:r.mid}),e.c("description",{xmlns:"urn:xmpp:jingle:apps:rtp:1",media:r.mid}),Object.keys(r.ssrcs).forEach((function(t){var n=r.ssrcs[t];e.c("source",{xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),e.attrs({ssrc:n.ssrc}),n.lines.forEach((function(t){var n=t.indexOf(" "),o=t.substr(n+1);if(e.c("parameter"),-1===o.indexOf(":"))e.attrs({name:o});else{var r=o.split(":",2),a=r[0],s=i.a.filterSpecialChars(r[1]);e.attrs({name:a}),e.attrs({value:s})}e.up()})),e.up()})),r.ssrcGroups.forEach((function(t){t.ssrcs.length&&(e.c("ssrc-group",{semantics:t.semantics,xmlns:"urn:xmpp:jingle:apps:rtp:ssma:0"}),t.ssrcs.forEach((function(t){e.c("source",{ssrc:t}).up()})),e.up())})),e.up(),e.up()})),n}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return f})),n.d(t,"b",(function(){return m}));var i=n(14),o=n(6),r=n(8),a=n(18),s=n(73),c=n.n(s),u=n(38),l=n.n(u),d=n(19),h=n(20),p=Object(a.getLogger)(e),f=["1"],m=function(){function e(t,n){Object(o.a)(this,e),this.pc=t,this.videoBitrates=n.VP8||n,this.localStreamEncodingsConfig=[{active:!0,maxBitrate:h.a.isFirefox()?this.videoBitrates.high:this.videoBitrates.low,rid:"1",scaleResolutionDownBy:h.a.isFirefox()?1:4}]}return Object(r.a)(e,[{key:"_findTransceiver",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=null,i=!t||t&&h.a.doesVideoMuteByStreamRemove()&&t.isVideoTrack()&&t.isMuted();return i?n=this.pc.peerconnection.getTransceivers().find((function(t){var n,i;return(null===(n=t.receiver)||void 0===n||null===(i=n.track)||void 0===i?void 0:i.kind)===e})):t&&(n=this.pc.peerconnection.getTransceivers().find((function(e){var n,i;return(null===(n=e.sender)||void 0===n||null===(i=n.track)||void 0===i?void 0:i.id)===t.getTrackId()}))),n}},{key:"_getStreamEncodings",value:function(e){return this.pc.isSimulcastOn()&&e.isVideoTrack()?this.localStreamEncodingsConfig:e.isVideoTrack()?[{active:!0,maxBitrate:this.videoBitrates.high}]:[{active:!0}]}},{key:"ensureCorrectOrderOfSsrcs",value:function(e){var t=c.a.parse(e.sdp);return t.media.forEach((function(e){if(e.type!==d.a&&e.ssrcGroups&&e.ssrcGroups.length){var t=[];e.ssrcGroups[0].ssrcs.split(" ").forEach((function(n){var i=e.ssrcs.filter((function(e){return e.id.toString()===n}));t=t.concat(i)})),e.ssrcs=t}})),new RTCSessionDescription({type:e.type,sdp:c.a.write(t)})}},{key:"insertUnifiedPlanSimulcastReceive",value:function(e){if(h.a.usesSdpMungingForSimulcast())return e;var t=c.a.parse(e.sdp),n=t.media.findIndex((function(e){return e.type===d.c}));if(t.media[n].rids&&(t.media[n].simulcast_03||t.media[n].simulcast))return t.media.forEach((function(e,i){e.type===d.c&&i!==n&&(t.media[i].rids=void 0,t.media[i].simulcast=void 0,t.media[i].simulcast_03=void 0)})),new RTCSessionDescription({type:e.type,sdp:c.a.write(t)});t.media[n].rids=[{id:"1",direction:"recv"},{id:SIM_LAYER_2_RID,direction:"recv"},{id:SIM_LAYER_3_RID,direction:"recv"}];var i=h.a.isFirefox()&&h.a.isVersionGreaterThan(71)?"recv ".concat(f.join(";")):"recv rid=".concat(f.join(";"));return t.media[n].simulcast_03={value:i},new RTCSessionDescription({type:e.type,sdp:c.a.write(t)})}},{key:"addTrack",value:function(e,t){var n=e.getTrack();if(t){var i={direction:l.a.SENDRECV,streams:[e.getOriginalStream()],sendEncodings:[]};h.a.isFirefox()||(i.sendEncodings=this._getStreamEncodings(e)),this.pc.peerconnection.addTransceiver(n,i)}else this.pc.peerconnection.addTrack(n)}},{key:"addTrackUnmute",value:function(e){var t=e.getType(),n=e.getTrack(),i=this._findTransceiver(t);return i?(p.debug("".concat(this.pc," Adding ").concat(e)),i.sender.replaceTrack(n)):Promise.reject(new Error("RTCRtpTransceiver for ".concat(t," not found")))}},{key:"getLocalStreamHeightConstraints",value:function(e){if(h.a.isReactNative())return null;var t,n=[],o=e.getSettings().height,r=void 0===o?720:o,a=Object(i.a)(this.localStreamEncodingsConfig);try{for(a.s();!(t=a.n()).done;){var s=t.value;n.push(r/s.scaleResolutionDownBy)}}catch(c){a.e(c)}finally{a.f()}return n}},{key:"removeTrackMute",value:function(e){var t=e.getType(),n=this._findTransceiver(t,e);return n?(p.debug("".concat(this.pc," Removing ").concat(e)),n.sender.replaceTrack(null)):Promise.reject(new Error("RTCRtpTransceiver for ".concat(t," not found")))}},{key:"replaceTrack",value:function(e,t){var n=this;if(e&&t){var i=t.getType(),o=t.getOriginalStream();if(!o)return this.pc.localTracks.delete(e.rtcId),this.pc.localTracks.set(t.rtcId,t),Promise.resolve();var r=this._findTransceiver(i,e),a=t.getTrack();return r?(p.debug("".concat(this.pc," Replacing ").concat(e," with ").concat(t)),r.sender.replaceTrack(a).then((function(){var i=n.pc.localSSRCs.get(e.rtcId);n.pc.localTracks.delete(e.rtcId),n.pc.localSSRCs.delete(e.rtcId),n.pc._addedStreams=n.pc._addedStreams.filter((function(e){return e!==o})),n.pc.localTracks.set(t.rtcId,t),n.pc._addedStreams.push(o),n.pc.localSSRCs.set(t.rtcId,i)}))):Promise.reject(new Error("replace track failed"))}return e&&!t?this.removeTrackMute(e).then((function(){var t=e.getType(),i=n._findTransceiver(t);i&&(i.direction=l.a.RECVONLY),n.pc.localTracks.delete(e.rtcId),n.pc.localSSRCs.delete(e.rtcId)})):t&&!e?this.addTrackUnmute(t).then((function(){var e=t.getType(),i=n._findTransceiver(e,t);return i&&(i.direction=l.a.SENDRECV),(h.a.usesSdpMungingForSimulcast()?Promise.resolve():n.setEncodings(t)).then((function(){n.pc.localTracks.set(t.rtcId,t)}))})):(p.info("".concat(this.pc," TPCUtils.replaceTrack called with no new track and no old track")),Promise.resolve())}},{key:"setAudioTransferActive",value:function(e){this.setMediaTransferActive(d.a,e)}},{key:"setEncodings",value:function(e){var t,n,i=e.getType(),o=this._findTransceiver(i,e),r=null===o||void 0===o||null===(t=o.sender)||void 0===t?void 0:t.getParameters();return null!==r&&void 0!==r&&null!==(n=r.encodings)&&void 0!==n&&n.length?(r.encodings=this._getStreamEncodings(e),o.sender.setParameters(r)):Promise.resolve()}},{key:"setMediaTransferActive",value:function(e,t){var n=this.pc.peerconnection.getTransceivers().filter((function(t){return t.receiver&&t.receiver.track&&t.receiver.track.kind===e})),i=this.pc.getLocalTracks(e);p.info("".concat(this.pc," ").concat(t?"Enabling":"Suspending"," ").concat(e," media transfer.")),n.forEach((function(e,n){t?0===n&&i.length?e.direction=l.a.SENDRECV:e.direction=l.a.RECVONLY:e.direction=l.a.INACTIVE}))}},{key:"setVideoTransferActive",value:function(e){this.setMediaTransferActive(d.c,e)}},{key:"updateEncodingsResolution",value:function(e){var t=this;if(h.a.isWebKitBased()&&e.encodings&&Array.isArray(e.encodings)){var n;(n=e.encodings).every((function(e){return"undefined"!==typeof e.scaleResolutionDownBy&&e.scaleResolutionDownBy===n[0].scaleResolutionDownBy}))&&e.encodings.forEach((function(e,n){e.scaleResolutionDownBy=t.localStreamEncodingsConfig[n].scaleResolutionDownBy}))}}}]),e}()}).call(this,"/index.js")},,,,,,,,,,,,,,,,,function(e,t,n){"use strict";var i,o,r=n(21),a=n(6),s=n(8),c=n(11),u=(n(81),n(30)),l=n(3),d=(i=function(){function e(){Object(a.a)(this,e),this.apiVersion=void 0,Object(r.a)(this,"state",o,this),Object(l.g)(this),this.apiVersion="INVALID",this.state=u.a.DISCONNECTED}return Object(s.a)(e,[{key:"changeState",value:function(e){this.state=e}}]),e}(),o=Object(c.a)(i.prototype,"state",[l.h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Object(c.a)(i.prototype,"changeState",[l.b],Object.getOwnPropertyDescriptor(i.prototype,"changeState"),i.prototype),i);t.a=new d},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=config.corsProxyUrl||"https://binaural.me/cors_proxy/";function o(e){var t=e;return["http://","https://"].forEach((function(n){e.substring(0,n.length)===n&&(t=e.substring(n.length))})),t="".concat(i).concat(t)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));window.AudioContext=window.AudioContext||window.webkitAudioContext;var i=null;function o(e,t,n){this.stream=e,this.intervalId=null,this.intervalMilis=t,this.audioLevel=0,this.callback=n}window.AudioContext&&(i=new AudioContext).suspend&&i.suspend(),o.prototype.start=function(){var e=this;if(o.isLocalStatsSupported()){i.resume();var t=i.createAnalyser();t.smoothingTimeConstant=.8,t.fftSize=2048,i.createMediaStreamSource(this.stream).connect(t),this.intervalId=setInterval((function(){var n=new Uint8Array(t.frequencyBinCount);t.getByteTimeDomainData(n);var i=function(e){for(var t=0,n=e.length,i=0;i<n;i++)t<e[i]&&(t=e[i]);return parseFloat(((t-127)/128).toFixed(3))}(n);e.audioLevel=function(e,t){var n=t-e;return parseFloat((n>.2?t-.2:n<-.4?t+.4:e).toFixed(3))}(i,e.audioLevel),e.callback(e.audioLevel)}),this.intervalMilis)}},o.prototype.stop=function(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)},o.isLocalStatsSupported=function(){return Boolean(i)}},function(e,t,n){"use strict";n.r(t),n.d(t,"ON",(function(){return i})),n.d(t,"OFF",(function(){return o}));var i="on",o="off"},function(e,t,n){"use strict";t.a={REMOTE_VIDEO_CONSTRAINTS_CHANGED:"media_session.REMOTE_VIDEO_CONSTRAINTS_CHANGED"}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return g}));var i=n(14),o=n(6),r=n(8),a=n(35),s=n(34),c=n(55),u=n.n(c),l=n(18),d=n(58),h=n(19),p=n(20),f=n(40),m=Object(l.getLogger)(e),v={track_mute:"onmute",track_unmute:"onunmute",track_ended:"onended"},g=function(e){Object(a.a)(n,e);var t=Object(s.a)(n);function n(e,i,r,a,s,c){var u;return Object(o.a)(this,n),(u=t.call(this)).addEventListener=u.addListener,u.removeEventListener=u.off=u.removeListener,u.containers=[],u.conference=e,u.audioLevel=-1,u.type=s,u.track=r,u.videoType=c,u.handlers=new Map,u.disposed=!1,u._streamInactiveHandler=a,u._setStream(i),u}return Object(r.a)(n,[{key:"_addMediaStreamInactiveHandler",value:function(e){p.a.isFirefox()?this.track.onended=e:this.stream.oninactive=e}},{key:"_setHandler",value:function(e,t){if(v.hasOwnProperty(e)){if(t?this.handlers.set(e,t):this.handlers.delete(e),this.stream){var n,o=Object(i.a)(this.stream.getTracks());try{for(o.s();!(n=o.n()).done;){n.value[v[e]]=t}}catch(r){o.e(r)}finally{o.f()}}}else m.error("Invalid handler type ".concat(e))}},{key:"_unregisterHandlers",value:function(){if(this.stream){var e,t=Object(i.a)(this.handlers.keys());try{for(t.s();!(e=t.n()).done;){var n,o=e.value,r=Object(i.a)(this.stream.getVideoTracks());try{for(r.s();!(n=r.n()).done;){n.value[v[o]]=void 0}}catch(a){r.e(a)}finally{r.f()}}}catch(a){t.e(a)}finally{t.f()}this._streamInactiveHandler&&this._addMediaStreamInactiveHandler(void 0)}else m.warn("".concat(this,": unable to unregister handlers - no stream object"))}},{key:"_setStream",value:function(e){if(this.stream!==e&&(this.stream=e,this.stream)){var t,n=Object(i.a)(this.handlers.keys());try{for(n.s();!(t=n.n()).done;){var o=t.value;this._setHandler(o,this.handlers.get(o))}}catch(r){n.e(r)}finally{n.f()}this._streamInactiveHandler&&this._addMediaStreamInactiveHandler(this._streamInactiveHandler)}}},{key:"getType",value:function(){return this.type}},{key:"isAudioTrack",value:function(){return this.getType()===h.a}},{key:"isWebRTCTrackMuted",value:function(){return this.track&&this.track.muted}},{key:"isVideoTrack",value:function(){return this.getType()===h.c}},{key:"isLocal",value:function(){throw new Error("Not implemented by subclass")}},{key:"isLocalAudioTrack",value:function(){return this.isAudioTrack()&&this.isLocal()}},{key:"getOriginalStream",value:function(){return this.stream}},{key:"getStreamId",value:function(){return this.stream?this.stream.id:null}},{key:"getTrack",value:function(){return this.track}},{key:"getTrackLabel",value:function(){return this.track.label}},{key:"getTrackId",value:function(){return this.track?this.track.id:null}},{key:"getUsageLabel",value:function(){return this.isAudioTrack()?"mic":this.videoType?this.videoType:"default"}},{key:"_maybeFireTrackAttached",value:function(e){this.conference&&e&&this.conference._onTrackAttach(this,e)}},{key:"attach",value:function(e){this.stream&&(this._onTrackAttach(e),f.a.attachMediaStream(e,this.stream)),this.containers.push(e),this._maybeFireTrackAttached(e),this._attachTTFMTracker(e)}},{key:"detach",value:function(e){for(var t=this.containers,n=t.length-1;n>=0;--n){var i=t[n];e||(this._onTrackDetach(i),f.a.attachMediaStream(i,null)),e&&i!==e||t.splice(n,1)}e&&(this._onTrackDetach(e),f.a.attachMediaStream(e,null))}},{key:"_onTrackAttach",value:function(e){}},{key:"_onTrackDetach",value:function(e){}},{key:"_attachTTFMTracker",value:function(e){}},{key:"dispose",value:function(){return this.removeAllListeners(),this.disposed=!0,Promise.resolve()}},{key:"isScreenSharing",value:function(){}},{key:"getId",value:function(){return this.stream?f.a.getStreamID(this.stream):null}},{key:"isActive",value:function(){return"undefined"===typeof this.stream.active||this.stream.active}},{key:"setAudioLevel",value:function(e,t){var n=e;p.a.supportsReceiverStats()&&"undefined"!==typeof t&&this.isMuted()&&(n=0),this.audioLevel!==n?(this.audioLevel=n,this.emit(d.TRACK_AUDIO_LEVEL_CHANGED,n,t)):0===this.audioLevel&&0===n&&this.isLocal()&&!this.isWebRTCTrackMuted()&&this.emit(d.NO_AUDIO_INPUT,n)}},{key:"getMSID",value:function(){var e=this.getStreamId(),t=this.getTrackId();return e&&t?"".concat(e," ").concat(t):null}},{key:"setAudioOutput",value:function(e){var t=this;return f.a.isDeviceChangeAvailable("output")?this.isVideoTrack()?Promise.resolve():Promise.all(this.containers.map((function(t){return t.setSinkId(e).catch((function(e){throw m.warn("Failed to change audio output device on element. Default or previously set audio output device will be used.",t,e),e}))}))).then((function(){t.emit(d.TRACK_AUDIO_OUTPUT_CHANGED,e)})):Promise.reject(new Error("Audio output device change is not supported"))}}]),n}(u.a)}).call(this,"/index.js")},function(e,t){e.exports={2160:{width:3840,height:2160},"4k":{width:3840,height:2160},1080:{width:1920,height:1080},fullhd:{width:1920,height:1080},720:{width:1280,height:720},hd:{width:1280,height:720},540:{width:960,height:540},qhd:{width:960,height:540},480:{width:640,height:480},vga:{width:640,height:480},360:{width:640,height:360},240:{width:320,height:240},180:{width:320,height:180}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var i=n(69),o=n(6),r=n(8),a=n(25),s=n(35),c=n(34),u=n(55),l=n.n(u),d=n(43),h=n(222),p=n(75),f=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e,i,r){var s;return Object(o.a)(this,n),(s=t.call(this))._procNodeSampleRate=e,s._vadProcessor=i,s._localTrack=r,s._bufferResidue=new Float32Array([]),s._audioContext=Object(h.a)({sampleRate:i.getRequiredPCMFrequency()}),s._vadSampleSize=i.getSampleLength(),s._onAudioProcess=s._onAudioProcess.bind(Object(a.a)(s)),s._initializeAudioContext(),s}return Object(r.a)(n,[{key:"_initializeAudioContext",value:function(){this._audioSource=this._audioContext.createMediaStreamSource(this._localTrack.stream),this._audioProcessingNode=this._audioContext.createScriptProcessor(this._procNodeSampleRate,1,1)}},{key:"_onAudioProcess",value:function(e){for(var t=e.inputBuffer.getChannelData(0),n=[].concat(Object(i.a)(this._bufferResidue),Object(i.a)(t)),o=Date.now(),r=0;r+this._vadSampleSize<n.length;r+=this._vadSampleSize){var a=n.slice(r,r+this._vadSampleSize),s=this._vadProcessor.calculateAudioFrameVAD(a.slice());this.emit(p.VAD_SCORE_PUBLISHED,{timestamp:o,score:s,pcmData:a,deviceId:this._localTrack.getDeviceId()})}this._bufferResidue=n.slice(r,n.length)}},{key:"_connectAudioGraph",value:function(){this._audioProcessingNode.onaudioprocess=this._onAudioProcess,this._audioSource.connect(this._audioProcessingNode),this._audioProcessingNode.connect(this._audioContext.destination)}},{key:"_disconnectAudioGraph",value:function(){this._audioProcessingNode.onaudioprocess=function(){},this._audioProcessingNode.disconnect(),this._audioSource.disconnect()}},{key:"_cleanupResources",value:function(){this._disconnectAudioGraph(),this._localTrack.stopStream()}},{key:"getDeviceId",value:function(){return this._localTrack.getDeviceId()}},{key:"getTrackLabel",value:function(){return this._localTrack.getDeviceLabel()}},{key:"start",value:function(){this._connectAudioGraph()}},{key:"stop",value:function(){this._disconnectAudioGraph(),this._bufferResidue=[]}},{key:"destroy",value:function(){this._destroyed||(this._cleanupResources(),this._destroyed=!0)}}],[{key:"create",value:function(e,t,i){return d.a.obtainAudioAndVideoPermissions({devices:["audio"],micDeviceId:e}).then((function(o){if(!o[0])throw new Error("Failed to create jitsi local track for device id: ".concat(e));return new n(t,i,o[0])}))}}]),n}(l.a)},function(e,t,n){"use strict";function i(e){var t=window.AudioContext||window.webkitAudioContext;if(t)return new t(e)}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";n.r(t),n.d(t,"E2E_RTT_CHANGED",(function(){return i}));var i="e2eping.e2e_rtt_changed"},,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"b",(function(){return p})),n.d(t,"a",(function(){return f}));var i,o,r=n(21),a=n(6),s=n(8),c=n(11),u=(n(81),n(62)),l=n(44),d=n.n(l),h=n(3);var p={pose:{position:[u.a[0],u.a[1]],orientation:0}},f=(i=function(){function e(){Object(a.a)(this,e),Object(r.a)(this,"pose",o,this),this.pose=d.a.cloneDeep(p.pose),Object(h.g)(this)}return Object(s.a)(e,null,[{key:"fromPlain",value:function(t){(new e).pose=function(e){return Object(h.h)(e,void 0,{deep:!1})}(d.a.cloneDeep(t.pose))}}]),e}(),o=Object(c.a)(i.prototype,"pose",[h.h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i)},,function(e,t,n){var i=n(303),o=n(304),r=function(){"use strict";function e(t,n,o){i(this,e),this._userId=t,this.setDisplayName(n),this._isLocalStats=o||!1,this.setDominantSpeaker(!1),this.totalDominantSpeakerTime=0,this._dominantSpeakerStart=0,this._hasLeft=!1}return o(e,[{key:"getUserId",value:function(){return this._userId}},{key:"getDisplayName",value:function(){return this.displayName}},{key:"setDisplayName",value:function(e){this.displayName=e}},{key:"isLocalStats",value:function(){return this._isLocalStats}},{key:"isDominantSpeaker",value:function(){return this._dominantSpeakerStart>0}},{key:"setDominantSpeaker",value:function(e){if(!this.isDominantSpeaker()&&e)this._dominantSpeakerStart=Date.now();else if(this.isDominantSpeaker()&&!e){var t=Date.now()-this._dominantSpeakerStart;this.totalDominantSpeakerTime+=t,this._dominantSpeakerStart=0}}},{key:"getTotalDominantSpeakerTime",value:function(){var e=this.totalDominantSpeakerTime;return this.isDominantSpeaker()&&(e+=Date.now()-this._dominantSpeakerStart),e}},{key:"hasLeft",value:function(){return this._hasLeft}},{key:"markAsHasLeft",value:function(){this._hasLeft=!0,this.setDominantSpeaker(!1)}}]),e}();e.exports=r},function(e,t,n){"use strict";var i=n(7),o=n(53),r=n(6),a=n(8),s=n(55),c=n.n(s),u=n(155),l=n(43),d=n(20),h=n(27),p=n(19),f=n(31),m=n.n(f),v="microphone",g="granted",b="camera",y=function(){function e(){var t=this;Object(r.a)(this,e),this._eventEmitter=new c.a,this._permissions={},l.a.addListener(m.a.DEVICE_LIST_CHANGED,(function(e){return t._eventEmitter.emit(u.DEVICE_LIST_CHANGED,e)})),l.a.addListener(m.a.DEVICE_LIST_AVAILABLE,(function(e){return t._logOutputDevice(t.getAudioOutputDevice(),e)})),l.a.addListener(m.a.PERMISSIONS_CHANGED,(function(e){return t._handlePermissionsChange(e)})),this._permissionsApiSupported=new Promise((function(e){if(navigator.permissions){var n=t,i=[];i.push(navigator.permissions.query({name:b}).then((function(e){return t._handlePermissionsChange(Object(o.a)({},p.c,t._parsePermissionState(e))),e.onchange=function(){try{n._handlePermissionsChange(Object(o.a)({},p.c,n._parsePermissionState(this)))}catch(e){}},!0})).catch((function(){return!1}))),i.push(navigator.permissions.query({name:v}).then((function(e){return t._handlePermissionsChange(Object(o.a)({},p.a,t._parsePermissionState(e))),e.onchange=function(){try{n._handlePermissionsChange(Object(o.a)({},p.a,n._parsePermissionState(this)))}catch(e){}},!0})).catch((function(){return!1}))),Promise.all(i).then((function(t){return e(t.every((function(e){return e})))}))}else e(!1)}))}return Object(a.a)(e,[{key:"_parsePermissionState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.state||e.status;if("string"!==typeof t)throw new TypeError;return t===g}},{key:"_handlePermissionsChange",value:function(e){var t=this;[p.a,p.c].some((function(n){return n in e&&e[n]!==t._permissions[n]}))&&(this._permissions=Object(i.a)(Object(i.a)({},this._permissions),e),this._eventEmitter.emit(u.PERMISSIONS_CHANGED,this._permissions),(this._permissions[p.a]||this._permissions[p.c])&&this.enumerateDevices((function(){})))}},{key:"_logOutputDevice",value:function(e,t){var n=t.find((function(t){return"audiooutput"===t.kind&&t.deviceId===e}));n&&h.a.sendActiveDeviceListEvent(l.a.getEventDataForActiveDevice(n))}},{key:"enumerateDevices",value:function(e){l.a.enumerateDevices(e)}},{key:"isDeviceListAvailable",value:function(){return l.a.isDeviceListAvailable()}},{key:"isDeviceChangeAvailable",value:function(e){return l.a.isDeviceChangeAvailable(e)}},{key:"isDevicePermissionGranted",value:function(e){var t=this;return new Promise((function(n){e in t._permissions?n(t._permissions[e]):t._permissionsApiSupported.then((function(i){if(i){var o=[];switch(e){case p.c:o.push(navigator.permissions.query({name:b}));break;case p.a:o.push(navigator.permissions.query({name:v}));break;default:o.push(navigator.permissions.query({name:b})),o.push(navigator.permissions.query({name:v}))}Promise.all(o).then((function(e){return n(e.every((function(e){try{return t._parsePermissionState(e)}catch(n){return!1}})))}),(function(){return n(!1)}))}else n(!1)}))}))}},{key:"isMultipleAudioInputSupported",value:function(){return!d.a.isFirefox()}},{key:"getAudioOutputDevice",value:function(){return l.a.getAudioOutputDevice()}},{key:"setAudioOutputDevice",value:function(e){return l.a.getCurrentlyAvailableMediaDevices().length>0&&this._logOutputDevice(e,l.a.getCurrentlyAvailableMediaDevices()),l.a.setAudioOutputDevice(e)}},{key:"addEventListener",value:function(e,t){this._eventEmitter.addListener(e,t)}},{key:"removeEventListener",value:function(e,t){this._eventEmitter.removeListener(e,t)}},{key:"emitEvent",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];(t=this._eventEmitter).emit.apply(t,[e].concat(i))}}]),e}();t.a=new y},,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){e.exports={IDENTITY_UPDATED:"authentication.identity_updated"}},function(e,t,n){"use strict";var i=n(212);n.d(t,"a",(function(){return i.a}));n(12)},,,function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return c}));var i=n(59),o=n.n(i),r=n(85);function a(e){return s.apply(this,arguments)}function s(){return(s=Object(r.a)(o.a.mark((function e(t){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new TextEncoder,e.abrupt("return",crypto.subtle.deriveBits({name:"HKDF",salt:n.encode("JFrameRatchetKey"),hash:"SHA-256",info:new ArrayBuffer},t,256));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function c(e){return u.apply(this,arguments)}function u(){return(u=Object(r.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",crypto.subtle.importKey("raw",t,"HKDF",!1,["deriveBits","deriveKey"]));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},function(e,t,n){"use strict";n.d(t,"b",(function(){return f})),n.d(t,"a",(function(){return m}));var i=n(6),o=n(8),r=n(35),a=n(34),s=n(13),c=n(9),u=n.n(c),l=n(72),d=["category","type","lang","name"],h=["category","type","lang"];function p(e,t){var n=0;return h.some((function(i){return 0!==(n=e[i]>t[i]?1:e[i]<t[i]&&-1)})),n}function f(e){var t=new Set,n=new Set;return $(e).find(">query>feature").each((function(e,n){return t.add(n.getAttribute("var"))})),$(e).find(">query>identity").each((function(e,t){return n.add({type:t.getAttribute("type"),name:t.getAttribute("name"),category:t.getAttribute("category")})})),{features:t,identities:n}}var m=function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"http://jitsi.org/jitsimeet";if(Object(i.a)(this,n),(e=t.call(this)).node=r,e.disco=o.disco,!e.disco)throw new Error("Missing strophe-plugins (disco plugin is required)!");e.version="",e.rooms=new Set,e.externalFeatures=new Set;var a=o.emuc;return a.addListener(u.a.EMUC_ROOM_ADDED,(function(t){return e._addChatRoom(t)})),a.addListener(u.a.EMUC_ROOM_REMOVED,(function(t){return e._removeChatRoom(t)})),Object.keys(a.rooms).forEach((function(t){e._addChatRoom(a.rooms[t])})),s.Strophe.addNamespace("CAPS","http://jabber.org/protocol/caps"),e.disco.addFeature(s.Strophe.NS.CAPS),e}return Object(o.a)(n,[{key:"addFeature",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.disco.addFeature(e),this._generateVersion(),i&&!this.externalFeatures.has(e)&&(this.externalFeatures.add(e),this.rooms.forEach((function(e){return t._updateRoomWithExternalFeatures(e)}))),n&&this.submit()}},{key:"removeFeature",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.disco.removeFeature(e),this._generateVersion(),i&&this.externalFeatures.has(e)&&(this.externalFeatures.delete(e),this.rooms.forEach((function(e){return t._updateRoomWithExternalFeatures(e)}))),n&&this.submit()}},{key:"submit",value:function(){this.rooms.forEach((function(e){return e.sendPresence()}))}},{key:"_updateRoomWithExternalFeatures",value:function(e){if(0===this.externalFeatures.size)e.removeFromPresence("features");else{var t=[];this.externalFeatures.forEach((function(e){t.push({tagName:"feature",attributes:{var:e}})})),e.addOrReplaceInPresence("features",{children:t})}}},{key:"getFeaturesAndIdentities",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3;return this._getDiscoInfo(e,t,n)}},{key:"_getDiscoInfo",value:function(e,t,n){var i=this;return new Promise((function(o,r){return i.disco.info(e,t,(function(e){o(f(e))}),r,n)}))}},{key:"_addChatRoom",value:function(e){this.rooms.add(e),this._fixChatRoomPresenceMap(e),this._updateRoomWithExternalFeatures(e)}},{key:"_removeChatRoom",value:function(e){this.rooms.delete(e)}},{key:"_fixChatRoomPresenceMap",value:function(e){e.addOrReplaceInPresence("c",{attributes:{xmlns:s.Strophe.NS.CAPS,hash:"sha-1",node:this.node,ver:this.version}})}},{key:"_notifyVersionChanged",value:function(){var e=this;this.rooms.forEach((function(t){return e._fixChatRoomPresenceMap(t)}))}},{key:"_generateVersion",value:function(){this.version=function(e,t){var n=e.sort(p).reduce((function(e,t){return"".concat(d.reduce((function(e,n,i){return e+(0===i?"":"/")+(t[n]?t[n]:"")}),""),"<")}),""),i=t.sort().reduce((function(e,t){return"".concat(e+t,"<")}),"");return Object(s.b64_sha1)(n+i)}(this.disco._identities,this.disco._features),this._notifyVersionChanged()}}]),n}(l.a)},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return m}));var i=n(14),o=n(6),r=n(8),a=n(25),s=n(35),c=n(34),u=n(55),l=n(18),d=n(10),h=n(75),p=n(221),f=Object(l.getLogger)(e),m=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e,i){var r;return Object(o.a)(this,n),(r=t.call(this))._createVADProcessor=i,r._vadEmitter=null,r._isVADEmitterRunning=!1,r._detectionServices=[],r._vadInitTracker=Promise.resolve(),r._processVADScore=r._processVADScore.bind(Object(a.a)(r)),e.on(d.TRACK_ADDED,r._trackAdded.bind(Object(a.a)(r))),e.on(d.TRACK_REMOVED,r._trackRemoved.bind(Object(a.a)(r))),e.on(d.TRACK_MUTE_CHANGED,r._trackMuteChanged.bind(Object(a.a)(r))),r}return Object(r.a)(n,[{key:"addVADDetectionService",value:function(e){var t=this;this._detectionServices.push(e),e.on(h.DETECTOR_STATE_CHANGE,(function(){!t._detectionServices.filter((function(e){return!0===e.isActive()})).length&&t._isVADEmitterRunning?t._stopVADEmitter():t._isVADEmitterRunning||t._startVADEmitter()}))}},{key:"_startVADEmitter",value:function(){this._vadEmitter.on(h.VAD_SCORE_PUBLISHED,this._processVADScore),this._vadEmitter.start(),this._isVADEmitterRunning=!0}},{key:"_stopVADEmitter",value:function(){this._vadEmitter.removeListener(h.VAD_SCORE_PUBLISHED,this._processVADScore),this._vadEmitter.stop(),this._isVADEmitterRunning=!1}},{key:"_processVADScore",value:function(e){var t,n=Object(i.a)(this._detectionServices);try{for(n.s();!(t=n.n()).done;){t.value.processVADScore(e)}}catch(o){n.e(o)}finally{n.f()}}},{key:"_changeDetectorsMuteState",value:function(e){var t,n=Object(i.a)(this._detectionServices);try{for(n.s();!(t=n.n()).done;){t.value.changeMuteState(e)}}catch(o){n.e(o)}finally{n.f()}}},{key:"_trackAdded",value:function(e){var t=this;e.isLocalAudioTrack()&&(this._vadInitTracker=this._vadInitTracker.then((function(){return t._createVADProcessor()})).then((function(t){return p.a.create(e.getDeviceId(),4096,t)})).then((function(n){f.debug("Created VAD emitter for track: ",e.getTrackLabel()),t._vadEmitter=n,t._changeDetectorsMuteState(e.isMuted())})).catch((function(e){f.warn("Failed to start VADAudioAnalyser",e)})))}},{key:"_trackMuteChanged",value:function(e){var t=this;e.isLocalAudioTrack()&&(this._vadInitTracker=this._vadInitTracker.then((function(){t._changeDetectorsMuteState(e.isMuted())})))}},{key:"_trackRemoved",value:function(e){var t=this;e.isLocalAudioTrack()&&(this._vadInitTracker=this._vadInitTracker.then((function(){f.debug("Removing track from VAD detection - ",e.getTrackLabel()),t._vadEmitter&&(t._stopVADEmitter(),t._vadEmitter.destroy(),t._vadEmitter=null);var n,o=Object(i.a)(t._detectionServices);try{for(o.s();!(n=o.n()).done;){n.value.reset()}}catch(r){o.e(r)}finally{o.f()}})))}}]),n}(u.EventEmitter)}).call(this,"/index.js")},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(6),o=n(8),r=n(13),a=n(172),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,e),this._connection=t.connection,this._mode=t.mode,this._setSessionID(t.sessionID),this.setStatus(t.status)}return Object(o.a)(e,[{key:"getError",value:function(){return this._error}},{key:"getID",value:function(){return this._sessionID}},{key:"getInitiator",value:function(){return this._initiator}},{key:"getLiveStreamViewURL",value:function(){return this._liveStreamViewURL}},{key:"getStatus",value:function(){return this._status}},{key:"getTerminator",value:function(){return this._terminator}},{key:"getMode",value:function(){return this._mode}},{key:"setError",value:function(e){this._error=e}},{key:"setLiveStreamViewURL",value:function(e){this._liveStreamViewURL=e}},{key:"setStatus",value:function(e){this._status=e}},{key:"setInitiator",value:function(e){this._initiator=e}},{key:"setTerminator",value:function(e){this._terminator=e}},{key:"start",value:function(e){var t=this,n=e.appData,i=e.broadcastId,o=e.focusMucJid,r=e.streamId;return new Promise((function(e,s){t._connection.sendIQ(t._createIQ({action:"start",appData:n,focusMucJid:o,broadcastId:i,streamId:r}),(function(n){t.setStatus("pending"),t._setSessionID(a.a.getSessionIdFromIq(n)),e()}),(function(e){t._setErrorFromIq(e),s(e)}))}))}},{key:"stop",value:function(e){var t=this,n=e.focusMucJid;return new Promise((function(e,i){t._connection.sendIQ(t._createIQ({action:"stop",focusMucJid:n}),e,i)}))}},{key:"_createIQ",value:function(e){var t=e.action,n=e.appData,i=e.broadcastId,o=e.focusMucJid,a=e.streamId;return Object(r.$iq)({to:o,type:"set"}).c("jibri",{xmlns:"http://jitsi.org/protocol/jibri",action:t,app_data:n,recording_mode:this._mode,streamid:a,you_tube_broadcast_id:i}).up()}},{key:"_setErrorFromIq",value:function(e){var t=e.getElementsByTagName("error")[0];this.setError(t.children[0].tagName)}},{key:"_setSessionID",value:function(e){this._sessionID=e}}]),e}()},,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){var i=n(507),o="audio/webm",r="audio/ogg",a=function(e){this.track=e,this.recorder=null,this.data=null,this.name=null,this.startTime=null};function s(e){if(void 0===e.recorder)throw new Error("Passed an object to startRecorder which is not a TrackRecorder object");e.recorder.start(),e.startTime=new Date}function c(e){if(void 0===e.recorder)throw new Error("Passed an object to stopRecorder which is not a TrackRecorder object");e.recorder.stop()}function u(){if(MediaRecorder.isTypeSupported(o))return o;if(MediaRecorder.isTypeSupported(r))return r;throw new Error("unable to create a MediaRecorder with the right mimetype!")}function l(e){this.recorders=[],this.fileType=u(),this.isRecording=!1,this.jitsiConference=e}l.determineCorrectFileType=u,l.prototype.addTrack=function(e){if(e.isAudioTrack()){var t=this.instantiateTrackRecorder(e);this.recorders.push(t),this.updateNames(),this.isRecording&&s(t)}},l.prototype.instantiateTrackRecorder=function(e){var t=new a(e),n=t.track.getOriginalStream(),i=new MediaStream;return n.getAudioTracks().forEach((function(e){return i.addTrack(e)})),t.recorder=new MediaRecorder(i,{mimeType:this.fileType}),t.data=[],t.recorder.ondataavailable=function(e){e.data.size>0&&t.data.push(e.data)},t},l.prototype.removeTrack=function(e){if(!e.isVideoTrack()){var t,n=this.recorders;for(t=0;t<n.length;t++)if(n[t].track.getParticipantId()===e.getParticipantId()){var i=n[t];this.isRecording?c(i):n.splice(t,1)}this.updateNames()}},l.prototype.updateNames=function(){var e=this.jitsiConference;this.recorders.forEach((function(t){if(t.track.isLocal())t.name="the transcriber";else{var n=t.track.getParticipantId(),i=e.getParticipantById(n).getDisplayName();"undefined"!==i&&(t.name=i)}}))},l.prototype.start=function(){if(this.isRecording)throw new Error("audiorecorder is already recording");this.isRecording=!0,this.recorders.forEach((function(e){return s(e)})),console.log("Started the recording of the audio. There are currently ".concat(this.recorders.length," recorders active."))},l.prototype.stop=function(){this.isRecording=!1,this.recorders.forEach((function(e){return c(e)})),console.log("stopped recording")},l.prototype.download=function(){var e=this;this.recorders.forEach((function(t){var n=new Blob(t.data,{type:e.fileType}),i=URL.createObjectURL(n),o=document.createElement("a");document.body.appendChild(o),o.style="display: none",o.href=i,o.download="test.".concat(e.fileType.split("/")[1]),o.click(),window.URL.revokeObjectURL(i)}))},l.prototype.getRecordingResults=function(){var e=this;if(this.isRecording)throw new Error("cannot get blobs because the AudioRecorder is still recording!");this.updateNames();var t=[];return this.recorders.forEach((function(n){return t.push(new i(new Blob(n.data,{type:e.fileType}),n.name,n.startTime))})),t},l.prototype.getFileType=function(){return this.fileType},e.exports=l},,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(336),o=n(79),r=n(27),a=n(76),s=n(32);function c(e,t,n){this.appID=e,this.token=t,this.options=n,this.xmpp=new a.e(n,t),this.addEventListener(o.CONNECTION_FAILED,(function(e,t,n,i){r.a.sendAnalyticsAndLog(Object(s.B)(e,t,i))})),this.addEventListener(o.CONNECTION_DISCONNECTED,(function(e){e&&r.a.sendAnalytics(s.m,{message:e}),r.a.sendLog(JSON.stringify({id:s.m,msg:e}))}))}c.prototype.connect=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.xmpp.connect(e.id,e.password)},c.prototype.attach=function(e){this.xmpp.attach(e)},c.prototype.disconnect=function(){var e;return(e=this.xmpp).disconnect.apply(e,arguments)},c.prototype.getJid=function(){return this.xmpp.getJid()},c.prototype.setToken=function(e){this.token=e},c.prototype.initJitsiConference=function(e,t){return new i.a({name:e,config:t,connection:this})},c.prototype.addEventListener=function(e,t){this.xmpp.addListener(e,t)},c.prototype.removeEventListener=function(e,t){this.xmpp.removeListener(e,t)},c.prototype.getConnectionTimes=function(){return this.xmpp.connectionTimes},c.prototype.addFeature=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.xmpp.caps.addFeature(e,t,!0)},c.prototype.removeFeature=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.xmpp.caps.removeFeature(e,t,!0)},c.prototype.getLogs=function(){var e=this.xmpp.getJingleLog(),t={};t.time=new Date,t.url=window.location.href,t.ua=navigator.userAgent;var n=this.xmpp.getXmppLog();return n&&(t.xmpp=n),e.metadata=t,e}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return ce}));var i=n(53),o=n(14),r=n(7),a=n(55),s=n.n(a),c=n(18),u=n(105),l=n.n(u),d=n(13),h=n(63),p=n(337),f=n(10),m=n(344),v=n(70),g=n(52),b=n(58),y=n(345),A=n(367),E=n(43),O=n(20),S=n(374),C=n(375),_=n(167),j=n(75),T=n(376),k=n(377),I=n(280),R=n(378),w=n(379),D=n(185),N=n(380),P=n(381),M=n(382),L=n(383),x=n(384),F=n(96),B=n(385),U=n(386),V=n(387),J=n(27),G=n(388),H=n.n(G),z=n(41),Q=n.n(z),K=n(120),Y=n.n(K),W=n(389),q=n(390),X=n(77),Z=n(76),ee=n(71),te=n.n(ee),ne=n(19),ie=n(47),oe=n.n(ie),re=n(32),ae=n(9),se=Object(c.getLogger)(e);function ce(e){if(!e.name||e.name.toLowerCase()!==e.name){var t="Invalid conference name (no conference name passed or it contains invalid characters like capital letters)!";throw se.error(t),new Error(t)}this.eventEmitter=new s.a,this.options=e,this.eventManager=new p.a(this),this.participants={},this._init(e),this.componentsVersions=new W.a(this),this.jvbJingleSession=null,this.lastDominantSpeaker=null,this.dtmfManager=null,this.somebodySupportsDTMF=!1,this.authEnabled=!1,this.startAudioMuted=!1,this.startVideoMuted=!1,this.startMutedPolicy={audio:!1,video:!1},this.isMutedByFocus=!1,this.mutedByFocusActor=null,this.isVideoMutedByFocus=!1,this.mutedVideoByFocusActor=null,this.wasStopped=!1,this.properties={},this.connectionQuality=new S.a(this,this.eventEmitter,e),this.avgRtpStatsReporter=new U.a(this,e.config.avgRtpStatsN||15),this._audioOutputProblemDetector=new B.a(this),this.isJvbConnectionInterrupted=!1,this.speakerStatsCollector=new V.a(this),this.deferredStartP2PTask=null;var n=parseInt(e.config.p2p&&e.config.p2p.backToP2PDelay,10);this.backToP2PDelay=isNaN(n)?5:n,se.info("backToP2PDelay: ".concat(this.backToP2PDelay)),this.isP2PConnectionInterrupted=!1,this.p2p=!1,this.p2pJingleSession=null,this.videoSIPGWHandler=new q.a(this.room),this.recordingManager=new x.a(this.room),this._conferenceJoinAnalyticsEventSent=void 0,this.isE2EESupported()&&(se.info("End-to-End Encryprtion is supported"),this._e2eEncryption=new D.a(this))}ce.prototype.constructor=ce,ce.resourceCreator=function(e,t){var n;if(t)n=Y.a.randomHexString(8).toLowerCase();else{n=d.Strophe.getNodeFromJid(e).substr(0,8).toLowerCase();/[0-9a-f]{8}/g.test(n)||(n=Y.a.randomHexString(8).toLowerCase())}return n},ce.prototype._init=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.connection&&(this.connection=t.connection,this.xmpp=this.connection.xmpp,this.eventManager.setupXMPPListeners());var n=this.options.config,i={disabledCodec:n.videoQuality?n.videoQuality.disabledCodec:n.p2p&&n.p2p.disableH264&&te.a.H264,enforcePreferredCodec:n.videoQuality&&n.videoQuality.enforcePreferredCodec,jvbCodec:n.videoQuality&&n.videoQuality.preferredCodec||n.preferH264&&te.a.H264,p2pCodec:n.p2p?n.p2p.preferredCodec||n.p2p.preferH264&&te.a.H264:te.a.VP8};this.codecSelection=new A.a(this,i),this._statsCurrentId=n.statisticsId?n.statisticsId:F.a.callStatsUserName,this.room=this.xmpp.createRoom(this.options.name,Object(r.a)(Object(r.a)({},n),{},{statsId:this._statsCurrentId}),ce.resourceCreator),this._onIceConnectionInterrupted=this._onIceConnectionInterrupted.bind(this),this.room.addListener(ae.CONNECTION_INTERRUPTED,this._onIceConnectionInterrupted),this._onIceConnectionRestored=this._onIceConnectionRestored.bind(this),this.room.addListener(ae.CONNECTION_RESTORED,this._onIceConnectionRestored),this._onIceConnectionEstablished=this._onIceConnectionEstablished.bind(this),this.room.addListener(ae.CONNECTION_ESTABLISHED,this._onIceConnectionEstablished),this._updateProperties=this._updateProperties.bind(this),this.room.addListener(ae.CONFERENCE_PROPERTIES_CHANGED,this._updateProperties),this._sendConferenceJoinAnalyticsEvent=this._sendConferenceJoinAnalyticsEvent.bind(this),this.room.addListener(ae.MEETING_ID_SET,this._sendConferenceJoinAnalyticsEvent),this.e2eping=new N.a(this,n,(function(t,n){try{e.sendMessage(t,n,!0)}catch(i){se.warn("Failed to send E2E ping request or response to ".concat(n,"."),i&&i.msg)}})),this.rtc||(this.rtc=new E.a(this,t),this.eventManager.setupRTCListeners()),this.receiveVideoController=new M.a(this,this.rtc),this.sendVideoController=new L.a(this,this.rtc),this.participantConnectionStatus=new _.b(this.rtc,this,{rtcMuteTimeout:n._peerConnStatusRtcMuteTimeout,outOfLastNTimeout:n._peerConnStatusOutOfLastNTimeout}),this.participantConnectionStatus.init();var o=!0;if(n.testing&&n.testing.callStatsThreshold&&(o=100*Math.random()<=n.testing.callStatsThreshold),this.statistics||(this.statistics=new J.a(this.xmpp,{aliasName:this._statsCurrentId,userName:n.statisticsDisplayName?n.statisticsDisplayName:this.myUserId(),confID:n.confID||"".concat(this.connection.options.hosts.domain,"/").concat(this.options.name),siteID:n.siteID,customScriptUrl:n.callStatsCustomScriptUrl,callStatsID:n.callStatsID,callStatsSecret:n.callStatsSecret,callStatsApplicationLogsDisabled:n.callStatsApplicationLogsDisabled,enableCallStats:o,roomName:this.options.name,applicationName:n.applicationName,getWiFiStatsMethod:n.getWiFiStatsMethod}),J.a.analytics.addPermanentProperties({callstats_name:this._statsCurrentId}),n.longTasksStatsInterval&&this.statistics.attachLongTasksStats(this)),this.eventManager.setupChatRoomListeners(),this.eventManager.setupStatisticsListeners(),n.enableTalkWhileMuted&&O.a.supportsVADDetection())if(n.createVADProcessor){se.info("Using VAD detection for generating talk while muted events"),this._audioAnalyser||(this._audioAnalyser=new I.a(this,n.createVADProcessor));var a=new w.a;a.on(j.VAD_TALK_WHILE_MUTED,(function(){return e.eventEmitter.emit(f.TALK_WHILE_MUTED)})),this._audioAnalyser.addVADDetectionService(a)}else se.warn("No VAD Processor was provided. Talk while muted detection service was not initialized!");if(n.enableNoisyMicDetection&&O.a.supportsVADDetection())if(n.createVADProcessor){this._audioAnalyser||(this._audioAnalyser=new I.a(this,n.createVADProcessor));var s=new R.a;s.on(j.VAD_NOISY_DEVICE,(function(){return e.eventEmitter.emit(f.NOISY_MIC)})),this._audioAnalyser.addVADDetectionService(s)}else se.warn("No VAD Processor was provided. Noisy microphone detection service was not initialized!");n.enableNoAudioDetection&&(this._noAudioSignalDetection=new T.a(this),this._noAudioSignalDetection.on(j.NO_AUDIO_INPUT,(function(){e.eventEmitter.emit(f.NO_AUDIO_INPUT)})),this._noAudioSignalDetection.on(j.AUDIO_INPUT_STATE_CHANGE,(function(t){e.eventEmitter.emit(f.AUDIO_INPUT_STATE_CHANGE,t)}))),"channelLastN"in n&&this.setLastN(n.channelLastN),this.jvb121Status=new P.a(this),this.p2pDominantSpeakerDetection=new k.a(this),n&&n.deploymentInfo&&n.deploymentInfo.userRegion&&this.setLocalParticipantProperty("region",n.deploymentInfo.userRegion),this.setLocalParticipantProperty("codecType",this.codecSelection.getPreferredCodec())},ce.prototype.join=function(e){var t=this;this.room&&this.room.join(e).then((function(){return t._maybeSetSITimeout()}))},ce.prototype.authenticateAndUpgradeRole=function(e){return y.a.call(this,Object(r.a)(Object(r.a)({},e),{},{onCreateResource:ce.resourceCreator}))},ce.prototype.isJoined=function(){return this.room&&this.room.joined},ce.prototype.isP2PEnabled=function(){return Boolean(this.options.config.p2p&&this.options.config.p2p.enabled)||"undefined"===typeof this.options.config.p2p},ce.prototype.isP2PTestModeEnabled=function(){return Boolean(this.options.config.testing&&this.options.config.testing.p2pTestMode)},ce.prototype.leave=function(){var e=this;if(this.participantConnectionStatus&&(this.participantConnectionStatus.dispose(),this.participantConnectionStatus=null),this.avgRtpStatsReporter&&(this.avgRtpStatsReporter.dispose(),this.avgRtpStatsReporter=null),this._audioOutputProblemDetector&&(this._audioOutputProblemDetector.dispose(),this._audioOutputProblemDetector=null),this.e2eping&&(this.e2eping.stop(),this.e2eping=null),this.getLocalTracks().forEach((function(t){return e.onLocalTrackRemoved(t)})),this.rtc.closeBridgeChannel(),this._sendConferenceLeftAnalyticsEvent(),this.statistics&&this.statistics.dispose(),this._delayedIceFailed&&this._delayedIceFailed.cancel(),this.jvbJingleSession&&(this.jvbJingleSession.close(),this.jvbJingleSession=null),this.p2pJingleSession&&(this.p2pJingleSession.close(),this.p2pJingleSession=null),this.room){var t=this.room;return t.removeListener(ae.CONNECTION_INTERRUPTED,this._onIceConnectionInterrupted),t.removeListener(ae.CONNECTION_RESTORED,this._onIceConnectionRestored),t.removeListener(ae.CONNECTION_ESTABLISHED,this._onIceConnectionEstablished),t.removeListener(ae.CONFERENCE_PROPERTIES_CHANGED,this._updateProperties),t.removeListener(ae.MEETING_ID_SET,this._sendConferenceJoinAnalyticsEvent),this.eventManager.removeXMPPListeners(),this.room=null,t.leave().then((function(){e.rtc&&e.rtc.destroy()})).catch((function(t){throw e.getParticipants().forEach((function(t){return e.onMemberLeft(t.getJid())})),t}))}return Promise.reject(new Error("The conference is has been already left"))},ce.prototype._getActiveMediaSession=function(){return this.isP2PActive()?this.p2pJingleSession:this.jvbJingleSession},ce.prototype._getMediaSessions=function(){var e=[];return this.jvbJingleSession&&e.push(this.jvbJingleSession),this.p2pJingleSession&&e.push(this.p2pJingleSession),e},ce.prototype.getName=function(){return this.options.name},ce.prototype.getConnection=function(){return this.connection},ce.prototype.isAuthEnabled=function(){return this.authEnabled},ce.prototype.isLoggedIn=function(){return Boolean(this.authIdentity)},ce.prototype.getAuthLogin=function(){return this.authIdentity},ce.prototype.isExternalAuthEnabled=function(){return this.room&&this.room.moderator.isExternalAuthEnabled()},ce.prototype.getExternalAuthUrl=function(e){var t=this;return new Promise((function(n,i){t.isExternalAuthEnabled()?e?t.room.moderator.getPopupLoginUrl(n,i):t.room.moderator.getLoginUrl(n,i):i()}))},ce.prototype.getLocalTracks=function(e){var t=[];return this.rtc&&(t=this.rtc.getLocalTracks(e)),t},ce.prototype.getLocalAudioTrack=function(){return this.rtc?this.rtc.getLocalAudioTrack():null},ce.prototype.getLocalVideoTrack=function(){return this.rtc?this.rtc.getLocalVideoTrack():null},ce.prototype.getPerformanceStats=function(){return{longTasksStats:this.statistics.getLongTasksStats()}},ce.prototype.on=function(e,t){this.eventEmitter&&this.eventEmitter.on(e,t)},ce.prototype.off=function(e,t){this.eventEmitter&&this.eventEmitter.removeListener(e,t)},ce.prototype.addEventListener=ce.prototype.on,ce.prototype.removeEventListener=ce.prototype.off,ce.prototype.addCommandListener=function(e,t){this.room&&this.room.addPresenceListener(e,t)},ce.prototype.removeCommandListener=function(e,t){this.room&&this.room.removePresenceListener(e,t)},ce.prototype.sendTextMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"body";this.room&&this.room.sendMessage(e,t)},ce.prototype.sendPrivateTextMessage=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"body";this.room&&this.room.sendPrivateMessage(e,t,n)},ce.prototype.sendCommand=function(e,t){this.room?this.room.addOrReplaceInPresence(e,t)&&this.room.sendPresence():se.warn("Not sending a command, room not initialized.")},ce.prototype.sendCommandOnce=function(e,t){this.sendCommand(e,t),this.removeCommand(e)},ce.prototype.removeCommand=function(e){this.room&&this.room.removeFromPresence(e)},ce.prototype.setDisplayName=function(e){this.room&&this.room.addOrReplaceInPresence("nick",{attributes:{xmlns:"http://jabber.org/protocol/nick"},value:e})&&this.room.sendPresence()},ce.prototype.setSubject=function(e){this.room&&this.isModerator()?this.room.setSubject(e):se.warn("Failed to set subject, ".concat(this.room?"":"not in a room, ").concat(this.isModerator()?"":"participant is not a moderator"))},ce.prototype.getTranscriber=function(){if(void 0===this.transcriber){this.transcriber=new H.a;var e,t=this.getLocalTracks(ne.a),n=Object(o.a)(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;this.transcriber.addTrack(i)}}catch(u){n.e(u)}finally{n.f()}var r,a=this.rtc.getRemoteTracks(ne.a),s=Object(o.a)(a);try{for(s.s();!(r=s.n()).done;){var c=r.value;this.transcriber.addTrack(c)}}catch(u){s.e(u)}finally{s.f()}}return this.transcriber},ce.prototype.getTranscriptionStatus=function(){return this.room.transcriptionStatus},ce.prototype.addTrack=function(e){var t=e.getType(),n=this.rtc.getLocalTracks(t);return n.length>0?e===n[0]?Promise.resolve(e):Promise.reject(new Error("Cannot add second ".concat(t," track to the conference"))):this.replaceTrack(null,e)},ce.prototype._fireAudioLevelChangeEvent=function(e,t){var n=this.getActivePeerConnection();t&&n!==t||this.eventEmitter.emit(f.TRACK_AUDIO_LEVEL_CHANGED,this.myUserId(),e)},ce.prototype._fireMuteChangeEvent=function(e){var t;if(this.isMutedByFocus&&e.isAudioTrack()&&!e.isMuted()?(this.isMutedByFocus=!1,this.room.muteParticipant(this.room.myroomjid,!1,ne.a)):this.isVideoMutedByFocus&&e.isVideoTrack()&&!e.isMuted()&&(this.isVideoMutedByFocus=!1,this.room.muteParticipant(this.room.myroomjid,!1,ne.c)),this.mutedByFocusActor&&e.isAudioTrack()){var n=d.Strophe.getResourceFromJid(this.mutedByFocusActor);t=this.participants[n]}else if(this.mutedVideoByFocusActor&&e.isVideoTrack()){var i=d.Strophe.getResourceFromJid(this.mutedVideoByFocusActor);t=this.participants[i]}this.eventEmitter.emit(f.TRACK_MUTE_CHANGED,e,t)},ce.prototype._getInitialLocalTracks=function(){var e=this;return this.getLocalTracks().filter((function(t){return t.getType()===ne.a&&!e.isStartAudioMuted()||t.getType()===ne.c&&!e.isStartVideoMuted()}))},ce.prototype.onLocalTrackRemoved=function(e){e._setConference(null),this.rtc.removeLocalTrack(e),e.removeEventListener(b.TRACK_MUTE_CHANGED,e.muteHandler),e.removeEventListener(b.TRACK_AUDIO_LEVEL_CHANGED,e.audioLevelHandler),e.isVideoTrack()&&e.videoType===oe.a.DESKTOP&&this.statistics.sendScreenSharingEvent(!1),this.eventEmitter.emit(f.TRACK_REMOVED,e)},ce.prototype.removeTrack=function(e){return this.replaceTrack(e,null)},ce.prototype.replaceTrack=function(e,t){var n=this;return e&&e.disposed||t&&t.disposed?Promise.reject(new v.a(g.TRACK_IS_DISPOSED)):this._doReplaceTrack(e,t).then((function(){return e&&n.onLocalTrackRemoved(e),t?(n._setupNewTrack(t),t.isVideoTrack()&&n.rtc.setVideoType(t.videoType)):e&&e.isVideoTrack()&&n.rtc.setVideoType(oe.a.NONE),(n.isMutedByFocus||n.isVideoMutedByFocus)&&n._fireMuteChangeEvent(t),Promise.resolve()})).catch((function(e){return Promise.reject(new Error(e))}))},ce.prototype._doReplaceTrack=function(e,t){var n=[];return this.jvbJingleSession?n.push(this.jvbJingleSession.replaceTrack(e,t)):se.info("_doReplaceTrack - no JVB JingleSession"),this.p2pJingleSession?n.push(this.p2pJingleSession.replaceTrack(e,t)):se.info("_doReplaceTrack - no P2P JingleSession"),Promise.all(n)},ce.prototype._setupNewTrack=function(e){if(e.isAudioTrack()||e.isVideoTrack()&&e.videoType!==oe.a.DESKTOP){var t=E.a.getCurrentlyAvailableMediaDevices().find((function(t){return t.kind==="".concat(e.getTrack().kind,"input")&&t.label===e.getTrack().label}));t&&J.a.sendActiveDeviceListEvent(E.a.getEventDataForActiveDevice(t))}if(e.isVideoTrack()){var n="videoType";(e.videoType!==oe.a.CAMERA||this.room.getFromPresence(n))&&this.sendCommand(n,{value:e.videoType})}this.rtc.addLocalTrack(e),e.isAudioTrack()?this.room.setAudioMute(e.isMuted()):this.room.setVideoMute(e.isMuted()),e.muteHandler=this._fireMuteChangeEvent.bind(this,e),e.audioLevelHandler=this._fireAudioLevelChangeEvent.bind(this),e.addEventListener(b.TRACK_MUTE_CHANGED,e.muteHandler),e.addEventListener(b.TRACK_AUDIO_LEVEL_CHANGED,e.audioLevelHandler),e._setConference(this),this.eventEmitter.emit(f.TRACK_ADDED,e)},ce.prototype._addLocalTrackAsUnmute=function(e){var t=this,n=[];return this.jvbJingleSession?n.push(this.jvbJingleSession.addTrackAsUnmute(e)):se.debug("Add local MediaStream as unmute - no JVB Jingle session started yet"),this.p2pJingleSession?n.push(this.p2pJingleSession.addTrackAsUnmute(e)):se.debug("Add local MediaStream as unmute - no P2P Jingle session started yet"),Promise.allSettled(n).then((function(){e.isVideoTrack()&&t.rtc.setVideoType(e.videoType)}))},ce.prototype._removeLocalTrackAsMute=function(e){var t=this,n=[];return this.jvbJingleSession?n.push(this.jvbJingleSession.removeTrackAsMute(e)):se.debug("Remove local MediaStream - no JVB JingleSession started yet"),this.p2pJingleSession?n.push(this.p2pJingleSession.removeTrackAsMute(e)):se.debug("Remove local MediaStream - no P2P JingleSession started yet"),Promise.allSettled(n).then((function(){e.isVideoTrack()&&t.rtc.setVideoType(oe.a.NONE)}))},ce.prototype.getRole=function(){return this.room.role},ce.prototype.isHidden=function(){return this.connection?d.Strophe.getDomainFromJid(this.connection.getJid())===this.options.config.hiddenDomain:null},ce.prototype.isModerator=function(){return this.room?this.room.isModerator():null},ce.prototype.lock=function(e){var t=this;return this.isModerator()?new Promise((function(n,i){t.room.lockRoom(e||"",(function(){return n()}),(function(e){return i(e)}),(function(){return i(h.PASSWORD_NOT_SUPPORTED)}))})):Promise.reject(new Error("You are not moderator."))},ce.prototype.unlock=function(){return this.lock()},ce.prototype.selectParticipant=function(e){this.selectParticipants([e])},ce.prototype.selectParticipants=function(e){if(!Array.isArray(e))throw new Error("Invalid argument; participantIds must be an array.");this.receiveVideoController.selectEndpoints(e)},ce.prototype.getLastN=function(){return this.receiveVideoController.getLastN()},ce.prototype.setLastN=function(e){if(!Number.isInteger(e)&&!Number.parseInt(e,10))throw new Error("Invalid value for lastN: ".concat(e));var t=Number(e);if(t<-1)throw new RangeError("lastN cannot be smaller than -1");if(this.receiveVideoController.setLastN(t),this.p2pJingleSession){var n=0!==t;this.p2pJingleSession.setMediaTransferActive(!0,n).catch((function(e){se.error("Failed to adjust video transfer status (".concat(n,")"),e)}))}},ce.prototype.setPerceptibles=function(e){this.rtc.setPerceptibles(e)},ce.prototype.isInLastN=function(e){return this.rtc.isInLastN(e)},ce.prototype.getParticipants=function(){return Object.values(this.participants)},ce.prototype.getParticipantCount=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getParticipants();return e||(t=t.filter((function(e){return!e.isHidden()}))),t.length+1},ce.prototype.getParticipantById=function(e){return this.participants[e]},ce.prototype.grantOwner=function(e){var t=this.getParticipantById(e);t&&this.room.setAffiliation(t.getJid(),"owner")},ce.prototype.revokeOwner=function(e){var t=this.getParticipantById(e),n=this.myUserId()===e,i=this.isMembersOnly()?"member":"none";n?this.room.setAffiliation(this.room.myroomjid,i):t&&this.room.setAffiliation(t.getJid(),i)},ce.prototype.kickParticipant=function(e,t){var n=this.getParticipantById(e);n&&this.room.kick(n.getJid(),t)},ce.prototype._maybeClearSITimeout=function(){this._sessionInitiateTimeout&&(this.jvbJingleSession||this.getParticipantCount()<2)&&(window.clearTimeout(this._sessionInitiateTimeout),this._sessionInitiateTimeout=null)},ce.prototype._maybeSetSITimeout=function(){var e=this;!this.jvbJingleSession&&this.getParticipantCount()>=2&&!this._sessionInitiateTimeout&&(this._sessionInitiateTimeout=window.setTimeout((function(){e._sessionInitiateTimeout=null,J.a.sendAnalytics(Object(re.G)(re.d,{p2p:!1,value:5e3}))}),5e3))},ce.prototype.muteParticipant=function(e,t){var n=t||ne.a;if(n===ne.a||n===ne.c){var i=this.getParticipantById(e);i&&this.room.muteParticipant(i.getJid(),!0,n)}else se.error("Unsupported media type: ".concat(n))},ce.prototype.onMemberJoined=function(e,t,n,i,o,r,a,s,c,u){var l=d.Strophe.getResourceFromJid(e);if("focus"!==l&&this.myUserId()!==l){var h=new m.a(e,this,t,i,o,r,a);h.setRole(n),h.setBotType(s),h.setFeatures(u),this.participants[l]=h,this.eventEmitter.emit(f.USER_JOINED,l,h),this._updateFeatures(h),this.isJoined()&&this._maybeStartOrStopP2P(),this._maybeSetSITimeout()}},ce.prototype._onMucJoined=function(){this._maybeStartOrStopP2P()},ce.prototype._updateFeatures=function(e){var t=this;e.getFeatures().then((function(n){e._supportsDTMF=n.has("urn:xmpp:jingle:dtmf:0"),t.updateDTMFSupport(),n.has(Z.c)&&e.setProperty("features_jigasi",!0),n.has(Z.b)&&e.setProperty("features_e2ee",!0)})).catch((function(){return!1}))},ce.prototype._onMemberBotTypeChanged=function(e,t){var n=this.getParticipants().find((function(t){return t.getJid()===e}));if(n){n.setBotType(t);var i=d.Strophe.getResourceFromJid(e);this.eventEmitter.emit(f.BOT_TYPE_CHANGED,i,t)}n.getBotType()||this._maybeStartOrStopP2P()},ce.prototype.onMemberLeft=function(e){var t=this,n=d.Strophe.getResourceFromJid(e);if("focus"!==n&&this.myUserId()!==n){var i=this.participants[n];delete this.participants[n];var r,a=this._getMediaSessions(),s=[],c=Object(o.a)(a);try{for(c.s();!(r=c.n()).done;){var u=r.value;s.push(u.removeRemoteStreamsOnLeave(n))}}catch(l){c.e(l)}finally{c.f()}Promise.allSettled(s).then((function(e){var o=[];e.map((function(e){return e.value})).forEach((function(e){e&&(o=o.concat(e))})),o.forEach((function(e){t.eventEmitter.emit(f.TRACK_REMOVED,e)})),i&&t.eventEmitter.emit(f.USER_LEFT,n,i),t._maybeStartOrStopP2P(!0),t._maybeClearSITimeout()}))}},ce.prototype.onMemberKicked=function(e,t,n,i){if(t!==this.myUserId()){var o=this.participants[t];if(e)return this.eventEmitter.emit(f.KICKED,o,i),void this.leave();var r=this.participants[n];this.eventEmitter.emit(f.PARTICIPANT_KICKED,o,r,i)}},ce.prototype.onLocalRoleChanged=function(e){this.eventEmitter.emit(f.USER_ROLE_CHANGED,this.myUserId(),e)},ce.prototype.onUserRoleChanged=function(e,t){var n=d.Strophe.getResourceFromJid(e),i=this.getParticipantById(n);i&&(i.setRole(t),this.eventEmitter.emit(f.USER_ROLE_CHANGED,n,t))},ce.prototype.onDisplayNameChanged=function(e,t){var n=d.Strophe.getResourceFromJid(e),i=this.getParticipantById(n);i&&i._displayName!==t&&(i._displayName=t,this.eventEmitter.emit(f.DISPLAY_NAME_CHANGED,n,t))},ce.prototype.onRemoteTrackAdded=function(e){var t=this;if(!e.isP2P||this.isP2PActive())if(e.isP2P||!this.isP2PActive()){var n=e.getParticipantId(),i=this.getParticipantById(n);if(i){i._tracks.push(e),this.transcriber&&this.transcriber.addTrack(e);var o=this.eventEmitter;e.addEventListener(b.TRACK_MUTE_CHANGED,(function(){return o.emit(f.TRACK_MUTE_CHANGED,e)})),e.addEventListener(b.TRACK_AUDIO_LEVEL_CHANGED,(function(e,i){t.getActivePeerConnection()===i&&o.emit(f.TRACK_AUDIO_LEVEL_CHANGED,n,e)})),o.emit(f.TRACK_ADDED,e)}else se.error("No participant found for id: ".concat(n))}else se.info("Trying to add remote JVB track, when in P2P - IGNORED");else se.info("Trying to add remote P2P track, when not in P2P - IGNORED")},ce.prototype.onCallAccepted=function(e,t){this.p2pJingleSession===e&&(se.info("P2P setAnswer"),this.p2pJingleSession.setAnswer(t),this.eventEmitter.emit(f._MEDIA_SESSION_STARTED,this.p2pJingleSession))},ce.prototype.onTransportInfo=function(e,t){this.p2pJingleSession===e&&(se.info("P2P addIceCandidates"),this.p2pJingleSession.addIceCandidates(t))},ce.prototype.onRemoteTrackRemoved=function(e){var t=this;this.getParticipants().forEach((function(n){for(var i=n.getTracks(),o=0;o<i.length;o++)if(i[o]===e){n._tracks.splice(o,1),t.eventEmitter.emit(f.TRACK_REMOVED,e),t.transcriber&&t.transcriber.removeTrack(e);break}}),this)},ce.prototype._onIncomingCallP2P=function(e,t){var n;!this.isP2PEnabled()&&!this.isP2PTestModeEnabled()||O.a.isFirefox()||O.a.isWebKitBased()?n={reason:"decline",reasonDescription:"P2P disabled",errorMsg:"P2P mode disabled in the configuration"}:this.p2pJingleSession?n={reason:"busy",reasonDescription:"P2P already in progress",errorMsg:'Duplicated P2P "session-initiate"'}:this._shouldBeInP2PMode()||(n={reason:"decline",reasonDescription:"P2P requirements not met",errorMsg:'Received P2P "session-initiate" when should not be in P2P mode'},J.a.sendAnalytics(Object(re.G)(re.h))),n?this._rejectIncomingCall(e,n):this._acceptP2PIncomingCall(e,t)},ce.prototype.onIncomingCall=function(e,t,n){if(e.isP2P)this._onIncomingCallP2P(e,t);else{if(!this.room.isFocus(e.remoteJid)){var i="Rejecting session-initiate from non-focus.";return void this._rejectIncomingCall(e,{reason:"security-error",reasonDescription:i,errorMsg:i})}this._acceptJvbIncomingCall(e,t,n)}},ce.prototype._acceptJvbIncomingCall=function(e,t,n){var i=this;this.jvbJingleSession=e,this.room.connectionTimes["session.initiate"]=n,this._sendConferenceJoinAnalyticsEvent(),this.wasStopped&&J.a.sendAnalyticsAndLog(Object(re.G)(re.a,{p2p:!1}));var o=$(t).find('>bridge-session[xmlns="http://jitsi.org/protocol/focus"]').attr("region");this.eventEmitter.emit(f.SERVER_REGION_CHANGED,o),this._maybeClearSITimeout(),J.a.sendAnalytics(Object(re.G)(re.c,{p2p:!1,value:n}));try{e.initialize(this.room,this.rtc,Object(r.a)(Object(r.a)({},this.options.config),{},{enableInsertableStreams:this.isE2EEEnabled()}))}catch(s){return Q.a.callErrorHandler(s),void se.error(s)}this._setBridgeChannel(t,e.peerconnection);var a=this._getInitialLocalTracks();try{e.acceptOffer(t,(function(){i.isP2PActive()&&i.jvbJingleSession&&i._suspendMediaTransferForJvbConnection(),i.eventEmitter.emit(f._MEDIA_SESSION_STARTED,e),i.isP2PActive()||i.eventEmitter.emit(f._MEDIA_SESSION_ACTIVE_CHANGED,e)}),(function(e){Q.a.callErrorHandler(e),se.error("Failed to accept incoming Jingle session",e)}),a),se.info("Starting CallStats for JVB connection..."),this.statistics.startCallStats(this.jvbJingleSession.peerconnection,"jitsi"),this.statistics.startRemoteStats(this.jvbJingleSession.peerconnection)}catch(c){Q.a.callErrorHandler(c),se.error(c)}},ce.prototype._setBridgeChannel=function(e,t){var n=null,i=$(e).find(">content>transport>web-socket").first();1===i.length&&(n=i[0].getAttribute("url")),n?this.rtc.initializeBridgeChannel(null,n):this.rtc.initializeBridgeChannel(t,null)},ce.prototype._rejectIncomingCall=function(e,t){t&&t.errorMsg&&Q.a.callErrorHandler(new Error(t.errorMsg)),e.terminate(null,(function(e){se.warn("An error occurred while trying to terminate invalid Jingle session",e)}),{reason:t&&t.reason,reasonDescription:t&&t.reasonDescription,sendSessionTerminate:!0})},ce.prototype.onCallEnded=function(e,t,n){se.info("Call ended: ".concat(t," - ").concat(n," P2P ?").concat(e.isP2P)),e===this.jvbJingleSession?(this.wasStopped=!0,J.a.sendAnalytics(Object(re.G)(re.e,{p2p:!1})),this.statistics&&(this.statistics.stopRemoteStats(this.jvbJingleSession.peerconnection),se.info("Stopping JVB CallStats"),this.statistics.stopCallStats(this.jvbJingleSession.peerconnection)),this.jvbJingleSession=null,this.rtc.onCallEnded()):e===this.p2pJingleSession?("decline"===t&&"force JVB121"===n?(se.info("In forced JVB 121 mode..."),J.a.analytics.addPermanentProperties({forceJvb121:!0})):"connectivity-error"===t&&"ICE FAILED"===n&&J.a.analytics.addPermanentProperties({p2pFailed:!0}),this._stopP2PSession()):se.error("Received onCallEnded for invalid session",e.sid,e.remoteJid,t,n)},ce.prototype.onSuspendDetected=function(e){e.isP2P||(this.leave(),this.eventEmitter.emit(f.SUSPEND_DETECTED))},ce.prototype.updateDTMFSupport=function(){for(var e=!1,t=this.getParticipants(),n=0;n<t.length;n+=1)if(t[n].supportsDTMF()){e=!0;break}e!==this.somebodySupportsDTMF&&(this.somebodySupportsDTMF=e,this.eventEmitter.emit(f.DTMF_SUPPORT_CHANGED,e))},ce.prototype.isDTMFSupported=function(){return this.somebodySupportsDTMF},ce.prototype.myUserId=function(){return this.room&&this.room.myroomjid?d.Strophe.getResourceFromJid(this.room.myroomjid):null},ce.prototype.sendTones=function(e,t,n){var i=this.getActivePeerConnection();i?i.sendTones(e,t,n):se.warn("cannot sendTones: no peer connection")},ce.prototype.startRecording=function(e){return this.room?this.recordingManager.startRecording(e):Promise.reject(new Error("The conference is not created yet!"))},ce.prototype.stopRecording=function(e){return this.room?this.recordingManager.stopRecording(e):Promise.reject(new Error("The conference is not created yet!"))},ce.prototype.isSIPCallingSupported=function(){return!!this.room&&this.room.isSIPCallingSupported()},ce.prototype.dial=function(e){return this.room?this.room.dial(e):new Promise((function(e,t){t(new Error("The conference is not created yet!"))}))},ce.prototype.hangup=function(){return this.room?this.room.hangup():new Promise((function(e,t){t(new Error("The conference is not created yet!"))}))},ce.prototype.startTranscriber=function(){return this.dial("jitsi_meet_transcribe")},ce.prototype.stopTranscriber=ce.prototype.hangup,ce.prototype.getPhoneNumber=function(){return this.room?this.room.getPhoneNumber():null},ce.prototype.getPhonePin=function(){return this.room?this.room.getPhonePin():null},ce.prototype.getMeetingUniqueId=function(){if(this.room)return this.room.getMeetingId()},ce.prototype.getActivePeerConnection=function(){var e=this.isP2PActive()?this.p2pJingleSession:this.jvbJingleSession;return e?e.peerconnection:null},ce.prototype.getConnectionState=function(){var e=this.getActivePeerConnection();return e?e.getConnectionState():null},ce.prototype.setStartMutedPolicy=function(e){this.isModerator()?(this.startMutedPolicy=e,this.room.addOrReplaceInPresence("startmuted",{attributes:{audio:e.audio,video:e.video,xmlns:"http://jitsi.org/jitmeet/start-muted"}})&&this.room.sendPresence()):se.warn("Failed to set start muted policy, ".concat(this.room?"":"not in a room, ").concat(this.isModerator()?"":"participant is not a moderator"))},ce.prototype.getStartMutedPolicy=function(){return this.startMutedPolicy},ce.prototype.isStartAudioMuted=function(){return this.startAudioMuted},ce.prototype.isStartVideoMuted=function(){return this.startVideoMuted},ce.prototype.getConnectionTimes=function(){return this.room.connectionTimes},ce.prototype.setLocalParticipantProperty=function(e,t){this.sendCommand("jitsi_participant_".concat(e),{value:t})},ce.prototype.removeLocalParticipantProperty=function(e){this.removeCommand("jitsi_participant_".concat(e)),this.room.sendPresence()},ce.prototype.getLocalParticipantProperty=function(e){var t=this.room.presMap.nodes.find((function(t){return t.tagName==="jitsi_participant_".concat(e)}));return t?t.value:void 0},ce.prototype.sendFeedback=function(e,t){return this.statistics.sendFeedback(e,t)},ce.prototype.isCallstatsEnabled=function(){return this.statistics.isCallstatsEnabled()},ce.prototype.getSsrcByTrack=function(e){var t;return e.isLocal()?null===(t=this.getActivePeerConnection())||void 0===t?void 0:t.getLocalSSRC(e):e.getSSRC()},ce.prototype._onTrackAttach=function(e,t){var n=e.isLocal(),i=null,o=e.isP2P,r=o?e.getParticipantId():"jitsi",a=o?this.p2pJingleSession&&this.p2pJingleSession.peerconnection:this.jvbJingleSession&&this.jvbJingleSession.peerconnection;n?a&&(i=a.getLocalSSRC(e)):i=e.getSSRC(),t.id&&i&&a&&this.statistics.associateStreamWithVideoTag(a,i,n,r,e.getUsageLabel(),t.id)},ce.prototype.sendApplicationLog=function(e){J.a.sendLog(e)},ce.prototype._isFocus=function(e){return this.room?this.room.isFocus(e):null},ce.prototype._fireIncompatibleVersionsEvent=function(){this.eventEmitter.emit(f.CONFERENCE_FAILED,h.INCOMPATIBLE_SERVER_VERSIONS)},ce.prototype.sendEndpointMessage=function(e,t){this.rtc.sendChannelMessage(e,t)},ce.prototype.sendEndpointStatsMessage=function(e){this.rtc.sendEndpointStatsMessage(e)},ce.prototype.broadcastEndpointMessage=function(e){this.sendEndpointMessage("",e)},ce.prototype.sendMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=typeof e;if("object"===i||!n&&"string"===i)if(n)this.sendEndpointMessage(t,e);else{var o=e,r="body";if("object"===i){r="json-message",o.hasOwnProperty(Z.d)||(o[Z.d]="");try{o=JSON.stringify(o)}catch(a){return void se.error("Can not send a message, stringify failed: ",a)}}t?this.sendPrivateTextMessage(t,o,r):this.sendTextMessage(o,r)}else se.error("Can not send a message of type ".concat(i))},ce.prototype.isConnectionInterrupted=function(){return this.isP2PActive()?this.isP2PConnectionInterrupted:this.isJvbConnectionInterrupted},ce.prototype._onConferenceRestarted=function(e){!e.isP2P&&this.options.config.enableForcedReload&&(this.restartInProgress=!0,this.eventEmitter.emit(f.CONFERENCE_FAILED,h.CONFERENCE_RESTARTED))},ce.prototype._onIceConnectionInterrupted=function(e){e.isP2P?this.isP2PConnectionInterrupted=!0:this.isJvbConnectionInterrupted=!0,e.isP2P===this.isP2PActive()&&this.eventEmitter.emit(f.CONNECTION_INTERRUPTED)},ce.prototype._onIceConnectionFailed=function(e){e.isP2P?(J.a.analytics.addPermanentProperties({p2pFailed:!0}),this.p2pJingleSession&&J.a.sendAnalyticsAndLog(Object(re.I)(re.j,{initiator:this.p2pJingleSession.isInitiator})),this._stopP2PSession("connectivity-error","ICE FAILED")):e&&this.jvbJingleSession===e&&(this._delayedIceFailed=new C.a(this),this._delayedIceFailed.start(e))},ce.prototype._onIceConnectionRestored=function(e){e.isP2P?this.isP2PConnectionInterrupted=!1:(this.isJvbConnectionInterrupted=!1,this._delayedIceFailed&&this._delayedIceFailed.cancel()),e.isP2P===this.isP2PActive()&&this.eventEmitter.emit(f.CONNECTION_RESTORED)},ce.prototype._acceptP2PIncomingCall=function(e,t){var n=this;this.isP2PConnectionInterrupted=!1,this.p2pJingleSession=e,this._sendConferenceJoinAnalyticsEvent(),this.p2pJingleSession.initialize(this.room,this.rtc,Object(r.a)(Object(r.a)({},this.options.config),{},{enableInsertableStreams:this.isE2EEEnabled()})),se.info("Starting CallStats for P2P connection...");var i=d.Strophe.getResourceFromJid(this.p2pJingleSession.remoteJid),o=this.participants[i];o&&(i=o.getStatsID()||i),this.statistics.startCallStats(this.p2pJingleSession.peerconnection,i);var a=this.getLocalTracks();this.p2pJingleSession.acceptOffer(t,(function(){se.debug('Got RESULT for P2P "session-accept"'),n.eventEmitter.emit(f._MEDIA_SESSION_STARTED,n.p2pJingleSession)}),(function(e){se.error("Failed to accept incoming P2P Jingle session",e)}),a)},ce.prototype._addRemoteJVBTracks=function(){this._addRemoteTracks("JVB",this.jvbJingleSession.peerconnection.getRemoteTracks())},ce.prototype._addRemoteP2PTracks=function(){this._addRemoteTracks("P2P",this.p2pJingleSession.peerconnection.getRemoteTracks())},ce.prototype._addRemoteTracks=function(e,t){var n,i=Object(o.a)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;se.info("Adding remote ".concat(e," track: ").concat(r)),this.onRemoteTrackAdded(r)}}catch(a){i.e(a)}finally{i.f()}},ce.prototype._onIceConnectionEstablished=function(e){null!==this.p2pJingleSession&&(this.p2pEstablishmentDuration=this.p2pJingleSession.establishmentDuration),null!==this.jvbJingleSession&&(this.jvbEstablishmentDuration=this.jvbJingleSession.establishmentDuration);var t=!1,n=this.options.config.forceJVB121Ratio;if(e.isP2P?this.p2pJingleSession!==e?(se.error("CONNECTION_ESTABLISHED - wrong P2P session instance ?!"),t=!0):!e.isInitiator&&"number"===typeof n&&Math.random()<n&&(se.info("Forcing JVB 121 mode (ratio=".concat(n,")...")),J.a.analytics.addPermanentProperties({forceJvb121:!0}),this._stopP2PSession("decline","force JVB121"),t=!0):t=!0,!isNaN(this.p2pEstablishmentDuration)&&!isNaN(this.jvbEstablishmentDuration)){var i=this.p2pEstablishmentDuration-this.jvbEstablishmentDuration;J.a.sendAnalytics(re.p,{value:i})}e.isP2P===this.isP2PActive()&&this.eventEmitter.emit(f.CONNECTION_ESTABLISHED),t||(this._setP2PStatus(!0),this.jvbJingleSession?this._removeRemoteJVBTracks():se.info("Not removing remote JVB tracks - no session yet"),this._addRemoteP2PTracks(),this.jvbJingleSession&&this._suspendMediaTransferForJvbConnection(),se.info("Starting remote stats with p2p connection"),this.statistics.startRemoteStats(this.p2pJingleSession.peerconnection),J.a.sendAnalyticsAndLog(Object(re.I)(re.i,{initiator:this.p2pJingleSession.isInitiator})))},ce.prototype._updateProperties=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!l()(e,this.properties);if(this.properties=e,t){this.eventEmitter.emit(f.PROPERTIES_CHANGED,this.properties);var n=["bridge-count","created-ms"];n.forEach((function(t){void 0!==e[t]&&J.a.analytics.addPermanentProperties(Object(i.a)({},t.replace("-","_"),e[t]))}))}},ce.prototype.getProperty=function(e){return this.properties[e]},ce.prototype._maybeClearDeferredStartP2P=function(){this.deferredStartP2PTask&&(se.info("Cleared deferred start P2P task"),clearTimeout(this.deferredStartP2PTask),this.deferredStartP2PTask=null)},ce.prototype._removeRemoteJVBTracks=function(){this._removeRemoteTracks("JVB",this.jvbJingleSession.peerconnection.getRemoteTracks())},ce.prototype._removeRemoteP2PTracks=function(){this._removeRemoteTracks("P2P",this.p2pJingleSession.peerconnection.getRemoteTracks())},ce.prototype._removeRemoteTracks=function(e,t){var n,i=Object(o.a)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;se.info("Removing remote ".concat(e," track: ").concat(r)),this.onRemoteTrackRemoved(r)}}catch(a){i.e(a)}finally{i.f()}},ce.prototype._resumeMediaTransferForJvbConnection=function(){se.info("Resuming media transfer over the JVB connection..."),this.jvbJingleSession.setMediaTransferActive(!0,!0).then((function(){se.info("Resumed media transfer over the JVB connection!")}),(function(e){se.error("Failed to resume media transfer over the JVB connection:",e)}))},ce.prototype._setP2PStatus=function(e){if(this.p2p!==e){if(this.p2p=e,e){se.info("Peer to peer connection established!"),J.a.analytics.addPermanentProperties({p2pFailed:!1,forceJvb121:!1});var t=0!==this.getLastN();this.p2pJingleSession.setMediaTransferActive(!0,t).catch((function(e){se.error("Failed to sync up P2P video transfer status"+"(".concat(t,")"),e)}))}else se.info("Peer to peer connection closed!");this.jvbJingleSession&&this.statistics.sendConnectionResumeOrHoldEvent(this.jvbJingleSession.peerconnection,!e),this.dtmfManager=null,this.eventEmitter.emit(f.P2P_STATUS,this,this.p2p),this.eventEmitter.emit(f._MEDIA_SESSION_ACTIVE_CHANGED,this._getActiveMediaSession()),this.eventEmitter.emit(this.isConnectionInterrupted()?f.CONNECTION_INTERRUPTED:f.CONNECTION_RESTORED)}else se.debug("Called _setP2PStatus with the same status: ".concat(e))},ce.prototype._startP2PSession=function(e){if(this._maybeClearDeferredStartP2P(),this.p2pJingleSession)se.error("P2P session already started!");else{this.isP2PConnectionInterrupted=!1,this.p2pJingleSession=this.xmpp.connection.jingle.newP2PJingleSession(this.room.myroomjid,e),se.info("Created new P2P JingleSession",this.room.myroomjid,e),this._sendConferenceJoinAnalyticsEvent(),this.p2pJingleSession.initialize(this.room,this.rtc,Object(r.a)(Object(r.a)({},this.options.config),{},{enableInsertableStreams:this.isE2EEEnabled()})),se.info("Starting CallStats for P2P connection...");var t=d.Strophe.getResourceFromJid(this.p2pJingleSession.remoteJid),n=this.participants[t];n&&(t=n.getStatsID()||t),this.statistics.startCallStats(this.p2pJingleSession.peerconnection,t);var i=this.getLocalTracks();this.p2pJingleSession.invite(i)}},ce.prototype._suspendMediaTransferForJvbConnection=function(){se.info("Suspending media transfer over the JVB connection..."),this.jvbJingleSession.setMediaTransferActive(!1,!1).then((function(){se.info("Suspended media transfer over the JVB connection !")}),(function(e){se.error("Failed to suspend media transfer over the JVB connection:",e)}))},ce.prototype._maybeStartOrStopP2P=function(e){if(!this.isP2PEnabled()||this.isP2PTestModeEnabled()||O.a.isFirefox()||O.a.isWebKitBased())se.info("Auto P2P disabled");else{var t=this.getParticipants(),n=t.length,i=this._shouldBeInP2PMode();if(!i&&this.deferredStartP2PTask&&this._maybeClearDeferredStartP2P(),!this.p2pJingleSession&&i){var o=n&&t[0],r=this.myUserId(),a=o.getId();if(r>a)return void se.debug("I'm the bigger peersId - the other peer should start P2P",r,a);if(r===a)return void se.error("The same IDs ? ",r,a);var s=o.getJid();if(e){if(this.deferredStartP2PTask)return void se.error("Deferred start P2P task's been set already!");se.info("Will start P2P with: ".concat(s," after ").concat(this.backToP2PDelay," seconds...")),this.deferredStartP2PTask=setTimeout(this._startP2PSession.bind(this,s),1e3*this.backToP2PDelay)}else se.info("Will start P2P with: ".concat(s)),this._startP2PSession(s)}else this.p2pJingleSession&&!i&&(se.info("Will stop P2P with: ".concat(this.p2pJingleSession.remoteJid)),this.p2pJingleSession.isInitiator&&n>1&&J.a.sendAnalyticsAndLog(Object(re.I)(re.k)),this._stopP2PSession())}},ce.prototype._shouldBeInP2PMode=function(){var e=this.getParticipants(),t=e.length,n=void 0!==e.find((function(e){return"poltergeist"===e.getBotType()||e.hasFeature(Z.c)})),i=1===t&&!n;return se.debug("P2P? peerCount: ".concat(t,", hasBotPeer: ").concat(n," => ").concat(i)),i},ce.prototype._stopP2PSession=function(e,t){if(this.p2pJingleSession){var n=this.isP2PActive();n&&(this.jvbJingleSession&&this._resumeMediaTransferForJvbConnection(),this._removeRemoteP2PTracks()),se.info("Stopping remote stats for P2P connection"),this.statistics.stopRemoteStats(this.p2pJingleSession.peerconnection),se.info("Stopping CallStats for P2P connection"),this.statistics.stopCallStats(this.p2pJingleSession.peerconnection),this.p2pJingleSession.terminate((function(){se.info("P2P session terminate RESULT")}),(function(t){e&&se.error("An error occurred while trying to terminate P2P Jingle session",t)}),{reason:e||"success",reasonDescription:t||"Turing off P2P session",sendSessionTerminate:this.room&&this.getParticipantById(d.Strophe.getResourceFromJid(this.p2pJingleSession.remoteJid))}),this.p2pJingleSession=null,this._setP2PStatus(!1),n&&(this.jvbJingleSession?this._addRemoteJVBTracks():se.info("Not adding remote JVB tracks - no session yet"))}else se.error("No P2P session to be stopped!")},ce.prototype.isP2PActive=function(){return this.p2p},ce.prototype.getP2PConnectionState=function(){return this.isP2PActive()?this.p2pJingleSession.peerconnection.getConnectionState():null},ce.prototype.startP2PSession=function(){var e=this.getParticipants();if(1!==e.length)throw new Error("There must be exactly 1 participant to start the P2P session !");var t=e[0].getJid();this._startP2PSession(t)},ce.prototype.stopP2PSession=function(){this._stopP2PSession()},ce.prototype.getSpeakerStats=function(){return this.speakerStatsCollector.getStats()},ce.prototype.setReceiverConstraints=function(e){this.receiveVideoController.setReceiverConstraints(e)},ce.prototype.setReceiverVideoConstraint=function(e){this.receiveVideoController.setPreferredReceiveMaxFrameHeight(e)},ce.prototype.setSenderVideoConstraint=function(e){return this.sendVideoController.setPreferredSendMaxFrameHeight(e)},ce.prototype.createVideoSIPGWSession=function(e,t){return this.room?this.videoSIPGWHandler.createVideoSIPGWSession(e,t):new Error(X.ERROR_NO_CONNECTION)},ce.prototype._sendConferenceJoinAnalyticsEvent=function(){var e=this.getMeetingUniqueId();!this._conferenceJoinAnalyticsEventSent&&e&&null!==this.getActivePeerConnection()&&(J.a.sendAnalytics(Object(re.A)("joined",{meetingId:e,participantId:"".concat(e,".").concat(this._statsCurrentId)})),this._conferenceJoinAnalyticsEventSent=Date.now())},ce.prototype._sendConferenceLeftAnalyticsEvent=function(){var e=this.getMeetingUniqueId();e&&this._conferenceJoinAnalyticsEventSent&&J.a.sendAnalytics(Object(re.A)("left",{meetingId:e,participantId:"".concat(e,".").concat(this._statsCurrentId),stats:{duration:Math.floor((Date.now()-this._conferenceJoinAnalyticsEventSent)/1e3),perf:this.getPerformanceStats()}}))},ce.prototype._restartMediaSessions=function(){this.p2pJingleSession&&this.stopP2PSession(),this.jvbJingleSession&&this.jvbJingleSession.terminate(null,(function(e){se.warn("An error occurred while trying to terminate the JVB session",e)}),{reason:"success",reasonDescription:"restart required",requestRestart:!0,sendSessionTerminate:!0}),this._maybeStartOrStopP2P(!1)},ce.prototype.isE2EEEnabled=function(){return this._e2eEncryption&&this._e2eEncryption.isEnabled()},ce.prototype.isE2EESupported=function(){return D.a.isSupported(this.options.config)},ce.prototype.toggleE2EE=function(e){this.isE2EESupported()?this._e2eEncryption.setEnabled(e):se.warn("Cannot enable / disable E2EE: platform is not supported.")},ce.prototype.isLobbySupported=function(){return Boolean(this.room&&this.room.getLobby().isSupported())},ce.prototype.isMembersOnly=function(){return Boolean(this.room&&this.room.membersOnlyEnabled)},ce.prototype.enableLobby=function(){return this.room&&this.isModerator()?this.room.getLobby().enable():Promise.reject(new Error("The conference not started or user is not moderator"))},ce.prototype.disableLobby=function(){this.room&&this.isModerator()?this.room.getLobby().disable():se.warn("Failed to disable lobby, ".concat(this.room?"":"not in a room, ").concat(this.isModerator()?"":"participant is not a moderator"))},ce.prototype.joinLobby=function(e,t){return this.room?this.room.getLobby().join(e,t):Promise.reject(new Error("The conference not started"))},ce.prototype.lobbyDenyAccess=function(e){this.room&&this.room.getLobby().denyAccess(e)},ce.prototype.lobbyApproveAccess=function(e){this.room&&this.room.getLobby().approveAccess(e)},ce.prototype.isAVModerationSupported=function(){return Boolean(this.room&&this.room.getAVModeration().isSupported())},ce.prototype.enableAVModeration=function(e){this.room&&this.isModerator()&&(e===ne.a||e===ne.c)?this.room.getAVModeration().enable(!0,e):se.warn("Failed to enable AV moderation, ".concat(this.room?"":"not in a room, ").concat(this.isModerator()?"":"participant is not a moderator, ").concat(this.room&&this.isModerator()?"wrong media type passed":""))},ce.prototype.disableAVModeration=function(e){this.room&&this.isModerator()&&(e===ne.a||e===ne.c)?this.room.getAVModeration().enable(!1,e):se.warn("Failed to disable AV moderation, ".concat(this.room?"":"not in a room, ").concat(this.isModerator()?"":"participant is not a moderator, ").concat(this.room&&this.isModerator()?"wrong media type passed":""))},ce.prototype.avModerationApprove=function(e,t){if(this.room&&this.isModerator()&&(e===ne.a||e===ne.c)){var n=this.getParticipantById(t);if(!n)return;this.room.getAVModeration().approve(e,n.getJid())}else se.warn("AV moderation skipped , ".concat(this.room?"":"not in a room, ").concat(this.isModerator()?"":"participant is not a moderator, ").concat(this.room&&this.isModerator()?"wrong media type passed":""))}}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return O}));var i=n(18),o=n(13),r=n(63),a=n(10),s=n(135),c=n(27),u=n(343),l=n.n(u),d=n(19),h=n(31),p=n.n(h),f=n(47),m=n.n(f),v=n(274),g=n.n(v),b=n(32),y=n(9),A=n.n(y),E=Object(i.getLogger)(e);function O(e){this.conference=e,this.xmppListeners={},e.on(a.TRACK_MUTE_CHANGED,(function(t){if(t.isLocal()&&e.statistics){var n=t.isP2P?e.p2pJingleSession:e.jvbJingleSession,i=n&&n.peerconnection||null;e.statistics.sendMuteEvent(i,t.isMuted(),t.getType())}}))}O.prototype.setupChatRoomListeners=function(){var e=this,t=this.conference,n=t.room;this.chatRoomForwarder=new l.a(n,this.conference.eventEmitter),n.addListener(A.a.ICE_RESTARTING,(function(e){e.isP2P||t.rtc.closeBridgeChannel()})),n.addListener(A.a.PARTICIPANT_FEATURES_CHANGED,(function(e,n){var i=t.getParticipantById(o.Strophe.getResourceFromJid(e));i&&(i.setFeatures(n),t.eventEmitter.emit(a.PARTCIPANT_FEATURES_CHANGED,i))})),n.addListener(A.a.ICE_RESTART_SUCCESS,(function(e,n){!e.isP2P&&t._setBridgeChannel(n,e.peerconnection)})),n.addListener(A.a.AUDIO_MUTED_BY_FOCUS,(function(e){c.a.sendAnalytics(Object(b.K)(d.a)),t.mutedByFocusActor=e,t.rtc.setAudioMute(!0).then((function(){t.isMutedByFocus=!0,t.mutedByFocusActor=null})).catch((function(e){t.mutedByFocusActor=null,E.warn("Error while audio muting due to focus request",e)}))})),n.addListener(A.a.VIDEO_MUTED_BY_FOCUS,(function(e){c.a.sendAnalytics(Object(b.K)(d.c)),t.mutedVideoByFocusActor=e,t.rtc.setVideoMute(!0).then((function(){t.isVideoMutedByFocus=!0,t.mutedVideoByFocusActor=null})).catch((function(e){t.mutedVideoByFocusActor=null,E.warn("Error while video muting due to focus request",e)}))})),this.chatRoomForwarder.forward(A.a.SUBJECT_CHANGED,a.SUBJECT_CHANGED),this.chatRoomForwarder.forward(A.a.MUC_JOINED,a.CONFERENCE_JOINED),this.chatRoomForwarder.forward(A.a.MEETING_ID_SET,a.CONFERENCE_UNIQUE_ID_SET),n.addListener(A.a.MUC_JOINED,(function(){e.conference._onMucJoined(),e.conference.isJvbConnectionInterrupted=!1,Object.keys(n.connectionTimes).forEach((function(e){var t=Object(b.C)("conference_".concat(e),{value:n.connectionTimes[e]});c.a.sendAnalytics(t)})),Object.keys(n.xmpp.connectionTimes).forEach((function(e){var t=Object(b.C)("xmpp_".concat(e),{value:n.xmpp.connectionTimes[e]});c.a.sendAnalytics(t)}))})),n.addListener(A.a.RENEGOTIATION_FAILED,(function(e,n){n.isP2P||t.eventEmitter.emit(a.CONFERENCE_FAILED,r.OFFER_ANSWER_FAILED,e)})),this.chatRoomForwarder.forward(A.a.ROOM_JOIN_ERROR,a.CONFERENCE_FAILED,r.CONNECTION_ERROR),this.chatRoomForwarder.forward(A.a.ROOM_CONNECT_ERROR,a.CONFERENCE_FAILED,r.CONNECTION_ERROR),this.chatRoomForwarder.forward(A.a.ROOM_CONNECT_NOT_ALLOWED_ERROR,a.CONFERENCE_FAILED,r.NOT_ALLOWED_ERROR),this.chatRoomForwarder.forward(A.a.ROOM_CONNECT_MEMBERS_ONLY_ERROR,a.CONFERENCE_FAILED,r.MEMBERS_ONLY_ERROR),this.chatRoomForwarder.forward(A.a.ROOM_MAX_USERS_ERROR,a.CONFERENCE_FAILED,r.CONFERENCE_MAX_USERS),this.chatRoomForwarder.forward(A.a.PASSWORD_REQUIRED,a.CONFERENCE_FAILED,r.PASSWORD_REQUIRED),this.chatRoomForwarder.forward(A.a.AUTHENTICATION_REQUIRED,a.CONFERENCE_FAILED,r.AUTHENTICATION_REQUIRED),this.chatRoomForwarder.forward(A.a.BRIDGE_DOWN,a.CONFERENCE_FAILED,r.VIDEOBRIDGE_NOT_AVAILABLE),n.addListener(A.a.BRIDGE_DOWN,(function(){return c.a.sendAnalytics(Object(b.z)())})),n.addListener(A.a.CONNECTION_RESTARTED,(function(e){t._onConferenceRestarted(e)})),this.chatRoomForwarder.forward(A.a.RESERVATION_ERROR,a.CONFERENCE_FAILED,r.RESERVATION_ERROR),this.chatRoomForwarder.forward(A.a.GRACEFUL_SHUTDOWN,a.CONFERENCE_FAILED,r.GRACEFUL_SHUTDOWN),n.addListener(A.a.CONNECTION_ICE_FAILED,(function(e){t._onIceConnectionFailed(e)})),this.chatRoomForwarder.forward(A.a.MUC_DESTROYED,a.CONFERENCE_FAILED,r.CONFERENCE_DESTROYED),this.chatRoomForwarder.forward(A.a.CHAT_ERROR_RECEIVED,a.CONFERENCE_ERROR,r.CHAT_ERROR),this.chatRoomForwarder.forward(A.a.FOCUS_DISCONNECTED,a.CONFERENCE_FAILED,r.FOCUS_DISCONNECTED),n.addListener(A.a.FOCUS_LEFT,(function(){c.a.sendAnalytics(Object(b.E)()),t.eventEmitter.emit(a.CONFERENCE_FAILED,r.FOCUS_LEFT)})),n.addListener(A.a.SESSION_ACCEPT_TIMEOUT,(function(e){c.a.sendAnalyticsAndLog(Object(b.G)(b.b,{p2p:e.isP2P}))})),n.addListener(A.a.RECORDER_STATE_CHANGED,(function(e,n){if(n){var i=t.getParticipantById(o.Strophe.getResourceFromJid(n));"off"===e.getStatus()?e.setTerminator(i):"on"===e.getStatus()&&e.setInitiator(i)}t.eventEmitter.emit(a.RECORDER_STATE_CHANGED,e)})),this.chatRoomForwarder.forward(A.a.TRANSCRIPTION_STATUS_CHANGED,a.TRANSCRIPTION_STATUS_CHANGED),this.chatRoomForwarder.forward(A.a.VIDEO_SIP_GW_AVAILABILITY_CHANGED,a.VIDEO_SIP_GW_AVAILABILITY_CHANGED),this.chatRoomForwarder.forward(A.a.VIDEO_SIP_GW_SESSION_STATE_CHANGED,a.VIDEO_SIP_GW_SESSION_STATE_CHANGED),this.chatRoomForwarder.forward(A.a.PHONE_NUMBER_CHANGED,a.PHONE_NUMBER_CHANGED),n.setParticipantPropertyListener((function(e,n){var i=t.getParticipantById(n);i&&i.setProperty(e.tagName.substring("jitsi_participant_".length),e.value)})),n.addListener(A.a.KICKED,t.onMemberKicked.bind(t)),n.addListener(A.a.SUSPEND_DETECTED,t.onSuspendDetected.bind(t)),this.chatRoomForwarder.forward(A.a.MUC_LOCK_CHANGED,a.LOCK_STATE_CHANGED),this.chatRoomForwarder.forward(A.a.MUC_MEMBERS_ONLY_CHANGED,a.MEMBERS_ONLY_CHANGED),n.addListener(A.a.MUC_MEMBER_JOINED,t.onMemberJoined.bind(t)),this.chatRoomForwarder.forward(A.a.MUC_LOBBY_MEMBER_JOINED,a.LOBBY_USER_JOINED),this.chatRoomForwarder.forward(A.a.MUC_LOBBY_MEMBER_UPDATED,a.LOBBY_USER_UPDATED),this.chatRoomForwarder.forward(A.a.MUC_LOBBY_MEMBER_LEFT,a.LOBBY_USER_LEFT),n.addListener(A.a.MUC_MEMBER_BOT_TYPE_CHANGED,t._onMemberBotTypeChanged.bind(t)),n.addListener(A.a.MUC_MEMBER_LEFT,t.onMemberLeft.bind(t)),this.chatRoomForwarder.forward(A.a.MUC_LEFT,a.CONFERENCE_LEFT),this.chatRoomForwarder.forward(A.a.MUC_DENIED_ACCESS,a.CONFERENCE_FAILED,r.CONFERENCE_ACCESS_DENIED),n.addListener(A.a.DISPLAY_NAME_CHANGED,t.onDisplayNameChanged.bind(t)),n.addListener(A.a.LOCAL_ROLE_CHANGED,(function(e){t.onLocalRoleChanged(e),t.statistics&&t.isModerator()&&t.on(a.RECORDER_STATE_CHANGED,(function(e){var t={error:e.getError(),id:"recorder_status",status:e.getStatus()};c.a.sendLog(JSON.stringify(t))}))})),n.addListener(A.a.MUC_ROLE_CHANGED,t.onUserRoleChanged.bind(t)),n.addListener(g.a.IDENTITY_UPDATED,(function(e,n){t.authEnabled=e,t.authIdentity=n,t.eventEmitter.emit(a.AUTH_STATUS_CHANGED,e,n)})),n.addListener(A.a.MESSAGE_RECEIVED,(function(e,n,i,r){var s=o.Strophe.getResourceFromJid(e);t.eventEmitter.emit(a.MESSAGE_RECEIVED,s,n,r)})),n.addListener(A.a.PRIVATE_MESSAGE_RECEIVED,(function(e,n,i,r){var s=o.Strophe.getResourceFromJid(e);t.eventEmitter.emit(a.PRIVATE_MESSAGE_RECEIVED,s,n,r)})),n.addListener(A.a.PRESENCE_STATUS,(function(e,n){var i=o.Strophe.getResourceFromJid(e),r=t.getParticipantById(i);r&&r._status!==n&&(r._status=n,t.eventEmitter.emit(a.USER_STATUS_CHANGED,i,n))})),n.addListener(A.a.JSON_MESSAGE_RECEIVED,(function(e,n){var i=o.Strophe.getResourceFromJid(e),r=t.getParticipantById(i);r&&t.eventEmitter.emit(a.ENDPOINT_MESSAGE_RECEIVED,r,n)})),n.addPresenceListener("startmuted",(function(e,n){var i=!1;if(t.myUserId()===n&&t.isModerator())i=!0;else{var o=t.getParticipantById(n);o&&o.isModerator()&&(i=!0)}if(i){var r="true"===e.attributes.audio,s="true"===e.attributes.video,c=!1;r!==t.startMutedPolicy.audio&&(t.startMutedPolicy.audio=r,c=!0),s!==t.startMutedPolicy.video&&(t.startMutedPolicy.video=s,c=!0),c&&t.eventEmitter.emit(a.START_MUTED_POLICY_CHANGED,t.startMutedPolicy)}})),t.statistics&&(n.addListener(A.a.CONNECTION_ICE_FAILED,(function(e){t.statistics.sendIceConnectionFailedEvent(e.peerconnection)})),n.addListener(A.a.ADD_ICE_CANDIDATE_FAILED,(function(e,n){t.statistics.sendAddIceCandidateFailed(e,n)})))},O.prototype.setupRTCListeners=function(){var e=this.conference,t=e.rtc;t.addListener(p.a.REMOTE_TRACK_ADDED,e.onRemoteTrackAdded.bind(e)),t.addListener(p.a.REMOTE_TRACK_REMOVED,e.onRemoteTrackRemoved.bind(e)),t.addListener(p.a.DOMINANT_SPEAKER_CHANGED,(function(t,n){if(e.lastDominantSpeaker!==t&&e.room){if(e.lastDominantSpeaker=t,e.eventEmitter.emit(a.DOMINANT_SPEAKER_CHANGED,t,n),n&&n.length){var i=n.slice(0);e.myUserId!==t&&i.splice(0,0,t),i.length>s.b&&i.splice(s.b,i.length-s.b),e.statistics&&e.statistics.setSpeakerList(i)}e.statistics&&e.myUserId()===t&&e.statistics.sendDominantSpeakerEvent(e.room.roomjid)}})),t.addListener(p.a.DATA_CHANNEL_OPEN,(function(){var t=window.performance.now(),n="data.channel.opened";E.log("(TIME) ".concat(n,":\t"),t),e.room.connectionTimes[n]=t,c.a.sendAnalytics(Object(b.C)(n,{value:t})),e.eventEmitter.emit(a.DATA_CHANNEL_OPENED)})),t.addListener(p.a.ENDPOINT_MESSAGE_RECEIVED,(function(t,n){var i=e.getParticipantById(t);i&&e.eventEmitter.emit(a.ENDPOINT_MESSAGE_RECEIVED,i,n)})),t.addListener(p.a.ENDPOINT_STATS_RECEIVED,(function(t,n){var i=e.getParticipantById(t);i?e.eventEmitter.emit(a.ENDPOINT_STATS_RECEIVED,i,n):E.warn("Ignoring ENDPOINT_STATS_RECEIVED for a non-existant participant: ".concat(t))})),t.addListener(p.a.LOCAL_UFRAG_CHANGED,(function(e,t){e.isP2P||c.a.sendLog(JSON.stringify({id:"local_ufrag",value:t}))})),t.addListener(p.a.REMOTE_UFRAG_CHANGED,(function(e,t){e.isP2P||c.a.sendLog(JSON.stringify({id:"remote_ufrag",value:t}))})),t.addListener(p.a.CREATE_ANSWER_FAILED,(function(t,n){e.statistics.sendCreateAnswerFailed(t,n),n.isP2P||e.eventEmitter.emit(a.CONFERENCE_FAILED,r.OFFER_ANSWER_FAILED,t)})),t.addListener(p.a.CREATE_OFFER_FAILED,(function(t,n){e.statistics.sendCreateOfferFailed(t,n),n.isP2P||e.eventEmitter.emit(a.CONFERENCE_FAILED,r.OFFER_ANSWER_FAILED,t)})),t.addListener(p.a.SET_LOCAL_DESCRIPTION_FAILED,(function(t,n){e.statistics.sendSetLocalDescFailed(t,n),n.isP2P||e.eventEmitter.emit(a.CONFERENCE_FAILED,r.OFFER_ANSWER_FAILED,t)})),t.addListener(p.a.SET_REMOTE_DESCRIPTION_FAILED,(function(t,n){e.statistics.sendSetRemoteDescFailed(t,n),n.isP2P||e.eventEmitter.emit(a.CONFERENCE_FAILED,r.OFFER_ANSWER_FAILED,t)})),t.addListener(p.a.LOCAL_TRACK_SSRC_UPDATED,(function(t,n){t.isVideoTrack()&&t.videoType===m.a.DESKTOP&&e.statistics.sendScreenSharingEvent(!0,n)}))},O.prototype.removeXMPPListeners=function(){var e=this,t=this.conference;Object.keys(this.xmppListeners).forEach((function(n){t.xmpp.removeListener(n,e.xmppListeners[n])})),this.xmppListeners={}},O.prototype.setupXMPPListeners=function(){var e=this.conference;this._addConferenceXMPPListener(A.a.CALL_INCOMING,e.onIncomingCall.bind(e)),this._addConferenceXMPPListener(A.a.CALL_ACCEPTED,e.onCallAccepted.bind(e)),this._addConferenceXMPPListener(A.a.TRANSPORT_INFO,e.onTransportInfo.bind(e)),this._addConferenceXMPPListener(A.a.CALL_ENDED,e.onCallEnded.bind(e)),this._addConferenceXMPPListener(A.a.START_MUTED_FROM_FOCUS,(function(t,n){e.options.config.ignoreStartMuted||(e.startAudioMuted=t,e.startVideoMuted=n,e.getLocalTracks().forEach((function(t){switch(t.getType()){case d.a:e.startAudioMuted&&t.mute();break;case d.c:e.startVideoMuted&&t.mute()}})),e.eventEmitter.emit(a.STARTED_MUTED))})),this._addConferenceXMPPListener(A.a.CONFERENCE_TIMESTAMP_RECEIVED,(function(t){e.eventEmitter.emit(a.CONFERENCE_CREATED_TIMESTAMP,t)})),this._addConferenceXMPPListener(A.a.AV_MODERATION_CHANGED,(function(t,n,i){var o=e.getParticipants().find((function(e){return e.getJid()===i}));e.eventEmitter.emit(a.AV_MODERATION_CHANGED,{enabled:t,mediaType:n,actor:o})})),this._addConferenceXMPPListener(A.a.AV_MODERATION_PARTICIPANT_APPROVED,(function(t,n){var i=e.getParticipantById(o.Strophe.getResourceFromJid(n));i&&e.eventEmitter.emit(a.AV_MODERATION_PARTICIPANT_APPROVED,{participant:i,mediaType:t})})),this._addConferenceXMPPListener(A.a.AV_MODERATION_APPROVED,(function(t){return e.eventEmitter.emit(a.AV_MODERATION_APPROVED,{mediaType:t})}))},O.prototype._addConferenceXMPPListener=function(e,t){this.xmppListeners[e]=t,this.conference.xmpp.addListener(e,t)},O.prototype.setupStatisticsListeners=function(){var e=this.conference;e.statistics&&(e.statistics.addAudioLevelListener((function(t,n,i,o){e.rtc.setAudioLevel(t,n,i,o)})),e.statistics.addBeforeDisposedListener((function(){e.eventEmitter.emit(a.BEFORE_STATISTICS_DISPOSED)})),e.options.config.startSilent||e.statistics.addByteSentStatsListener((function(t,n){e.getLocalTracks(d.a).forEach((function(e){var i=t.getLocalSSRC(e);i&&n.hasOwnProperty(i)&&e._onByteSentStatsReceived(t,n[i])}))})))}}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e,i){n.d(t,"a",(function(){return d}));var o=n(6),r=n(8),a=n(35),s=n(34),c=n(190),u=n(18),l=Object(u.getLogger)(e),d=function(e){Object(a.a)(n,e);var t=Object(s.a)(n);function n(){var e;return Object(o.a)(this,n),e=t.call(this),l.info("This appears to be ".concat(e.getName(),", ver: ").concat(e.getVersion())),e}return Object(r.a)(n,[{key:"doesVideoMuteByStreamRemove",value:function(){return this.isChromiumBased()||this.isWebKitBased()}},{key:"isChromiumBased",value:function(){return this.isChrome()||this.isElectron()||this.isNWJS()||this.isOpera()}},{key:"isWebKitBased",value:function(){return this._bowser.isEngine("webkit")&&"undefined"!==typeof navigator.mediaDevices&&"undefined"!==typeof navigator.mediaDevices.getUserMedia&&"undefined"!==typeof window.RTCRtpTransceiver&&Object.keys(RTCRtpTransceiver.prototype).indexOf("currentDirection")>-1}},{key:"isTwa",value:function(){return"matchMedia"in window&&window.matchMedia("(display-mode:standalone)").matches}},{key:"isSupported",value:function(){return this.isChromiumBased()&&this._getChromiumBasedVersion()>=72||this.isFirefox()||this.isReactNative()||this.isWebKitBased()}},{key:"isUserInteractionRequiredForUnmute",value:function(){return this.isFirefox()&&this.isVersionLessThan("68")}},{key:"supportsVideoMuteOnConnInterrupted",value:function(){return this.isChromiumBased()||this.isReactNative()||this.isWebKitBased()}},{key:"supportsBandwidthStatistics",value:function(){return!this.isFirefox()&&!this.isWebKitBased()}},{key:"supportsCodecPreferences",value:function(){return Boolean(window.RTCRtpTransceiver&&"undefined"!==typeof window.RTCRtpTransceiver.setCodecPreferences&&window.RTCRtpReceiver&&"undefined"!==typeof window.RTCRtpReceiver.getCapabilities)&&!this.isWebKitBased()}},{key:"supportsDeviceChangeEvent",value:function(){return navigator.mediaDevices&&"undefined"!==typeof navigator.mediaDevices.ondevicechange&&"undefined"!==typeof navigator.mediaDevices.addEventListener}},{key:"supportsLocalCandidateRttStatistics",value:function(){return this.isChromiumBased()||this.isReactNative()||this.isWebKitBased()}},{key:"supportsPerformanceObserver",value:function(){return"undefined"!==typeof window.PerformanceObserver&&PerformanceObserver.supportedEntryTypes.indexOf("longtask")>-1}},{key:"supportsReceiverStats",value:function(){return"undefined"!==typeof window.RTCRtpReceiver&&Object.keys(RTCRtpReceiver.prototype).indexOf("getSynchronizationSources")>-1&&!this.isWebKitBased()}},{key:"supportsRTTStatistics",value:function(){return!this.isFirefox()}},{key:"usesSdpMungingForSimulcast",value:function(){return this.isChromiumBased()||this.isReactNative()||this.isWebKitBased()}},{key:"usesAdapter",value:function(){return!this.isReactNative()}},{key:"usesRidsForSimulcast",value:function(){return!1}},{key:"supportsGetDisplayMedia",value:function(){return"undefined"!==typeof navigator.getDisplayMedia||"undefined"!==typeof navigator.mediaDevices&&"undefined"!==typeof navigator.mediaDevices.getDisplayMedia}},{key:"supportsInsertableStreams",value:function(){if("undefined"===typeof window.RTCRtpSender||!window.RTCRtpSender.prototype.createEncodedStreams&&!window.RTCRtpSender.prototype.createEncodedVideoStreams)return!1;var e=new ReadableStream;try{return window.postMessage(e,"*",[e]),!0}catch(t){return!1}}},{key:"supportsAudioRed",value:function(){return Boolean(window.RTCRtpSender&&window.RTCRtpSender.getCapabilities&&window.RTCRtpSender.getCapabilities("audio").codecs.some((function(e){return"audio/red"===e.mimeType}))&&window.RTCRtpReceiver&&window.RTCRtpReceiver.getCapabilities&&window.RTCRtpReceiver.getCapabilities("audio").codecs.some((function(e){return"audio/red"===e.mimeType})))}},{key:"supportsUnifiedPlan",value:function(){return!this.isReactNative()}},{key:"supportsVADDetection",value:function(){return this.isChromiumBased()}},{key:"_getChromiumBasedVersion",value:function(){if(this.isChromiumBased()){if(this.isNWJS())return Number.parseInt(i.versions.chromium,10);var e=navigator.userAgent;if(e.match(/Chrome/))return Number.parseInt(e.match(/Chrome\/([\d.]+)/)[1],10)}return-1}}]),n}(c.a)}).call(this,"/index.js",n(178))},,function(e,t,n){"use strict";(function(e){var i=n(7),o=n(6),r=n(8),a=n(18),s=n(32),c=n(20),u=Object(a.getLogger)(e),l=function(){function e(){Object(o.a)(this,e),this.reset()}return Object(r.a)(e,[{key:"reset",value:function(){this.disposed=!1,this.analyticsHandlers=new Set,this.cache=[],this.permanentProperties={},this.conferenceName="",this.addPermanentProperties({user_agent:navigator.userAgent,browser_name:c.a.getName()})}},{key:"dispose",value:function(){u.warn("Disposing of analytics adapter."),this.analyticsHandlers&&this.analyticsHandlers.size>0&&this.analyticsHandlers.forEach((function(e){"function"===typeof e.dispose&&e.dispose()})),this.setAnalyticsHandlers([]),this.disposed=!0}},{key:"setAnalyticsHandlers",value:function(e){var t=this;if(!this.disposed){this.analyticsHandlers=new Set(e),this._setUserProperties();var n=this.cache;this.cache=null,n&&n.forEach((function(e){return t._sendEvent(e)}))}}},{key:"_setUserProperties",value:function(){var e=this;this.analyticsHandlers.forEach((function(t){try{t.setUserProperties(e.permanentProperties)}catch(n){u.warn("Error in setUserProperties method of one of the "+"analytics handlers: ".concat(n))}}))}},{key:"addPermanentProperties",value:function(e){this.permanentProperties=Object(i.a)(Object(i.a)({},this.permanentProperties),e),this._setUserProperties()}},{key:"setConferenceName",value:function(e){this.conferenceName=e,this.addPermanentProperties({conference_name:e})}},{key:"sendEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.disposed){var n=null;"string"===typeof e?n={type:s.t,action:e,actionSubject:e,source:e,attributes:t}:"object"===typeof e&&(n=e),this._verifyRequiredFields(n)?this._sendEvent(n):u.error("Dropping a mis-formatted event: ".concat(JSON.stringify(n)))}}},{key:"_verifyRequiredFields",value:function(e){if(!e)return!1;e.type||(e.type=s.t);var t=e.type;return t!==s.t&&t!==s.u&&t!==s.w&&t!==s.v?(u.error("Unknown event type: ".concat(t)),!1):t===s.u?Boolean(e.name):(e.action=e.action||e.name||e.actionSubject,e.actionSubject=e.actionSubject||e.name||e.action,e.source=e.source||e.name||e.action||e.actionSubject,e.action&&e.actionSubject&&e.source?!!(t!==s.v||(e.objectType=e.objectType||"generic-object-type",e.containerType=e.containerType||"conference","conference"!==e.containerType||e.containerId||(e.containerId=this.conferenceName),e.objectType&&e.objectId&&e.containerType&&e.containerId))||(u.error("Required field missing (containerId, containerType, objectId or objectType)"),!1):(u.error("Required field missing (action, actionSubject or source)"),!1))}},{key:"_maybeCacheEvent",value:function(e){return!!this.cache&&(this.cache.push(e),this.cache.length>100&&this.cache.splice(0,1),!0)}},{key:"_sendEvent",value:function(e){this._maybeCacheEvent(e)||this.analyticsHandlers.forEach((function(t){try{t.sendEvent(e)}catch(n){u.warn("Error sending analytics event: ".concat(n))}}))}}]),e}();t.a=new l}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return l}));var i=n(14),o=n(6),r=n(8),a=n(18),s=n(80),c=n(100),u=Object(a.getLogger)(e),l=function(){function e(t,n){Object(o.a)(this,e),this.eventEmitter=t,this.longTasks=0,this.maxDuration=0,this.performanceStatsInterval=n,this.stats=new c.a}return Object(r.a)(e,[{key:"getLongTasksStats",value:function(){return{avgRatePerMinute:(60*this.stats.getAverage()).toFixed(2),maxDurationMs:this.maxDuration}}},{key:"startObserver",value:function(){var e=this;this.longTaskEventHandler=function(t){var n,o=t.getEntries(),r=Object(i.a)(o);try{for(r.s();!(n=r.n()).done;){var a=n.value;e.longTasks++,e.maxDuration=Math.max(e.maxDuration,a.duration).toFixed(3)}}catch(s){r.e(s)}finally{r.f()}},u.info("Creating a Performance Observer for monitoring Long Tasks"),this.observer=new PerformanceObserver(this.longTaskEventHandler),this.observer.observe({type:"longtask",buffered:!0});var t=Date.now();this.longTasksIntervalId=setInterval((function(){var n=Date.now(),i=e._lastTimeStamp?(n-e._lastTimeStamp)/1e3:(n-t)/1e3,o=e.longTasks/i;e.stats.addNext(o),e.eventEmitter.emit(s.e,e.getLongTasksStats()),e.longTasks=0,e._lastTimeStamp=Date.now()}),this.performanceStatsInterval)}},{key:"stopObserver",value:function(){this.observer&&this.observer.disconnect(),this.longTaskEventHandler=null,this.longTasksIntervalId&&(clearInterval(this.longTasksIntervalId),this.longTasksIntervalId=null)}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return f}));var i=n(28),o=n(14),r=n(18),a=n(19),s=n(80),c=n(20),u=n(41),l=Object(r.getLogger)(e);function d(e,t){return!t||t<=0||!e||e<=0?0:Math.round(e/t*100)}function h(){this.loss={},this.bitrate={download:0,upload:0},this.resolution={},this.framerate=0,this.codec=""}function p(){this.bandwidth={},this.bitrate={},this.packetLoss=null,this.transport=[]}function f(e,t,n,i){this.peerconnection=e,this.baselineAudioLevelsReport=null,this.currentAudioLevelsReport=null,this.currentStatsReport=null,this.previousStatsReport=null,this.audioLevelReportHistory={},this.audioLevelsIntervalId=null,this.eventEmitter=i,this.conferenceStats=new p,this.audioLevelsIntervalMilis=t,this.speakerList=[],this.statsIntervalId=null,this.statsIntervalMilis=n,this.ssrc2stats=new Map}h.prototype.setLoss=function(e){this.loss=e||{}},h.prototype.setResolution=function(e){this.resolution=e||{}},h.prototype.addBitrate=function(e){this.bitrate.download+=e.download,this.bitrate.upload+=e.upload},h.prototype.resetBitrate=function(){this.bitrate.download=0,this.bitrate.upload=0},h.prototype.setFramerate=function(e){this.framerate=e||0},h.prototype.setCodec=function(e){this.codec=e||""},f.prototype.setSpeakerList=function(e){this.speakerList=e},f.prototype.stop=function(){this.audioLevelsIntervalId&&(clearInterval(this.audioLevelsIntervalId),this.audioLevelsIntervalId=null),this.statsIntervalId&&(clearInterval(this.statsIntervalId),this.statsIntervalId=null)},f.prototype.errorCallback=function(e){u.callErrorHandler(e),l.error("Get stats error",e),this.stop()},f.prototype.start=function(e){var t=this;e&&(c.a.supportsReceiverStats()&&l.info("Using RTCRtpSynchronizationSource for remote audio levels"),this.audioLevelsIntervalId=setInterval((function(){if(c.a.supportsReceiverStats()){var e=t.peerconnection.getAudioLevels(t.speakerList);for(var n in e)if(e.hasOwnProperty(n)){var i=2.5*e[n];t.eventEmitter.emit(s.a,t.peerconnection,Number.parseInt(n,10),i,!1)}}else t.peerconnection.getStats().then((function(e){t.currentAudioLevelsReport="function"===typeof(null===e||void 0===e?void 0:e.result)?e.result():e,t.processAudioLevelReport(),t.baselineAudioLevelsReport=t.currentAudioLevelsReport})).catch((function(e){return t.errorCallback(e)}))}),this.audioLevelsIntervalMilis));var n=function(){t.peerconnection.getStats().then((function(e){t.currentStatsReport="function"===typeof(null===e||void 0===e?void 0:e.result)?e.result():e;try{t.processStatsReport()}catch(n){u.callErrorHandler(n),l.error("Processing of RTP stats failed:",n)}t.previousStatsReport=t.currentStatsReport})).catch((function(e){return t.errorCallback(e)}))};n(),this.statsIntervalId=setInterval(n,this.statsIntervalMilis)},f.prototype._processAndEmitReport=function(){var e,t,n,r=this,a={download:0,upload:0},c={download:0,upload:0},u=0,h=0,p={},f={},m={},v=0,g=0,b=0,y=0,A=Object(o.a)(this.ssrc2stats);try{for(A.s();!(n=A.n()).done;){var E=Object(i.a)(n.value,2),O=E[0],S=E[1],C=S.loss,_=C.isDownloadStream?"download":"upload";a[_]+=C.packetsTotal,c[_]+=C.packetsLost,u+=S.bitrate.download,h+=S.bitrate.upload;var j=this.peerconnection.getTrackBySSRC(O);if(j){j.isAudioTrack()?(v+=S.bitrate.download,g+=S.bitrate.upload,e=S.codec):(b+=S.bitrate.download,y+=S.bitrate.upload,t=S.codec);var T=j.getParticipantId();if(T){var k=S.resolution;if(k.width&&k.height&&-1!==k.width&&-1!==k.height){var I=p[T]||{};I[O]=k,p[T]=I}if(0!==S.framerate){var R=f[T]||{};R[O]=S.framerate,f[T]=R}if(e&&t){var w={audio:e,video:t},D=m[T]||{};D[O]=w,m[T]=D}}else l.error("No participant ID returned by ".concat(j))}S.resetBitrate()}}catch(M){A.e(M)}finally{A.f()}this.conferenceStats.bitrate={upload:h,download:u},this.conferenceStats.bitrate.audio={upload:g,download:v},this.conferenceStats.bitrate.video={upload:y,download:b},this.conferenceStats.packetLoss={total:d(c.download+c.upload,a.download+a.upload),download:d(c.download,a.download),upload:d(c.upload,a.upload)};var N,P={};Object.keys(this.audioLevelReportHistory).forEach((function(e){var t=r.audioLevelReportHistory[e],n=t.data,i=t.isLocal,o=n.reduce((function(e,t){return e+t}))/n.length;if(i)N=o;else{var a=r.peerconnection.getTrackBySSRC(Number(e));if(a){var s=a.getParticipantId();s&&(P[s]=o)}}})),this.audioLevelReportHistory={},this.eventEmitter.emit(s.d,this.peerconnection,{bandwidth:this.conferenceStats.bandwidth,bitrate:this.conferenceStats.bitrate,packetLoss:this.conferenceStats.packetLoss,resolution:p,framerate:f,codec:m,transport:this.conferenceStats.transport,localAvgAudioLevels:N,avgAudioLevels:P}),this.conferenceStats.transport=[]},f.prototype.getNonNegativeValue=function(e){var t=e;return"number"!==typeof t&&(t=Number(t)),isNaN(t)?0:Math.max(0,t)},f.prototype._calculateBitrate=function(e,t,n){var i=this.getNonNegativeValue(e[n]),o=this.getNonNegativeValue(t[n]),r=Math.max(0,i-o),a=e.timestamp-t.timestamp,s=0;return a>0&&(s=Math.round(8*r/a)),s},f.prototype.processStatsReport=function(){var e=this;if(this.previousStatsReport){var t={};this.currentStatsReport.forEach((function(n){if("candidate-pair"===n.type&&n.nominated&&"succeeded"===n.state){var i=n.availableIncomingBitrate,o=n.availableOutgoingBitrate;(i||o)&&(e.conferenceStats.bandwidth={download:Math.round(i/1e3),upload:Math.round(o/1e3)});var r=e.currentStatsReport.get(n.remoteCandidateId),s=e.currentStatsReport.get(n.localCandidateId);if(r&&s){var u=c.a.isChromiumBased()?r.ip:r.address,l=r.port,d="".concat(u,":").concat(l),p=c.a.isChromiumBased()?s.ip:s.address,f=s.port,m="".concat(p,":").concat(f),v=r.protocol,g=e.conferenceStats.transport;g.some((function(e){return e.ip===d&&e.type===v&&e.localip===m}))||g.push({ip:d,type:v,localip:m,p2p:e.peerconnection.isP2P,localCandidateType:s.candidateType,remoteCandidateType:r.candidateType,networkType:s.networkType,rtt:1e3*n.currentRoundTripTime})}}else if("inbound-rtp"===n.type||"outbound-rtp"===n.type){var b=e.previousStatsReport.get(n.id),y=e.getNonNegativeValue(n.ssrc);if(!b||!y)return;var A=e.ssrc2stats.get(y);A||(A=new h,e.ssrc2stats.set(y,A));var E=!0,O="packetsReceived";"outbound-rtp"===n.type&&(E=!1,O="packetsSent");var S=n[O];(!S||S<0)&&(S=0);var C=e.getNonNegativeValue(b[O]),_=Math.max(0,S-C),j=e.getNonNegativeValue(n.packetsLost),T=e.getNonNegativeValue(b.packetsLost),k=Math.max(0,j-T);if(A.setLoss({packetsTotal:_+k,packetsLost:k,isDownloadStream:E}),"inbound-rtp"===n.type){var I={height:n.frameHeight,width:n.frameWidth},R=n.framesPerSecond;I.height&&I.width&&A.setResolution(I),A.setFramerate(Math.round(R||0)),A.addBitrate({download:e._calculateBitrate(n,b,"bytesReceived"),upload:0})}else t[y]=e.getNonNegativeValue(n.bytesSent),A.addBitrate({download:0,upload:e._calculateBitrate(n,b,"bytesSent")});var w=e.currentStatsReport.get(n.codecId);if(w){var D=w.mimeType.split("/")[1];D&&A.setCodec(D)}}else if("track"===n.type&&n.kind===a.c&&!n.remoteSource){var N={height:n.frameHeight,width:n.frameWidth},P=e.peerconnection.getLocalTracks(a.c);if(null===P||void 0===P||!P.length)return;var M=e.peerconnection.getLocalSSRC(P[0]);if(!M)return;var L=e.ssrc2stats.get(M);L||(L=new h,e.ssrc2stats.set(M,L)),N.height&&N.width&&L.setResolution(N);var x=n.framesPerSecond;if(!x){var F=e.previousStatsReport.get(n.id);if(F){var B=n.timestamp-F.timestamp;if(B>0&&n.framesSent)x=(n.framesSent-F.framesSent)/B*1e3}if(!x)return}var U=e.peerconnection.getActiveSimulcastStreams();x=U?Math.round(x/U):0,L.setFramerate(x)}})),this.eventEmitter.emit(s.c,this.peerconnection,t),this._processAndEmitReport()}},f.prototype.processAudioLevelReport=function(){var e=this;this.baselineAudioLevelsReport&&this.currentAudioLevelsReport.forEach((function(t){if("track"===t.type){var n=t.audioLevel;if(n){var i=t.trackIdentifier,o=e.peerconnection.getSsrcByTrackId(i);if(o){var r=o===e.peerconnection.getLocalSSRC(e.peerconnection.getLocalTracks(a.a));e.eventEmitter.emit(s.a,e.peerconnection,o,n,r)}}}}))}}).call(this,"/index.js")},function(e,t){function n(e,t){if(!e||!t||"function"!==typeof e.addListener||"function"!==typeof t.emit)throw new Error("Invalid arguments passed to EventEmitterForwarder");this.src=e,this.dest=t}n.prototype.forward=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t[0];t[0]=this.dest,this.src.addListener(i,Function.prototype.bind.apply(this.dest.emit,t))},e.exports=n},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var i=n(6),o=n(8),r=n(13),a=n(10),s=n(167),c=n(19),u=function(){function e(t,n,o,a,c,u,l){Object(i.a)(this,e),this._jid=t,this._id=r.Strophe.getResourceFromJid(t),this._conference=n,this._displayName=o,this._supportsDTMF=!1,this._tracks=[],this._role="none",this._status=u,this._hidden=a,this._statsID=c,this._connectionStatus=s.a.ACTIVE,this._properties={},this._identity=l,this._features=new Set}return Object(o.a)(e,[{key:"getConference",value:function(){return this._conference}},{key:"getProperty",value:function(e){return this._properties[e]}},{key:"hasAnyVideoTrackWebRTCMuted",value:function(){return this.getTracks().some((function(e){return e.getType()===c.c&&e.isWebRTCTrackMuted()}))}},{key:"_setConnectionStatus",value:function(e){this._connectionStatus=e}},{key:"getConnectionStatus",value:function(){return this._connectionStatus}},{key:"setProperty",value:function(e,t){var n=this._properties[e];t!==n&&(this._properties[e]=t,this._conference.eventEmitter.emit(a.PARTICIPANT_PROPERTY_CHANGED,this,e,n,t))}},{key:"getTracks",value:function(){return this._tracks.slice()}},{key:"getTracksByMediaType",value:function(e){return this.getTracks().filter((function(t){return t.getType()===e}))}},{key:"getId",value:function(){return this._id}},{key:"getJid",value:function(){return this._jid}},{key:"getDisplayName",value:function(){return this._displayName}},{key:"getStatsID",value:function(){return this._statsID}},{key:"getStatus",value:function(){return this._status}},{key:"isModerator",value:function(){return"moderator"===this._role}},{key:"isHidden",value:function(){return this._hidden}},{key:"isAudioMuted",value:function(){return this._isMediaTypeMuted(c.a)}},{key:"_isMediaTypeMuted",value:function(e){return this.getTracks().reduce((function(t,n){return t&&(n.getType()!==e||n.isMuted())}),!0)}},{key:"isVideoMuted",value:function(){return this._isMediaTypeMuted(c.c)}},{key:"getRole",value:function(){return this._role}},{key:"setRole",value:function(e){this._role=e}},{key:"supportsDTMF",value:function(){return this._supportsDTMF}},{key:"getFeatures",value:function(){return Promise.resolve(this._features)}},{key:"hasFeature",value:function(e){return this._features.has(e)}},{key:"setFeatures",value:function(e){this._features=e||new Set}},{key:"getBotType",value:function(){return this._botType}},{key:"setBotType",value:function(e){this._botType=e}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(79),o=n(76);function r(e){var t,n=this,r=e.id,a=e.password,s=e.onCreateResource,c=e.onLoginSuccessful,u=e.roomPassword,l=!1,d=new o.e(this.connection.options),h=new Promise((function(e,o){t=o,d.addListener(i.CONNECTION_DISCONNECTED,(function(){d=void 0})),d.addListener(i.CONNECTION_ESTABLISHED,(function(){l||(c&&c(),d.createRoom(n.options.name,n.options.config,s).moderator.authenticate().then((function(){d&&d.disconnect(),l||(n.join(u),e())})).catch((function(e){var t=e.error,n=e.message;d.disconnect(),o({authenticationError:t,message:n})})))})),d.addListener(i.CONNECTION_FAILED,(function(e,t,n){o({connectionError:e,credentials:n,message:t}),d=void 0})),l||d.connect(r,a)}));return h.cancel=function(){l=!0,t({}),d&&d.disconnect()},h}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return c}));var i=n(6),o=n(8),r=n(18),a=Object(r.getLogger)(e),s=Symbol("kJitsiE2EE"),c=function(){function e(){Object(i.a)(this,e);var t="",n=document.querySelector('script[src*="lib-jitsi-meet"]');if(n){var o=n.src.lastIndexOf("/");t="".concat(n.src.substring(0,o),"/")}var r="".concat(t,"lib-jitsi-meet.e2ee-worker.js"),s=new Blob(['importScripts("'.concat(r,'");')],{type:"application/javascript"}),c=window.URL.createObjectURL(s);this._worker=new Worker(c,{name:"E2EE Worker"}),this._worker.onerror=function(e){return a.onerror(e)}}return Object(o.a)(e,[{key:"cleanup",value:function(e){this._worker.postMessage({operation:"cleanup",participantId:e})}},{key:"handleReceiver",value:function(e,t,n){var i;e[s]||(e[s]=!0,i=e.createEncodedStreams?e.createEncodedStreams():"video"===t?e.createEncodedVideoStreams():e.createEncodedAudioStreams(),this._worker.postMessage({operation:"decode",readableStream:i.readable||i.readableStream,writableStream:i.writable||i.writableStream,participantId:n},[i.readable||i.readableStream,i.writable||i.writableStream]))}},{key:"handleSender",value:function(e,t,n){var i;e[s]||(e[s]=!0,i=e.createEncodedStreams?e.createEncodedStreams():"video"===t?e.createEncodedVideoStreams():e.createEncodedAudioStreams(),this._worker.postMessage({operation:"encode",readableStream:i.readable||i.readableStream,writableStream:i.writable||i.writableStream,participantId:n},[i.readable||i.readableStream,i.writable||i.writableStream]))}},{key:"setKey",value:function(e,t,n){this._worker.postMessage({operation:"setKey",participantId:e,key:t,keyIndex:n})}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u}));var i=n(6),o=n(8),r=n(18),a=n(171),s=n(348),c=Object(r.getLogger)(e),u=function(){function e(t){Object(i.a)(this,e),this._stropheConn=t,this._resumeRetryN=0,this._retryDelay=void 0}return Object(o.a)(e,[{key:"retryDelay",get:function(){return this._retryDelay}},{key:"schedule",value:function(){var e=this;this._cancelResume(),this._resumeRetryN+=1,this._networkOnlineListener=a.b.addEventListener(a.a,(function(t){t.isOnline?e._scheduleResume():e._cancelResume()})),a.b.isOnline()&&this._scheduleResume()}},{key:"_scheduleResume",value:function(){var e=this;this._resumeTimeout||(this._resumeRetryN=Math.min(3,this._resumeRetryN),this._retryDelay=Object(s.a)(this._resumeRetryN,1500*this._resumeRetryN,3),c.info("Will try to resume the XMPP connection in ".concat(this.retryDelay,"ms")),this._resumeTimeout=setTimeout((function(){return e._resumeConnection()}),this.retryDelay))}},{key:"_cancelResume",value:function(){this._resumeTimeout&&(c.info("Canceling connection resume task"),clearTimeout(this._resumeTimeout),this._resumeTimeout=void 0,this._retryDelay=void 0)}},{key:"_resumeConnection",value:function(){var e=this._stropheConn.streamManagement,t=e.getResumeToken();if(t){c.info("Trying to resume the XMPP connection");var n=new URL(this._stropheConn.service),i=n.search,o=/(previd=)([\w-]+)/,r=i.match(o);r&&-1===r.indexOf(t)?i=i.replace(o,"$1".concat(t)):r||(i+=-1===i.indexOf("?")?"?previd=".concat(t):"&previd=".concat(t)),n.search=i,this._stropheConn.service=n.toString(),e.resume()}}},{key:"cancel",value:function(){this._cancelResume(),this._resumeRetryN=0,this._networkOnlineListener&&(this._networkOnlineListener(),this._networkOnlineListener=null)}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return Math.floor(Math.random()*(1e3*Math.pow(n,e)-t)+t)}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(6),o=n(8),r=function(){function e(){Object(i.a)(this,e),this._lastSuccess=null,this._lastFailedMessage=null}return Object(o.a)(e,[{key:"startTracking",value:function(e,t){var n=this,i=t.rawInput;t.rawInput=function(){for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];var s=r[0];s.includes("failure")&&(n._lastFailedMessage=s),e.connected&&(n._lastSuccess=Date.now()),i.apply(t,r)}}},{key:"getLastFailedMessage",value:function(){return this._lastFailedMessage}},{key:"getTimeSinceLastSuccess",value:function(){return this._lastSuccess?Date.now()-this._lastSuccess:null}}]),e}()},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return m}));var i=n(6),o=n(8),r=n(103),a=n(84),s=n(35),c=n(34),u=n(18),l=n(13),d=n(41),h=n.n(d),p=n(121),f=Object(u.getLogger)(e),m=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e){var o,r=e.getTimeSinceLastServerResponse,a=e.onPingThresholdExceeded,s=e.pingOptions,c=void 0===s?{}:s;return Object(i.a)(this,n),(o=t.call(this)).failedPings=0,o._onPingThresholdExceeded=a,o._getTimeSinceLastServerResponse=r,o.pingInterval="number"===typeof c.interval?c.interval:1e4,o.pingTimeout="number"===typeof c.timeout?c.timeout:5e3,o.pingThreshold="number"===typeof c.threshold?c.threshold:2,o.pingTimestampsToKeep=Math.round(12e4/o.pingInterval),o.pingExecIntervals=new Array(o.pingTimestampsToKeep),o}return Object(o.a)(n,[{key:"init",value:function(e){Object(r.a)(Object(a.a)(n.prototype),"init",this).call(this,e),l.Strophe.addNamespace("PING","urn:xmpp:ping")}},{key:"ping",value:function(e,t,n,i){this._addPingExecutionTimestamp();var o=Object(l.$iq)({type:"get",to:e});o.c("ping",{xmlns:l.Strophe.NS.PING}),this.connection.sendIQ2(o,{timeout:i}).then(t,n)}},{key:"startInterval",value:function(e){var t=this;clearInterval(this.intervalId),this.intervalId=window.setInterval((function(){var n=Date.now();if(t._getTimeSinceLastServerResponse()<n-t._lastServerCheck)return t._addPingExecutionTimestamp(),t._lastServerCheck=n,void(t.failedPings=0);t.ping(e,(function(){t._lastServerCheck=t._getTimeSinceLastServerResponse()+Date.now(),t.failedPings=0}),(function(e){t.failedPings+=1;var n="Ping ".concat(e?"error":"timeout");t.failedPings>=t.pingThreshold?(h.a.callErrorHandler(new Error(n)),f.error(n,e),t._onPingThresholdExceeded&&t._onPingThresholdExceeded()):f.warn(n,e)}),t.pingTimeout)}),this.pingInterval),f.info("XMPP pings will be sent every ".concat(this.pingInterval," ms"))}},{key:"stopInterval",value:function(){this.intervalId&&(window.clearInterval(this.intervalId),this.intervalId=null,this.failedPings=0,f.info("Ping interval cleared"))}},{key:"_addPingExecutionTimestamp",value:function(){this.pingExecIntervals.push((new Date).getTime()),this.pingExecIntervals.length>this.pingTimestampsToKeep&&this.pingExecIntervals.shift()}},{key:"getPingSuspendTime",value:function(){var e=this.pingExecIntervals.slice();e.push((new Date).getTime());var t=0,n=e[0];return e.forEach((function(e){var i=e-n;i>t&&(t=i),n=e})),t-=this.pingInterval,Math.max(t,0)}}]),n}(p.b)}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return v}));var i=n(6),o=n(8),r=n(103),a=n(84),s=n(35),c=n(34),u=n(18),l=n(13),d=n(9),h=n.n(d),p=n(352),f=n(121),m=Object(u.getLogger)(e),v=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e){var o;return Object(i.a)(this,n),(o=t.call(this)).xmpp=e,o.rooms={},o}return Object(o.a)(n,[{key:"init",value:function(e){Object(r.a)(Object(a.a)(n.prototype),"init",this).call(this,e),this.connection.addHandler(this.onPresence.bind(this),null,"presence",null,null,null,null),this.connection.addHandler(this.onPresenceUnavailable.bind(this),null,"presence","unavailable",null),this.connection.addHandler(this.onPresenceError.bind(this),null,"presence","error",null),this.connection.addHandler(this.onMessage.bind(this),null,"message",null,null),this.connection.addHandler(this.onMute.bind(this),"http://jitsi.org/jitmeet/audio","iq","set",null,null),this.connection.addHandler(this.onMuteVideo.bind(this),"http://jitsi.org/jitmeet/video","iq","set",null,null)}},{key:"createRoom",value:function(e,t,n){var i=l.Strophe.getBareJidFromJid(e);if(this.rooms[i]){var o="You are already in the room!";throw m.error(o),new Error(o)}return this.rooms[i]=new p.a(this.connection,e,t,this.xmpp,n),this.eventEmitter.emit(h.a.EMUC_ROOM_ADDED,this.rooms[i]),this.rooms[i]}},{key:"doLeave",value:function(e){this.eventEmitter.emit(h.a.EMUC_ROOM_REMOVED,this.rooms[e]),delete this.rooms[e]}},{key:"onPresence",value:function(e){var t=e.getAttribute("from");if(e.getAttribute("type"))return!0;var n=this.rooms[l.Strophe.getBareJidFromJid(t)];return!n||($(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>status[code="201"]').length&&n.createNonAnonymousRoom(),n.onPresence(e),!0)}},{key:"onPresenceUnavailable",value:function(e){var t=e.getAttribute("from"),n=this.rooms[l.Strophe.getBareJidFromJid(t)];return!n||(n.onPresenceUnavailable(e,t),!0)}},{key:"onPresenceError",value:function(e){var t=e.getAttribute("from"),n=this.rooms[l.Strophe.getBareJidFromJid(t)];return!n||(n.onPresenceError(e,t),!0)}},{key:"onMessage",value:function(e){var t=e.getAttribute("from"),n=this.rooms[l.Strophe.getBareJidFromJid(t)];return!n||(n.onMessage(e,t),!0)}},{key:"onMute",value:function(e){var t=e.getAttribute("from"),n=this.rooms[l.Strophe.getBareJidFromJid(t)];return!n||(n.onMute(e),!0)}},{key:"onMuteVideo",value:function(e){var t=e.getAttribute("from"),n=this.rooms[l.Strophe.getBareJidFromJid(t)];return!n||(n.onMuteVideo(e),!0)}}]),n}(f.a)}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return T}));var i=n(6),o=n(8),r=n(25),a=n(35),s=n(34),c=n(18),u=n(105),l=n.n(u),d=n(13),h=n(217),p=n(19),f=n(9),m=n.n(f),v=n(41),g=n.n(v),b=n(72),y=n(353),A=n(354),E=n(129),O=n(355),S=Object(c.getLogger)(e),C={packet2JSON:function(e,t){for(var n=0,i=Array.from(e.children);n<i.length;n++){for(var o=i[n],r={attributes:{},children:[],tagName:o.tagName},a=0,s=Array.from(o.attributes);a<s.length;a++){var c=s[a];r.attributes[c.name]=c.value}var u=d.Strophe.getText(o);u&&(r.value=d.Strophe.xmlunescape(u)),t.push(r),this.packet2JSON(o,r.children)}},json2packet:function(e,t){for(var n=0;n<e.length;n++){var i=e[n];i&&(t.c(i.tagName,i.attributes),i.value&&t.t(i.value),i.children&&this.json2packet(i.children,t),t.up())}}};function _(e,t){for(var n=[],i=0;i<e.length;i++)e[i].tagName===t&&n.push(e[i]);return n}var j=["owner","admin","member"],T=function(e){Object(a.a)(n,e);var t=Object(s.a)(n);function n(e,o,a,s,c){var u;return Object(i.a)(this,n),(u=t.call(this)).xmpp=s,u.connection=e,u.roomjid=d.Strophe.getBareJidFromJid(o),u.myroomjid=o,u.password=a,S.info("Joined MUC as ".concat(u.myroomjid)),u.members={},u.presMap={},u.presHandlers={},u._removeConnListeners=[],u.joined=!1,u.role=null,u.focusMucJid=null,u.noBridgeAvailable=!1,u.options=c||{},u.moderator=new O.a(u.roomjid,u.xmpp,u.eventEmitter,{connection:u.xmpp.options,conference:u.options}),("undefined"===typeof u.options.enableLobby||u.options.enableLobby)&&(u.lobby=new A.a(Object(r.a)(u))),u.avModeration=new y.a(Object(r.a)(u)),u.initPresenceMap(c),u.lastPresences={},u.phoneNumber=null,u.phonePin=null,u.connectionTimes={},u.participantPropertyListener=null,u.locked=!1,u.transcriptionStatus=h.OFF,u}return Object(o.a)(n,[{key:"initPresenceMap",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.presMap.to=this.myroomjid,this.presMap.xns="http://jabber.org/protocol/muc",this.presMap.nodes=[],e.statsId&&this.presMap.nodes.push({tagName:"stats-id",value:e.statsId}),e.deploymentInfo&&e.deploymentInfo.userRegion&&this.presMap.nodes.push({tagName:"region",attributes:{id:e.deploymentInfo.userRegion,xmlns:"http://jitsi.org/jitsi-meet"}}),this.presenceUpdateTime=Date.now()}},{key:"join",value:function(e){var t=this;return this.password=e,new Promise((function(e){t.options.disableFocus&&S.info("Conference focus disabled for ".concat(t.roomjid)),(t.options.disableFocus?Promise.resolve():t.moderator.allocateConferenceFocus()).then((function(){t.sendPresence(!0),t._removeConnListeners.push(t.connection.addEventListener(E.a.Events.CONN_STATUS_CHANGED,t.onConnStatusChanged.bind(t))),e()}))}))}},{key:"sendPresence",value:function(e){var t=this.presMap.to;if(this.connection&&this.connection.connected&&t&&(this.joined||e)){var n=Object(d.$pres)({to:t});e&&(n.c("x",{xmlns:this.presMap.xns}),this.password&&n.c("password").t(this.password).up(),this.options.billingId&&n.c("billingid").t(this.options.billingId).up(),n.up()),C.json2packet(this.presMap.nodes,n),this.presenceSyncTime=Date.now(),this.connection.send(n),e&&this.connection.flush()}}},{key:"doLeave",value:function(){S.log("do leave",this.myroomjid);var e=Object(d.$pres)({to:this.myroomjid,type:"unavailable"});this.presMap.length=0,!this.connection.isUsingWebSocket&&this.connection.flush(),this.connection.send(e),this.connection.flush()}},{key:"discoRoomInfo",value:function(){var e=this,t=Object(d.$iq)({type:"get",to:this.roomjid}).c("query",{xmlns:d.Strophe.NS.DISCO_INFO});this.connection.sendIQ(t,(function(t){var n=1===$(t).find('>query>feature[var="muc_passwordprotected"]').length;n!==e.locked&&(e.eventEmitter.emit(m.a.MUC_LOCK_CHANGED,n),e.locked=n);var i=$(t).find('>query>x[type="result"]>field[var="muc#roominfo_meetingId"]>value');i.length?e.setMeetingId(i.text()):S.warn("No meeting ID from backend");var o=1===$(t).find('>query>feature[var="muc_membersonly"]').length,r=$(t).find('>query>x[type="result"]>field[var="muc#roominfo_lobbyroom"]>value');e.lobby&&e.lobby.setLobbyRoomJid(r&&r.length?r.text():void 0),o!==e.membersOnlyEnabled&&(e.membersOnlyEnabled=o,e.eventEmitter.emit(m.a.MUC_MEMBERS_ONLY_CHANGED,o))}),(function(e){g.a.callErrorHandler(e),S.error("Error getting room info: ",e)}))}},{key:"setMeetingId",value:function(e){this.meetingId!==e&&(this.meetingId&&S.warn("Meeting Id changed from:".concat(this.meetingId," to:").concat(e)),this.meetingId=e,this.eventEmitter.emit(m.a.MEETING_ID_SET,e))}},{key:"createNonAnonymousRoom",value:function(){var e=this;if(!this.options.disableDiscoInfo){var t=Object(d.$iq)({type:"get",to:this.roomjid}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}).c("x",{xmlns:"jabber:x:data",type:"submit"});this.connection.sendIQ(t,(function(t){if(!$(t).find('>query>x[xmlns="jabber:x:data"]>field[var="muc#roomconfig_whois"]').length){var n="non-anonymous rooms not supported";return g.a.callErrorHandler(new Error(n)),void S.error(n)}var i=Object(d.$iq)({to:e.roomjid,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"});i.c("x",{xmlns:"jabber:x:data",type:"submit"}),i.c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up(),i.c("field",{var:"muc#roomconfig_whois"}).c("value").t("anyone").up().up(),e.connection.sendIQ(i)}),(function(e){g.a.callErrorHandler(e),S.error("Error getting room configuration form: ",e)}))}}},{key:"onConnStatusChanged",value:function(e){e===E.a.Status.CONNECTED&&this.sendPresence()}},{key:"onPresence",value:function(e){var t=e.getAttribute("from"),n={},i=e.getElementsByTagName("status")[0];i&&(n.status=i.textContent||"");var o=!1,r=!1,a=e.getElementsByTagNameNS("http://jabber.org/protocol/muc#user","x")[0],s=a&&a.getElementsByTagName("item")[0];n.affiliation=s&&s.getAttribute("affiliation"),n.role=s&&s.getAttribute("role");var c=s&&s.getAttribute("jid");n.jid=c,n.isFocus=c&&0===c.indexOf("".concat(this.moderator.getFocusUserJid(),"/")),n.isHiddenDomain=c&&c.indexOf("@")>0&&this.options.hiddenDomain===c.substring(c.indexOf("@")+1,c.indexOf("/")),this.eventEmitter.emit(m.a.PRESENCE_RECEIVED,{fromHiddenDomain:n.isHiddenDomain,presence:e});var u=e.querySelector("x");u&&u.remove();var h=[];C.packet2JSON(e,h),this.lastPresences[t]=h;for(var p=function(e){var t={},n=e.children.find((function(e){return"user"===e.tagName}));if(n){t.user={};for(var i=function(){var e=r[o],i=n.children.find((function(t){return t.tagName===e}));i&&(t.user[e]=i.value)},o=0,r=["id","name","avatar"];o<r.length;o++)i()}var a=e.children.find((function(e){return"group"===e.tagName}));return a&&(t.group=a.value),t},f=0;f<h.length;f++){var v=h[f];switch(v.tagName){case"bot":var g=v.attributes;if(!g)break;var b=g.type;n.botType=b;break;case"nick":n.nick=v.value;break;case"userId":n.id=v.value;break;case"stats-id":n.statsID=v.value;break;case"identity":n.identity=p(v);break;case"features":n.features=this._extractFeatures(v);break;case"stat":var y=v.attributes;if(!y)break;"version"===y.name&&(n.version=y.value)}}if(t===this.myroomjid){var A="owner"===n.affiliation?n.role:"none";if(this.role!==A&&(this.role=A,this.eventEmitter.emit(m.a.LOCAL_ROLE_CHANGED,this.role)),!this.joined){this.joined=!0;var E=this.connectionTimes["muc.joined"]=window.performance.now();S.log("(TIME) MUC joined:\t",E),this.password&&(this.locked=!0),this.presenceUpdateTime>=this.presenceSyncTime&&this.sendPresence(),this.eventEmitter.emit(m.a.MUC_JOINED),!this.options.disableDiscoInfo&&this.discoRoomInfo()}}else if(void 0===c)S.info("Ignoring member with undefined JID");else if(void 0===this.members[t])this.members[t]=n,S.log("entered",t,n),o=void 0!==n.status,r=void 0!==n.version,n.isFocus?this._initFocus(t,n.features):(this.eventEmitter.emit(m.a.MUC_MEMBER_JOINED,t,n.nick,n.role,n.isHiddenDomain,n.statsID,n.status,n.identity,n.botType,n.jid,n.features),o=!1);else{var O=this.members[t];O.role!==n.role&&(O.role=n.role,this.eventEmitter.emit(m.a.MUC_ROLE_CHANGED,t,n.role)),O.affiliation!==n.affiliation&&(O.affiliation=n.affiliation),O.botType!==n.botType&&(O.botType=n.botType,this.eventEmitter.emit(m.a.MUC_MEMBER_BOT_TYPE_CHANGED,t,n.botType)),n.isFocus&&(O.isFocus=!0,this._initFocus(t,n.features)),n.displayName&&(O.displayName=n.displayName),O.status!==n.status&&(o=!0,O.status=n.status),O.version!==n.version&&(r=!0,O.version=n.version),l()(O.features,n.features)||(O.features=n.features,this.eventEmitter.emit(m.a.PARTICIPANT_FEATURES_CHANGED,t,n.features))}for(var _=0;_<h.length;_++){var j=h[_];switch(j.tagName){case"nick":if(!n.isFocus){var T=this.xmpp.options.displayJids?d.Strophe.getResourceFromJid(t):n.nick;this.eventEmitter.emit(m.a.DISPLAY_NAME_CHANGED,t,T)}break;case"bridgeNotAvailable":n.isFocus&&!this.noBridgeAvailable&&(this.noBridgeAvailable=!0,this.eventEmitter.emit(m.a.BRIDGE_DOWN));break;case"conference-properties":if(n.isFocus){for(var k={},I=0;I<j.children.length;I++){var R=j.children[I].attributes;R&&R.key&&(k[R.key]=R.value)}this.eventEmitter.emit(m.a.CONFERENCE_PROPERTIES_CHANGED,k),this.restartByTerminateSupported="true"===k["support-terminate-restart"],S.info("Jicofo supports restart by terminate: ".concat(this.supportsRestartByTerminate()))}break;case"transcription-status":var w=j.attributes;if(!w)break;var D=w.status;D&&D!==this.transcriptionStatus&&(this.transcriptionStatus=D,this.eventEmitter.emit(m.a.TRANSCRIPTION_STATUS_CHANGED,D));break;case"call-control":var N=j.attributes;if(!N)break;this.phoneNumber=N.phone||null,this.phonePin=N.pin||null,this.eventEmitter.emit(m.a.PHONE_NUMBER_CHANGED);break;default:this.processNode(j,t)}}o&&this.eventEmitter.emit(m.a.PRESENCE_STATUS,t,n.status),r&&S.info("Received version for ".concat(c,": ").concat(n.version))}},{key:"_extractFeatures",value:function(e){for(var t=new Set,n=0;n<e.children.length;n++){var i=e.children[n].attributes;i&&i.var&&t.add(i.var)}return t}},{key:"_initFocus",value:function(e,t){this.focusMucJid=e,this.focusFeatures=t}},{key:"setParticipantPropertyListener",value:function(e){this.participantPropertyListener=e}},{key:"supportsRestartByTerminate",value:function(){return this.restartByTerminateSupported}},{key:"processNode",value:function(e,t){try{var n=this.presHandlers[e.tagName];e.tagName.startsWith("jitsi_participant_")&&(n=[this.participantPropertyListener]),n&&n.forEach((function(n){n(e,d.Strophe.getResourceFromJid(t),t)}))}catch(i){g.a.callErrorHandler(i),S.error("Error processing:".concat(e.tagName," node."),i)}}},{key:"sendMessage",value:function(e,t){var n=Object(d.$msg)({to:this.roomjid,type:"groupchat"});"body"===t?n.c(t,{},e):n.c(t,{xmlns:"http://jitsi.org/jitmeet"},e),this.connection.send(n),this.eventEmitter.emit(m.a.SENDING_CHAT_MESSAGE,e)}},{key:"sendPrivateMessage",value:function(e,t,n){var i=Object(d.$msg)({to:"".concat(this.roomjid,"/").concat(e),type:"chat"});"body"===n?i.c(n,t).up():i.c(n,{xmlns:"http://jitsi.org/jitmeet"},t).up(),this.connection.send(i),this.eventEmitter.emit(m.a.SENDING_PRIVATE_CHAT_MESSAGE,t)}},{key:"setSubject",value:function(e){var t=Object(d.$msg)({to:this.roomjid,type:"groupchat"});t.c("subject",e),this.connection.send(t)}},{key:"onParticipantLeft",value:function(e,t){delete this.lastPresences[e],t||(this.eventEmitter.emit(m.a.MUC_MEMBER_LEFT,e),this.moderator.onMucMemberLeft(e))}},{key:"onPresenceUnavailable",value:function(e,t){var n=this;if($(e).find('>ignore[xmlns="http://jitsi.org/jitmeet/"]').length)return!0;var i=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>destroy');if(i.length){var o,r=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>destroy>reason');return r.length&&(o=r.text()),this.eventEmitter.emit(m.a.MUC_DESTROYED,o,i.attr("jid")),this.connection.emuc.doLeave(this.roomjid),!0}var a=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>status[code="110"]').length,s=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>status[code="307"]').length,c=Object.keys(this.members);if(s){var u,l,h=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>item>actor');h.length&&(u=h.attr("nick"));var p=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>item>reason');p.length&&(l=p.text()),this.eventEmitter.emit(m.a.KICKED,a,u,d.Strophe.getResourceFromJid(t),l)}a?(c.forEach((function(e){var t=n.members[e];delete n.members[e],n.onParticipantLeft(e,t.isFocus)})),this.connection.emuc.doLeave(this.roomjid),s||this.eventEmitter.emit(m.a.MUC_LEFT)):(delete this.members[t],this.onParticipantLeft(t,!1))}},{key:"onMessage",value:function(e,t){var n=e.getAttribute("type");if("error"===n){var i=$(e).find(">error>text").text();return this.eventEmitter.emit(m.a.CHAT_ERROR_RECEIVED,i),!0}var o=$(e).find(">body").text(),r=$(e).find(">subject");if(r.length){var a=r.text();(a||""===a)&&(this.eventEmitter.emit(m.a.SUBJECT_CHANGED,a),S.log("Subject is changed to ".concat(a)))}var s,c=$(e).find(">delay").attr("stamp");if(!c&&(c=$(e).find('>[xmlns="jabber:x:delay"]').attr("stamp"))){var u=c.match(/(\d{4})(\d{2})(\d{2}T\d{2}:\d{2}:\d{2})/);c="".concat(u[1],"-").concat(u[2],"-").concat(u[3],"Z")}if(t===this.roomjid)if($(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>status[code="104"]').length)this.discoRoomInfo();else if((s=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>invite'))&&s.length){var l,d=$(e).find('>x[xmlns="http://jabber.org/protocol/muc#user"]>password');d&&d.length&&(l=d.text()),this.eventEmitter.emit(m.a.INVITE_MESSAGE_RECEIVED,t,s.attr("from"),o,l)}var h=$(e).find(">json-message").text();if(h){var p=this.xmpp.tryParseJSONAndVerify(h);if(p&&void 0===c)return void this.eventEmitter.emit(m.a.JSON_MESSAGE_RECEIVED,t,p)}o&&("chat"===n?this.eventEmitter.emit(m.a.PRIVATE_MESSAGE_RECEIVED,t,o,this.myroomjid,c):"groupchat"===n&&this.eventEmitter.emit(m.a.MESSAGE_RECEIVED,t,o,this.myroomjid,c))}},{key:"onPresenceError",value:function(e,t){if($(e).find('>error[type="auth"]>not-authorized[xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"]').length)S.log("on password required",t),this.eventEmitter.emit(m.a.PASSWORD_REQUIRED);else if($(e).find('>error[type="cancel"]>not-allowed[xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"]').length){d.Strophe.getDomainFromJid(e.getAttribute("to"))===this.xmpp.options.hosts.anonymousdomain?this.eventEmitter.emit(m.a.ROOM_JOIN_ERROR):(S.warn("onPresError ",e),this.eventEmitter.emit(m.a.ROOM_CONNECT_NOT_ALLOWED_ERROR))}else if($(e).find(">error>service-unavailable").length)S.warn("Maximum users limit for the room has been reached",e),this.eventEmitter.emit(m.a.ROOM_MAX_USERS_ERROR);else if($(e).find('>error[type="auth"]>registration-required[xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"]').length){var n,i=$(e).find(">lobbyroom");i.length&&(n=i.text()),this.eventEmitter.emit(m.a.ROOM_CONNECT_MEMBERS_ONLY_ERROR,n)}else S.warn("onPresError ",e),this.eventEmitter.emit(m.a.ROOM_CONNECT_ERROR)}},{key:"setAffiliation",value:function(e,t){var n=Object(d.$iq)({to:this.roomjid,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{affiliation:t,nick:d.Strophe.getResourceFromJid(e)}).c("reason").t("Your affiliation has been changed to '".concat(t,"'.")).up().up().up();this.connection.sendIQ(n,(function(n){return S.log("Set affiliation of participant with jid: ",e,"to",t,n)}),(function(e){return S.log("Set affiliation of participant error: ",e)}))}},{key:"kick",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"You have been kicked.",n=Object(d.$iq)({to:this.roomjid,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{nick:d.Strophe.getResourceFromJid(e),role:"none"}).c("reason").t(t).up().up().up();this.connection.sendIQ(n,(function(t){return S.log("Kick participant with jid: ",e,t)}),(function(e){return S.log("Kick participant error: ",e)}))}},{key:"lockRoom",value:function(e,t,n,i){var o=this;this.connection.sendIQ(Object(d.$iq)({to:this.roomjid,type:"get"}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}),(function(r){if($(r).find('>query>x[xmlns="jabber:x:data"]>field[var="muc#roomconfig_roomsecret"]').length){var a=Object(d.$iq)({to:o.roomjid,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"});a.c("x",{xmlns:"jabber:x:data",type:"submit"}),a.c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up(),a.c("field",{var:"muc#roomconfig_roomsecret"}).c("value").t(e).up().up(),a.c("field",{var:"muc#roomconfig_passwordprotectedroom"}).c("value").t(null===e||0===e.length?"0":"1").up().up(),o.membersOnlyEnabled&&a.c("field",{var:"muc#roomconfig_membersonly"}).c("value").t("true").up().up(),a.c("field",{var:"muc#roomconfig_whois"}).c("value").t("anyone").up().up(),o.connection.sendIQ(a,(function(){o.password=e,t()}),n)}else i()}),n)}},{key:"setMembersOnly",value:function(e,t,n){var i=this;e&&Object.values(this.members).filter((function(e){return!e.isFocus})).length&&Object.values(this.members).forEach((function(e){e.jid&&!j.includes(e.affiliation)&&i.xmpp.connection.sendIQ(Object(d.$iq)({to:i.roomjid,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#admin"}).c("item",{affiliation:"member",jid:e.jid}).up().up())}));var o=n||function(){};this.xmpp.connection.sendIQ(Object(d.$iq)({to:this.roomjid,type:"get"}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"}),(function(n){if($(n).find('>query>x[xmlns="jabber:x:data"]>field[var="muc#roomconfig_membersonly"]').length){var r=Object(d.$iq)({to:i.roomjid,type:"set"}).c("query",{xmlns:"http://jabber.org/protocol/muc#owner"});r.c("x",{xmlns:"jabber:x:data",type:"submit"}),r.c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up(),r.c("field",{var:"muc#roomconfig_membersonly"}).c("value").t(e?"true":"false").up().up(),i.locked&&r.c("field",{var:"muc#roomconfig_passwordprotectedroom"}).c("value").t("1").up().up(),i.xmpp.connection.sendIQ(r,t,o)}else o(new Error("Setting members only room not supported!"))}),o)}},{key:"addToPresence",value:function(e,t){return this.addOrReplaceInPresence(e,t)}},{key:"addOrReplaceInPresence",value:function(e,t){t.tagName=e;var n=this.presMap.nodes.filter((function(t){return e===t.tagName}));return(1!==n.length||!l()(n[0],t))&&(this.removeFromPresence(e),this.presMap.nodes.push(t),this.presenceUpdateTime=Date.now(),!0)}},{key:"getFromPresence",value:function(e){return this.presMap.nodes.find((function(t){return e===t.tagName}))}},{key:"removeFromPresence",value:function(e){var t=this.presMap.nodes.filter((function(t){return e!==t.tagName}));this.presMap.nodes=t,this.presenceUpdateTime=Date.now()}},{key:"addPresenceListener",value:function(e,t){if("function"!==typeof t)throw new Error('"handler" is not a function');var n=this.presHandlers[e];n||(this.presHandlers[e]=n=[]),-1===n.indexOf(t)?n.push(t):S.warn("Trying to add the same handler more than once for: ".concat(e))}},{key:"removePresenceListener",value:function(e,t){var n=this.presHandlers[e],i=n?n.indexOf(t):-1;-1!==i?n.splice(i,1):S.warn("Handler for: ".concat(e," was not registered"))}},{key:"isFocus",value:function(e){var t=this.members[e];return t?t.isFocus:null}},{key:"isModerator",value:function(){return"moderator"===this.role}},{key:"getMemberRole",value:function(e){return this.members[e]?this.members[e].role:null}},{key:"setVideoMute",value:function(e,t){this.sendVideoInfoPresence(e),t&&t(e)}},{key:"setAudioMute",value:function(e,t){return this.sendAudioInfoPresence(e,t)}},{key:"addAudioInfoToPresence",value:function(e){var t="audiomuted";return!(e&&!this.getFromPresence(t))&&this.addOrReplaceInPresence(t,{value:e.toString()})}},{key:"sendAudioInfoPresence",value:function(e,t){this.addAudioInfoToPresence(e)&&this.sendPresence(),t&&t()}},{key:"addVideoInfoToPresence",value:function(e){var t="videomuted";return!(e&&!this.getFromPresence(t))&&this.addOrReplaceInPresence(t,{value:e.toString()})}},{key:"sendVideoInfoPresence",value:function(e){this.addVideoInfoToPresence(e)&&this.sendPresence()}},{key:"getMediaPresenceInfo",value:function(e,t){var n=this.lastPresences["".concat(this.roomjid,"/").concat(e)];if(!n)return null;var i={muted:!0,videoType:void 0},o=null;if(t===p.a)o=_(n,"audiomuted");else{if(t!==p.c)return S.error("Unsupported media type: ".concat(t)),null;o=_(n,"videomuted");var r=_(n,"jitsi_participant_codecType"),a=_(n,"videoType");a.length>0&&(i.videoType=a[0].value),r.length>0&&(i.codecType=r[0].value)}return o.length>0&&(i.muted="true"===o[0].value),i}},{key:"isSIPCallingSupported",value:function(){return!!this.moderator&&this.moderator.isSipGatewayEnabled()}},{key:"dial",value:function(e){return this.connection.rayo.dial(e,"fromnumber",d.Strophe.getBareJidFromJid(this.myroomjid),this.password,this.focusMucJid)}},{key:"hangup",value:function(){return this.connection.rayo.hangup()}},{key:"getLobby",value:function(){return this.lobby}},{key:"getAVModeration",value:function(){return this.avModeration}},{key:"getPhoneNumber",value:function(){return this.phoneNumber}},{key:"getPhonePin",value:function(){return this.phonePin}},{key:"getMeetingId",value:function(){return this.meetingId}},{key:"muteParticipant",value:function(e,t,n){S.info("set mute",t);var i=Object(d.$iq)({to:this.focusMucJid,type:"set"}).c("mute",{xmlns:"http://jitsi.org/jitmeet/".concat(n),jid:e}).t(t.toString()).up();this.connection.sendIQ(i,(function(e){return S.log("set mute",e)}),(function(e){return S.log("set mute error",e)}))}},{key:"onMute",value:function(e){if(e.getAttribute("from")===this.focusMucJid){var t=$(e).find("mute");t.length&&"true"===t.text()?this.eventEmitter.emit(m.a.AUDIO_MUTED_BY_FOCUS,t.attr("actor")):S.warn("Ignoring a mute request which does not explicitly specify a positive mute command.")}else S.warn("Ignored mute from non focus peer")}},{key:"onMuteVideo",value:function(e){if(e.getAttribute("from")===this.focusMucJid){var t=$(e).find("mute");t.length&&"true"===t.text()?this.eventEmitter.emit(m.a.VIDEO_MUTED_BY_FOCUS,t.attr("actor")):S.warn("Ignoring a mute request which does not explicitly specify a positive mute command.")}else S.warn("Ignored mute from non focus peer")}},{key:"clean",value:function(){this._removeConnListeners.forEach((function(e){return e()})),this._removeConnListeners=[],this.joined=!1}},{key:"leave",value:function(){var e=this;return new Promise((function(t,n){var i=setTimeout((function(){return r(!0)}),5e3),o=e.eventEmitter;function r(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];o.removeListener(m.a.MUC_LEFT,r),clearTimeout(i),e?n(new Error("The timeout for the confirmation about leaving the room expired.")):t()}e.clean(),o.on(m.a.MUC_LEFT,r),e.doLeave()}))}}]),n}(b.a)}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return h}));var i=n(53),o=n(6),r=n(8),a=n(18),s=n(13),c=n(19),u=n(9),l=n.n(u),d=Object(a.getLogger)(e),h=function(){function e(t){var n;Object(o.a)(this,e),this._xmpp=t.xmpp,this._mainRoom=t,this._momderationEnabledByType=(n={},Object(i.a)(n,c.a,!1),Object(i.a)(n,c.c,!1),n),this._whitelistAudio=[],this._whitelistVideo=[],this._xmpp.addListener(l.a.AV_MODERATION_RECEIVED,this._onMessage.bind(this))}return Object(r.a)(e,[{key:"isSupported",value:function(){return Boolean(this._xmpp.avModerationComponentAddress)}},{key:"enable",value:function(e,t){if(this.isSupported()&&this._mainRoom.isModerator())if(e!==this._momderationEnabledByType[t]){var n=Object(s.$msg)({to:this._xmpp.avModerationComponentAddress});n.c("av_moderation",{enable:e,mediaType:t}).up(),this._xmpp.connection.send(n)}else d.warn("Moderation already in state:".concat(e," for mediaType:").concat(t));else d.error("Cannot enable:".concat(e," AV moderation supported:").concat(this.isSupported(),", \n                moderator:").concat(this._mainRoom.isModerator()))}},{key:"approve",value:function(e,t){if(this.isSupported()&&this._mainRoom.isModerator()){var n=Object(s.$msg)({to:this._xmpp.avModerationComponentAddress});n.c("av_moderation",{mediaType:e,jidToWhitelist:t}).up(),this._xmpp.connection.send(n)}else d.error("Cannot approve in AV moderation supported:".concat(this.isSupported(),", \n                moderator:").concat(this._mainRoom.isModerator()))}},{key:"_onMessage",value:function(e){var t=this,n=e.whitelists;if(n){var i=function(e,n,i){i.filter((function(e){return!n.includes(e)})).forEach((function(n){return t._xmpp.eventEmitter.emit(l.a.AV_MODERATION_PARTICIPANT_APPROVED,e,n)}))};n[c.a]&&i(c.a,this._whitelistAudio,n[c.a]),n[c.c]&&i(c.c,this._whitelistVideo,n[c.c])}else void 0!==e.enabled&&this._momderationEnabledByType[e.mediaType]!==e.enabled?(this._momderationEnabledByType[e.mediaType]=e.enabled,this._xmpp.eventEmitter.emit(l.a.AV_MODERATION_CHANGED,e.enabled,e.mediaType,e.actor)):e.approved&&this._xmpp.eventEmitter.emit(l.a.AV_MODERATION_APPROVED,e.mediaType)}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return d}));var i=n(6),o=n(8),r=n(18),a=n(13),s=n(9),c=n.n(s),u=Object(r.getLogger)(e),l="email",d=function(){function e(t){var n=this;Object(i.a)(this,e),this.xmpp=t.xmpp,this.mainRoom=t;var o=this._maybeJoinLobbyRoom.bind(this);this.mainRoom.addEventListener(c.a.LOCAL_ROLE_CHANGED,o),this.mainRoom.addEventListener(c.a.MUC_MEMBERS_ONLY_CHANGED,o),this.mainRoom.addEventListener(c.a.ROOM_CONNECT_MEMBERS_ONLY_ERROR,(function(e){n.lobbyRoomJid=e}))}return Object(o.a)(e,[{key:"isSupported",value:function(){return this.xmpp.lobbySupported}},{key:"enable",value:function(){var e=this;return this.isSupported()?new Promise((function(t,n){e.mainRoom.setMembersOnly(!0,t,n)})):Promise.reject(new Error("Lobby not supported!"))}},{key:"disable",value:function(){this.isSupported()&&this.mainRoom.isModerator()&&this.lobbyRoom&&this.mainRoom.membersOnlyEnabled&&this.mainRoom.setMembersOnly(!1)}},{key:"_leaveLobbyRoom",value:function(){var e=this;this.lobbyRoom&&this.lobbyRoom.leave().then((function(){e.lobbyRoom=void 0,u.info("Lobby room left!")})).catch((function(){}))}},{key:"setLobbyRoomJid",value:function(e){this.lobbyRoomJid=e}},{key:"_maybeJoinLobbyRoom",value:function(){this.isSupported()&&(this.mainRoom.joined&&this.mainRoom.isModerator()&&this.mainRoom.membersOnlyEnabled&&!this.lobbyRoom&&this.join().then((function(){return u.info("Joined lobby room")})).catch((function(e){return u.error("Failed joining lobby",e)})))}},{key:"join",value:function(e,t){var n=this,i=this.mainRoom.joined&&this.mainRoom.isModerator();if(!this.lobbyRoomJid)return Promise.reject(new Error("Missing lobbyRoomJid, cannot join lobby room."));var o=a.Strophe.getNodeFromJid(this.lobbyRoomJid),r=a.Strophe.getDomainFromJid(this.lobbyRoomJid);return this.lobbyRoom=this.xmpp.createRoom(o,{customDomain:r,disableDiscoInfo:!0,disableFocus:!0,enableLobby:!1}),e&&this.lobbyRoom.addOrReplaceInPresence("nick",{attributes:{xmlns:"http://jabber.org/protocol/nick"},value:e}),i?(this.lobbyRoom.addPresenceListener(l,(function(e,t){n.mainRoom.eventEmitter.emit(c.a.MUC_LOBBY_MEMBER_UPDATED,t,{email:e.value})})),this.lobbyRoom.addEventListener(c.a.MUC_MEMBER_JOINED,(function(e,t,i,o,r,s,u,l,d){Object.values(n.mainRoom.members).find((function(e){return e.jid===d}))||n.mainRoom.eventEmitter.emit(c.a.MUC_LOBBY_MEMBER_JOINED,a.Strophe.getResourceFromJid(e),t,u?u.avatar:void 0)})),this.lobbyRoom.addEventListener(c.a.MUC_MEMBER_LEFT,(function(e){n.mainRoom.eventEmitter.emit(c.a.MUC_LOBBY_MEMBER_LEFT,a.Strophe.getResourceFromJid(e))})),this.lobbyRoom.addEventListener(c.a.MUC_DESTROYED,(function(){Object.keys(n.lobbyRoom.members).forEach((function(e){return n.mainRoom.eventEmitter.emit(c.a.MUC_LOBBY_MEMBER_LEFT,a.Strophe.getResourceFromJid(e))})),n.lobbyRoom.clean(),n.lobbyRoom=void 0,u.info("Lobby room left(destroyed)!")}))):(this.lobbyRoom.addEventListener(c.a.KICKED,(function(e){if(e)return n.mainRoom.eventEmitter.emit(c.a.MUC_DENIED_ACCESS),void n.lobbyRoom.clean()})),this.mainRoom.addEventListener(c.a.INVITE_MESSAGE_RECEIVED,(function(e,t,i,o){u.debug("Received approval to join ".concat(e," ").concat(t," ").concat(i)),e===n.mainRoom.roomjid&&(n.mainRoom.join(o),n._leaveLobbyRoom())})),this.lobbyRoom.addEventListener(c.a.MUC_DESTROYED,(function(e,t){t?n.mainRoom.join():(n.lobbyRoom.clean(),n.mainRoom.eventEmitter.emit(c.a.MUC_DESTROYED,e))})),this.mainRoom.addEventListener(c.a.MUC_JOINED,(function(){n._leaveLobbyRoom()}))),new Promise((function(e,o){n.lobbyRoom.addEventListener(c.a.MUC_JOINED,(function(){e(),t&&!i&&n.lobbyRoom.addOrReplaceInPresence(l,{value:t})&&n.lobbyRoom.sendPresence()})),n.lobbyRoom.addEventListener(c.a.ROOM_JOIN_ERROR,o),n.lobbyRoom.addEventListener(c.a.ROOM_CONNECT_NOT_ALLOWED_ERROR,o),n.lobbyRoom.addEventListener(c.a.ROOM_CONNECT_ERROR,o),n.lobbyRoom.join()}))}},{key:"denyAccess",value:function(e){if(this.isSupported()&&this.mainRoom.isModerator()){var t=Object.keys(this.lobbyRoom.members).find((function(t){return a.Strophe.getResourceFromJid(t)===e}));t?this.lobbyRoom.kick(t):u.error("Not found member for ".concat(e," in lobby room."))}}},{key:"approveAccess",value:function(e){if(this.isSupported()&&this.mainRoom.isModerator()){var t=Object.keys(this.lobbyRoom.members).find((function(t){return a.Strophe.getResourceFromJid(t)===e}));if(t){var n=this.lobbyRoom.members[t].jid,i=Object(a.$msg)({to:this.mainRoom.roomjid}).c("x",{xmlns:"http://jabber.org/protocol/muc#user"}).c("invite",{to:n});this.xmpp.connection.sendIQ(i,(function(){}),(function(e){u.error("Error sending invite for ".concat(n),e)}))}else u.error("Not found member for ".concat(t," in lobby room."))}}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return d}));var i=n(18),o=n(13),r=n(96),a=n(274),s=n(9),c=n(41),u=Object(i.getLogger)(e);function l(e){var t=1;return function(n){if(!n){var i=Math.pow(2,t-1);return t+=1,i*e}t=1}}function d(e,t,n,i){function o(e){if(e.data&&e.data.sessionId){if(e.origin!==window.location.origin)return void u.warn("Ignoring sessionId from different origin: ".concat(e.origin));r.a.sessionId=e.data.sessionId}}this.roomName=e,this.xmppService=t,this.getNextTimeout=l(1e3),this.getNextErrorTimeout=l(1e3),this.externalAuthEnabled=!1,this.options=i,this.sipGatewayEnabled=!1,this.eventEmitter=n,this.connection=this.xmppService.connection,window.addEventListener?window.addEventListener("message",o,!1):window.attachEvent("onmessage",o)}d.prototype.isExternalAuthEnabled=function(){return this.externalAuthEnabled},d.prototype.isSipGatewayEnabled=function(){return this.sipGatewayEnabled},d.prototype.onMucMemberLeft=function(e){u.info("Someone left is it focus ? ".concat(e)),"focus"===o.Strophe.getResourceFromJid(e)&&(u.info("Focus has left the room - leaving conference"),this.eventEmitter.emit(s.FOCUS_LEFT))},d.prototype.setFocusUserJid=function(e){this.focusUserJid||(this.focusUserJid=e,u.info("Focus jid set to:  ".concat(this.focusUserJid)))},d.prototype.getFocusUserJid=function(){return this.focusUserJid},d.prototype.getFocusComponent=function(){var e=this.options.connection.hosts.focus;return e||(e="focus.".concat(this.options.connection.hosts.domain)),e},d.prototype.createConferenceIq=function(){var e,t=Object(o.$iq)({to:this.getFocusComponent(),type:"set"}),n=r.a.sessionId,i=r.a.machineId,a=this.options.conference;switch(u.info("Session ID: ".concat(n," machine UID: ").concat(i)),t.c("conference",{xmlns:"http://jitsi.org/protocol/focus",room:this.roomName,"machine-uid":i}),n&&t.attrs({"session-id":n}),t.c("property",{name:"disableRtx",value:Boolean(a.disableRtx)}).up(),void 0!==a.audioPacketDelay&&t.c("property",{name:"audioPacketDelay",value:a.audioPacketDelay}).up(),a.startBitrate&&t.c("property",{name:"startBitrate",value:a.startBitrate}).up(),a.minBitrate&&t.c("property",{name:"minBitrate",value:a.minBitrate}).up(),a.testing&&a.testing.octo&&"number"===typeof a.testing.octo.probability&&Math.random()<a.testing.octo.probability&&t.c("property",{name:"octo",value:!0}).up(),this.options.conference.openBridgeChannel){case"datachannel":case!0:case void 0:e=!0;break;case"websocket":e=!1}return t.c("property",{name:"openSctp",value:e}).up(),void 0!==this.options.conference.startAudioMuted&&t.c("property",{name:"startAudioMuted",value:this.options.conference.startAudioMuted}).up(),void 0!==this.options.conference.startVideoMuted&&t.c("property",{name:"startVideoMuted",value:this.options.conference.startVideoMuted}).up(),t.up(),t},d.prototype.parseSessionId=function(e){var t=$(e).find("conference").attr("session-id");t&&(u.info("Received sessionId:  ".concat(t)),r.a.sessionId=t)},d.prototype.parseConfigOptions=function(e){this.setFocusUserJid($(e).find("conference").attr("focusjid"));var t=$(e).find(">conference>property[name='authentication'][value='true']").length>0;u.info("Authentication enabled: ".concat(t)),this.externalAuthEnabled=$(e).find(">conference>property[name='externalAuth'][value='true']").length>0,u.info("External authentication enabled: ".concat(this.externalAuthEnabled)),this.externalAuthEnabled||this.parseSessionId(e);var n=$(e).find(">conference").attr("identity");this.eventEmitter.emit(a.IDENTITY_UPDATED,t,n),$(e).find(">conference>property[name='sipGatewayEnabled'][value='true']").length&&(this.sipGatewayEnabled=!0),u.info("Sip gateway enabled:  ".concat(this.sipGatewayEnabled))},d.prototype.allocateConferenceFocus=function(){var e=this;return new Promise((function(t){e.setFocusUserJid(e.options.connection.focusUserJid),e.connection.sendIQ(e.createConferenceIq(),(function(n){return e._allocateConferenceFocusSuccess(n,t)}),(function(n){return e._allocateConferenceFocusError(n,t)})),e.connection.flush()}))},d.prototype._allocateConferenceFocusError=function(e,t){var n=this,i=$(e).find(">error>session-invalid").length||$(e).find(">error>not-acceptable").length;if(i&&(u.info("Session expired! - removing"),r.a.sessionId=void 0),$(e).find(">error>graceful-shutdown").length)this.eventEmitter.emit(s.GRACEFUL_SHUTDOWN);else{var a=$(e).find(">error>reservation-error");if(a.length){var l,d=a.attr("error-code"),h=$(e).find(">error>text");return h&&(l=h.text()),void this.eventEmitter.emit(s.RESERVATION_ERROR,d,l)}if($(e).find(">error>not-authorized").length)return u.warn("Unauthorized to start the conference",e),o.Strophe.getDomainFromJid(e.getAttribute("to"))!==this.options.connection.hosts.anonymousdomain&&(this.externalAuthEnabled=!0),void this.eventEmitter.emit(s.AUTHENTICATION_REQUIRED);var p=this.getNextErrorTimeout(),f="Focus error, retry after ".concat(p);c.callErrorHandler(new Error(f)),u.error(f,e);var m=this.getFocusComponent(),v=p/1e3;i||this.eventEmitter.emit(s.FOCUS_DISCONNECTED,m,v),this.getNextTimeout(!0),window.setTimeout((function(){return n.allocateConferenceFocus().then(t)}),p)}},d.prototype._allocateConferenceFocusSuccess=function(e,t){var n=this;if(this.parseConfigOptions(e),this.getNextErrorTimeout(!0),"true"===$(e).find("conference").attr("ready"))this.getNextTimeout(!0),t();else{var i=this.getNextTimeout();u.info("Waiting for the focus... ".concat(i)),window.setTimeout((function(){return n.allocateConferenceFocus().then(t)}),i)}},d.prototype.authenticate=function(){var e=this;return new Promise((function(t,n){e.connection.sendIQ(e.createConferenceIq(),(function(n){e.parseSessionId(n),t()}),(function(e){return n({error:$(e).find("iq>error :first").prop("tagName"),message:$(e).find("iq>error>text").text()})}))}))},d.prototype.getLoginUrl=function(e,t){this._getLoginUrl(!1,e,t)},d.prototype._getLoginUrl=function(e,t,n){var i=Object(o.$iq)({to:this.getFocusComponent(),type:"get"}),a={xmlns:"http://jitsi.org/protocol/focus",room:this.roomName,"machine-uid":r.a.machineId},s="auth url";function l(e,t){c.callErrorHandler(new Error(e)),u.error(e,t),n(t)}e&&(a.popup=!0,s="POPUP ".concat(s)),i.c("login-url",a),this.connection.sendIQ(i,(function(e){var n=$(e).find("login-url").attr("url");(n=decodeURIComponent(n))?(u.info("Got ".concat(s,": ").concat(n)),t(n)):l("Failed to get ".concat(s," from the focus"),e)}),l.bind(void 0,"Get ".concat(s," error")))},d.prototype.getPopupLoginUrl=function(e,t){this._getLoginUrl(!0,e,t)},d.prototype.logout=function(e){var t=Object(o.$iq)({to:this.getFocusComponent(),type:"set"}),n=r.a.sessionId;n?(t.c("logout",{xmlns:"http://jitsi.org/protocol/focus","session-id":n}),this.connection.sendIQ(t,(function(t){var n=$(t).find("logout").attr("logout-url");n&&(n=decodeURIComponent(n)),u.info("Log out OK, url: ".concat(n),t),r.a.sessionId=void 0,e(n)}),(function(e){var t="Logout error";c.callErrorHandler(new Error(t)),u.error(t,e)}))):e()}}).call(this,"/index.js")},function(e,t,n){var i=n(120),o=["Aaliyah","Aaron","Abagail","Abbey","Abbie","Abbigail","Abby","Abdiel","Abdul","Abdullah","Abe","Abel","Abelardo","Abigail","Abigale","Abigayle","Abner","Abraham","Ada","Adah","Adalberto","Adaline","Adam","Adan","Addie","Addison","Adela","Adelbert","Adele","Adelia","Adeline","Adell","Adella","Adelle","Aditya","Adolf","Adolfo","Adolph","Adolphus","Adonis","Adrain","Adrian","Adriana","Adrianna","Adriel","Adrien","Adrienne","Afton","Aglae","Agnes","Agustin","Agustina","Ahmad","Ahmed","Aida","Aidan","Aiden","Aileen","Aisha","Aiyana","Akeem","Al","Alaina","Alan","Alana","Alanis","Alanna","Alayna","Alba","Albert","Alberta","Albertha","Alberto","Albin","Albina","Alda","Alden","Alec","Aleen","Alejandra","Alejandrin","Alek","Alena","Alene","Alessandra","Alessandro","Alessia","Aletha","Alex","Alexa","Alexander","Alexandra","Alexandre","Alexandrea","Alexandria","Alexandrine","Alexandro","Alexane","Alexanne","Alexie","Alexis","Alexys","Alexzander","Alf","Alfonso","Alfonzo","Alford","Alfred","Alfreda","Alfredo","Ali","Alia","Alice","Alicia","Alisa","Alisha","Alison","Alivia","Aliya","Aliyah","Aliza","Alize","Allan","Allen","Allene","Allie","Allison","Ally","Alphonso","Alta","Althea","Alva","Alvah","Alvena","Alvera","Alverta","Alvina","Alvis","Alyce","Alycia","Alysa","Alysha","Alyson","Alysson","Amalia","Amanda","Amani","Amara","Amari","Amaya","Amber","Ambrose","Amelia","Amelie","Amely","America","Americo","Amie","Amina","Amir","Amira","Amiya","Amos","Amparo","Amy","Amya","Ana","Anabel","Anabelle","Anahi","Anais","Anastacio","Anastasia","Anderson","Andre","Andreane","Andreanne","Andres","Andrew","Andy","Angel","Angela","Angelica","Angelina","Angeline","Angelita","Angelo","Angie","Angus","Anibal","Anika","Anissa","Anita","Aniya","Aniyah","Anjali","Anna","Annabel","Annabell","Annabelle","Annalise","Annamae","Annamarie","Anne","Annetta","Annette","Annie","Ansel","Ansley","Anthony","Antoinette","Antone","Antonetta","Antonette","Antonia","Antonietta","Antonina","Antonio","Antwan","Antwon","Anya","April","Ara","Araceli","Aracely","Arch","Archibald","Ardella","Arden","Ardith","Arely","Ari","Ariane","Arianna","Aric","Ariel","Arielle","Arjun","Arlene","Arlie","Arlo","Armand","Armando","Armani","Arnaldo","Arne","Arno","Arnold","Arnoldo","Arnulfo","Aron","Art","Arthur","Arturo","Arvel","Arvid","Arvilla","Aryanna","Asa","Asha","Ashlee","Ashleigh","Ashley","Ashly","Ashlynn","Ashton","Ashtyn","Asia","Assunta","Astrid","Athena","Aubree","Aubrey","Audie","Audra","Audreanne","Audrey","August","Augusta","Augustine","Augustus","Aurelia","Aurelie","Aurelio","Aurore","Austen","Austin","Austyn","Autumn","Ava","Avery","Avis","Axel","Ayana","Ayden","Ayla","Aylin","Baby","Bailee","Bailey","Barbara","Barney","Baron","Barrett","Barry","Bart","Bartholome","Barton","Baylee","Beatrice","Beau","Beaulah","Bell","Bella","Belle","Ben","Benedict","Benjamin","Bennett","Bennie","Benny","Benton","Berenice","Bernadette","Bernadine","Bernard","Bernardo","Berneice","Bernhard","Bernice","Bernie","Berniece","Bernita","Berry","Bert","Berta","Bertha","Bertram","Bertrand","Beryl","Bessie","Beth","Bethany","Bethel","Betsy","Bette","Bettie","Betty","Bettye","Beulah","Beverly","Bianka","Bill","Billie","Billy","Birdie","Blair","Blaise","Blake","Blanca","Blanche","Blaze","Bo","Bobbie","Bobby","Bonita","Bonnie","Boris","Boyd","Brad","Braden","Bradford","Bradley","Bradly","Brady","Braeden","Brain","Brandi","Brando","Brandon","Brandt","Brandy","Brandyn","Brannon","Branson","Brant","Braulio","Braxton","Brayan","Breana","Breanna","Breanne","Brenda","Brendan","Brenden","Brendon","Brenna","Brennan","Brennon","Brent","Bret","Brett","Bria","Brian","Briana","Brianne","Brice","Bridget","Bridgette","Bridie","Brielle","Brigitte","Brionna","Brisa","Britney","Brittany","Brock","Broderick","Brody","Brook","Brooke","Brooklyn","Brooks","Brown","Bruce","Bryana","Bryce","Brycen","Bryon","Buck","Bud","Buddy","Buford","Bulah","Burdette","Burley","Burnice","Buster","Cade","Caden","Caesar","Caitlyn","Cale","Caleb","Caleigh","Cali","Calista","Callie","Camden","Cameron","Camila","Camilla","Camille","Camren","Camron","Camryn","Camylle","Candace","Candelario","Candice","Candida","Candido","Cara","Carey","Carissa","Carlee","Carleton","Carley","Carli","Carlie","Carlo","Carlos","Carlotta","Carmel","Carmela","Carmella","Carmelo","Carmen","Carmine","Carol","Carolanne","Carole","Carolina","Caroline","Carolyn","Carolyne","Carrie","Carroll","Carson","Carter","Cary","Casandra","Casey","Casimer","Casimir","Casper","Cassandra","Cassandre","Cassidy","Cassie","Catalina","Caterina","Catharine","Catherine","Cathrine","Cathryn","Cathy","Cayla","Ceasar","Cecelia","Cecil","Cecile","Cecilia","Cedrick","Celestine","Celestino","Celia","Celine","Cesar","Chad","Chadd","Chadrick","Chaim","Chance","Chandler","Chanel","Chanelle","Charity","Charlene","Charles","Charley","Charlie","Charlotte","Chase","Chasity","Chauncey","Chaya","Chaz","Chelsea","Chelsey","Chelsie","Chesley","Chester","Chet","Cheyanne","Cheyenne","Chloe","Chris","Christ","Christa","Christelle","Christian","Christiana","Christina","Christine","Christop","Christophe","Christopher","Christy","Chyna","Ciara","Cicero","Cielo","Cierra","Cindy","Citlalli","Clair","Claire","Clara","Clarabelle","Clare","Clarissa","Clark","Claud","Claude","Claudia","Claudie","Claudine","Clay","Clemens","Clement","Clementina","Clementine","Clemmie","Cleo","Cleora","Cleta","Cletus","Cleve","Cleveland","Clifford","Clifton","Clint","Clinton","Clotilde","Clovis","Cloyd","Clyde","Coby","Cody","Colby","Cole","Coleman","Colin","Colleen","Collin","Colt","Colten","Colton","Columbus","Concepcion","Conner","Connie","Connor","Conor","Conrad","Constance","Constantin","Consuelo","Cooper","Cora","Coralie","Corbin","Cordelia","Cordell","Cordia","Cordie","Corene","Corine","Cornelius","Cornell","Corrine","Cortez","Cortney","Cory","Coty","Courtney","Coy","Craig","Crawford","Creola","Cristal","Cristian","Cristina","Cristobal","Cristopher","Cruz","Crystal","Crystel","Cullen","Curt","Curtis","Cydney","Cynthia","Cyril","Cyrus","Dagmar","Dahlia","Daija","Daisha","Daisy","Dakota","Dale","Dallas","Dallin","Dalton","Damaris","Dameon","Damian","Damien","Damion","Damon","Dan","Dana","Dandre","Dane","D'angelo","Dangelo","Danial","Daniela","Daniella","Danielle","Danika","Dannie","Danny","Dante","Danyka","Daphne","Daphnee","Daphney","Darby","Daren","Darian","Dariana","Darien","Dario","Darion","Darius","Darlene","Daron","Darrel","Darrell","Darren","Darrick","Darrin","Darrion","Darron","Darryl","Darwin","Daryl","Dashawn","Dasia","Dave","David","Davin","Davion","Davon","Davonte","Dawn","Dawson","Dax","Dayana","Dayna","Dayne","Dayton","Dean","Deangelo","Deanna","Deborah","Declan","Dedric","Dedrick","Dee","Deion","Deja","Dejah","Dejon","Dejuan","Delaney","Delbert","Delfina","Delia","Delilah","Dell","Della","Delmer","Delores","Delpha","Delphia","Delphine","Delta","Demarco","Demarcus","Demario","Demetris","Demetrius","Demond","Dena","Denis","Dennis","Deon","Deondre","Deontae","Deonte","Dereck","Derek","Derick","Deron","Derrick","Deshaun","Deshawn","Desiree","Desmond","Dessie","Destany","Destin","Destinee","Destiney","Destini","Destiny","Devan","Devante","Deven","Devin","Devon","Devonte","Devyn","Dewayne","Dewitt","Dexter","Diamond","Diana","Dianna","Diego","Dillan","Dillon","Dimitri","Dina","Dino","Dion","Dixie","Dock","Dolly","Dolores","Domenic","Domenica","Domenick","Domenico","Domingo","Dominic","Dominique","Don","Donald","Donato","Donavon","Donna","Donnell","Donnie","Donny","Dora","Dorcas","Dorian","Doris","Dorothea","Dorothy","Dorris","Dortha","Dorthy","Doug","Douglas","Dovie","Doyle","Drake","Drew","Duane","Dudley","Dulce","Duncan","Durward","Dustin","Dusty","Dwight","Dylan","Earl","Earlene","Earline","Earnest","Earnestine","Easter","Easton","Ebba","Ebony","Ed","Eda","Edd","Eddie","Eden","Edgar","Edgardo","Edison","Edmond","Edmund","Edna","Eduardo","Edward","Edwardo","Edwin","Edwina","Edyth","Edythe","Effie","Efrain","Efren","Eileen","Einar","Eino","Eladio","Elaina","Elbert","Elda","Eldon","Eldora","Eldred","Eldridge","Eleanora","Eleanore","Eleazar","Electa","Elena","Elenor","Elenora","Eleonore","Elfrieda","Eli","Elian","Eliane","Elias","Eliezer","Elijah","Elinor","Elinore","Elisa","Elisabeth","Elise","Eliseo","Elisha","Elissa","Eliza","Elizabeth","Ella","Ellen","Ellie","Elliot","Elliott","Ellis","Ellsworth","Elmer","Elmira","Elmo","Elmore","Elna","Elnora","Elody","Eloisa","Eloise","Elouise","Eloy","Elroy","Elsa","Else","Elsie","Elta","Elton","Elva","Elvera","Elvie","Elvis","Elwin","Elwyn","Elyse","Elyssa","Elza","Emanuel","Emelia","Emelie","Emely","Emerald","Emerson","Emery","Emie","Emil","Emile","Emilia","Emiliano","Emilie","Emilio","Emily","Emma","Emmalee","Emmanuel","Emmanuelle","Emmet","Emmett","Emmie","Emmitt","Emmy","Emory","Ena","Enid","Enoch","Enola","Enos","Enrico","Enrique","Ephraim","Era","Eriberto","Eric","Erica","Erich","Erick","Ericka","Erik","Erika","Erin","Erling","Erna","Ernest","Ernestina","Ernestine","Ernesto","Ernie","Ervin","Erwin","Eryn","Esmeralda","Esperanza","Esta","Esteban","Estefania","Estel","Estell","Estella","Estelle","Estevan","Esther","Estrella","Etha","Ethan","Ethel","Ethelyn","Ethyl","Ettie","Eudora","Eugene","Eugenia","Eula","Eulah","Eulalia","Euna","Eunice","Eusebio","Eva","Evalyn","Evan","Evangeline","Evans","Eve","Eveline","Evelyn","Everardo","Everett","Everette","Evert","Evie","Ewald","Ewell","Ezekiel","Ezequiel","Ezra","Fabian","Fabiola","Fae","Fannie","Fanny","Fatima","Faustino","Fausto","Favian","Fay","Faye","Federico","Felicia","Felicita","Felicity","Felipa","Felipe","Felix","Felton","Fermin","Fern","Fernando","Ferne","Fidel","Filiberto","Filomena","Finn","Fiona","Flavie","Flavio","Fleta","Fletcher","Flo","Florence","Florencio","Florian","Florida","Florine","Flossie","Floy","Floyd","Ford","Forest","Forrest","Foster","Frances","Francesca","Francesco","Francis","Francisca","Francisco","Franco","Frank","Frankie","Franz","Fred","Freda","Freddie","Freddy","Frederic","Frederick","Frederik","Frederique","Fredrick","Fredy","Freeda","Freeman","Freida","Frida","Frieda","Friedrich","Fritz","Furman","Gabe","Gabriel","Gabriella","Gabrielle","Gaetano","Gage","Gail","Gardner","Garett","Garfield","Garland","Garnet","Garnett","Garret","Garrett","Garrick","Garrison","Garry","Garth","Gaston","Gavin","Gay","Gayle","Gaylord","Gene","General","Genesis","Genevieve","Gennaro","Genoveva","Geo","Geoffrey","George","Georgette","Georgiana","Georgianna","Geovanni","Geovanny","Geovany","Gerald","Geraldine","Gerard","Gerardo","Gerda","Gerhard","Germaine","German","Gerry","Gerson","Gertrude","Gia","Gianni","Gideon","Gilbert","Gilberto","Gilda","Giles","Gillian","Gina","Gino","Giovani","Giovanna","Giovanni","Giovanny","Gisselle","Giuseppe","Gladyce","Gladys","Glen","Glenda","Glenna","Glennie","Gloria","Godfrey","Golda","Golden","Gonzalo","Gordon","Grace","Gracie","Graciela","Grady","Graham","Grant","Granville","Grayce","Grayson","Green","Greg","Gregg","Gregoria","Gregorio","Gregory","Greta","Gretchen","Greyson","Griffin","Grover","Guadalupe","Gudrun","Guido","Guillermo","Guiseppe","Gunnar","Gunner","Gus","Gussie","Gust","Gustave","Guy","Gwen","Gwendolyn","Hadley","Hailee","Hailey","Hailie","Hal","Haleigh","Haley","Halie","Halle","Hallie","Hank","Hanna","Hannah","Hans","Hardy","Harley","Harmon","Harmony","Harold","Harrison","Harry","Harvey","Haskell","Hassan","Hassie","Hattie","Haven","Hayden","Haylee","Hayley","Haylie","Hazel","Hazle","Heath","Heather","Heaven","Heber","Hector","Heidi","Helen","Helena","Helene","Helga","Hellen","Helmer","Heloise","Henderson","Henri","Henriette","Henry","Herbert","Herman","Hermann","Hermina","Herminia","Herminio","Hershel","Herta","Hertha","Hester","Hettie","Hilario","Hilbert","Hilda","Hildegard","Hillard","Hillary","Hilma","Hilton","Hipolito","Hiram","Hobart","Holden","Hollie","Hollis","Holly","Hope","Horace","Horacio","Hortense","Hosea","Houston","Howard","Howell","Hoyt","Hubert","Hudson","Hugh","Hulda","Humberto","Hunter","Hyman","Ian","Ibrahim","Icie","Ida","Idell","Idella","Ignacio","Ignatius","Ike","Ila","Ilene","Iliana","Ima","Imani","Imelda","Immanuel","Imogene","Ines","Irma","Irving","Irwin","Isaac","Isabel","Isabell","Isabella","Isabelle","Isac","Isadore","Isai","Isaiah","Isaias","Isidro","Ismael","Isobel","Isom","Israel","Issac","Itzel","Iva","Ivah","Ivory","Ivy","Izabella","Izaiah","Jabari","Jace","Jacey","Jacinthe","Jacinto","Jack","Jackeline","Jackie","Jacklyn","Jackson","Jacky","Jaclyn","Jacquelyn","Jacques","Jacynthe","Jada","Jade","Jaden","Jadon","Jadyn","Jaeden","Jaida","Jaiden","Jailyn","Jaime","Jairo","Jakayla","Jake","Jakob","Jaleel","Jalen","Jalon","Jalyn","Jamaal","Jamal","Jamar","Jamarcus","Jamel","Jameson","Jamey","Jamie","Jamil","Jamir","Jamison","Jammie","Jan","Jana","Janae","Jane","Janelle","Janessa","Janet","Janice","Janick","Janie","Janis","Janiya","Jannie","Jany","Jaquan","Jaquelin","Jaqueline","Jared","Jaren","Jarod","Jaron","Jarred","Jarrell","Jarret","Jarrett","Jarrod","Jarvis","Jasen","Jasmin","Jason","Jasper","Jaunita","Javier","Javon","Javonte","Jay","Jayce","Jaycee","Jayda","Jayde","Jayden","Jaydon","Jaylan","Jaylen","Jaylin","Jaylon","Jayme","Jayne","Jayson","Jazlyn","Jazmin","Jazmyn","Jazmyne","Jean","Jeanette","Jeanie","Jeanne","Jed","Jedediah","Jedidiah","Jeff","Jefferey","Jeffery","Jeffrey","Jeffry","Jena","Jenifer","Jennie","Jennifer","Jennings","Jennyfer","Jensen","Jerad","Jerald","Jeramie","Jeramy","Jerel","Jeremie","Jeremy","Jermain","Jermaine","Jermey","Jerod","Jerome","Jeromy","Jerrell","Jerrod","Jerrold","Jerry","Jess","Jesse","Jessica","Jessie","Jessika","Jessy","Jessyca","Jesus","Jett","Jettie","Jevon","Jewel","Jewell","Jillian","Jimmie","Jimmy","Jo","Joan","Joana","Joanie","Joanne","Joannie","Joanny","Joany","Joaquin","Jocelyn","Jodie","Jody","Joe","Joel","Joelle","Joesph","Joey","Johan","Johann","Johanna","Johathan","John","Johnathan","Johnathon","Johnnie","Johnny","Johnpaul","Johnson","Jolie","Jon","Jonas","Jonatan","Jonathan","Jonathon","Jordan","Jordane","Jordi","Jordon","Jordy","Jordyn","Jorge","Jose","Josefa","Josefina","Joseph","Josephine","Josh","Joshua","Joshuah","Josiah","Josiane","Josianne","Josie","Josue","Jovan","Jovani","Jovanny","Jovany","Joy","Joyce","Juana","Juanita","Judah","Judd","Jude","Judge","Judson","Judy","Jules","Julia","Julian","Juliana","Julianne","Julie","Julien","Juliet","Julio","Julius","June","Junior","Junius","Justen","Justice","Justina","Justine","Juston","Justus","Justyn","Juvenal","Juwan","Kacey","Kaci","Kacie","Kade","Kaden","Kadin","Kaela","Kaelyn","Kaia","Kailee","Kailey","Kailyn","Kaitlin","Kaitlyn","Kale","Kaleb","Kaleigh","Kaley","Kali","Kallie","Kameron","Kamille","Kamren","Kamron","Kamryn","Kane","Kara","Kareem","Karelle","Karen","Kari","Kariane","Karianne","Karina","Karine","Karl","Karlee","Karley","Karli","Karlie","Karolann","Karson","Kasandra","Kasey","Kassandra","Katarina","Katelin","Katelyn","Katelynn","Katharina","Katherine","Katheryn","Kathleen","Kathlyn","Kathryn","Kathryne","Katlyn","Katlynn","Katrina","Katrine","Kattie","Kavon","Kay","Kaya","Kaycee","Kayden","Kayla","Kaylah","Kaylee","Kayleigh","Kayley","Kayli","Kaylie","Kaylin","Keagan","Keanu","Keara","Keaton","Keegan","Keeley","Keely","Keenan","Keira","Keith","Kellen","Kelley","Kelli","Kellie","Kelly","Kelsi","Kelsie","Kelton","Kelvin","Ken","Kendall","Kendra","Kendrick","Kenna","Kennedi","Kennedy","Kenneth","Kennith","Kenny","Kenton","Kenya","Kenyatta","Kenyon","Keon","Keshaun","Keshawn","Keven","Kevin","Kevon","Keyon","Keyshawn","Khalid","Khalil","Kian","Kiana","Kianna","Kiara","Kiarra","Kiel","Kiera","Kieran","Kiley","Kim","Kimberly","King","Kip","Kira","Kirk","Kirsten","Kirstin","Kitty","Kobe","Koby","Kody","Kolby","Kole","Korbin","Korey","Kory","Kraig","Kris","Krista","Kristian","Kristin","Kristina","Kristofer","Kristoffer","Kristopher","Kristy","Krystal","Krystel","Krystina","Kurt","Kurtis","Kyla","Kyle","Kylee","Kyleigh","Kyler","Kylie","Kyra","Lacey","Lacy","Ladarius","Lafayette","Laila","Laisha","Lamar","Lambert","Lamont","Lance","Landen","Lane","Laney","Larissa","Laron","Larry","Larue","Laura","Laurel","Lauren","Laurence","Lauretta","Lauriane","Laurianne","Laurie","Laurine","Laury","Lauryn","Lavada","Lavern","Laverna","Laverne","Lavina","Lavinia","Lavon","Lavonne","Lawrence","Lawson","Layla","Layne","Lazaro","Lea","Leann","Leanna","Leanne","Leatha","Leda","Lee","Leif","Leila","Leilani","Lela","Lelah","Leland","Lelia","Lempi","Lemuel","Lenna","Lennie","Lenny","Lenora","Lenore","Leo","Leola","Leon","Leonard","Leonardo","Leone","Leonel","Leonie","Leonor","Leonora","Leopold","Leopoldo","Leora","Lera","Lesley","Leslie","Lesly","Lessie","Lester","Leta","Letha","Letitia","Levi","Lew","Lewis","Lexi","Lexie","Lexus","Lia","Liam","Liana","Libbie","Libby","Lila","Lilian","Liliana","Liliane","Lilla","Lillian","Lilliana","Lillie","Lilly","Lily","Lilyan","Lina","Lincoln","Linda","Lindsay","Lindsey","Linnea","Linnie","Linwood","Lionel","Lisa","Lisandro","Lisette","Litzy","Liza","Lizeth","Lizzie","Llewellyn","Lloyd","Logan","Lois","Lola","Lolita","Loma","Lon","London","Lonie","Lonnie","Lonny","Lonzo","Lora","Loraine","Loren","Lorena","Lorenz","Lorenza","Lorenzo","Lori","Lorine","Lorna","Lottie","Lou","Louie","Louisa","Lourdes","Louvenia","Lowell","Loy","Loyal","Loyce","Lucas","Luciano","Lucie","Lucienne","Lucile","Lucinda","Lucio","Lucious","Lucius","Lucy","Ludie","Ludwig","Lue","Luella","Luigi","Luis","Luisa","Lukas","Lula","Lulu","Luna","Lupe","Lura","Lurline","Luther","Luz","Lyda","Lydia","Lyla","Lynn","Lyric","Lysanne","Mabel","Mabelle","Mable","Mac","Macey","Maci","Macie","Mack","Mackenzie","Macy","Madaline","Madalyn","Maddison","Madeline","Madelyn","Madelynn","Madge","Madie","Madilyn","Madisen","Madison","Madisyn","Madonna","Madyson","Mae","Maegan","Maeve","Mafalda","Magali","Magdalen","Magdalena","Maggie","Magnolia","Magnus","Maia","Maida","Maiya","Major","Makayla","Makenna","Makenzie","Malachi","Malcolm","Malika","Malinda","Mallie","Mallory","Malvina","Mandy","Manley","Manuel","Manuela","Mara","Marc","Marcel","Marcelina","Marcelino","Marcella","Marcelle","Marcellus","Marcelo","Marcia","Marco","Marcos","Marcus","Margaret","Margarete","Margarett","Margaretta","Margarette","Margarita","Marge","Margie","Margot","Margret","Marguerite","Maria","Mariah","Mariam","Marian","Mariana","Mariane","Marianna","Marianne","Mariano","Maribel","Marie","Mariela","Marielle","Marietta","Marilie","Marilou","Marilyne","Marina","Mario","Marion","Marisa","Marisol","Maritza","Marjolaine","Marjorie","Marjory","Mark","Markus","Marlee","Marlen","Marlene","Marley","Marlin","Marlon","Marques","Marquis","Marquise","Marshall","Marta","Martin","Martina","Martine","Marty","Marvin","Mary","Maryam","Maryjane","Maryse","Mason","Mateo","Mathew","Mathias","Mathilde","Matilda","Matilde","Matt","Matteo","Mattie","Maud","Maude","Maudie","Maureen","Maurice","Mauricio","Maurine","Maverick","Mavis","Max","Maxie","Maxime","Maximilian","Maximillia","Maximillian","Maximo","Maximus","Maxine","Maxwell","May","Maya","Maybell","Maybelle","Maye","Maymie","Maynard","Mayra","Mazie","Mckayla","Mckenna","Mckenzie","Meagan","Meaghan","Meda","Megane","Meggie","Meghan","Mekhi","Melany","Melba","Melisa","Melissa","Mellie","Melody","Melvin","Melvina","Melyna","Melyssa","Mercedes","Meredith","Merl","Merle","Merlin","Merritt","Mertie","Mervin","Meta","Mia","Micaela","Micah","Michael","Michaela","Michale","Micheal","Michel","Michele","Michelle","Miguel","Mikayla","Mike","Mikel","Milan","Miles","Milford","Miller","Millie","Milo","Milton","Mina","Minerva","Minnie","Miracle","Mireille","Mireya","Misael","Missouri","Misty","Mitchel","Mitchell","Mittie","Modesta","Modesto","Mohamed","Mohammad","Mohammed","Moises","Mollie","Molly","Mona","Monica","Monique","Monroe","Monserrat","Monserrate","Montana","Monte","Monty","Morgan","Moriah","Morris","Mortimer","Morton","Mose","Moses","Moshe","Mossie","Mozell","Mozelle","Muhammad","Muriel","Murl","Murphy","Murray","Mustafa","Mya","Myah","Mylene","Myles","Myra","Myriam","Myrl","Myrna","Myron","Myrtice","Myrtie","Myrtis","Myrtle","Nadia","Nakia","Name","Nannie","Naomi","Naomie","Napoleon","Narciso","Nash","Nasir","Nat","Natalia","Natalie","Natasha","Nathan","Nathanael","Nathanial","Nathaniel","Nathen","Nayeli","Neal","Ned","Nedra","Neha","Neil","Nelda","Nella","Nelle","Nellie","Nels","Nelson","Neoma","Nestor","Nettie","Neva","Newell","Newton","Nia","Nicholas","Nicholaus","Nichole","Nick","Nicklaus","Nickolas","Nico","Nicola","Nicolas","Nicole","Nicolette","Nigel","Nikita","Nikki","Nikko","Niko","Nikolas","Nils","Nina","Noah","Noble","Noe","Noel","Noelia","Noemi","Noemie","Noemy","Nola","Nolan","Nona","Nora","Norbert","Norberto","Norene","Norma","Norris","Norval","Norwood","Nova","Novella","Nya","Nyah","Nyasia","Obie","Oceane","Ocie","Octavia","Oda","Odell","Odessa","Odie","Ofelia","Okey","Ola","Olaf","Ole","Olen","Oleta","Olga","Olin","Oliver","Ollie","Oma","Omari","Omer","Ona","Onie","Opal","Ophelia","Ora","Oral","Oran","Oren","Orie","Orin","Orion","Orland","Orlando","Orlo","Orpha","Orrin","Orval","Orville","Osbaldo","Osborne","Oscar","Osvaldo","Oswald","Oswaldo","Otha","Otho","Otilia","Otis","Ottilie","Ottis","Otto","Ova","Owen","Ozella","Pablo","Paige","Palma","Pamela","Pansy","Paolo","Paris","Parker","Pascale","Pasquale","Pat","Patience","Patricia","Patrick","Patsy","Pattie","Paul","Paula","Pauline","Paxton","Payton","Pearl","Pearlie","Pearline","Pedro","Peggie","Penelope","Percival","Percy","Perry","Pete","Peter","Petra","Peyton","Philip","Phoebe","Phyllis","Pierce","Pierre","Pietro","Pink","Pinkie","Piper","Polly","Porter","Precious","Presley","Preston","Price","Prince","Princess","Priscilla","Providenci","Prudence","Queen","Queenie","Quentin","Quincy","Quinn","Quinten","Quinton","Rachael","Rachel","Rachelle","Rae","Raegan","Rafael","Rafaela","Raheem","Rahsaan","Rahul","Raina","Raleigh","Ralph","Ramiro","Ramon","Ramona","Randal","Randall","Randi","Randy","Ransom","Raoul","Raphael","Raphaelle","Raquel","Rashad","Rashawn","Rasheed","Raul","Raven","Ray","Raymond","Raymundo","Reagan","Reanna","Reba","Rebeca","Rebecca","Rebeka","Rebekah","Reece","Reed","Reese","Regan","Reggie","Reginald","Reid","Reilly","Reina","Reinhold","Remington","Rene","Renee","Ressie","Reta","Retha","Retta","Reuben","Reva","Rex","Rey","Reyes","Reymundo","Reyna","Reynold","Rhea","Rhett","Rhianna","Rhiannon","Rhoda","Ricardo","Richard","Richie","Richmond","Rick","Rickey","Rickie","Ricky","Rico","Rigoberto","Riley","Rita","River","Robb","Robbie","Robert","Roberta","Roberto","Robin","Robyn","Rocio","Rocky","Rod","Roderick","Rodger","Rodolfo","Rodrick","Rodrigo","Roel","Rogelio","Roger","Rogers","Rolando","Rollin","Roma","Romaine","Roman","Ron","Ronaldo","Ronny","Roosevelt","Rory","Rosa","Rosalee","Rosalia","Rosalind","Rosalinda","Rosalyn","Rosamond","Rosanna","Rosario","Roscoe","Rose","Rosella","Roselyn","Rosemarie","Rosemary","Rosendo","Rosetta","Rosie","Rosina","Roslyn","Ross","Rossie","Rowan","Rowena","Rowland","Roxane","Roxanne","Roy","Royal","Royce","Rozella","Ruben","Rubie","Ruby","Rubye","Rudolph","Rudy","Rupert","Russ","Russel","Russell","Rusty","Ruth","Ruthe","Ruthie","Ryan","Ryann","Ryder","Rylan","Rylee","Ryleigh","Ryley","Sabina","Sabrina","Sabryna","Sadie","Sadye","Sage","Saige","Sallie","Sally","Salma","Salvador","Salvatore","Sam","Samanta","Samantha","Samara","Samir","Sammie","Sammy","Samson","Sandra","Sandrine","Sandy","Sanford","Santa","Santiago","Santina","Santino","Santos","Sarah","Sarai","Sarina","Sasha","Saul","Savanah","Savanna","Savannah","Savion","Scarlett","Schuyler","Scot","Scottie","Scotty","Seamus","Sean","Sebastian","Sedrick","Selena","Selina","Selmer","Serena","Serenity","Seth","Shad","Shaina","Shakira","Shana","Shane","Shanel","Shanelle","Shania","Shanie","Shaniya","Shanna","Shannon","Shanny","Shanon","Shany","Sharon","Shaun","Shawn","Shawna","Shaylee","Shayna","Shayne","Shea","Sheila","Sheldon","Shemar","Sheridan","Sherman","Sherwood","Shirley","Shyann","Shyanne","Sibyl","Sid","Sidney","Sienna","Sierra","Sigmund","Sigrid","Sigurd","Silas","Sim","Simeon","Simone","Sincere","Sister","Skye","Skyla","Skylar","Sofia","Soledad","Solon","Sonia","Sonny","Sonya","Sophia","Sophie","Spencer","Stacey","Stacy","Stan","Stanford","Stanley","Stanton","Stefan","Stefanie","Stella","Stephan","Stephania","Stephanie","Stephany","Stephen","Stephon","Sterling","Steve","Stevie","Stewart","Stone","Stuart","Summer","Sunny","Susan","Susana","Susanna","Susie","Suzanne","Sven","Syble","Sydnee","Sydney","Sydni","Sydnie","Sylvan","Sylvester","Sylvia","Tabitha","Tad","Talia","Talon","Tamara","Tamia","Tania","Tanner","Tanya","Tara","Taryn","Tate","Tatum","Tatyana","Taurean","Tavares","Taya","Taylor","Teagan","Ted","Telly","Terence","Teresa","Terrance","Terrell","Terrence","Terrill","Terry","Tess","Tessie","Tevin","Thad","Thaddeus","Thalia","Thea","Thelma","Theo","Theodora","Theodore","Theresa","Therese","Theresia","Theron","Thomas","Thora","Thurman","Tia","Tiana","Tianna","Tiara","Tierra","Tiffany","Tillman","Timmothy","Timmy","Timothy","Tina","Tito","Titus","Tobin","Toby","Tod","Tom","Tomas","Tomasa","Tommie","Toney","Toni","Tony","Torey","Torrance","Torrey","Toy","Trace","Tracey","Tracy","Travis","Travon","Tre","Tremaine","Tremayne","Trent","Trenton","Tressa","Tressie","Treva","Trever","Trevion","Trevor","Trey","Trinity","Trisha","Tristian","Tristin","Triston","Troy","Trudie","Trycia","Trystan","Turner","Twila","Tyler","Tyra","Tyree","Tyreek","Tyrel","Tyrell","Tyrese","Tyrique","Tyshawn","Tyson","Ubaldo","Ulices","Ulises","Una","Unique","Urban","Uriah","Uriel","Ursula","Vada","Valentin","Valentina","Valentine","Valerie","Vallie","Van","Vance","Vanessa","Vaughn","Veda","Velda","Vella","Velma","Velva","Vena","Verda","Verdie","Vergie","Verla","Verlie","Vern","Verna","Verner","Vernice","Vernie","Vernon","Verona","Veronica","Vesta","Vicenta","Vicente","Vickie","Vicky","Victor","Victoria","Vida","Vidal","Vilma","Vince","Vincent","Vincenza","Vincenzo","Vinnie","Viola","Violet","Violette","Virgie","Virgil","Virginia","Virginie","Vita","Vito","Viva","Vivian","Viviane","Vivianne","Vivien","Vivienne","Vladimir","Wade","Waino","Waldo","Walker","Wallace","Walter","Walton","Wanda","Ward","Warren","Watson","Wava","Waylon","Wayne","Webster","Weldon","Wellington","Wendell","Wendy","Werner","Westley","Weston","Whitney","Wilber","Wilbert","Wilburn","Wiley","Wilford","Wilfred","Wilfredo","Wilfrid","Wilhelm","Wilhelmine","Will","Willa","Willard","William","Willie","Willis","Willow","Willy","Wilma","Wilmer","Wilson","Wilton","Winfield","Winifred","Winnifred","Winona","Winston","Woodrow","Wyatt","Wyman","Xander","Xavier","Xzavier","Yadira","Yasmeen","Yasmin","Yasmine","Yazmin","Yesenia","Yessenia","Yolanda","Yoshiko","Yvette","Yvonne","Zachariah","Zachary","Zachery","Zack","Zackary","Zackery","Zakary","Zander","Zane","Zaria","Zechariah","Zelda","Zella","Zelma","Zena","Zetta","Zion","Zita","Zoe","Zoey","Zoie","Zoila","Zola","Zora","Zula"];e.exports={generateUsername:function(){var e=i.randomElement(o),t=i.randomAlphanumStr(3);return"".concat(e,"-").concat(t)}}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return O}));var i=n(6),o=n(8),r=n(103),a=n(84),s=n(35),c=n(34),u=n(18),l=n(13),d=n(32),h=n(9),p=n.n(h),f=n(27),m=n(41),v=n.n(m),g=n(120),b=n.n(g),y=n(121),A=n(186),E=Object(u.getLogger)(e),O=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e,o,r){var a;return Object(i.a)(this,n),(a=t.call(this)).xmpp=e,a.eventEmitter=o,a.sessions={},a.jvbIceConfig=r.jvb,a.p2pIceConfig=r.p2p,a.mediaConstraints={offerToReceiveAudio:!0,offerToReceiveVideo:!0},a}return Object(o.a)(n,[{key:"init",value:function(e){Object(r.a)(Object(a.a)(n.prototype),"init",this).call(this,e),this.connection.addHandler(this.onJingle.bind(this),"urn:xmpp:jingle:1","iq","set",null,null)}},{key:"onJingle",value:function(e){var t=$(e).find("jingle").attr("sid"),n=$(e).find("jingle").attr("action"),i=e.getAttribute("from"),o=Object(l.$iq)({type:"result",to:i,id:e.getAttribute("id")});E.log("on jingle ".concat(n," from ").concat(i),e);var r=this.sessions[t];if("session-initiate"!==n){if(!r)return o.attrs({type:"error"}),o.c("error",{type:"cancel"}).c("item-not-found",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("unknown-session",{xmlns:"urn:xmpp:jingle:errors:1"}),E.warn("invalid session id",e),this.connection.send(o),!0;if(i!==r.remoteJid)return E.warn("jid mismatch for session id",t,r.remoteJid,e),o.attrs({type:"error"}),o.c("error",{type:"cancel"}).c("item-not-found",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("unknown-session",{xmlns:"urn:xmpp:jingle:errors:1"}),this.connection.send(o),!0}else if(void 0!==r)return o.attrs({type:"error"}),o.c("error",{type:"cancel"}).c("service-unavailable",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up(),E.warn("duplicate session id",t,e),this.connection.send(o),!0;var a=window.performance.now(),s="focus"!==l.Strophe.getResourceFromJid(i);switch(n){case"session-initiate":E.log("(TIME) received session-initiate:\t",a);var c=$(e).find("jingle>startmuted");if(c&&c.length>0){var u=c.attr("audio"),h=c.attr("video");this.eventEmitter.emit(p.a.START_MUTED_FROM_FOCUS,"true"===u,"true"===h)}E.info("Marking session from ".concat(i," as ").concat(s?"":"*not*"," P2P"));var m=s?this.p2pIceConfig:this.jvbIceConfig;r=new A.a($(e).find("jingle").attr("sid"),$(e).attr("to"),i,this.connection,this.mediaConstraints,JSON.parse(JSON.stringify(m)),s,!1),this.sessions[r.sid]=r,this.eventEmitter.emit(p.a.CALL_INCOMING,r,$(e).find(">jingle"),a);break;case"session-accept":this.eventEmitter.emit(p.a.CALL_ACCEPTED,r,$(e).find(">jingle"));break;case"content-modify":r.modifyContents($(e).find(">jingle"));break;case"transport-info":this.eventEmitter.emit(p.a.TRANSPORT_INFO,r,$(e).find(">jingle"));break;case"session-terminate":E.log("terminating...",r.sid);var g=null,b=null;$(e).find(">jingle>reason").length&&(g=$(e).find(">jingle>reason>:first")[0].tagName,b=$(e).find(">jingle>reason>text").text()),this.terminate(r.sid,g,b),this.eventEmitter.emit(p.a.CALL_ENDED,r,g,b);break;case"transport-replace":E.info("(TIME) Start transport replace:\t",a),f.a.sendAnalytics(Object(d.G)(d.f,{p2p:s,value:a})),r.replaceTransport($(e).find(">jingle"),(function(){var e=window.performance.now();E.info("(TIME) Transport replace success:\t",e),f.a.sendAnalytics(Object(d.G)(d.g,{p2p:s,value:e}))}),(function(e){v.a.callErrorHandler(e),E.error("Transport replace failed",e),r.sendTransportReject()}));break;case"addsource":case"source-add":r.addRemoteStream($(e).find(">jingle>content"));break;case"removesource":case"source-remove":r.removeRemoteStream($(e).find(">jingle>content"));break;default:E.warn("jingle action not implemented",n),o.attrs({type:"error"}),o.c("error",{type:"cancel"}).c("bad-request",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up()}return this.connection.send(o),!0}},{key:"newP2PJingleSession",value:function(e,t){var n=new A.a(b.a.randomHexString(12),e,t,this.connection,this.mediaConstraints,this.p2pIceConfig,!0,!0);return this.sessions[n.sid]=n,n}},{key:"terminate",value:function(e,t,n){this.sessions.hasOwnProperty(e)&&("ended"!==this.sessions[e].state&&this.sessions[e].onTerminated(t,n),delete this.sessions[e])}},{key:"getStunAndTurnCredentials",value:function(){var e=this;this.connection.sendIQ(Object(l.$iq)({type:"get",to:this.xmpp.options.hosts.domain}).c("services",{xmlns:"urn:xmpp:extdisco:2"}),(function(t){return e.onReceiveStunAndTurnCredentials(t)}),(function(t){E.warn("getting turn credentials with extdisco:2 failed, trying extdisco:1",t),e.connection.sendIQ(Object(l.$iq)({type:"get",to:e.xmpp.options.hosts.domain}).c("services",{xmlns:"urn:xmpp:extdisco:1"}),(function(t){return e.onReceiveStunAndTurnCredentials(t)}),(function(e){E.warn("getting turn credentials failed",e),E.warn("is mod_turncredentials or similar installed and configured?")}))}))}},{key:"onReceiveStunAndTurnCredentials",value:function(e){var t=[];$(e).find(">services>service").each((function(e,n){var i={},o=(n=$(n)).attr("type");switch(o){case"stun":i.urls="stun:".concat(n.attr("host")),n.attr("port")&&(i.urls+=":".concat(n.attr("port"))),t.push(i);break;case"turn":case"turns":i.urls="".concat(o,":"),i.username=n.attr("username"),i.urls+=n.attr("host"),n.attr("port")&&(i.urls+=":".concat(n.attr("port")));var r=n.attr("transport");r&&"udp"!==r&&(i.urls+="?transport=".concat(r)),i.credential=n.attr("password")||i.credential,t.push(i)}}));for(var n,i=this.xmpp.options,o=t.length-1;o>0;o--){var r=Math.floor(Math.random()*(o+1)),a=t[o];t[o]=t[r],t[r]=a}return n=i.useTurnUdp?function(e){return e.urls.startsWith("turn")}:function(e){return e.urls.startsWith("turn")&&e.urls.indexOf("transport=tcp")>=0},this.jvbIceConfig.iceServers=t.filter(n),this.p2pIceConfig.iceServers=t,t.length>0}},{key:"getLog",value:function(){var e=this,t={};return Object.keys(this.sessions).forEach((function(n){var i=e.sessions[n].peerconnection;i&&i.updateLog&&(t["jingle_".concat(n)]={updateLog:i.updateLog,stats:i.stats,url:window.location.href})})),t}}]),n}(y.b)}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u}));var i=n(6),o=n(8),r=n(359),a=n.n(r),s=n(18),c=Object(s.getLogger)(e),u=function(){function e(){Object(i.a)(this,e),this._queue=a.a.queue(this._processQueueTasks.bind(this),1),this._stopped=!1}return Object(o.a)(e,[{key:"clear",value:function(){this._queue.kill()}},{key:"_processQueueTasks",value:function(e,t){try{e(t)}catch(n){c.error("Task failed: ".concat(n)),t(n)}}},{key:"push",value:function(e,t){this._stopped?t&&t(new Error("The queue has been stopped")):this._queue.push(e,t)}},{key:"shutdown",value:function(){this._stopped=!0}}]),e}()}).call(this,"/index.js")},,function(e,t){e.exports={integerHash:function(e){if(!e)return 0;var t,n=0;for(t=0;t<e.length;t++)n+=e.charCodeAt(t)*Math.pow(31,e.length-1-t),n=Math.abs(0|n);return n}}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return d}));var i=n(6),o=n(8),r=n(35),a=n(34),s=n(18),c=n(72),u=n(108),l=Object(s.getLogger)(e),d=function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(e,o,r,a,s,c,u){var l;return Object(i.a)(this,n),(l=t.call(this)).sid=e,l.localJid=o,l.remoteJid=r,l.connection=a,l.mediaConstraints=s,l.iceConfig=c,l.isInitiator=u,l.usedrip=!0,l.dripContainer=[],l.room=null,l.state=null,l.rtc=null,l}return Object(o.a)(n,[{key:"initiatorJid",get:function(){return this.isInitiator?this.localJid:this.remoteJid}},{key:"responderJid",get:function(){return this.isInitiator?this.remoteJid:this.localJid}},{key:"initialize",value:function(e,t,n){if(null!==this.state){var i="attempt to initiate on session ".concat(this.sid,"\n                   in state ").concat(this.state);throw l.error(i),new Error(i)}this.room=e,this.rtc=t,this.state=u.c,this.doInitialize(n)}},{key:"doInitialize",value:function(e){}},{key:"addIceCandidates",value:function(e){}},{key:"getState",value:function(){return this.state}},{key:"addSources",value:function(e){}},{key:"removeSources",value:function(e){}},{key:"terminate",value:function(e,t,n){}},{key:"acceptOffer",value:function(e,t,n){}},{key:"_getInitiatorJid",value:function(){return this.isInitiator?this.localJid:this.remoteJid}}]),n}(c.a)}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return h}));var i=n(6),o=n(8),r=n(35),a=n(34),s=n(18),c=n(19),u=n(130),l=n(363),d=Object(s.getLogger)(e),h=function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.call(this)).ssrcOwners=new Map,e.chatRoom=null,e}return Object(o.a)(n,[{key:"setChatRoom",value:function(e){var t=this,n=this.chatRoom;this.chatRoom=e,n&&(n.removePresenceListener("audiomuted",this._audioMuteHandler),n.removePresenceListener("videomuted",this._videoMuteHandler),n.removePresenceListener("videoType",this._videoTypeHandler)),e&&(this._audioMuteHandler=function(e,n){t.eventEmitter.emit(u.a,n,c.a,"true"===e.value)},e.addPresenceListener("audiomuted",this._audioMuteHandler),this._videoMuteHandler=function(e,n){t.eventEmitter.emit(u.a,n,c.c,"true"===e.value)},e.addPresenceListener("videomuted",this._videoMuteHandler),this._videoTypeHandler=function(e,n){t.eventEmitter.emit(u.b,n,e.value)},e.addPresenceListener("videoType",this._videoTypeHandler))}},{key:"getPeerMediaInfo",value:function(e,t){if(this.chatRoom)return this.chatRoom.getMediaPresenceInfo(e,t);d.error("Requested peer media info, before room was set")}},{key:"getSSRCOwner",value:function(e){return this.ssrcOwners.get(e)}},{key:"setSSRCOwner",value:function(e,t){if("number"!==typeof e)throw new TypeError("SSRC(".concat(e,") must be a number"));this.ssrcOwners.set(e,t)}}]),n}(l.a)}).call(this,"/index.js")},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(6),o=n(8),r=n(35),a=n(34),s=function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"getSSRCOwner",value:function(e){throw new Error("not implemented")}},{key:"getPeerMediaInfo",value:function(e,t){throw new Error("not implemented")}}]),n}(n(72).a)},function(e,t,n){"use strict";var i=n(6),o=n(8),r=n(103),a=n(84),s=n(35),c=n(34),u=n(13),l=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.call(this)).log=[],e}return Object(o.a)(n,[{key:"init",value:function(e){Object(r.a)(Object(a.a)(n.prototype),"init",this).call(this,e),this.connection.rawInput=this.logIncoming.bind(this),this.connection.rawOutput=this.logOutgoing.bind(this)}},{key:"logIncoming",value:function(e){this.log.push([(new Date).getTime(),"incoming",e])}},{key:"logOutgoing",value:function(e){this.log.push([(new Date).getTime(),"outgoing",e])}}]),n}(n(121).b);t.a=function(){u.Strophe.addConnectionPlugin("logger",new l)}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return f}));var i=n(6),o=n(8),r=n(103),a=n(84),s=n(35),c=n(34),u=n(18),l=n(13),d=n(121),h=Object(u.getLogger)(e),p="urn:xmpp:rayo:1",f=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"init",value:function(e){Object(r.a)(Object(a.a)(n.prototype),"init",this).call(this,e),this.connection.addHandler(this.onRayo.bind(this),p,"iq","set",null,null)}},{key:"onRayo",value:function(e){h.info("Rayo IQ",e)}},{key:"dial",value:function(e,t,n,i,o){var r=this;return new Promise((function(a,s){if(o){var c=Object(l.$iq)({type:"set",to:o});c.c("dial",{xmlns:p,to:e,from:t}),c.c("header",{name:"JvbRoomName",value:n}).up(),i&&i.length&&c.c("header",{name:"JvbRoomPassword",value:i}).up(),r.connection.sendIQ(c,(function(e){h.info("Dial result ",e);var t=$(e).find("ref").attr("uri");r.callResource=t.substr("xmpp:".length),h.info("Received call resource: ".concat(r.callResource)),a()}),(function(e){h.info("Dial error ",e),s(e)}))}else s(new Error("Internal error!"))}))}},{key:"hangup",value:function(){var e=this;return new Promise((function(t,n){if(!e.callResource)return n(new Error("No call in progress")),void h.warn("No call in progress");var i=Object(l.$iq)({type:"set",to:e.callResource});i.c("hangup",{xmlns:p}),e.connection.sendIQ(i,(function(n){h.info("Hangup result ",n),e.callResource=null,t()}),(function(t){h.info("Hangup error ",t),e.callResource=null,n(new Error("Hangup error "))}))}))}}]),n}(d.b)}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){var i=n(18),o=n(13),r=n(41),a=n.n(r),s=Object(i.getLogger)(e),c=-1,u=/request id \d+.\d+ got 200/,l=/request errored, status: (\d+), number of errors: \d+/;t.a=function(){o.Strophe.log=function(e,t){switch(s.trace("Strophe",e,t),"string"===typeof t&&-1!==t.indexOf("Request ")&&-1!==t.indexOf("timed out (secondary), restarting")&&(e=o.Strophe.LogLevel.WARN),e){case o.Strophe.LogLevel.DEBUG:-1!==c&&u.test(t)&&(s.debug("Reset lastErrorStatus"),c=-1);break;case o.Strophe.LogLevel.WARN:s.warn("Strophe: ".concat(t));var n=l.exec(t);n&&2===n.length&&(c=parseInt(n[1],10),s.debug("lastErrorStatus set to: ".concat(c)));break;case o.Strophe.LogLevel.ERROR:case o.Strophe.LogLevel.FATAL:t="Strophe: ".concat(t),a.a.callErrorHandler(new Error(t)),s.error(t)}},o.Strophe.getLastErrorStatus=function(){return c},o.Strophe.getStatusString=function(e){switch(e){case o.Strophe.Status.BINDREQUIRED:return"BINDREQUIRED";case o.Strophe.Status.ERROR:return"ERROR";case o.Strophe.Status.CONNECTING:return"CONNECTING";case o.Strophe.Status.CONNFAIL:return"CONNFAIL";case o.Strophe.Status.AUTHENTICATING:return"AUTHENTICATING";case o.Strophe.Status.AUTHFAIL:return"AUTHFAIL";case o.Strophe.Status.CONNECTED:return"CONNECTED";case o.Strophe.Status.DISCONNECTED:return"DISCONNECTED";case o.Strophe.Status.DISCONNECTING:return"DISCONNECTING";case o.Strophe.Status.ATTACHED:return"ATTACHED";default:return"unknown"}}}}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return p}));var i=n(14),o=n(6),r=n(8),a=n(18),s=n(10),c=n(71),u=n.n(c),l=n(19),d=n(20),h=Object(a.getLogger)(e),p=function(){function e(t,n){var i=this;Object(o.a)(this,e),this.conference=t,this.options=n,this.disabledCodec=n.disabledCodec===u.a.VP8?void 0:this._getCodecMimeType(n.disabledCodec);var r=this._getCodecMimeType(n.jvbCodec),a=this._getCodecMimeType(n.p2pCodec);this.jvbPreferredCodec=r&&this._isCodecSupported(r)?r:u.a.VP8,this.p2pPreferredCodec=a&&this._isCodecSupported(a)?a:u.a.VP8,h.debug("Codec preferences for the conference are JVB: ".concat(this.jvbPreferredCodec,",\n            P2P: ").concat(this.p2pPreferredCodec)),d.a.isFirefox()&&this.jvbPreferredCodec===u.a.VP9&&(this.jvbPreferredCodec=u.a.VP8),this.conference.on(s.USER_JOINED,(function(){return i._selectPreferredCodec()})),this.conference.on(s.USER_LEFT,(function(){return i._selectPreferredCodec()})),this.conference.on(s._MEDIA_SESSION_STARTED,(function(e){return i._onMediaSessionStared(e)}))}return Object(r.a)(e,[{key:"_getCodecMimeType",value:function(e){return"string"===typeof e?Object.values(u.a).find((function(t){return t===e.toLowerCase()})):null}},{key:"_isCodecSupported",value:function(e){return!(!d.a.isFirefox()&&!d.a.isReactNative())||window.RTCRtpReceiver&&window.RTCRtpReceiver.getCapabilities&&window.RTCRtpReceiver.getCapabilities("video").codecs.some((function(t){return t.mimeType.toLowerCase()==="video/".concat(e)}))}},{key:"_onMediaSessionStared",value:function(e){var t=e.isP2P?this.p2pPreferredCodec:this.jvbPreferredCodec,n=this.disabledCodec&&this._isCodecSupported(this.disabledCodec)?this.disabledCodec:null;this._selectPreferredCodec(e,t,n)}},{key:"_selectPreferredCodec",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=e||this.conference.jvbJingleSession,r=t||this.jvbPreferredCodec,a=r;if(o&&!o.isP2P&&!this.options.enforcePreferredCodec){var s,c=this.conference.getParticipants().map((function(e){return e.getId()})),u=Object(i.a)(c);try{for(u.s();!(s=u.n()).done;){var d=s.value,h=o.signalingLayer.getPeerMediaInfo(d,l.c);h&&h.codecType&&h.codecType!==r&&(a=h.codecType)}}catch(p){u.e(p)}finally{u.f()}}o&&o.setVideoCodecs(a,n)}},{key:"getPreferredCodec",value:function(){return this.jvbPreferredCodec}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return f}));var i=n(7),o=n(6),r=n(8),a=n(18),s=n(31),c=n.n(s),u=n(32),l=n(27),d=n(41),h=n.n(d),p=Object(a.getLogger)(e),f=function(){function e(t,n,i){if(Object(o.a)(this,e),!t&&!n)throw new TypeError("At least peerconnection or wsUrl must be given");if(t&&n)throw new TypeError("Just one of peerconnection or wsUrl must be given");if(t?p.debug("constructor() with peerconnection"):p.debug('constructor() with wsUrl:"'.concat(n,'"')),this._channel=null,this._eventEmitter=i,this._mode=null,this._areRetriesEnabled=!1,this._closedFromClient=!1,t){var r=t.createDataChannel("JVB data channel",{protocol:"http://jitsi.org/protocols/colibri"});this._handleChannel(r),this._mode="datachannel"}else n&&(this._areRetriesEnabled=!0,this._wsUrl=n,this._initWebSocket())}return Object(r.a)(e,[{key:"_initWebSocket",value:function(){var e=new WebSocket(this._wsUrl);this._handleChannel(e),this._mode="websocket"}},{key:"_startConnectionRetries",value:function(){var e=this,t=1;this._retryTimeout=setTimeout((function n(){e.isOpen()||(e._initWebSocket(e._wsUrl),t=Math.min(2*t,60),e._retryTimeout=setTimeout(n,1e3*t))}),1e3*t)}},{key:"_stopConnectionRetries",value:function(){this._retryTimeout&&(clearTimeout(this._retryTimeout),this._retryTimeout=void 0)}},{key:"_retryWebSocketConnection",value:function(e){var t=this;if(this._areRetriesEnabled){var n=e.code,i=e.reason;l.a.sendAnalytics(Object(u.y)(n,i)),this._areRetriesEnabled=!1,this._eventEmitter.once(c.a.DATA_CHANNEL_OPEN,(function(){t._stopConnectionRetries(),t._areRetriesEnabled=!0})),this._startConnectionRetries()}}},{key:"mode",get:function(){return this._mode}},{key:"close",value:function(){if(this._closedFromClient=!0,this._stopConnectionRetries(),this._areRetriesEnabled=!1,this._channel){try{this._channel.close()}catch(e){}this._channel=null}}},{key:"isOpen",value:function(){return this._channel&&("open"===this._channel.readyState||this._channel.readyState===WebSocket.OPEN)}},{key:"sendEndpointStatsMessage",value:function(e){this._send(Object(i.a)({colibriClass:"EndpointStats"},e))}},{key:"sendMessage",value:function(e,t){this._send({colibriClass:"EndpointMessage",msgPayload:t,to:e})}},{key:"sendSetLastNMessage",value:function(e){p.log("Sending lastN=".concat(e,".")),this._send({colibriClass:"LastNChangedEvent",lastN:e})}},{key:"sendSetPercieveEventMessage",value:function(e){var t={colibriClass:"PercieveEvent",perceptibles:e};this._send(t),p.log("Channel PerceptEvent peceptible endpoints set to:",e)}},{key:"sendSelectedEndpointsMessage",value:function(e){p.log("Sending selected endpoints: ".concat(e,".")),this._send({colibriClass:"SelectedEndpointsChangedEvent",selectedEndpoints:e})}},{key:"sendReceiverVideoConstraintMessage",value:function(e){p.log("Sending ReceiverVideoConstraint with maxFrameHeight=".concat(e,"px")),this._send({colibriClass:"ReceiverVideoConstraint",maxFrameHeight:e})}},{key:"sendNewReceiverVideoConstraintsMessage",value:function(e){p.log("Sending ReceiverVideoConstraints with ".concat(JSON.stringify(e))),this._send(Object(i.a)({colibriClass:"ReceiverVideoConstraints"},e))}},{key:"sendVideoTypeMessage",value:function(e){p.debug("Sending VideoTypeMessage with video type as ".concat(e)),this._send({colibriClass:"VideoTypeMessage",videoType:e})}},{key:"_handleChannel",value:function(e){var t=this,n=this._eventEmitter;e.onopen=function(){p.info("".concat(t._mode," channel opened")),n.emit(c.a.DATA_CHANNEL_OPEN)},e.onerror=function(e){"websocket"!==t._mode&&p.error("Channel error: ".concat(e.message))},e.onmessage=function(e){var t,i=e.data;try{t=JSON.parse(i)}catch(v){return h.a.callErrorHandler(v),void p.error("Failed to parse channel message as JSON: ",i,v)}var o=t.colibriClass;switch(o){case"DominantSpeakerEndpointChangeEvent":var r=t,a=r.dominantSpeakerEndpoint,s=r.previousSpeakers,u=void 0===s?[]:s;p.debug("Dominant speaker: ".concat(a,", previous speakers: ").concat(u)),n.emit(c.a.DOMINANT_SPEAKER_CHANGED,a,u);break;case"EndpointConnectivityStatusChangeEvent":var l=t.endpoint,d="true"===t.active;p.info("Endpoint connection status changed: ".concat(l," active=").concat(d)),n.emit(c.a.ENDPOINT_CONN_STATUS_CHANGED,l,d);break;case"EndpointMessage":n.emit(c.a.ENDPOINT_MESSAGE_RECEIVED,t.from,t.msgPayload);break;case"EndpointStats":n.emit(c.a.ENDPOINT_STATS_RECEIVED,t.from,t);break;case"LastNEndpointsChangeEvent":var f=t.lastNEndpoints;p.info("New forwarded endpoints: ".concat(f)),n.emit(c.a.LASTN_ENDPOINT_CHANGED,f);break;case"SenderVideoConstraints":var m=t.videoConstraints;m&&(p.info("SenderVideoConstraints: ".concat(JSON.stringify(m))),n.emit(c.a.SENDER_VIDEO_CONSTRAINTS_CHANGED,m));break;case"ServerHello":p.info("Received ServerHello, version=".concat(t.version,"."));break;default:p.debug("Channel JSON-formatted message: ",t),n.emit("rtc.datachannel.".concat(o),t)}},e.onclose=function(e){p.info("Channel closed by ".concat(t._closedFromClient?"client":"server")),"websocket"===t._mode&&(t._closedFromClient||(p.error("Channel closed: ".concat(e.code," ").concat(e.reason)),t._retryWebSocketConnection(e))),t._channel=null},this._channel=e}},{key:"_send",value:function(e){var t=this._channel;if(!this.isOpen())throw p.error("Bridge Channel send: no opened channel."),new Error("No opened channel");t.send(JSON.stringify(e))}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return D}));var i=n(69),o=n(14),r=n(461),a=n(18),s=n(73),c=n.n(s),u=n(71),l=n(38),d=n.n(l),h=n(19),p=n(31),f=n.n(p),m=n(130),v=n(47),g=n(20),b=n(370),y=n(371),A=n(65),E=n(33),O=n(372),S=n(97),C=n(41),_=n(373),j=n(43),T=n(40),k=n(195),I=Object(a.getLogger)(e),R="maintain-framerate",w=25e5;function D(e,t,i,o,a,s,c){var u=this;this.audioTransferActive=!(!0===c.startSilent),this._dtmfSender=void 0,this._dtmfTonesQueue=[],this.videoTransferActive=!0,this.rtc=e,this.id=t,this.isP2P=s,this.remoteTracks=new Map,this.localTracks=new Map,this._addedStreams=[],this.localSSRCs=new Map,this.localUfrag=null,this.remoteUfrag=null,this.signalingLayer=i,this._peerVideoTypeChanged=this._peerVideoTypeChanged.bind(this),this.signalingLayer.on(m.b,this._peerVideoTypeChanged),this._peerMutedChanged=this._peerMutedChanged.bind(this),this.signalingLayer.on(m.a,this._peerMutedChanged),this.options=c;var l=a||{};l.optional=l.optional||[],Array.isArray(l.optional)?l.optional.push({rtcStatsSFUP2P:this.isP2P}):I.warn("Optional param is not an array, rtcstats p2p data is omitted."),this.peerconnection=new T.a.RTCPeerConnectionType(o,l);var d={low:2e5,standard:7e5,high:w};this.videoBitrates=this.options.videoQuality&&this.options.videoQuality.maxBitratesVideo?this.options.videoQuality.maxBitratesVideo:d,this.tpcUtils=new k.b(this,this.videoBitrates),this.updateLog=[],this.stats={},this.statsinterval=null,this._usesUnifiedPlan=c.usesUnifiedPlan,this._usesTransceiverCodecPreferences=g.a.supportsCodecPreferences()&&this._usesUnifiedPlan,this._usesTransceiverCodecPreferences&&I.info("Using RTCRtpTransceiver#setCodecPreferences for codec selection"),this.maxstats=c.maxstats,this.interop=new r.a;var h=n(505);this.simulcast=new h({numOfLayers:k.a.length,explodeRemoteSimulcast:!1,usesUnifiedPlan:this._usesUnifiedPlan}),this.sdpConsistency=new O.a(this.toString()),this.localSdpMunger=new b.a(this,this.rtc.getLocalEndpointId()),this.eventEmitter=e.eventEmitter,this.rtxModifier=new y.a,this.senderVideoMaxHeight=null,this.trace=function(e,t){I.debug(e,t),u.updateLog.push({time:new Date,type:e,value:t||""})},this.onicecandidate=null,this.peerconnection.onicecandidate=function(e){u.trace("onicecandidate",JSON.stringify(e.candidate,null," ")),null!==u.onicecandidate&&u.onicecandidate(e)},this._usesUnifiedPlan?(this.onTrack=function(e){var t=e.streams[0];u._remoteTrackAdded(t,e.track,e.transceiver),t.addEventListener("removetrack",(function(e){u._remoteTrackRemoved(t,e.track)}))},this.peerconnection.addEventListener("track",this.onTrack)):(this.peerconnection.onaddstream=function(e){return u._remoteStreamAdded(e.stream)},this.peerconnection.onremovestream=function(e){return u._remoteStreamRemoved(e.stream)}),this.onsignalingstatechange=null,this.peerconnection.onsignalingstatechange=function(e){u.trace("onsignalingstatechange",u.signalingState),null!==u.onsignalingstatechange&&u.onsignalingstatechange(e)},this.oniceconnectionstatechange=null,this.peerconnection.oniceconnectionstatechange=function(e){u.trace("oniceconnectionstatechange",u.iceConnectionState),null!==u.oniceconnectionstatechange&&u.oniceconnectionstatechange(e)},this.onnegotiationneeded=null,this.peerconnection.onnegotiationneeded=function(e){u.trace("onnegotiationneeded"),null!==u.onnegotiationneeded&&u.onnegotiationneeded(e)},this.ondatachannel=null,this.peerconnection.ondatachannel=function(e){u.trace("ondatachannel"),null!==u.ondatachannel&&u.ondatachannel(e)},this.maxstats&&(this.statsinterval=window.setInterval((function(){u.getStats().then((function(e){if("function"===typeof(null===e||void 0===e?void 0:e.result))for(var t=e.result(),n=function(e){var n=t[e];n.names().forEach((function(e){u._processStat(n,e,n.stat(e))}))},i=0;i<t.length;++i)n(i);else e.forEach((function(e){return u._processStat(e,"",e)}))}))}),1e3)),I.info("Create new ".concat(this))}D.prototype._processStat=function(e,t,n){var i="".concat(e.id,"-").concat(t),o=this.stats[i],r=new Date;o||(this.stats[i]=o={startTime:r,endTime:r,values:[],times:[]}),o.values.push(n),o.times.push(r.getTime()),o.values.length>this.maxstats&&(o.values.shift(),o.times.shift()),o.endTime=r};var N=function(e){return"undefined"===typeof e||null===e?"":"type: ".concat(e.type,"\r\n").concat(e.sdp)};D.prototype.getConnectionState=function(){var e=this.peerconnection.iceConnectionState;return"completed"===e?"connected":e},D.prototype.getDesiredMediaDirection=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.hasAnyTracksOfType(e);if(this._usesUnifiedPlan)return t?n?d.a.SENDRECV:d.a.SENDONLY:n?d.a.RECVONLY:d.a.INACTIVE;var i=e===h.a?this.audioTransferActive:this.videoTransferActive;return i?n?d.a.SENDRECV:d.a.RECVONLY:d.a.INACTIVE},D.prototype._getReceiversByEndpointIds=function(e,t){var n,i=[],r=Object(o.a)(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;i=i.concat(this.getRemoteTracks(a,t))}}catch(c){r.e(c)}finally{r.f()}var s=i.map((function(e){var t;return null===(t=e.track)||void 0===t?void 0:t.id}));return this.peerconnection.getReceivers().filter((function(e){return e.track&&e.track.kind===t&&s.find((function(t){return t===e.track.id}))}))},D.prototype.isSimulcastOn=function(){return!this.options.disableSimulcast},D.prototype._peerVideoTypeChanged=function(e,t){if(e){var n=this.getRemoteTracks(e,h.c);n.length&&n[0]._setVideoType(t)}else I.error("".concat(this," No endpointID on peerVideoTypeChanged"))},D.prototype._peerMutedChanged=function(e,t,n){if(e){var i=this.getRemoteTracks(e,t);i.length&&i[0].setMute(n)}else I.error("".concat(this," On peerMuteChanged - no endpoint ID"))},D.prototype.getAudioLevels=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={},n=e.length?this._getReceiversByEndpointIds(e,h.a):this.peerconnection.getReceivers().filter((function(e){return e.track&&e.track.kind===h.a&&e.track.enabled}));return n.forEach((function(e){var n=e.getSynchronizationSources();n&&n.length&&(t[n[0].source]=n[0].audioLevel)})),t},D.prototype.getLocalTracks=function(e){var t=Array.from(this.localTracks.values());return void 0!==e&&(t=t.filter((function(t){return t.getType()===e}))),t},D.prototype.getLocalVideoTrack=function(){return this.getLocalTracks(h.c)[0]},D.prototype.hasAnyTracksOfType=function(e){if(!e)throw new Error('"mediaType" is required');return this.getLocalTracks(e).length>0},D.prototype.getRemoteTracks=function(e,t){var n,i=[],r=e?[e]:this.remoteTracks.keys(),a=Object(o.a)(r);try{for(a.s();!(n=a.n()).done;){var s=n.value,c=this.remoteTracks.get(s);if(c){var u,l=Object(o.a)(c.keys());try{for(l.s();!(u=l.n()).done;){var d=u.value;if(!t||t===d){var h=c.get(d);h&&i.push(h)}}}catch(p){l.e(p)}finally{l.f()}}}}catch(p){a.e(p)}finally{a.f()}return i},D.prototype.getRemoteSourceInfoByParticipant=function(e){var t=[],n=this.getRemoteTracks(e);if(null===n||void 0===n||!n.length)return t;var i=n.map((function(e){return e.getSSRC()})),r=new A.a(this.remoteDescription.sdp);return i.forEach((function(e,n){var i,a=Object(o.a)(r.media);try{for(a.s();!(i=a.n()).done;){var s=i.value,c="",u=E.a.findLines(s,"a=ssrc:".concat(e));if(u.length){t[n]||(t[n]="");var l=E.a.findLines(s,"a=ssrc-group:FID ".concat(e));if(l.length){var d=l[0].split(" ")[2];c+="".concat(l[0],"\r\n"),u=u.concat(E.a.findLines(s,"a=ssrc:".concat(d)))}t[n]+="".concat(u.join("\r\n"),"\r\n"),t[n]+=c}}}catch(h){a.e(h)}finally{a.f()}})),t},D.prototype.getTargetVideoBitrates=function(){var e=this.getConfiguredVideoCodec();return this.videoBitrates[e.toUpperCase()]||this.videoBitrates},D.prototype.getTrackBySSRC=function(e){if("number"!==typeof e)throw new Error("SSRC ".concat(e," is not a number"));var t,n=Object(o.a)(this.localTracks.values());try{for(n.s();!(t=n.n()).done;){var i=t.value;if(this.getLocalSSRC(i)===e)return i}}catch(c){n.e(c)}finally{n.f()}var r,a=Object(o.a)(this.getRemoteTracks());try{for(a.s();!(r=a.n()).done;){var s=r.value;if(s.getSSRC()===e)return s}}catch(c){a.e(c)}finally{a.f()}return null},D.prototype.getSsrcByTrackId=function(e){var t=function(t){return t.getTrack().id===e},n=this.getLocalTracks().find(t);if(n)return this.getLocalSSRC(n);var i=this.getRemoteTracks().find(t);return i?i.getSSRC():null},D.prototype._remoteStreamAdded=function(e){var t=this,n=j.a.getStreamID(e);if(j.a.isUserStreamById(n)){g.a.isChromiumBased()&&(e.onaddtrack=function(n){t._remoteTrackAdded(e,n.track)},e.onremovetrack=function(n){t._remoteTrackRemoved(e,n.track)});var i,r=e.getAudioTracks(),a=Object(o.a)(r);try{for(a.s();!(i=a.n()).done;){var s=i.value;this._remoteTrackAdded(e,s)}}catch(h){a.e(h)}finally{a.f()}var c,u=e.getVideoTracks(),l=Object(o.a)(u);try{for(l.s();!(c=l.n()).done;){var d=c.value;this._remoteTrackAdded(e,d)}}catch(h){l.e(h)}finally{l.f()}}else I.info("".concat(this," ignored remote 'stream added' event for non-user stream[id=").concat(n,"]"))},D.prototype._remoteTrackAdded=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=j.a.getStreamID(e),o=t.kind;if(this.isP2P||j.a.isUserStreamById(i))if(I.info("".concat(this," adding remote track for stream[id=").concat(i,",type=").concat(o,"]")),o){var r,a=this._usesUnifiedPlan?new A.a(this.peerconnection.remoteDescription.sdp):new A.a(this.remoteDescription.sdp);if(this._usesUnifiedPlan)if(n&&n.mid){var s=n.mid;r=a.media.filter((function(e){return E.a.findLine(e,"a=mid:".concat(s))}))}else r=a.media.filter((function(e){var t=E.a.findLine(e,"a=msid:");return"undefined"!==typeof t&&i===t.substring(7).split(" ")[0]}));else r=a.media.filter((function(e){return e.startsWith("m=".concat(o))}));if(r.length){var c=E.a.findLines(r[0],"a=ssrc:");if((c=c.filter((function(e){return-1!==e.indexOf("msid:".concat(i))}))).length){var u=c.map((function(e){return Number(e.substring(7).split(" ")[0])})),l=u[0],d=this.signalingLayer.getSSRCOwner(l);if(isNaN(l)||l<0)C.callErrorHandler(new Error("Invalid SSRC for remote stream[ssrc=".concat(l,",id=").concat(i,",type=").concat(o,"]")));else if(d){I.info("".concat(this," creating remote track[endpoint=").concat(d,",ssrc=").concat(l,",type=").concat(o,"]"));var h=this.signalingLayer.getPeerMediaInfo(d,o);if(h){var p=h.muted,f=h.videoType;this._createRemoteTrack(d,e,t,o,f,u,p)}else C.callErrorHandler(new Error("".concat(this,": no peer media info available for ").concat(d)))}else C.callErrorHandler(new Error("No SSRC owner known for remote stream[ssrc=".concat(l,",id=").concat(i,",type=").concat(o,"]")))}else C.callErrorHandler(new Error("No SSRC lines found in remote SDP for remote stream[msid=".concat(i,",type=").concat(o,"]")))}else C.callErrorHandler(new Error("No media lines found in remote SDP for remote stream[id=".concat(i,",type=").concat(o,"]")))}else C.callErrorHandler(new Error("MediaType undefined for remote track, stream id: ".concat(i)));else I.info("".concat(this," ignored remote 'stream added' event for non-user stream[id=").concat(i,"]"))},D.prototype._createRemoteTrack=function(e,t,n,i,o,r,a){var s=this.remoteTracks.get(e);s||(s=new Map,this.remoteTracks.set(e,s));var c=s.get(i);if(c&&c.getTrack()===n)I.info("".concat(this," ignored duplicated track event for track[endpoint=").concat(e,",type=").concat(i,"]"));else{c&&(I.error("".concat(this," received a second remote track for track[endpoint=").concat(e,",type=").concat(i,"]")+"deleting the existing track"),this._remoteTrackRemoved(c.getOriginalStream(),c.getTrack()));var u=new _.a(this.rtc,this.rtc.conference,e,t,n,i,o,r,a,this.isP2P);s.set(i,u),this.eventEmitter.emit(f.a.REMOTE_TRACK_ADDED,u,this)}},D.prototype._remoteStreamRemoved=function(e){if(j.a.isUserStream(e)){var t,n=e.getVideoTracks(),i=Object(o.a)(n);try{for(i.s();!(t=i.n()).done;){var r=t.value;this._remoteTrackRemoved(e,r)}}catch(d){i.e(d)}finally{i.f()}var a,s=e.getAudioTracks(),c=Object(o.a)(s);try{for(c.s();!(a=c.n()).done;){var u=a.value;this._remoteTrackRemoved(e,u)}}catch(d){c.e(d)}finally{c.f()}}else{var l=j.a.getStreamID(e);I.info("Ignored remote 'stream removed' event for stream[id=".concat(l,"]"))}},D.prototype._remoteTrackRemoved=function(e,t){var n=j.a.getStreamID(e),i=t&&j.a.getTrackID(t);j.a.isUserStreamById(n)?(I.info("".concat(this," remote track removed stream[id=").concat(n,",trackId=").concat(i,"]")),n?i?this._removeRemoteTrackById(n,i)||I.warn("".concat(this," Removed track not found for stream[id=").concat(n,",trackId=").concat(i,"]")):C.callErrorHandler(new Error("".concat(this," remote track removal failed - no track ID"))):C.callErrorHandler(new Error("".concat(this," remote track removal failed - no stream ID")))):I.info("".concat(this," ignored remote 'stream removed' event for non-user stream[id=").concat(n,"]"))},D.prototype._getRemoteTrackById=function(e,t){var n,i=Object(o.a)(this.remoteTracks.values());try{for(i.s();!(n=i.n()).done;){var r,a=n.value,s=Object(o.a)(a.values());try{for(s.s();!(r=s.n()).done;){var c=r.value;if(c.getStreamId()==e&&c.getTrackId()==t)return c}}catch(u){s.e(u)}finally{s.f()}}}catch(u){i.e(u)}finally{i.f()}},D.prototype.removeRemoteTracks=function(e){var t=[],n=this.remoteTracks.get(e);if(n){var i=n.get(h.a),o=n.get(h.c);i&&t.push(i),o&&t.push(o),this.remoteTracks.delete(e)}return I.debug("".concat(this," removed remote tracks[endpoint=").concat(e,",count=").concat(t.length)),t},D.prototype._removeRemoteTrack=function(e){e.dispose();var t=e.getParticipantId(),n=this.remoteTracks.get(t);n?n.delete(e.getType())||I.error("".concat(this," Failed to remove ").concat(e," - type mapping messed up ?")):I.error("".concat(this," removeRemoteTrack: no remote tracks map for endpoint=").concat(t)),this.eventEmitter.emit(f.a.REMOTE_TRACK_REMOVED,e)},D.prototype._removeRemoteTrackById=function(e,t){var n=this._getRemoteTrackById(e,t);return n&&this._removeRemoteTrack(n),n};var P=function(e){if("object"!==typeof e||null===e||"string"!==typeof e.sdp)return I.warn("An empty description was passed as an argument"),e;var t=n(73),o=t.parse(e.sdp);"undefined"!==typeof o&&"undefined"!==typeof o.media&&Array.isArray(o.media)&&o.media.forEach((function(e){var t=[],n=[];if("undefined"!==typeof e.ssrcGroups&&Array.isArray(e.ssrcGroups)&&e.ssrcGroups.forEach((function(e){"undefined"!==typeof e.semantics&&"FID"===e.semantics&&"undefined"!==typeof e.ssrcs&&t.push(Number(e.ssrcs.split(" ")[0]))})),Array.isArray(e.ssrcs)){var o;for(o=0;o<e.ssrcs.length;o++)"object"===typeof e.ssrcs[o]&&"undefined"!==typeof e.ssrcs[o].id&&t.indexOf(e.ssrcs[o].id)>=0&&(n.push(e.ssrcs[o]),delete e.ssrcs[o]);for(o=0;o<e.ssrcs.length;o++)"undefined"!==typeof e.ssrcs[o]&&n.push(e.ssrcs[o]);e.ssrcs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!g.a.isChrome()||!g.a.isVersionGreaterThan(70))return e;var t=Object(i.a)(e);return e.filter((function(e){return e.attribute==="mslabel"&&e.value==="-"})).map((function(e){return e.id})).forEach((function(e){var n=t.find((function(t){return t.id===e&&"cname"===t.attribute}));n.value="".concat(d.a.RECVONLY,"-").concat(e),(t=t.filter((function(t){return t.id!==e}))).push(n)})),t}(n)}}));var r=t.write(o);return new RTCSessionDescription({type:e.type,sdp:r})};D.prototype.getLocalSSRC=function(e){var t=this._getSSRC(e.rtcId);return t&&t.ssrcs[0]},D.prototype._injectSsrcGroupForUnifiedSimulcast=function(e){var t=c.a.parse(e.sdp),n=t.media.find((function(e){return"video"===e.type}));n.ssrcGroups=n.ssrcGroups||[];var i=n.ssrcGroups.filter((function(e){return"FID"===e.semantics}));if(n.simulcast||n.simulcast_03){var o=[];if(i&&i.length?i.forEach((function(e){o.push(e.ssrcs.split(" ")[0])})):n.ssrcs.forEach((function(e){"msid"===e.attribute&&o.push(e.id)})),n.ssrcGroups.find((function(e){return"SIM"===e.semantics})))return e;n.ssrcGroups.push({semantics:"SIM",ssrcs:o.join(" ")})}return new RTCSessionDescription({type:e.type,sdp:c.a.write(t)})};var M={signalingState:function(){return this.peerconnection.signalingState},iceConnectionState:function(){return this.peerconnection.iceConnectionState},localDescription:function(){var e=this.peerconnection.localDescription;return e?(this.trace("getLocalDescription::preTransform",N(e)),this._usesUnifiedPlan&&!this.isP2P?(e=this.interop.toPlanB(e),this.trace("getLocalDescription::postTransform (Plan B)",N(e)),e=this._injectSsrcGroupForUnifiedSimulcast(e),this.trace("getLocalDescription::postTransform (inject ssrc group)",N(e))):this._usesUnifiedPlan||(g.a.doesVideoMuteByStreamRemove()&&(e=this.localSdpMunger.maybeAddMutedLocalVideoTracksToSDP(e),I.debug("getLocalDescription::postTransform (munge local SDP)",e)),e=function(e,t){if(!e)throw new Error("No local description passed in.");var n=new S.a(e.sdp),i=n.selectMedia(h.a),o=!1;i&&i.direction!==d.a.SENDRECV&&(t.startSilent?i.direction=d.a.INACTIVE:i.direction=d.a.SENDRECV,o=!0);var r=n.selectMedia(h.c);return r&&r.direction!==d.a.SENDRECV&&(r.direction=d.a.SENDRECV,o=!0),o?new RTCSessionDescription({type:e.type,sdp:n.toRawSDP()}):e}(e,this.options)),e=this.localSdpMunger.transformStreamIdentifiers(e)):(I.debug("".concat(this," getLocalDescription no localDescription found")),{})},remoteDescription:function(){var e=this.peerconnection.remoteDescription;return e?(this.trace("getRemoteDescription::preTransform",N(e)),this._usesUnifiedPlan&&(this.isP2P?e=this._adjustRemoteMediaDirection(e):(e=this.interop.toPlanB(e),this.trace("getRemoteDescription::postTransform (Plan B)",N(e)))),e):(I.debug("".concat(this," getRemoteDescription no remoteDescription found")),{})}};Object.keys(M).forEach((function(e){Object.defineProperty(D.prototype,e,{get:M[e]})})),D.prototype._getSSRC=function(e){return this.localSSRCs.get(e)},D.prototype._isSharingScreen=function(){var e=this.getLocalVideoTrack();return e&&e.videoType===v.DESKTOP},D.prototype._mungeCodecOrder=function(e){if(!this.codecPreference||this._usesTransceiverCodecPreferences)return e;var t,n=c.a.parse(e.sdp),i=Object(o.a)(n.media);try{for(i.s();!(t=i.n()).done;){var r=t.value;if(this.codecPreference.enable&&r.type===this.codecPreference.mediaType)if(E.a.preferCodec(r,this.codecPreference.mimeType),this.codecPreference.mimeType===u.H264&&g.a.isReactNative()&&this.isP2P&&E.a.stripCodec(r,this.codecPreference.mimeType,!0),this.codecPreference.mimeType===u.VP9){var a=this.videoBitrates.VP9||this.videoBitrates,s=a.high?a.high:w,l=Math.floor((this._isSharingScreen()?w:s)/1e3);r.bandwidth=[{type:"AS",limit:l}]}else r.bandwidth=void 0;else r.type===this.codecPreference.mediaType&&E.a.stripCodec(r,this.codecPreference.mimeType)}}catch(d){i.e(d)}finally{i.f()}return new RTCSessionDescription({type:e.type,sdp:c.a.write(n)})},D.prototype.containsTrack=function(e){if(e.isLocal())return this.localTracks.has(e.rtcId);var t=e.getParticipantId(),n=this.remoteTracks.get(t);return Boolean(n&&n.get(e.getType())===e)},D.prototype.addTrack=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e.rtcId;if(I.info("".concat(this," adding ").concat(e)),this.localTracks.has(i))return Promise.reject(new Error("".concat(e," is already in ").concat(this)));if(this.localTracks.set(i,e),this._usesUnifiedPlan)try{this.tpcUtils.addTrack(e,n)}catch(l){return I.error("".concat(this," Adding track=").concat(e," failed: ").concat(null===l||void 0===l?void 0:l.message)),Promise.reject(l)}else{var o=e.getOriginalStream();if(o)this._addStream(o);else if(!g.a.doesVideoMuteByStreamRemove()||e.isAudioTrack()||e.isVideoTrack()&&!e.isMuted())return Promise.reject(new Error("".concat(this," no WebRTC stream for track=").concat(e)));if(g.a.doesVideoMuteByStreamRemove()&&e.isVideoTrack()&&e.isMuted()){var r=this.generateNewStreamSSRCInfo(e);this.sdpConsistency.setPrimarySsrc(r.ssrcs[0]);var a=r.groups.find((function(e){return"SIM"===e.semantics}));a&&this.simulcast.setSsrcCache(a.ssrcs);var s=r.groups.filter((function(e){return"FID"===e.semantics}));if(s){var c=new Map;s.forEach((function(e){var t=e.ssrcs[0],n=e.ssrcs[1];c.set(t,n)})),this.rtxModifier.setSsrcCache(c)}}}var u=Promise.resolve();return g.a.isFirefox()&&(u=u.then((function(){return t.tpcUtils.setEncodings(e)}))),u},D.prototype.addTrackUnmute=function(e){if(!this._assertTrackBelongs("addTrackUnmute",e))return Promise.reject("Track not found on the peerconnection");I.info("".concat(this," Adding track=").concat(e," as unmute"));var t=e.getOriginalStream();return t?this._usesUnifiedPlan?this.tpcUtils.addTrackUnmute(e):(this._addStream(t),Promise.resolve(!0)):(I.error("".concat(this," Unable to add track=").concat(e," as unmute - no WebRTC stream")),Promise.reject("Stream not found"))},D.prototype._addStream=function(e){this.peerconnection.addStream(e),this._addedStreams.push(e)},D.prototype._removeStream=function(e){this.peerconnection.removeStream(e),this._addedStreams=this._addedStreams.filter((function(t){return t!==e}))},D.prototype._assertTrackBelongs=function(e,t){var n=this.localTracks.has(t.rtcId);return n||I.error("".concat(this," ").concat(e,": track=").concat(t," does not belong to pc")),n},D.prototype.getConfiguredVideoCodec=function(){var e,t=null===(e=this.peerconnection.localDescription)||void 0===e?void 0:e.sdp,n=u.VP8;if(!t)return n;var i=c.a.parse(t).media.find((function(e){return e.type===h.c})).rtp[0].codec;return i?Object.values(u).find((function(e){return e===i.toLowerCase()})):n},D.prototype.setVideoCodecs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=null===t,i=t||e;this.codecPreference&&(e||t)?(this.codecPreference.enable=n,this.codecPreference.mimeType=i):e||t?this.codecPreference={enable:n,mediaType:h.c,mimeType:i}:I.warn("".concat(this," Invalid codec settings[preferred=").concat(e,",disabled=").concat(t,"],\n            atleast one value is needed"))},D.prototype.isMediaStreamInPc=function(e){return this._addedStreams.indexOf(e)>-1},D.prototype.removeTrack=function(e){var t=e.getOriginalStream();this.trace("removeStream",e.rtcId,t?t.id:void 0),this._assertTrackBelongs("removeStream",e)&&(this.localTracks.delete(e.rtcId),this.localSSRCs.delete(e.rtcId),t&&this.peerconnection.removeStream(t))},D.prototype.findSenderByKind=function(e){return this.peerconnection.getSenders().find((function(t){return t.track&&t.track.kind===e}))},D.prototype.findReceiverForTrack=function(e){return this.peerconnection.getReceivers().find((function(t){return t.track===e}))},D.prototype.findSenderForTrack=function(e){return this.peerconnection.getSenders().find((function(t){return t.track===e}))},D.prototype.replaceTrack=function(e,t){var n=this;if(this._usesUnifiedPlan)return I.debug("".concat(this," TPC.replaceTrack using unified plan")),this.tpcUtils.replaceTrack(e,t).then((function(){return n.isSimulcastOn()&&g.a.usesSdpMungingForSimulcast()}));I.debug("".concat(this," TPC.replaceTrack using plan B"));var i=Promise.resolve();return e&&this.removeTrack(e),t&&(i=this.addTrack(t)),i.then((function(){return!0}))},D.prototype.removeTrackMute=function(e){var t=e.getOriginalStream();return this.trace("removeStreamMute",e.rtcId,t?t.id:null),this._assertTrackBelongs("removeStreamMute",e)?this._usesUnifiedPlan?this.tpcUtils.removeTrackMute(e):t?(I.info("".concat(this," Removing track=").concat(e," as mute")),this._removeStream(t),Promise.resolve(!0)):(I.error("".concat(this," removeStreamMute - no WebRTC stream for track=").concat(e)),Promise.reject("Stream not found")):Promise.reject("Track not found in the peerconnection")},D.prototype.createDataChannel=function(e,t){return this.trace("createDataChannel",e,t),this.peerconnection.createDataChannel(e,t)},D.prototype._ensureSimulcastGroupIsLast=function(e){var t=e.sdp,n=t.indexOf("m=video"),i=t.indexOf("a=ssrc-group:SIM",n),o=t.lastIndexOf("a=ssrc-group");if(-1===i||-1===o||o===i)return e;var r=t.indexOf("\r\n",i),a=t.substring(i,r+2);o=(t=t.replace(a,"")).lastIndexOf("a=ssrc-group");var s=t.indexOf("\r\n",o),c=t.slice(0,s),u=a.trim(),l=t.slice(s);return t="".concat(c,"\r\n").concat(u).concat(l),new RTCSessionDescription({type:e.type,sdp:t})},D.prototype._adjustLocalMediaDirection=function(e){var t=new S.a(e.sdp),n=!1,i=t.selectMedia(h.a);if(i){var o=this.getDesiredMediaDirection(h.a);i.direction!==o&&(i.direction=o,I.info("".concat(this," Adjusted local audio direction to ").concat(o)),n=!0)}else I.warn("".concat(this,' No "audio" media found in the local description'));var r=t.selectMedia(h.c);if(r){var a=this.getDesiredMediaDirection(h.c);r.direction!==a&&(r.direction=a,I.info("".concat(this," Adjusted local video direction to ").concat(a)),n=!0)}else I.warn("".concat(this,' No "video" media found in the local description'));return n?new RTCSessionDescription({type:e.type,sdp:t.toRawSDP()}):e},D.prototype._adjustRemoteMediaDirection=function(e){var t=this,n=new S.a(e.sdp);return[h.a,h.c].forEach((function(e){var i=n.selectMedia(e),o=t.hasAnyTracksOfType(e),r=t.getRemoteTracks(null,e).length>0;i.direction=o&&r?d.a.SENDRECV:o?d.a.RECVONLY:d.a.SENDONLY})),new RTCSessionDescription({type:e.type,sdp:n.toRawSDP()})},D.prototype._mungeOpus=function(e){var t=this.options.audioQuality;if((null===t||void 0===t||!t.stereo)&&(null===t||void 0===t||!t.opusMaxAverageBitrate))return e;var n,i=c.a.parse(e.sdp),r=i.media,a=Object(o.a)(r);try{for(a.s();!(n=a.n()).done;){var s=n.value;if("audio"===s.type)if("continue"===function(){var e=s.rtp.find((function(e){return e.codec===u.OPUS})).payload;if(!e)return"continue";var n=s.fmtp.find((function(t){return t.payload===e}));n||(n={payload:e,config:""});var i=c.a.parseParams(n.config),o=!1;if(null!==t&&void 0!==t&&t.stereo&&(i.stereo=1,o=!0),null!==t&&void 0!==t&&t.opusMaxAverageBitrate&&(i.maxaveragebitrate=t.opusMaxAverageBitrate,o=!0),!o)return"continue";for(var r="",a=0,l=Object.keys(i);a<l.length;a++){var d=l[a];r+="".concat(d,"=").concat(i[d],"; ")}n.config=r.trim()}())continue}}catch(l){a.e(l)}finally{a.f()}return new RTCSessionDescription({type:e.type,sdp:c.a.write(i)})},D.prototype.setLocalDescription=function(e){var t=this,n=e;return this.trace("setLocalDescription::preTransform",N(n)),n=this._mungeCodecOrder(n),n=this._mungeOpus(n),this._usesUnifiedPlan?this.isP2P||(n=this.interop.toUnifiedPlan(n),this.trace("setLocalDescription::postTransform (Unified Plan)",N(n))):(n=this._adjustLocalMediaDirection(n),n=this._ensureSimulcastGroupIsLast(n)),new Promise((function(e,i){t.peerconnection.setLocalDescription(n).then((function(){t.trace("setLocalDescriptionOnSuccess");var i=E.a.getUfrag(n.sdp);i!==t.localUfrag&&(t.localUfrag=i,t.eventEmitter.emit(f.a.LOCAL_UFRAG_CHANGED,t,i)),e()}),(function(e){t.trace("setLocalDescriptionOnFailure",e),t.eventEmitter.emit(f.a.SET_LOCAL_DESCRIPTION_FAILED,e,t),i(e)}))}))},D.prototype.setAudioTransferActive=function(e){I.debug("".concat(this," audio transfer active: ").concat(e));var t=this.audioTransferActive!==e;return this.audioTransferActive=e,this._usesUnifiedPlan?(this.tpcUtils.setAudioTransferActive(e),!1):t},D.prototype.setSenderVideoDegradationPreference=function(){if(!this.peerconnection.getSenders)return I.debug("".concat(this," Browser does not support RTCRtpSender")),Promise.resolve();var e=this.getLocalVideoTrack(),t=this.findSenderByKind(h.c);if(!t)return Promise.resolve();var n=t.getParameters(),i=e.videoType===v.CAMERA?R:this.options.capScreenshareBitrate&&!this._usesUnifiedPlan?"maintain-resolution":R;return I.info("".concat(this," Setting a degradation preference [preference=").concat(i,",track=").concat(e)),n.degradationPreference=i,this.tpcUtils.updateEncodingsResolution(n),t.setParameters(n)},D.prototype.setMaxBitRate=function(){if(this.getConfiguredVideoCodec()===u.VP9||!window.RTCRtpSender)return Promise.resolve();var e=this.getLocalVideoTrack();if(!e)return Promise.resolve();var t=e.videoType,n=!this._usesUnifiedPlan&&t===v.DESKTOP;if(!(this.options.videoQuality&&this.options.videoQuality.maxBitratesVideo||n&&this.options.capScreenshareBitrate||this._usesUnifiedPlan))return Promise.resolve();var i=e._originalStream&&e._originalStream.id!==e.getStreamId(),o=this.findSenderByKind(h.c);if(!o)return Promise.resolve();var r=o.getParameters();if(!r.encodings||!r.encodings.length)return Promise.resolve();if(this.isSimulcastOn()){for(var a in r.encodings)if(r.encodings.hasOwnProperty(a)){var s=void 0;s=n?this.options.capScreenshareBitrate?i?w:5e5:void 0:this.tpcUtils.localStreamEncodingsConfig[a].maxBitrate,I.info("".concat(this," Setting a max bitrate of ").concat(s," bps on layer ")+"".concat(this.tpcUtils.localStreamEncodingsConfig[a].rid)),r.encodings[a].maxBitrate=s}}else{var c,l=null===(c=this.getTargetVideoBitrates())||void 0===c?void 0:c.high;if(t===v.CAMERA){var d=this.senderVideoMaxHeight?Math.floor(e.resolution/this.senderVideoMaxHeight):1,p=this.tpcUtils.localStreamEncodingsConfig.find((function(e){return e.scaleResolutionDownBy===d}));p&&(I.info("".concat(this," Setting max bitrate=").concat(p.maxBitrate," bps on track=").concat(e)),l=p.maxBitrate)}r.encodings[0].maxBitrate=l}return this.tpcUtils.updateEncodingsResolution(r),o.setParameters(r)},D.prototype.setRemoteDescription=function(e){var t=this;if(this.trace("setRemoteDescription::preTransform",N(e)),e=this._mungeCodecOrder(e),e=this._mungeOpus(e),this._usesUnifiedPlan){if(!this.isP2P){var n=this.peerconnection.remoteDescription;e=this.interop.toUnifiedPlan(e,n),this.trace("setRemoteDescription::postTransform (Unified)",N(e)),this.isSimulcastOn()&&(e=this.simulcast.mungeRemoteDescription(e),e=this.tpcUtils.insertUnifiedPlanSimulcastReceive(e),this.trace("setRemoteDescription::postTransform (sim receive)",N(e)))}}else this.isSimulcastOn()&&(e=this.simulcast.mungeRemoteDescription(e,!0),this.trace("setRemoteDescription::postTransform (simulcast)",N(e))),e=P(e);return this._usesUnifiedPlan&&(e=this.tpcUtils.ensureCorrectOrderOfSsrcs(e)),new Promise((function(n,i){t.peerconnection.setRemoteDescription(e).then((function(){t.trace("setRemoteDescriptionOnSuccess");var i=E.a.getUfrag(e.sdp);i!==t.remoteUfrag&&(t.remoteUfrag=i,t.eventEmitter.emit(f.a.REMOTE_UFRAG_CHANGED,t,i)),n()}),(function(e){t.trace("setRemoteDescriptionOnFailure",e),t.eventEmitter.emit(f.a.SET_REMOTE_DESCRIPTION_FAILED,e,t),i(e)}))}))},D.prototype.setSenderVideoConstraint=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(t<0)throw new Error("Invalid frameHeight: ".concat(t));if(g.a.isReactNative())return Promise.resolve();var n=null===t?this.senderVideoMaxHeight:t;if(this.senderVideoMaxHeight=n,null===n)return Promise.resolve();I.log("".concat(this," senderVideoMaxHeight: ").concat(n));var i=this.getLocalVideoTrack();if(!i||i.isMuted())return Promise.resolve();var o=this.findSenderByKind(h.c);if(!o)return Promise.resolve();var r=o.getParameters();if(!r||!r.encodings||!r.encodings.length)return Promise.resolve();if(this.isSimulcastOn()){this.encodingsEnabledState=this.tpcUtils.getLocalStreamHeightConstraints(i.track).map((function(e){return e<=n}));var a=this.tpcUtils.localStreamEncodingsConfig.findIndex((function(e){return 4===e.scaleResolutionDownBy}));for(var s in n>0&&-1!==a&&(this.encodingsEnabledState[a]=!0),r.encodings)r.encodings.hasOwnProperty(s)&&(r.encodings[s].active=this.encodingsEnabledState[s]);this.tpcUtils.updateEncodingsResolution(r)}else n>0?(r.encodings[0].scaleResolutionDownBy=i.videoType===v.DESKTOP||i.resolution<=n?1:i.resolution?Math.floor(i.resolution/n):void 0,r.encodings[0].active=!0):(r.encodings[0].scaleResolutionDownBy=void 0,r.encodings[0].active=!1);return I.info("".concat(this," setting max height=").concat(n,",encodings=").concat(JSON.stringify(r.encodings))),o.setParameters(r).then((function(){if(i.maxEnabledResolution=n,e.eventEmitter.emit(f.a.LOCAL_TRACK_MAX_ENABLED_RESOLUTION_CHANGED,i),e.isP2P||!e.isSimulcastOn())return e.setMaxBitRate()}))},D.prototype.setVideoTransferActive=function(e){I.debug("".concat(this," video transfer active: ").concat(e));var t=this.videoTransferActive!==e;return this.videoTransferActive=e,this._usesUnifiedPlan?(this.tpcUtils.setVideoTransferActive(e),!1):t},D.prototype.sendTones=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;if(!this._dtmfSender){if(this.peerconnection.getSenders){var i=this.peerconnection.getSenders().find((function(e){return e.dtmf}));this._dtmfSender=i&&i.dtmf,this._dtmfSender&&I.info("".concat(this," initialized DTMFSender using getSenders"))}if(!this._dtmfSender){var o=Array.from(this.localTracks.values()).find((function(e){return e.isAudioTrack()}));this.peerconnection.createDTMFSender&&o&&(this._dtmfSender=this.peerconnection.createDTMFSender(o.getTrack())),this._dtmfSender&&I.info("".concat(this," initialized DTMFSender using deprecated createDTMFSender"))}this._dtmfSender&&(this._dtmfSender.ontonechange=this._onToneChange.bind(this))}if(this._dtmfSender){if(this._dtmfSender.toneBuffer)return void this._dtmfTonesQueue.push({tones:e,duration:t,interToneGap:n});this._dtmfSender.insertDTMF(e,t,n)}else I.warn("".concat(this," sendTones - failed to select DTMFSender"))},D.prototype._onToneChange=function(e){if(this._dtmfSender&&""===e.tone&&this._dtmfTonesQueue.length){var t=this._dtmfTonesQueue.shift(),n=t.tones,i=t.duration,o=t.interToneGap;this._dtmfSender.insertDTMF(n,i,o)}},D.prototype.generateRecvonlySsrc=function(){var e=E.a.generateSsrc();I.info("".concat(this," generated new recvonly SSRC=").concat(e)),this.sdpConsistency.setPrimarySsrc(e)},D.prototype.clearRecvonlySsrc=function(){I.info("".concat(this," Clearing primary video SSRC!")),this.sdpConsistency.clearVideoSsrcCache()},D.prototype.close=function(){this.trace("stop"),this.signalingLayer.off(m.a,this._peerMutedChanged),this.signalingLayer.off(m.b,this._peerVideoTypeChanged),this._usesUnifiedPlan&&this.peerconnection.removeEventListener("track",this.onTrack);var e,t=Object(o.a)(this.remoteTracks.values());try{for(t.s();!(e=t.n()).done;){var n,i=e.value,r=Object(o.a)(i.values());try{for(r.s();!(n=r.n()).done;){var a=n.value;this._removeRemoteTrack(a)}}catch(s){r.e(s)}finally{r.f()}}}catch(s){t.e(s)}finally{t.f()}this.remoteTracks.clear(),this._addedStreams=[],this._dtmfSender=null,this._dtmfTonesQueue=[],this.rtc._removePeerConnection(this)||I.error("".concat(this," RTC._removePeerConnection returned false")),null!==this.statsinterval&&(window.clearInterval(this.statsinterval),this.statsinterval=null),I.info("".concat(this," Closing peerconnection")),this.peerconnection.close()},D.prototype.createAnswer=function(e){return this._createOfferOrAnswer(!1,e)},D.prototype.createOffer=function(e){return this._createOfferOrAnswer(!0,e)},D.prototype._createOfferOrAnswer=function(e,t){var n=this,i=e?"Offer":"Answer";this.trace("create".concat(i),JSON.stringify(t,null," "));var r=function(e,t,r){try{n.trace("create".concat(i,"OnSuccess::preTransform"),N(e)),n._usesUnifiedPlan||(n.hasAnyTracksOfType(h.c)||n.sdpConsistency.hasPrimarySsrcCached()||n.generateRecvonlySsrc(),e=new RTCSessionDescription({type:e.type,sdp:n.sdpConsistency.makeVideoPrimarySsrcsConsistent(e.sdp)}),n.trace("create".concat(i,"OnSuccess::postTransform ")+"(make primary audio/video ssrcs consistent)",N(e))),n.isSimulcastOn()&&g.a.usesSdpMungingForSimulcast()&&(!n.options.capScreenshareBitrate||n.options.capScreenshareBitrate&&!n._isSharingScreen())&&(e=n.simulcast.mungeLocalDescription(e),n.trace("create".concat(i)+"OnSuccess::postTransform (simulcast)",N(e))),!n.options.disableRtx&&g.a.usesSdpMungingForSimulcast()&&(e=new RTCSessionDescription({type:e.type,sdp:n.rtxModifier.modifyRtxSsrcs(e.sdp)}),n.trace("create".concat(i)+"OnSuccess::postTransform (rtx modifier)",N(e)));var a=function(e){var t=new Map,n=new Map;if("object"!==typeof e||null===e||"string"!==typeof e.sdp)return I.warn("An empty description was passed as an argument"),t;var i=c.a.parse(e.sdp);if(!Array.isArray(i.media))return t;var r,a=Object(o.a)(i.media);try{for(a.s();!(r=a.n()).done;){var s=r.value;if(Array.isArray(s.ssrcs)){if(Array.isArray(s.ssrcGroups)){var u,l=Object(o.a)(s.ssrcGroups);try{for(l.s();!(u=l.n()).done;){var d=u.value;if("undefined"!==typeof d.semantics&&"undefined"!==typeof d.ssrcs){var h=d.ssrcs.split(" ").map((function(e){return parseInt(e,10)})),p=h[0];d.ssrcs=h,n.has(p)||n.set(p,[]),n.get(p).push(d)}}}catch(C){l.e(C)}finally{l.f()}}var f,m=Object(o.a)(s.ssrcs);try{for(m.s();!(f=m.n()).done;){var v=f.value;if("msid"===v.attribute){var g=v.value,b=t.get(g);b||(b={ssrcs:[],groups:[],msid:g},t.set(g,b));var y=v.id;if(b.ssrcs.push(y),n.has(y)){var A,E=n.get(y),O=Object(o.a)(E);try{for(O.s();!(A=O.n()).done;){var S=A.value;b.groups.push(S)}}catch(C){O.e(C)}finally{O.f()}}}}}catch(C){m.e(C)}finally{m.f()}}}}catch(C){a.e(C)}finally{a.f()}return t}(e);I.debug("Got local SSRCs MAP: ",a),n._processLocalSSRCsMap(a),t(e)}catch(s){n.trace("create".concat(i,"OnError"),s),n.trace("create".concat(i,"OnError"),N(e)),I.error("".concat(n," create").concat(i,"OnError"),s,N(e)),r(s)}};if(this._usesTransceiverCodecPreferences){var a=this.peerconnection.getTransceivers().find((function(e){var t,n;return e.receiver&&(null===(t=e.receiver)||void 0===t||null===(n=t.track)||void 0===n?void 0:n.kind)===h.c}));if(a){var s,u,l,d=null===(s=RTCRtpReceiver.getCapabilities(h.c))||void 0===s?void 0:s.codecs,p=null===(u=this.codecPreference)||void 0===u?void 0:u.mimeType,m=null===(l=this.codecPreference)||void 0===l?void 0:l.enable;d&&p&&m?d.sort((function(e){return e.mimeType.toLowerCase()==="".concat(h.c,"/").concat(p)?-1:1})):d&&p&&(d=d.filter((function(e){return e.mimeType.toLowerCase()!=="".concat(h.c,"/").concat(p)})));try{a.setCodecPreferences(d)}catch(v){I.warn("".concat(this," Setting codec[preference=").concat(p,",enable=").concat(m,"] failed"),v)}}}return new Promise((function(o,a){(e?n.peerconnection.createOffer(t):n.peerconnection.createAnswer(t)).then((function(e){return r(e,o,a)}),(function(t){return function(t,o){n.trace("create".concat(i,"OnFailure"),t);var r=e?f.a.CREATE_OFFER_FAILED:f.a.CREATE_ANSWER_FAILED;n.eventEmitter.emit(r,t,n),o(t)}(t,a)}))}))},D.prototype._extractPrimarySSRC=function(e){return e&&e.groups&&e.groups.length?e.groups[0].ssrcs[0]:e&&e.ssrcs&&e.ssrcs.length?e.ssrcs[0]:null},D.prototype._processLocalSSRCsMap=function(e){var t,n=Object(o.a)(this.localTracks.values());try{for(n.s();!(t=n.n()).done;){var i=t.value,r=i.storedMSID;if(e.has(r)){var a=e.get(r);if(!a)return void I.error("".concat(this," No SSRC found for stream=").concat(r));var s=this.localSSRCs.get(i.rtcId),c=this._extractPrimarySSRC(a),u=this._extractPrimarySSRC(s);c!==u&&(u&&I.error("".concat(this," Overwriting SSRC for [track=").concat(i,",id=").concat(r,"]")+" with ssrc=".concat(a)),this.localSSRCs.set(i.rtcId,a),this.eventEmitter.emit(f.a.LOCAL_TRACK_SSRC_UPDATED,i,c))}else i.isVideoTrack()||i.isMuted()||I.warn("".concat(this," No SSRCs found in the local SDP for track[track=").concat(i,",id=").concat(r,"]"))}}catch(l){n.e(l)}finally{n.f()}},D.prototype.addIceCandidate=function(e){return this.trace("addIceCandidate",JSON.stringify({candidate:e.candidate,sdpMid:e.sdpMid,sdpMLineIndex:e.sdpMLineIndex,usernameFragment:e.usernameFragment},null," ")),this.peerconnection.addIceCandidate(e)},D.prototype.getActiveSimulcastStreams=function(){var e,t=1;this.isSimulcastOn()&&this.encodingsEnabledState?t=null===(e=this.encodingsEnabledState.filter((function(e){return Boolean(e)})))||void 0===e?void 0:e.length:this.isSimulcastOn()&&(t=k.a.length);return t},D.prototype.getStats=function(){return this.peerconnection.getStats()},D.prototype.generateNewStreamSSRCInfo=function(e){var t=e.rtcId,n=this._getSSRC(t);if(n&&I.error("".concat(this," Overwriting local SSRCs for track id=").concat(t)),this.isSimulcastOn()&&(!this.options.capScreenshareBitrate||this.options.capScreenshareBitrate&&!this._isSharingScreen())){n={ssrcs:[],groups:[]};for(var i=0;i<k.a.length;i++)n.ssrcs.push(E.a.generateSsrc());n.groups.push({ssrcs:n.ssrcs.slice(),semantics:"SIM"})}else n={ssrcs:[E.a.generateSsrc()],groups:[]};if(!this.options.disableRtx)for(var o=n.ssrcs.length,r=0;r<o;++r){var a=n.ssrcs[r],s=E.a.generateSsrc();n.ssrcs.push(s),n.groups.push({ssrcs:[a,s],semantics:"FID"})}return n.msid=e.storedMSID,this.localSSRCs.set(t,n),n},D.prototype.toString=function(){return"TPC[id=".concat(this.id,",type=").concat(this.isP2P?"P2P":"JVB","]")}}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return p}));var i=n(69),o=n(14),r=n(6),a=n(8),s=n(18),c=n(38),u=n.n(c),l=n(19),d=n(97),h=Object(s.getLogger)(e),p=function(){function e(t,n){Object(r.a)(this,e),this.tpc=t,this.localEndpointId=n}return Object(a.a)(e,[{key:"_addMutedLocalVideoTracksToSDP",value:function(e){var t=this.tpc.getLocalTracks(l.c);if(!t.length)return!1;1!==t.length&&h.error("".concat(this.tpc," there is more than 1 video track ! ")+"Strange things may happen !",t);var n=e.selectMedia("video");if(!n)return h.debug("".concat(this.tpc," unable to hack local video track SDP")+'- no "video" media'),!1;var i,r=!1,a=Object(o.a)(t);try{for(a.s();!(i=a.n()).done;){var s=i.value,c=s.isMuted(),d=s.getOriginalStream(),p=d&&this.tpc.isMediaStreamInPc(d);if(c||!p){var f=this.tpc.isSimulcastOn()?this.tpc.simulcast.ssrcCache:[this.tpc.sdpConsistency.cachedPrimarySsrc];if(f.length){r=!0,n.direction=u.a.SENDRECV;var m,v=f[0],g="injected-".concat(v),b=Object(o.a)(f);try{for(b.s();!(m=b.n()).done;){var y=m.value;n.removeSSRC(y),n.addSSRCAttribute({id:y,attribute:"cname",value:g}),n.addSSRCAttribute({id:y,attribute:"msid",value:s.storedMSID})}}catch(E){b.e(E)}finally{b.f()}if(f.length>1){var A={ssrcs:f.join(" "),semantics:"SIM"};n.findGroup(A.semantics,A.ssrcs)||n.addSSRCGroup(A)}this.tpc.options.disableRtx||this.tpc.rtxModifier.modifyRtxSsrcs2(n)}else h.error("No SSRCs stored for: ".concat(s," in ").concat(this.tpc))}}}catch(E){a.e(E)}finally{a.f()}return r}},{key:"_generateMsidAttribute",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e||!t)return h.warn("Unable to munge local MSID - track id=".concat(t," or media type=").concat(e," is missing")),null;var i=this.tpc.id;return"-"!==n&&n?"".concat(n,"-").concat(i," ").concat(t,"-").concat(i):"".concat(this.localEndpointId,"-").concat(e,"-").concat(i," ").concat(t,"-").concat(i)}},{key:"_transformMediaIdentifiers",value:function(e){var t,n,r,a,s=this,c=this.tpc.id,l=Object(o.a)(e.ssrcs);try{for(l.s();!(a=l.n()).done;){var d=a.value;switch(d.attribute){case"cname":case"label":case"mslabel":d.value=d.value&&"".concat(d.value,"-").concat(c);break;case"msid":if(d.value){var p,f=d.value.split(" ");if(2===f.length)d.value=this._generateMsidAttribute(null===(p=e.mLine)||void 0===p?void 0:p.type,f[1],f[0]);else h.warn("Unable to munge local MSID - weird format detected: ".concat(d.value))}}}}catch(_){l.e(_)}finally{l.f()}var m=e.ssrcs.find((function(e){return"msid"===e.attribute}));if(this.tpc.isP2P||m&&(null===(t=e.mLine)||void 0===t?void 0:t.direction)!==u.a.RECVONLY&&(null===(n=e.mLine)||void 0===n?void 0:n.direction)!==u.a.INACTIVE){if(this.tpc.isP2P&&(null===(r=e.mLine)||void 0===r?void 0:r.direction)===u.a.SENDRECV){var v,g,b,y,A=null===(v=e.mLine)||void 0===v?void 0:v.msid,E=A&&A.split(" ")[1],O=Object(i.a)(new Set(null===(g=e.mLine)||void 0===g||null===(b=g.ssrcs)||void 0===b?void 0:b.map((function(e){return e.id})))),S=Object(o.a)(O);try{var C=function(){var t=y.value;if(!e.ssrcs.find((function(e){return e.id===t&&"msid"===e.attribute}))){var n,i=s._generateMsidAttribute(null===(n=e.mLine)||void 0===n?void 0:n.type,E);e.ssrcs.push({id:t,attribute:"msid",value:i})}};for(S.s();!(y=S.n()).done;)C()}catch(_){S.e(_)}finally{S.f()}}}else e.ssrcs=void 0,e.ssrcGroups=void 0}},{key:"maybeAddMutedLocalVideoTracksToSDP",value:function(e){if(!e)throw new Error("No local description passed in.");var t=new d.a(e.sdp);return this._addMutedLocalVideoTracksToSDP(t)?new RTCSessionDescription({type:e.type,sdp:t.toRawSDP()}):e}},{key:"transformStreamIdentifiers",value:function(e){if(!e||!e.sdp||!e.type)return e;var t=new d.a(e.sdp),n=t.selectMedia("audio");n&&this._transformMediaIdentifiers(n);var i=t.selectMedia("video");return i&&this._transformMediaIdentifiers(i),new RTCSessionDescription({type:e.type,sdp:t.toRawSDP()})}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return d}));var i=n(14),o=n(6),r=n(8),a=n(18),s=n(33),c=n(97),u=Object(a.getLogger)(e);function l(e,t,n){var i=t.id,o=t.msid,r=t.cname,a=e.getRtxSSRC(i);a!==n&&(a&&(e.removeSSRC(a),e.removeGroupsWithSSRC(a)),e.addSSRCAttribute({id:n,attribute:"cname",value:r}),e.addSSRCAttribute({id:n,attribute:"msid",value:o}),e.addSSRCGroup({semantics:"FID",ssrcs:"".concat(i," ").concat(n)}))}var d=function(){function e(){Object(o.a)(this,e),this.correspondingRtxSsrcs=new Map}return Object(r.a)(e,[{key:"clearSsrcCache",value:function(){this.correspondingRtxSsrcs.clear()}},{key:"setSsrcCache",value:function(e){u.debug("Setting ssrc cache to ",e),this.correspondingRtxSsrcs=e}},{key:"modifyRtxSsrcs",value:function(e){var t=new c.a(e),n=t.selectMedia("video");return n?this.modifyRtxSsrcs2(n)?t.toRawSDP():e:(u.debug("No 'video' media found in the sdp: ".concat(e)),e)}},{key:"modifyRtxSsrcs2",value:function(e){if("recvonly"===e.direction)return!1;if(e.getSSRCCount()<1)return!1;var t,n=e.getPrimaryVideoSSRCs(),o=Object(i.a)(n);try{for(o.s();!(t=o.n()).done;){var r=t.value,a=e.getSSRCAttrValue(r,"msid"),c=e.getSSRCAttrValue(r,"cname"),u=this.correspondingRtxSsrcs.get(r);if(!u){var d=e.getRtxSSRC(r);u=d||s.a.generateSsrc(),this.correspondingRtxSsrcs.set(r,u)}l(e,{id:r,cname:c,msid:a},u)}}catch(h){o.e(h)}finally{o.f()}return!0}},{key:"stripRtx",value:function(e){var t=new c.a(e),n=t.selectMedia("video");if(!n)return u.debug("No 'video' media found in the sdp: ".concat(e)),e;if("recvonly"===n.direction)return u.debug("RtxModifier doing nothing, video m line is recvonly"),e;if(n.getSSRCCount()<1)return u.debug("RtxModifier doing nothing, no video ssrcs present"),e;if(!n.containsAnySSRCGroups())return u.debug("RtxModifier doing nothing, no video ssrcGroups present"),e;var o=n.findGroups("FID");n.removeGroupsBySemantics("FID");var r,a=Object(i.a)(o);try{for(a.s();!(r=a.n()).done;){var s=r.value,l=Object(c.c)(s);n.removeSSRC(l)}}catch(d){a.e(d)}finally{a.f()}return t.toRawSDP()}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u}));var i=n(14),o=n(6),r=n(8),a=n(18),s=n(97),c=Object(a.getLogger)(e),u=function(){function e(t){Object(o.a)(this,e),this.clearVideoSsrcCache(),this.logPrefix=t}return Object(r.a)(e,[{key:"clearVideoSsrcCache",value:function(){this.cachedPrimarySsrc=null,this.injectRecvOnly=!1}},{key:"setPrimarySsrc",value:function(e){if("number"!==typeof e)throw new Error("Primary SSRC must be a number!");this.cachedPrimarySsrc=e}},{key:"hasPrimarySsrcCached",value:function(){return Boolean(this.cachedPrimarySsrc)}},{key:"makeVideoPrimarySsrcsConsistent",value:function(e){var t=new s.a(e),n=t.selectMedia("video");if(!n)return c.debug("".concat(this.logPrefix," no 'video' media found in the sdp: ").concat(e)),e;if("recvonly"===n.direction)this.cachedPrimarySsrc&&this.injectRecvOnly?n.addSSRCAttribute({id:this.cachedPrimarySsrc,attribute:"cname",value:"recvonly-".concat(this.cachedPrimarySsrc)}):c.info("".concat(this.logPrefix," no SSRC found for the recvonly video stream!"));else{var o=n.getPrimaryVideoSsrc();if(!o)return c.info("".concat(this.logPrefix," sdp-consistency couldn't parse new primary ssrc")),e;if(this.cachedPrimarySsrc){n.replaceSSRC(o,this.cachedPrimarySsrc);var r,a=Object(i.a)(n.ssrcGroups);try{for(a.s();!(r=a.n()).done;){var u=r.value;if("FID"===u.semantics){var l=Object(s.b)(u),d=Object(s.c)(u);l===o&&(u.ssrcs="".concat(this.cachedPrimarySsrc," ").concat(d))}}}catch(h){a.e(h)}finally{a.f()}}else this.cachedPrimarySsrc=o;this.injectRecvOnly=!0}return t.toRawSDP()}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return g}));var i=n(6),o=n(8),r=n(25),a=n(35),s=n(34),c=n(58),u=n(32),l=n(27),d=n(219),h=n(18).getLogger(e),p=n(31),f=!1,m=!1,v=["abort","canplay","canplaythrough","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","ratechange","stalled","suspend","waiting"],g=function(e){Object(a.a)(n,e);var t=Object(s.a)(n);function n(e,o,a,s,c,u,l,d,p,f){var m;if(Object(i.a)(this,n),(m=t.call(this,o,s,c,(function(){}),u,l)).rtc=e,0===d.length)throw new TypeError("No SSRCs");return d.forEach((function(e){if("number"!==typeof e)throw new TypeError("SSRC ".concat(e," is not a number"))})),m.ssrcs=d,m.ownerEndpointId=a,m.muted=p,m.isP2P=f,h.debug("New remote track added: ".concat(Object(r.a)(m))),m.hasBeenMuted=p,m.rtc&&m.track&&m._bindTrackHandlers(),m._containerHandlers={},v.forEach((function(e){m._containerHandlers[e]=m._containerEventHandler.bind(Object(r.a)(m),e)})),m}return Object(o.a)(n,[{key:"_bindTrackHandlers",value:function(){var e=this;this.track.addEventListener("mute",(function(){return e._onTrackMute()})),this.track.addEventListener("unmute",(function(){return e._onTrackUnmute()})),this.track.addEventListener("ended",(function(){h.debug('"onended" event('.concat(Date.now(),"): ").concat(e))}))}},{key:"_onTrackMute",value:function(){h.debug('"onmute" event('.concat(Date.now(),"): ").concat(this)),this.rtc.eventEmitter.emit(p.REMOTE_TRACK_MUTE,this)}},{key:"_onTrackUnmute",value:function(){h.debug('"onunmute" event('.concat(Date.now(),"): ").concat(this)),this.rtc.eventEmitter.emit(p.REMOTE_TRACK_UNMUTE,this)}},{key:"setMute",value:function(e){this.muted!==e&&(e&&(this.hasBeenMuted=!0),this.stream&&(this.stream.muted=e),this.muted=e,this.emit(c.TRACK_MUTE_CHANGED,this))}},{key:"isMuted",value:function(){return this.muted}},{key:"getParticipantId",value:function(){return this.ownerEndpointId}},{key:"isLocal",value:function(){return!1}},{key:"getSSRC",value:function(){return this.ssrcs[0]}},{key:"getSSRCs",value:function(){return this.ssrcs}},{key:"_setVideoType",value:function(e){this.videoType!==e&&(this.videoType=e,this.emit(c.TRACK_VIDEOTYPE_CHANGED,e))}},{key:"_playCallback",value:function(){var e=this.isVideoTrack()?"video":"audio",t=window.performance.now();console.log("(TIME) Render ".concat(e,":\t"),t),this.conference.getConnectionTimes()["".concat(e,".render")]=t;var n=window.connectionTimes["obtainPermissions.start"],i=window.connectionTimes["obtainPermissions.end"],o=isNaN(i)||isNaN(n)?0:i-n,r=t-(this.conference.getConnectionTimes()["session.initiate"]-this.conference.getConnectionTimes()["muc.joined"])-o;this.conference.getConnectionTimes()["".concat(e,".ttfm")]=r,console.log("(TIME) TTFM ".concat(e,":\t"),r),l.a.sendAnalytics(Object(u.N)({media_type:e,muted:this.hasBeenMuted,value:r}))}},{key:"_attachTTFMTracker",value:function(e){f&&this.isAudioTrack()||m&&this.isVideoTrack()||(this.isAudioTrack()&&(f=!0),this.isVideoTrack()&&(m=!0),e.addEventListener("canplay",this._playCallback.bind(this)))}},{key:"_onTrackAttach",value:function(e){var t=this;h.debug("Track has been attached to a container: ".concat(this)),v.forEach((function(n){e.addEventListener(n,t._containerHandlers[n])}))}},{key:"_onTrackDetach",value:function(e){var t=this;h.debug("Track has been detached from a container: ".concat(this)),v.forEach((function(n){e.removeEventListener(n,t._containerHandlers[n])}))}},{key:"_containerEventHandler",value:function(e){h.debug("".concat(e," handler was called for a container with attached ").concat(this))}},{key:"_getStatus",value:function(){var e=this.track,t=e.enabled,n=e.muted,i=e.readyState;return"readyState: ".concat(i,", muted: ").concat(n,", enabled: ").concat(t)}},{key:"toString",value:function(){return"RemoteTrack[userID: ".concat(this.getParticipantId(),", type: ").concat(this.getType(),", ssrc: ").concat(this.getSSRC(),", p2p: ").concat(this.isP2P,", status: ").concat(this._getStatus(),"]")}}]),n}(d.a)}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return y}));var i=n(6),o=n(8),r=n(18),a=n(10),s=n(71),c=n.n(s),u=n(31),l=n(101),d=n(20),h=n(220),p=n(47),f=n(9),m=Object(r.getLogger)(e),v=[{width:1920,height:1080,layers:3,target:"high",targetRN:4e6},{width:1280,height:720,layers:3,target:"high",targetRN:25e5},{width:960,height:540,layers:3,target:"standard",targetRN:9e5},{width:640,height:360,layers:2,target:"standard",targetRN:5e5},{width:480,height:270,layers:2,target:"low",targetRN:35e4},{width:320,height:180,layers:1,target:"low",targetRN:15e4}],g=800;function b(e,t,n,i){if(n<15e3)return 1;var o=0,r=Math.min(t.height,t.width),a=v.find((function(e){return e.height<=r}));if(a&&e&&i.codec===c.a.VP8){var s=function(){var e=r;if(!(a=v.find((function(t){return t.height===e}))))return"break";o+=d.a.isReactNative()?a.targetRN:i[a.target]};for(r=a.height;r>=180;r/=2){if("break"===s())break}}else a&&(o=d.a.isReactNative()?a.targetRN:i[a.target]);return Math.min(o/1e3,function(e){if(e>6e4)return Number.MAX_SAFE_INTEGER;return g*Math.pow(1.08,e/1e3)}(Math.max(0,n-1e3)))}var y=function(){function e(t,n,o){var r=this;Object(i.a)(this,e),this.eventEmitter=n,this._conference=t,this._localStats={connectionQuality:100,jvbRTT:void 0},this._lastConnectionQualityUpdate=-1,this._remoteStats={},this._timeIceConnected=-1,this._timeVideoUnmuted=-1,o.config.startBitrate&&o.config.startBitrate>0&&(g=o.config.startBitrate),t.on(a.CONNECTION_INTERRUPTED,(function(){r._updateLocalConnectionQuality(0),r.eventEmitter.emit(l.LOCAL_STATS_UPDATED,r._localStats),r._broadcastLocalStats()})),t.room.addListener(f.ICE_CONNECTION_STATE_CHANGED,(function(e,t){e.isP2P||"connected"!==t||(r._timeIceConnected=window.performance.now())})),t.on(a.ENDPOINT_MESSAGE_RECEIVED,(function(e,t){"stats"===t.type&&r._updateRemoteStats(e.getId(),t.values)})),t.on(a.ENDPOINT_STATS_RECEIVED,(function(e,t){r._updateRemoteStats(e.getId(),t)})),t.statistics.addConnectionStatsListener(this._updateLocalStats.bind(this)),t.on(a.TRACK_MUTE_CHANGED,(function(e){e.isVideoTrack()&&(e.isMuted()?r._timeVideoUnmuted=-1:r._maybeUpdateUnmuteTime())})),t.on(a.TRACK_ADDED,(function(e){e.isVideoTrack()&&!e.isMuted()&&r._maybeUpdateUnmuteTime()})),t.rtc.on(u.LOCAL_TRACK_MAX_ENABLED_RESOLUTION_CHANGED,(function(e){r._localStats.maxEnabledResolution=e.maxEnabledResolution})),t.on(a.SERVER_REGION_CHANGED,(function(e){r._localStats.serverRegion=e})),t.on(a.PROPERTIES_CHANGED,(function(e){r._localStats.bridgeCount=Number((e||{})["bridge-count"])}))}return Object(o.a)(e,[{key:"_maybeUpdateUnmuteTime",value:function(){this._timeVideoUnmuted<0&&(this._timeVideoUnmuted=window.performance.now())}},{key:"_calculateConnectionQuality",value:function(e,t,n){var i,o=h[n],r=100;if(this._localStats.packetLoss&&(i=this._localStats.packetLoss.upload,t&&(i*=.5)),t||!o||e===p.DESKTOP||this._timeIceConnected<0||this._timeVideoUnmuted<0)void 0===i?(m.error("Cannot calculate connection quality, unknown packet loss."),r=100):r=i<=2?100:i<=4?70:i<=6?50:i<=8?30:i<=12?10:0;else{var a=this._conference.getActivePeerConnection();if(a){var s=a.isSimulcastOn(),c=a.getTargetVideoBitrates();c.codec=a.getConfiguredVideoCodec();var u=b(s,o,window.performance.now()-Math.max(this._timeVideoUnmuted,this._timeIceConnected),c);u=Math.min(u,2500),r=100*this._localStats.bitrate.upload/u}i&&i>=10&&(r=Math.min(r,30))}if(this._lastConnectionQualityUpdate>0){var l=this._localStats.connectionQuality,d=(window.performance.now()-this._lastConnectionQualityUpdate)/1e3;r=Math.min(r,l+2*d)}return Math.min(100,r)}},{key:"_updateLocalConnectionQuality",value:function(e){this._localStats.connectionQuality=e,this._lastConnectionQualityUpdate=window.performance.now()}},{key:"_broadcastLocalStats",value:function(){var e={bitrate:this._localStats.bitrate,packetLoss:this._localStats.packetLoss,connectionQuality:this._localStats.connectionQuality,jvbRTT:this._localStats.jvbRTT,serverRegion:this._localStats.serverRegion,maxEnabledResolution:this._localStats.maxEnabledResolution,avgAudioLevels:this._localStats.localAvgAudioLevels};try{this._conference.sendEndpointStatsMessage(e)}catch(t){}}},{key:"_updateLocalStats",value:function(e,t){if(!e.isP2P){var n=t.transport&&t.transport.length&&t.transport[0].rtt;this._localStats.jvbRTT=n||void 0}if(e===this._conference.getActivePeerConnection()){var i,o=!this._conference.isConnectionInterrupted(),r=this._conference.getLocalVideoTrack(),a=r?r.videoType:void 0,s=!r||r.isMuted(),c=r?Math.min(r.resolution,r.maxEnabledResolution):null;for(i in s||this._maybeUpdateUnmuteTime(),t)t.hasOwnProperty(i)&&(this._localStats[i]=t[i]);o&&this._updateLocalConnectionQuality(this._calculateConnectionQuality(a,s,c)),this.eventEmitter.emit(l.LOCAL_STATS_UPDATED,this._localStats),this._broadcastLocalStats()}}},{key:"_updateRemoteStats",value:function(e,t){this._remoteStats[e]={bitrate:t.bitrate,packetLoss:t.packetLoss,connectionQuality:t.connectionQuality,jvbRTT:t.jvbRTT,serverRegion:t.serverRegion,maxEnabledResolution:t.maxEnabledResolution,avgAudioLevels:t.avgAudioLevels},this.eventEmitter.emit(l.REMOTE_STATS_UPDATED,e,this._remoteStats[e])}},{key:"getStats",value:function(){return this._localStats}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u}));var i=n(6),o=n(8),r=n(18),a=n(63),s=n(10),c=Object(r.getLogger)(e),u=function(){function e(t){Object(i.a)(this,e),this._conference=t}return Object(o.a)(e,[{key:"_actOnIceFailed",value:function(){var e=this._conference.options.config,t=e.enableForcedReload,n=e.enableIceRestart,i="undefined"!==typeof n&&!n,o=this._conference.room.supportsRestartByTerminate(),r=o&&!n,u=this._conference.restartInProgress&&t;if(c.info("ICE failed,"+" enableForcedReload: ".concat(t,",")+" enableIceRestart: ".concat(n,",")+" restartInProgress: ".concat(this._conference.restartInProgress,",")+" supports restart by terminate: ".concat(o)),i||!n&&!o||u)return c.info("ICE failed, but ICE restarts are disabled"),void this._conference.eventEmitter.emit(s.CONFERENCE_FAILED,a.ICE_FAILED);var l=this._conference.jvbJingleSession,d=l&&l.getIceConnectionState();l?"connected"===d?c.info("ICE connection restored - not sending ICE failed"):(c.info("Sending ICE failed - the connection did not recover, "+"ICE state: ".concat(d,", ")+"use 'session-terminate': ".concat(r)),r?this._conference.jvbJingleSession.terminate((function(){c.info("session-terminate for ice restart - done")}),(function(e){c.error("session-terminate for ice restart - error: ".concat(e.message))}),{reason:"connectivity-error",reasonDescription:"ICE FAILED",requestRestart:!0,sendSessionTerminate:!0}):this._conference.jvbJingleSession.sendIceFailedNotification()):c.warn("Not sending ICE failed - no JVB connection")}},{key:"start",value:function(){var e=this;this._conference.xmpp.ping(65e3).then((function(){e._canceled||(e._iceFailedTimeout=window.setTimeout((function(){e._iceFailedTimeout=void 0,e._actOnIceFailed()}),2e3))}),(function(e){c.error("PING error/timeout - not sending ICE failed",e)}))}},{key:"cancel",value:function(){this._canceled=!0,window.clearTimeout(this._iceFailedTimeout)}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var i=n(6),o=n(8),r=n(25),a=n(35),s=n(34),c=n(55),u=n.n(c),l=n(10),d=n(58),h=n(20),p=n(75),f=function(e){Object(a.a)(n,e);var t=Object(s.a)(n);function n(e){var o;return Object(i.a)(this,n),(o=t.call(this))._conference=e,o._timeoutTrigger=null,o._hasAudioInput=null,h.a.supportsReceiverStats()||e.statistics.addAudioLevelListener(o._audioLevel.bind(Object(r.a)(o))),e.on(l.TRACK_ADDED,o._trackAdded.bind(Object(r.a)(o))),o}return Object(o.a)(n,[{key:"_clearTriggerTimeout",value:function(){clearTimeout(this._timeoutTrigger),this._timeoutTrigger=null}},{key:"_handleAudioInputStateChange",value:function(e){var t=0!==e;null!==this._hasAudioInput&&this._hasAudioInput===t||(this._hasAudioInput=t,this.emit(p.AUDIO_INPUT_STATE_CHANGE,this._hasAudioInput))}},{key:"_handleNoAudioInputDetection",value:function(e){var t=this;this._eventFired||(0!==e||this._timeoutTrigger?0!==e&&this._timeoutTrigger&&this._clearTriggerTimeout():this._timeoutTrigger=setTimeout((function(){t._eventFired=!0,t.emit(p.NO_AUDIO_INPUT)}),4e3))}},{key:"_audioLevel",value:function(e,t,n,i){if(i&&this._audioTrack){var o=e.localSSRCs.get(this._audioTrack.rtcId);o&&o.ssrcs.includes(t)&&(this._handleAudioInputStateChange(n),this._handleNoAudioInputDetection(n))}}},{key:"_trackAdded",value:function(e){var t=this;e.isLocalAudioTrack()&&(this._audioTrack=e,this._eventFired=!1,this._clearTriggerTimeout(),h.a.supportsReceiverStats()&&(e.on(d.NO_AUDIO_INPUT,(function(e){t._handleNoAudioInputDetection(e)})),e.on(d.TRACK_AUDIO_LEVEL_CHANGED,(function(e){t._handleNoAudioInputDetection(e),t._handleAudioInputStateChange(e)}))))}}]),n}(u.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(6),o=n(8),r=n(10),a=n(31),s=n.n(a),c=function(){function e(t){Object(i.a)(this,e),this.conference=t,t.addEventListener(r.TRACK_AUDIO_LEVEL_CHANGED,this._audioLevel.bind(this)),this.myUserID=this.conference.myUserId()}return Object(o.a)(e,[{key:"_audioLevel",value:function(e,t){!this.conference.isP2PActive()||t<=.6||e===this.myUserID&&this.conference.getLocalAudioTrack().isMuted()||this.conference.rtc.eventEmitter.emit(s.a.DOMINANT_SPEAKER_CHANGED,e)}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var i=n(6),o=n(8),r=n(25),a=n(35),s=n(34),c=n(55),u=n(100),l=n(75),d=function(e){Object(a.a)(n,e);var t=Object(s.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.call(this))._processing=!1,e._scoreArray=[],e._audioLvlArray=[],e._active=!1,e._calculateNoisyScore=e._calculateNoisyScore.bind(Object(r.a)(e)),e}return Object(o.a)(n,[{key:"_calculateNoisyScore",value:function(){var e=Object(u.b)(this._scoreArray),t=Object(u.b)(this._audioLvlArray);e<.2&&t>.04&&(this.emit(l.VAD_NOISY_DEVICE),this._setActiveState(!1)),this.reset()}},{key:"_recordValues",value:function(e,t){this._scoreArray.push(e),this._audioLvlArray.push(t)}},{key:"_setActiveState",value:function(e){this._active=e,this.emit(l.DETECTOR_STATE_CHANGE,this._active)}},{key:"changeMuteState",value:function(e){this._setActiveState(!e),this.reset()}},{key:"isActive",value:function(){return this._active}},{key:"reset",value:function(){this._processing=!1,this._scoreArray=[],this._audioLvlArray=[],clearTimeout(this._processTimeout)}},{key:"processVADScore",value:function(e){if(this._active)if(this._processing){var t=Object(u.c)(e.pcmData);this._recordValues(e.score,Object(u.b)(t))}else if(e.score<.2){var n=Object(u.c)(e.pcmData),i=Object(u.b)(n);i>.02&&(this._processing=!0,this._recordValues(e.score,i),this._processTimeout=setTimeout(this._calculateNoisyScore,1500))}}}]),n}(c.EventEmitter)},function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var i=n(6),o=n(8),r=n(25),a=n(35),s=n(34),c=n(55),u=n(100),l=n(75),d=function(e){Object(a.a)(n,e);var t=Object(s.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.call(this))._processing=!1,e._scoreArray=[],e._active=!1,e._calculateVADScore=e._calculateVADScore.bind(Object(r.a)(e)),e}return Object(o.a)(n,[{key:"_calculateVADScore",value:function(){Object(u.b)(this._scoreArray)>.6&&(this.emit(l.VAD_TALK_WHILE_MUTED),this._setActiveState(!1)),this.reset()}},{key:"_setActiveState",value:function(e){this._active=e,this.emit(l.DETECTOR_STATE_CHANGE,this._active)}},{key:"changeMuteState",value:function(e){this._setActiveState(e),this.reset()}},{key:"isActive",value:function(){return this._active}},{key:"processVADScore",value:function(e){this._active&&(this._processing?this._scoreArray.push(e.score):e.score>.9&&(this._processing=!0,this._scoreArray.push(e.score),this._processTimeout=setTimeout(this._calculateVADScore,700)))}},{key:"reset",value:function(){this._processing=!1,this._scoreArray=[],clearTimeout(this._processTimeout)}}]),n}(c.EventEmitter)},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return f}));var i=n(6),o=n(8),r=n(18),a=n(10),s=n(223),c=n(32),u=n(27),l=Object(r.getLogger)(e),d="e2e-ping-request",h="e2e-ping-response",p=function(){function e(t,n){Object(i.a)(this,e),this.participant=t,this.e2eping=n,this.id=t.getId(),this.requests={},this.lastRequestId=1,this.clearIntervals=this.clearIntervals.bind(this),this.sendRequest=this.sendRequest.bind(this),this.handleResponse=this.handleResponse.bind(this),this.maybeSendAnalytics=this.maybeSendAnalytics.bind(this),this.sendAnalytics=this.sendAnalytics.bind(this),n.isDataChannelOpen&&this.sendRequest(),this.pingInterval=window.setInterval(this.sendRequest,n.pingIntervalMs),this.analyticsInterval=window.setTimeout(this.maybeSendAnalytics,this.e2eping.analyticsIntervalMs)}return Object(o.a)(e,[{key:"clearIntervals",value:function(){this.pingInterval&&window.clearInterval(this.pingInterval),this.analyticsInterval&&window.clearInterval(this.analyticsInterval)}},{key:"sendRequest",value:function(){var e=this.lastRequestId++,t={type:d,id:e};this.e2eping.sendMessage(t,this.id),this.requests[e]={id:e,timeSent:window.performance.now()}}},{key:"handleResponse",value:function(e){var t=this.requests[e.id];t&&(t.rtt=window.performance.now()-t.timeSent,this.e2eping.eventEmitter.emit(s.E2E_RTT_CHANGED,this.participant,t.rtt)),this.maybeSendAnalytics()}},{key:"maybeSendAnalytics",value:function(){var e,t,n=window.performance.now(),i=1/0;for(t in this.requests)this.requests.hasOwnProperty(t)&&((e=this.requests[t]).timeSent<n-this.e2eping.analyticsIntervalMs?delete this.requests[t]:e.rtt&&(i=Math.min(i,e.rtt)));i<1/0&&this.sendAnalytics(i)}},{key:"sendAnalytics",value:function(e){u.a.sendAnalytics(Object(c.D)(this.id,this.participant.getProperty("region"),e))}}]),e}(),f=function(){function e(t,n,o){Object(i.a)(this,e),this.conference=t,this.eventEmitter=t.eventEmitter,this.sendMessage=o,this.pingIntervalMs=1e4,this.analyticsIntervalMs=6e4,this.participants={},this.isDataChannelOpen=!1,n&&n.e2eping&&("number"===typeof n.e2eping.pingInterval&&(this.pingIntervalMs=n.e2eping.pingInterval),"number"===typeof n.e2eping.analyticsInterval&&(this.analyticsIntervalMs=n.e2eping.analyticsInterval),this.analyticsIntervalMs>0&&this.analyticsIntervalMs<this.pingIntervalMs&&(this.analyticsIntervalMs=this.pingIntervalMs)),l.info("Initializing e2e ping; pingInterval=".concat(this.pingIntervalMs,", analyticsInterval=").concat(this.analyticsIntervalMs,".")),this.participantJoined=this.participantJoined.bind(this),t.on(a.USER_JOINED,this.participantJoined),this.participantLeft=this.participantLeft.bind(this),t.on(a.USER_LEFT,this.participantLeft),this.messageReceived=this.messageReceived.bind(this),t.on(a.ENDPOINT_MESSAGE_RECEIVED,this.messageReceived),this.dataChannelOpened=this.dataChannelOpened.bind(this),t.on(a.DATA_CHANNEL_OPENED,this.dataChannelOpened)}return Object(o.a)(e,[{key:"dataChannelOpened",value:function(){for(var e in this.isDataChannelOpen=!0,this.participants)if(this.participants.hasOwnProperty(e)){var t=this.participants[e];window.setTimeout(t.sendRequest,200)}}},{key:"messageReceived",value:function(e,t){t.type===d?this.handleRequest(e.getId(),t):t.type===h&&this.handleResponse(e.getId(),t)}},{key:"participantJoined",value:function(e,t){this.pingIntervalMs<=0||(this.participants[e]&&(l.info("Participant wrapper already exists for ".concat(e,". Clearing.")),this.participants[e].clearIntervals(),delete this.participants[e]),this.participants[e]=new p(t,this))}},{key:"participantLeft",value:function(e){this.pingIntervalMs<=0||this.participants[e]&&(this.participants[e].clearIntervals(),delete this.participants[e])}},{key:"handleRequest",value:function(e,t){if(t&&t.id){var n={type:h,id:t.id};this.sendMessage(n,e)}else l.info("Received an invalid e2e ping request from ".concat(e,"."))}},{key:"handleResponse",value:function(e,t){var n=this.participants[e];n&&n.handleResponse(t)}},{key:"stop",value:function(){for(var e in l.info("Stopping e2eping"),this.conference.off(a.USER_JOINED,this.participantJoined),this.conference.off(a.USER_LEFT,this.participantLeft),this.conference.off(a.ENDPOINT_MESSAGE_RECEIVED,this.messageReceived),this.conference.off(a.DATA_CHANNEL_OPENED,this.dataChannelOpened),this.participants)this.participants.hasOwnProperty(e)&&this.participants[e].clearIntervals();this.participants={}}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return c}));var i=n(6),o=n(8),r=n(18),a=n(10),s=Object(r.getLogger)(e),c=function(){function e(t){var n=this;Object(i.a)(this,e),this._conference=t,this._jvb121=!0,this._conference.addEventListener(a.USER_JOINED,(function(){return n.evaluateStatus()})),this._conference.addEventListener(a.USER_LEFT,(function(){return n.evaluateStatus()})),this._conference.addEventListener(a.P2P_STATUS,(function(){return n.evaluateStatus()}))}return Object(o.a)(e,[{key:"evaluateStatus",value:function(){var e=this._jvb121,t=!this._conference.isP2PActive()&&this._conference.getParticipantCount()<=2;e!==t&&(this._jvb121=t,s.debug("JVB121 status ".concat(e," => ").concat(t)),this._conference.eventEmitter.emit(a.JVB121_STATUS,e,t))}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return h}));var i=n(14),o=n(6),r=n(8),a=n(18),s=n(105),c=n.n(s),u=n(10),l=Object(a.getLogger)(e),d=function(){function e(){Object(o.a)(this,e),this._defaultConstraints={maxHeight:180},this._lastN=-1,this._maxFrameHeight=2160,this._selectedEndpoints=[],this._receiverVideoConstraints={constraints:{},defaultConstraints:this.defaultConstraints,lastN:this._lastN,onStageEndpoints:[],selectedEndpoints:this._selectedEndpoints}}return Object(r.a)(e,[{key:"constraints",get:function(){return this._receiverVideoConstraints.lastN=this._lastN,this._selectedEndpoints.length?(this._receiverVideoConstraints.constraints={},this._selectedEndpoints.length>1?(this._receiverVideoConstraints.defaultConstraints={maxHeight:this._maxFrameHeight},this._receiverVideoConstraints.onStageEndpoints=[],this._receiverVideoConstraints.selectedEndpoints=[]):(this._receiverVideoConstraints.constraints[this._selectedEndpoints[0]]={maxHeight:this._maxFrameHeight},this._receiverVideoConstraints.defaultConstraints=this._defaultConstraints,this._receiverVideoConstraints.onStageEndpoints=this._selectedEndpoints,this._receiverVideoConstraints.selectedEndpoints=[]),this._receiverVideoConstraints):this._receiverVideoConstraints}},{key:"updateLastN",value:function(e){var t=this._lastN!==e;return t&&(this._lastN=e,l.debug("Updating ReceiverVideoConstraints lastN(".concat(e,")"))),t}},{key:"updateReceiveResolution",value:function(e){var t=this._maxFrameHeight!==e;return t&&(this._maxFrameHeight=e,l.debug("Updating receive maxFrameHeight: ".concat(e))),t}},{key:"updateReceiverVideoConstraints",value:function(e){var t=!c()(this._receiverVideoConstraints,e);return t&&(this._receiverVideoConstraints=e,l.debug("Updating ReceiverVideoConstraints ".concat(JSON.stringify(e)))),t}},{key:"updateSelectedEndpoints",value:function(e){l.debug("Updating selected endpoints: ".concat(JSON.stringify(e))),this._selectedEndpoints=e}}]),e}(),h=function(){function e(t,n){var i,r,a=this;Object(o.a)(this,e),this._conference=t,this._rtc=n;var s=t.options.config;(this._lastN=null!==(i=null===s||void 0===s?void 0:s.startLastN)&&void 0!==i?i:(null===s||void 0===s?void 0:s.channelLastN)||-1,this._maxFrameHeight=2160,null===(r=null===s||void 0===s?void 0:s.useNewBandwidthAllocationStrategy)||void 0===r||r)?(this._receiverVideoConstraints=new d,this._receiverVideoConstraints.updateLastN(this._lastN)&&this._rtc.setNewReceiverVideoConstraints(this._receiverVideoConstraints.constraints)):this._rtc.setLastN(this._lastN);this._selectedEndpoints=[],this._conference.on(u._MEDIA_SESSION_STARTED,(function(e){return a._onMediaSessionStarted(e)}))}return Object(r.a)(e,[{key:"_onMediaSessionStarted",value:function(e){e.isP2P||!this._receiverVideoConstraints?e.setReceiverVideoConstraint(this._maxFrameHeight):(this._receiverVideoConstraints.updateReceiveResolution(this._maxFrameHeight),this._rtc.setNewReceiverVideoConstraints(this._receiverVideoConstraints.constraints))}},{key:"getLastN",value:function(){return this._lastN}},{key:"selectEndpoints",value:function(e){var t=this;if(this._selectedEndpoints=e,this._receiverVideoConstraints){var n=e.filter((function(e){return e!==t._conference.myUserId()})),i=JSON.parse(JSON.stringify(this._receiverVideoConstraints.constraints));n.length&&this._receiverVideoConstraints.updateSelectedEndpoints(n);var o=this._receiverVideoConstraints.constraints;c()(o,i)||this._rtc.setNewReceiverVideoConstraints(o)}else this._rtc.selectEndpoints(e)}},{key:"setLastN",value:function(e){if(this._lastN!==e){if(this._lastN=e,this._receiverVideoConstraints)return void(this._receiverVideoConstraints.updateLastN(e)&&this._rtc.setNewReceiverVideoConstraints(this._receiverVideoConstraints.constraints));this._rtc.setLastN(e)}}},{key:"setPreferredReceiveMaxFrameHeight",value:function(e){this._maxFrameHeight=e;var t,n=Object(i.a)(this._conference._getMediaSessions());try{for(n.s();!(t=n.n()).done;){var o=t.value;if(o.isP2P||!this._receiverVideoConstraints)e&&o.setReceiverVideoConstraint(e);else this._receiverVideoConstraints.updateReceiveResolution(e)&&this._rtc.setNewReceiverVideoConstraints(this._receiverVideoConstraints.constraints)}}catch(r){n.e(r)}finally{n.f()}}},{key:"setReceiverConstraints",value:function(e){if(this._receiverVideoConstraints||(this._receiverVideoConstraints=new d),this._receiverVideoConstraints.updateReceiverVideoConstraints(e)){var t,n;this._lastN=null!==(t=e.lastN)&&void 0!==t?t:this._lastN,this._selectedEndpoints=null!==(n=e.selectedEndpoints)&&void 0!==n?n:this._selectedEndpoints,this._rtc.setNewReceiverVideoConstraints(e);var i=this._conference._getMediaSessions().find((function(e){return e.isP2P}));if(i){var o,r,a=null===(o=Object.values(e.constraints)[0])||void 0===o?void 0:o.maxHeight;if(!a)a=null===(r=e.defaultConstraints)||void 0===r?void 0:r.maxHeight;a&&i.setReceiverVideoConstraint(a)}}}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n(14),o=n(6),r=n(8),a=n(10),s=n(31),c=n.n(s),u=n(218),l=function(){function e(t,n){var i,r,s=this;Object(o.a)(this,e),this.conference=t,this.layerSuspensionEnabled=null===(i=t.options)||void 0===i||null===(r=i.config)||void 0===r?void 0:r.enableLayerSuspension,this.rtc=n,this.conference.on(a._MEDIA_SESSION_STARTED,(function(e){return s._onMediaSessionStarted(e)})),this.conference.on(a._MEDIA_SESSION_ACTIVE_CHANGED,(function(){return s._propagateSendMaxFrameHeight()})),this.rtc.on(c.a.SENDER_VIDEO_CONSTRAINTS_CHANGED,(function(e){var t;(null===(t=s._senderVideoConstraints)||void 0===t?void 0:t.idealHeight)!==e.idealHeight&&(s._senderVideoConstraints=e,s._propagateSendMaxFrameHeight())}))}return Object(r.a)(e,[{key:"_onMediaSessionStarted",value:function(e){var t=this;e.addListener(u.a.REMOTE_VIDEO_CONSTRAINTS_CHANGED,(function(e){e===t.conference._getActiveMediaSession()&&t._propagateSendMaxFrameHeight()})),e.setSenderVideoDegradationPreference(),e.setSenderMaxBitrates()}},{key:"_propagateSendMaxFrameHeight",value:function(){var e=this.selectSendMaxFrameHeight(),t=[];if(e>=0){var n,o=Object(i.a)(this.conference._getMediaSessions());try{for(o.s();!(n=o.n()).done;){var r=n.value;t.push(r.setSenderVideoConstraint(e))}}catch(a){o.e(a)}finally{o.f()}}return Promise.all(t)}},{key:"selectSendMaxFrameHeight",value:function(){var e,t=this.conference._getActiveMediaSession(),n=t?t.isP2P?t.getRemoteRecvMaxFrameHeight():this.layerSuspensionEnabled?null===(e=this._senderVideoConstraints)||void 0===e?void 0:e.idealHeight:void 0:void 0;return this.preferredSendMaxFrameHeight>=0&&n>=0?Math.min(this.preferredSendMaxFrameHeight,n):n>=0?n:this.preferredSendMaxFrameHeight}},{key:"setPreferredSendMaxFrameHeight",value:function(e){return this.preferredSendMaxFrameHeight=e,this._propagateSendMaxFrameHeight()}}]),e}()},function(e,t,n){"use strict";(function(e){var i=n(7),o=n(6),r=n(8),a=n(18),s=n(9),c=n.n(s),u=n(281),l=n(172),d=Object(a.getLogger)(e),h=function(){function e(t){Object(o.a)(this,e),this._sessions={},this._chatRoom=t,this.onPresence=this.onPresence.bind(this),this._chatRoom.eventEmitter.addListener(c.a.PRESENCE_RECEIVED,this.onPresence)}return Object(r.a)(e,[{key:"getSession",value:function(e){return this._sessions[e]}},{key:"onPresence",value:function(e){var t=e.fromHiddenDomain,n=e.presence;l.a.isFromFocus(n)?this._handleFocusPresence(n):t&&this._handleJibriPresence(n)}},{key:"startRecording",value:function(e){var t=this,n=new u.a(Object(i.a)(Object(i.a)({},e),{},{connection:this._chatRoom.connection}));return n.start({appData:e.appData,broadcastId:e.broadcastId,focusMucJid:this._chatRoom.focusMucJid,streamId:e.streamId}).then((function(){return t.getSession(n.getID())||(t._addSession(n),t._emitSessionUpdate(n)),n})).catch((function(e){return t._emitSessionUpdate(n),Promise.reject(e)}))}},{key:"stopRecording",value:function(e){var t=this.getSession(e);return t?t.stop({focusMucJid:this._chatRoom.focusMucJid}):Promise.reject(new Error("Could not find session"))}},{key:"_addSession",value:function(e){this._sessions[e.getID()]=e}},{key:"_createSession",value:function(e,t,n){var i=new u.a({connection:this._chatRoom.connection,focusMucJid:this._chatRoom.focusMucJid,mode:n,sessionID:e,status:t});return this._addSession(i),i}},{key:"_emitSessionUpdate",value:function(e,t){this._chatRoom.eventEmitter.emit(c.a.RECORDER_STATE_CHANGED,e,t)}},{key:"_handleFocusPresence",value:function(e){var t=l.a.getFocusRecordingUpdate(e);if(t){var n=t.error,i=t.initiator,o=t.recordingMode,r=t.sessionID,a=t.status,s=this.getSession(r);s||"off"!==a?s&&s.getStatus()===a&&s.getError()===n?d.warn("Ignoring duplicate presence update: ",JSON.stringify(t)):(s||(s=this._createSession(r,a,o)),s.setStatus(a),n&&s.setError(n),this._emitSessionUpdate(s,i)):d.warn("Ignoring recording presence update","Received a new session with status off.")}}},{key:"_handleJibriPresence",value:function(e){var t=l.a.getHiddenDomainUpdate(e),n=t.liveStreamViewURL,i=t.mode,o=t.sessionID;if(o){var r=this.getSession(o);r||(r=this._createSession(o,"",i)),r.setLiveStreamViewURL(n),this._emitSessionUpdate(r)}else d.warn("Ignoring potential jibri presence due to no session id.")}}]),e}();t.a=h}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return h}));var i=n(6),o=n(8),r=n(18),a=n(10),s=n(19),c=n(101),u=n(32),l=n(27),d=Object(r.getLogger)(e),h=function(){function e(t){Object(i.a)(this,e),this._conference=t,this._localAudioLevelCache={},this._reportedParticipants=[],this._audioProblemCandidates={},this._numberOfRemoteAudioLevelsReceived={},this._onLocalAudioLevelsReport=this._onLocalAudioLevelsReport.bind(this),this._onRemoteAudioLevelReceived=this._onRemoteAudioLevelReceived.bind(this),this._clearUserData=this._clearUserData.bind(this),this._conference.on(c.REMOTE_STATS_UPDATED,this._onRemoteAudioLevelReceived),this._conference.statistics.addConnectionStatsListener(this._onLocalAudioLevelsReport),this._conference.on(a.USER_LEFT,this._clearUserData)}return Object(o.a)(e,[{key:"_onRemoteAudioLevelReceived",value:function(e,t){var n=t.avgAudioLevels,i=this._numberOfRemoteAudioLevelsReceived[e]+1||0;if(this._numberOfRemoteAudioLevelsReceived[e]=i,!(-1!==this._reportedParticipants.indexOf(e)||e in this._audioProblemCandidates||n<=0||i<3)){var o=this._conference.getParticipantById(e);if(o)if(o.getTracksByMediaType(s.a).length>0&&o.isAudioMuted())return;var r=this._localAudioLevelCache[e];Array.isArray(r)&&!r.every((function(e){return 0===e}))||(this._audioProblemCandidates[e]={remoteAudioLevels:n,localAudioLevels:[]})}}},{key:"_onLocalAudioLevelsReport",value:function(e,t){var n=this,i=t.avgAudioLevels;e===this._conference.getActivePeerConnection()&&(Object.keys(i).forEach((function(e){if(-1===n._reportedParticipants.indexOf(e)){var t=n._localAudioLevelCache[e];Array.isArray(t)?t.length>=2&&t.shift():n._localAudioLevelCache[e]=[],n._localAudioLevelCache[e].push(i[e])}})),Object.keys(this._audioProblemCandidates).forEach((function(e){var t=n._audioProblemCandidates[e],o=t.localAudioLevels,r=t.remoteAudioLevels;if(o.push(i[e]),2===o.length){if(o.every((function(e){return"undefined"===typeof e||0===e}))){var a=JSON.stringify(o);l.a.sendAnalytics(Object(u.x)(e,a,r)),d.warn("A potential problem is detected with the audio output for participant ".concat(e,", local audio levels: ").concat(a,", remote audio levels: ").concat(r)),n._reportedParticipants.push(e),n._clearUserData(e)}delete n._audioProblemCandidates[e]}})))}},{key:"_clearUserData",value:function(e){delete this._localAudioLevelCache[e]}},{key:"dispose",value:function(){this._conference.off(c.REMOTE_STATS_UPDATED,this._onRemoteAudioLevelReceived),this._conference.off(a.USER_LEFT,this._clearUserData),this._conference.statistics.removeConnectionStatsListener(this._onLocalAudioLevelsReport),this._localAudioLevelCache=void 0,this._audioProblemCandidates=void 0,this._reportedParticipants=void 0,this._numberOfRemoteAudioLevelsReceived=void 0,this._conference=void 0}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return y}));var i=n(14),o=n(6),r=n(8),a=n(18),s=n(105),c=n.n(s),u=n(10),l=n(19),d=n(47),h=n(101),p=n(32),f=n(20),m=n(27),v=Object(a.getLogger)(e),g=function(){function e(t){Object(o.a)(this,e),this.name=t,this.count=0,this.sum=0,this.samples=[]}return Object(r.a)(e,[{key:"addNext",value:function(e){"number"!==typeof e?v.error("".concat(this.name," - invalid value for idx: ").concat(this.count),e):isNaN(e)||(this.sum+=e,this.samples.push(e),this.count+=1)}},{key:"calculate",value:function(){return this.sum/this.count}},{key:"appendReport",value:function(e){e["".concat(this.name,"_avg")]=this.calculate(),e["".concat(this.name,"_samples")]=JSON.stringify(this.samples)}},{key:"reset",value:function(){this.samples=[],this.sum=0,this.count=0}}]),e}(),b=function(){function e(t,n,i){var r=this;Object(o.a)(this,e),this.isP2P=n,this._n=i,this._sampleIdx=0,this._avgRTT=new g("rtt"),this._avgRemoteRTTMap=new Map,this._avgRtpStatsReporter=t,this._avgEnd2EndRTT=void 0,this._onConnectionStats=function(e,t){r.isP2P===e.isP2P&&r._calculateAvgStats(t)};var a=t._conference;a.statistics.addConnectionStatsListener(this._onConnectionStats),this.isP2P||(this._onUserLeft=function(e){return r._avgRemoteRTTMap.delete(e)},a.on(u.USER_LEFT,this._onUserLeft),this._onRemoteStatsUpdated=function(e,t){return r._processRemoteStats(e,t)},a.on(h.REMOTE_STATS_UPDATED,this._onRemoteStatsUpdated))}return Object(r.a)(e,[{key:"_calculateAvgStats",value:function(e){if(e){if(f.a.supportsRTTStatistics()&&e.transport&&e.transport.length&&this._avgRTT.addNext(e.transport[0].rtt),this._sampleIdx+=1,this._sampleIdx>=this._n){if(f.a.supportsRTTStatistics()){var t=this._avgRtpStatsReporter._conference,n={p2p:this.isP2P,conference_size:t.getParticipantCount()};if(e.transport&&e.transport.length&&Object.assign(n,{local_candidate_type:e.transport[0].localCandidateType,remote_candidate_type:e.transport[0].remoteCandidateType,transport_type:e.transport[0].type}),this._avgRTT.appendReport(n),this.isP2P){var i=this._avgRtpStatsReporter.jvbStatsMonitor._avgEnd2EndRTT;isNaN(i)||(n.rtt_diff=this._avgRTT.calculate()-i)}else{var o=this._calculateAvgRemoteRTT(),r=this._avgRTT.calculate();this._avgEnd2EndRTT=r+o,isNaN(r)||isNaN(o)||(n.end2end_rtt_avg=this._avgEnd2EndRTT)}m.a.sendAnalytics(Object(p.L)(n))}this._resetAvgStats()}}else v.error("No stats")}},{key:"_calculateAvgRemoteRTT",value:function(){var e,t=0,n=0,o=Object(i.a)(this._avgRemoteRTTMap.values());try{for(o.s();!(e=o.n()).done;){var r=e.value,a=r.calculate();isNaN(a)||(n+=a,t+=1,r.reset())}}catch(s){o.e(s)}finally{o.f()}return n/t}},{key:"_processRemoteStats",value:function(e,t){var n="number"===typeof t.jvbRTT,i=this._avgRemoteRTTMap.get(e);!i&&n&&(i=new g("".concat(e,"_stat_rtt")),this._avgRemoteRTTMap.set(e,i)),n?i.addNext(t.jvbRTT):i&&this._avgRemoteRTTMap.delete(e)}},{key:"_resetAvgStats",value:function(){this._avgRTT.reset(),this._avgRemoteRTTMap&&this._avgRemoteRTTMap.clear(),this._sampleIdx=0}},{key:"dispose",value:function(){var e=this._avgRtpStatsReporter._conference;e.statistics.removeConnectionStatsListener(this._onConnectionStats),this.isP2P||(e.off(h.REMOTE_STATS_UPDATED,this._onRemoteStatsUpdated),e.off(u.USER_LEFT,this._onUserLeft))}}]),e}(),y=function(){function e(t,n){var i=this;Object(o.a)(this,e),this._n=n,n>0?(v.info("Avg RTP stats will be calculated every ".concat(n," samples")),this._sampleIdx=0,this._conference=t,this._avgAudioBitrateUp=new g("bitrate_audio_upload"),this._avgAudioBitrateDown=new g("bitrate_audio_download"),this._avgVideoBitrateUp=new g("bitrate_video_upload"),this._avgVideoBitrateDown=new g("bitrate_video_download"),this._avgBandwidthUp=new g("bandwidth_upload"),this._avgBandwidthDown=new g("bandwidth_download"),this._avgPacketLossTotal=new g("packet_loss_total"),this._avgPacketLossUp=new g("packet_loss_upload"),this._avgPacketLossDown=new g("packet_loss_download"),this._avgRemoteFPS=new g("framerate_remote"),this._avgRemoteScreenFPS=new g("framerate_screen_remote"),this._avgLocalFPS=new g("framerate_local"),this._avgLocalScreenFPS=new g("framerate_screen_local"),this._avgRemoteCameraPixels=new g("pixels_remote"),this._avgRemoteScreenPixels=new g("pixels_screen_remote"),this._avgLocalCameraPixels=new g("pixels_local"),this._avgLocalScreenPixels=new g("pixels_screen_local"),this._avgCQ=new g("connection_quality"),this._cachedTransportStats=void 0,this._onLocalStatsUpdated=function(e){i._calculateAvgStats(e),i._maybeSendTransportAnalyticsEvent(e)},t.on(h.LOCAL_STATS_UPDATED,this._onLocalStatsUpdated),this._onP2PStatusChanged=function(){v.debug("Resetting average stats calculation"),i._resetAvgStats(),i.jvbStatsMonitor._resetAvgStats(),i.p2pStatsMonitor._resetAvgStats()},t.on(u.P2P_STATUS,this._onP2PStatusChanged),this._onJvb121StatusChanged=function(e,t){!0===t&&(v.info("Resetting JVB avg RTP stats"),i._resetAvgJvbStats())},t.on(u.JVB121_STATUS,this._onJvb121StatusChanged),this.jvbStatsMonitor=new b(this,!1,n),this.p2pStatsMonitor=new b(this,!0,n)):v.info("Avg RTP stats reports are disabled.")}return Object(r.a)(e,[{key:"_calculateAvgStats",value:function(e){if(e){var t=this._conference.isP2PActive(),n=this._conference.getParticipantCount();if(t||!(n<2)){var i=e.bitrate,o=e.bandwidth,r=e.packetLoss,a=e.framerate,s=e.resolution;if(i)if(o)if(r)if(a)if(s){if(this._avgAudioBitrateUp.addNext(i.audio.upload),this._avgAudioBitrateDown.addNext(i.audio.download),this._avgVideoBitrateUp.addNext(i.video.upload),this._avgVideoBitrateDown.addNext(i.video.download),f.a.supportsBandwidthStatistics()&&(this._avgBandwidthUp.addNext(o.upload),this._avgBandwidthDown.addNext(o.download)),this._avgPacketLossUp.addNext(r.upload),this._avgPacketLossDown.addNext(r.download),this._avgPacketLossTotal.addNext(r.total),this._avgCQ.addNext(e.connectionQuality),a&&(this._avgRemoteFPS.addNext(this._calculateAvgVideoFps(a,!1,d.CAMERA)),this._avgRemoteScreenFPS.addNext(this._calculateAvgVideoFps(a,!1,d.DESKTOP)),this._avgLocalFPS.addNext(this._calculateAvgVideoFps(a,!0,d.CAMERA)),this._avgLocalScreenFPS.addNext(this._calculateAvgVideoFps(a,!0,d.DESKTOP))),s&&(this._avgRemoteCameraPixels.addNext(this._calculateAvgVideoPixels(s,!1,d.CAMERA)),this._avgRemoteScreenPixels.addNext(this._calculateAvgVideoPixels(s,!1,d.DESKTOP)),this._avgLocalCameraPixels.addNext(this._calculateAvgVideoPixels(s,!0,d.CAMERA)),this._avgLocalScreenPixels.addNext(this._calculateAvgVideoPixels(s,!0,d.DESKTOP))),this._sampleIdx+=1,this._sampleIdx>=this._n){var c={p2p:t,conference_size:n};e.transport&&e.transport.length&&Object.assign(c,{local_candidate_type:e.transport[0].localCandidateType,remote_candidate_type:e.transport[0].remoteCandidateType,transport_type:e.transport[0].type}),this._avgAudioBitrateUp.appendReport(c),this._avgAudioBitrateDown.appendReport(c),this._avgVideoBitrateUp.appendReport(c),this._avgVideoBitrateDown.appendReport(c),f.a.supportsBandwidthStatistics()&&(this._avgBandwidthUp.appendReport(c),this._avgBandwidthDown.appendReport(c)),this._avgPacketLossUp.appendReport(c),this._avgPacketLossDown.appendReport(c),this._avgPacketLossTotal.appendReport(c),this._avgRemoteFPS.appendReport(c),isNaN(this._avgRemoteScreenFPS.calculate())||this._avgRemoteScreenFPS.appendReport(c),this._avgLocalFPS.appendReport(c),isNaN(this._avgLocalScreenFPS.calculate())||this._avgLocalScreenFPS.appendReport(c),this._avgRemoteCameraPixels.appendReport(c),isNaN(this._avgRemoteScreenPixels.calculate())||this._avgRemoteScreenPixels.appendReport(c),this._avgLocalCameraPixels.appendReport(c),isNaN(this._avgLocalScreenPixels.calculate())||this._avgLocalScreenPixels.appendReport(c),this._avgCQ.appendReport(c),m.a.sendAnalytics(Object(p.L)(c)),this._resetAvgStats()}}else v.error("No resolution");else v.error('No "framerate"');else v.error('No "packetloss"');else v.error('No "bandwidth"');else v.error('No "bitrate"')}}else v.error("No stats")}},{key:"_calculateAvgVideoPixels",value:function(e,t,n){for(var i=0,o=0,r=this._conference.myUserId(),a=0,s=Object.keys(e);a<s.length;a++){var c=s[a];if(t?c===r:c!==r){var u=t?null:this._conference.getParticipantById(c),l=e[c];if((t||u)&&l){var d=this._calculatePeerAvgVideoPixels(l,u,n);isNaN(d)||(i+=d,o+=1)}}}return i/o}},{key:"_calculatePeerAvgVideoPixels",value:function(e,t,n){var o=Object.keys(e).map((function(e){return Number(e)})),r=null,a=this._conference.getActivePeerConnection();t?(r=t.getTracksByMediaType(l.c))&&(o=o.filter((function(e){return r.find((function(t){return!t.isMuted()&&t.getSSRC()===e&&t.videoType===n}))}))):(r=this._conference.getLocalTracks(l.c),o=o.filter((function(e){return r.find((function(t){return!t.isMuted()&&a.getLocalSSRC(t)===e&&t.videoType===n}))})));var s,c=0,u=0,d=Object(i.a)(o);try{for(d.s();!(s=d.n()).done;){var h=s.value,p=Number(e[h].height)*Number(e[h].width);!isNaN(p)&&p>0&&(c+=p,u+=1)}}catch(f){d.e(f)}finally{d.f()}return c/u}},{key:"_calculateAvgVideoFps",value:function(e,t,n){for(var i=0,o=0,r=this._conference.myUserId(),a=0,s=Object.keys(e);a<s.length;a++){var c=s[a];if(t?c===r:c!==r){var u=t?null:this._conference.getParticipantById(c),l=e[c];if((t||u)&&l){var d=this._calculatePeerAvgVideoFps(l,u,n);isNaN(d)||(i+=d,o+=1)}}}return i/o}},{key:"_calculatePeerAvgVideoFps",value:function(e,t,n){var o=Object.keys(e).map((function(e){return Number(e)})),r=null,a=this._conference.getActivePeerConnection();t?(r=t.getTracksByMediaType(l.c))&&(o=o.filter((function(e){return r.find((function(t){return!t.isMuted()&&t.getSSRC()===e&&t.videoType===n}))}))):(r=this._conference.getLocalTracks(l.c),o=o.filter((function(e){return r.find((function(t){return!t.isMuted()&&a.getLocalSSRC(t)===e&&t.videoType===n}))})));var s,c=0,u=0,d=Object(i.a)(o);try{for(d.s();!(s=d.n()).done;){var h=s.value,p=Number(e[h]);!isNaN(p)&&p>0&&(c+=p,u+=1)}}catch(f){d.e(f)}finally{d.f()}return c/u}},{key:"_maybeSendTransportAnalyticsEvent",value:function(e){if(e&&e.transport&&e.transport.length){var t={p2p:e.transport[0].p2p,local_candidate_type:e.transport[0].localCandidateType,remote_candidate_type:e.transport[0].remoteCandidateType,transport_type:e.transport[0].type};this._cachedTransportStats&&c()(t,this._cachedTransportStats)||(this._cachedTransportStats=t,m.a.sendAnalytics(Object(p.M)(t)))}}},{key:"_resetAvgJvbStats",value:function(){this._resetAvgStats(),this.jvbStatsMonitor._resetAvgStats()}},{key:"_resetAvgStats",value:function(){this._avgAudioBitrateUp.reset(),this._avgAudioBitrateDown.reset(),this._avgVideoBitrateUp.reset(),this._avgVideoBitrateDown.reset(),this._avgBandwidthUp.reset(),this._avgBandwidthDown.reset(),this._avgPacketLossUp.reset(),this._avgPacketLossDown.reset(),this._avgPacketLossTotal.reset(),this._avgRemoteFPS.reset(),this._avgRemoteScreenFPS.reset(),this._avgLocalFPS.reset(),this._avgLocalScreenFPS.reset(),this._avgRemoteCameraPixels.reset(),this._avgRemoteScreenPixels.reset(),this._avgLocalCameraPixels.reset(),this._avgLocalScreenPixels.reset(),this._avgCQ.reset(),this._sampleIdx=0}},{key:"dispose",value:function(){this._conference.off(u.P2P_STATUS,this._onP2PStatusChanged),this._conference.off(h.LOCAL_STATS_UPDATED,this._onLocalStatsUpdated),this._conference.off(u.JVB121_STATUS,this._onJvb121StatusChanged),this.jvbStatsMonitor.dispose(),this.p2pStatsMonitor.dispose()}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n(6),o=n(8),r=n(10),a=n(9),s=n.n(a),c=n(245),u=n.n(c),l=function(){function e(t){Object(i.a)(this,e),this.stats={users:{},dominantSpeakerId:null};var n=t.myUserId();this.stats.users[n]=new u.a(n,null,!0),this.conference=t,t.addEventListener(r.DOMINANT_SPEAKER_CHANGED,this._onDominantSpeaker.bind(this)),t.addEventListener(r.USER_JOINED,this._onUserJoin.bind(this)),t.addEventListener(r.USER_LEFT,this._onUserLeave.bind(this)),t.addEventListener(r.DISPLAY_NAME_CHANGED,this._onDisplayNameChange.bind(this)),t.xmpp&&t.xmpp.addListener(s.a.SPEAKER_STATS_RECEIVED,this._updateStats.bind(this))}return Object(o.a)(e,[{key:"_onDominantSpeaker",value:function(e){var t=this.stats.users[this.stats.dominantSpeakerId],n=this.stats.users[e];t&&t.setDominantSpeaker(!1),n&&n.setDominantSpeaker(!0),this.stats.dominantSpeakerId=e}},{key:"_onUserJoin",value:function(e,t){t.isHidden()||this.stats.users[e]||(this.stats.users[e]=new u.a(e,t.getDisplayName()))}},{key:"_onUserLeave",value:function(e){var t=this.stats.users[e];t&&t.markAsHasLeft()}},{key:"_onDisplayNameChange",value:function(e,t){var n=this.stats.users[e];n&&n.setDisplayName(t)}},{key:"getStats",value:function(){return this.stats.users}},{key:"_updateStats",value:function(e){for(var t in e){var n=void 0,i=this.conference.getParticipantById(t);i&&i.isHidden()||(this.stats.users[t]?(n=this.stats.users[t]).getDisplayName()||n.setDisplayName(e[t].displayName):(n=new u.a(t,e[t].displayName),this.stats.users[t]=n,n.markAsHasLeft())),n.totalDominantSpeakerTime=e[t].totalDominantSpeakerTime}}}]),e}()},function(e,t,n){var i=n(305),o=n(508),r="before",a="recording",s="transcribing",c="finished";function u(){this.audioRecorder=new i,this.transcriptionService=new o,this.counter=null,this.startTime=null,this.transcription=null,this.callback=null,this.results=[],this.state=r,this.lineLength=0}function l(e,t){if(console.log("retrieved an answer from the transcription service. The answer has an"+" array of length: ".concat(t.wordArray.length)),t.wordArray.length>0){var n=t.startTime.getUTCMilliseconds()-e.startTime.getUTCMilliseconds();n<0&&(n=0);var i="[";t.wordArray.forEach((function(e){e.begin+=n,e.end+=n,i+="".concat(e.word,",")})),i+="]",console.log(i),t.wordArray.name=t.name}e.results.push(t.wordArray),e.counter--,console.log("current counter: ".concat(e.counter)),e.maybeMerge()}function d(e){for(var t=0;t<e.length;t++)0===e[t].length&&e.splice(t,1);return e.length>0}u.prototype.start=function(){if(this.state!==r)throw new Error("The transcription can only start when it's in the \"".concat(r,'" state. It\'s currently in the "').concat(this.state,'" state'));this.state=a,this.audioRecorder.start(),this.startTime=new Date},u.prototype.stop=function(e){var t=this;if(this.state!==a)throw new Error("The transcription can only stop when it's in the \"".concat(a,'" state. It\'s currently in the "').concat(this.state,'" state'));console.log("stopping recording and sending audio files"),this.audioRecorder.stop();var n=l.bind(null,this);this.audioRecorder.getRecordingResults().forEach((function(e){t.transcriptionService.send(e,n),t.counter++})),this.state=s,this.callback=e},u.prototype.maybeMerge=function(){this.state===s&&0===this.counter&&this.merge()},u.prototype.merge=function(){var e=this;console.log("starting merge process!\n The length of the array: ".concat(this.results.length)),this.transcription="";var t=this.results,n=[];d(t),t.forEach((function(e){return function(e,t){if(0===e.length)e.push(t);else{if(e[e.length-1].begin<=t.begin)return void e.push(t);for(var n=0;n<e.length;n++)if(t.begin<e[n].begin)return void e.splice(n,0,t);e.push(t)}}(n,e)}));for(var i=function(){var n=t[0];t.forEach((function(e){e[0].begin<n[0].begin&&(n=e)}));var i=n.shift();e.updateTranscription(i,n.name);for(var o=function(){var o=!1,r=n[0].begin;if(t.forEach((function(e){e[0].begin<r&&(o=!0)})),o)return"break";i=n.shift(),e.updateTranscription(i,null)};n.length>0;){if("break"===o())break}};d(t);)i();this.state=c,this.callback&&this.callback(this.transcription)},u.prototype.updateTranscription=function(e,t){void 0!==t&&null!==t&&(this.transcription+="\n".concat(t,":"),this.lineLength=t.length+1),this.lineLength+e.word.length>80&&(this.transcription+="\n    ",this.lineLength=4),this.transcription+=" ".concat(e.word),this.lineLength+=e.word.length+1},u.prototype.addTrack=function(e){this.audioRecorder.addTrack(e)},u.prototype.removeTrack=function(e){this.audioRecorder.removeTrack(e)},u.prototype.getTranscription=function(){if(this.state!==c)throw new Error("The transcription can only be retrieved when it's in the \"".concat(c,'" state. It\'s currently in the "').concat(this.state,'" state'));return this.transcription},u.prototype.getState=function(){return this.state},u.prototype.reset=function(){this.state=r,this.counter=null,this.transcription=null,this.startTime=null,this.callback=null,this.results=[],this.lineLength=0},e.exports=u},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return r}));var i=n(27),o=n(18).getLogger(e);function r(e){this.versions={},this.conference=e,this.conference.addCommandListener("versions",this.processVersions.bind(this))}r.prototype.processVersions=function(e,t,n){var r=this;if(this.conference._isFocus(n)){var a=[];e.children.forEach((function(e){var t=e.attributes.name,n=e.value;r.versions[t]!==n&&(r.versions[t]=n,o.info("Got ".concat(t," version: ").concat(n)),a.push({id:"component_version",component:t,version:n}))})),a.length>0&&i.a.sendLog(JSON.stringify(a))}else o.warn("Received versions not from the focus user: ".concat(e),n)},r.prototype.getComponentVersion=function(e){return this.versions[e]}}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return d}));var i=n(6),o=n(8),r=n(18),a=n(9),s=n.n(a),c=n(391),u=n(77),l=Object(r.getLogger)(e),d=function(){function e(t){Object(i.a)(this,e),this.chatRoom=t,this.eventEmitter=t.eventEmitter,l.debug("creating VideoSIPGW"),this.sessions={},this.sessionStateChangeListener=this.sessionStateChanged.bind(this),t.addPresenceListener("jibri-sip-call-state",this.handleJibriSIPState.bind(this))}return Object(o.a)(e,[{key:"handleJibriSIPState",value:function(e){var t=e.attributes;if(t){l.debug("Handle video sip gw state : ",t);var n=t.state;if(n!==this.state)switch(n){case u.STATE_ON:case u.STATE_OFF:case u.STATE_PENDING:case u.STATE_RETRYING:case u.STATE_FAILED:var i=t.sipaddress;if(!i)return;var o=this.sessions[i];o?o.setState(n,t.failure_reason):l.warn("Video SIP GW session not found:",i)}}}},{key:"createVideoSIPGWSession",value:function(e,t){if(this.sessions[e])return l.warn("There was already a Video SIP GW session for address",e),new Error(u.ERROR_SESSION_EXISTS);var n=new c.a(e,t,this.chatRoom);return n.addStateListener(this.sessionStateChangeListener),this.sessions[e]=n,n}},{key:"sessionStateChanged",value:function(e){var t=e.address;if(e.newState===u.STATE_OFF||e.newState===u.STATE_FAILED){var n=this.sessions[t];if(!n)return void l.error("Missing Video SIP GW session with address:",t);n.removeStateListener(this.sessionStateChangeListener),delete this.sessions[t]}this.eventEmitter.emit(s.a.VIDEO_SIP_GW_SESSION_STATE_CHANGED,e)}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return p}));var i=n(6),o=n(8),r=n(35),a=n(34),s=n(18),c=n(13),u=n(72),l=n(77),d=Object(s.getLogger)(e),h="STATE_CHANGED",p=function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(e,o,r){var a;return Object(i.a)(this,n),(a=t.call(this)).sipAddress=e,a.displayName=o,a.chatRoom=r,a.state=void 0,a}return Object(o.a)(n,[{key:"stop",value:function(){this.state!==l.STATE_OFF&&this.state!==l.STATE_FAILED?this._sendJibriIQ("stop"):d.warn("Video SIP GW session already stopped or failed!")}},{key:"start",value:function(){this.state!==l.STATE_ON&&this.state!==l.STATE_OFF&&this.state!==l.STATE_PENDING&&this.state!==l.STATE_RETRYING?this._sendJibriIQ("start"):d.warn("Video SIP GW session already started!")}},{key:"setState",value:function(e,t){if(e!==this.state){var n=this.state;this.state=e,this.eventEmitter.emit(h,{address:this.sipAddress,failureReason:t,oldState:n,newState:this.state,displayName:this.displayName})}}},{key:"addStateListener",value:function(e){this.addListener(h,e)}},{key:"removeStateListener",value:function(e){this.removeListener(h,e)}},{key:"_sendJibriIQ",value:function(e){var t=this,n={xmlns:"http://jitsi.org/protocol/jibri",action:e,sipaddress:this.sipAddress};n.displayname=this.displayName;var i=Object(c.$iq)({to:this.chatRoom.focusMucJid,type:"set"}).c("jibri",n).up();d.debug("".concat(e," video SIP GW session"),i.nodeTree),this.chatRoom.connection.sendIQ(i,(function(){}),(function(n){d.error("Failed to ".concat(e," video SIP GW session, error: "),n),t.setState(l.STATE_FAILED)}))}}]),n}(u.a)}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u}));var i=n(14),o=n(18),r=n(58),a=n(43),s=n(27),c=Object(o.getLogger)(e);function u(){return new Promise((function(e){a.a.enumerateDevices((function(t){var n,o=t.filter((function(e){return"audioinput"===e.kind})),u=[],d=Object(i.a)(o);try{for(d.s();!(n=d.n()).done;){var h=n.value,p=a.a.obtainAudioAndVideoPermissions({devices:["audio"],micDeviceId:h.deviceId}).then((function(e){var t=e[0],n=t.getOriginalStream();return s.a.startLocalStats(n,t.setAudioLevel.bind(t)),t.addEventListener(r.LOCAL_TRACK_STOPPED,(function(){s.a.stopLocalStats(n)})),t}));u.push(p)}}catch(f){d.e(f)}finally{d.f()}Promise.allSettled(u).then((function(t){var n,o=t.filter((function(e){return"fulfilled"===e.status})),a=t.filter((function(e){return"rejected"===e.status})),s=o.map((function(e){return e.value})),u=a.map((function(e){return e.value})),d=Object(i.a)(u);try{for(d.s();!(n=d.n()).done;){var h=n.value;c.error("Failed to acquire audio device with error: ",h)}}catch(f){d.e(f)}finally{d.f()}var p,m=Object(i.a)(s);try{var v=function(){var t=p.value;t.on(r.TRACK_AUDIO_LEVEL_CHANGED,(function(n){n>.008&&(l(s),e({deviceId:t.deviceId,deviceLabel:t.track.label}))}))};for(m.s();!(p=m.n()).done;)v()}catch(f){m.e(f)}finally{m.f()}setTimeout((function(){l(s),e({deviceId:"",deviceLabel:""})}),3e3)}))}))}))}function l(e){var t,n=Object(i.a)(e);try{for(n.s();!(t=n.n()).done;){t.value.stopStream()}}catch(o){n.e(o)}finally{n.f()}}}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return v}));var i=n(7),o=n(66),r=n(6),a=n(8),s=n(18),c=n(13),u=n(19),l=n(47),d=n.n(l),h=n(43),p=n(394),f=n(109),m=Object(s.getLogger)(e),v=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(r.a)(this,e);var n=t.jitsiConnection,a=Object(o.a)(t,["jitsiConnection"]);this._options=Object(i.a)({iceConfig:n&&n.xmpp.connection.jingle.p2pIceConfig},a),this._peerConnection=null,this._onFatalError=this._onFatalError.bind(this),this._onSendMessage=this._onSendMessage.bind(this),this._onRemoteStream=this._onRemoteStream.bind(this)}return Object(a.a)(e,[{key:"processMessage",value:function(e){var t=e.from;if(t)if(this._peerConnection&&this._peerConnection.getPeerJid()!==t)this._onFatalError(t,f.a.CONNECTION_ERROR,"rejected");else{var n=this._convertStringToXML(e.data.iq),i=n&&n.find("jingle"),o=i&&i.attr("action");o===f.a.INITIATE&&(this._peerConnection=this._createPeerConnection(t,{isInitiator:!1,receiveVideo:!0})),this._peerConnection&&this._peerConnection.processMessage(i),o!==f.a.CONNECTION_ERROR&&o!==f.a.UNAVAILABLE&&o!==f.a.TERMINATE||this._selfCloseConnection()}}},{key:"start",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this._peerConnection=this._createPeerConnection(e,{isInitiator:!0,receiveVideo:!1}),this._peerConnection.start(t)}},{key:"stop",value:function(){this._peerConnection&&this._peerConnection.stop(),this._peerConnection=null}},{key:"_convertStringToXML",value:function(e){try{var t=(new DOMParser).parseFromString(e,"text/xml");return $(t)}catch(n){return m.error("Attempted to convert incorrectly formatted xml"),null}}},{key:"_createPeerConnection",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw new Error("Cannot create ProxyConnectionPC without a peer.");var n=Object(i.a)({iceConfig:this._options.iceConfig,onError:this._onFatalError,onRemoteStream:this._onRemoteStream,onSendMessage:this._onSendMessage,peerJid:e},t);return new p.a(n)}},{key:"_onFatalError",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";m.error("Received a proxy connection error",e,t,n);var i=Object(c.$iq)({to:e,type:"set"}).c("jingle",{xmlns:"urn:xmpp:jingle:1",action:t}).c("details").t(n).up();this._onSendMessage(e,i),this._peerConnection&&this._peerConnection.getPeerJid()===e&&this._selfCloseConnection()}},{key:"_onRemoteStream",value:function(e){if(!this._options.onRemoteStream)return m.error("Remote track received without callback."),void e.dispose();var t,n=e.isVideoTrack();n&&(t=this._options.convertVideoToDesktop?d.a.DESKTOP:d.a.CAMERA);var i=e.getOriginalStream(),o=h.a.createLocalTracks([{deviceId:"proxy:".concat(this._peerConnection.getPeerJid()),mediaType:n?u.c:u.a,sourceType:"proxy",stream:i,track:i.getVideoTracks()[0],videoType:t}]);this._options.onRemoteStream(o[0])}},{key:"_onSendMessage",value:function(e,t){if(this._options.onSendMessage)try{var n=(new XMLSerializer).serializeToString(t.nodeTree||t);this._options.onSendMessage(e,{iq:n})}catch(i){m.error("Attempted to send an incorrectly formatted iq.")}}},{key:"_selfCloseConnection",value:function(){this.stop(),this._options.onConnectionClosed&&this._options.onConnectionClosed()}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return v}));var i=n(7),o=n(6),r=n(8),a=n(18),s=n(31),c=n.n(s),u=n(9),l=n.n(u),d=n(43),h=n(186),p=n(76),f=n(109),m=Object(a.getLogger)(e),v=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(o.a)(this,e),this._options=Object(i.a)({iceConfig:{},isInitiator:!1,receiveAudio:!1,receiveVideo:!1},t),this._tracks=[],this._peerConnection=null,this._onError=this._onError.bind(this),this._onRemoteStream=this._onRemoteStream.bind(this),this._onSendMessage=this._onSendMessage.bind(this)}return Object(r.a)(e,[{key:"getPeerJid",value:function(){return this._options.peerJid}},{key:"processMessage",value:function(e){switch(e.attr("action")){case f.a.ACCEPT:this._onSessionAccept(e);break;case f.a.INITIATE:this._onSessionInitiate(e);break;case f.a.TERMINATE:this._onSessionTerminate(e);break;case f.a.TRANSPORT_INFO:this._onTransportInfo(e)}}},{key:"start",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._peerConnection||(this._tracks=this._tracks.concat(e),this._peerConnection=this._createPeerConnection(),this._peerConnection.invite(e))}},{key:"stop",value:function(){this._peerConnection&&this._peerConnection.terminate(),this._onSessionTerminate()}},{key:"_createPeerConnection",value:function(){var e=this,t={connected:!0,jingle:{terminate:function(){}},sendIQ:this._onSendMessage,addEventListener:function(){return function(){}}},n=Object(i.a)({iceServers:p.a},this._options.iceConfig),o={addPresenceListener:function(){},connectionTimes:[],eventEmitter:{emit:function(t){switch(t){case l.a.CONNECTION_ICE_FAILED:case l.a.CONNECTION_FAILED:e._onError(f.a.CONNECTION_ERROR,t)}}},getMediaPresenceInfo:function(){return{}},removePresenceListener:function(){}};this._rtc=new d.a({},{}),this._rtc.addListener(c.a.REMOTE_TRACK_ADDED,this._onRemoteStream);var r=new h.a(void 0,void 0,this._options.peerJid,t,{offerToReceiveAudio:this._options.receiveAudio,offerToReceiveVideo:this._options.receiveVideo},n,!0,this._options.isInitiator);return r.initialize(o,this._rtc,{}),r}},{key:"_onError",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this._options.onError(this._options.peerJid,e,t)}},{key:"_onRemoteStream",value:function(e){this._tracks.push(e),this._options.onRemoteStream(e)}},{key:"_onSendMessage",value:function(e){this._options.onSendMessage(this._options.peerJid,e)}},{key:"_onSessionAccept",value:function(e){this._peerConnection?this._peerConnection.setAnswer(e):m.error("Received an answer when no peer connection exists.")}},{key:"_onSessionInitiate",value:function(e){var t=this;this._peerConnection?m.error("Received an offer when an offer was already sent."):(this._peerConnection=this._createPeerConnection(),this._peerConnection.acceptOffer(e,(function(){}),(function(){return t._onError(t._options.peerJid,f.a.CONNECTION_ERROR,"session initiate error")})))}},{key:"_onSessionTerminate",value:function(){this._tracks.forEach((function(e){return e.dispose()})),this._tracks=[],this._peerConnection&&this._peerConnection.onTerminated(),this._rtc&&(this._rtc.removeListener(c.a.REMOTE_TRACK_ADDED,this._onRemoteStream),this._rtc.destroy())}},{key:"_onTransportInfo",value:function(e){this._peerConnection.addIceCandidates(e)}}]),e}()}).call(this,"/index.js")},function(e,t,n){"use strict";t.a={error:{BUSY:"busy",ERROR:"error",RESOURCE_CONSTRAINT:"resource-constraint",SERVICE_UNAVAILABLE:"service-unavailable"},mode:{FILE:"file",STREAM:"stream"},status:{OFF:"off",ON:"on",PENDING:"pending"}}},function(e,t,n){"use strict";var i=n(59),o=n.n(i),r=n(85),a=n(55),s=n.n(a),c=n(20),u=n(96),l=n(166),d=n.n(l),h=n(135),p="preCallTestResults",f=new s.a,m=!1,v=null;function g(){if(!c.a.isReactNative())return new Promise((function(e){d.a.loadScript(h.a,!0,!0,void 0,e)}))}function b(e){return new Promise((function(t,n){var i=e.callStatsID,o=e.callStatsSecret,r=e.statisticsId||e.statisticsDisplayName||u.a.callStatsUserName;v.initialize(i,o,r,(function(e,i){"success"===e?(v.on(p,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];f.emit.apply(f,[p].concat(t))})),m=!0,t()):n({status:e,message:i})}),null,{disablePrecalltest:!0})}))}function y(){return(y=Object(r.a)(o.a.mark((function e(t){var n,i,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!m){e.next=2;break}throw new Error("Precall Test already initialized");case 2:if(n=t.callStatsID,i=t.callStatsSecret,r=t.disableThirdPartyRequests,n&&i&&!r){e.next=5;break}throw new Error("Callstats is disabled");case 5:return e.next=7,g();case 7:return v=new window.callstats,e.abrupt("return",b(t));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t.a={init:function(e){return y.apply(this,arguments)},execute:function(){return m?new Promise((function(e,t){f.on(p,(function(n,i){"success"===n?e(i):t({status:n,payload:i})})),v.makePrecallTest()})):Promise.reject("uninitialized")}}},function(e,t){e.exports={getTokenAuthUrl:function(e,t,n){return"string"!==typeof e?null:e.replace("{room}",t).replace("{roleUpgrade}",!0===n)}}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u}));var i=n(14),o=n(6),r=n(8),a=n(18),s=n(222),c=Object(a.getLogger)(e),u=function(){function e(){Object(o.a)(this,e),this._started=!1,this._streamsToMix=[],this._streamMSSArray=[]}return Object(r.a)(e,[{key:"addMediaStream",value:function(e){e.getAudioTracks()||c.warn("Added MediaStream doesn't contain audio tracks."),this._streamsToMix.push(e)}},{key:"start",value:function(){if(this._started)return this._mixedMSD.stream;if(this._audioContext=Object(s.a)(),!this._streamsToMix.length)return c.warn("No MediaStream's added to AudioMixer, nothing will happen."),null;this._started=!0,this._mixedMSD=this._audioContext.createMediaStreamDestination();var e,t=Object(i.a)(this._streamsToMix);try{for(t.s();!(e=t.n()).done;){var n=e.value,o=this._audioContext.createMediaStreamSource(n);o.connect(this._mixedMSD),this._streamMSSArray.push(o)}}catch(r){t.e(r)}finally{t.f()}return this._mixedMSD.stream}},{key:"reset",value:function(){this._started=!1,this._streamsToMix=[];var e,t=Object(i.a)(this._streamMSSArray);try{for(t.s();!(e=t.n()).done;){e.value.disconnect()}}catch(n){t.e(n)}finally{t.f()}this._streamMSSArray=[],this._audioContext&&(this._audioContext=void 0)}}]),e}()}).call(this,"/index.js")},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"b",(function(){return ee})),n.d(t,"a",(function(){return ne}));var i,o,r=n(14),a=n(69),s=n(21),c=n(6),u=n(8),l=n(25),h=n(35),p=n(34),f=n(11),m=(n(81),n(107)),v=n(4),g=n(95),b=n(106),y=n(12),A=n(144),E=n(15),O=n(55),S=n(61),C=n.n(S),_=n(3),j=n(7),T=n(89),k=n(46),I=n(22),R=n(122),w=n(54),D=n(60),N=n(87),P=n(57),M=n(42),L=n(44),x=n.n(L),F=n(29),B=n(138),U="p_info",V="p_pose",J="p_onStage",G="p_trackSt",H="main_screen_carrier",z="my_content",Q=512,K=function(){},Y=function(){function e(t){Object(c.a)(this,e),this.conference=void 0,this.disposers=[],this.fragmentedMessages=[],this.fragmentedMessageHead={type:"",length:0},this.conference=t}return Object(u.a)(e,[{key:"sendAllAboutMe",value:function(e){var t;K("sendAllAboutMe called."),this.sendPoseMessageNow(e),this.sendMouseMessageNow(),y.a.local.sendInformation(),this.sendOnStage(),this.sendTrackStates(),(null===(t=E.c.tracks.localMainConnection)||void 0===t?void 0:t.localId)&&this.sendMainScreenCarrier(!0),this.sendMyContents(),this.sendAfkChanged()}},{key:"sendPoseMessageNow",value:function(e){var t=Object(v.D)(y.a.local.pose);config.bmRelayServer?this.conference.pushOrUpdateMessageViaRelay(F.b.PARTICIPANT_POSE,t,void 0,e):this.conference.sendMessageViaJitsi(F.b.PARTICIPANT_POSE,t)}},{key:"sendMouseMessageNow",value:function(){var e=Object(v.z)(y.a.local.mouse);this.conference.sendMessage(F.b.PARTICIPANT_MOUSE,e)}},{key:"sendParticipantInfo",value:function(){var e;if(y.a.local.informationToSend){config.bmRelayServer?this.conference.sendMessage(U,Object(j.a)({},y.a.local.informationToSend)):this.conference.setLocalParticipantProperty(U,Object(j.a)({},y.a.local.informationToSend));for(var t=y.a.local.information.name;"_"===t.slice(0,1);)t=t.slice(1);null===(e=this.conference._jitsiConference)||void 0===e||e.setDisplayName(t)}}},{key:"sendOnStage",value:function(){config.bmRelayServer?this.conference.sendMessage(J,y.a.local.physics.onStage):this.conference.channelOpened&&this.conference.setLocalParticipantProperty(J,y.a.local.physics.onStage)}},{key:"sendTrackStates",value:function(){config.bmRelayServer?this.conference.sendMessage(G,Object(j.a)({},y.a.local.trackStates)):this.conference.setLocalParticipantProperty(G,Object(j.a)({},y.a.local.trackStates))}},{key:"sendAfkChanged",value:function(){this.conference.sendMessage(F.b.PARTICIPANT_AFK,y.a.local.awayFromKeyboard)}},{key:"sendTrackLimits",value:function(e,t){this.conference.sendMessage(F.b.PARTICIPANT_TRACKLIMITS,t||[y.a.local.remoteVideoLimit,y.a.local.remoteAudioLimit],e||void 0)}},{key:"sendContentUpdateRequest",value:function(e,t){!this.conference.bmRelaySocket&&t.map((function(e){return e.url?e.url.length:0})).reduce((function(e,t){return e+t}))>Q?this.sendFragmentedMessage(F.b.CONTENT_UPDATE_REQUEST,t,e):this.conference.sendMessage(F.b.CONTENT_UPDATE_REQUEST,t,e)}},{key:"sendContentRemoveRequest",value:function(e,t){this.conference.sendMessage(F.b.CONTENT_REMOVE_REQUEST,t,e)}},{key:"sendLeftContentRemoveRequest",value:function(e){Object(v.b)(!config.bmRelayServer),this.conference.sendMessage(F.b.LEFT_CONTENT_REMOVE_REQUEST,e)}},{key:"sendMainScreenCarrier",value:function(e){var t,n=null===(t=E.c.tracks.localMainConnection)||void 0===t?void 0:t.getParticipantId();n&&(config.bmRelayServer?this.conference.sendMessage(H,{carrierId:n,enabled:e}):this.conference.setLocalParticipantProperty(H,{carrierId:n,enabled:e}))}},{key:"sendMyContents",value:function(){if(config.bmRelayServer)this.sendContentUpdateRequest("",Array.from(E.c.roomContents.values()));else{var e=Array.from(E.c.localParticipant.myContents.values()),t=Object(M.j)(e);K("send all contents ".concat(JSON.stringify(t.map((function(e){return e.id}))),"."),t),this.conference.setLocalParticipantProperty(z,t)}}},{key:"onRoomProp",value:function(e,t){A.a.onUpdateProp(e,t)}},{key:"onParticipantTrackLimits",value:function(e){y.a.local.remoteVideoLimit=e[0],y.a.local.remoteAudioLimit=e[1]}},{key:"onParticipantLeft",value:function(e){var t;E.c.onParticipantLeft(e),N.b.participantLeft(e),y.a.leave(e),(null===(t=this.conference.bmRelaySocket)||void 0===t?void 0:t.readyState)===WebSocket.OPEN&&this.conference.sendMessage(F.b.PARTICIPANT_LEFT,[e])}},{key:"onChatMessage",value:function(e,t){Object(v.b)(e);var n=y.a.find(e);n&&N.b.addMessage(new N.a(t.msg,n.id,n.information.name,n.information.avatarSrc,n.getColor(),t.ts,t.to?"private":"text"))}},{key:"onCallRemote",value:function(e){Object(v.b)(e);var t=y.a.find(e);t&&(N.b.calledBy(t),y.a.local.information.notifyCall&&Object(B.b)(Object(I.c)("noCalled",{name:null===t||void 0===t?void 0:t.information.name}),{icon:"./favicon.ico"}))}},{key:"onAfkChanged",value:function(e,t){Object(v.b)(e);var n=y.a.find(e);n&&(n.awayFromKeyboard=t)}},{key:"onKicked",value:function(e,t){var n,i=this;Object(v.b)(e),P.a.setType("kicked",null===(n=y.a.remote.get(e))||void 0===n?void 0:n.information.name,t);var o=window.localStorage.getItem("kickTimes"),r=void 0,a=[];this.conference.name&&(o&&(r=(a=JSON.parse(o)).find((function(e){return e.room===i.conference.name}))),r||(r={room:this.conference.name,time:0},a.push(r)),r.time=Date.now(),window.localStorage.setItem("kickTimes",JSON.stringify(a))),setTimeout((function(){window.location.reload()}),1e4)}},{key:"onParticipantOut",value:function(e){e.forEach((function(e){var t=y.a.find(e);t&&(t.physics.located=!1)}))}},{key:"onMouseOut",value:function(e){e.forEach((function(e){var t=y.a.find(e);t&&(t.mouse.position=[k.a,k.a])}))}},{key:"onContentOut",value:function(e){e.forEach((function(e){var t=E.c.find(e);if(t){var n=Object.assign({},t);n.pose={position:[k.a,k.a],orientation:t.pose.orientation},E.c.updateByRemoteRequest([n])}}))}},{key:"onParticipantInfo",value:function(e,t){if(Object(v.b)(e),null===D.a.testBot){var n=y.a.remote.get(e);if(n){var i=n.information.name;Object.assign(n.information,t),i!==n.information.name&&(i===w.d.name?N.b.participantJoined(e):N.b.participantNameChanged(e,i)),n.informationReceived=!0,K("Info of ".concat(e," received."))}}}},{key:"onParticipantTrackState",value:function(e,t){if(Object(v.b)(e),null===D.a.testBot){var n=y.a.remote.get(e);n&&Object.assign(n.trackStates,t)}}},{key:"onParticipantPose",value:function(e,t){Object(v.b)(e);var n=Object(v.N)(t),i=y.a.remote.get(e),o=y.a.local;if(i&&(i.pose.orientation=n.orientation,i.pose.position=n.position,i.physics.located=!0,o.information.notifyNear||o.information.notifyTouch)){var r=Object(v.C)(Object(v.O)(i.pose.position,o.pose.position)),a=3*w.a,s=w.a;i.lastDistance>s&&r<=s&&o.information.notifyTouch?Object(B.b)(Object(I.c)("noTouched",{name:i.information.name}),{icon:"./favicon.ico"}):i.lastDistance>a&&r<a&&o.information.notifyNear&&Object(B.b)(Object(I.c)("noNear",{name:i.information.name}),{icon:"./favicon.ico"}),i.lastDistance=r}}},{key:"onParticipantMouse",value:function(e,t){Object(v.b)(e);var n=Object(v.M)(t);if(null===D.a.testBot){var i=y.a.remote.get(e);i&&Object.assign(i.mouse,n)}}},{key:"onParticipantOnStage",value:function(e,t){Object(v.b)(e);var n=y.a.remote.get(e);n&&(n.physics.onStage=t)}},{key:"onYarnPhone",value:function(e,t){if(Object(v.b)(e),t.find((function(e){return e===y.a.localId}))){if(!y.a.yarnPhones.has(e)&&(y.a.yarnPhones.add(e),y.a.local.information.notifyYarn)){var n=y.a.find(e);n&&Object(B.b)(Object(I.c)("noYarn",{name:n.information.name}),{icon:"./favicon.ico"})}}else y.a.yarnPhones.delete(e)}},{key:"onMuteVideo",value:function(e){var t={};y.a.local.loadMediaSettingsFromStorage(t),y.a.local.muteVideo=e||t.stream.muteVideo}},{key:"onMuteAudio",value:function(e){var t={};y.a.local.loadMediaSettingsFromStorage(t),y.a.local.muteAudio=e||t.stream.muteAudio}},{key:"onReloadBrower",value:function(){window.location.reload()}},{key:"onMainScreenCarrier",value:function(e,t){Object(v.b)(e),y.a.remote.get(e)&&E.c.tracks.onMainScreenCarrier(t.carrierId,t.enabled)}},{key:"onMyContent",value:function(e,t){Object(v.b)(e);var n=Object(M.r)(t);E.c.checkDuplicatedWallpaper(e,n),E.c.replaceRemoteContents(n,e);y.a.remote.get(e);K("recv remote contents ".concat(JSON.stringify(n.map((function(e){return e.id})))," from ").concat(e,"."),n)}},{key:"onContentInfoUpdate",value:function(e){Object(v.b)(config.bmRelayServer),e.forEach((function(e){return E.c.roomContentsInfo.set(e.id,e)}))}},{key:"onContentUpdateRequest",value:function(e){var t=Object(M.r)(e);E.c.updateByRemoteRequest(t)}},{key:"onContentRemoveRequest",value:function(e){E.c.removeByRemoteRequest(e)}},{key:"onLeftContentRemoveRequest",value:function(e){console.log("onLeftContentRemoveRequest for ".concat(e,".")),E.c.removeLeftContentByRemoteRequest(e)}},{key:"bind",value:function(){var e,t=this;this.conference.on(F.b.PARTICIPANT_TRACKLIMITS,this.onParticipantTrackLimits),this.conference.on(ee.USER_LEFT,this.onParticipantLeft.bind(this)),this.conference.on(ee.USER_JOINED,(function(e){var n,i=null===(n=t.conference._jitsiConference)||void 0===n?void 0:n.getParticipantById(e).getDisplayName();i===T.b||i===T.c||y.a.join(e)})),this.conference.on(ee.REMOTE_TRACK_ADDED,(function(e){R.a.onRemoteTrackAdded(e),y.a.addRemoteTrack(e)||E.c.tracks.addRemoteTrack(e)})),this.conference.on(ee.REMOTE_TRACK_REMOVED,(function(e){y.a.removeRemoteTrack(e)||E.c.tracks.removeRemoteTrack(e)})),this.conference.on(F.b.CHAT_MESSAGE,this.onChatMessage),this.conference.on(F.b.CALL_REMOTE,this.onCallRemote),this.conference.on(F.b.KICK,(function(e,n){var i;null===(i=t.conference._jitsiConference)||void 0===i||i.room.leave(),t.onKicked(e,n)})),this.conference.on(F.b.PARTICIPANT_AFK,this.onAfkChanged),this.conference.on(U,this.onParticipantInfo),this.conference.on(G,this.onParticipantTrackState),this.conference.on(F.b.PARTICIPANT_POSE,this.onParticipantPose),this.conference.on(V,this.onParticipantPose),this.conference.on(F.b.PARTICIPANT_MOUSE,this.onParticipantMouse),this.conference.on(J,this.onParticipantOnStage),this.conference.on(F.b.YARN_PHONE,this.onYarnPhone),this.conference.on(F.b.MUTE_VIDEO,this.onMuteVideo),this.conference.on(F.b.MUTE_AUDIO,this.onMuteAudio),this.conference.on(F.b.RELOAD_BROWSER,this.onReloadBrower),this.conference.on(H,this.onMainScreenCarrier),this.conference.on(z,this.onMyContent),this.conference.on(F.b.CONTENT_UPDATE_REQUEST,this.onContentUpdateRequest),this.conference.on(F.b.CONTENT_REMOVE_REQUEST,this.onContentRemoveRequest),this.conference.on(F.b.LEFT_CONTENT_REMOVE_REQUEST,this.onLeftContentRemoveRequest),null===(e=this.conference._jitsiConference)||void 0===e||e.addEventListener(C.a.events.conference.DATA_CHANNEL_OPENED,(function(){t.conference.channelOpened=!0})),this.conference.on(F.b.FRAGMENT_HEAD,(function(e,n){t.fragmentedMessageHead=n,t.fragmentedMessages=[]})),this.conference.on(F.b.FRAGMENT_CONTENT,(function(e,n){if(t.fragmentedMessages[n.c]=n,t.fragmentedMessageHead.length&&t.fragmentedMessages.length===t.fragmentedMessageHead.length&&-1===t.fragmentedMessages.findIndex((function(e){return void 0===e}))){var i="";t.fragmentedMessages.forEach((function(e){return i+=e.s}));var o=JSON.parse(i);t.conference.emit(t.fragmentedMessageHead.type,e,o),t.fragmentedMessageHead={type:"",length:0},t.fragmentedMessages=[]}}))}},{key:"observeStart",value:function(){var e=this;if(this.disposers.push(Object(_.c)((function(){y.a.remote.forEach((function(t){t.called&&(t.called=!1,e.conference.sendMessage(F.b.CALL_REMOTE,{},t.id),N.b.callTo(t))}))}))),this.disposers.push(Object(_.c)(this.sendAfkChanged.bind(this))),this.disposers.push(Object(_.c)(this.sendParticipantInfo.bind(this))),this.disposers.push(Object(_.c)(this.sendTrackStates.bind(this))),config.bmRelayServer)this.disposers.push(Object(_.c)((function(){e.sendPoseMessageNow(!1),e.sendMouseMessageNow()})));else{var t=function(){return Math.ceil(Math.max(y.a.remote.size/4*50,50))},n=function(){},i=0,o="";this.disposers.push(Object(_.c)((function(){var r=t();r!==i&&(i=r,n=x.a.throttle((function(t){e.conference.channelOpened&&e.conference.sendMessage(F.b.PARTICIPANT_POSE,t)}),i));var a=Object(v.D)(y.a.local.pose);e.conference.channelOpened&&o!==a&&(n(a),o=a)})));var r=0,a="",s=function(){var n=Date.now(),i=30*t();if(n-r>i){var o=Object(v.D)(y.a.local.pose);a!==o&&(e.conference.setLocalParticipantProperty(V,o),r=n,a=o)}};s(),setInterval(s,2500);var c=0,u=function(e){};this.disposers.push(Object(_.c)((function(){!function(n){var i=t();c!==i&&(c=i,u=x.a.throttle((function(t){e.conference.sendMessage(F.b.PARTICIPANT_MOUSE,Object(v.z)(t))}),c)),e.conference.channelOpened&&u(Object(j.a)({},y.a.local.mouse))}()})))}this.disposers.push(Object(_.c)((function(){e.sendOnStage()})));this.disposers.push(Object(_.c)((function(){e.conference.channelOpened&&y.a.yarnPhoneUpdated&&(y.a.yarnPhoneUpdated=!1,e.conference.sendMessage(F.b.YARN_PHONE,Array.from(y.a.yarnPhones)))})))}},{key:"observeEnd",value:function(){this.disposers.forEach((function(e){return e()}))}},{key:"sendFragmentedMessage",value:function(e,t,n){var i=JSON.stringify(t),o={type:e,length:Math.ceil(i.length/Q)};this.conference.sendMessage(F.b.FRAGMENT_HEAD,o,n);for(var r=0,a=0;a<i.length;a+=Q)this.conference.sendMessage(F.b.FRAGMENT_CONTENT,{c:r,s:i.slice(a,a+Q)},n),r+=1}},{key:"onBmMessage",value:function(e){K("Receive ".concat(e.length," relayed messages."));var t,n=Object(r.a)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;switch(m.b.recordMessage(i),i.t){case F.b.ROOM_PROP:this.onRoomProp.apply(this,Object(a.a)(JSON.parse(i.v)));break;case F.b.REQUEST_TO:this.sendAllAboutMe(!1);break;case F.b.PARTICIPANT_AFK:this.onAfkChanged(i.p,JSON.parse(i.v));break;case F.b.CALL_REMOTE:this.onCallRemote(i.p);break;case F.b.CHAT_MESSAGE:this.onChatMessage(i.p,JSON.parse(i.v));break;case F.b.CONTENT_REMOVE_REQUEST:this.onContentRemoveRequest(JSON.parse(i.v));break;case F.b.LEFT_CONTENT_REMOVE_REQUEST:this.onLeftContentRemoveRequest(JSON.parse(i.v));break;case F.b.CONTENT_UPDATE_REQUEST:this.onContentUpdateRequest(JSON.parse(i.v));break;case F.b.CONTENT_INFO_UPDATE:this.onContentInfoUpdate(JSON.parse(i.v));break;case F.b.PARTICIPANT_MOUSE:this.onParticipantMouse(i.p,JSON.parse(i.v));break;case F.b.PARTICIPANT_POSE:this.onParticipantPose(i.p,JSON.parse(i.v));break;case F.b.PARTICIPANT_TRACKLIMITS:this.onParticipantTrackLimits(JSON.parse(i.v));break;case F.b.YARN_PHONE:this.onYarnPhone(i.p,JSON.parse(i.v));break;case F.b.RELOAD_BROWSER:this.onReloadBrower();break;case F.b.MUTE_VIDEO:this.onMuteVideo(JSON.parse(i.v));break;case F.b.MUTE_AUDIO:this.onMuteAudio(JSON.parse(i.v));break;case F.b.KICK:this.onKicked(i.p,JSON.parse(i.v));break;case F.b.PARTICIPANT_OUT:this.onParticipantOut(JSON.parse(i.v));break;case F.b.MOUSE_OUT:this.onMouseOut(JSON.parse(i.v));break;case F.b.CONTENT_OUT:this.onContentOut(JSON.parse(i.v));break;case H:this.onMainScreenCarrier(i.p,JSON.parse(i.v));break;case z:this.onMyContent(i.p,JSON.parse(i.v));break;case U:this.onParticipantInfo(i.p,JSON.parse(i.v));break;case J:this.onParticipantOnStage(i.p,JSON.parse(i.v));break;case V:this.onParticipantPose(i.p,JSON.parse(i.v));break;case G:this.onParticipantTrackState(i.p,JSON.parse(i.v));break;default:console.log("Unhandled message type ".concat(i.t," from ").concat(i.p))}}}catch(o){n.e(o)}finally{n.f()}this.checkInfo()}},{key:"checkInfo",value:function(){var e=Array.from(y.a.remote.values()).filter((function(e){return!e.informationReceived})).map((function(e){return e.id}));e.length&&(K("checkInfo sent ".concat(e)),this.conference.pushOrUpdateMessageViaRelay(F.b.REQUEST_TO,e))}}]),e}(),W=function(e){},q=function(e){},X=function(e){},Z=function(e){},$=C.a.events.conference,ee={USER_JOINED:"joined",USER_LEFT:"left",REMOTE_TRACK_ADDED:"remote_track_added",REMOTE_TRACK_REMOVED:"remote_track_removed"},te=new Set(F.d);te.add(F.a.CONTENT_UPDATE_REQUEST_BY_ID),te.add(F.a.REQUEST_PARTICIPANT_STATES);var ne=(i=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){var e;return Object(c.a)(this,n),(e=t.call(this))._jitsiConference=void 0,e.name="",e.localId="",e.sync=new Y(Object(l.a)(e)),Object(s.a)(e,"channelOpened",o,Object(l.a)(e)),e.bmRelaySocket=void 0,e.lastRequestTime=Date.now(),e.lastReceivedTime=Date.now(),e.messagesToSendToRelay=[],e.relayRttLast=50,e.relayRttAverage=50,e.stopStep=!1,e.localMicTrack=void 0,e.localCameraTrack=void 0,e.receivedMessages=[],Object(_.g)(Object(l.a)(e)),e}return Object(u.a)(n,[{key:"setRoomProp",value:function(e,t){this.pushOrUpdateMessageViaRelay(F.b.ROOM_PROP,[e,t]),A.a.onUpdateProp(e,t)}},{key:"init",value:function(e,t){var n,i;if(e){var o=window.localStorage.getItem("kickTimes");if(o){var r=JSON.parse(o).find((function(t){return t.room===e}));if(r){if(Date.now()-r.time<9e5)return void window.location.reload()}}}this.name=e,this._jitsiConference=t(),this.registerJistiConferenceEvents(),this.sync.bind(),null===(n=this._jitsiConference)||void 0===n||n.join(""),null===(i=this._jitsiConference)||void 0===i||i.setSenderVideoConstraint(1080),this.step(),d.conference=this,d.jc=this._jitsiConference,d.chatRoom=this._jitsiConference.room,d.showState=function(){console.log("carrierMap: ".concat(JSON.stringify(E.c.tracks.carrierMap))),console.log("contentCarriers: ".concat(JSON.stringify(E.c.tracks.contentCarriers))),console.log("remoteMains: ".concat(JSON.stringify(E.c.tracks.remoteMains.keys())))}}},{key:"uninit",value:function(){var e,t,n=this;(config.bmRelayServer&&y.a.localId&&(this.pushOrUpdateMessageViaRelay(F.b.PARTICIPANT_LEFT,[y.a.localId]),this.sendMessageViaRelay()),y.a.local.tracks.audio)&&(null===(e=this.removeTrack(y.a.local.tracks.audio))||void 0===e||e.then((function(){var e;null===(e=y.a.local.tracks.audio)||void 0===e||e.dispose()})));y.a.local.tracks.avatar&&(null===(t=this.removeTrack(y.a.local.tracks.avatar))||void 0===t||t.then((function(){var e;null===(e=y.a.local.tracks.avatar)||void 0===e||e.dispose()})));return this.sync.observeEnd(),this.stopStep=!0,new Promise((function(e,t){var i;null===(i=n._jitsiConference)||void 0===i||i.leave().then((function(t){var n,i=null!==(n=localStorage.getItem("log"))&&void 0!==n?n:"";i+="leave (".concat(t,"). "),localStorage.setItem("log",i),e(t)})).catch((function(e){t(e)})).finally((function(){n._jitsiConference=void 0}))}))}},{key:"step",value:function(){var e,t=this;if((null===(e=this.bmRelaySocket)||void 0===e?void 0:e.readyState)===WebSocket.OPEN){for(var n=Date.now()+40;Date.now()<n&&this.receivedMessages.length;){var i=this.receivedMessages.shift();i&&this.sync.onBmMessage([i])}var o=Math.min(Math.max((this.relayRttAverage-20)*y.a.remote.size/40,0)+20,3e3),r=o+2e4,a=Date.now();a<n&&this.bmRelaySocket&&!this.receivedMessages.length&&a-this.lastRequestTime>o&&(this.lastReceivedTime>=this.lastRequestTime||a-this.lastRequestTime>r)&&(this.lastRequestTime=a,this.pushOrUpdateMessageViaRelay(F.b.REQUEST_RANGE,[g.b.visibleArea(),y.a.audibleArea()]),this.sendMessageViaRelay())}this.stopStep?this.stopStep=!1:setTimeout((function(){t.step()}),50)}},{key:"doSetLocalMicTrack",value:function(e){var t;this.localMicTrack=e,this.localMicTrack.videoType="mic",null===(t=this._jitsiConference)||void 0===t||t.addTrack(this.localMicTrack)}},{key:"setLocalMicTrack",value:function(e){var t=this;return new Promise((function(n,i){var o;if(e)if(t.localMicTrack){var r,a=t.localMicTrack;null===(r=t._jitsiConference)||void 0===r||r.removeTrack(t.localMicTrack).then((function(){t.doSetLocalMicTrack(e),n(a)}))}else t.doSetLocalMicTrack(e),n(void 0);else t.localMicTrack?null===(o=t._jitsiConference)||void 0===o||o.removeTrack(t.localMicTrack).then((function(){var e=t.localMicTrack;t.localMicTrack=void 0,n(e)})):n(void 0)}))}},{key:"doSetLocalCameraTrack",value:function(e){var t;this.localCameraTrack=e,this.localCameraTrack.videoType="camera",null===(t=this._jitsiConference)||void 0===t||t.addTrack(this.localCameraTrack)}},{key:"setLocalCameraTrack",value:function(e){var t=this;return new Promise((function(n,i){var o;if(e)if(t.localCameraTrack){var r,a=t.localCameraTrack;null===(r=t._jitsiConference)||void 0===r||r.removeTrack(t.localCameraTrack).then((function(){t.doSetLocalCameraTrack(e),n(a)}))}else t.doSetLocalCameraTrack(e),n(void 0);else t.localCameraTrack?null===(o=t._jitsiConference)||void 0===o||o.removeTrack(t.localCameraTrack).then((function(){var e=t.localCameraTrack;t.localCameraTrack=void 0,n(e)})):n(void 0)}))}},{key:"getLocalMicTrack",value:function(){return this.localMicTrack}},{key:"getLocalCameraTrack",value:function(){return this.localCameraTrack}},{key:"sendCommand",value:function(e,t){var n;Z("SEND sendCommand ".concat(e," ").concat(JSON.stringify(t))),null===(n=this._jitsiConference)||void 0===n||n.sendCommand(e,t)}},{key:"removeCommand",value:function(e){var t;null===(t=this._jitsiConference)||void 0===t||t.removeCommand(e)}},{key:"addCommandListener",value:function(e,t){var n;null===(n=this._jitsiConference)||void 0===n||n.addCommandListener(e,t)}},{key:"setLocalParticipantProperty",value:function(e,t){var n;Z("SEND setLocalParticipantProperty ".concat(e," ").concat(JSON.stringify(t))),null===(n=this._jitsiConference)||void 0===n||n.setLocalParticipantProperty(e,JSON.stringify(t))}},{key:"getLocalParticipantProperty",value:function(e){var t;return null===(t=this._jitsiConference)||void 0===t?void 0:t.getLocalParticipantProperty(e)}},{key:"kickParticipant",value:function(e){var t;null===(t=this._jitsiConference)||void 0===t||t.kickParticipant(e)}},{key:"setSenderVideoConstraint",value:function(e){var t;null===(t=this._jitsiConference)||void 0===t||t.setSenderVideoConstraint(e)}},{key:"setReceiverConstraints",value:function(e){var t;null===(t=this._jitsiConference)||void 0===t||t.setReceiverConstraints(e)}},{key:"setPerceptibles",value:function(e){var t;Z("SEND setPerceptibles ".concat(e[0].length," ").concat(e[1].length)),(null===(t=this._jitsiConference)||void 0===t?void 0:t.setPerceptibles)&&this._jitsiConference.setPerceptibles(e)}},{key:"reduceBitrate",value:function(){if(config.rtc&&this._jitsiConference&&this._jitsiConference.jvbJingleSession){var e=this._jitsiConference.jvbJingleSession;if(!e.bitRateAlreadyReduced&&e.peerconnection.peerconnection)e.bitRateAlreadyReduced=!0,e.peerconnection.peerconnection.getSenders().forEach((function(e){if(e&&e.track){var t=e.getParameters();0===t.encodings.length&&t.encodings.push({}),t.encodings.forEach((function(t){"video"===e.track.kind&&config.rtc.maxBitrateForVideo?t.maxBitrate=1024*config.rtc.maxBitrateForVideo:"audio"===e.track.kind&&(t.maxBitrate=1024*config.rtc.maxBitrateForAudio)})),e.setParameters(t)}}))}}},{key:"sendMessage",value:function(e,t,n){config.bmRelayServer?this.pushOrUpdateMessageViaRelay(e,t,n):this.sendMessageViaJitsi(e,t,n)}},{key:"sendMessageViaJitsi",value:function(e,t,n){var i,o,r,a=this._jitsiConference,s=!!(null===a||void 0===a||null===(i=a.rtc)||void 0===i||null===(o=i._channel)||void 0===o?void 0:o.isOpen()),c=null===a||void 0===a||null===(r=a.chatRoom)||void 0===r?void 0:r.connection.connected;if(Z("SEND sendMessage type:".concat(e," to:").concat(n," val:").concat(JSON.stringify(t))),s||c){var u,l=s?{type:e,value:t}:JSON.stringify({type:e,value:t});null===(u=this._jitsiConference)||void 0===u||u.sendMessage(l,n||"",s)}else y.a.remote.size&&console.log("Conference.sendMessageViaJitsi() failed: Not connected.")}},{key:"connectToRelayServer",value:function(){var e=this;if(!this.bmRelaySocket){var t=function(){e.messagesToSendToRelay=[],e.sync.sendAllAboutMe(!0),e.pushOrUpdateMessageViaRelay(F.b.REQUEST_ALL,{}),e.sendMessageViaRelay()},n=function(t){if("string"===typeof t.data){e.lastReceivedTime=Date.now(),e.relayRttLast=e.lastReceivedTime-e.lastRequestTime;var n,i=JSON.parse(t.data);if(i.length)(n=e.receivedMessages).push.apply(n,Object(a.a)(i));i.length&&(e.relayRttAverage=.3*e.relayRttLast+.7*e.relayRttAverage)}},i=function(){setTimeout((function(){e.bmRelaySocket=new WebSocket(config.bmRelayServer),r()}),5e3)},o=function(){var t;console.error("Error in WebSocket for ".concat(config.bmRelayServer)),null===(t=e.bmRelaySocket)||void 0===t||t.close(3e3,"onError"),i()},r=function(){var r,a,s,c;null===(r=e.bmRelaySocket)||void 0===r||r.addEventListener("error",o),null===(a=e.bmRelaySocket)||void 0===a||a.addEventListener("message",n),null===(s=e.bmRelaySocket)||void 0===s||s.addEventListener("open",t),null===(c=e.bmRelaySocket)||void 0===c||c.addEventListener("close",i)};this.bmRelaySocket=new WebSocket(config.bmRelayServer),r()}}},{key:"pushOrUpdateMessageViaRelay",value:function(e,t,n,i){if(Object(v.b)(config.bmRelayServer),this.bmRelaySocket&&this.bmRelaySocket.readyState===WebSocket.OPEN)if(this.name&&y.a.localId){var o={t:e,v:""};i&&(o.r=this.name,o.p=y.a.localId),n&&(o.d=n);var a=this.messagesToSendToRelay.findIndex((function(e){return e.t===o.t&&e.r===o.r&&e.p===o.p&&e.d===o.d}));if(a>=0)if(te.has(o.t)){var s,c=JSON.parse(this.messagesToSendToRelay[a].v),u=Object(r.a)(t);try{var l=function(){var e=s.value;c.findIndex((function(t){return t===e}))<0&&c.push(e)};for(u.s();!(s=u.n()).done;)l()}catch(g){u.e(g)}finally{u.f()}this.messagesToSendToRelay[a].v=JSON.stringify(c)}else if(F.c.has(o.t)){var d,h=JSON.parse(this.messagesToSendToRelay[a].v),p=Object(r.a)(t);try{var f=function(){var e=d.value,t=h.findIndex((function(t){return t.id===e.id}));t>=0?h[t]=e:h.push(e)};for(p.s();!(d=p.n()).done;)f()}catch(g){p.e(g)}finally{p.f()}this.messagesToSendToRelay[a].v=JSON.stringify(h)}else o.v=JSON.stringify(t),this.messagesToSendToRelay[a]=o;else o.v=JSON.stringify(t),this.messagesToSendToRelay.push(o);m.b.recording&&(o.p=y.a.localId,m.b.recordMessage(o))}else console.warn("Relay Socket: Not connected. room:".concat(this.name," id:").concat(y.a.localId,"."))}},{key:"sendMessageViaRelay",value:function(){var e,t,n=this;0!==this.messagesToSendToRelay.length&&((null===(e=this.bmRelaySocket)||void 0===e?void 0:e.readyState)===WebSocket.OPEN?(this.bmRelaySocket.send(JSON.stringify(this.messagesToSendToRelay)),this.messagesToSendToRelay=[]):null===(t=this.bmRelaySocket)||void 0===t||t.addEventListener("open",(function(){!function e(){var t,i;(null===(t=n.bmRelaySocket)||void 0===t?void 0:t.readyState)!==WebSocket.OPEN?setTimeout(e,100):(null===(i=n.bmRelaySocket)||void 0===i||i.send(JSON.stringify(n.messagesToSendToRelay)),n.messagesToSendToRelay=[])}()})))}},{key:"registerJistiConferenceEvents",value:function(){var e=this;this._jitsiConference?(this._jitsiConference.on($.ENDPOINT_MESSAGE_RECEIVED,(function(t,n){X("ENDPOINT_MESSAGE_RECEIVED from ".concat(t.getId()),n),n.values?(e.emit(n.type,t.getId(),n.values),m.b.recordMessage({t:n.type,p:t.getId(),v:JSON.stringify(n.values)})):(e.emit(n.type,t.getId(),n.value),m.b.recordMessage({t:n.type,p:t.getId(),v:JSON.stringify(n.value)}))})),this._jitsiConference.on($.PARTICIPANT_PROPERTY_CHANGED,(function(t,n,i,o){X("PARTICIPANT_PROPERTY_CHANGED from ".concat(t.getId()," prop:").concat(n," old,new:"),i,o),"codecType"!==n&&(e.emit(n,t.getId(),JSON.parse(o),i),m.b.recordMessage({t:n,p:t.getId(),v:o}))})),this._jitsiConference.on($.CONFERENCE_JOINED,(function(){q("Joined to a conference room."),e.onConferenceJoined()})),this._jitsiConference.on($.USER_JOINED,(function(t,n){q("New participant[".concat(t,"] joined.")),e.emit(ee.USER_JOINED,t,n)})),this._jitsiConference.on($.USER_LEFT,(function(t,n){e.emit(ee.USER_LEFT,t,n),q("A participant left.")})),this._jitsiConference.on($.TRACK_ADDED,(function(t){W("TRACK_ADDED: ".concat(t," type:").concat(t.getType()," usage:").concat(t.getUsageLabel()," tid:").concat(t.getId()," msid:").concat(t.getOriginalStream().id)),t.isLocal()?e.onLocalTrackAdded(t):(e.emit(ee.REMOTE_TRACK_ADDED,t),setTimeout((function(){e.reduceBitrate()}),3e3))})),this._jitsiConference.on($.TRACK_REMOVED,(function(t){W("TRACK_REMOVED: ".concat(t," type:").concat(t.getType()," ").concat(t.getUsageLabel()," tid:").concat(t.getId()," msid:").concat(t.getOriginalStream().id)),t.isLocal()?e.onLocalTrackRemoved(t):e.emit(ee.REMOTE_TRACK_REMOVED,t)})),this._jitsiConference.on($.REMOTE_TRACK_VIDEOTYPE_CHANGING,(function(e,t){y.a.removeRemoteTrack(e)})),this._jitsiConference.on($.REMOTE_TRACK_VIDEOTYPE_CHANGED,(function(e,t){y.a.addRemoteTrack(e)})),this._jitsiConference.on($.TRACK_MUTE_CHANGED,(function(e){if(W("TRACK_MUTE_CHANGED on ".concat(e,".")),!e.isLocal()){var t=e,n=y.a.find(t.getParticipantId());n&&t.isVideoTrack()&&(n.muteVideo=t.isMuted())}})),this._jitsiConference.on(C.a.events.conference.TRACK_AUDIO_LEVEL_CHANGED,(function(e,t){var n=b.a.find(e);n&&(n===b.a.local&&n.muteAudio?null===n||void 0===n||n.setAudioLevel(0):null===n||void 0===n||n.setAudioLevel(t))})),this._jitsiConference.on(C.a.events.conference.PRIVATE_MESSAGE_RECEIVED,(function(e,t,n){X("PRIVATE_MESSAGE_RECEIVED",e,t,n)})),this._jitsiConference.on(C.a.events.conference.MESSAGE_RECEIVED,(function(e,t,n){X("MESSAGE_RECEIVED",e,t,n)})),this._jitsiConference.on(C.a.events.conference.KICKED,(function(t,n){e.sync.onKicked(t.getId(),n)}))):console.error("Dose not connected to conference yet.")}},{key:"onConferenceJoined",value:function(){for(var e in this.localId=this._jitsiConference.myUserId(),y.a.setLocalId(this.localId),this.sync.observeStart(),y.a.local.devicePreference)void 0===y.a.local.devicePreference[e]&&(y.a.local.devicePreference[e]="");config.bmRelayServer||setTimeout(E.c.loadWallpaper.bind(E.c),2e3),config.bmRelayServer&&this.connectToRelayServer()}},{key:"onLocalTrackAdded",value:function(e){var t=y.a.local;e.isAudioTrack()?(t.muteAudio?e.mute():e.unmute(),t.tracks.audio=e):(t.tracks.avatar=e,t.muteVideo&&this.removeTrack(e))}},{key:"onLocalTrackRemoved",value:function(e){var t=y.a.local;e.isAudioTrack()?t.tracks.audio=void 0:t.tracks.avatar=void 0}},{key:"getLocalTracks",value:function(e){return this._jitsiConference?this._jitsiConference.getLocalTracks(e):[]}},{key:"getLocalVideoTrack",value:function(){return this._jitsiConference?this._jitsiConference.getLocalVideoTrack():null}},{key:"replaceTrack",value:function(e,t){this._jitsiConference&&this._jitsiConference.replaceTrack(e,t)}},{key:"removeTrack",value:function(e){var t;return null===(t=this._jitsiConference)||void 0===t?void 0:t.removeTrack(e)}},{key:"removeTracks",value:function(e){var t=this;e.forEach((function(e){var n;return null===(n=t._jitsiConference)||void 0===n?void 0:n.removeTrack(e)}))}},{key:"addTrack",value:function(e){var t;null===(t=this._jitsiConference)||void 0===t||t.addTrack(e)}},{key:"addTracks",value:function(e){var t,n=Object(r.a)(e);try{for(n.s();!(t=n.n()).done;){var i,o,a=t.value;if(a!==e[e.length-1])null===(i=this._jitsiConference)||void 0===i||i.addTrack(a);else null===(o=this._jitsiConference)||void 0===o||o.addTrack(a).then((function(){}))}}catch(s){n.e(s)}finally{n.f()}}}]),n}(O.EventEmitter),o=Object(f.a)(i.prototype,"channelOpened",[_.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),i)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t),function(e){var i=n(14),o=n(66),r=n(18),a=n.n(r),s=n(63),c=n(10),u=n(335),l=n(125),d=n(79),h=n(246),p=n(155),f=n(70),m=n(52),v=n(58),g=n(217),b=n(43),y=n(20),A=n(171),E=n(167),O=n(392),S=n(75),C=n(221),_=n(393),j=n(395),T=n(96),k=n(216),I=n(396),R=n(27),w=n(397),D=n.n(w),N=n(41),P=n.n(N),M=n(166),L=n.n(M),x=n(77),F=n(398),B=n(19),U=n(101),V=n(223),J=n(32),G=a.a.getLogger(e);function H(e){var t={audio_requested:e.devices.includes("audio"),video_requested:e.devices.includes("video"),screen_sharing_requested:e.devices.includes("desktop")};return t.video_requested&&(t.resolution=e.resolution),t}t.default=function(e){return"object"===typeof window.JitsiMeetJS?Object.assign({},window.JitsiMeetJS,e):e}({version:"{#COMMIT_HASH#}",JitsiConnection:u.a,ProxyConnectionService:_.a,constants:{participantConnectionStatus:E.a,recording:j.a,sipVideoGW:x,transcriptionStatus:g},events:{conference:c,connection:d,detection:S,track:v,mediaDevices:p,connectionQuality:U,e2eping:V},errors:{conference:s,connection:l,track:m},errorTypes:{JitsiTrackError:f.a},logLevels:a.a.levels,mediaDevices:h.a,analytics:R.a.analytics,init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};T.a.init(e.externalStorage),R.a.init(e),window.connectionTimes||(window.connectionTimes={}),!0!==e.enableAnalyticsLogging&&(G.warn("Analytics disabled, disposing."),this.analytics.dispose()),e.enableWindowOnErrorHandler&&P.a.addHandler(this.getGlobalOnErrorHandler.bind(this));var t=e.deploymentInfo;if(t&&Object.keys(t).length>0){var n={};for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.id="deployment_info",R.a.sendLog(JSON.stringify(n))}if(this.version){var o={id:"component_version",component:"lib-jitsi-meet",version:this.version};R.a.sendLog(JSON.stringify(o))}return b.a.init(e)},isDesktopSharingEnabled:function(){return b.a.isDesktopSharingEnabled()},isWebRtcSupported:function(){return b.a.isWebRtcSupported()},setLogLevel:function(e){a.a.setLogLevel(e)},setLogLevelById:function(e,t){a.a.setLogLevelById(e,t)},addGlobalLogTransport:function(e){a.a.addGlobalTransport(e)},removeGlobalLogTransport:function(e){a.a.removeGlobalTransport(e)},setGlobalLogOptions:function(e){a.a.setGlobalOptions(e)},createLocalTracks:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0,r=!1,a=t.firePermissionPromptIsShownEvent,s=t.fireSlowPromiseEvent,c=Object(o.a)(t,["firePermissionPromptIsShownEvent","fireSlowPromiseEvent"]),u=a||n;return u&&!b.a.arePermissionsGrantedForAvailableDevices()?h.a.emitEvent(p.PERMISSION_PROMPT_IS_SHOWN,y.a.getName()):s&&window.setTimeout((function(){r||h.a.emitEvent(p.SLOW_GET_USER_MEDIA)}),1e3),window.connectionTimes||(window.connectionTimes={}),window.connectionTimes["obtainPermissions.start"]=window.performance.now(),b.a.obtainAudioAndVideoPermissions(c).then((function(t){if(r=!0,window.connectionTimes["obtainPermissions.end"]=window.performance.now(),R.a.sendAnalytics(Object(J.F)("success",H(c))),!b.a.options.disableAudioLevels)for(var n=function(e){var n=t[e],i=n.getOriginalStream();n.getType()===B.a&&(R.a.startLocalStats(i,n.setAudioLevel.bind(n)),n.addEventListener(v.LOCAL_TRACK_STOPPED,(function(){R.a.stopLocalStats(i)})))},o=0;o<t.length;o++)n(o);var a=b.a.getCurrentlyAvailableMediaDevices();if(a)for(var s=0;s<t.length;s++){t[s]._setRealDeviceIdFromDeviceList(a)}var u,l=Object(i.a)(t);try{for(l.s();!(u=l.n()).done;){var d=u.value;d.type===B.c&&"desktop"===d.videoType&&e.setVideoTrackContentHints(d.track,"detail")}}catch(h){l.e(h)}finally{l.f()}return t})).catch((function(e){if(r=!0,e.name===m.SCREENSHARING_USER_CANCELED){var n={id:"screensharing_user_canceled",message:e.message};R.a.sendLog(JSON.stringify(n)),R.a.sendAnalytics(Object(J.F)("warning",{reason:"extension install user canceled"}))}else if(e.name===m.NOT_FOUND){var i={id:"usermedia_missing_device",status:e.gum.devices};R.a.sendLog(JSON.stringify(i));var o=H(t);o.reason="device not found",o.devices=e.gum.devices.join("."),R.a.sendAnalytics(Object(J.F)("error",o))}else{R.a.sendGetUserMediaFailed(e);var a=H(t);a.reason=e.name,R.a.sendAnalytics(Object(J.F)("error",a))}return window.connectionTimes["obtainPermissions.end"]=window.performance.now(),Promise.reject(e)}))},createTrackVADEmitter:function(e,t,n){return C.a.create(e,t,n)},createAudioMixer:function(){return new F.a},getActiveAudioDevice:function(){return Object(O.a)()},isDeviceListAvailable:function(){return G.warn("This method is deprecated, use JitsiMeetJS.mediaDevices.isDeviceListAvailable instead"),this.mediaDevices.isDeviceListAvailable()},isDeviceChangeAvailable:function(e){return G.warn("This method is deprecated, use JitsiMeetJS.mediaDevices.isDeviceChangeAvailable instead"),this.mediaDevices.isDeviceChangeAvailable(e)},isMultipleAudioInputSupported:function(){return this.mediaDevices.isMultipleAudioInputSupported()},isCollectingLocalStats:function(){return R.a.audioLevelsEnabled&&k.a.isLocalStatsSupported()},enumerateDevices:function(e){G.warn("This method is deprecated, use JitsiMeetJS.mediaDevices.enumerateDevices instead"),this.mediaDevices.enumerateDevices(e)},getGlobalOnErrorHandler:function(e,t,n,i,o){G.error("UnhandledError: ".concat(e),"Script: ".concat(t),"Line: ".concat(n),"Column: ".concat(i),"StackTrace: ",o),R.a.reportGlobalError(o)},setNetworkInfo:function(e){var t=e.isOnline;A.b.updateNetworkInfo({isOnline:t})},setVideoTrackContentHints:function(e,t){"contentHint"in e?(e.contentHint=t,e.contentHint!==t&&G.debug("Invalid video track contentHint")):G.debug("MediaStreamTrack contentHint attribute not supported")},precallTest:I.a,util:{AuthUtil:D.a,ScriptUtil:L.a,browser:y.a}})}.call(this,"/index.js")},,,,function(e,t){e.exports={LOCAL_JID:"local"}},,,,,,,,,,,function(e,t){e.exports=function(e,t,n,i){this.blob=e,this.name=t,this.startTime=n,this.wordArray=i}},function(e,t,n){var i=n(509),o=n(305),r=n(510),a=function(){this.url=function(){var e="config does not contain an url to a Sphinx4 https server";if(void 0===config.sphinxURL)console.log(e);else{var t=config.sphinxURL;if(void 0!==t.includes&&t.includes("https://"))return t;console.log(e)}}()};a.prototype=Object.create(r.prototype),a.constructor=a,a.prototype.sendRequest=function(e,t){console.log("sending an audio file  to ".concat(this.url)),console.log("the audio file being sent: ".concat(e));var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE&&200===n.status)t(n.responseText);else if(n.readyState===XMLHttpRequest.DONE)throw new Error("unable to accept response from sphinx server. status: ".concat(n.status))},n.open("POST",this.url),n.setRequestHeader("Content-Type",o.determineCorrectFileType()),n.send(e),console.log("send ".concat(e))},a.prototype.formatResponse=function(e){var t=JSON.parse(e).objects;t.shift();var n=[];return t.forEach((function(e){return e.filler||n.push(new i(e.word,e.start,e.end))})),n},a.prototype.verify=function(e){if(console.log("response from server:".concat(e.toString())),"string"!==typeof e)return!1;var t;try{t=JSON.parse(e)}catch(i){return console.log(i),!1}if(void 0===t.objects)return!1;var n=t.objects;return!(!n[0]||!n[0]["session-id"])},e.exports=a},function(e,t){var n=function(e,t,n){this.word=e,this.begin=t,this.end=n};n.prototype.getWord=function(){return this.word},n.prototype.getBeginTime=function(){return this.begin},n.prototype.getEndTime=function(){return this.end},e.exports=n},function(e,t){var n=function(){throw new Error("TranscriptionService is abstract and cannot becreated")};n.prototype.send=function(e,t){var n=this;this.sendRequest(e.blob,(function(i){n.verify(i)?e.wordArray=n.formatResponse(i):(console.log("the retrieved response from the server is not valid!"),e.wordArray=[]),t(e)}))},n.prototype.sendRequest=function(e,t){throw new Error("TranscriptionService.sendRequest is abstract")},n.prototype.formatResponse=function(e){throw new Error("TranscriptionService.format is abstract")},n.prototype.verify=function(e){throw new Error("TranscriptionService.verify is abstract")},e.exports=n},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t);var i=n(28),o=n(60),r=n(4),a=n(87),s=n(57),c=n(95),u=n(12),l=n(144),h=n(15),p=n(24),f=n(0),m=n.n(f),v=n(191),g=n(7),b=n(6),y=n(724),A=n(702),E=n(727),O=n(699),S=n(706),C=n(22),_=n(1),j=function(){Object(f.useEffect)((function(){c.b.keyInputUsers.add("AfkDialog")}));var e=function(e){c.b.keyInputUsers.delete("AfkDialog");var t=e;t.code&&(t.preventDefault(),t.stopPropagation()),s.a.clear()};return Object(_.jsx)(N,{onClose:e,children:Object(_.jsx)(O.a,{style:{fontSize:Object(r.y)()?"2em":"1em"},children:Object(_.jsx)(A.a,{color:"primary",variant:"contained",style:{textTransform:"none"},autoFocus:!0,onKeyDown:e,onClick:e,children:Object(C.c)("afkMessage")})})})};j.displayName="AfkDialog";var T="./static/media/people_login.db1eab64.png",k=n(723),I=n(402),R=n.n(I),w=function(e){var t=e.stores.participants,n=Object(f.useState)(t.local.information.name),a=Object(i.a)(n,2),c=a[0],u=a[1],l=sessionStorage.getItem("room"),d=Object(f.useState)(o.a.room?o.a.room:l||""),h=Object(i.a)(d,2),p=h[0],m=h[1],v=function(e){e&&(t.local.information.name!==c&&(t.local.information.name=c,t.local.sendInformation(),t.local.saveInformationToStorage(!0)),o.a.room=p,sessionStorage.setItem("room",p)),s.a.clear()},g=function(e){"Enter"===e.key?v(!0):"Esc"!==e.key&&"Escape"!==e.key||v(!1)},b=Object(C.d)(),E=b.t,S=b.i18n,j={fontSize:Object(r.y)()?"2em":"1em",height:Object(r.y)()?"2em":"1.5em",color:"black",backgroundColor:"white",padding:"3px"},I={fontSize:(Object(r.y)(),"1em"),color:"white"},w={height:Object(r.y)()?"4em":"3em",padding:"3px 0 0 0",width:"15em"};return Object(_.jsx)(N,{onClose:function(){s.a.clear()},children:Object(_.jsxs)(O.a,{style:{overflowY:"hidden",backgroundColor:"#5f7ca0",fontSize:Object(r.y)()?"2em":"1em"},children:[Object(_.jsx)("p",{style:{textAlign:"right",color:"white"},children:"Version 1.0.1"}),Object(_.jsx)(A.a,{style:{position:"absolute",top:30,right:20,display:"none"},onClick:function(){var e=(C.b.findIndex((function(e){return e===S.language}))+1)%C.b.length;S.changeLanguage(C.b[e])},children:Object(_.jsx)(R.a,{})}),Object(_.jsx)("p",{}),Object(_.jsx)("div",{style:{position:"relative",width:"100em",display:"block"}}),Object(_.jsx)("div",{style:{position:"relative",top:"3em",width:"100%",textAlign:"center"},children:Object(_.jsx)("img",{style:{width:"30em"},src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAiwAAAIsCAYAAADRd/LpAAAACXBIWXMAAAsSAAALEgHS3X78AAAeRklEQVR4nO3di3EcR7Iu4NY6wPGA9IC8FhDHAmINmCBkgSAHZqlxYLEWCIwx4IIWHMCCC1iwhAcDC3ijqRpqOHjMqx9ZVd8XodDZE7Fko1ur+JmZlfXLt2/fGoBtJtP5u/ZvXb6o5WJ27cUDuxBYoBKT6bwNG+/ST/sm/bVysvEW3o/4Vu6bpvm69p+/rv3nZdM0t6v//3Ix+/rEfx8okMACBZhM52/WQsibVAlZhZP2768K/853Kcysws0q2CyXi9ntDv99IDiBBTKx1pI5WQskbTh57Rtu9ZACzCrQrMKMlhRkQmCBYFIweZMCyer/fus79WbVgrpeBRpBBuIRWGBEk+n8ZC2YvBNMQrlPlZgff5mZgfEILDCQjXByopWTpVVr6Xr19+Vitqz9pcAQBBboQRqCPVkLJyon5brfCDCGfKEHAgt0YC2gnKieVG+9CnNtHga6IbDAAQQU9nSTAsyVCgwcRmCBHaSla20wORVQONLDKrykCoxBXtiBwALPSMeLVyFlzM2vlO1+Lbxc+dbwNIEF1kym81NVFEa0Xn25cgIJ/iawULXU6lkPKaWvsCcv7ZUDlym8aB1RNYGF6myElA/+CSATwgtVE1iogpBCYYQXqiOwULQ0k3ImpFAw4YUqCCwUJ63AP0vVFDMp1ORLCi6XvjqlEVgoQlrkdpb+crqH2j2kk0YXFtVRCoGFrE2m8zNzKfCids/LRds2ckyanAksZCdVU85TNUXLB3b3OQUX9xuRHYGFbKRqypmts3A0VReyI7AQWjqOfG42BXrz2awLORBYCCnd49MGlY++EAziJlVcnDAiJIGFUNLelHNtHxiNdhEhCSyEkOZTPmn7QBgPaSHdhYV0RCCwMJq1+ZRzp30gtHbO5ZPgwpgEFga3tuRNUIG8fEkVF8eiGZzAwmBSUPlkkBayd5MqLoILgxFY6J2gAsUSXBiMwEJvBBWohuBC7wQWOieoQLUEF3ojsNAZp36ApA0u57bn0iWBhaMJKsAzHIemMwILR7HwDdjBf1JwsTmXgwksHGQynZ+kLZiCCrCLh7TD5ZO3xSEEFvaSBmov3fUDHOg+VVtcssheBBZ2kuZU2j8Z/eaNAR0wmMteBBa2mkzn5ymsGKgFuvY5BRfzLbxIYOFZaU6lvWb+rbcE9OghtYkuvGSeI7DwSGr/XFj8BgzsLlVbLJ7jEYGFn2j/AAFoE/GIwMJ3k+n8XTr9o/0DRPCQQovTRHwnsFTO6R8guPY00Zltufyj+jdQsTRUeyusAIG1O5/+O5nOLZyrnApLhVJVpS2zfqj9XQBZuUvVFrtbKqTCUpnJdH7aNM1XYQXIUDtj9/9UW+qkwlIJVRWgMKotlVFhqYCqClAg1ZbKqLAUzAI4oBKqLRVQYSnU2gkgYQUo3aracu5Ll0uFpUCpRPqv2t8DUCV7WwolsBRkMp2/aZrmyrZaoHIPKbRc1f4iSiKwFGIynZ+leRV3AAH8xZ1EBRFYMmewFuBFBnILIbBkLF1Y2JY8X9f+LgBe4CLFAggsmUrT8P+u/T0A7EGLKGMCS2a0gACOokWUKXtYMpJaQNfCCsDB2lOU1+mgAhkRWDKR1utfO7IMcLT2NOWfk+n8wqvMh5ZQBtL/qH6r/T0A9KBtEZ2Ya4lPYAkszau0p4De1/4uAHr0kEKLuZbAtISCSvMqt8IKQO9epbuIzLUEJrAElP5Hc22/CsCg2rkWu1qC0hIKxsWFAKNrL1A8NdcSi8AShP0qAKHY1xKMwBJACiuOLAPE8pAqLde+y/jMsIxsbbhWWAGIpR3G/V/DuDEILCOaTOcnhmsBwrNkLgCBZSQpsf9vSvAAxPabE0TjMsMyAjctA2TLZtyRCCwDSwndSSCAfAktIxBYBuLYMkBR7tMJIseeByKwDMCxZYAiuYNoQIZueyasABSrPTRxndZT0DOBpUfCCkDxXJw4EIGlJylxfxVWAKrwp9DSL4GlBymsXNuxAlAVoaVHAkvHhBWAqgktPRFYOiSsACC09ENg6YiwAsCaP9NWczpiD0sHhBUAnvF5uZiptnRAheVIwgoAL/jo0sRuCCxHEFYA2MFHMy3HE1gOJKwAsAeDuEcSWA4grABwAKHlCALLnoQVAI4gtBxIYNmDsAJAB4SWAzjWvKN0kWF7hfjrLB4YgOh+XS5mThDtSGDZgVuXAejJ/1kuZrde7nZaQlsIKwD06DqNG7CFwLLdlbACQE9eCS27EVhekLYTvg/7gACUoA0tV6mizzMElmeksPIx5MMBUJrXqdIitDxDYHlCOm4mrAAwpLdpDIEnCCwbUlj5M9RDAVCL9y5LfJrAsiYNPV2EeSAAatRelvjJl/+ZPSzJZDp/kxbD2WILQAQWy60RWOxaASAui+USLaG/2LUCQER2tCTVBxa7VgAIrB1TuHTcufLA4vgyABmo/rhzU3NgmUznJ44vA5CJ9rhz1adYqxy6dSIIgExVe3KousDiRBAAmavy5FCNLaELYQWAjFV551BVgWUynZ8bsgUgc69qHMKtJrCkIdt/B3gUADhWdUO4VcywpNLZV0O2ABTmn8vFrIpqSy0VlmthBYACXdayCbf4wJJKZoZsAShRNZtwiw4sk+n8tGma3wI8CgD05W06AVu0YmdYLIcDoDJFL5UrucJyJawAUJGLkudZigwsk+n8k7kVACrzfZ6l1B+5uMCS9q38K8CjAMDQ3pa6n6WoGRb7VgDgu+L2s5RWYbkUVgCgvKPOxQSWdE/QhwCPAgBjK+6+oSJaQo4wA8CTfl8uZkXMtJRSYXGEGQAe+1TKUefsA4sjzADwrGKOOmcdWFJqdIQZAJ73Nv3hPmu5V1iKXZADAB36V+6toWwDi1YQAOwl6z/kZxlYtIIAYG9Zt4ZyrbBoBQHA/rJtDWUXWLSCAOAoWf6hP6vFcWlB3H8DPAoA5Cy7hXK5VVi0ggDgeJ9SESAb2QSWdFfQ+wCPAgC5y26hXBYtoXTj5Ffr9wGgU/9cLmZZXJKYS4XlUlgBgM5dpqJAeOEDy2Q6P2ma5kOARwGA0rTFgCx2s+RQYTFoCwD9+S2H3SyhA0vaufI6wKMAQMnCH3EOO3Sbjlvdml0BgEH8ulzMwnY1IldYLoQVABjMReQB3JCBxaAtAAwu9ABu1ApLVuuCAaAQv0XdgBsusEym8zOXGwLAaELOsYQaurXRFgBC+J/lYnYd6VNEq7CcCysAMLpwVZYwFZbUM/tvgEcBAJrm9+ViFmamNFKFJYvVwABQiU+RjjmHCCzpGPPHAI8CAPzlVRrVCCFKhUV1BQDiOY9yzHn0wJKqK+/Hfg4A4JEwy+QiVFgsiQOAuD5GqLKMGlgsiQOALIxeZRm7wmJ2BQDia6ss78Z8ytECS6quvB7r9wcA9jLqCMeYFRbVFQDIx/t0UGYUowQW1RUAyNJoxYaxKiyqKwCQn9GqLIMHFtUVAMjaKEWHMSosqisAkK9RqiyDBhbVFQAowuB3DA1dYVFdAYD8fRh6++1ggUV1BQCKMmgRYsgKy9mAvxcA0K9B7xgaJLC4kRkAijRYlWWoCovZFQAoz+lkOp8M8VP1HljSZUmqKwBQnldDnRgaosIy+NEnAGAw+QeWNIzzsc/fAwAY1at0ErhXfVdYnAwCgPL1Pqv6y7dv33r5hdMQztfU3wIAyvY/y8Xsuq+fsM8Ky6mwAgDV6HWWpc/A4igzANSj13X9vQSWtCjOGn4AqEtvVZa+KiyGbQGgPmd9LZLrPLA4ygwA1XqVZlg710eFRXUFAOrVS1tIYAEAuvQ2XcvTqU4Dy2Q6PzVsCwDV67zK0nWFRXUFAOj8FufOAksatv3Q1a8HAGSr8+HbLissvUwFAwBZ6rQt1GVgGeR6aQAgC2+73HzbSWBJ08CGbQGAdZ0VM7qqsKiuAACbOjuM01VgMb8CAGx6lVaeHO3owDKZzs/SNDAAwKYYgUV1BQB4wccudrIcFVjSA9i9AgC85OjixrEVFtUVAGCb0QOL00EAwDYfjm0LHRxY0jKYtz4RALCDo6osx1RYtIMAgF0d1ZU5JrC4mRkA2NVRq/oPCizaQQDAAQ7uzhxaYdEOAgD2JbAAAOG9P/S00N6BJf1G7/0zAQAc4KCixyEVFtUVAOBQAgsAEN5BV/ocEljcHQQAHGwyne9d/NgrsBzyGwAAbOg3sGgHAQAd6D2wnPhKAMCRXk2m83f7/BI7B5b0C7/2hQCADuxVZdmnwqK6AgB0pbfAYn4FAOjK23223u4TWGy3BQC6tHP3ZqfA4jgzANCDnfPFrhUW8ysAQNe6rbAILABAD15PpvM3u/yyWwNLGoh56ysBAD3YqSiyS4VFdQUA6MtOcyy7BBYDtwBAXzqrsOy1OhcAYA87rel/MbCYXwEABnBcYDG/AgAMYGveEFgAgLEJLABAeFv3sWwLLOZXAIAhvDjH8mxgmUznqisAwFBezB0vVVgEFgBgKIdVWOxfAQAG9P6l30qFBQAI4aVxlCcDS5rUfeXzAQADera781yFRTsIABiawAIAhLd3YDG/AgAM7dn9byosAEAYzw3ePgos6YZmA7cAwBieLJo8VWFRXQEAxrJzYDG/AgCM5clLEFVYAIBIntx4+1RgefF6ZwCAPqUFtlsDy7NHigAABvByYJlM59pBAMDYHs3TblZYtIMAgLFtbQmpsAAAY9saWFRYAICxPTopJLAAAOFsnhTaDCxPnn0GABjY04El3SEEABDBT3O16xUWA7cAQBQ/FVLWA4v5FQAgip92sQgsAEB4AgsAENFPB4EEFgAgPIEFAAhpMp3/mGNZDyyvfS4AIKLvgWVzmxwAQACPKiwCCwAQ1uZqfgCAKH4stV0FlhOfBgAI5se2WxUWACCqR4HFDAsAEM3b1fMILABAeFpCAEBYq9Urq8DyzqcCAAL6KbC88oUAgKi0hACAyP6qsEymc+0gACCqHy2hiU8EAESmJQQAhCewAACRfb8+6B/uEQIAolNhAQDCE1gAgPAEFgAgsu/rVxxrBgAi+76N/x/uEQIAotMSAgDCE1gAgPAEFgAgPIEFAAhPYAEAQptM5+8EFgAguonAAgCEZ3EcABBeG1je+kwAQGRaQgBAeAILABCewAIAhCewAADhCSwAQHhtYLn3mQCAyNrA8tUXAgAi0xICAMITWACA8AQWACC6W4EFAAhtuZgtBRYAIDyBBQAIT2ABAMJrA8vSZwIAImsDy60vBABEpiUEAER21wgsAEBw30dXBBYAIDyXHwIA4QksAEBk33OKlhAAEJnAAgDkwR4WACC8f7Q3IPpMAEBQ142WEACQg1VgufO1AICoVoFFWwgACGe5mGkJAQB5WAWWa98LAAjmYfU4KiwAQFQ/Vq+sAov1/ABAWAILABDVowqLU0IAQDQ/8sn3wLJczKznBwCi+dEBMnQLAET1ZGC58bkAgEBUWACA2JaL2ZOBxfI4ACCK+/XnUGEBACL6aeWKCgsAENGzgcUuFgAgiqcDi10sAEAgP+WSzRmWe18KAAjgp87PZmBxpxAAMLrlYvbTbO1mYDF4CwCM7VHHZzOwGLwFAMb2qOOzGVgM3gIAY3vU8RFYAIBoXq6wLBeztiX04LMBACPa2hJqVFkAgDFtnhBqngksTgoBAGN5cifcU4HFLhYAYCxPdnq0hACASHYLLO4UAgBGtHOFpXXnSwEAI9grsKiyAABDe1guZk/O0gosAEAUz+YPgQUAiOLZ1SpPBpanFrYAAPRs7wpL68ZXAQAGdFBg0RYCAIZy/9zAbSOwAABBvJg7Xgos5lgAgKG8mDueDSypLPPgMwEAAzi4wtKosgAAQ9h2QllgAQDGtvVkssACAIxta954MbCkm5vNsQAAfTousCSqLABAn7auUhFYAIAx3S0Xs+W2319gAQDGdLXL7701sJhjAQB6tFNhZJcKS6PKAgD0Ydv+lRWBBQAYy9b9Kyu7Bpad+ksAAHvYOV/sFFjSvUL3vgAA0KGdOzi7VlgabSEAoEMP6WDPTvYJLNpCAEBX9soVKiwAwBj2yhU7B5a0hW7naV4AgBf0VmFptIUAgA7c7LKOf53AAgAMbe88sVdgcbwZAOhAv4ElUWUBAA51nwogezkksFz6RADAgQ4qfOwdWNKSF20hAOAQBxU+DqmwNHayAAAHuN9nu+26QwOLORYAYF8H54eDAstyMWt/wwefCQDYw8EdmkMrLI0qCwCwh4dU8DiIwAIADOGoU8YHBxZtIQBgD+MElsROFgBgm4NPB60ILABA344eIzkqsFgiBwDs4OgCx7EVlsbwLQDwgqPbQU1HgeWig18DAChTJznh6MCSbly8K/MdAwBH6qQT00WFpVFlAQCe8CUVNo7WVWAxxwIAbOosH3QSWJaL2bJpms9d/FoAQBHaVfydrT/pqsLSqLIAAGs6zQWdBZa0qt9OFgCg6Xq+tcsKS2PzLQDQnh7uYvfKOoEFAOha56eHOw0s6ejSly5/TQAgKw99zLV2XWFpVFkAoGpX6fRwpzoPLIZvAaBqvSyT7aPC0th8CwBVuul62Halr8BymXpYAEA9ehsL6SWwpN6VRXIAUI/7LjfbbuqrwtL61OOvDQDE0uuhm94CSzrifNPXrw8AhNLr/GqfFZbG8C0AVOFzH0eZ1/UaWBxxBoAq9D4G0neFpTHLAgBFu0ljIL3qPbCkiWFHnAGgTIMUJoaosDRmWQCgSO2tzNdD/GBDBhZVFgAoy2AFiUECS5ocdikiAJSj10Vxm4aqsDTaQgBQlEEP1QwWWNIE8eehfj8AoDeDVleagSssjSPOAFCEwbsmgwYWVRYAyN7DGHOpQ1dYGlUWAMjaRd9r+J8yeGBRZQGAbD2MdYhmjApLo8oCAFkapbrSjBVYVFkAIDujVVeaESssjSoLAGTl01jVldYv3759G+1lTabzdsr442gPAADsot278mbMNzVmhaVJVRZ3DAFAbKN3RUYNLGmWxcp+AIhr8K22Txm7wtK4yRkAQjuP8HCjB5Y0wKPKAgDx3CwXs6sITxWhwtKkwHIf4DkAgL+FOdEbIrCkKotjzgAQx5flYnYd5WmiVFiaNNBzF+BRAIAgsysrYQJLEurlAECl/pNO8oYRKrCk0tOXAI8CALV6iDimEa3C0qiyAMCoRl3B/5xwgSWVoP4I8CgAUJt2SVzIVSMRKyyNZXIAMIqzqK89ZGBJpSitIQAYTqhjzJuiVlhWx5xvAjwKAJTuIXqhIGxgSVRZAKB/F9GOMW/65du3b7GeaMNkOm/nWX4L9VAAUI520PZN9J8meoWlSWfB3TMEAP0IO2i7LnxgMYALAL0JPWi7LocKS5OutjaACwDdecilutLkEliSM7tZAKAzITfaPiebwJKml8PdbQAAGbqJutH2OTlVWJr0cu8CPAoA5CybVtBKVoElye4lA0Agf0TfufKU7ALLcjG7dTkiABzkbrmYZTlekWOFpUkvW2sIAPaTbZciy8CSaA0BwO7+SF2KLGUbWLSGAGBn2baCVnKusGgNAcBusu9KZB1YEq0hAHje7zm3glayDyzpI/we4FEAIJrsFsQ9p4QKy2qhnLuGAOBvWd0VtE0RgSVx1xAA/O0sxwVxzykmsKSPYp4FAJrmy3IxuyrpPZRUYWnSx/kc4FEAYCz3Jf4BvqjAkpw76gxAxU6Xi9mytB+/uMCSPpLWEAA1ynqb7UtKrLA46gxAjW5y32b7kiIDS/P3UecvAR4FAPrWnpI9LfktFxtYkrM0fAQAJStybmVd0YElfbxT+1kAKFg7t3Jd+gf+5du3bwEeo1+T6byttPxZ8s8IQJXafStFt4JWSm8JfbdczC7tZwGgMEXuW3lOFYElsZ8FgFI81DC3sq6awGKeBYCCnJe6b+U5NVVYVvcNVdHrA6BY/0mjDlWpKrA0f4WWa0vlAMhUuxzuvMaPV11gaf5eKmcIF4Cc3NfcJagysCSGcAHIRXVDtpuq2MPynMl0Pmmapp1reRXzCQHgu38uF7Orml9FzRWW1cmhEyeHAAjs99rDSlN7YGn+vtm5ygEmAML7nOYuq1d1S2jdZDpvQ8u/4zwRAJW7Wy5m72p/CSvVV1hWnBwCIJC7NLJAosKyYTKdt3ta3od6KABq0s5VntS2yXYbFZbHTh13BmAkwsozBJYNayeH7kM9GAA1qO6OoF0JLE9wUSIAI/i1xjuCdiWwPCMlXDtaABjCH8LKywzdbjGZzttKy/8N/ZAA5KzdtXLmC75MhWWLtF3w19APCUCuhJUdqbDsaDKdt/9A/ZnFwwKQg5vlYmbXyo5UWHaUeot/ZPGwAER3lw53sCMVlj1NpvM2uHzM6qEBiOQu7VpZ+iq7U2HZU+o1WuEPwCGElQMJLAcQWgA4gLByBIHlQEILAHsQVo4ksBxBaAFgB8JKBwSWIwktALxAWOmIwNIBoQWAJwgrHRJYOiK0ALBGWOmYwNIhoQUAYaUfAkvHhBaAqgkrPRFYeiC0AFRJWOmRwNKTFFp+L/KHA2CTsNIzgaVHy8XsommaX4v9AQFoUkVdWOmZyw8HMJnO22rLn8X/oAD1+Zwq6vRMhWUAy8WsveH5n03TPBT/wwLUQ1gZkArLgCbT+bumaa6bpnlVzQ8NUKbfU9ufgaiwDGi5mN22fc6mae6r+aEByvOrsDI8FZYRTKbzSaq0vK3uhwfIV9vWP10uZte+4fBUWEaQJsnbSsuX6n54gDw9pJNAwspIVFhGNpnO24Hcj1W/BIDY7FgJQIVlZBbMAYT2RViJQYUliMl0fto0zaUTRABhOLYciMASSDr2fNU0zeva3wXAyH5NO7QIQmAJxgkigFE5CRSUwBKUYVyAwd2lsPLVq4/H0G1QhnEBBrUarhVWglJhCW4ynZ+kuRbDuAD9+GO5mH3ybmMTWDIwmc7fpNBirgWgO+28ytlyMbvyTuMTWDJirgWgM+ZVMmOGJSNpruXX9KcCAA7z2bxKflRYMpT2tVxqEQHspf3D3rn9KnlSYcnQcjG7TZcnfq79XQDsaHUfkLCSKRWWzE2m87ZNdOEUEcCzPqfKivuAMiawFECLCOBJWkAF0RIqwFqL6D+1vwuApG0BvRNWyqHCUhi3PgNYBFcigaVA6QLFdhHS+9rfBVCV+7QIzsWFBRJYCjaZzs+bpvmk2gJUwGBt4QSWwlnrDxTOev1KCCyVmEznbaXlX7W/B6AoX1JYUVWpgMBSEcefgUKoqlRIYKmQaguQMVWVSgkslUqzLZdOEgGZUFWpnMBSOSeJgAy0SzE/qarUTWBhtbelrbZ88DaAQOxV4QeBhR8m0/lJCi6vvRVgZLbV8hOBhZ+kasu5oVxgJDepqvLVB2CdwMKTDOUCA7tPm2oN1fIkgYUXpcsUL7SJgB790f57xlAtLxFY2GqtTXTuNBHQoS+pqqL9w1YCCztLbaJ2CO6jtwYc4S4FFad/2JnAwt7SaaJP5luAPT2koHLpxbEvgYWDmW8BdvSQ/l1hToWDCSwcbTKdn6V/GZlvATZ9TlUVQYWjCCx0wmAusOFzWqdvoJZOCCx0SnCB6t2koGKglk4JLPTCiSKojqBCrwQWeiW4QPEEFQYhsDAIwQWKI6gwKIGFQaXgcmbGBbIlqDAKgYVRGM6F7Dj1w6gEFkaVgsuq4mIBHcTSLny7ElSIQGAhjLSArg0ub30VGJXNtIQjsBBOuquoDS4ffB0Y1H2qprjrh3AEFsJKA7rnqWVkzgX68yVVUwzSEpbAQnhpzuVUuwg6tWr7XJpPIQcCC1lJ7aIz+1zgYDcppGj7kBWBhSytnS46U3WBrdpqymVq+6imkCWBhexNpvN3qV10atYFftLOplypplACgYWipKPRp04YUbH7NJtypZpCSQQWipROGJ1qGVGJVcunnU259dEpkcBC8daOR5/apktBVlto20rKlQ9L6QQWqpLmXc6EFzIlpFAtgYVqCS9kQkiheo3AAn8x80Iw92shxfZZqtcILPDY2mbd9q8TR6UZyE0KKdcGZ+ExgQW2SNt1V+FF9YWutFWU67WQ4lZkeIHAAntYq76cpL/MvrCrhxRQrlVRYH8CCxwhzb6cCDA8oQ0ot6sqioACxxFYoEMbAeadFlJVVFCgRwIL9Ci1kN5thBhDvGW4SRWU2xRQrMGHHgksMLBUhXm3FmSEmPhW4eSr6gmMQ2CBAFKIebMWYN5oJ43ifhVK0t9vhROIQWCBwNI23jdrIeaNikwn7laBJP39qwVtEJvAAplK+2FWMzLrf1eZ+btSslwPJSmYmDWBDAksUKgUaJq1INOkllOTcbBZBZFmLYQ0qYXTCCRQLoEFWA83K+shZ2VVxenKeuBYd5sqIyu3tsBC5Zqm+f/NzPpV5Pn/pAAAAABJRU5ErkJggg==",alt:""})}),Object(_.jsx)("div",{style:{position:"relative",top:"-23em",width:"100%",textAlign:"center"},children:Object(_.jsx)("img",{style:{width:"10em"},src:T,alt:""})}),Object(_.jsx)("br",{}),Object(_.jsx)(y.a,{mt:1,children:Object(_.jsx)("div",{style:{position:"relative",top:"-24em",width:"100%",textAlign:"center"},children:Object(_.jsx)(k.a,{label:E("YourName"),multiline:!1,value:c,style:w,inputProps:{style:j,autoFocus:!0},InputLabelProps:{style:I},onChange:function(e){return u(e.target.value)},onKeyPress:g,fullWidth:!1})})}),Object(_.jsx)(y.a,{mt:2,children:Object(_.jsx)("div",{style:{position:"relative",top:"-24em",width:"100%",textAlign:"center"},children:Object(_.jsx)(k.a,{label:E("Venue"),multiline:!1,value:p,style:w,inputProps:{style:j,autoFocus:!1},InputLabelProps:{style:I},onChange:function(e){return m(e.target.value)},onKeyPress:g,fullWidth:!1})})}),Object(_.jsx)(y.a,{mt:2,children:Object(_.jsx)("div",{style:{position:"relative",top:"-24em",width:"100%",textAlign:"center"},children:Object(_.jsx)("img",{style:{width:"4em"},src:"data:image/png;base64,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",onClick:function(){return v(!0)},alt:""})})}),Object(_.jsx)(y.a,{mt:7,children:Object(_.jsx)("div",{style:{position:"relative",top:"-24em",width:"100%",textAlign:"center"},children:Object(_.jsx)("img",{style:{width:"8em"},src:"data:image/png;base64,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",alt:""})})})]})})};w.displayName="TheEntrance";var D=new Map;D.set("entrance",(function(e){return Object(_.jsx)(w,Object(g.a)({},e))})),D.set("afk",(function(e){return Object(_.jsx)(j,{})}));var N=function(e){return Object(_.jsxs)(E.a,Object(g.a)(Object(g.a)({},e),{},{open:s.a.show(),onClose:e.onClose,maxWidth:"xl",fullWidth:!1,fullScreen:!0,children:[s.a.title?Object(_.jsx)(S.a,{id:"simple-dialog-title",children:s.a.title}):void 0,e.children]}))},P=function(e){function t(){"retry"!==s.a.type&&s.a.clear()}return Object(_.jsx)(p.a,{children:function(){return s.a.type?D.has(s.a.type)?D.get(s.a.type)(e):Object(_.jsxs)(N,{onClose:function(){t()},children:[Object(_.jsx)(O.a,{children:s.a.message}),"retry"!==s.a.type?Object(_.jsxs)(y.a,{mt:2,mb:2,ml:4,children:[Object(_.jsx)(A.a,{variant:"contained",color:"primary",style:{textTransform:"none"},onClick:function(){t()},children:Object(C.c)("emClose")}),"\xa0",Object(_.jsx)(A.a,{variant:"contained",color:"secondary",style:{textTransform:"none"},onClick:function(){s.a.supressedTypes.add(s.a.type),t()},children:Object(C.c)("emNeverShow")})]}):void 0]}):Object(_.jsx)(_.Fragment,{})}})};function M(e){var t=e.split("_");return Object(r.b)(t.length<=2),Object(_.jsxs)(_.Fragment,{children:[t[0],t[1]?Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)("strong",{children:t[1].substr(0,1)}),t[1].substr(1)]}):void 0]})}P.displayName="ErrorDialog";var L=n(231),x=n.n(L),F=n(64),B=n(718),U=n(463),V=n(715),J=n(704),G=n(712),H=n(428),z=n.n(H),Q=n(240),K=n.n(Q),Y=n(431),W=n.n(Y),q=n(430),X=n.n(q),Z=n(429),$=n.n(Z),ee=n(239),te=n.n(ee),ne=n(427),ie=n.n(ne),oe=n(14),re=n(30),ae=n(29),se=n(107),ce=n(174),ue=n(708),le=n(707),de=n(729),he=30,pe=function(e){return Object(_.jsx)(le.a,{container:!0,spacing:2,children:Object(_.jsx)(de.a,{value:e.value,min:0,max:he,track:!1,valueLabelDisplay:"auto","aria-labelledby":"continuous-slider",style:{width:200},onChange:function(t,n){return e.setValue(n)},valueLabelFormat:function(e){return e===he?"\u221e":e.toString()}})})},fe=function(e){var t=e.roomInfo,n=e.participants.local,i=Object(p.b)((function(){return n.remoteVideoLimit})),o=Object(p.b)((function(){return n.remoteAudioLimit})),r=Object(_.jsx)(pe,{value:i>=0?i:he,setValue:function(e){n.remoteVideoLimit=e===he?-1:e}}),a=Object(_.jsx)(pe,{value:o>=0?o:he,setValue:function(e){n.remoteAudioLimit=e===he?-1:e}});return Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(ue.a,{control:r,label:Object(C.c)("videoLimit")}),Object(_.jsx)(ue.a,{control:a,label:Object(C.c)("audioLimit")}),Object(_.jsx)("br",{}),Object(_.jsx)(A.a,{variant:"contained",color:t.passMatched?"primary":"default",style:{textTransform:"none"},disabled:!t.passMatched,onClick:function(){t.passMatched&&re.b.conference.sync.sendTrackLimits("",[n.remoteVideoLimit,n.remoteAudioLimit])},children:"Sync limits"})]})};fe.displayName="RemoteTrackLimitControl";var me=function(e){var t=m.a.useState(""),n=Object(i.a)(t,2),o=n[0],a=n[1],s=m.a.useState(!1),c=Object(i.a)(s,2),u=c[0],l=c[1],d=m.a.useState(!1),f=Object(i.a)(d,2),v=f[0],b=f[1],E=m.a.useState(""),O=Object(i.a)(E,2),S=O[0],C=O[1],j=m.a.useRef(null),T=m.a.useRef(null),I=m.a.useRef(null),R=e.stores,w=R.roomInfo,D=R.participants;return Object(_.jsx)(p.a,{children:function(){var t=Object(r.v)(w.backgroundFill)?"white":"black",n=Object(r.v)(w.backgroundColor)?"white":"black",i=w.passMatched?"primary":"default";return Object(_.jsxs)(y.a,{m:2,children:[Object(_.jsx)(y.a,{m:2,children:Object(_.jsx)(fe,Object(g.a)({},e.stores),"remotelimitcontrol")}),Object(_.jsxs)(y.a,{mt:2,mb:2,children:[Object(_.jsx)(k.a,{autoFocus:!0,label:"Admin password",type:"password",style:{marginTop:-12},value:null===w||void 0===w?void 0:w.password,onChange:function(e){w.password=e.currentTarget.value},onKeyPress:function(e){return function(e,t){if("Enter"===e.key){var n=t.roomProps.get("password");t.passMatched=t.password===(n||"")}}(e,w)}}),"\u2003",Object(_.jsx)(A.a,{variant:"contained",color:"primary",style:{textTransform:"none"},onClick:function(){var e=w.roomProps.get("password");e||(e=""),w.passMatched=(null===w||void 0===w?void 0:w.password)===e},children:" Check "}),"\u2003",w.passMatched?"OK":"Not matched"]}),Object(_.jsxs)(y.a,{mt:2,mb:2,children:[Object(_.jsx)(k.a,{label:"New password to update",type:"text",style:{marginTop:-12},value:null===w||void 0===w?void 0:w.newPassword,onChange:function(e){w.newPassword=e.currentTarget.value}}),"\u2003",Object(_.jsx)(A.a,{variant:"contained",color:i,disabled:!w.passMatched,style:{textTransform:"none"},onClick:function(){w.passMatched&&re.b.conference.setRoomProp("password",w.newPassword)},children:" Update password "}),"\u2003"]}),Object(_.jsxs)(y.a,{mt:2,children:[Object(_.jsx)(A.a,{variant:"contained",color:i,style:{textTransform:"none"},disabled:!w.passMatched,onClick:function(){w.passMatched&&re.b.conference.sendMessage(ae.b.MUTE_VIDEO,!0)},children:" Mute all videos "})," \xa0",Object(_.jsx)(A.a,{variant:"contained",color:i,style:{textTransform:"none"},disabled:!w.passMatched,onClick:function(){w.passMatched&&re.b.conference.sendMessage(ae.b.MUTE_VIDEO,!1)},children:" Show all videos "}),"\u2003",Object(_.jsx)(A.a,{variant:"contained",color:i,style:{textTransform:"none"},disabled:!w.passMatched,onClick:function(){w.passMatched&&re.b.conference.sendMessage(ae.b.MUTE_AUDIO,!0)},children:" Mute all mics "}),"\xa0",Object(_.jsx)(A.a,{variant:"contained",color:i,style:{textTransform:"none"},disabled:!w.passMatched,onClick:function(){w.passMatched&&re.b.conference.sendMessage(ae.b.MUTE_AUDIO,!1)},children:" Switch on all mics "})]}),Object(_.jsxs)(y.a,{mt:2,children:[Object(_.jsx)(A.a,{variant:"contained",color:i,style:{textTransform:"none"},disabled:!w.passMatched,onClick:function(){w.passMatched&&h.c.removeAllContents()},children:" Remove all Contents "}),"\u2003",Object(_.jsx)(A.a,{variant:"contained",color:i,style:{textTransform:"none"},disabled:!w.passMatched,onClick:function(){if(w.passMatched){var e=new Set(h.c.roomContentsInfo.keys());h.c.all.forEach((function(t){return e.add(t.id)})),h.c.all.filter((function(e){return e.ownerName===o})).forEach((function(e){return h.c.removeByLocal(e.id)}))}},children:" Clear contents by user name "})," \u2009",Object(_.jsx)(k.a,{label:"name",type:"text",style:{marginTop:-12},value:o,onChange:function(e){a(e.currentTarget.value)}})]}),Object(_.jsxs)(y.a,{mt:2,children:[Object(_.jsx)(A.a,{variant:"contained",color:i,style:{textTransform:"none"},disabled:!w.passMatched,onClick:function(){var e;w.passMatched&&(re.b.conference.sendMessageViaJitsi(ae.b.RELOAD_BROWSER,{}),(null===(e=re.b.conference.bmRelaySocket)||void 0===e?void 0:e.readyState)===WebSocket.OPEN&&re.b.conference.pushOrUpdateMessageViaRelay(ae.b.RELOAD_BROWSER,{}))},children:" Reload "}),"\u2003",Object(_.jsx)(A.a,{variant:"contained",disabled:!w.passMatched,style:w.passMatched?{backgroundColor:Object(r.G)(w.backgroundFill),color:t,textTransform:"none"}:{textTransform:"none"},onClick:function(){w.passMatched&&l(!0)},ref:T,children:"Back color"}),Object(_.jsx)(J.a,{open:u,onClose:function(){l(!1),re.b.conference.setRoomProp("backgroundFill",JSON.stringify(w.backgroundFill))},anchorEl:T.current,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:Object(_.jsx)(ce.a,{color:{r:w.backgroundFill[0],g:w.backgroundFill[1],b:w.backgroundFill[2]},disableAlpha:!0,onChange:function(e,t){t.preventDefault(),w.backgroundFill=[e.rgb.r,e.rgb.g,e.rgb.b]}})}),"\xa0",Object(_.jsx)(A.a,{variant:"contained",disabled:!w.passMatched,style:w.passMatched?{backgroundColor:Object(r.G)(w.backgroundColor),color:n,textTransform:"none"}:{textTransform:"none"},onClick:function(){w.passMatched&&b(!0)},ref:I,children:"Pattern color"}),Object(_.jsx)(J.a,{open:v,onClose:function(){b(!1),re.b.conference.setRoomProp("backgroundColor",JSON.stringify(w.backgroundColor))},anchorEl:I.current,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:Object(_.jsx)(ce.a,{color:{r:w.backgroundColor[0],g:w.backgroundColor[1],b:w.backgroundColor[2]},disableAlpha:!0,onChange:function(e,t){t.preventDefault(),w.backgroundColor=[e.rgb.r,e.rgb.g,e.rgb.b]}})}),"\xa0",Object(_.jsx)(A.a,{variant:"contained",color:i,style:{textTransform:"none"},disabled:!w.passMatched,onClick:function(){w.passMatched&&(w.backgroundFill=w.defaultBackgroundFill,w.backgroundColor=w.defaultBackgroundColor,re.b.conference.setRoomProp("backgroundFill",JSON.stringify(w.backgroundFill)),re.b.conference.setRoomProp("backgroundColor",JSON.stringify(w.backgroundColor)))},children:" Default "}),"\u2003",Object(_.jsx)(A.a,{variant:"contained",color:i,style:{textTransform:"none"},disabled:!w.passMatched,onClick:function(){D.local.recording=!D.local.recording,D.local.recording?se.b.start(e.stores):se.b.stop().then((function(e){C(URL.createObjectURL(e)),e.slice(0,4).arrayBuffer().then((function(t){var n=new Int32Array(t)[0];e.slice(4,4+n).text().then((function(e){var t=JSON.parse(e);console.log(JSON.stringify(t));var n,i=Object(oe.a)(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;console.log("blob: ".concat(JSON.stringify(o)))}}catch(r){i.e(r)}finally{i.f()}}))}))}))},children:D.local.recording?"Stop Recorder":"Start Recorder"}),"\xa0",S?Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)("a",{href:S,download:"BMRecord.bin",children:"Download"}),"\xa0"]}):void 0,Object(_.jsx)("input",{type:"file",accept:"application/octet-stream",ref:j,style:{display:"none"},onChange:function(t){var n,i=null===(n=t.currentTarget)||void 0===n?void 0:n.files;i&&i.length&&se.a.load(i[0]).then((function(){se.a.play(e.stores,re.b)}))}}),Object(_.jsx)(A.a,{variant:"contained",color:i,style:{textTransform:"none"},disabled:!w.passMatched,onClick:function(){var e;null===(e=j.current)||void 0===e||e.click()},children:"Play"})]})]})}})},ve=n(710),ge=n(709),be=function(e){var t=e.stores.participants.local,n=Object(_.jsx)(p.a,{children:function(){return Object(_.jsx)(ge.a,{checked:t.physics.onStage,name:"broadcast",onChange:function(e){return t.setPhysics({onStage:e.target.checked})}})}}),i=Object(C.d)().t;return Object(_.jsx)(ve.a,{children:Object(_.jsx)(ue.a,{control:n,label:i("broadcastMyVoice")})})};be.displayName="BroadcastControl";var ye=n(657),Ae=n(711),Ee=n(407),Oe=n.n(Ee);function Se(e,t){return{onMouseOver:function(n){var i;(null===(i=n.nativeEvent.sourceCapabilities)||void 0===i?void 0:i.firesTouchEvents)||(t.timeout&&(clearTimeout(t.timeout),t.timeout=void 0),e(!0))},onMouseOut:function(n){t.timeout&&clearTimeout(t.timeout),t.timeout=setTimeout((function(){e(!1),t.timeout=void 0}),500)}}}var Ce,_e,je,Te=function(e){return Object(_.jsx)(Ae.a,{in:e.show,style:e.style,children:Object(_.jsx)(ye.a,{className:e.className,color:e.color,onClick:function(t){e.onClickMore&&e.onClickMore(t)},size:"small",ref:e.buttonRef,children:Object(_.jsx)(Oe.a,{color:e.iconColor,htmlColor:e.htmlColor,fontSize:"large"})})})},ke=n(714),Ie=n(713),Re=Object(G.a)((function(e){return{container:{display:"inline-block",marginLeft:e.spacing(2),marginRight:e.spacing(2),marginTop:e.spacing(1),marginBottom:e.spacing(1),pointerEvents:"auto"}}})),we=function(e){var t=Re(),n=Object(f.useState)(!1),o=Object(i.a)(n,2),r=o[0],a=o[1],s=Object(f.useRef)({timeout:void 0}).current;return Object(_.jsxs)("div",Object(g.a)(Object(g.a)({className:t.container+(e.className?" ".concat(e.className):""),style:e.style,ref:e.divRef},Se(a,s)),{},{children:[Object(_.jsx)(Ie.a,{style:{height:e.size,width:e.size},onClick:function(t){e.onClick&&e.onClick(t)},onContextMenu:function(t){t.preventDefault(),e.onClickMore&&e.onClickMore(t)},color:e.color,onFocus:function(e){var t;null===(t=e.target)||void 0===t||t.blur()},children:e.children}),e.onClickMore?Object(_.jsx)(Te,{style:{position:"relative",top:-35,left:-15,marginRight:-41},show:r,color:e.color,htmlColor:e.htmlColor,iconColor:e.iconColor,onClickMore:e.onClickMore}):void 0]}))},De=function(e){return e.title?Object(_.jsx)(ke.a,{placement:"top-start",arrow:!0,title:e.title,children:Object(_.jsx)("span",{style:{paddingTop:20},children:Object(_.jsx)(we,Object(g.a)({},e))})}):Object(_.jsx)(we,Object(g.a)({},e))},Ne=n(409),Pe=n.n(Ne),Me=n(660),Le=n(42),xe=n(21),Fe=n(11),Be=(n(81),n(61)),Ue=n.n(Be),Ve=n(3),Je=(Ce=Ve.h.shallow,_e=function e(){Object(b.a)(this,e),Object(xe.a)(this,"videos",je,this),Object(Ve.g)(this)},je=Object(Fe.a)(_e.prototype,"videos",[Ce],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_e),Ge=function(e){var t=e.setStep,n=e.stores,i=n.contents,o=n.map,a=n.participants,s=Object(p.b)((function(){return e.cameras.videos.map((function(e,t){return function(e,t,n){var i=!1;i=e.deviceId===a.local.devicePreference.videoInputDevice;var o=String.fromCharCode(65+n);return Object(_.jsx)(V.a,{onClick:function(){t(e.deviceId)},children:"".concat(o,"\xa0").concat(i?"\ud83d\ude42\xa0":"\xa0\xa0\u2003").concat(e.label)},e.deviceId)}(e,c,t)}))}));function c(e){t("none"),e&&Ue.a.createLocalTracks({devices:["video"],cameraDeviceId:e}).then((function(e){if(e.length){var t=Object(Le.g)(e,o,"camera");i.shareContent(t),Object(r.b)(t.id),i.tracks.addLocalContent(t.id,e)}}))}return Object(f.useEffect)((function(){var t=function(t){if("Key"===t.code.substr(0,3)){var n,i=t.code.charCodeAt(3)-65;c(null===(n=e.cameras.videos[i])||void 0===n?void 0:n.deviceId)}};return window.addEventListener("keypress",t),function(){window.removeEventListener("keypress",t)}}),[]),Object(_.jsx)(_.Fragment,{children:s})};Ge.displayName="CameraSelector";var He=n(459),ze=n(705),Qe=n(659);function Ke(e){var t=e.setStep,n=e.value,i=e.onFinishInput,o=e.inputField;return Object(_.jsxs)(ze.a,{children:[Object(_.jsx)(Qe.a,{children:o}),Object(_.jsx)(Qe.a,{children:Object(_.jsx)(A.a,{variant:"contained",color:"primary",onClick:function(){i(n),t("none")},children:"Done"})})]})}Ke.displayName="Input";var Ye=function(e){var t=e.setStep,n=Object(f.useState)([]),o=Object(i.a)(n,2),r=o[0],a=o[1];console.log(e.type," TYPE");var s=Object(C.d)().t,c=Object(_.jsx)(He.a,{acceptedFiles:["image/*"],dropzoneText:s("imageDropzoneText"),onChange:a}),u=e.stores.map;return Object(_.jsx)(Ke,{stores:e.stores,setStep:t,onFinishInput:function(t){t.forEach((function(t,n){Object(Le.e)(t,u,[30*n,-20*n],e.type).then((function(e){return h.c.shareContent(e)}))}))},value:r,inputField:c})},We=n(418),qe=n(419),Xe=n.n(qe),Ze=n(233),$e=n.n(Ze),et=n(420),tt=n.n(et),nt=n(717),it=n(703),ot=n(725),rt=n(730),at=n(235),st=n.n(at),ct=n(421),ut=n.n(ct),lt=n(422),dt=n.n(lt),ht=n(425),pt=n.n(ht),ft=n(237),mt=n.n(ft),vt=n(284),gt=n.n(vt),bt=n(424),yt=n.n(bt),At=n(189),Et=n.n(At),Ot=n(423),St=n.n(Ot),Ct=n(234),_t=n.n(Ct),jt=n(160),Tt=n(161),kt=n(44),It=n.n(kt),Rt=n(716),wt=function(e){var t=e.icon,n=e.text,i=e.secondEl,o=e.tip,a=e.dense,s=e.onClick,c=M(n),u=Object(r.y)()?"2.5em":"1em",l=Object(_.jsxs)(Qe.a,{button:!0,dense:a,onClick:s,style:{alignItems:"start"},children:[t?Object(_.jsx)(Rt.a,{style:{fontSize:u,height:u},children:t}):void 0,Object(_.jsx)(Qe.a,{style:{paddingLeft:0,paddingTop:0,paddingBottom:0},children:Object(_.jsxs)("div",{style:{fontSize:Object(r.y)()?"2.5em":"1.2em",verticalAlign:"middle"},children:[c,Object(_.jsx)("br",{}),i]})})]});return o?Object(_.jsx)(ke.a,{title:o,placement:"top-end",enterDelay:1e3,children:l}):l};function Dt(e){return new Promise((function(t,n){jt.b.desktopSharingFrameRate.max=e.stores.contents.screenFps,Ue.a.createLocalTracks({devices:["desktop"]}).then((function(e){t(e)})).catch((function(e){console.warn("Share screen error: ".concat(e))}))}))}var Nt=function(e){var t=Object(C.d)().t,n=e.stores,o=n.contents,a=n.participants,s=n.map,c=Object(p.b)((function(){return{main:o.tracks.localMains.size,contents:o.tracks.localContents.size}})),u=Object(p.b)((function(){return a.local.mouse.show})),l=Object(f.useRef)(null),d=m.a.useState(!1),h=Object(i.a)(d,2),v=h[0],g=h[1];function b(t){"camera"===t&&navigator.mediaDevices.enumerateDevices().then((function(t){e.cameras.videos=t.filter((function(e){return"videoinput"===e.kind}))})).catch((function(){console.warn("Device enumeration error")})),e.setStep(t)}var y=function(){var e;null===(e=l.current)||void 0===e||e.click()},A=function(){b("none"),function(e){var t=JSON.stringify(Object(Le.k)(e.all)),n=new Blob([t],{type:"text/plain"}),i=document.createElement("a"),o=URL.createObjectURL(n);i.href=o,i.download="BinauralMeetSharedItems.json",document.body.appendChild(i),i.click(),setTimeout((function(){document.body.removeChild(i),window.URL.revokeObjectURL(o)}),0)}(o)},E=function(){b("none");var e=Object(Le.f)("",s);o.shareContent(e),o.setEditing(e.id)},O=function(){b("none"),navigator.clipboard.readText().then((function(e){Object(Le.c)(e,s).then((function(e){o.shareContent(e)}))}))},S=function(){b("none");var e=new Uint32Array(4);e=window.crypto.getRandomValues(e);var t="";e.forEach((function(e){return t+=e.toString(16)})),Object(Le.d)("https://wbo.ophir.dev/boards/BinauralMeet_".concat(Tt.a.conference.name,"_").concat(t),s).then((function(e){o.shareContent(e),o.setEditing(e.id)}))},j=function(){Dt(e).then((function(e){if(e.length){var t=Object(Le.g)(e,s,"screen");o.shareContent(t),Object(r.b)(t.id),o.tracks.addLocalContent(t.id,e)}})),b("none")},T=function(){Array.from(o.tracks.localContents.keys()).forEach((function(e){return o.removeByLocal(e)})),b("none")},k=function(){c.main?o.tracks.clearLocalMains():Dt(e).then((function(e){e.length&&o.tracks.addLocalMains(e)})),b("none")};return Object(f.useEffect)((function(){var e=function(e){s.keyInputUsers.has("shareDialog")&&("KeyI"===e.code?y():"KeyD"===e.code?A():"KeyV"===e.code?O():"KeyF"===e.code?(e.preventDefault(),b("iframe")):"KeyT"===e.code?(e.preventDefault(),E()):"KeyG"===e.code?(e.preventDefault(),b("image")):"KeyW"===e.code?(e.preventDefault(),S()):"KeyB"===e.code?k():"KeyS"===e.code?j():"KeyM"===e.code?(a.local.mouse.show=!u,b("none")):"KeyC"===e.code?b("camera"):"KeyL"===e.code&&T())};return window.addEventListener("keypress",e),function(){window.removeEventListener("keypress",e)}}),[]),Object(_.jsxs)(ze.a,{children:[Object(_.jsx)(wt,{tip:t("sharePasteTip"),text:t("sharePaste"),icon:Object(_.jsx)(F.Icon,{icon:Xe.a,style:{fontSize:"1.5rem"}}),onClick:O},"paste"),Object(_.jsx)(wt,{tip:t("shareImageTip"),text:t("shareImage"),icon:Object(_.jsx)(gt.a,{}),onClick:function(){return b("image")}},"shareImage"),Object(_.jsx)(wt,{text:t("shareText"),icon:Object(_.jsx)(_t.a,{}),onClick:E},"shareText"),Object(_.jsx)(wt,{tip:t("shareWhiteboardTip"),text:t("shareWhiteboard"),icon:Object(_.jsx)(F.Icon,{icon:$e.a,style:{fontSize:"1.5rem"}}),onClick:S},"shareWhiteboard"),Object(_.jsx)(nt.a,{}),Object(_.jsx)(nt.a,{}),Object(_.jsx)(wt,{tip:t("shareImageTip"),text:t("shareZoneImage"),icon:Object(_.jsx)(gt.a,{}),onClick:function(){return b("zoneimage")}},"shareZoneImage"),Object(_.jsx)(nt.a,{}),Object(_.jsx)(wt,{tip:t("shareMouseTip"),icon:Object(_.jsx)(F.Icon,{icon:tt.a,style:{fontSize:"1.5rem"}}),text:t(u?"stopMouse":"shareMouse"),onClick:function(){a.local.mouse.show=!u,b("none")}},"shareMouse"),Object(_.jsx)(wt,{text:t("shareCamera"),icon:Object(_.jsx)(st.a,{}),onClick:function(){return b("camera")}},"shareCamera"),Object(_.jsx)(wt,{tip:t("shareScreenContentTip"),icon:Object(_.jsx)(Et.a,{}),text:t("shareScreenContent"),onClick:j,secondEl:Object(_.jsx)(it.a,{component:"fieldset",children:Object(_.jsx)(p.a,{children:function(){return Object(_.jsxs)(rt.a,{row:!0,"aria-label":"screen-fps",name:"FPS",value:e.stores.contents.screenFps,onChange:function(t){e.stores.contents.setScreenFps(Number(t.target.value))},onClick:function(e){e.stopPropagation(),setTimeout(j,100)},children:[Object(_.jsx)(ue.a,{value:1,control:Object(_.jsx)(ot.a,{}),label:"1"}),Object(_.jsx)(ue.a,{value:5,control:Object(_.jsx)(ot.a,{}),label:"5"}),Object(_.jsx)(ue.a,{value:15,control:Object(_.jsx)(ot.a,{}),label:"15"}),Object(_.jsx)(ue.a,{value:30,control:Object(_.jsx)(ot.a,{}),label:"30"}),Object(_.jsx)(ue.a,{value:60,control:Object(_.jsx)(ot.a,{}),label:Object(_.jsxs)("span",{children:["60\xa0\xa0\xa0\xa0",t("fps")]})})]})}})})},"shareScreenContent"),o.tracks.localContents.size?Object(_.jsx)("div",{style:{paddingLeft:"1em"},children:Object(_.jsx)(wt,{dense:!0,icon:Object(_.jsx)(F.Icon,{icon:We.a,style:{fontSize:"1.5rem"}}),text:t("stopScreen"),onClick:T},"stopScreen")}):void 0,Object(_.jsx)(nt.a,{}),Object(_.jsx)(Qe.a,{button:!0,dense:!0,onClick:function(){g(!v)},children:v?Object(_.jsx)(ut.a,{}):Object(_.jsx)(dt.a,{})}),Object(_.jsx)("input",{type:"file",accept:"application/json",ref:l,style:{display:"none"},onChange:function(e){b("none"),function(e,t){var n,i=null===(n=e.currentTarget)||void 0===n?void 0:n.files;i&&i.length&&i[0].text().then((function(e){var n=JSON.parse(e);Object(kt.isArray)(n)&&n.forEach((function(e){var n=Object(Le.i)(e);if("screen"!==n.type&&"camera"!==n.type){var i=Object(Le.b)();Object.assign(i,n),t.addLocalContent(i)}}))}))}(e,o)}}),Object(_.jsx)(B.a,{in:v,timeout:"auto",unmountOnExit:!0,children:Object(_.jsxs)("div",{style:{paddingLeft:"1em"},children:[Object(_.jsx)(wt,{tip:t("shareIframeTip"),text:t("shareIframe"),icon:Object(_.jsx)(mt.a,{}),onClick:function(){return b("iframe")}},"shareIframe"),Object(_.jsx)(wt,{icon:c.main?Object(_.jsx)(St.a,{}):Object(_.jsx)(Et.a,{}),text:c.main?t("stopScreenBackground"):t("shareScreenBackground"),onClick:k},"shareScreenBackground"),Object(_.jsx)(nt.a,{}),Object(_.jsx)(wt,{text:t("shareImport"),icon:Object(_.jsx)(yt.a,{}),onClick:y,tip:t("shareImportTip")},"shareImport"),Object(_.jsx)(wt,{text:t("shareDownload"),icon:Object(_.jsx)(pt.a,{}),onClick:A},"shareDownload")]})})]})};Nt.displayName="ShareMenu";var Pt=n(66),Mt=function(e){var t=e.textLabel,n=e.defaultValue,o=Object(Pt.a)(e,["textLabel","defaultValue"]),r=e.setStep,a=e.onFinishInput,s=Object(f.useState)(void 0===n?"":n),c=Object(i.a)(s,2),u=c[0],l=c[1],d=Object(_.jsx)(k.a,{label:t,multiline:e.multiline,value:u,onChange:function(e){return l(e.target.value)},fullWidth:!0,inputProps:{autoFocus:!0},onKeyPress:function(t){e.multiline||"Enter"!==t.key||(a(u),r("none"))}});return Object(_.jsx)(Ke,Object(g.a)({value:u,inputField:d},o))};Mt.displayName="TextInput";var Lt=function(e){var t=e.open,n=e.onClose,o=e.stores.map,a=Object(f.useRef)(new Je),s=Object(f.useState)("menu"),c=Object(i.a)(s,2),u=c[0],l=c[1];h.c.pasteEnabled="none"===u||"menu"===u;var d=Object(C.d)().t,p={menu:d("Create and Share"),text:d("Share Text"),iframe:d("Share iframe"),image:d("Share image"),zoneimage:d("Share zone image"),none:"None",camera:d("Select video camera to share")}[u],m=function(t,n){switch(t){case"menu":return Object(_.jsx)(Nt,Object(g.a)(Object(g.a)({},e),{},{setStep:n,cameras:a.current}));case"text":return Object(_.jsx)(Mt,{stores:e.stores,setStep:n,onFinishInput:function(e){h.c.shareContent(Object(Le.f)(e,o))},textLabel:"Text",multiline:!0});case"iframe":return Object(_.jsx)(Mt,{stores:e.stores,setStep:n,onFinishInput:function(e){Object(Le.d)(e,o).then((function(e){h.c.shareContent(e)}))},textLabel:"URL",multiline:!1});case"image":case"zoneimage":return Object(_.jsx)(Ye,{setStep:n,stores:e.stores,type:t});case"camera":return Object(_.jsx)(Ge,{setStep:n,stores:e.stores,cameras:a.current});default:throw new Error("Unknown step: ".concat(t))}}(u,(function(e){"none"===e?n():l(e)}));return Object(_.jsxs)(E.a,{open:t,onClose:n,onExited:function(){return l("menu")},maxWidth:"sm",onPointerMove:function(e){o.setMouse([e.clientX,e.clientY])},children:[Object(_.jsx)(S.a,{id:"simple-dialog-title",style:{fontSize:Object(r.y)()?"2.5em":"1em"},children:p}),Object(_.jsx)(O.a,{children:m})]})};Lt.displayName="ShareDialog";var xt=Object(Me.a)({root:{display:"inline-block"}}),Ft=function(e){var t=xt(),n=e.stores.contents,i=Object(p.b)((function(){return n.tracks.localMains.size+n.tracks.localContents.size})),o=Object(C.d)().t;return Object(_.jsxs)("div",{className:t.root,children:[Object(_.jsx)(De,{size:e.size,color:i?"secondary":"primary",title:M(o("ttCreateAndshare")),"aria-label":"share",onClick:function(){return e.setShowDialog(!0)},children:Object(_.jsx)(F.Icon,{icon:Pe.a,style:{width:e.iconSize,height:e.iconSize}})}),Object(_.jsx)(Lt,Object(g.a)(Object(g.a)({},e),{},{open:e.showDialog,onClose:function(){return e.setShowDialog(!1)}}))]})};Ft.displayName="ShareButton";var Bt=n(238),Ut=n.n(Bt),Vt=n(426),Jt=n.n(Vt),Gt=function(){var e=Object(p.b)((function(){return u.a.local.soundLocalizationBase})),t=Object(C.d)().t;return Object(_.jsx)(ve.a,{children:Object(_.jsxs)(le.a,{component:"label",container:!0,alignItems:"center",spacing:1,children:[Object(_.jsx)(le.a,{item:!0,children:t("slUser")}),Object(_.jsx)(le.a,{item:!0,children:Object(_.jsx)(ge.a,{checked:"avatar"===e,onChange:function(){u.a.local.soundLocalizationBase="avatar"===e?"user":"avatar",u.a.local.saveMediaSettingsToStorage()},name:"soundLoc"})}),Object(_.jsx)(le.a,{item:!0,children:t("slAvatar")})]})})};Gt.displayName="SoundLocalizationSetting";var Ht=function(e){var t=e.stores.participants,n=Object(p.b)((function(){return t.local.useStereoAudio})),o=m.a.useState(null),a=Object(i.a)(o,2),s=a[0],c=a[1],u=Object(C.d)().t;return Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(De,{size:e.size,title:Object(_.jsxs)(_.Fragment,{children:[r.t?u("headphoneL1Chrome"):u("headphoneL1")," ",Object(_.jsx)("br",{}),u("headphoneL2")]}),onClick:function(){t.local.useStereoAudio=!n,t.local.saveMediaSettingsToStorage()},color:n?"secondary":"primary",onClickMore:n?function(e){c(e.currentTarget)}:void 0,children:n?Object(_.jsx)(Ut.a,{style:{width:e.iconSize,height:e.iconSize}}):Object(_.jsx)(Jt.a,{style:{width:e.iconSize,height:e.iconSize}})}),Object(_.jsx)(J.a,{open:Boolean(s),onClose:function(){return c(null)},anchorEl:s,anchorOrigin:{vertical:"top",horizontal:"left"},anchorReference:"anchorEl",children:Object(_.jsxs)("div",{style:{padding:20},children:[u("soundLocalizationBasedOn")," ",Object(_.jsx)("br",{}),Object(_.jsx)(Gt,{})]})})]})};Ht.displayName="StereoAudioSwtich";var zt=Object(G.a)({container:{position:"absolute",width:"100%",bottom:0,padding:0,outline:"none",pointerEvents:"none"},wrapper:{width:"100%"},wrapperInner:{width:"100%",display:"flex",alignItems:"flex-end"}}),Qt=function e(){Object(b.a)(this,e),this.timeoutOut=void 0,this.touched=!1},Kt=function(e){var t=e.stores,n=t.map,o=t.participants,r=m.a.useState(!0),a=Object(i.a)(r,2),s=a[0],c=a[1],u=m.a.useState(!1),l=Object(i.a)(u,2),d=l[0],h=l[1],v=m.a.useState(!1),b=Object(i.a)(v,2),y=b[0],A=b[1];function E(e){e?n.keyInputUsers.add("shareDialog"):n.keyInputUsers.delete("shareDialog"),A(e)}var O=Object(f.useRef)(new Qt).current,S=Object(f.useRef)(null),j=Object(f.useRef)(null),T=Object(p.b)((function(){return{muteA:o.local.muteAudio,muteS:o.local.muteSpeaker,muteV:o.local.muteVideo,onStage:o.local.physics.onStage}})),k=m.a.useState([]),I=Object(i.a)(k,2),R=I[0],w=I[1],D=m.a.useState(null),N=Object(i.a)(D,2),L=N[0],G=N[1],H=m.a.useState(null),Q=Object(i.a)(H,2),Y=Q[0],q=Q[1],Z=m.a.useState(null),ee=Object(i.a)(Z,2),ne=ee[0],oe=ee[1],re=Object(C.d)().t,ae=zt();function se(){return n.screenSize[1]-(n.mouse[1]-n.offset[1])<90}var ce=Object(p.b)(se);function ue(e){var t;e?(c(!0),O.timeoutOut&&(clearTimeout(O.timeoutOut),O.timeoutOut=void 0),null===(t=S.current)||void 0===t||t.focus()):O.timeoutOut||(O.timeoutOut=setTimeout((function(){c(!1),O.timeoutOut=void 0}),500))}return Object(f.useEffect)((function(){se()&&(O.touched=!0),ue(ce||!O.touched)}),[ce,O.touched]),Object(f.useEffect)((function(){var e=function(e){0===n.keyInputUsers.size&&(e.ctrlKey||e.metaKey||e.altKey||("KeyM"===e.code&&(o.local.muteAudio=!o.local.muteAudio,ue(!0)),"KeyC"===e.code&&(ue(!0),E(!0),e.preventDefault(),e.stopPropagation()),"KeyL"!==e.code&&"Escape"!==e.code||(o.local.awayFromKeyboard=!0)))};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[]),m.a.useMemo((function(){function t(e,t){var n=!1;return"audioinput"===e.kind?n=e.deviceId===o.local.devicePreference.audioInputDevice:"audiooutput"===e.kind?n=e.deviceId===o.local.devicePreference.audioOutputDevice:"videoinput"===e.kind&&(n=e.deviceId===o.local.devicePreference.videoInputDevice),Object(_.jsxs)(V.a,{onClick:function(){t(e.deviceId)},children:[" ",(n?"\u2714\xa0":"\u2003")+e.label]},e.deviceId)}var i=[Object(_.jsx)(V.a,{children:Object(_.jsx)(be,Object(g.a)({},e))},"broadcast")],r=[],a=[];function c(e){e&&(o.local.devicePreference.audioInputDevice=e,o.local.saveMediaSettingsToStorage()),G(null)}function u(e){e&&(o.local.devicePreference.audioOutputDevice=e,o.local.saveMediaSettingsToStorage()),q(null)}function l(e){e&&(o.local.devicePreference.videoInputDevice=e,o.local.saveMediaSettingsToStorage()),oe(null)}R.forEach((function(e){if("audioinput"===e.kind){var n=i.pop();i.push(t(e,c)),i.push(n)}"audiooutput"===e.kind&&r.push(t(e,u)),"videoinput"===e.kind&&a.push(t(e,l))}));var p=e.height,f=e.height?.7*e.height:36;function m(e){navigator.mediaDevices.enumerateDevices().then(w).catch((function(){console.log("Device enumeration error")}))}function v(){n.keyInputUsers.delete("adminForm"),h(!1)}return Object(_.jsx)("div",{ref:S,className:ae.container,children:Object(_.jsxs)(B.a,{in:s,classes:ae,children:[Object(_.jsx)(Ht,Object(g.a)({size:p,iconSize:f},e)),Object(_.jsx)(we,{size:p,color:T.muteS?"primary":"secondary","aria-label":"speaker",onClick:function(){o.local.muteSpeaker=!T.muteS,o.local.muteSpeaker&&(o.local.muteAudio=!0),o.local.saveMediaSettingsToStorage()},onClickMore:function(e){m(),q(e.currentTarget)},children:T.muteS?Object(_.jsx)(te.a,{style:{width:f,height:f}}):Object(_.jsx)(ie.a,{style:{width:f,height:f}})}),Object(_.jsx)(U.a,{anchorEl:Y,keepMounted:!0,open:Boolean(Y),onClose:function(){u("")},children:r}),Object(_.jsx)(De,{size:p,color:T.muteA?"primary":"secondary","aria-label":"mic",title:M(re("ttMicMute")),onClick:function(){o.local.muteAudio=!T.muteA,o.local.muteAudio||(o.local.muteSpeaker=!1),o.local.saveMediaSettingsToStorage()},onClickMore:function(e){m(),G(e.currentTarget)},children:T.muteA?Object(_.jsx)(K.a,{style:{width:f,height:f}}):T.onStage?Object(_.jsx)(F.Icon,{icon:x.a,style:{width:f,height:f},color:"gold"}):Object(_.jsx)(z.a,{style:{width:f,height:f}})}),Object(_.jsx)(U.a,{anchorEl:L,keepMounted:!0,open:Boolean(L),onClose:function(){c("")},children:i}),Object(_.jsx)(we,{size:p,color:T.muteV?"primary":"secondary","aria-label":"camera",onClick:function(){o.local.muteVideo=!T.muteV,o.local.saveMediaSettingsToStorage()},onClickMore:function(e){m(),oe(e.currentTarget)},children:T.muteV?Object(_.jsx)($.a,{style:{width:f,height:f}}):Object(_.jsx)(X.a,{style:{width:f,height:f}})}),Object(_.jsx)(U.a,{anchorEl:ne,keepMounted:!0,open:Boolean(ne),onClose:function(){l("")},children:a}),Object(_.jsx)(Ft,Object(g.a)(Object(g.a)({},e),{},{size:p,iconSize:f,showDialog:y,setShowDialog:E})),Object(_.jsx)(P,Object(g.a)({},e)),Object(_.jsx)(we,{size:p,onClick:function(){n.keyInputUsers.add("adminForm"),h(!0)},divRef:j,style:{marginLeft:"auto",marginRight:10,opacity:.1},children:Object(_.jsx)(W.a,{style:{width:f,height:f}})}),Object(_.jsx)(J.a,{open:d,onClose:v,anchorEl:j.current,anchorOrigin:{vertical:"top",horizontal:"left"},anchorReference:"anchorEl",children:Object(_.jsx)(me,{close:v,stores:e.stores})})]})})}),[T.muteA,T.muteS,T.muteV,T.onStage,s,d,y,L,Y,ne,R])};Kt.displayName="Footer";var Yt=n(148),Wt=Object(G.a)({back:{position:"absolute",width:"100%",height:"100%",top:0,left:0,backgroundColor:"#DFDBE5"},fill:{position:"absolute",width:"100%",height:"100%",top:0,left:0}}),qt=Object(G.a)({resizerVertical:{background:"#000",zIndex:1,boxSizing:"border-box",backgroundClip:"padding-box",width:11,margin:"0 -10px 0 0",borderLeft:"1px solid gray",borderRight:"transparent 10px solid",cursor:"col-resize"},resizerHorizontal:{background:"gray",zIndex:1,boxSizing:"border-box",backgroundClip:"padding-box",height:10.5,margin:"-5px 0 -5px 0",borderTop:"5px transparent solid",borderBottom:"5px transparent solid",cursor:"row-resize"}}),Xt=Object(G.a)({container:{width:"100%"},title:function(e){return{fontSize:.8*e.fontSize,justifyContent:"start",justifyItems:"start",alignItems:"center",userSelect:"none",userDrag:"none",whiteSpace:"nowrap",width:"100%"}},outer:{display:"flex",whiteSpace:"nowrap",padding:0,margin:0,width:"100%"},line:function(e){return{display:"flex",justifyContent:"start",justifyItems:"start",alignItems:"center",userSelect:"none",userDrag:"none",whiteSpace:"nowrap",fontSize:e.fontSize,height:e.height,width:"100%",padding:0}}}),Zt=n(731);function $t(e){return{width:e.size,height:e.size,color:e.colors[1],backgroundColor:e.colors[0],pointerEvents:"none",userDrag:"none",fontSize:.3*e.size,display:"inline-block"}}var en=.92;function tn(e,t){var n={width:t.size*en,height:t.size*en,borderStyle:"solid",borderWidth:.04*t.size,borderColor:t.colors[0]};return Object.assign(e,n)}var nn=Object(G.a)({imageAvatar:function(e){var t=$t(e);return Object.assign(t,{textAlign:"right",verticalAlign:"top"}),e.border&&tn(t,e),t},textAvatar:function(e){var t=$t(e);return e.border&&tn(t,e),t}}),on=function(e){var t=nn(e);return Object(_.jsx)(p.a,{children:function(){var n="";e.avatarSrc||(e.name.split(" ").forEach((function(e){return n+=e?e.substring(0,1):""})),n=n.substring(0,2));var i=e.border?e.size*en:e.size;return e.avatarSrc?Object(_.jsx)(Zt.a,{src:e.avatarSrc,className:t.imageAvatar}):Object(_.jsx)(Zt.a,{className:t.textAvatar,children:Object(_.jsx)("div",{style:{height:i,width:i,textAlign:"center",verticalAlign:"middle",display:"table-cell",whiteSpace:"nowrap"},children:n})})}})};on.displayName="RawImageAvatar";var rn=function(e){return m.a.useMemo((function(){return Object(_.jsx)(on,Object(g.a)({},e))}),[e.avatarSrc,e.border,e.colors,e.name,e.size,e.style])};function an(e){var t=new Date(e),n=new Date,i=n.getFullYear()!==t.getFullYear()?t.getFullYear():void 0,o=i||n.getMonth()!==t.getMonth()?t.getMonth()+1:void 0,r=i||o||n.getDate()!==t.getDate()?t.getDate():void 0,a="".concat(t.getHours(),":").concat(t.getMinutes(),":").concat(t.getSeconds());return"".concat(i?"".concat(i,"."):"").concat(o?"".concat(o,"."):"").concat(r?"".concat(r," "):"").concat(a)}function sn(e,t){var n="",i="",o="";return t[1]?(o=n=t[1],i="_blank"):t[2]?(n=t[2],o=t[6]?t[6]:t[2],i=t[3]?"_self":"_blank"):(o=t[7],n=t[11],i=t[9]||t[10]?"_self":"_blank"),Object(r.x)(new URL(n))&&(i="_self"),Object(_.jsx)("a",{href:n,target:i,rel:"noreferrer",children:o},e)}function cn(e){for(var t,n=[],i="https?:\\/\\/[-_.!~*'()a-zA-Z0-9;/?:@&=+$,%#]+",o=new RegExp("(".concat(i,")|")+"\\[(".concat(i,")(( *>)|( +move))?\\s*(\\S+)\\]")+"|\\[(\\S+)((\\s*>)|(\\s+move)|\\s)\\s*(".concat(i,")\\]")),r=0;null!==(t=o.exec(e.slice(r)));){var a=e.slice(r,r+t.index);a&&n.push(Object(_.jsx)("span",{children:a},r)),n.push(sn(r+a.length,t)),r+=a.length+t[0].length}return n.push(Object(_.jsx)("span",{children:e.slice(r)},r)),n}rn.displayName="ImageAvatar";var un=n(432),ln=n.n(un),dn={text:"black",called:"red",callTo:"black",log:"black",private:"purple"},hn={text:"white",called:"red",callTo:"white",log:"white",private:"purple"},pn=function(e){var t="log"===e.message.type||"callTo"===e.message.type?.6:1,n=e.lineHeight*t,i=e.fontSize*t,o=e.stores,a=o.roomInfo,s=o.participants,c=o.map;return Object(_.jsx)(p.a,{children:function(){var t=an(e.message.timestamp),o=Object(r.v)(a.backgroundFill)?hn:dn,u=Object(r.v)(a.backgroundFill)?"rgba(0, 0, 0, 0.3)":"rgba(255, 255, 255, 0.3)";return Object(_.jsx)(ke.a,{title:"private"===e.message.type?Object(_.jsxs)(_.Fragment,{children:[Object(C.c)(e.message.pid===s.localId?"cmPrivateTo":"cmPrivateFrom",{name:e.message.name}),Object(_.jsx)("br",{}),t]}):Object(_.jsxs)(_.Fragment,{children:[e.message.name,Object(_.jsx)("br",{}),t]}),placement:"right",children:Object(_.jsxs)("div",{style:{display:"flex",wordWrap:"break-word",marginTop:2,fontSize:i,backgroundColor:u},children:[Object(_.jsx)("span",{style:{marginRight:"0.3em"},onClick:function(){var t=s.find(e.message.pid);t&&c.focusOn(t)},children:Object(_.jsx)(rn,{name:e.message.name,colors:e.message.colors,avatarSrc:e.message.avatarUrl,size:n,border:!0})}),Object(_.jsx)("span",{style:{color:o[e.message.type]},children:cn(e.message.text)})]})})}})};function fn(e,t,n){var i={msg:e,ts:Date.now(),to:t};Tt.a.conference.sendMessage(ae.b.CHAT_MESSAGE,i,t);var o=n.stores.participants.local;if(t){var r=n.stores.participants.remote.get(t);r&&a.b.addMessage(new a.a(e,o.id,r.information.name,o.information.avatarSrc,o.getColor(),Date.now(),"private"))}else a.b.addMessage(new a.a(e,o.id,o.information.name,o.information.avatarSrc,o.getColor(),Date.now(),"text"))}var mn=function(e){var t=e.stores,n=t.chat,o=t.roomInfo,a=t.participants,s=t.map,c=Xt({height:e.lineHeight,fontSize:e.fontSize}),u=m.a.useState(""),l=Object(i.a)(u,2),d=l[0],h=l[1];return Object(_.jsxs)("div",{className:c.container,style:{height:"100%",display:"flex",flexDirection:"column-reverse",overflowY:"auto",overflowX:"clip",whiteSpace:"pre-line"},children:[Object(_.jsxs)("form",{noValidate:!0,autoComplete:"off",children:[Object(_.jsx)(ke.a,{title:Object(C.c)("cmSend"),placement:"right",children:Object(_.jsx)("div",{style:{position:"relative",top:26,marginTop:-26,textAlign:"right",zIndex:1e3},children:Object(_.jsx)(ye.a,{size:"small",onClick:function(){var t,i,o=n.sendTo?null===a||void 0===a||null===(t=a.find(n.sendTo))||void 0===t||null===(i=t.information)||void 0===i?void 0:i.name:void 0;fn(d,o?n.sendTo:"",e),h("")},children:Object(_.jsx)(ln.a,{color:"primary"})})})}),Object(_.jsx)(p.a,{children:function(){var t,i,c=n.sendTo?null===a||void 0===a||null===(t=a.find(n.sendTo))||void 0===t||null===(i=t.information)||void 0===i?void 0:i.name:void 0,u=Object(r.v)(o.backgroundFill)?"white":"black";return Object(_.jsx)(k.a,{label:c?Object(C.c)("cmToName",{name:c}):Object(C.c)("cmToAll"),multiline:!0,value:d,style:{width:"100%",userSelect:"none"},size:e.lineHeight>20?"medium":"small",InputProps:{style:{color:u}},InputLabelProps:{style:{color:u}},onFocus:function(){s.keyInputUsers.add("chat")},onBlur:function(){s.keyInputUsers.delete("chat")},onKeyDown:function(e){"Escape"!==e.key&&"Esc"!==e.key||(n.sendTo="")},onKeyPress:function(t){"\n"===t.key&&(fn(d,c?n.sendTo:"",e),h(""))},onChange:function(e){h(e.target.value)}})}})]}),Object(_.jsx)("div",{children:Object(_.jsx)(p.a,{children:function(){return Object(_.jsx)(_.Fragment,{children:n.messages.map((function(t,n){return Object(_.jsx)(pn,Object(g.a)({message:t},e),n)}))})}})})]})};mn.displayName="Chat";var vn=n(69),gn=n(169),bn=n.n(gn),yn=n(242),An=n.n(yn),En="data:image/png;base64,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",On="data:image/png;base64,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",Sn=new function e(){Object(b.a)(this,e),this.useTransparent=!0},Cn=n(46),_n=n(433),jn=n(436),Tn=n.n(jn),kn=n(437),In=n.n(kn),Rn=n(441),wn=n.n(Rn),Dn=n(442),Nn=n.n(Dn),Pn=Object(G.a)({iframe:{width:"100%",height:"100%",pointerEvents:"none"},iframeEdit:{width:"100%",height:"100%"},iframeVScrool:function(e){return{width:e.content.size[0]+13+10,height:100*e.content.size[0],pointerEvents:"none"}},divScroll:function(e){return{width:e.content.size[0]+100,height:"100%",position:"relative",left:-15,overflow:"scroll"}},divClip:{width:"100%",height:"100%",overflow:"hidden"},divError:{width:"100%",height:"100%",overflow:"hidden",backgroundColor:"white"}});function Mn(e){var t=Object(Le.o)(e.params);t!==e.props.content.url&&e.props.updateAndSend&&(e.props.content.url=t,e.props.updateAndSend(e.props.content))}var Ln,xn,Fn,Bn,Un=function(e){Object(r.b)("gdrive"===e.content.type);var t=Object(f.useRef)(null),n=e.stores.contents,i=Object(Le.n)(e.content.url),o=i.get("id"),a=i.get("mimeType"),s=Object(f.useRef)({props:e,params:i,scrolling:!1,onscroll:function(){}}).current;s.props=e,s.params=i,!a&&o&&Object(Le.m)(o).then((function(t){(t.name&&e.content.name!==t.name||t.mimeType)&&(s.params.set("mimeType",t.mimeType),t.name&&(e.content.name=t.name),Mn(s))}));var c=Pn(e),u=Object(p.b)((function(){return e.stores.contents.editing===e.content.id})),l=Object(Le.l)(u,s.params);Object(f.useEffect)((function(){var e=Number(s.params.get("top"));u||s.scrolling||!t.current||isNaN(e)||e===t.current.scrollTop||(t.current.onscroll=function(){},t.current.scrollTop=e,setTimeout((function(){t.current&&(t.current.onscroll=s.onscroll)}),100))})),Object(f.useEffect)((function(){function i(){var e=Number(s.params.get("top"));t.current&&t.current.scrollTop!==e&&(s.params.set("top",t.current.scrollTop.toString()),Mn(s))}if(t.current){var o=config.bmRelayServer||n.localParticipant.myContents.has(e.content.id),r=100,a=o?It.a.throttle((function(){return setTimeout(i,r)}),r):It.a.debounce(i,r),c=It.a.debounce((function(){s.scrolling=!1}),r);s.onscroll=function(){s.scrolling=!0,a(),c()},t.current.onscroll=s.onscroll}}),[config.bmRelayServer?n.roomContents:n.localParticipant.myContents,e.content.id]);var d=Object(Le.p)(a);return Object(_.jsx)("div",{className:a?c.divClip:c.divError,children:a?Object(_.jsx)("div",{className:u||!d?c.divClip:c.divScroll,ref:t,onWheel:function(e){return e.ctrlKey||e.stopPropagation()},children:Object(_.jsx)("iframe",{src:l,title:e.content.url,className:u?c.iframeEdit:d?c.iframeVScrool:c.iframe})}):u?Object(_.jsx)("div",{className:c.divClip,onWheel:function(e){return e.ctrlKey||e.stopPropagation()},children:Object(_.jsx)("iframe",{src:l,title:e.content.url,className:c.iframeEdit})}):Object(_.jsx)("div",{style:{margin:"1em",whiteSpace:"pre-wrap"},children:Object(C.c)("gdFailed")})})},Vn=n(8),Jn=n(438),Gn=n.n(Jn),Hn=n(439),zn=n.n(Hn),Qn=n(215),Kn=n(248);Kn.GlobalWorkerOptions.workerSrc="https://cdn.jsdelivr.net/npm/pdfjs-dist@2.7.570/build/pdf.worker.js";var Yn=(Ln=function(){function e(){Object(b.a)(this,e),this.newProps=void 0,this.props=void 0,this.mainUrl=void 0,this.document=void 0,this.pages=[],this.renderTask=void 0,this.canvas=null,this.textDiv=null,this.annotationDiv=null,this.prevSize=[0,0],this.pageNum=0,Object(xe.a)(this,"numPages",xn,this),Object(xe.a)(this,"showTop",Fn,this),Object(xe.a)(this,"pageText",Bn,this),Object(Ve.g)(this)}return Object(Vn.a)(e,[{key:"render",value:function(){var e=this,t=this.pages[this.pageNum];if(this.canvas&&t){var n=t.getViewport({scale:1}),i=this.props.content;if(i.originalSize[0]!==n.width||i.originalSize[1]!==n.height)return i.originalSize=[n.width,n.height],i.size=[i.size[0],i.size[0]*i.originalSize[1]/i.originalSize[0]],this.props.updateOnly(this.props.content),!1;var o=3*this.props.content.size[0]/n.width,r=t.getViewport({scale:o});this.canvas.width=r.width,this.canvas.height=r.height;var a=this.canvas.getContext("2d");return a&&(this.renderTask&&this.renderTask.cancel(),this.renderTask=t.render({canvasContext:a,viewport:r}),this.renderTask.promise.then((function(){t.getTextContent().then((function(t){if(e.textDiv){var n=e.textDiv.childNodes;Array.from(n.values()).forEach((function(e){return e.remove()}));var i=[];Object(Kn.renderTextLayer)({textContent:t,container:e.textDiv,viewport:r,textDivs:i}),i.forEach((function(e){e.style.position="absolute",e.style.color="transparent",e.style.whiteSpace="pre",e.style.transformOrigin="0% 0%",e.style.whiteSpace="nowrap",e.style.verticalAlign="top"}))}})),e.renderTask=void 0})).catch((function(e){}))),!0}return!1}},{key:"updateProps",value:function(){var e=this;if(this.newProps!==this.props){this.props=this.newProps;var t=new URL(this.props.content.url);this.mainUrl=t.hash?t.href.substring(0,t.href.length-t.hash.length):t.href;var n,i=this.pageNum;if("#page="===t.hash.substr(0,6))(i=null!==(n=Number(t.hash.substr(6))-1)&&void 0!==n?n:0)<0&&(i=0),this.numPages&&i>=this.numPages&&(i=this.numPages-1);this.document&&i===this.pageNum?this.prevSize[0]===this.props.content.size[0]&&this.prevSize[1]===this.props.content.size[1]||this.render()&&(this.prevSize=Array.from(this.props.content.size)):(this.getPage(i).then((function(){e.render()})),this.pageNum=i,this.pageText=String(i+1))}}},{key:"getDocument",value:function(){var e=this;return new Promise((function(t,n){e.document?t(e.document):Object(Kn.getDocument)({url:Object(Qn.a)(e.mainUrl),cMapUrl:"https://cdn.jsdelivr.net/npm/pdfjs-dist@2.7.570/cmaps/",cMapPacked:!0}).promise.then((function(n){e.document=n,e.numPages=n.numPages,t(e.document)})).catch((function(t){console.error("PDF: failed to load ".concat(e.mainUrl)),n(t)}))}))}},{key:"getPage",value:function(e){var t=this;return new Promise((function(n,i){t.pages[e]?n(t.pages[e]):t.getDocument().then((function(o){o.getPage(e+1).then((function(i){t.pages[e]=i,n(t.pages[e])})).catch((function(e){i(e)}))})).catch((function(e){i(e)}))}))}},{key:"updateUrl",value:function(e){void 0!==e&&Number.isFinite(e)||(e=this.pageNum),e<0&&(e=0),e>=this.numPages&&(e=this.numPages-1);var t="".concat(this.mainUrl,"#page=").concat(e+1);if(t!==this.props.content.url){var n=Object.assign({},this.props.content);n.url=t,this.props.updateAndSend(n)}}}]),e}(),xn=Object(Fe.a)(Ln.prototype,"numPages",[Ve.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Fn=Object(Fe.a)(Ln.prototype,"showTop",[Ve.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Bn=Object(Fe.a)(Ln.prototype,"pageText",[Ve.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ln),Wn={onMouseDown:function(e){e.stopPropagation()},onMouseUp:function(e){e.stopPropagation()},onPointerDown:function(e){e.stopPropagation()},onPointerUp:function(e){e.stopPropagation()}},qn=function(e){Object(r.b)("pdf"===e.content.type);var t=Object(f.useRef)(new Yn).current;t.newProps=e;var n=Object(f.useRef)(null),i=Object(f.useRef)(null),o=Object(f.useRef)(null),a=Object(p.b)((function(){return e.stores.contents.editing===e.content.id}));return Object(f.useEffect)((function(){t.canvas=n.current,t.textDiv=i.current,t.annotationDiv=o.current}),[n.current]),Object(f.useEffect)((function(){t.updateProps()})),Object(_.jsxs)("div",{style:{overflow:"hidden",pointerEvents:"auto",userSelect:a?"text":"none"},onDoubleClick:function(t){a||(t.stopPropagation(),t.preventDefault(),e.stores.contents.setEditing(e.content.id))},children:[Object(_.jsx)("canvas",{style:{width:"".concat(300,"%"),height:"".concat(300,"%"),transformOrigin:"top left",transform:"scale(".concat(1/3,")")},ref:n}),Object(_.jsx)("div",{ref:i,style:{position:"absolute",left:0,top:0,width:"".concat(300,"%"),height:"".concat(300,"%"),transformOrigin:"top left",transform:"scale(".concat(1/3,")"),lineHeight:1,overflow:"hidden"}}),Object(_.jsx)("div",{ref:o}),Object(_.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:40},onPointerEnter:function(){t.showTop=!0},onPointerLeave:function(){t.showTop=!1},children:Object(_.jsx)(p.a,{children:function(){return Object(_.jsx)(B.a,{in:t.showTop,style:{position:"absolute",top:0,left:0,width:"100%"},children:Object(_.jsxs)(le.a,{container:!0,alignItems:"center",children:[Object(_.jsx)(le.a,{item:!0,children:Object(_.jsx)(ye.a,Object(g.a)(Object(g.a)({size:"small",color:t.pageNum>0?"primary":"default"},Wn),{},{onClick:function(e){e.stopPropagation(),t.updateUrl(t.pageNum-1)},onDoubleClick:function(e){e.stopPropagation()},children:Object(_.jsx)(Gn.a,{})}))}),Object(_.jsx)(le.a,{item:!0,xs:1,children:Object(_.jsx)(k.a,Object(g.a)(Object(g.a)({value:t.pageText},Wn),{},{inputProps:{min:0,style:{textAlign:"center"}},onChange:function(e){t.pageText=e.target.value},onBlur:function(e){var n=Number(t.pageText);n>0&&t.updateUrl(n-1)},onKeyPress:function(e){if("Enter"===e.key){var n=Number(t.pageText);n>0&&t.updateUrl(n-1)}}}))}),Object(_.jsxs)(le.a,{item:!0,style:{fontSize:15},children:["/ ",t.numPages]}),Object(_.jsx)(le.a,{item:!0,children:Object(_.jsx)(ye.a,Object(g.a)(Object(g.a)({size:"small",color:t.pageNum<t.numPages-1?"primary":"default"},Wn),{},{onClick:function(e){e.stopPropagation(),t.updateUrl(t.pageNum+1)},onDoubleClick:function(e){e.stopPropagation()},children:Object(_.jsx)(zn.a,{})}))})]})})}})})]})},Xn=Object(G.a)({video:{width:"100%",height:"100%"}}),Zn=function(e){Object(r.b)("screen"===e.content.type||"camera"===e.content.type);var t=Xn(),n=Object(f.useRef)(null),o=m.a.useState(!1),a=Object(i.a)(o,2),s=a[0],c=a[1],u=Object(f.useRef)({});u.current={locals:Object(p.b)((function(){return Array.from(h.c.tracks.localContents.get(e.content.id)||[])})),remotes:Object(p.b)((function(){return Array.from(h.c.tracks.remoteContents.get(e.content.id)||[])})),content:e.content},u.current.locals.length>2&&console.error("content ".concat(e.content.id," has ").concat(u.current.locals.length," local tracks"),u.current.locals),u.current.remotes.length>2&&console.error("content ".concat(e.content.id," has ").concat(u.current.remotes.length," remote tracks"),u.current.remotes);var l=[];function d(){if(u.current.locals.length&&n.current){var t=n.current.srcObject instanceof MediaStream&&n.current.srcObject.getTracks();if(t&&t.length){var i=t.find((function(e){return"video"===e.kind})),o=null===i||void 0===i?void 0:i.getSettings(),a=[(null===o||void 0===o?void 0:o.width)||0,(null===o||void 0===o?void 0:o.height)||0];if(a[0]&&u.current.content.originalSize.toString()!==a.toString()){if(u.current.content.originalSize[0]){var s=u.current.content.originalSize[0]/a[0],c=u.current.content.originalSize[1]/a[1];if(s===c&&l.find((function(e){return e===s})))return}var d=u.current.content.size[0]/(u.current.content.originalSize[0]?u.current.content.originalSize[0]:a[0]);u.current.content.originalSize=a,u.current.content.size=Object(r.B)(d,a),e.updateAndSend(u.current.content)}}}}return Object(f.useEffect)((function(){!function(){if(Object(r.b)(0===u.current.locals.length||0===u.current.remotes.length),n.current){var e=new MediaStream;u.current.locals.forEach((function(t){"audio"!==t.getType()&&e.addTrack(t.getTrack())})),u.current.remotes.forEach((function(t){if("audio"!==t.getType()){e.addTrack(t.getTrack());var n=It.a.debounce((function(){c(!0)}),3e3);t.getTrack().onmute=n,t.getTrack().onunmute=function(){n.cancel(),c(!1)}}}));var t=n.current.srcObject instanceof MediaStream&&n.current.srcObject.getTracks(),i=e.getTracks();i.length&&(It.a.isEqual(t,i)||(console.log("prev-next:",t,i),n.current.srcObject=e,n.current.autoplay=!0))}}()}),[u.current.locals,u.current.remotes]),Object(f.useEffect)((function(){var e=setInterval(d,333);return function(){return clearInterval(e)}})),Object(_.jsx)("video",{className:t.video,style:s?{filter:"brightness(80%) sepia(25%)"}:{},ref:n})},$n=function e(){Object(b.a)(this,e),this.messages=[],this.isStatic=!1,this.abortScroll=!1,this.editing=!1};function ei(e,t,n){var i={messages:e,scroll:[t.scrollLeft,t.scrollTop]},o=JSON.stringify(i);n.content.url!==o&&n.updateAndSend&&(n.content.url=o,n.updateAndSend(n.content))}function ti(e,t){t.text.message=e;var n=t.member.messages.filter((function(e){return e.message.length}));t.div&&ei(n,t.div,t)}var ni=function(e){var t=m.a.useState(e.text.message),n=Object(i.a)(t,2),o=n[0],r=n[1],a=Object(f.useRef)(void 0);Object(f.useEffect)((function(){a.current=It.a.throttle(ti,1e3,{leading:!1})}),[]);var s=a.current;return Object(_.jsx)(p.a,{children:function(){return Object(_.jsxs)("div",{style:Object(g.a)(Object(g.a)({},e.css),{},{position:"relative",margin:0,border:0,padding:0,backgroundColor:"none"}),children:[Object(_.jsx)("div",{style:Object(g.a)(Object(g.a)({},e.css),{},{color:"red",position:"relative",width:"100%",overflow:"hidden",visibility:"hidden"}),children:o+"\u200b"}),Object(_.jsx)("textarea",{value:o,autoFocus:e.autoFocus,style:Object(g.a)(Object(g.a)({},e.css),{},{font:"inherit",verticalAlign:"baseline",resize:"none",position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",letterSpacing:"inherit",overflow:"hidden"}),onChange:function(t){r(t.currentTarget.value),s&&s(t.currentTarget.value,e)},onBlur:function(){s&&s.cancel(),ti(o,e)},onFocus:function(){},onKeyDown:function(t){"Escape"!==t.key&&"Esc"!==t.key||(t.stopPropagation(),t.preventDefault(),s&&s.cancel(),ti(o,e),e.stores.contents.setEditing(""))}})]})}})},ii=function(e){var t,n,i=an(e.text.time),o=(null===(t=e.text.color)||void 0===t?void 0:t.length)?e.text.color:Object(r.p)(e.text.name),a=(null===(n=e.text.textColor)||void 0===n?void 0:n.length)?e.text.textColor:Object(r.m)(o),s={color:Object(r.H)(a,1),backgroundColor:Sn.useTransparent?Object(r.H)(o,.5):Object(r.H)(o,1),padding:"0.1em",fontSize:16,lineHeight:1.2,width:"100%",overflow:"clip",boxSizing:"border-box",whiteSpace:"pre-wrap",wordWrap:"break-word",overflowWrap:"break-word"},c=Object(Pt.a)(s,["backgroundColor"]);return c.backgroundColor=Object(r.H)(o,1),Object(_.jsx)(ke.a,{title:Object(_.jsxs)(m.a.Fragment,{children:[e.text.name," ",Object(_.jsx)("br",{})," ",i]}),placement:"left",arrow:!0,suppressContentEditableWarning:!0,children:Object(_.jsx)("div",{children:e.textEditing?Object(_.jsx)(ni,Object(g.a)(Object(g.a)({},e),{},{css:c})):Object(_.jsx)("div",{style:s,onPointerDown:function(){e.member.isStatic=!0},onPointerMove:function(){e.member.isStatic=!1},onPointerUp:function(t){if(e.member.isStatic){var n=t.target;if(n instanceof Node){t.preventDefault();var i=window.getSelection();if(i)if(i.rangeCount&&i.getRangeAt(0).toString())i.removeAllRanges();else{var o=document.createRange();o.selectNode(n),i.removeAllRanges(),i.addRange(o)}}}},children:e.textToShow})})})},oi={height:"100%",width:"100%",whiteSpace:"pre-line",pointerEvents:"auto",overflowY:"auto",overflowX:"visible",wordWrap:"break-word"},ri=Object(G.a)({text:oi,textEdit:Object(g.a)(Object(g.a)({},oi),{},{cursor:"default",userSelect:"text"})}),ai=function(e){Object(r.b)("text"===e.content.type);var t=e.stores,n=t.contents,i=t.participants,o=m.a.useRef(new $n).current,a=ri(),s=Object(f.useRef)(null),c=e.content.url,u=JSON.parse(c),l=Object(p.b)((function(){return n.editing===e.content.id}));l&&n.setBeforeChangeEditing((function(t,i){t===e.content.id&&""===i&&(s.current&&(o.messages=o.messages.filter((function(e){return e.message.length})),ei(o.messages,s.current,e)),n.setBeforeChangeEditing())})),Object(f.useEffect)((function(){var e;!l&&s.current&&(s.current.scrollLeft===u.scroll[0]&&s.current.scrollTop===u.scroll[1]||(o.abortScroll=!0,null===(e=s.current)||void 0===e||e.scroll(u.scroll[0],u.scroll[1])))}),[u.scroll[0],u.scroll[1],l]);var d=new Set;u.messages.forEach((function(e){var t=o.messages.findIndex((function(t){return t.pid===e.pid&&t.time===e.time}));-1===t?(d.add(o.messages.length),o.messages.push(e)):e.pid!==i.localId&&(d.add(t),o.messages[t]=e)})),o.messages=o.messages.filter((function(e,t){return e.pid===i.localId||d.has(t)})),o.messages.sort(Cn.e);var h=void 0;if(l){var v=o.messages.pop();v&&o.messages.push(v),(null===v||void 0===v?void 0:v.pid)!==i.localId&&o.messages.push({message:"",pid:i.localId,name:i.local.information.name,color:i.local.information.color,textColor:i.local.information.textColor,time:Date.now()}),o.editing||(o.messages.reverse(),h=o.messages.find((function(e){return e.pid===i.localId})),o.messages.reverse())}var b=o.messages.map((function(t,n){var r=l&&(t.pid===i.localId||!i.remote.has(t.pid)),a=[];return r||(a=cn(t.message)),Object(f.createElement)(ii,Object(g.a)(Object(g.a)({},e),{},{key:n,text:t,div:s.current,textToShow:a,member:o,textEditing:r,autoFocus:t===h}))})),y=It.a.debounce((function(t){s.current&&(o.abortScroll?o.abortScroll=!1:ei(o.messages,s.current,e))}),200);return o.editing=l,Object(_.jsx)("div",{ref:s,className:l?a.textEdit:a.text,onWheel:function(e){return e.ctrlKey||e.stopPropagation()},onScroll:function(e){l||y(e)},children:b})},si=n(54),ci=n(91);function ui(e,t){var n=e;n.setSinkId&&n.setSinkId(t).then((function(){})).catch((function(){console.warn("audio.setSinkId:",t," failed")}))}var li,di,hi,pi,fi,mi,vi,gi,bi,yi=1e5,Ai=function(){function e(t,n,i,o){Object(b.a)(this,e),this.sourceNode=void 0,this.audioElement=void 0,this.audioElementForBlob=void 0,this.gainNode=void 0,this.pannerNode=void 0,this.destination=void 0,this.context=void 0,this.playMode=void 0,this.audioDeviceId="",this.distance=1,this.interval=void 0,this._defaultPannerRefDistance=si.a,this.audibility=!1,this.context=t,this.destination=n,this.gainNode=this.createGainNode(t),this.pannerNode=this.createPannerNode(t),this.gainNode.connect(this.pannerNode),this.pannerNode.connect(this.destination),this.playMode=i,this.updateAudibility(o)}return Object(Vn.a)(e,[{key:"setPlayMode",value:function(e){var t=this;switch(this.playMode=e,e){case"Pause":var n;null===(n=this.sourceNode)||void 0===n||n.disconnect(),this.interval&&(clearInterval(this.interval),this.interval=void 0),this.audioElement&&this.audioElement.pause();break;case"Context":var i;null===(i=this.sourceNode)||void 0===i||i.connect(this.gainNode),this.interval&&(clearInterval(this.interval),this.interval=void 0),this.audioElement&&this.audioElement.pause();break;case"Element":var o;null===(o=this.sourceNode)||void 0===o||o.disconnect(),this.audioElement||(this.audioElement=this.createAudioElement()),this.audioElement.muted=!1,this.interval||(this.interval=setInterval((function(){var e;s.a.type||(null===t||void 0===t||null===(e=t.audioElement)||void 0===e||e.play().then((function(){t.interval&&(clearInterval(t.interval),t.interval=void 0)})).catch((function(e){})))}),500));break;default:console.error("Unknown output: ".concat(e))}this.updateAudibility(this.audibility),this.updateVolume()}},{key:"setAudioOutput",value:function(e){this.audioDeviceId!==e&&(this.audioDeviceId=e,this.audioElement&&ui(this.audioElement,this.audioDeviceId))}},{key:"updateStream",value:function(e){this.updateSourceStream(e),this.setPlayMode(this.playMode)}},{key:"playBlob",value:function(e){this.playSourceBlob(e),this.setPlayMode(this.playMode)}},{key:"updatePose",value:function(e){var t,n,i=Object(ci.k)(e.position),o=(i*i/(this.pannerNode.refDistance*this.pannerNode.refDistance)+this.pannerNode.refDistance-1)/(i||1);(this.distance=o*i,this.pannerNode.positionX&&this.pannerNode.orientationX)?(this.pannerNode.positionX.setValueAtTime(o*e.position[0],this.context.currentTime),this.pannerNode.positionY.setValueAtTime(o*e.position[1],this.context.currentTime),this.pannerNode.positionZ.setValueAtTime(o*e.position[2],this.context.currentTime),this.pannerNode.orientationX.setValueAtTime(e.orientation[0],this.context.currentTime),this.pannerNode.orientationY.setValueAtTime(e.orientation[1],this.context.currentTime),this.pannerNode.orientationZ.setValueAtTime(e.orientation[2],this.context.currentTime)):((t=this.pannerNode).setPosition.apply(t,Object(vn.a)(Object(ci.j)(o,e.position))),(n=this.pannerNode).setOrientation.apply(n,Object(vn.a)(e.orientation)));this.updateVolume()}},{key:"updateVolume",value:function(){var e=0;"Element"===this.playMode&&(e=Math.pow(Math.max(this.distance,this.pannerNode.refDistance)/this.pannerNode.refDistance,-this.pannerNode.rolloffFactor)),this.audioElement&&(this.audioElement.volume=e)}},{key:"defaultPannerRefDistance",get:function(){return this._defaultPannerRefDistance},set:function(e){this._defaultPannerRefDistance=e,this.pannerNode.refDistance!==yi&&(this.pannerNode.refDistance=this._defaultPannerRefDistance)}},{key:"updateBroadcast",value:function(e){this.pannerNode.refDistance=e?yi:this.defaultPannerRefDistance}},{key:"updatePannerConfig",value:function(e){var t=this;["coneInnerAngle","coneOuterAngle","coneOuterGain","distanceModel","maxDistance","distanceModel","panningModel","refDistance","rolloffFactor"].forEach((function(n){"refDistance"===n?t.defaultPannerRefDistance=e.refDistance:t.pannerNode[n]=e[n]}))}},{key:"updateAudibility",value:function(e){e?this.gainNode.connect(this.pannerNode):this.gainNode.disconnect(),this.audioElement&&(this.audioElement.muted=!e),this.audibility=e}},{key:"disconnect",value:function(){this.sourceNode&&this.sourceNode.disconnect(),this.gainNode.disconnect(),this.pannerNode.disconnect(),this.audioElement&&(this.audioElement.volume=0,this.audioElement.pause(),this.audioElement.remove())}},{key:"isBroadcast",get:function(){return this.pannerNode.refDistance===yi}},{key:"createGainNode",value:function(e){var t=e.createGain();return t.gain.value=1,t}},{key:"createPannerNode",value:function(e){return e.createPanner()}},{key:"updateSourceStream",value:function(e){this.sourceNode&&this.sourceNode.disconnect(),void 0!==e?(this.sourceNode=this.context.createMediaStreamSource(e),void 0===this.audioElement&&(this.audioElement=this.createAudioElement()),this.audioElement.srcObject=e):this.sourceNode=void 0}},{key:"playSourceBlob",value:function(e){this.sourceNode&&this.sourceNode.disconnect(),void 0!==e?(this.audioElementForBlob||(this.audioElementForBlob=this.createAudioElement()),this.audioElementForBlob.src=URL.createObjectURL(e),this.sourceNode=this.context.createMediaElementSource(this.audioElementForBlob),function e(t){var n;null===(n=t.audioElementForBlob)||void 0===n||n.play().catch((function(){setTimeout((function(){return e(t)}),500)}))}(this)):this.sourceNode=void 0}},{key:"createAudioElement",value:function(){var e=new Audio;return ui(e,this.audioDeviceId),e}}]),e}(),Ei=12*si.a,Oi=new(li=function(){function e(){Object(b.a)(this,e),Object(xe.a)(this,"coneInnerAngle",di,this),Object(xe.a)(this,"coneOuterAngle",hi,this),Object(xe.a)(this,"coneOuterGain",pi,this),Object(xe.a)(this,"maxDistance",fi,this),Object(xe.a)(this,"panningModel",mi,this),Object(xe.a)(this,"distanceModel",vi,this),Object(xe.a)(this,"refDistance",gi,this),Object(xe.a)(this,"rolloffFactor",bi,this),this.refDistanceNormal=this.refDistance,Object(Ve.g)(this)}return Object(Vn.a)(e,[{key:"hearableRange",get:function(){return 100*this.refDistance/Ei}},{key:"setHearableRange",value:function(e){this.refDistanceNormal=e/100*Ei;var t=u.a.local.physics.onStage;this.setBroadcast(t)}},{key:"setBroadcast",value:function(e){this.refDistance=e?99999:this.refDistanceNormal}},{key:"updateParameters",value:function(e){Object.assign(this,e)}}]),e}(),di=Object(Fe.a)(li.prototype,"coneInnerAngle",[Ve.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hi=Object(Fe.a)(li.prototype,"coneOuterAngle",[Ve.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 180}}),pi=Object(Fe.a)(li.prototype,"coneOuterGain",[Ve.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),fi=Object(Fe.a)(li.prototype,"maxDistance",[Ve.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e4}}),mi=Object(Fe.a)(li.prototype,"panningModel",[Ve.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"HRTF"}}),vi=Object(Fe.a)(li.prototype,"distanceModel",[Ve.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"exponential"}}),gi=Object(Fe.a)(li.prototype,"refDistance",[Ve.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5*si.a}}),bi=Object(Fe.a)(li.prototype,"rolloffFactor",[Ve.h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 38}}),Object(Fe.a)(li.prototype,"hearableRange",[Ve.d],Object.getOwnPropertyDescriptor(li.prototype,"hearableRange"),li.prototype),Object(Fe.a)(li.prototype,"setHearableRange",[Ve.b],Object.getOwnPropertyDescriptor(li.prototype,"setHearableRange"),li.prototype),Object(Fe.a)(li.prototype,"setBroadcast",[Ve.b],Object.getOwnPropertyDescriptor(li.prototype,"setBroadcast"),li.prototype),Object(Fe.a)(li.prototype,"updateParameters",[Ve.b],Object.getOwnPropertyDescriptor(li.prototype,"updateParameters"),li.prototype),li),Si=Oi;Object(Ve.c)((function(){var e=u.a.local.physics.onStage;Oi.setBroadcast(e)}));var Ci=n(440),_i=n.n(Ci),ji=.1;function Ti(){return.001*Date.now()}var ki=Object(G.a)({iframe:{width:"100%",height:"100%"}}),Ii=function e(){Object(b.a)(this,e),this.player=void 0,this.goal="",this.skipOnPlaying=0,this.pauseIntervalTimer=0,this.lastCurrentTimePaused=0,this.playTimeout=0,this.pauseTimeout=0,this.params=new Map,this.editing=!1,this.prevRelPos=[0,0],this.volumeUI=.5,this.volumeDist=0,this.prevVolumeDist=0,this.volumeIntervalTimer=0,this.props=void 0};function Ri(e){return function(e){return new Map(e.map((function(e){return e.split("=")})))}(e.split("&"))}function wi(e){e.playTimeout&&(clearTimeout(e.playTimeout),e.playTimeout=0),e.pauseTimeout&&(clearTimeout(e.pauseTimeout),e.pauseTimeout=0)}function Di(e,t,n){Object(r.b)(n.player),n.goal="playing",wi(n);var i=(Ti()-e)*n.player.getPlaybackRate();if("playing"!==n.player.getState()||0!==n.player.getPlaylist().length&&n.player.getPlaylistIndex()!==t||!(Math.abs(n.player.getCurrentTime()-i)<ji)){var o=-1e3;!function r(){if(n.player){var a=n.player.getCurrentTime();if("paused"===n.player.getState()&&Math.abs(o-a)<ji)return n.player.play(),void Object(h.b)("ytSeekAndPlay: ".concat(n.player.getState(),"  ")+"cur:".concat(n.player.getCurrentTime(),"  toSeek:").concat(i),n.params);var s=Ti();i=(s-e)*n.player.getPlaybackRate();o=i+1*n.player.getPlaybackRate();var c=n.player.getDuration();"unstarted"!==n.player.getState()&&c||(n.skipOnPlaying=1,n.player.play(),c=n.player.getDuration()),t>=0&&t!==n.player.getPlaylistIndex()&&(n.skipOnPlaying=1,n.player.playVideoAt(t),c=n.player.getDuration()),c&&(n.player.pause(),o>c&&(e=s+1-(o%=c)/n.player.getPlaybackRate()),n.player.seek(o)),n.playTimeout=setTimeout(r,1e3)}}()}}function Ni(e,t){Object(r.b)(t.player),t.goal="paused",wi(t);!function n(){if(t.player){var i=t.params.get("index"),o=Number(i||-1);if("paused"!==t.player.getState()||o>=0&&o!==t.player.getPlaylistIndex())return"unstarted"===t.player.getState()&&t.player.play(),o>=0&&o!==t.player.getPlaylistIndex()&&t.player.playVideoAt(o),t.player.pause(),void(t.pauseTimeout=setTimeout(n,333));t.player.getCurrentTime()!==e&&(t.player.seek(e),Object(h.b)("ytSeekAndPause seek to ".concat(e),t.params)),t.lastCurrentTimePaused=t.player.getCurrentTime()}}()}function Pi(e,t,n){var i,o,r;(r=n.params).delete("playing"),r.delete("paused"),r.delete("ended"),n.params.set(e,String(t)),n.params.set("rate",String(null===(i=n.player)||void 0===i?void 0:i.getPlaybackRate()));var a=null===(o=n.player)||void 0===o?void 0:o.getPlaylistIndex();n.params.set("index",String(a||-1)),n.props.content.url=function(e){var t,n="",i="",o=Object(oe.a)(e);try{for(o.s();!(t=o.n()).done;){var r=t.value;n+="".concat(i).concat(r[0],"=").concat(r[1]),i="&"}}catch(a){o.e(a)}finally{o.f()}return n}(n.params),n.props.updateAndSend(n.props.content),Object(h.b)("YT SEND state ".concat(e," t=").concat(t),n.params)}function Mi(e){if(e.player){var t=e.player.getState();if(e.editing||""!==e.goal||"paused"!==t)e.pauseIntervalTimer&&(clearInterval(e.pauseIntervalTimer),e.pauseIntervalTimer=0);else{var n=e.player.getCurrentTime();if(Object(h.b)("YT ytPauseInterval cur:".concat(n,", last:").concat(e.lastCurrentTimePaused," param").concat(e.params.get("paused"))),Math.abs(n-e.lastCurrentTimePaused)>ji)e.lastCurrentTimePaused=n,n!==Number(e.params.get("paused"))&&Pi("paused",n,e)}}}function Li(e,t){t.player&&(t.volumeDist=function(e){var t=(e*e/(Oi.refDistance*Oi.refDistance)+Oi.refDistance-1)/(e||1)*e;return Math.pow(Math.max(t,Oi.refDistance)/Oi.refDistance,-Oi.rolloffFactor)}(e),t.player.setVolume(t.volumeUI*t.volumeDist*100))}function xi(e){if(e.props.stores.participants){!function(e){if(e.player){if(1===e.volumeDist&&1===e.prevVolumeDist){var t=e.player.getVolume()/100;t!==e.volumeUI&&(e.volumeUI=t)}else e.player.setVolume(e.volumeUI*e.volumeDist*100);e.prevVolumeDist=e.volumeDist}}(e);var t=Object(r.O)(e.props.content.pose.position,e.props.stores.participants.local.pose.position),n=Object(r.O)(t,e.prevRelPos);if(Object(r.C)(n)>.1*si.a){e.prevRelPos=[t[0],t[1]];for(var i=0;i<2;i++)t[i]<0&&(t[i]+=e.props.content.size[i],t[i]>0&&(t[i]=0));Li(Object(r.C)(t),e)}}}var Fi=function(e){Object(r.b)("youtube"===e.content.type);var t=ki(),n=Object(f.useRef)(new Ii).current;n.props=e;var i=Object(p.b)((function(){return e.stores.contents.editing===e.content.id})),o=n.params;if(n.params=Ri(e.content.url),!i&&(n.editing||!Object(r.L)(n.params,o))&&n.player){n.params.get("rate")!==o.get("rate")&&n.player.setPlaybackRate(Number(n.params.get("rate")));var a=n.params.get("playing"),s=void 0!==a&&a!==o.get("playing"),c=n.params.get("paused"),u=void 0!==c&&c!==o.get("paused");s?(Object(h.b)("YT render move to play=".concat(a," state")),Di(Number(n.params.get("playing")),Number(n.params.get("index")),n)):u&&(Object(h.b)("YT render move to pause=".concat(c," state")),Ni(Number(n.params.get("paused")),n))}return n.editing=i,Object(f.useEffect)((function(){Object(r.b)(e.content.id);var t=!1;if(!n.player){var i="#YT".concat(e.content.id),o=new _i.a(i);n.params.has("playing")||n.params.has("paused")||n.params.has("ended")||(t=!0,n.params.set("playing",String(-1)),o.play()),n.player=o,Object(h.b)("YTPlayer for ".concat(i," created")),n.params.has("rate")&&o.setPlaybackRate(Number(n.params.get("rate"))),n.editing||(n.params.has("paused")?Ni(Number(n.params.get("paused")),n):!t&&n.params.has("playing")&&Di(Number(n.params.get("playing")),Number(n.params.get("index")),n)),o.on("error",(function(e){return Object(h.b)("YT on error ",e)})),o.on("buffering",(function(){return Object(h.b)("YT on buffering")})),o.on("cued",(function(){return Object(h.b)("YT on cued")})),o.on("unstarted",(function(){Object(h.b)("YT on unstarted"),o.unMute()})),o.on("ended",(function(){(Object(h.b)("YT on ended"),n.player)&&Di(Ti(),0,n)})),o.on("paused",(function(){Object(h.b)("YT on paused at ".concat(o.getCurrentTime()," goal:").concat(n.goal),n.params),"paused"===n.goal?n.goal="":""===n.goal?n.params.has("paused")||setTimeout((function(){n.params.has("paused")||n.params.has("playing")||"paused"!==o.getState()||Pi("paused",o.getCurrentTime(),n)}),1e3):Object(h.b)("paused for goal ".concat(n.goal)),""!==n.goal||n.pauseIntervalTimer||(n.pauseIntervalTimer=setInterval(Mi,333,n))})),o.on("playing",(function(){Object(h.b)("YT on playing goal=".concat(n.goal," skip=").concat(n.skipOnPlaying),n.params);var e=!1;if(o.getPlaylist().length>0&&o.getPlaylistIndex()!==Number(n.params.get("index"))&&(n.params.set("index",String(o.getPlaylistIndex())),e=!0),"playing"===n.goal)n.skipOnPlaying?n.skipOnPlaying=0:n.goal="";else if(""===n.goal){var t=Ti()-o.getCurrentTime()/o.getPlaybackRate(),i=Number(n.params.get("playing"));-1===i&&(i=t);var r=t-i;(!n.params.has("playing")||e||Math.abs(r)>ji)&&Pi("playing",t,n)}})),o.on("playbackRateChange",(function(){Object(h.b)("YT on playbackRateChange");var e=Ti()-o.getCurrentTime()/o.getPlaybackRate(),t=o.getState();Pi("paused"===t?"paused":"playing"===t?"playing":"ended",e,n)}))}var a=n.player;return a&&(n.params.has("list")?(a.loadList({listType:"playlist",list:n.params.get("list")}),Object(h.b)("YT loadList: ".concat(n.params.get("list")))):n.params.has("v")&&(a.load(n.params.get("v")),Object(h.b)("YT load: ".concat(n.params.get("v"))))),n.volumeIntervalTimer||(n.volumeIntervalTimer=setInterval(xi,200,n)),function(){n.player&&n.player.destroy(),n.player=void 0,n.volumeIntervalTimer&&clearInterval(n.volumeIntervalTimer)}}),[]),Object(_.jsx)("div",{id:"YT".concat(e.content.id),className:t.iframe})};function Bi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;n<0&&(n=t);var i={img:Object(_.jsx)(wn.a,{style:{fontSize:t,width:n}}),text:Object(_.jsx)(_t.a,{style:{fontSize:t,width:n}}),iframe:Object(_.jsx)(mt.a,{style:{fontSize:t,width:n}}),youtube:Object(_.jsx)(Nn.a,{style:{fontSize:t,width:n}}),screen:Object(_.jsx)(Et.a,{style:{fontSize:t,width:n}}),gdrive:Object(_.jsx)("span",{style:{width:n,height:t},children:Object(_.jsx)(F.Icon,{icon:In.a,height:t})}),whiteboard:Object(_.jsx)("span",{style:{width:n,height:t},children:Object(_.jsx)(F.Icon,{icon:$e.a,height:t})}),camera:Object(_.jsx)(st.a,{style:{fontSize:t,width:n}}),pdf:Object(_.jsx)("span",{style:{width:n,height:t},children:Object(_.jsx)(F.Icon,{icon:Tn.a,height:t})}),"":void 0};return i[e]}function Ui(e,t){var n=t?t.type:"";return"whiteboard"===n?e?Object(C.c)("ctEndEditWhiteboard"):Object(C.c)("ctEditWhiteboard"):"gdrive"===n?e?Object(C.c)("ctEndEditGDrive"):Object(C.c)("ctEditGDrive"):"youtube"===n?e?Object(C.c)("ctEndEditYoutube"):Object(C.c)("ctEditYoutube"):"iframe"===n?e?Object(C.c)("ctEndEditIframe"):Object(C.c)("ctEditIframe"):"text"===n?e?Object(C.c)("ctEndEditText"):Object(C.c)("ctEditText"):""}var Vi=Object(G.a)({img:{width:"100%",height:"100%",verticalAlign:"bottom",userDrag:"none",pointerEvents:"none"},iframe:{width:"100%",height:"100%",pointerEvents:"none",border:"none"},iframeEdit:{width:"100%",height:"100%",border:"none"},div:{width:"100%",height:"100%"}}),Ji=function(e){var t=Vi(),n=Object(p.b)((function(){return e.stores.contents.editing===e.content.id}));return"img"===e.content.type?Object(_.jsx)("img",{className:t.img,src:e.content.url,alt:e.content.name}):"iframe"===e.content.type||"whiteboard"===e.content.type?Object(_.jsx)("div",{className:t.div,children:Object(_.jsx)("iframe",{className:n?t.iframeEdit:t.iframe,style:"whiteboard"===e.content.type?{backgroundColor:"white"}:{},src:e.content.url,title:e.content.name},e.content.name)}):"youtube"===e.content.type?Object(_.jsx)(Fi,Object(g.a)({},e)):"gdrive"===e.content.type?Object(_.jsx)(Un,Object(g.a)({},e)):"pdf"===e.content.type?Object(_.jsx)(qn,Object(g.a)({},e)):"text"===e.content.type?Object(_.jsx)(ai,Object(g.a)({},e)):"screen"===e.content.type||"camera"===e.content.type?Object(_.jsx)(Zn,Object(g.a)({},e)):Object(_.jsxs)("div",{children:["Unknown type:",e.content.type," for ",e.content.url]})},Gi=function(e){return m.a.useMemo((function(){return Object(_.jsx)(Ji,Object(g.a)({},e))}),[e.content.url,e.content.id,e.content.type,e.stores.contents.editing===e.content.id,e.content.pose,e.content.size,e.content.originalSize])};Gi.displayName="Content";var Hi=n(285),zi=n(443),Qi=n(444),Ki=n(445),Yi=n(446),Wi=n(447),qi=n.n(Wi),Xi=n(448),Zi=n.n(Xi),$i=n(449),eo=n.n($i),to=n(450),no=n.n(to),io=n(451),oo=n.n(io),ro=n(452),ao=n.n(ro),so=n(453),co=n.n(so),uo=n(721),lo=n(722),ho=n(720),po=n(719),fo=n(457),mo=n.n(fo),vo=n(456),go=n.n(vo),bo=n(455),yo=n.n(bo),Ao=n(454),Eo=n.n(Ao);function Oo(e,t,n,i,o,r){var a={margin:0,padding:2,border:"none"};return Object(_.jsxs)(po.a,{children:[Object(_.jsx)(ho.a,{align:"right",style:a,children:e}),Object(_.jsx)(ho.a,{align:"right",style:a,children:t}),Object(_.jsx)(ho.a,{align:"center",style:a,children:n}),Object(_.jsx)(ho.a,{style:a,children:i}),Object(_.jsx)(ho.a,{style:a,children:o})]},r)}var So=function(){function e(t){Object(b.a)(this,e),this.zorder=void 0,this.pinned=void 0,this.editing=void 0,this.name=void 0,this.pose=void 0,this.save(t)}return Object(Vn.a)(e,[{key:"save",value:function(e){e.content&&(this.zorder=e.content.zorder,this.pinned=e.content.pinned,this.name=e.content.name,this.pose=e.content.pose,this.editing=e.stores.contents.editing)}},{key:"restore",value:function(e){e.content&&(e.content.zorder=this.zorder,e.content.pinned=this.pinned,e.content.name=this.name,e.content.pose=this.pose,e.stores.contents.setEditing(this.editing))}}]),e}(),Co=function(e){var t=m.a.useRef(new So(e)).current;function n(n,i){"enter"!==i&&"backdropClick"!==i||(t.save(e),e.content&&e.updateAndSend(e.content)),e.close()}var i=function(e){"Enter"===e.key&&n(0,"enter")},o=e.stores,r=o.contents,a=o.map,s=function(e){e.onClose,e.autoHideTitle,e.updateAndSend,e.updateOnly,e.close;return Object(Pt.a)(e,["onClose","autoHideTitle","updateAndSend","updateOnly","close"])}(e);return Object(_.jsx)(J.a,Object(g.a)(Object(g.a)({onClose:n},s),{},{onMouseDown:function(e){e.stopPropagation()},children:Object(_.jsx)(p.a,{children:function(){var o,s,c,u,l,d;return Object(_.jsxs)(O.a,{children:[Object(_.jsx)("table",{children:Object(_.jsx)("tbody",{children:Object(_.jsxs)("tr",{children:[Object(_.jsx)("td",{children:Bi(e.content?e.content.type:"",h.a)}),Object(_.jsx)("td",{children:Object(_.jsx)(k.a,{label:Object(C.c)("ctName"),multiline:!1,value:e.content?e.content.name:"",inputProps:{autoFocus:!0},style:{marginLeft:20,width:"100%"},onChange:function(t){e.content&&(e.content.name=t.target.value,e.updateOnly(e.content))},onKeyPress:i,fullWidth:!0})})]})})}),Object(_.jsxs)(y.a,{mt:2,mb:2,children:[Object(_.jsxs)(A.a,{variant:"contained",style:{textTransform:"none"},onClick:function(){e.content&&(Object(Le.t)(e.content),e.updateOnly(e.content))},children:[Object(_.jsx)(Eo.a,{}),"\xa0 ",Object(C.c)("ctMoveTop")]})," \xa0",Object(_.jsxs)(A.a,{variant:"contained",style:{textTransform:"none"},onClick:function(){e.content&&(Object(Le.s)(e.content),e.updateOnly(e.content))},children:[Object(_.jsx)(yo.a,{}),"\xa0 ",Object(C.c)("ctMoveBottom")]})," \xa0"]}),Object(_.jsxs)(y.a,{mt:2,mb:2,children:[Object(_.jsxs)(A.a,{variant:"contained",style:{textTransform:"none"},onClick:function(){e.content&&Object(Le.a)(e.content)},children:[Object(_.jsx)(F.Icon,{icon:Yi.a,height:h.a}),"\xa0 ",Object(C.c)("ctCopyToClipboard")]})," \xa0",Object(_.jsx)(A.a,{variant:"contained",style:{textTransform:"none"},onClick:function(){e.content&&a.focusOn(e.content)},children:Object(C.c)("ctFocus")})]}),Object(_.jsx)(uo.a,{size:"small",children:Object(_.jsx)(lo.a,{children:[Oo(Object(C.c)("ctUnpin"),Object(_.jsx)(F.Icon,{icon:co.a,height:h.a}),Object(_.jsx)(ge.a,{color:"primary",checked:null===(o=e.content)||void 0===o?void 0:o.pinned,onChange:function(t,n){e.content&&(e.content.pinned=n,e.updateOnly(e.content))}}),Object(_.jsx)(F.Icon,{icon:ao.a,height:h.a}),Object(C.c)("ctPin"),"pin"),Object(_.jsx)(f.Fragment,{children:Object(Cn.h)(e.content)?Oo(Ui(!0,e.content),Object(_.jsx)(go.a,{}),Object(_.jsx)(ge.a,{color:"primary",checked:(null===(s=e.content)||void 0===s?void 0:s.id)===r.editing,onChange:function(t,n){e.content&&r.setEditing(n?e.content.id:"")}}),Object(_.jsx)(An.a,{}),Ui(!1,e.content)):void 0},"edit"),Object(_.jsx)(f.Fragment,{children:Object(Cn.d)(e.content)?Oo(Object(C.c)("ctUnWallpaper"),Object(_.jsx)(F.Icon,{icon:Hi.a,height:h.a}),Object(_.jsx)(ge.a,{color:"primary",checked:Object(Cn.j)(e.content),onChange:function(t,n){e.content&&(Object(Le.q)(e.content,n),e.updateOnly(e.content))}}),Object(_.jsx)(F.Icon,{icon:zi.a,height:h.a}),Object(C.c)("ctWallpaper")):void 0},"wall"),Object(_.jsx)(f.Fragment,{children:Oo(Object(C.c)("ctFrameVisible"),Object(_.jsx)(F.Icon,{icon:Zi.a,height:h.a}),Object(_.jsx)(ge.a,{color:"primary",checked:null===(c=e.content)||void 0===c?void 0:c.noFrame,onChange:function(t,n){e.content&&(e.content.noFrame=!!n||void 0,e.updateOnly(e.content))}}),Object(_.jsx)(F.Icon,{icon:eo.a,height:h.a}),Object(C.c)("ctFrameInvisible"))},"noFrame"),Object(_.jsx)(f.Fragment,{children:"zoneimg"===(null===(u=e.content)||void 0===u?void 0:u.shareType)?Oo(Object(C.c)("ctNotAudioZone"),Object(_.jsx)(F.Icon,{icon:Hi.a,height:h.a}),Object(_.jsx)(ge.a,{color:"primary",checked:void 0!==(null===(l=e.content)||void 0===l?void 0:l.zone),onChange:function(t,n){e.content&&(e.content.zone=n?e.content.zone?e.content.zone:"open":void 0,e.updateOnly(e.content))}}),Object(_.jsx)(F.Icon,{icon:Qi.a,height:h.a}),Object(_.jsxs)(_.Fragment,{children:[e.content.zone?Object(_.jsx)(ye.a,{size:"small",onClick:function(){e.content&&(e.content.zone="close"===e.content.zone?"open":"close",e.updateOnly(e.content))},children:Object(_.jsx)(F.Icon,{icon:"close"===e.content.zone?Ki.a:no.a,height:h.a})}):void 0,"close"===e.content.zone?Object(C.c)("ctClosedAudioZone"):Object(C.c)("ctOpenAudioZone")]})):void 0},"zone"),Object(_.jsx)(f.Fragment,{children:Oo(Object(C.c)("ctTransparent"),Object(_.jsx)(F.Icon,{icon:qi.a,height:h.a}),Object(_.jsx)(de.a,{color:"primary",value:void 0===(null===(d=e.content)||void 0===d?void 0:d.opacity)?1e3:1e3*e.content.opacity,min:0,max:1e3,style:{width:"6em",marginLeft:"0.4em",marginRight:"0.4em"},onChange:function(t,n){e.content&&(e.content.opacity=1e3===n?void 0:n/1e3,e.updateOnly(e.content))}}),Object(_.jsx)(F.Icon,{icon:oo.a,height:h.a}),Object(C.c)("ctOpaque"))},"opacity")]})}),Object(_.jsxs)(y.a,{mt:2,mb:2,children:[Object(_.jsx)(A.a,{variant:"contained",color:"primary",style:{textTransform:"none"},onClick:function(){n(0,"enter")},children:Object(C.c)("btSave")}),Object(_.jsx)(A.a,{variant:"contained",color:"secondary",style:{textTransform:"none",marginLeft:15},onClick:function(){e.content&&(t.restore(e),e.updateOnly(e.content))},children:Object(C.c)("btCancel")}),Object(_.jsxs)(A.a,{variant:"contained",color:"secondary",style:{textTransform:"none",marginLeft:60},onClick:function(t){e.onClose(t)},children:[Object(_.jsx)(mo.a,{})," \xa0 ",Object(C.c)("ctDelete")]})," \xa0\xa0"]})]})}})}))},_o=function e(){Object(b.a)(this,e),this.buttons=0,this.dragCanceled=!1,this._borderTimer=0,this._down=!1,this._item="",this._timer=0,this.downTime=0,this.upTime=0,this.downPos=0,this.downXPos=0,this.movePos=0,this.moveXPos=0},jo=function(e){var t=Object(f.useState)(e.content.pose),n=Object(i.a)(t,2),o=n[0],a=n[1],s=Object(f.useState)(e.content.size),c=Object(i.a)(s,2),u=c[0],l=c[1],d=Object(f.useState)(u),v=Object(i.a)(d,2),b=v[0],y=v[1],A=Object(f.useState)(o.position),E=Object(i.a)(A,2),O=E[0],S=E[1],j=Object(f.useState)(!1),T=Object(i.a)(j,2),k=T[0],I=T[1],R=Object(f.useState)(!1),w=Object(i.a)(R,2),D=w[0],N=w[1],P=Object(f.useState)(o.orientation),M=Object(i.a)(P,2),L=M[0],x=M[1],F=Object(f.useState)(!1),B=Object(i.a)(F,2),U=B[0],V=B[1],J=Object(f.useRef)(null),G=e.stores,H=G.contents,z=G.map,Q=G.participants,K=Object(p.b)((function(){return H.editing===e.content.id}));function Y(t){H.setEditing(t?e.content.id:"")}var W=Object(f.useRef)(new _o).current,q=Object(f.useState)(!1),X=Object(i.a)(q,2),Z=X[0],$=X[1];function ee(){var e,t;J.current&&(J.current.resizable.orientation=o.orientation+z.rotation);var n=k?h.a:0;null===(e=J.current)||void 0===e||e.updatePosition({x:o.position[0],y:o.position[1]-n}),null===(t=J.current)||void 0===t||t.updateSize({width:u[0],height:u[1]+n})}function te(e){e.stopPropagation(),e.preventDefault()}function ne(){W._down||(W._down=!1,W._item="DIV",window.clearTimeout(W._timer),ae())}function ie(){JSON.stringify(o)===JSON.stringify(e.content.pose)&&JSON.stringify(u)===JSON.stringify(e.content.size)||(e.content.size=Object(vn.a)(u),e.content.pose=Object(g.a)({},o),e.updateAndSend(e.content))}void 0===e.content.zone&&(e.content.zone="close"),Object(f.useEffect)((function(){W.dragCanceled=!0,"img"!==e.content.shareType&&(window.clearTimeout(W._timer),W._timer=window.setTimeout((function(){!0!==k&&I(!1)}),2)),It.a.isEqual(u,e.content.size)||l(It.a.cloneDeep(e.content.size)),It.a.isEqual(o,e.content.pose)||a(It.a.cloneDeep(e.content.pose))}),[e.content]),Object(f.useLayoutEffect)((function(){ee()}),[o,u,k,z.rotation]);var oe=e.autoHideTitle&&e.content.pinned,re={onDoubleClick:function(t){Object(Cn.h)(e.content)&&(te(t),Y(!K))},onDrag:function(t){var n=t.down,i=t.delta,s=t.event,c=(t.xy,t.buttons);e.content.ownerName===Q.local.information.name&&(k||(null===s||void 0===s||s.stopPropagation(),n&&function(e,t,n){if(!W.dragCanceled)if(2===t){var i;x((L+e[0]+e[1])%360),i=(null===n||void 0===n?void 0:n.shiftKey)||(null===n||void 0===n?void 0:n.ctrlKey)?L:L-L%15;var s=Object(r.a)(o.position,Object(r.A)(.5,u));o.position=Object(r.a)(o.position,Object(r.O)(Object(r.K)(o.orientation-i,s),s)),o.orientation=i,a(Object.assign({},o))}else{var c=z.rotateFromWindow(e),l=Object(r.K)(-o.orientation,c);o.position=Object(r.a)(o.position,l),a(Object.assign({},o))}}(i,c,s)))},onDragStart:function(e){var t=e.event,n=e.currentTarget,i=(e.delta,e.buttons);V(!0),W.buttons=i,W.dragCanceled=!1,n instanceof Element&&t instanceof PointerEvent&&n.setPointerCapture(null===t||void 0===t?void 0:t.pointerId)},onDragEnd:function(e){var t=e.event,n=e.currentTarget;e.delta,e.buttons;V(!1),W.dragCanceled||ie(),W.dragCanceled=!1,n instanceof Element&&t instanceof PointerEvent&&n.releasePointerCapture(null===t||void 0===t?void 0:t.pointerId),z.keyInputUsers.size||2!==W.buttons||(N(!0),z.keyInputUsers.add("contentForm")),W.buttons=0},onPointerUp:function(e){K&&e.stopPropagation()},onPointerDown:function(e){K&&e.stopPropagation()},onMouseUp:function(e){if(K)e.stopPropagation();else if(W.upTime=(new Date).getSeconds(),W.upTime-W.downTime<1&&"DIV"===String(Object(e.target).tagName)){if(W._down){var t=Q.local,n=Object(r.O)(z.mouseOnMap,t.pose.position);if(Object(r.C)(n)>30){var i=Object(r.B)(Object(r.C)(n)/Object(r.C)(n),n);t.pose.orientation=180*Math.atan2(i[0],-i[1])/Math.PI,t.pose.position=Object(r.a)(t.pose.position,i),$(!0),window.clearTimeout(W._borderTimer),W._borderTimer=window.setTimeout((function(){$(!1)}),1e3)}}}else W._down&&(W._down=!1,W._item=String(Object(e.target).tagName),window.clearTimeout(W._timer),ae())},onMouseMove:function(e){k||(W.movePos=Number(Object(e.nativeEvent).layerY),W.moveXPos=Number(Object(e.nativeEvent).layerX),W.moveXPos>=W.downXPos-20&&W.moveXPos<=W.downXPos+20&&W.movePos>=W.downPos-20&&W.movePos<=W.downPos+20?W._down=!0:W._down=!1)},onMouseOver:function(e){W._item=String(Object(e.target).tagName),window.clearTimeout(W._timer)},onMouseOut:function(e){},onMouseDown:function(t){K?t.stopPropagation():(W._down=!0,W.downTime=(new Date).getSeconds(),window.clearTimeout(W._timer),window.setTimeout((function(){e.content.ownerName===Q.local.information.name&&W._down&&!1===k&&(W.downPos=Number(Object(t.nativeEvent).layerY),W.downXPos=Number(Object(t.nativeEvent).layerX),I(!0))}),1500))},onTouchStart:function(e){K&&e.stopPropagation()},onTouchEnd:function(e){K&&e.stopPropagation()}};function ae(){e.content.ownerName===Q.local.information.name&&("DIV"!==W._item&&W._down||window.setTimeout((function(){I(!1)}),1e3))}var se=Object.assign({},re);se.onDrag=function(t){var n;e.content.ownerName===Q.local.information.name&&(k||null===(n=re.onDrag)||void 0===n||n.call(undefined,t))};var ce=ko({props:e,pose:o,size:u,showTitle:k,pinned:e.content.pinned,dragging:U,editing:K,downPos:W.downPos,downXPos:W.downXPos}),ue=m.a.useRef(null),le=m.a.useRef(null),de=Object(Yt.a)(se),he=Object(Yt.a)(re),pe=Object(_.jsxs)("div",Object(g.a)(Object(g.a)({className:ce.rndContainer},de()),{},{children:[Object(_.jsxs)("div",{className:ce.content,ref:ue,onFocus:function(){Object(Cn.f)(e.content)&&K&&z.keyInputUsers.add(e.content.id)},onBlur:function(){Object(Cn.f)(e.content)&&K&&z.keyInputUsers.delete(e.content.id)},children:[Object(_.jsx)(Gi,Object(g.a)({},e)),Object(_.jsx)("div",{className:Z?ce.dashed:void 0})]}),Object(_.jsx)("div",Object(g.a)(Object(g.a)({className:ce.titlePosition},he()),{},{children:Object(_.jsxs)("div",{className:ce.titleContainer,onMouseLeave:function(){},onContextMenu:function(){N(!0),z.keyInputUsers.add("contentForm")},children:[Object(_.jsx)(ke.a,{placement:"top",title:e.content.pinned?Object(C.c)("ctUnpin"):Object(C.c)("ctPin"),children:Object(_.jsx)("div",{className:ce.pin,onMouseUp:function(t){te(t),W._down=!1,e.content.pinned=!e.content.pinned,e.updateAndSend(e.content)},onTouchStart:te,onMouseLeave:ne,children:Object(_.jsx)("img",{src:(e.content.pinned,On),height:h.a,width:h.a,alt:""})})}),Object(_.jsx)(ke.a,{placement:"top",title:Ui(K,e.content),children:Object(_.jsx)("div",{className:ce.edit,onMouseUp:function(e){te(e),Y(!K)},onTouchStart:te,onMouseLeave:ne,children:K?Object(_.jsx)(bn.a,{style:{fontSize:h.a}}):Object(_.jsx)(An.a,{style:{fontSize:h.a}})})}),Object(_.jsx)(ke.a,{placement:"top",title:Object(C.c)("ctMoveTop"),children:Object(_.jsx)("div",{className:ce.moveTopButton,onMouseUp:function(t){te(t),W._down=!1,Object(Le.t)(e.content),e.updateAndSend(e.content)},onTouchStart:te,onMouseLeave:ne,children:Object(_.jsx)("img",{src:"data:image/png;base64,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",height:h.a,width:h.a,alt:""})})}),Object(_.jsx)(ke.a,{placement:"top",title:Object(C.c)("ctMoveBottom"),children:Object(_.jsx)("div",{className:ce.moveBottomButton,onMouseUp:function(t){te(t),W._down=!1,Object(Le.s)(e.content),e.updateAndSend(e.content)},onTouchStart:te,onMouseLeave:ne,children:Object(_.jsx)("img",{src:"data:image/png;base64,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",height:h.a,width:h.a,alt:""})})}),"img"===e.content.shareType?void 0:Object(_.jsx)(ke.a,{placement:"top",title:e.content.zone?Object(C.c)("ctUnProximity"):Object(C.c)("ctProximity"),children:Object(_.jsx)("div",{className:ce.prox,onMouseUp:function(t){te(t),W._down=!1,"open"===e.content.zone?e.content.zone="close":e.content.zone="open",e.updateAndSend(e.content)},onTouchStart:te,onMouseLeave:ne,children:Object(_.jsx)("img",{src:(e.content.zone,En),height:h.a,width:h.a,alt:""})})}),Object(_.jsx)("div",{className:ce.titleButton,onMouseUp:function(e){te(e),W._down=!1,z.keyInputUsers.add("contentForm"),N(!0)},onTouchStart:te,onMouseLeave:ne,ref:le,children:Object(_.jsx)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAG8AAABvCAYAAADixZ5gAAAACXBIWXMAAC4jAAAuIwF4pT92AAACtElEQVR4nO3d8U3bQBhA8a9V/ycblE7QdANGyAhhg4zACN2g6QTNBoUJSjeADZIJrrJ0kVDpGftsH7zq/aSoFeCPqx+uExvBu5RSiOm93biMB2Y8MOOBGQ/MeGDGAzMemPHAjAdmPDDjgRkPzHhgxgMzHpjxwIwHZjww44EZD8x4YMYDMx6Y8cCMB2Y8MOOBGQ/MeGDGAzMemPHAjAdmPDDjgRkPzHhgxgMzHpjxwIwHZjww44EZD+zDG1j6Vf7zPiKOM85dRcQ6//12xrlLzx6u+5GNjR+rlNJNSukhPfeQ37eqXFPf7PuU0m7C7MuU0r5n9rb1vmwdbpNSOv7jH/+3Y/7YMbO3A2d3O389cvZuwNxzxLGzEfG2A3fAU0O/msfOPo7YyfsFZ096tPpJt9354Vfltl/y+bCkO2f+rJh7yut66PmYTUT8qJj9mGfPeQ5/ptWzza8LbruvHH0RETc9719NmP0xInaV2w7W4sibctSdlY6+2iPjqU+Fo28bEd8mzD3lL4DFtDjyNgvOuCq8fYzSjKnrvphpfUUt4l3OMGM98u1jlNY3x7qNt/R/PwWfX+FzjtIiXt+zuaEWfdZW8PsVPucolHillwp9LyGGKq1vjnUveumsRbzDgjPm2DmlGVPXffof4nVHx92E7e96jrBDfkFc63vPEXbIAWpNeW07iFdYvMLyom7nX1dsdz3gvHZbMfuUo790Xjvko3Ps7E2TJ1kNL0yHdxXmfbSOF97P491V6HO+CkG62/0m7qT7yw/B/AYkMOOBGQ/MeGDGAzMemPHAjAdmPDDjgRkPzHhgxgMzHpjxwIwHZjww44EZD8x4YMYDMx6Y8cCMB2Y8MOOBGQ/MeGDGAzMemPHAjAdmPDDjgRkPzHhgxgMzHpjxwIwHZjww44EZD8x4YMajiog/21dcxOr72+UAAAAASUVORK5CYII=",height:h.a,width:h.a,alt:""})}),Object(_.jsx)(Co,Object(g.a)(Object(g.a)({open:D},e),{},{close:function(){N(!1),e.content.pinned&&I(!1),z.keyInputUsers.delete("contentForm"),e.updateAndSend(e.content)},anchorEl:ue.current,anchorOrigin:{vertical:"top",horizontal:"right"}})),Object(_.jsx)("div",{className:ce.note,onMouseUp:function(t){var n;te(t),null===(n=e.onShare)||void 0===n||n.call(null,t)},onTouchStart:te,onMouseLeave:ne,children:"Share"}),Object(_.jsx)("div",{className:ce.close,onMouseUp:function(t){var n;te(t),null===(n=e.onClose)||void 0===n||n.call(null,t)},onTouchStart:te,onMouseLeave:ne,children:Object(_.jsx)("img",{src:"data:image/png;base64,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",height:h.a,width:h.a,alt:""})})]})}))]}));return Object(_.jsx)("div",{className:ce.container,style:{zIndex:e.content.zIndex},onContextMenu:function(e){e.stopPropagation(),e.preventDefault()},children:Object(_.jsx)(_n.a,{className:ce.rndCls,enableResizing:oe?Ro:Io,disableDragging:k,ref:J,onResizeStart:function(t){e.content.ownerName===Q.local.information.name&&(W.dragCanceled=!1,t.stopPropagation(),t.preventDefault(),y(u),S(o.position))},onResize:function(t,n,i,s,c){if(e.content.ownerName===Q.local.information.name)if(t.stopPropagation(),t.preventDefault(),W.dragCanceled)ee();else{var u=(Object(r.j)(z.matrix)+Object(r.k)(z.matrix))/2,d=[s.width/u,s.height/u];"left"!==n&&"right"!==n||(d[1]=0),"top"!==n&&"bottom"!==n||(d[0]=0);var h=!1,p=[0,0];"left"!==n&&"topLeft"!==n&&"bottomLeft"!==n||(p[0]=-d[0],h=h||0!==d[0]),"top"!==n&&"topLeft"!==n&&"topRight"!==n||(p[1]=-d[1],h=h||0!==d[1]),h&&(o.position=Object(r.a)(O,p),a(Object.assign({},o)));var f=Object(r.a)(b,d);if(e.content.originalSize[0]){var m=e.content.originalSize[0]/e.content.originalSize[1];f[0]>m*f[1]&&(f[0]=m*f[1]),f[0]<m*f[1]&&(f[1]=f[0]/m)}l(f)}},onResizeStop:function(){e.content.ownerName===Q.local.information.name&&(W.dragCanceled||ie(),W.dragCanceled=!1)},children:pe})})},To={"&":{margin:"5px",borderRadius:"50%",width:"35px",height:"35px",padding:"3px"},"&:hover":{backgroundColor:"black",margin:"5px",padding:"3px",borderRadius:"50%"},"&:active":{margin:"5px",padding:"3px",borderRadius:"50%"}},ko=Object(G.a)({container:function(e){var t=new DOMMatrix;return t.rotateSelf(0,0,e.pose.orientation),{display:e.props.hideAll?"none":"block",width:0,height:0,transform:t.toString(),position:"absolute"}},rndCls:function(e){return{borderRadius:e.showTitle?"0.5em 0.5em 0 0":"0 0 0 0",backgroundColor:e.props.content.noFrame?"rgba(0,0,0,0)":Sn.useTransparent?"rgba(200,200,200,0.5)":"rgba(200,200,200,1)",boxShadow:e.props.content.noFrame?void 0:Sn.useTransparent?"0.2em 0.2em 0.2em 0.2em rgba(0,0,0,0.4)":"0.2em 0.2em 0.2em 0.2em rgba(100,100,100,1)"}},rndContainer:function(e){return{width:"100%",height:"100%"}},dashed:function(e){return{position:"relative",width:e.size[0]+8,height:e.size[1]+8,borderWidth:2,borderStyle:"dashed",borderColor:"red",borderRadius:0,top:-e.size[1]-6+"px",left:"-6px"}},titlePosition:function(e){return e.showTitle?{}:{width:0,heihgt:0,position:"absolute",top:0}},titleContainer:function(e){var t={display:"flex",position:"absolute",width:(e.pinned,350),height:(e.pinned,200),overflow:"hidden",userSelect:"none",userDrag:"none",top:"auto",left:"auto",bottom:"auto",transform:"scale(0)",transition:"0.3s ease-out"};return e.showTitle?(t.display="flex",t.position="absolute",t.bottom="auto",t.top=e.downPos-65,t.left=e.downXPos-190,t.transform="scale(1)"):(t.display="flex",t.position="absolute",t.bottom="auto",t.top="auto",t.left="auto",t.transform="scale(0)"),t},content:function(e){return{position:"absolute",top:(e.showTitle?h.a:0)-(e.editing?3:0),left:e.editing?-3:0,width:e.size[0],height:e.size[1],userDrag:"none",pointerEvents:e.dragging?"none":"auto",borderWidth:3,borderColor:"yellow",borderStyle:e.editing?"solid":"none",cursor:e.editing?"default":void 0,opacity:e.props.content.opacity}},note:function(e){return e.showTitle?Object(g.a)({visibility:e.props.onShare?"visible":"hidden",whiteSpace:"pre",borderRadius:"0.5em 0 0 0"},To):{visibility:"hidden"}},pin:function(e){return e.showTitle?Object(g.a)({display:e.props.onShare?"none":"block",height:h.a,position:"absolute",textAlign:"center",top:"img"===e.props.content.shareType?45:57,left:"img"===e.props.content.shareType?78:60,whiteSpace:"pre",cursor:"default",background:e.pinned?"#ef4623":"#9e886c"},To):{display:"none"}},prox:function(e){return e.showTitle?Object(g.a)({display:e.props.onShare?"none":"block",height:h.a,position:"absolute",top:"0px",left:"185px",whiteSpace:"pre",cursor:"default",background:"close"===e.props.content.zone?"#ef4623":"#9e886c"},To):{display:"none"}},titleButton:function(e){return e.showTitle?Object(g.a)({display:"block",height:h.a,textAlign:"center",whiteSpace:"pre",position:"absolute",cursor:"default",top:(e.props.content.shareType,13),left:"img"===e.props.content.shareType?213:233,background:"#9e886c"},To):{display:"none"}},moveTopButton:function(e){return e.showTitle?Object(g.a)({display:"block",height:h.a,position:"absolute",textAlign:"center",top:13,left:"img"===e.props.content.shareType?117:87,whiteSpace:"pre",cursor:"default",background:"#9e886c"},To):{display:"none"}},moveBottomButton:function(e){return e.showTitle?Object(g.a)({display:"block",height:h.a,position:"absolute",textAlign:"center",top:"img"===e.props.content.shareType?5:0,left:"img"===e.props.content.shareType?165:135,whiteSpace:"pre",cursor:"default",background:"#9e886c"},To):{display:"none"}},copyClipButton:function(e){return e.showTitle?Object(g.a)({display:"block",height:h.a,position:"absolute",top:"0px",left:"185px",whiteSpace:"pre",cursor:"default",background:"#9e886c"},To):{display:"none"}},edit:function(e){return e.showTitle?Object(g.a)({display:e.props.onShare||!Object(Cn.h)(e.props.content)?"none":"block",height:h.a,whiteSpace:"pre",cursor:"default",background:"#9e886c"},To):{display:"none"}},type:function(e){return Object(g.a)({display:e.showTitle?"block":"none",height:h.a,position:"absolute",top:105,left:50,background:"#9e886c"},To)},close:function(e){return Object(g.a)({visibility:e.showTitle?"visible":"hidden",position:"absolute",textAlign:"left",top:"img"===e.props.content.shareType?45:57,left:"img"===e.props.content.shareType?253:260,right:0,margin:0,padding:0,height:h.a,borderRadius:"0 0.5em 0 0",cursor:"default",background:"#9e886c"},To)}}),Io={bottom:!0,bottomLeft:!0,bottomRight:!0,left:!0,right:!0,top:!0,topLeft:!0,topRight:!0},Ro={bottom:!1,bottomLeft:!1,bottomRight:!1,left:!1,right:!1,top:!1,topLeft:!1,topRight:!1};jo.displayName="RndContent";var wo=function(e){return{onClose:function(t){Object(h.b)("RndContent onClose for ",e.content.id),t.stopPropagation(),e.stores.map.keyInputUsers.delete(e.content.id),e.stores.map.keyInputUsers.delete("contentForm"),e.stores.contents.removeByLocal(e.content.id)},updateAndSend:function(t){e.stores.contents.updateByLocal(Object.assign({},t))},updateOnly:function(t){e.stores.contents.updateLocalOnly(Object.assign({},t))}}},Do=function(e){return Object(_.jsx)(jo,Object(g.a)(Object(g.a)({},e),{},{autoHideTitle:!0},wo(e)))};function No(e){if(!Object(Cn.i)(e))return e}Do.displayName="SharedContent";var Po=function(e){var t=Xt({height:e.lineHeight,fontSize:e.fontSize}),n=m.a.useState(!1),o=Object(i.a)(n,2),a=o[0],s=o[1],c=m.a.useRef(null),u=(e.lineHeight,e.content,Object(Pt.a)(e,["lineHeight","content"])),l=No(e.stores.contents.find(e.content.id)),d=e.stores.map;return Object(_.jsx)(p.a,{children:function(){var n,i,o=Bi(e.content.type,e.fontSize),p=Object(r.o)(e.content.ownerName);return(null===(n=e.content.color)||void 0===n?void 0:n.length)&&(p[0]=Object(r.G)(e.content.color)),(null===(i=e.content.textColor)||void 0===i?void 0:i.length)&&(p[1]=Object(r.G)(e.content.textColor)),Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(ke.a,{title:Object(_.jsxs)(_.Fragment,{children:[e.content.name,Object(_.jsx)("br",{}),e.content.ownerName]}),placement:"right",children:Object(_.jsxs)(A.a,{ref:c,variant:"contained",className:t.line,style:{backgroundColor:p[0],color:p[1],margin:"1px 0 1px 0",textTransform:"none"},onClick:function(){var t=h.c.find(e.content.id);if(t)d.focusOn(t);else{h.c.requestContent([e.content.id]);var n=Object(Ve.c)((function(){var t=h.c.find(e.content.id);t&&(d.focusOn(t),n())}))}},onContextMenu:function(){if(No(h.c.find(e.content.id)))s(!0),d.keyInputUsers.add("contentForm");else{h.c.requestContent([e.content.id]);var t=Object(Ve.c)((function(){No(h.c.find(e.content.id))&&(s(!0),d.keyInputUsers.add("contentForm"),t())}))}},children:[o,e.content.name]})}),Object(_.jsx)(Co,Object(g.a)(Object(g.a)(Object(g.a)({},u),{},{content:l},wo(e)),{},{open:a,close:function(){s(!1),d.keyInputUsers.delete("contentForm")},anchorEl:c.current,anchorOrigin:{vertical:"top",horizontal:"right"}}))]})}})},Mo=function(e){var t=e.stores.roomInfo,n=e.stores.contents,i=Object(p.b)((function(){var e=Array.from(n.roomContentsInfo.size?n.roomContentsInfo.values():n.all);return e.sort((function(e,t){var n=e.name.localeCompare(t.name);return 0===n&&(n=e.ownerName.localeCompare(t.ownerName)),0===n&&(n=e.type.localeCompare(t.type)),0===n&&(n=e.id.localeCompare(t.id)),n})),e})),o=Object(p.b)((function(){return n.editing})),a=Xt({height:e.lineHeight,fontSize:e.fontSize}),s=e.stores.participants,c=i.map((function(t){return Object(_.jsx)(Po,Object(g.a)(Object(g.a)({content:t},e),{},{participant:s.find(n.owner.get(t.id))}),t.id)})),u=Object(C.d)().t,l=Object(p.b)((function(){return Object(r.v)(t.backgroundFill)?"white":"black"}));return Object(_.jsxs)("div",{className:a.container,children:[Object(_.jsxs)("div",{className:a.title,style:{color:l},children:[u("Contents"),o?Object(_.jsxs)(A.a,{variant:"contained",size:"small",color:"primary",style:{marginLeft:4,padding:3,height:"1.4em",fontSize:"0.8"},onClick:function(){n.setEditing("")},children:[Object(_.jsx)(bn.a,{style:{fontSize:"1em"}}),"\xa0",u("shareEditEnd")]}):void 0]}),c]})};Mo.displayName="ContentList";var Lo=n(726),xo=n(184),Fo=n(123),Bo={fontSize:Object(Fo.j)()?"2em":"1em",height:Object(Fo.j)()?"2em":"1.5em"},Uo={height:Object(Fo.j)()?"4em":"3em"},Vo={fontSize:(Object(Fo.j)(),"1em")},Jo={fontSize:Object(Fo.j)()?"2.5rem":"1rem"},Go=function(e){var t=e.stores,n=t.participants,o=t.map,a=n.local,s=Object(f.useState)(),c=Object(i.a)(s,2),u=c[0],l=c[1],d=Object(f.useState)(!1),h=Object(i.a)(d,2),v=h[0],b=h[1],E=Object(f.useState)(!1),j=Object(i.a)(E,2),T=j[0],I=j[1],R=Object(C.d)().t;function w(t,n){"enter"!==n&&"backdropClick"!==n||(a.sendInformation(),a.saveInformationToStorage(!0)),e.close()}var D=function(e){"Enter"===e.key?w(0,"enter"):"Esc"!==e.key&&"Escape"!==e.key||a.loadInformationFromStorage()};function N(e){e.preventDefault(),l(null),a.information.avatarSrc=""}function P(e){e.preventDefault(),u&&Object(xo.b)(u).then((function(e){a.information.avatarSrc=e}))}var M=m.a.useRef(null),L=m.a.useRef(null),x=(e.close,Object(Pt.a)(e,["close"]));return Object(_.jsxs)(J.a,Object(g.a)(Object(g.a)({},x),{},{onClose:w,children:[Object(_.jsx)(S.a,{children:Object(_.jsx)("span",{style:{fontSize:Object(Fo.j)()?"2.5em":"1em"},children:R("lsTitle")})}),Object(_.jsxs)(O.a,{children:[Object(_.jsx)(p.a,{children:function(){var e=a.getColorRGB(),t=a.getTextColorRGB(),n=Object(r.v)(e)?"white":"black",i=Object(r.v)(t)?"lightgray":"gray";return Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(k.a,{label:R("YourName"),multiline:!1,value:a.information.name,style:Uo,inputProps:{style:Bo,autoFocus:!0},InputLabelProps:{style:Vo},onChange:function(e){a.information.name=e.target.value},onKeyPress:D,fullWidth:!0}),Object(_.jsxs)(y.a,{mt:3,children:[Object(_.jsx)("div",{style:{fontSize:12},children:R("lsColor")}),Object(_.jsxs)(y.a,{ml:2,children:[Object(_.jsx)(A.a,{variant:"contained",style:{backgroundColor:Object(r.G)(e),color:n,textTransform:"none"},onClick:function(){b(!0)},ref:M,children:R("lsColorAvatar")}),Object(_.jsx)(J.a,{open:v,onClose:function(){b(!1)},anchorEl:M.current,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:Object(_.jsx)(ce.a,{color:{r:e[0],g:e[1],b:e[2]},disableAlpha:!0,onChange:function(e,t){t.preventDefault(),a.information.color=[e.rgb.r,e.rgb.g,e.rgb.b]}})}),Object(_.jsx)(A.a,{variant:"contained",style:{color:Object(r.G)(t),backgroundColor:i,marginLeft:15,textTransform:"none"},onClick:function(){I(!0)},ref:L,children:R("lsColorText")}),Object(_.jsx)(J.a,{open:T,anchorOrigin:{vertical:"bottom",horizontal:"right"},onClose:function(){I(!1)},anchorEl:L.current,children:Object(_.jsx)(ce.a,{color:{r:t[0],g:t[1],b:t[2]},onChange:function(e,t){t.preventDefault(),a.information.textColor=[e.rgb.r,e.rgb.g,e.rgb.b]}})}),Object(_.jsx)(A.a,{variant:"contained",style:{marginLeft:15,textTransform:"none"},onClick:function(){a.information.color=[],a.information.textColor=[]},children:R("lsAutoColor")})]})]}),Object(_.jsxs)(y.a,{mt:3,children:[Object(_.jsx)("div",{style:{fontSize:12},children:R("lsImage")}),Object(_.jsxs)(y.a,{mt:-1,ml:2,children:[Object(_.jsxs)("form",{onSubmit:P,style:{lineHeight:"2em",fontSize:Object(Fo.j)()?"2.5em":"1em"},children:[Object(_.jsx)("div",{style:{fontSize:12,marginTop:8},children:R("lsImageFile")}),a.information.avatarSrc?Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)("img",{src:a.information.avatarSrc,style:{height:"1.5em",verticalAlign:"middle"},alt:"avatar"}),Object(_.jsx)("input",{style:Jo,type:"submit",onClick:N,value:"\u2715"})," \xa0"]}):void 0,Object(_.jsx)("input",{style:Jo,type:"file",onChange:function(e){var t;l(null===(t=e.target.files)||void 0===t?void 0:t.item(0))}}),Object(_.jsx)("input",{style:Jo,type:"submit",value:"Upload"})]},"information"),Object(_.jsx)(k.a,{label:R("lsEmail"),multiline:!1,value:a.info.email,style:Object(g.a)(Object(g.a)({},Uo),{},{marginTop:8}),inputProps:{style:Bo,autoFocus:!0},InputLabelProps:{style:Vo},onChange:function(e){return a.info.email=e.target.value},onKeyPress:D,fullWidth:!0})]})]}),Object(_.jsxs)(y.a,{mt:3,children:[Object(_.jsx)("div",{style:{fontSize:12},children:R("lsNotification")}),Object(_.jsxs)(y.a,{mt:-1,ml:2,children:[Object(_.jsx)(ue.a,{control:Object(_.jsx)(Lo.a,{color:"primary",checked:a.information.notifyCall,onChange:function(e){a.information.notifyCall=e.target.checked}}),label:R("lsNotifyCall")}),Object(_.jsx)(ue.a,{control:Object(_.jsx)(Lo.a,{color:"primary",checked:a.information.notifyTouch,onChange:function(e){a.information.notifyTouch=e.target.checked}}),label:R("lsNotifyTouch")}),Object(_.jsx)(ue.a,{control:Object(_.jsx)(Lo.a,{color:"primary",checked:a.information.notifyNear,onChange:function(e){a.information.notifyNear=e.target.checked}}),label:R("lsNotifyNear")}),Object(_.jsx)(ue.a,{control:Object(_.jsx)(Lo.a,{color:"primary",checked:a.information.notifyYarn,onChange:function(e){a.information.notifyYarn=e.target.checked}}),label:R("lsNotifyYarn")})]})]})]})}}),Object(_.jsxs)(y.a,{mt:4,mb:3,children:[Object(_.jsx)(A.a,{variant:"contained",color:"primary",style:{textTransform:"none"},onClick:function(){w(0,"enter")},children:R("btSave")}),Object(_.jsx)(A.a,{variant:"contained",color:"secondary",style:{marginLeft:15,textTransform:"none"},onClick:function(){a.loadInformationFromStorage()},children:R("btCancel")}),Object(_.jsx)(A.a,{variant:"contained",style:{marginLeft:15,textTransform:"none"},onClick:function(){o.focusOn(a)},children:R("ctFocus")})]})]})]}))},Ho=function(e){var t,n,o=e.stores.roomInfo,r=m.a.useState(""),s=Object(i.a)(r,2),c=s[0],l=s[1],d=m.a.useState(""),p=Object(i.a)(d,2),f=p[0],v=p[1];function b(t,n){e.close()}var E=Object.assign({},e);return delete E.close,Object(_.jsxs)(J.a,Object(g.a)(Object(g.a)({},E),{},{onClose:b,children:[Object(_.jsx)(S.a,{children:null===(t=e.participant)||void 0===t?void 0:t.information.name}),Object(_.jsxs)(O.a,{children:[Object(_.jsx)(y.a,{mb:2,children:Object(_.jsx)(A.a,{variant:"contained",style:{textTransform:"none"},onClick:function(){var t;b(),null===(t=e.participant)||void 0===t||t.call()},children:Object(C.c)("rsCall")})}),Object(_.jsx)(y.a,{mb:2,children:Object(_.jsx)(A.a,{variant:"contained",style:{textTransform:"none"},onClick:function(){e.participant&&(u.a.yarnPhones.has(e.participant.id)?u.a.yarnPhones.delete(e.participant.id):u.a.yarnPhones.add(e.participant.id),b())},children:e.participant&&u.a.yarnPhones.has(e.participant.id)?Object(C.c)("rsCutYarnPhone"):Object(C.c)("rsConnectYarnPhone")})}),Object(_.jsx)(y.a,{mb:2,children:Object(_.jsx)(A.a,{variant:"contained",style:{textTransform:"none"},onClick:function(){e.participant&&(a.b.sendTo=e.participant.id,b())},children:Object(C.c)("rsChatTo",{name:null===(n=e.participant)||void 0===n?void 0:n.information.name})})}),Object(_.jsx)(y.a,{mb:2,children:Object(_.jsx)(A.a,{variant:"contained",style:{textTransform:"none"},onClick:function(){e.participant&&e.stores.map.focusOn(e.participant)},children:Object(C.c)("ctFocus")})}),o.passMatched&&Object(_.jsxs)(_.Fragment,{children:[Object(_.jsxs)(y.a,{mb:2,children:["To kick this user type 'kick' and enter. \u2009",Object(_.jsx)(k.a,{label:"kick",type:"text",style:{marginTop:-22},value:c,onChange:function(e){l(e.currentTarget.value)},onKeyPress:function(t){if("Enter"===t.key&&"kick"===c){if(!e.participant)return;re.b.conference.kickParticipant(e.participant.id),setTimeout((function(){re.b.conference.sendMessage(ae.b.KICK,"Kicked by administrator.",e.participant.id)}),5e3),e.close()}}})]}),Object(_.jsxs)(y.a,{mb:2,children:["Clear this user's contents.\u2009",Object(_.jsx)(k.a,{label:"clear",type:"text",style:{marginTop:-22},value:f,onChange:function(e){v(e.currentTarget.value)},onKeyPress:function(t){if("Enter"===t.key&&"clear"===f){if(!e.participant)return;var n=h.c.participants.get(e.participant.id);null===n||void 0===n||n.myContents.forEach((function(e){return h.c.removeByLocal(e.id)})),e.close()}}})]})]})]})]}))},zo=n(656),Qo=n(658),Ko=function e(){Object(b.a)(this,e),this.address="",this.port=0,this.protocol=""},Yo=function e(){Object(b.a)(this,e),this.remotes=[]},Wo=new function e(){Object(b.a)(this,e),this.sessions=[],this.open=!1,this.update=!1,this.interval=void 0,this.messageServer=""},qo=function(e){var t=Object(f.useState)(!1),n=Object(i.a)(t,2),o=n[0],r=n[1];Wo.open=!0===e.open,Wo.update=o,e.open?Wo.interval||(Wo.interval=setInterval((function(){var e,t,n=null===(e=re.b.conference._jitsiConference)||void 0===e?void 0:e.room;if(Wo.open&&n){var i,o,a,s=null===(i=n.xmpp)||void 0===i||null===(o=i.connection)||void 0===o||null===(a=o.jingle)||void 0===a?void 0:a.sessions,c=Object.keys(s).length;for(Wo.sessions.splice(c);Wo.sessions.length<c;)Wo.sessions.push(new Yo);for(var u in s){var l,d,h=null===(l=s[u])||void 0===l||null===(d=l.peerconnection)||void 0===d?void 0:d.peerconnection;h&&h.getStats().then((function(e){var t=[];e.forEach((function(e,n){"candidate-pair"===e.type&&(e.bytesReceived>0||e.bytesSent>0)&&t.push(e)}));var n=t.map((function(e){return e.remoteCandidateId})),i=Wo.sessions[Wo.sessions.length-1];i.remotes=[],n.forEach((function(t){var n=new Ko,o=e.get(t);n.address=o.address,n.port=o.port,n.protocol=o.protocol,i.remotes.push(n)}))}))}r(!Wo.update)}if((null===(t=re.b.conference.bmRelaySocket)||void 0===t?void 0:t.readyState)===WebSocket.OPEN)Wo.messageServer=config.bmRelayServer;else{var p,f=null===(p=re.b.conference._jitsiConference)||void 0===p?void 0:p.room;Wo.open&&f?Wo.messageServer="bridge":Wo.messageServer="prosody"}}),100),console.log("setInterval")):Wo.interval&&(clearInterval(Wo.interval),Wo.interval=void 0,console.log("clearInterval"));var a=e.close,s=Object(Pt.a)(e,["close"]);return Object(_.jsx)(Qo.a,Object(g.a)(Object(g.a)({},s),{},{children:Object(_.jsxs)(zo.a,{style:{background:"rgba(255,255,255,0.6)",padding:"0.4em"},children:[Object(_.jsxs)("div",{style:{overflowY:"auto"},children:[Object(_.jsx)("strong",{children:"Servers"}),Object(_.jsx)("br",{}),0===Wo.sessions.length?Object(_.jsx)("div",{children:"No WebRTC"}):Wo.sessions.map((function(e,t){return Object(_.jsxs)("div",{children:["WebRTC: ",e.remotes.map((function(e,t){return Object(_.jsxs)("span",{children:[e.address," ",e.port,"/",e.protocol,Object(_.jsx)("br",{})]},t.toString())}))]},t)})),Object(_.jsxs)("div",{children:[" Message: ",Wo.messageServer]})]}),Object(_.jsx)(A.a,{variant:"contained",color:"primary",style:{textTransform:"none",marginTop:"0.4em"},onClick:a,children:" Close "})]})}))},Xo=function(e){var t=e.stores.map,n=Object(p.b)((function(){return e.participant.information.name})),o=Object(p.b)((function(){return e.participant.information.avatarSrc})),r=Object(p.b)((function(){return Object(si.e)(e.participant.information)})),a=Object(p.b)((function(){return e.lineHeight})),s=Xt({height:e.lineHeight,fontSize:e.fontSize}),c=m.a.useState(!1),u=Object(i.a)(c,2),l=u[0],d=u[1],h=m.a.useRef(null),f=(e.lineHeight,Object(Pt.a)(e,["lineHeight"]));function v(){if(e.participant.physics.located)t.focusOn(e.participant);else{config.bmRelayServer&&re.b.conference.pushOrUpdateMessageViaRelay(ae.b.REQUEST_PARTICIPANT_STATES,[e.participant.id]);var n=Object(Ve.c)((function(){e.participant.physics.located&&(t.focusOn(e.participant),n())}))}}function b(){if(e.participant.physics.located)d(!0),t.keyInputUsers.add("participantList");else{config.bmRelayServer&&re.b.conference.pushOrUpdateMessageViaRelay(ae.b.REQUEST_PARTICIPANT_STATES,[e.participant.id]);var n=Object(Ve.c)((function(){e.participant.physics.located&&(d(!0),t.keyInputUsers.add("participantList"),n())}))}}return Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(ke.a,{title:"".concat(e.participant.information.name," (").concat(e.participant.id,")"),placement:"right",children:Object(_.jsxs)("div",{className:s.outer,style:{margin:"1px 0 1px 0"},children:[Object(_.jsx)(ye.a,{style:{margin:0,padding:0},onClick:v,onContextMenu:b,children:Object(_.jsx)(rn,{border:!0,colors:r,size:a,name:n,avatarSrc:o})}),Object(_.jsx)(A.a,{variant:"contained",className:s.line,ref:h,style:{backgroundColor:r[0],color:r[1],textTransform:"none"},onClick:v,onContextMenu:b,children:n})]})}),e.participant.id===e.stores.participants.localId?Object(_.jsx)(Go,{stores:e.stores,open:l,close:function(){d(!1),t.keyInputUsers.delete("participantList")},anchorEl:h.current,anchorOrigin:{vertical:"top",horizontal:"right"}}):Object(_.jsx)(Ho,Object(g.a)(Object(g.a)({},f),{},{open:l,close:function(){d(!1),t.keyInputUsers.delete("participantList")},participant:e.stores.participants.remote.get(e.participant.id),anchorEl:h.current,anchorOrigin:{vertical:"top",horizontal:"right"}}))]})},Zo=function(e){var t=m.a.useState(!1),n=Object(i.a)(t,2),o=n[0],a=n[1],s=e.stores.participants,c=e.stores.roomInfo,u=Xt({height:e.lineHeight,fontSize:e.fontSize}),l=e.localId,d=e.remoteIds,h=e.lineHeight,f=e.fontSize,v=Object(Pt.a)(e,["localId","remoteIds","lineHeight","fontSize"]),b=Object(g.a)({lineHeight:h,fontSize:f},v),y=Object(p.b)((function(){return Object(r.v)(c.backgroundFill)?"white":"black"}));d.sort((function(e,t){var n=s.remote.get(e),i=s.remote.get(t),o=n.information.name.localeCompare(i.information.name,void 0,{sensitivity:"accent"});return 0===o&&(o=(n.information.avatarSrc||"").localeCompare(i.information.avatarSrc||"",void 0,{sensitivity:"accent"})),o}));var A=d.map((function(e){return Object(_.jsx)(Xo,Object(g.a)({participant:s.remote.get(e)},b),e)})),E=Object(_.jsx)(Xo,Object(g.a)({participant:s.local},b),l),O=m.a.useRef(null);return Object(_.jsxs)("div",{className:u.container,children:[Object(_.jsxs)("div",{className:u.title,style:{color:y},ref:O,onClick:function(){a(!0)},children:[(s.remote.size+1).toString()," in ",re.b.conference.name]}),Object(_.jsx)(qo,Object(g.a)(Object(g.a)({open:o,close:function(){a(!1)}},v),{},{anchorEl:O.current})),E,A]})};Zo.displayName="ParticipantList";var $o=m.a.memo((function(e){var t=Object(p.b)((function(){return e.stores.participants.localId})),n=Object(p.b)((function(){return Array.from(e.stores.participants.remote.keys())}));return Object(_.jsx)(Zo,Object(g.a)(Object(g.a)({},e),{},{localId:t,remoteIds:n}))})),er={lineHeight:20,fontSize:16};var tr=Object.assign({},er),nr=function(e){var t=qt(),n=Object(f.useState)(1),o=Object(i.a)(n,2),r=o[0],a=o[1],s=Object(Yt.a)({onPinch:function(e){var t=Object(i.a)(e.da,2),n=t[0],o=t[1],s=(e.origin,e.event,e.memo);if(void 0===s)return[n,o];var c=Object(i.a)(s,1)[0];return function(e){Object.assign(tr,er),tr.fontSize*=e,tr.lineHeight*=e,a(e)}(function(e,t){var n=e*t;return n>4?4:n<.5?.5:n}(r,n>10?n/c:n<-10?c/n:1+(n-c)/10)),[n,o]}},{eventOptions:{passive:!1}});return Object(_.jsx)("div",Object(g.a)(Object(g.a)({},s()),{},{children:Object(_.jsxs)(v.a,{split:"horizontal",defaultSize:"80%",resizerClassName:t.resizerHorizontal,paneStyle:{overflowY:"auto",overflowX:"hidden",width:"100%"},children:[Object(_.jsxs)(v.a,{split:"horizontal",defaultSize:"50%",resizerClassName:t.resizerHorizontal,paneStyle:{overflowY:"auto",overflowX:"hidden",width:"100%"},children:[Object(_.jsx)($o,Object(g.a)(Object(g.a)({},e),tr)),Object(_.jsx)(Mo,Object(g.a)(Object(g.a)({},e),tr))]}),Object(_.jsx)(mn,Object(g.a)(Object(g.a)({},e),tr))]})}))};nr.displayName="LeftBar";var ir=Object(G.a)({videoContainer:{height:"100%",width:"100%",backgroundColor:"none"},video:{marginLeft:"auto",marginRight:"auto",display:"block",width:"100%"}}),or=function(e,t){e.srcObject=t,e.autoplay=!0},rr=function(e){var t=ir(),n=Object(p.b)((function(){return e.stores.contents.tracks.mainStream})),o=Object(f.useRef)(null);Object(f.useEffect)((function(){o&&o.current&&or(o.current,n||null)}),[n]);var r=Object(f.useState)(),a=Object(i.a)(r,2),s=a[0],c=a[1],u=Object(f.useRef)({});u.current.debugVideos=s;var l=Object(f.useRef)([]);if(e.showAllTracks){for(;l.current.length<(s?s.length:0);)l.current.push(m.a.createRef());l.current.forEach((function(e,t){e.current&&s&&t<s.length&&or(e.current,s[t].stream)}))}Object(f.useEffect)((function(){if(e.showAllTracks){var t;(null===(t=u.current)||void 0===t?void 0:t.interval)&&(clearInterval(u.current.interval),u.current.interval=void 0),u.current.interval=setInterval((function(){var e=d.tpc;if(e&&e.peerconnection){var t=[],n=new Set(e.peerconnection.getLocalStreams()),i=new Set(e.peerconnection.getRemoteStreams());e.localTracks.forEach((function(i,o){var r=i.getOriginalStream(),a=n.delete(r);t.push({stream:r,label:"Local ssrc:".concat(e.getLocalSSRC(i),"\ntype:").concat(i.getType(),"\n")+"videoType:".concat(i.videoType,"\nmsid:").concat(null===r||void 0===r?void 0:r.id)+(a?"OK":" NOT in pc"),color:"blue"})}));var o,r=Object(oe.a)(n.values());try{for(r.s();!(o=r.n()).done;){var a=o.value;t.push({stream:a,label:"Local X msid:".concat(null===a||void 0===a?void 0:a.id),color:"red"})}}catch(m){r.e(m)}finally{r.f()}e.remoteTrackMaps.forEach((function(e){e.forEach((function(e,n){var o=e.getOriginalStream(),r=i.delete(o);t.push({stream:o,label:"Remote ssrc:".concat(e.getSSRC(),"\ntype:").concat(e.getType(),"\n")+"videoType:".concat(e.videoType,"\nmsid:").concat(null===o||void 0===o?void 0:o.id)+(r?"OK":" NOT in pc"),color:"red"})}))}));var s,h=Object(oe.a)(i.values());try{for(h.s();!(s=h.n()).done;){var p=s.value;t.push({stream:p,label:"Remote X msid:".concat(null===p||void 0===p?void 0:p.id),color:"blue"})}}catch(m){h.e(m)}finally{h.f()}var f=l.current.map((function(e){return!!e}));It.a.isEqual(u.current.elementFlags,f)&&It.a.isEqual(u.current.debugVideos,t)||(c(t),u.current.elementFlags=It.a.cloneDeep(f))}}),1e3)}else{var n;(null===(n=u.current)||void 0===n?void 0:n.interval)&&(clearInterval(u.current.interval),u.current.interval=void 0)}}),[e.showAllTracks]);var h=e.showAllTracks&&s?s.map((function(e,t){return Object(_.jsxs)("div",{style:{display:"inline-block",position:"relative",verticalAlign:"top"},children:[Object(_.jsx)("video",{style:{width:300},ref:l.current[t]}),Object(_.jsx)("div",{style:{position:"absolute",left:0,top:0,color:e.color,whiteSpace:"pre-wrap"},children:e.label})]},t)})):void 0;return Object(_.jsxs)("div",{className:t.videoContainer,children:[Object(_.jsx)("video",{ref:o,className:t.video,style:{visibility:n?"visible":"hidden"}}),Object(_.jsx)("div",{style:{position:"absolute",left:0,top:0},children:h})]})};rr.displayName="MainScreen";var ar=n(458),sr=n.n(ar);function cr(e,t){var n=e*t;return n>c.a.maxScale?c.a.maxScale/e:n<c.a.minScale?c.a.minScale/e:t}var ur=Object(G.a)({root:{position:"absolute",width:"100%",height:"100%",top:0,left:0,userDrag:"none",userSelect:"none",overflow:"hidden"},center:{position:"absolute",margin:"auto",left:0,right:0,top:0,bottom:0,width:0,height:0},transform:function(e){return{position:"absolute",width:0,height:0,transform:e.matrix.toString()}}}),lr=function e(){Object(b.a)(this,e),this.prebThirdPersonView=!1,this.mouseDown=!1,this.dragging=!1,this.upTime=0,this.downTime=0,this.downXpos=0,this.downYpos=0,this.upXpos=0,this.upYpos=0},dr=function(e){var t=e.stores,n=t.map,o=t.participants,a=Object(p.b)((function(){return n.matrix})),s=Object(f.useRef)(null),c=Object(f.useRef)(null);function u(){return n.offset}var l=Object(p.b)((function(){return o.local.thirdPersonView})),d=Object(f.useRef)(new lr).current,h=Object(r.P)(a,o.local.pose.position);if(l!==d.prebThirdPersonView)if(d.prebThirdPersonView=l,l){var m=Object(r.E)(Object(r.i)(a));if(m){var v=E(-m,h);n.setCommittedMatrix(v)}}else{var b=o.local.pose.orientation,y=Object(r.E)(Object(r.i)(a));if(b+y){var A=E(-(b+y),h);n.setCommittedMatrix(A)}}function E(e,t){var i=(new DOMMatrix).rotateSelf(0,0,e),o=Object(r.Q)(t,i,a);return n.setMatrix(o),o}var O=Object(Yt.a)({onDragStart:function(e){var t=e.buttons,n=e.xy;document.body.focus(),d.dragging=!0,d.mouseDown=!0,1===t&&(d.downTime=(new Date).getSeconds(),d.downXpos=n[0],d.downYpos=n[1])},onDrag:function(e){var t=e.down,i=e.delta,s=e.xy,h=e.buttons;if((i[0]||i[1])&&(d.mouseDown=!1),d.dragging&&t&&c.current)if(l||2!==h){var p=Object(r.J)(a.inverse(),i),f=a.translate.apply(a,Object(vn.a)(p));n.setMatrix(f)}else{var m=Object(r.P)(a,o.local.pose.position),v=Object(ci.a)(s,u()),g=Object(ci.r)(v,m),b=Object(ci.r)(g,i),y=Object(r.e)(g,b)/(Object(r.R)(g)*Object(r.R)(b)),A=Object(r.e)(Object(r.I)(g),i)>0?-1:1,O=Math.acos(y)*A;if(isNaN(O))return;var S=E(Object(r.E)(O),m);o.local.pose.orientation=-Object(r.E)(Object(r.i)(S))}},onDragEnd:function(e){var t=e.event,r=e.xy;d.upXpos=r[0],d.upYpos=r[1],d.upTime=(new Date).getSeconds();var s=d.upTime-d.downTime;if(d.upXpos>=d.downXpos-20&&d.upXpos<=d.downXpos+20&&d.upYpos>=d.downYpos-20&&d.upYpos<=d.downYpos+20&&"DIV"===String(Object(null===t||void 0===t?void 0:t.target).tagName)&&s<2){var c,u=o.local,l=Array.from(o.remote.keys()).filter((function(e){return e!==o.localId})),h=Object(oe.a)(l.entries());try{for(h.s();!(c=h.n()).done;){var p,f,m=Object(i.a)(c.value,1)[0],v=Number(null===(p=o.remote.get(l[m]))||void 0===p?void 0:p.pose.position[0]),g=Number(null===(f=o.remote.get(l[m]))||void 0===f?void 0:f.pose.position[1]),b=Number(n.mouseOnMap[0]),y=Number(n.mouseOnMap[1]);if(b>=v-30&&b<=v+30&&y>=g-30&&y<=g+30)return}}catch(O){h.e(O)}finally{h.f()}var A=Object(ci.r)(n.mouseOnMap,u.pose.position);if(Object(ci.k)(A)>si.a/2){var E=Object(ci.i)(Object(ci.k)(A)/Object(ci.k)(A),A);u.pose.orientation=180*Math.atan2(E[0],-E[1])/Math.PI,u.pose.position=Object(ci.a)(u.pose.position,E)}}a.toString()!==n.committedMatrix.toString()&&n.setCommittedMatrix(a),d.dragging=!1,d.mouseDown=!1},onPinch:function(e){var t=Object(i.a)(e.da,2),s=t[0],c=t[1],d=e.origin,h=(e.event,e.memo);if(void 0===h)return[s,c];var p=Object(i.a)(h,2),f=p[0],m=p[1],v=Object(ci.a)(d,u()),g=s>10?s/f:s<-10?f/s:1+(s-f)/10;g=cr(Object(r.j)(a),g);var b=l?(new DOMMatrix).scaleSelf(g,g,1):(new DOMMatrix).scaleSelf(g,g,1).rotateSelf(0,0,c-m),y=Object(r.Q)(v,b,a);return n.setMatrix(y),l||(o.local.pose.orientation=-Object(r.E)(Object(r.i)(y))),[s,c]},onPinchEnd:function(){return n.setCommittedMatrix(a)},onMove:function(e){var t=e.xy;n.setMouse(t),o.local.mouse.position=Object.assign({},n.mouseOnMap)},onTouchStart:function(e){n.setMouse([e.touches[0].clientX,e.touches[0].clientY]),o.local.mouse.position=Object.assign({},n.mouseOnMap)}},{eventOptions:{passive:!1}});Object(f.useEffect)((function(){S()}),[]),Object(f.useEffect)((function(){function e(e){e.ctrlKey&&(window.visualViewport&&window.visualViewport.scale>1?e.deltaY<0&&e.preventDefault():e.preventDefault())}return window.document.body.addEventListener("wheel",e,{passive:!1}),function(){window.document.body.removeEventListener("wheel",e)}}),[]);var S=Object(f.useRef)((function(){if(c.current){for(var e=c.current,t=0;e;)t+=e.offsetLeft,e=e.offsetParent;n.setScreenSize([c.current.clientWidth,c.current.clientHeight]),n.setLeft(t)}})).current,C=ur({matrix:a});return Object(_.jsxs)("div",Object(g.a)(Object(g.a)({className:C.root,ref:c},O()),{},{children:[Object(_.jsx)(sr.a,{onResize:S}),Object(_.jsx)("div",{className:C.center,onWheel:function(e){if(!e.ctrlKey){var t,i=Math.pow(1.2,e.deltaY/100);if(1===(i=cr(Object(r.j)(n.matrix),i)))return;var o=(t=n.matrix).scale.apply(t,[i,i,1].concat(Object(vn.a)(Object(r.P)(n.matrix.inverse(),n.mouse))));n.setMatrix(o),n.setCommittedMatrix(o)}},children:Object(_.jsx)("div",{id:"map-transform",className:C.transform,ref:s,children:e.children})})]}))};dr.displayName="MapBase";var hr=n(62);var pr=function e(){Object(b.a)(this,e),this.timerId=void 0,this.event=void 0,this.keys=new Set,this.timerAgain=!1};var fr=Object(G.a)({root:function(e){return{display:"flex",justifyContent:"center",alignItems:"center",width:e.size,height:e.size,clipPath:"circle(".concat(.5*(e.size||0),"px  at center)"),overflow:"hidden"}},videoLargerWidth:function(e){return{height:"100%",transform:"scale(".concat(e.mirror?-1:1,", 1)")}},videoLargerHeight:function(e){return{width:"100%",transform:"scale(".concat(e.mirror?-1:1,", 1)")}}});var mr=function(e){var t=fr(e),n=Object(f.useRef)(null);return Object(f.useEffect)((function(){null!==(null===n||void 0===n?void 0:n.current)&&function(e,t,n,i,o){if(t)e.srcObject=t;else if(n){var r=URL.createObjectURL(n);e.src=r}e.autoplay=!0,e.onloadedmetadata=function(){var t=e.width,n=e.height;void 0!==t&&void 0!==n?e.className=t>=n?i:o:(console.error("video stream width || height is undefined"),e.className=i)}}(n.current,e.stream,e.blob,t.videoLargerWidth,t.videoLargerHeight)}),[n,t.videoLargerWidth,t.videoLargerHeight,e.stream,e.blob]),Object(_.jsx)("div",{className:t.root,style:e.style,children:Object(_.jsx)("video",{ref:n,style:e.style})})};mr.defaultProps={size:100},mr.displayName="StreamAvatar";var vr=n(183),gr=function(e){var t=e.name,n=e.avatarSrc,i=e.colors,o=e.stream,r=e.blob,a=Object(Pt.a)(e,["name","avatarSrc","colors","stream","blob"]);return o||r?Object(_.jsx)(mr,Object(g.a)({stream:o,blob:r},a)):Object(_.jsx)(rn,Object(g.a)({name:t,colors:i,avatarSrc:n},a))};gr.displayName="ComposedAvatar";var br=function(e){var t=e.participant;return Object(_.jsx)(p.a,{children:function(){var n=t.getColor(),i=t.information,o={colors:n,avatarSrc:i.avatarSrc,name:i.name};return Object(_.jsx)(gr,Object(g.a)(Object(g.a)({},o),{},{stream:!t.showVideo||t instanceof vr.a?void 0:t.tracks.avatarStream,blob:t.showVideo&&t instanceof vr.a?t.videoBlob:void 0,colors:n,size:e.size,style:{pointerEvents:"none"},mirror:e.isLocal}))}})},yr=function(e){return m.a.useMemo((function(){return Object(_.jsx)(br,Object(g.a)({},e))}),[e.size,e.participant.information.avatarSrc,e.participant.information.color,e.participant.information.name,e.participant.information.textColor])};yr.displayName="MemorizedAvatar";var Ar=12,Er=.5,Or=Object(G.a)({root:function(e){return{position:"absolute",left:e.position[0],top:e.position[1]}},pointerRotate:function(e){return{transform:"rotate(".concat(e.orientation,"deg)")}},pointer:function(e){return{position:"absolute",width:"".concat(Ar*e.size),left:"-".concat(Ar*e.size*Er,"px"),top:"-".concat(Ar*e.size*Er,"px"),pointerEvents:"none"}},avatar:function(e){return{position:"absolute",left:"-".concat(e.size*Er,"px"),top:"-".concat(e.size*Er,"px")}},icon:function(e){return{position:"absolute",width:.4*e.size,height:.4*e.size,left:.6*e.size,top:.6*e.size,pointerEvents:"none"}},iconProximity:function(e){return{position:"absolute",width:.6*e.size,height:.6*e.size,left:.7*e.size,top:.4*e.size,pointerEvents:"none"}},more:function(e){return{position:"absolute",width:.4*e.size,height:.4*e.size,left:.9*e.size,top:.3*-e.size}}}),Sr=function(e,t){var n=e.stores.map,o=e.participant,r=Object(p.b)((function(){return{position:o.pose.position,orientation:o.pose.orientation,mousePosition:o.mouse.position,awayFromKeyboard:o.awayFromKeyboard}})),a=Object(p.b)((function(){return o.information.name})),s=Object(p.b)((function(){return o.trackStates.micMuted?0:Math.pow(o.audioLevel,.5)})),c=Object(p.b)((function(){return o.trackStates.micMuted})),u=Object(p.b)((function(){return o.trackStates.speakerMuted})),l=Object(p.b)((function(){return o.trackStates.headphone})),d=Object(p.b)((function(){return o.physics.onStage})),h=Object(p.b)((function(){var t;return null===(t=e.stores.participants.local.zone)||void 0===t?void 0:t.zone})),f=Or(Object(g.a)(Object(g.a)({},r),{},{size:e.size})),v=o?o.getColor():["white","black"],b=Object(i.a)(v,2),y=b[0],A=b[1],E=e.size/2+2,O=e.isLocal,S=e.size*Ar*Er,C=Ar*e.size*Er,j=[.1,.2,.3,.4,.5,.6],T=j.map((function(t){return s>t?Object(_.jsxs)(m.a.Fragment,{children:[Object(_.jsx)("circle",{r:e.size*Er+t*S,cy:C,cx:C,stroke:y,fill:"none",opacity:.4*(1-t),strokeDasharray:"4 4 4 24"}),Object(_.jsx)("circle",{r:e.size*Er+t*S,cy:C,cx:C,stroke:"black",fill:"none",opacity:.4*(1-t),strokeDasharray:"4 32",strokeDashoffset:"-4"})]},t):void 0})),k=j.map((function(e){return s>e?Object(_.jsx)(m.a.Fragment,{children:Object(_.jsx)("img",{src:"data:image/png;base64,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",className:f.iconProximity,alt:""})},e):void 0}));return Object(_.jsxs)("div",{className:f.root+" dragHandle",onContextMenu:e.onContextMenu,children:[Object(_.jsx)("div",{className:f.pointerRotate,children:Object(_.jsxs)("svg",{className:f.pointer,width:e.size*Ar,height:e.size*Ar,xmlns:"http://www.w3.org/2000/svg",children:[Object(_.jsx)("circle",{r:E,cy:C,cx:C,stroke:"none",fill:y}),void 0===h?T:void 0,"arrow"===config.avatar?Object(_.jsxs)("g",{transform:"translate(".concat(C," ").concat(C,") rotate(-135) "),children:[Object(_.jsx)("rect",{style:{pointerEvents:"fill"},height:E,width:E,fill:y}),O?Object(_.jsx)("path",{d:"M 0 ".concat(E," h ").concat(E," v ").concat(-E)+"a ".concat(E," ").concat(E," 0 1 0 ").concat(-E," ").concat(E),fill:"none",stroke:A}):void 0]}):Object(_.jsx)("g",{style:{pointerEvents:"fill"}})]})}),Object(_.jsx)("div",{className:f.avatar,style:{transform:"rotate(".concat(-n.rotation,"deg)")},children:Object(_.jsx)(ke.a,{title:a,children:Object(_.jsxs)("div",{children:[Object(_.jsx)(yr,Object(g.a)({},e)),k,l?Object(_.jsx)(Ut.a,{className:f.icon,htmlColor:"rgba(0, 0, 0, 0.3)"}):void 0,u?Object(_.jsx)(te.a,{className:f.icon,color:"secondary"}):c?Object(_.jsx)(K.a,{className:f.icon,color:"secondary"}):void 0,!c&&d?Object(_.jsx)(F.Icon,{className:f.icon,icon:x.a,color:"gold"}):void 0]})})})]})};Sr.displayName="RawParticipant";var Cr=function(e){return m.a.useMemo((function(){return Object(_.jsx)(Sr,Object(g.a)({},e))}),[e.size,e.participant.id,e.participant.information.avatarSrc,e.participant.information.color,e.participant.information.name,e.participant.information.textColor])};Cr.displayName="MemorizedParticipant";var _r=180,jr=360,Tr=.5,kr=Object(G.a)({more:function(e){return{position:"absolute",width:.5*e.size,height:.5*e.size,left:e.position[0]+.4*e.size,top:e.position[1]-.8*e.size}}}),Ir=function(e){var t=e.stores.map,n=e.stores.participants,o=n.local;Object(r.b)(e.participant.id===o.id);var a=Object(f.useRef)({}).current,s=function(){var e=t.toWindow(o.pose.position),s=[e[0],e[1]],c=.2,u=t.left+t.screenSize[0]*c,l=t.left+.8*t.screenSize[0],d=.8*t.screenSize[1],h=n.local.thirdPersonView?t.screenSize[1]*c:d;s[0]<u&&(s[0]=u),s[0]>l&&(s[0]=l),s[1]<h&&(s[1]=h),s[1]>d&&(s[1]=d);var p=Object(r.O)(e,s),f=Math.sqrt(p[0]*p[0]+p[1]*p[1]);f>600?p=Object(r.B)(600/f,p):f<100&&(p=Object(r.B)(100/f,p));var m=Object(r.B)(.1,t.rotateFromWindow(p));if(Math.abs(m[0])+Math.abs(m[1])>.2){var v=t.matrix.translate(-m[0],-m[1]),g=t.rotateFromWindow([v.e,v.f]),b=.5,y=!1;g[0]<-hr.b*b&&(g[0]=-hr.b*b,y=!0),g[0]>hr.b*b&&(g[0]=hr.b*b,y=!0),g[1]<-hr.b*b&&(g[1]=-hr.b*b,y=!0),g[1]>hr.b*b&&(g[1]=hr.b*b,y=!0);var A=t.rotateToWindow(g),E=Object(i.a)(A,2);return v.e=E[0],v.f=E[1],t.setMatrix(v),t.setCommittedMatrix(v),a.scrollAgain=!y,!y}return a.scrollAgain=!1,!1},c=function(e){!function(e){var i=Object(r.O)(e.xy,t.toWindow(o.pose.position)),s=Math.sqrt(i[0]*i[0]+i[1]*i[1]);if(s>50&&(i=Object(r.B)(50/s,i)),n.local.thirdPersonView){var c=t.rotateFromWindow(i);o.pose.position=Object(r.a)(o.pose.position,c),a.smoothedDelta||(a.smoothedDelta=[i[0],i[1]]),a.smoothedDelta=Object(r.a)(Object(r.B)(1-.8,c),Object(r.B)(.8,a.smoothedDelta));var u=Math.atan2(a.smoothedDelta[0],-a.smoothedDelta[1])*_r/Math.PI-o.pose.orientation;u<-180&&(u+=jr),u>_r&&(u-=jr),o.pose.orientation+=.2*u}else o.pose.position=Object(r.a)(t.rotateFromWindow(i),o.pose.position);o.savePhysicsToStorage(!1)}(e)},u=new Set(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","KeyQ","KeyW","KeyE","KeyA","KeyS","KeyD"]);!function(e,t,n,i,o){var r=Object(f.useRef)(new pr).current;function a(){var t;r.timerAgain||r.keys.size?(r.timerAgain||(null===(t=r.event)||void 0===t?void 0:t.target)===document.body)&&(r.timerAgain=e(r.keys)):r.timerId&&(clearInterval(r.timerId),r.timerId=void 0)}t||(t=33);var s=function(e){o&&!o()||(n&&!(null===n||void 0===n?void 0:n.has(e.code))||e.preventDefault(),i&&!(null===i||void 0===i?void 0:i.has(e.code))||e.stopPropagation(),r.event=e,r.keys.add(e.code),r.timerId||r.event.target!==document.body||(r.timerId=setInterval(a,t)))},c=function(e){o&&!o()||(n&&!(null===n||void 0===n?void 0:n.has(e.code))||e.preventDefault(),i&&!(null===i||void 0===i?void 0:i.has(e.code))||e.stopPropagation(),r.event=e,r.keys.delete(e.code))},u=function(){r.keys.clear()};Object(f.useEffect)((function(){return window.addEventListener("keydown",s),window.addEventListener("keyup",c),window.addEventListener("blur",u),function(){window.removeEventListener("keydown",s),window.removeEventListener("keyup",c),window.removeEventListener("blur",u)}}),[])}((function(e){var i=function(e){var i=0,a=0,s=!1;(e.has("ArrowUp")||e.has("KeyW"))&&(i=10,s=!0),(e.has("ArrowDown")||e.has("KeyS"))&&(i=-5,s=!0),(e.has("ArrowLeft")||e.has("KeyA")||e.has("KeyQ"))&&(a=-5,s=!0),(e.has("ArrowRight")||e.has("KeyD")||e.has("KeyE"))&&(a=5,s=!0),(e.has("ShiftLeft")||e.has("ShiftRight"))&&(a*=2,i*=2);var c=o.pose.orientation+a;if(c>_r&&(c-=jr),c<-180&&(c+=jr),o.pose.orientation=c,!n.local.thirdPersonView){var u=Object(r.P)(t.matrix,n.local.pose.position),l=(new DOMMatrix).rotateSelf(0,0,-a),d=Object(r.Q)(u,l,t.matrix);t.setMatrix(d),t.setCommittedMatrix(d)}var h=Object(r.K)(o.pose.orientation,[0,-i]),p=Object(r.a)(o.pose.position,h);return p[0]<-hr.b*Tr&&(p[0]=-hr.b*Tr),p[0]>hr.b*Tr&&(p[0]=hr.b*Tr),p[1]<-hr.b*Tr&&(p[1]=-hr.b*Tr),p[1]>hr.b*Tr&&(p[1]=hr.b*Tr),o.pose.position=p,o.savePhysicsToStorage(!1),s}(e);return!(!a.scrollAgain&&!i)&&s()}),33,u,u,(function(){return 0===t.keyInputUsers.size}));var l=function(e,t,n,i,o){var a=Object(f.useRef)(null),s=Object(f.useRef)({state:{}}).current,c=function(){s.state.dragging||s.timerAgain?n&&(s.timerAgain=n(s.state)):(clearInterval(s.timerId),s.timerId=0)};function u(e){e.preventDefault(),e.stopPropagation()}Object(f.useEffect)((function(){var e=a.current;return null===e||void 0===e||e.addEventListener("touchmove",u,{passive:!1}),function(){null===e||void 0===e||e.removeEventListener("touchmove",u)}}),[a.current]);var l={target:a,onMouseDown:function(e){e.stopPropagation()},onTouchStart:function(e){e.stopPropagation()},onPointerDown:function(e){e.stopPropagation(),s.state={dragging:!1,buttons:e.buttons,xy:[e.clientX,e.clientY],start:[e.clientX,e.clientY],startTime:Date.now(),event:e},1&e.buttons&&a.current&&(!t||function(e,t,n){for(var i=e;i&&i!==t;){if(i.attributes){var o=i.attributes.getNamedItem("class");if(o&&o.value.includes(n))return i}i=i.parentNode}return null}(e.target,a.current,t))&&(e.target.setPointerCapture(e.pointerId),s.timerId||(s.timerId=setInterval(c,i)),s.state.dragging=!0)},onPointerOut:function(e){e.stopPropagation(),Object.assign(s.state,{dragging:!1,buttons:e.buttons,xy:[e.clientX,e.clientY],event:e})},onPointerUp:function(e){l.onPointerOut(e)},onTouchEnd:function(e){e.stopPropagation();var t=Object(r.C)(Object(r.O)(s.state.xy,s.state.start)),n=Date.now()-s.state.startTime;t<5&&n>.5&&o&&o(e)},onPointerMove:function(t){var n;t.stopPropagation(),Object.assign(s.state,{dragging:!!(null===(n=s.state)||void 0===n?void 0:n.dragging),buttons:t.buttons,xy:[t.clientX,t.clientY],event:t}),s.state.dragging&&(1&t.buttons?e(s.state):s.state.dragging=!1)}};return l}(c,"dragHandle",(function(e){return e.dragging&&c(e),s()}),33,(function(){T(!0)}));Object(f.useEffect)((function(){var e;null===(e=l.target.current)||void 0===e||e.focus({preventScroll:!0})}));var d=Object(p.b)((function(){return{position:o.pose.position,size:e.size}})),h=o?o.getColor():["white","black"],v=Object(i.a)(h,1)[0],b=kr(d),y=m.a.useState(!1),A=Object(i.a)(y,2),E=A[0],O=A[1],S=m.a.useState(!1),C=Object(i.a)(S,2),j=C[0],T=C[1],k=Se(O,a);function I(){T(!0),t.keyInputUsers.add("LocalParticipantConfig")}var R=Object(f.useRef)(null);return Object(_.jsxs)("div",Object(g.a)(Object(g.a)(Object(g.a)({ref:l.target},l),k),{},{children:[Object(_.jsx)(Cr,Object(g.a)(Object(g.a)({},e),{},{isLocal:!0,onContextMenu:function(e){e.preventDefault(),I()}})),Object(_.jsx)(Te,Object(g.a)(Object(g.a)({show:E,className:b.more,htmlColor:v},k),{},{buttonRef:R,onClickMore:I})),Object(_.jsx)(Go,{stores:e.stores,open:j,close:function(){T(!1),t.keyInputUsers.delete("LocalParticipantConfig")},anchorEl:R.current,anchorOrigin:{vertical:"top",horizontal:"left"},anchorReference:"anchorEl"})]}))},Rr=function(e){return m.a.useMemo((function(){return Object(_.jsx)(Ir,Object(g.a)({},e))}),[e.size,e.participant.id,e.participant.information.avatarSrc,e.participant.information.color,e.participant.information.name,e.participant.information.textColor])};Rr.displayName="MemorizedLocalParticipant";var wr=function(e){var t=e.stores.participants,n=t.find(e.participantId),o=Object(p.b)((function(){return n.mouse.position})),r=Object(p.b)((function(){return n.information.name})),a=n.getColor(),s=Object(i.a)(a,1)[0];if(!o)return Object(_.jsx)("div",{});var c=e.participantId===t.localId,u=Object(_.jsx)("div",{style:{width:18,height:30,left:o[0],top:o[1],position:"absolute",pointerEvents:c?"none":"auto"},children:Object(_.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 60 100",children:Object(_.jsx)("polygon",{points:"32,100 53,92 36,57 60,56 0,0 0,81 16,65 32,100",stroke:"black",fill:s,strokeWidth:"6"})})});return c?u:Object(_.jsx)(ke.a,{title:r,children:u})},Dr=function(e){return Object(_.jsx)(Cr,Object(g.a)(Object(g.a)({},e),{},{isLocal:!1}))},Nr=Object(G.a)({more:function(e){return{position:"absolute",width:.5*e.size,height:.5*e.size,left:e.position[0]+.4*e.size,top:e.position[1]-.8*e.size}}}),Pr=function(e){var t=m.a.useRef({}).current,n=m.a.useState(!1),o=Object(i.a)(n,2),r=o[0],a=Se(o[1],t),s=m.a.useState(!1),c=Object(i.a)(s,2),l=c[0],d=c[1],h=e.participant.getColor(),f=Object(i.a)(h,1)[0],v=Object(p.b)((function(){return{position:e.participant.pose.position,size:e.size}})),b=Nr(v);function y(){e.stores.map.keyInputUsers.add("remoteForm"),d(!0)}var A=m.a.useRef(null);return Object(_.jsxs)("div",Object(g.a)(Object(g.a)({},a),{},{onClick:function(t){return n=e.participant.id,void(l||(u.a.yarnPhones.has(n)?u.a.yarnPhones.delete(n):u.a.yarnPhones.add(n),u.a.yarnPhoneUpdated=!0));var n},onContextMenu:function(e){e.preventDefault(),y()},children:[Object(_.jsx)(Cr,Object(g.a)(Object(g.a)({},e),{},{isLocal:!1})),Object(_.jsx)(Te,Object(g.a)(Object(g.a)({show:r,className:b.more,htmlColor:f},a),{},{buttonRef:A,onClickMore:function(e){e.stopPropagation(),y()}})),Object(_.jsx)(Ho,{open:l,close:function(){e.stores.map.keyInputUsers.delete("remoteForm"),d(!1)},stores:e.stores,participant:e.participant,anchorEl:A.current,anchorOrigin:{vertical:"top",horizontal:"left"},anchorReference:"anchorEl"})]}))},Mr=function(e){var t=Math.min(e.start[0],e.end[0]),n=Math.min(e.start[1],e.end[1]),i=Math.abs(e.start[0]-e.end[0]),o=Math.abs(e.start[1]-e.end[1]);return Object(_.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",style:{position:"absolute",left:t,top:n,width:i,height:o,pointerEvents:"stroke"},viewBox:"0, 0, ".concat(i,", ").concat(o),onClick:function(){e.stores.participants.yarnPhones.delete(e.remote),e.stores.participants.yarnPhoneUpdated=!0},children:Object(_.jsx)("line",{x1:e.start[0]-t,y1:e.start[1]-n,x2:e.end[0]-t,y2:e.end[1]-n,stroke:"black"})})},Lr=function(e){var t=e.stores.participants,n=Object(p.b)((function(){return Array.from(t.remote.keys()).filter((function(e){return t.find(e).physics.located}))})),i=Object(p.b)((function(){return t.localId})),r=n.map((function(n){return Object(_.jsx)(Pr,{stores:e.stores,participant:t.remote.get(n),size:si.a},n)})),a=Object(_.jsx)(Rr,{participant:t.local,size:si.a,stores:e.stores},"local"),s=Object(p.b)((function(){return Array.from(t.yarnPhones).map((function(n){var i=t.local.pose.position,o=t.remote.get(n);if(o){var r=o.pose.position;return Object(_.jsx)(Mr,{start:i,end:r,remote:n,stores:e.stores},n)}}))})),c=Object(p.b)((function(){return Array.from(t.playback.keys())})).map((function(n){return Object(_.jsx)(Dr,{stores:e.stores,participant:t.playback.get(n),size:si.a},n)})),u=Object(p.b)((function(){return Array.from(t.remote.keys()).filter((function(e){return t.find(e).mouse.show}))})).map((function(t){return Object(_.jsx)(wr,{participantId:t,stores:e.stores},"M_".concat(t))})),l=Object(p.b)((function(){return t.local.mouse.show}))?Object(_.jsx)(wr,{participantId:i,stores:e.stores},"M_local"):void 0;return null!==o.a.testBot?Object(_.jsx)("div",{}):Object(_.jsxs)("div",{style:{position:"absolute",zIndex:32767},children:[s,c,r,a,u,l]})};Lr.displayName="ParticipantsLayer";var xr=function(e){var t=e.stores.map;function n(e){Object(Le.h)(e,t).then((function(e){var t,n=Object(oe.a)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;h.c.shareContent(i)}}catch(o){n.e(o)}finally{n.f()}}))}Object(f.useEffect)((function(){window.document.body.addEventListener("paste",(function(e){var i;i=e,h.c.pasteEnabled&&0===t.keyInputUsers.size&&i.clipboardData&&(i.preventDefault(),n(i.clipboardData))}),{passive:!1}),window.document.body.addEventListener("drop",(function(e){var t;(t=e).preventDefault(),t.stopPropagation(),t.dataTransfer&&n(t.dataTransfer)}),{passive:!1}),window.document.body.addEventListener("dragover",(function(e){var t;e.preventDefault(),e.stopPropagation(),(null===(t=e.dataTransfer)||void 0===t?void 0:t.dropEffect)&&(e.dataTransfer.dropEffect="copy")}),{passive:!1})}),[]);var i=Object(p.b)((function(){return h.c.pasted}));return Object(_.jsx)(jo,Object(g.a)(Object(g.a)({},e),{},{hideAll:""===i.type,content:i,onShare:function(e){i.zorder=Math.floor(Date.now()/Cn.c),i.pinned=!0,h.c.addLocalContent(It.a.cloneDeep(i)),h.c.setPasted(Object(Le.b)())},onClose:function(e){h.c.setPasted(Object(Le.b)()),e.stopPropagation()},updateAndSend:function(e){h.c.setPasted(e)},updateOnly:function(e){h.c.setPasted(e)}}))},Fr=Object(G.a)({slContainer:{userDrag:"none",userSelect:"none"}}),Br=m.a.memo((function(e){var t=e.stores.contents,n=Fr(),i=(e.transparent,Object(Pt.a)(e,["transparent"]));return Object(_.jsxs)("div",{className:n.slContainer,children:[Object(_.jsx)(p.a,{children:function(){var n=Array.from(t.all),o=e.transparent?n.filter((function(e){return!Object(Cn.j)(e)})):n;return Object(_.jsx)(_.Fragment,{children:o.map((function(e){return Object(_.jsx)(Do,Object(g.a)({content:e},i),e.id)}))})}}),Object(_.jsx)(xr,Object(g.a)({},i))]})}),(function(e,t){return It.a.isEqual(e.stores.contents.all,t.stores.contents.all)&&e.transparent===t.transparent}));Br.displayName="ShareLayer";var Ur=Object(G.a)({img:function(e){if(e.transparent)return{display:"none"};var t=Object(r.G)(e.fill);return{position:"absolute",top:.5*-hr.b,left:.5*-hr.b,backgroundColor:t,height:hr.b,width:hr.b}},logo:function(e){return e.transparent?{display:"none"}:{position:"absolute",top:0,right:0,bottom:0,left:0,margin:"auto",height:"10em",userDrag:"none",userSelect:"none",pointerEvents:"none"}}}),Vr=function(e){var t=e.stores.roomInfo,n=Object(g.a)({color:[0,0,0],fill:[0,0,0]},e);Object(p.b)((function(){n.color=t.backgroundColor,n.fill=t.backgroundFill}));var i=Ur(n);return Object(_.jsx)(p.a,{children:function(){return Object(_.jsx)("div",{className:i.img})}})};Vr.displayName="Background";var Jr=function(e){return Object(_.jsxs)(dr,Object(g.a)(Object(g.a)({},e),{},{children:[Object(_.jsx)(Vr,Object(g.a)({},e)),Object(_.jsx)(Br,Object(g.a)({},e)),Object(_.jsx)(Lr,Object(g.a)({},e))]}))};Jr.displayName="Map";var Gr=function(){var e=qt(),t=Wt(),n={map:c.b,participants:u.a,contents:h.c,chat:a.b,roomInfo:l.a},d=Object(f.useRef)(null),m=Object(f.useRef)(null),g=Object(f.useState)(!1),b=Object(i.a)(g,2),y=b[0],A=b[1],E=!1;return window.addEventListener("keydown",(function(e){"F3"===e.key&&!1===E&&(e.preventDefault(),E=!0,!0===y?A(!1):!1===y&&A(!0))}),{}),window.addEventListener("touchmove",(function(e){e.preventDefault()}),{passive:!1,capture:!1}),window.addEventListener("contextmenu",(function(e){e.preventDefault()}),{passive:!1,capture:!1}),window.onerror=function(e,t,n,i,r){return"Ping timeout"!==(null===r||void 0===r?void 0:r.message)&&"Strophe: Websocket error [object Event]"!==(null===r||void 0===r?void 0:r.message)||null!==e||null!==t||null!==n||null!==i?console.warn("Global handler: ".concat(e),t,n,i,r):(s.a.setType("connection"),null!==o.a.testBot&&window.location.reload()),!0},Object(_.jsx)(p.a,{children:function(){return Object(_.jsx)("div",{ref:d,className:t.back,style:{backgroundColor:Object(r.G)(l.a.backgroundFill)},children:Object(_.jsxs)(v.a,{pane2Style:!0===y?{display:"block",backgroundColor:"#FF00FF40"}:{display:"none",backgroundColor:"#FFF"},ref:m,className:t.fill,split:"vertical",resizerClassName:e.resizerVertical,minSize:0,defaultSize:!0===y?"85%":"100%",children:[Object(_.jsxs)(f.Fragment,{children:[Object(_.jsx)(rr,{showAllTracks:false,stores:n}),Object(_.jsx)(p.a,{children:function(){return Object(_.jsx)(Jr,{transparent:void 0!==h.c.tracks.mainStream||false,stores:n})}}),Object(_.jsx)(Kt,{stores:n,height:Object(r.y)()&&Object(r.w)()?100:void 0})]}),Object(_.jsx)("div",{style:{display:!0===y?"block":"none"},children:Object(_.jsx)(nr,{stores:n})})]})})}})};Gr.displayName="App";var Hr=Si,zr=function(){};var Qr=function(){function e(t,n,i,o,a){Object(b.a)(this,e),this.disposers=[],this.disposers.push(Object(Ve.c)((function(){var e=null===n||void 0===n?void 0:n.getParticipantId(),i=e&&h.c.tracks.carrierMap.get(e),s=i?h.c.find(i):void 0,c=t.get(),l=It.a.clone(c.pose);"user"===c.soundLocalizationBase&&(l.orientation=0);var d=!1,p=!1;if(o&&(u.a.yarnPhones.has(o.id)?p=!0:o.closedZone&&(o.closedZone===c.zone?p=!0:d=!0),!d&&!p&&c.zone)){var f=Object(r.q)(c.zone.pose,c.zone.size);d=!(p=Object(r.u)(o.pose.position,.5*si.a,f))&&"close"===c.zone.zone}if(!o||o.physics.located&&!d){var m=function(e,t,n){var i=It.a.cloneDeep(t?t.pose:n?n.pose:{position:[0,0],orientation:0});return n&&e.position.forEach((function(t,o){if(e.position[o]>i.position[o]){var r=e.position[o]-i.position[o];i.position[o]+=Math.min(n.size[o],r>0?r:0)}})),Object(r.r)(e,i)}(l,o,s);if(o&&p){zr("In zone: pid:".concat(o.id)),o.inLocalsZone=p;var v=Object(r.C)(m.position);v>1e-10&&(m.position=Object(r.B)(1/v,m.position))}var g=Object(r.d)(m);a.updatePose(g)}else a.updatePose(Object(r.d)({orientation:0,position:[hr.b,hr.b]})),zr("mute ".concat(o.id," loc:").concat(o.physics.located," other:").concat(d," rInL:").concat(p))}))),this.disposers.push(Object(Ve.c)((function(){if(i)a.playBlob(i.audioBlob);else{var e=o?o.tracks.audio:n;a.updateStream(null===e||void 0===e?void 0:e.getOriginalStream())}}))),this.disposers.push(Object(Ve.c)((function(){return a.updatePannerConfig(Hr)}))),this.disposers.push(Object(Ve.c)((function(){return a.updateBroadcast(!!(null===o||void 0===o?void 0:o.physics.onStage))})))}return Object(Vn.a)(e,[{key:"dispose",value:function(){var e,t=Object(oe.a)(this.disposers);try{for(t.s();!(e=t.n()).done;){(0,e.value)()}}catch(n){t.e(n)}finally{t.f()}}}]),e}(),Kr=n(122),Yr=function(){function e(){Object(b.a)(this,e),this.audioContext=new window.AudioContext,this.audioDestination=this.audioContext.createMediaStreamDestination(),this.audioElement=new Audio,this.playMode="Pause",this.nodes={},this.audioElement.srcObject=this.audioDestination.stream}return Object(Vn.a)(e,[{key:"addSpeaker",value:function(e){return Object(r.b)(void 0===this.nodes[e]),this.nodes[e]=new Ai(this.audioContext,this.audioDestination,this.playMode,!this.audioOutputMuted),this.nodes[e]}},{key:"removeSpeaker",value:function(e){this.nodes[e].disconnect(),delete this.nodes[e]}},{key:"switchPlayMode",value:function(e,t){var n=this;if(Object(r.b)("Pause"!==e),"Pause"===this.playMode&&Object(Ve.c)((function(){var e=new Set(Kr.a.tracksToAccept[1].map((function(e){return e.endpointId})));for(var t in n.nodes)e.has(t)?n.nodes[t].setPlayMode(n.playMode):n.nodes[t].setPlayMode("Pause")})),e!==this.playMode||t!==this.audioOutputMuted){switch(this.playMode=e,e){case"Context":var i=setInterval((function(){s.a.type||("suspended"!==n.audioContext.state&&clearInterval(i),n.audioContext.resume(),n.audioElement.play())}),1e3);for(var o in this.nodes)this.nodes[o].setPlayMode(e);break;case"Element":for(var a in this.audioContext.suspend(),this.audioElement.pause(),this.nodes)this.nodes[a].setPlayMode(e);break;default:console.error("Unsupported play mode: ".concat(e))}this.audioOutputMuted=t}}},{key:"setAudioOutput",value:function(e){for(var t in ui(this.audioElement,e),this.nodes)this.nodes[t].setAudioOutput(e)}},{key:"audioOutputMuted",get:function(){return!(this.audioDestination.stream.getTracks().length>0&&this.audioDestination.stream.getTracks()[0].enabled)},set:function(e){for(var t in this.nodes)this.nodes[t].updateAudibility(!e);this.audioDestination.stream.getTracks().forEach((function(t){t.enabled=!e}))}}]),e}(),Wr=new(function(){function e(){var t=this;Object(b.a)(this,e),this.manager=new Yr,this.connectedGroups={},this.remotesMemo=new Map,this.playbacksMemo=new Map,this.contentsMemo=new Map,this.onRemotesChange=function(){var e=new Map(u.a.remote),n=Object(r.f)(e,t.remotesMemo);Object(r.f)(t.remotesMemo,e).forEach(t.removeRemote),n.forEach(t.addRemote),t.remotesMemo=e},this.onPlaybacksChange=function(){var e=new Map(u.a.playback),n=Object(r.f)(e,t.playbacksMemo);Object(r.f)(t.playbacksMemo,e).forEach(t.removePlayback),n.forEach(t.addPlayback),t.playbacksMemo=e},this.onScreenContentsChange=function(){var e=new Map(h.c.tracks.remoteContents),n=Object(r.f)(e,t.contentsMemo);Object(r.f)(t.contentsMemo,e).forEach(t.removeContent),n.forEach(t.addContent),t.contentsMemo=e},this.removePlayback=function(e){var n="p_".concat(e.id);t.connectedGroups[n].dispose(),delete t.connectedGroups[n],t.manager.removeSpeaker(n)},this.addPlayback=function(e){var n="p_".concat(e.id),i=t.manager.addSpeaker(n);t.connectedGroups[n]=new Qr(u.a.local_,void 0,e,void 0,i)},this.removeRemote=function(e){var n=e.id;t.connectedGroups[n].dispose(),delete t.connectedGroups[n],t.manager.removeSpeaker(n)},this.addRemote=function(e){var n=t.manager.addSpeaker(e.id);t.connectedGroups[e.id]=new Qr(u.a.local_,void 0,void 0,e,n)},this.removeContent=function(e){var n=Array.from(e.values()).find((function(e){return"audio"===e.getType()}));if(n){var i=n.getParticipantId();i?(t.connectedGroups[i].dispose(),delete t.connectedGroups[i],t.manager.removeSpeaker(i)):console.error("removeContent: track does not have content id.",n)}},this.addContent=function(e){var n=Array.from(e.values()).find((function(e){return"audio"===e.getType()}));if(n){var i=n.getParticipantId();if(i){var o=t.manager.addSpeaker(i);t.connectedGroups[i]=new Qr(u.a.local_,n,void 0,void 0,o)}else console.error("addContent: track does not have content id.",n)}},null===o.a.testBot&&(Object(Ve.c)(this.onRemotesChange),Object(Ve.c)(this.onPlaybacksChange),Object(Ve.c)(this.onScreenContentsChange),Object(Ve.c)((function(){var e=u.a.local.muteSpeaker||u.a.local.awayFromKeyboard;t.manager.switchPlayMode(u.a.local.useStereoAudio?"Context":"Element",e)})))}return Object(Vn.a)(e,[{key:"setAudioOutput",value:function(e){this.manager.setAudioOutput(e)}}]),e}()),qr=n(138);Object(Ve.c)((function(){var e=u.a.local.devicePreference.audioInputDevice,t=u.a.local.muteAudio||u.a.local.awayFromKeyboard;if(u.a.localId&&!t&&null===o.a.testBot){var n=re.b.conference.getLocalMicTrack();if(n&&n.getDeviceId()===e)return;new Promise((function(e,t){var n=u.a.local.devicePreference.audioInputDevice;Ue.a.createLocalTracks({devices:["audio"],constraints:config.rtc.audioConstraints,micDeviceId:n}).then((function(t){re.b.conference.setLocalMicTrack(t[0]),e(t[0])})).catch(t)})).finally(qr.a)}else{re.b.conference.setLocalMicTrack(void 0).then((function(e){null===e||void 0===e||e.dispose(),u.a.local.audioLevel=0}))}})),Object(Ve.c)((function(){var e=u.a.local.devicePreference.audioOutputDevice;e&&Wr.setAudioOutput(e)}));Object(Ve.c)((function(){var e=u.a.local.devicePreference.videoInputDevice,t=u.a.local.muteVideo||u.a.local.awayFromKeyboard;if(u.a.localId&&!t&&null===o.a.testBot){var n=re.b.conference.getLocalCameraTrack();if(n&&n.getDeviceId()===e)return;new Promise((function(e,t){var n=u.a.local.devicePreference.videoInputDevice;Ue.a.createLocalTracks({devices:["video"],constraints:config.rtc.videoConstraints,cameraDeviceId:n}).then((function(t){re.b.conference.setLocalCameraTrack(t[0]),e(t[0])})).catch(t)})).finally(qr.a)}else{re.b.conference.setLocalCameraTrack(void 0).then((function(e){return null===e||void 0===e?void 0:e.dispose()}))}}));n(275);var Xr=n(56),Zr=n.n(Xr);function $r(){}function ea(){Zr.a.render(Object(_.jsx)(Gr,{}),document.getElementById("root"))}Object(Ve.e)({enforceActions:"never"}),Object(C.a)().then((function(){var e=Object(r.F)($r)();e.then(Object(r.F)(ea)),e.then(Object(r.F)(na))}));var ta="";function na(){window.addEventListener("beforeunload",(function(e){if(ta="".concat(ta,"beforeunload called. ").concat(Date()," "),localStorage.setItem("log",ta),!s.a.type&&(h.c.tracks.localMains.size||h.c.tracks.localContents.size))return ta+="Ask user. ",e.preventDefault(),e.stopImmediatePropagation(),e.returnValue="",localStorage.setItem("log",ta),e.returnValue;re.b.leaveConference(),re.b.disconnect().then((function(e){ta+="Diconnected (".concat(e,"). "),localStorage.setItem("log",ta)})).catch((function(e){ta+="Failed to diconnected (".concat(e,"). "),localStorage.setItem("log",ta)}))})),s.a.connectionStart(),re.b.init().then((function(){Object(Ve.j)((function(){return""===s.a.type}),(function(){var e=o.a.room||"_";re.b.joinConference(e)}))}))}}],[[653,1,2]]]);
//# sourceMappingURL=main.40c6b546.chunk.js.map